<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | This module relates to the processing of Order-By clauses.</span><span>
</span><span id="line-2"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.Backends.Postgres.Translate.Select.Internal.OrderBy</span><span>
</span><span id="line-3"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.OrderBy.html#processOrderByItems"><span class="hs-identifier">processOrderByItems</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-4"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-5"></span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(^?)</span></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html"><span class="hs-identifier">Hasura.Backends.Postgres.SQL.DML</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html"><span class="hs-identifier">Hasura.Backends.Postgres.SQL.Types</span></a></span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier">Identifier</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#IsIdentifier"><span class="hs-identifier">IsIdentifier</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier">toIdentifier</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#PGCol"><span class="hs-identifier">PGCol</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.BoolExp.html"><span class="hs-identifier">Hasura.Backends.Postgres.Translate.BoolExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.BoolExp.html#toSQLBoolExp"><span class="hs-identifier">toSQLBoolExp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html"><span class="hs-identifier">Hasura.Backends.Postgres.Translate.Select.Internal.Aliases</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkAggregateOrderByAlias"><span class="hs-identifier">mkAggregateOrderByAlias</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkAnnOrderByAlias"><span class="hs-identifier">mkAnnOrderByAlias</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkArrayRelationAlias"><span class="hs-identifier">mkArrayRelationAlias</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkArrayRelationSourcePrefix"><span class="hs-identifier">mkArrayRelationSourcePrefix</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkBaseTableAlias"><span class="hs-identifier">mkBaseTableAlias</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkBaseTableColumnAlias"><span class="hs-identifier">mkBaseTableColumnAlias</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkComputedFieldTableAlias"><span class="hs-identifier">mkComputedFieldTableAlias</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkObjectRelationTableAlias"><span class="hs-identifier">mkObjectRelationTableAlias</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkOrderByFieldName"><span class="hs-identifier">mkOrderByFieldName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Extractor.html"><span class="hs-identifier">Hasura.Backends.Postgres.Translate.Select.Internal.Extractor</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Extractor.html#aggregateFieldsToExtractorExps"><span class="hs-identifier">aggregateFieldsToExtractorExps</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Extractor.html#mkAggregateOrderByExtractorAndFields"><span class="hs-identifier">mkAggregateOrderByExtractorAndFields</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Helpers.html"><span class="hs-identifier">Hasura.Backends.Postgres.Translate.Select.Internal.Helpers</span></a></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Helpers.html#fromTableRowArgs"><span class="hs-identifier">fromTableRowArgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Helpers.html#functionToIdentifier"><span class="hs-identifier">functionToIdentifier</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Helpers.html#selectFromToFromItem"><span class="hs-identifier">selectFromToFromItem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.JoinTree.html"><span class="hs-identifier">Hasura.Backends.Postgres.Translate.Select.Internal.JoinTree</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.JoinTree.html#withWriteArrayRelation"><span class="hs-identifier">withWriteArrayRelation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.JoinTree.html#withWriteComputedFieldTableSet"><span class="hs-identifier">withWriteComputedFieldTableSet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.JoinTree.html#withWriteObjectRelation"><span class="hs-identifier">withWriteObjectRelation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html"><span class="hs-identifier">Hasura.Backends.Postgres.Translate.Types</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.Options.html"><span class="hs-identifier">Hasura.GraphQL.Schema.Options</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Options</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Prelude.html"><span class="hs-identifier">Hasura.Prelude</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.OrderBy.html"><span class="hs-identifier">Hasura.RQL.IR.OrderBy</span></a></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.OrderBy.html#OrderByItemG"><span class="hs-identifier">OrderByItemG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.OrderBy.html#OrderByItemG"><span class="hs-identifier">OrderByItemG</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.OrderBy.html#obiColumn"><span class="hs-identifier">obiColumn</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html"><span class="hs-identifier">Hasura.RQL.IR.Select</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html"><span class="hs-identifier">Hasura.RQL.Types.Backend</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Column.html"><span class="hs-identifier">Hasura.RQL.Types.Column</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html"><span class="hs-identifier">Hasura.RQL.Types.Common</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ComputedField.html"><span class="hs-identifier">Hasura.RQL.Types.ComputedField</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Relationships.Local.html"><span class="hs-identifier">Hasura.RQL.Types.Relationships.Local</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.Backend.html"><span class="hs-identifier">Hasura.SQL.Backend</span></a></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-comment">{- Note [Optimizing queries using limit/offset]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Refer to the issue https://github.com/hasura/graphql-engine/issues/5745

Before this change, limit/offset/distinct_on is applied at outer selection
node along with order by clause. This greatly reduces query performance if
our base selection table contains many rows and relationships are selected
which joins remote tables. We need to optimize application of limit wrt to
order by input.

If &quot;Order by&quot; is not present:
  Apply limit/offset/distinct on at the base table selection
Else if &quot;Order by&quot; contains only columns:
  Apply limit/offset/distinct_on at the base table selection along with order by
Otherwise:
  Apply limit/offset/distinct_on at the node selection along with order by
-}</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.OrderBy.html#processOrderByItems"><span class="hs-identifier hs-type">processOrderByItems</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689681176"><span class="annot"><a href="#local-6989586621689681176"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span> </span><span id="local-6989586621689681175"><span class="annot"><a href="#local-6989586621689681175"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.Options.html#StringifyNumbers"><span class="hs-identifier hs-type">Options.StringifyNumbers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689681175"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#JoinTree"><span class="hs-identifier hs-type">JoinTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689681175"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689681176"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-81"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-82"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#SimilarArrayFields"><span class="hs-identifier hs-type">SimilarArrayFields</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-83"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#PGCol"><span class="hs-identifier hs-type">PGCol</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-84"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnotatedOrderByItem"><span class="hs-identifier hs-type">AnnotatedOrderByItem</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689681176"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><a href="#local-6989586621689681175"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#ColumnAlias"><span class="hs-identifier hs-type">S.ColumnAlias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Order by Extractors</span><span>
</span><span id="line-87"></span><span>      </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectSorting"><span class="hs-identifier hs-type">SelectSorting</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span> </span><span class="hs-comment">-- The cursor expression</span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span id="processOrderByItems"><span class="annot"><span class="annottext">processOrderByItems :: Identifier
-&gt; FieldName
-&gt; SimilarArrayFields
-&gt; Maybe (NonEmpty PGCol)
-&gt; Maybe (NonEmpty (AnnotatedOrderByItem ('Postgres pgKind)))
-&gt; m ([(ColumnAlias, SQLExp)], SelectSorting, Maybe SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.OrderBy.html#processOrderByItems"><span class="hs-identifier hs-var hs-var">processOrderByItems</span></a></span></span><span> </span><span id="local-6989586621689681172"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681172"><span class="hs-identifier hs-var">sourcePrefix'</span></a></span></span><span> </span><span id="local-6989586621689681171"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621689681171"><span class="hs-identifier hs-var">fieldAlias'</span></a></span></span><span> </span><span id="local-6989586621689681170"><span class="annot"><span class="annottext">SimilarArrayFields
</span><a href="#local-6989586621689681170"><span class="hs-identifier hs-var">similarArrayFields</span></a></span></span><span> </span><span id="local-6989586621689681169"><span class="annot"><span class="annottext">Maybe (NonEmpty PGCol)
</span><a href="#local-6989586621689681169"><span class="hs-identifier hs-var">distOnCols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-91"></span><span>  </span><span class="annot"><span class="annottext">Maybe (NonEmpty (AnnotatedOrderByItem ('Postgres pgKind)))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([(ColumnAlias, SQLExp)], SelectSorting, Maybe SQLExp)
-&gt; m ([(ColumnAlias, SQLExp)], SelectSorting, Maybe SQLExp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe DistinctExpr -&gt; SelectSorting
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#NoSorting"><span class="hs-identifier hs-var">NoSorting</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe DistinctExpr -&gt; SelectSorting)
-&gt; Maybe DistinctExpr -&gt; SelectSorting
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty PGCol -&gt; DistinctExpr
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.OrderBy.html#applyDistinctOnAtBase"><span class="hs-identifier hs-var">applyDistinctOnAtBase</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty PGCol -&gt; DistinctExpr)
-&gt; Maybe (NonEmpty PGCol) -&gt; Maybe DistinctExpr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty PGCol)
</span><a href="#local-6989586621689681169"><span class="hs-identifier hs-var">distOnCols</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe SQLExp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621689681165"><span class="annot"><span class="annottext">NonEmpty (AnnotatedOrderByItem ('Postgres pgKind))
</span><a href="#local-6989586621689681165"><span class="hs-identifier hs-var">orderByItems</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-93"></span><span>    </span><span id="local-6989586621689681164"><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (ColumnAlias, SQLExp)))
</span><a href="#local-6989586621689681164"><span class="hs-identifier hs-var">orderByItemExps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) SQLExp)
-&gt; (AnnotatedOrderByItemG ('Postgres pgKind) SQLExp
    -&gt; m (OrderByItemG
            ('Postgres pgKind)
            (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
             (ColumnAlias, SQLExp))))
-&gt; m (NonEmpty
        (OrderByItemG
           ('Postgres pgKind)
           (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
            (ColumnAlias, SQLExp))))
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (AnnotatedOrderByItem ('Postgres pgKind))
NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) SQLExp)
</span><a href="#local-6989586621689681165"><span class="hs-identifier hs-var">orderByItems</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedOrderByItem ('Postgres pgKind)
-&gt; m (OrderByItemG
        ('Postgres pgKind)
        (AnnotatedOrderByElement
           ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
         (ColumnAlias, SQLExpression ('Postgres pgKind))))
AnnotatedOrderByItemG ('Postgres pgKind) SQLExp
-&gt; m (OrderByItemG
        ('Postgres pgKind)
        (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
         (ColumnAlias, SQLExp)))
</span><a href="#local-6989586621689681162"><span class="hs-identifier hs-var">processAnnOrderByItem</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689681161"><span class="annot"><span class="annottext">SelectSorting
</span><a href="#local-6989586621689681161"><span class="hs-identifier hs-var">sorting</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689681160"><span class="annot"><span class="annottext">[(ColumnAlias, SQLExp)]
</span><a href="#local-6989586621689681160"><span class="hs-identifier hs-var">distinctOnExtractors</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement
        ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
      (ColumnAlias, SQLExpression ('Postgres pgKind))))
-&gt; (SelectSorting,
    [(ColumnAlias, SQLExpression ('Postgres pgKind))])
</span><a href="#local-6989586621689681159"><span class="hs-identifier hs-var">generateSorting</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement
        ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
      (ColumnAlias, SQLExpression ('Postgres pgKind))))
NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (ColumnAlias, SQLExp)))
</span><a href="#local-6989586621689681164"><span class="hs-identifier hs-var">orderByItemExps</span></a></span><span>
</span><span id="line-95"></span><span>        </span><span id="local-6989586621689681158"><span class="annot"><span class="annottext">orderByExtractors :: [(ColumnAlias, SQLExp)]
</span><a href="#local-6989586621689681158"><span class="hs-identifier hs-var hs-var">orderByExtractors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(ColumnAlias, SQLExp)]] -&gt; [(ColumnAlias, SQLExp)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[(ColumnAlias, SQLExp)]] -&gt; [(ColumnAlias, SQLExp)])
-&gt; [[(ColumnAlias, SQLExp)]] -&gt; [(ColumnAlias, SQLExp)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty [(ColumnAlias, SQLExp)] -&gt; [[(ColumnAlias, SQLExp)]]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty [(ColumnAlias, SQLExp)] -&gt; [[(ColumnAlias, SQLExp)]])
-&gt; NonEmpty [(ColumnAlias, SQLExp)] -&gt; [[(ColumnAlias, SQLExp)]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
  (ColumnAlias, SQLExp))
 -&gt; (ColumnAlias, SQLExp))
-&gt; [(AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
     (ColumnAlias, SQLExp))]
-&gt; [(ColumnAlias, SQLExp)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
 (ColumnAlias, SQLExp))
-&gt; (ColumnAlias, SQLExp)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
   (ColumnAlias, SQLExp))]
 -&gt; [(ColumnAlias, SQLExp)])
-&gt; (OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (ColumnAlias, SQLExp))
    -&gt; [(AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
         (ColumnAlias, SQLExp))])
-&gt; OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (ColumnAlias, SQLExp))
-&gt; [(ColumnAlias, SQLExp)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
   (ColumnAlias, SQLExp))
-&gt; [(AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
     (ColumnAlias, SQLExp))]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (ColumnAlias, SQLExp))
 -&gt; [(ColumnAlias, SQLExp)])
-&gt; NonEmpty
     (OrderByItemG
        ('Postgres pgKind)
        (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
         (ColumnAlias, SQLExp)))
-&gt; NonEmpty [(ColumnAlias, SQLExp)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (ColumnAlias, SQLExp)))
</span><a href="#local-6989586621689681164"><span class="hs-identifier hs-var">orderByItemExps</span></a></span><span>
</span><span id="line-96"></span><span>        </span><span id="local-6989586621689681154"><span class="annot"><span class="annottext">cursor :: SQLExp
</span><a href="#local-6989586621689681154"><span class="hs-identifier hs-var hs-var">cursor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement
      ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
    (ColumnAlias, SQLExpression ('Postgres pgKind)))]
-&gt; SQLExp
</span><a href="#local-6989586621689681153"><span class="hs-identifier hs-var">mkCursorExp</span></a></span><span> </span><span class="annot"><span class="annottext">([OrderByItemG
    ('Postgres pgKind)
    (AnnotatedOrderByElement
       ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
     (ColumnAlias, SQLExpression ('Postgres pgKind)))]
 -&gt; SQLExp)
-&gt; [OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement
         ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
       (ColumnAlias, SQLExpression ('Postgres pgKind)))]
-&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (ColumnAlias, SQLExp)))
-&gt; [OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (ColumnAlias, SQLExp))]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (ColumnAlias, SQLExp)))
</span><a href="#local-6989586621689681164"><span class="hs-identifier hs-var">orderByItemExps</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span class="annot"><span class="annottext">([(ColumnAlias, SQLExp)], SelectSorting, Maybe SQLExp)
-&gt; m ([(ColumnAlias, SQLExp)], SelectSorting, Maybe SQLExp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(ColumnAlias, SQLExp)]
</span><a href="#local-6989586621689681158"><span class="hs-identifier hs-var">orderByExtractors</span></a></span><span> </span><span class="annot"><span class="annottext">[(ColumnAlias, SQLExp)]
-&gt; [(ColumnAlias, SQLExp)] -&gt; [(ColumnAlias, SQLExp)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(ColumnAlias, SQLExp)]
</span><a href="#local-6989586621689681160"><span class="hs-identifier hs-var">distinctOnExtractors</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SelectSorting
</span><a href="#local-6989586621689681161"><span class="hs-identifier hs-var">sorting</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe SQLExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621689681154"><span class="hs-identifier hs-var">cursor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><a href="#local-6989586621689681162"><span class="hs-identifier hs-type">processAnnOrderByItem</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-100"></span><span>      </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnotatedOrderByItem"><span class="hs-identifier hs-type">AnnotatedOrderByItem</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689681176"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-101"></span><span>      </span><span class="annot"><a href="#local-6989586621689681175"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.OrderBy.html#OrderByItemG"><span class="hs-identifier hs-type">OrderByItemG</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689681176"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnotatedOrderByElement"><span class="hs-identifier hs-type">AnnotatedOrderByElement</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689681176"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#SQLExpression"><span class="hs-identifier hs-type">SQLExpression</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689681176"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#ColumnAlias"><span class="hs-identifier hs-type">S.ColumnAlias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#SQLExpression"><span class="hs-identifier hs-type">SQLExpression</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689681176"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>    </span><span id="local-6989586621689681162"><span class="annot"><span class="annottext">processAnnOrderByItem :: AnnotatedOrderByItem ('Postgres pgKind)
-&gt; m (OrderByItemG
        ('Postgres pgKind)
        (AnnotatedOrderByElement
           ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
         (ColumnAlias, SQLExpression ('Postgres pgKind))))
</span><a href="#local-6989586621689681162"><span class="hs-identifier hs-var hs-var">processAnnOrderByItem</span></a></span></span><span> </span><span id="local-6989586621689681152"><span class="annot"><span class="annottext">AnnotatedOrderByItem ('Postgres pgKind)
</span><a href="#local-6989586621689681152"><span class="hs-identifier hs-var">orderByItem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-103"></span><span>      </span><span class="annot"><span class="annottext">AnnotatedOrderByItemG ('Postgres pgKind) SQLExp
-&gt; (AnnotatedOrderByElement ('Postgres pgKind) SQLExp
    -&gt; m (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
          (ColumnAlias, SQLExp)))
-&gt; m (OrderByItemG
        ('Postgres pgKind)
        (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
         (ColumnAlias, SQLExp)))
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">AnnotatedOrderByItem ('Postgres pgKind)
AnnotatedOrderByItemG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621689681152"><span class="hs-identifier hs-var">orderByItem</span></a></span><span> </span><span class="annot"><span class="annottext">((AnnotatedOrderByElement ('Postgres pgKind) SQLExp
  -&gt; m (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
        (ColumnAlias, SQLExp)))
 -&gt; m (OrderByItemG
         ('Postgres pgKind)
         (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
          (ColumnAlias, SQLExp))))
-&gt; (AnnotatedOrderByElement ('Postgres pgKind) SQLExp
    -&gt; m (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
          (ColumnAlias, SQLExp)))
-&gt; m (OrderByItemG
        ('Postgres pgKind)
        (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
         (ColumnAlias, SQLExp)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689681151"><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621689681151"><span class="hs-identifier hs-var">ordByCol</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-104"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621689681151"><span class="hs-identifier hs-var">ordByCol</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>          </span><span class="annot"><span class="annottext">((ColumnAlias, SQLExp)
 -&gt; (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
     (ColumnAlias, SQLExp)))
-&gt; m (ColumnAlias, SQLExp)
-&gt; m (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (ColumnAlias, SQLExp))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Identifier
-&gt; FieldName
-&gt; AnnotatedOrderByElement ('Postgres pgKind) SQLExp
-&gt; m (ColumnAlias, SQLExpression ('Postgres pgKind))
</span><a href="#local-6989586621689681150"><span class="hs-identifier hs-var">processAnnotatedOrderByElement</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681172"><span class="hs-identifier hs-var">sourcePrefix'</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621689681171"><span class="hs-identifier hs-var">fieldAlias'</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621689681151"><span class="hs-identifier hs-var">ordByCol</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><a href="#local-6989586621689681150"><span class="hs-identifier hs-type">processAnnotatedOrderByElement</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-108"></span><span>      </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnotatedOrderByElement"><span class="hs-identifier hs-type">AnnotatedOrderByElement</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689681176"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689681175"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#ColumnAlias"><span class="hs-identifier hs-type">S.ColumnAlias</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#SQLExpression"><span class="hs-identifier hs-type">SQLExpression</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689681176"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>    </span><span id="local-6989586621689681150"><span class="annot"><span class="annottext">processAnnotatedOrderByElement :: Identifier
-&gt; FieldName
-&gt; AnnotatedOrderByElement ('Postgres pgKind) SQLExp
-&gt; m (ColumnAlias, SQLExpression ('Postgres pgKind))
</span><a href="#local-6989586621689681150"><span class="hs-identifier hs-var hs-var">processAnnotatedOrderByElement</span></a></span></span><span> </span><span id="local-6989586621689681149"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681149"><span class="hs-identifier hs-var">sourcePrefix</span></a></span></span><span> </span><span id="local-6989586621689681148"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621689681148"><span class="hs-identifier hs-var">fieldAlias</span></a></span></span><span> </span><span id="local-6989586621689681147"><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621689681147"><span class="hs-identifier hs-var">annObCol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-110"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689681146"><span class="annot"><span class="annottext">ordByAlias :: ColumnAlias
</span><a href="#local-6989586621689681146"><span class="hs-identifier hs-var hs-var">ordByAlias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier
-&gt; FieldName
-&gt; SimilarArrayFields
-&gt; AnnotatedOrderByElement ('Postgres pgKind) SQLExp
-&gt; ColumnAlias
forall (pgKind :: PostgresKind) v.
Identifier
-&gt; FieldName
-&gt; SimilarArrayFields
-&gt; AnnotatedOrderByElement ('Postgres pgKind) v
-&gt; ColumnAlias
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkAnnOrderByAlias"><span class="hs-identifier hs-var">mkAnnOrderByAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681149"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621689681148"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span> </span><span class="annot"><span class="annottext">SimilarArrayFields
</span><a href="#local-6989586621689681170"><span class="hs-identifier hs-var">similarArrayFields</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621689681147"><span class="hs-identifier hs-var">annObCol</span></a></span><span>
</span><span id="line-111"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ColumnAlias
</span><a href="#local-6989586621689681146"><span class="hs-identifier hs-var">ordByAlias</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; (ColumnAlias, SQLExp))
-&gt; m SQLExp -&gt; m (ColumnAlias, SQLExp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621689681147"><span class="hs-identifier hs-var">annObCol</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-112"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCColumn"><span class="hs-identifier hs-type">AOCColumn</span></a></span><span> </span><span id="local-6989586621689681144"><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621689681144"><span class="hs-identifier hs-var">pgColInfo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-113"></span><span>          </span><span class="annot"><span class="annottext">SQLExp -&gt; m SQLExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; m SQLExp) -&gt; SQLExp -&gt; m SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-114"></span><span>            </span><span class="annot"><span class="annottext">TableAlias -&gt; Identifier -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; TableAlias
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkBaseTableAlias"><span class="hs-identifier hs-var">mkBaseTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681149"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; Identifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(PGCol -&gt; Identifier) -&gt; PGCol -&gt; Identifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind) -&gt; Column ('Postgres pgKind)
forall (b :: BackendType). ColumnInfo b -&gt; Column b
</span><a href="Hasura.RQL.Types.Column.html#ciColumn"><span class="hs-identifier hs-var hs-var">ciColumn</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621689681144"><span class="hs-identifier hs-var">pgColInfo</span></a></span><span>
</span><span id="line-115"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCObjectRelation"><span class="hs-identifier hs-type">AOCObjectRelation</span></a></span><span> </span><span id="local-6989586621689681140"><span class="annot"><span class="annottext">RelInfo ('Postgres pgKind)
</span><a href="#local-6989586621689681140"><span class="hs-identifier hs-var">relInfo</span></a></span></span><span> </span><span id="local-6989586621689681139"><span class="annot"><span class="annottext">AnnBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621689681139"><span class="hs-identifier hs-var">relFilter</span></a></span></span><span> </span><span id="local-6989586621689681138"><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621689681138"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (ObjectRelationSource, HashMap ColumnAlias SQLExp, SQLExp)
-&gt; m SQLExp
forall (m :: * -&gt; *) a.
MonadWriter JoinTree m =&gt;
m (ObjectRelationSource, HashMap ColumnAlias SQLExp, a) -&gt; m a
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.JoinTree.html#withWriteObjectRelation"><span class="hs-identifier hs-var">withWriteObjectRelation</span></a></span><span> </span><span class="annot"><span class="annottext">(m (ObjectRelationSource, HashMap ColumnAlias SQLExp, SQLExp)
 -&gt; m SQLExp)
-&gt; m (ObjectRelationSource, HashMap ColumnAlias SQLExp, SQLExp)
-&gt; m SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-116"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Relationships.Local.html#RelInfo"><span class="hs-identifier hs-type">RelInfo</span></a></span><span> </span><span id="local-6989586621689681136"><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621689681136"><span class="hs-identifier hs-var">relName</span></a></span></span><span> </span><span class="annot"><span class="annottext">RelType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621689681135"><span class="annot"><span class="annottext">HashMap (Column ('Postgres pgKind)) (Column ('Postgres pgKind))
</span><a href="#local-6989586621689681135"><span class="hs-identifier hs-var">colMapping</span></a></span></span><span> </span><span id="local-6989586621689681134"><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
</span><a href="#local-6989586621689681134"><span class="hs-identifier hs-var">relTable</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">InsertOrder
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RelInfo ('Postgres pgKind)
</span><a href="#local-6989586621689681140"><span class="hs-identifier hs-var">relInfo</span></a></span><span>
</span><span id="line-117"></span><span>              </span><span id="local-6989586621689681133"><span class="annot"><span class="annottext">relSourcePrefix :: Identifier
</span><a href="#local-6989586621689681133"><span class="hs-identifier hs-var hs-var">relSourcePrefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; RelName -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkObjectRelationTableAlias"><span class="hs-identifier hs-var">mkObjectRelationTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681149"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621689681136"><span class="hs-identifier hs-var">relName</span></a></span><span>
</span><span id="line-118"></span><span>              </span><span id="local-6989586621689681132"><span class="annot"><span class="annottext">fieldName :: FieldName
</span><a href="#local-6989586621689681132"><span class="hs-identifier hs-var hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RelName -&gt; FieldName
forall a. ToTxt a =&gt; a -&gt; FieldName
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkOrderByFieldName"><span class="hs-identifier hs-var">mkOrderByFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621689681136"><span class="hs-identifier hs-var">relName</span></a></span><span>
</span><span id="line-119"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621689681131"><span class="annot"><span class="annottext">ColumnAlias
</span><a href="#local-6989586621689681131"><span class="hs-identifier hs-var">relOrderByAlias</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689681130"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621689681130"><span class="hs-identifier hs-var">relOrdByExp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-120"></span><span>            </span><span class="annot"><span class="annottext">Identifier
-&gt; FieldName
-&gt; AnnotatedOrderByElement ('Postgres pgKind) SQLExp
-&gt; m (ColumnAlias, SQLExpression ('Postgres pgKind))
</span><a href="#local-6989586621689681150"><span class="hs-identifier hs-var">processAnnotatedOrderByElement</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681133"><span class="hs-identifier hs-var">relSourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621689681132"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621689681138"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-121"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689681129"><span class="annot"><span class="annottext">selectSource :: ObjectSelectSource
</span><a href="#local-6989586621689681129"><span class="hs-identifier hs-var hs-var">selectSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-122"></span><span>                </span><span class="annot"><span class="annottext">Identifier -&gt; FromItem -&gt; BoolExp -&gt; ObjectSelectSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#ObjectSelectSource"><span class="hs-identifier hs-var">ObjectSelectSource</span></a></span><span>
</span><span id="line-123"></span><span>                  </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681133"><span class="hs-identifier hs-var">relSourcePrefix</span></a></span><span>
</span><span id="line-124"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedTable -&gt; Maybe TableAlias -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FISimple"><span class="hs-identifier hs-var">S.FISimple</span></a></span><span> </span><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
QualifiedTable
</span><a href="#local-6989586621689681134"><span class="hs-identifier hs-var">relTable</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TableAlias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
forall (pgKind :: PostgresKind).
Backend ('Postgres pgKind) =&gt;
Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.Translate.BoolExp.html#toSQLBoolExp"><span class="hs-identifier hs-var">toSQLBoolExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedTable -&gt; Qual
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#QualTable"><span class="hs-identifier hs-var">S.QualTable</span></a></span><span> </span><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
QualifiedTable
</span><a href="#local-6989586621689681134"><span class="hs-identifier hs-var">relTable</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AnnBoolExpSQL ('Postgres pgKind)
AnnBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621689681139"><span class="hs-identifier hs-var">relFilter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>              </span><span id="local-6989586621689681125"><span class="annot"><span class="annottext">relSource :: ObjectRelationSource
</span><a href="#local-6989586621689681125"><span class="hs-identifier hs-var hs-var">relSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RelName
-&gt; HashMap PGCol PGCol
-&gt; ObjectSelectSource
-&gt; ObjectRelationSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#ObjectRelationSource"><span class="hs-identifier hs-var">ObjectRelationSource</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621689681136"><span class="hs-identifier hs-var">relName</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Column ('Postgres pgKind)) (Column ('Postgres pgKind))
HashMap PGCol PGCol
</span><a href="#local-6989586621689681135"><span class="hs-identifier hs-var">colMapping</span></a></span><span> </span><span class="annot"><span class="annottext">ObjectSelectSource
</span><a href="#local-6989586621689681129"><span class="hs-identifier hs-var">selectSource</span></a></span><span>
</span><span id="line-127"></span><span>          </span><span class="annot"><span class="annottext">(ObjectRelationSource, HashMap ColumnAlias SQLExp, SQLExp)
-&gt; m (ObjectRelationSource, HashMap ColumnAlias SQLExp, SQLExp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-128"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ObjectRelationSource
</span><a href="#local-6989586621689681125"><span class="hs-identifier hs-var">relSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-129"></span><span>              </span><span class="annot"><span class="annottext">ColumnAlias -&gt; SQLExp -&gt; HashMap ColumnAlias SQLExp
forall k v. Hashable k =&gt; k -&gt; v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.singleton</span></span><span> </span><span class="annot"><span class="annottext">ColumnAlias
</span><a href="#local-6989586621689681131"><span class="hs-identifier hs-var">relOrderByAlias</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621689681130"><span class="hs-identifier hs-var">relOrdByExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-130"></span><span>              </span><span class="annot"><span class="annottext">Identifier -&gt; ColumnAlias -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681133"><span class="hs-identifier hs-var">relSourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnAlias
</span><a href="#local-6989586621689681131"><span class="hs-identifier hs-var">relOrderByAlias</span></a></span><span>
</span><span id="line-131"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCArrayAggregation"><span class="hs-identifier hs-type">AOCArrayAggregation</span></a></span><span> </span><span id="local-6989586621689681121"><span class="annot"><span class="annottext">RelInfo ('Postgres pgKind)
</span><a href="#local-6989586621689681121"><span class="hs-identifier hs-var">relInfo</span></a></span></span><span> </span><span id="local-6989586621689681120"><span class="annot"><span class="annottext">AnnBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621689681120"><span class="hs-identifier hs-var">relFilter</span></a></span></span><span> </span><span id="local-6989586621689681119"><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="#local-6989586621689681119"><span class="hs-identifier hs-var">aggOrderBy</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (ArrayRelationSource, Extractor, HashMap ColumnAlias SQLExp,
   SQLExp)
-&gt; m SQLExp
forall (m :: * -&gt; *) a.
MonadWriter JoinTree m =&gt;
m (ArrayRelationSource, Extractor, HashMap ColumnAlias SQLExp, a)
-&gt; m a
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.JoinTree.html#withWriteArrayRelation"><span class="hs-identifier hs-var">withWriteArrayRelation</span></a></span><span> </span><span class="annot"><span class="annottext">(m (ArrayRelationSource, Extractor, HashMap ColumnAlias SQLExp,
    SQLExp)
 -&gt; m SQLExp)
-&gt; m (ArrayRelationSource, Extractor, HashMap ColumnAlias SQLExp,
      SQLExp)
-&gt; m SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-133"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Relationships.Local.html#RelInfo"><span class="hs-identifier hs-type">RelInfo</span></a></span><span> </span><span id="local-6989586621689681118"><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621689681118"><span class="hs-identifier hs-var">relName</span></a></span></span><span> </span><span class="annot"><span class="annottext">RelType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621689681117"><span class="annot"><span class="annottext">HashMap (Column ('Postgres pgKind)) (Column ('Postgres pgKind))
</span><a href="#local-6989586621689681117"><span class="hs-identifier hs-var">colMapping</span></a></span></span><span> </span><span id="local-6989586621689681116"><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
</span><a href="#local-6989586621689681116"><span class="hs-identifier hs-var">relTable</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">InsertOrder
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RelInfo ('Postgres pgKind)
</span><a href="#local-6989586621689681121"><span class="hs-identifier hs-var">relInfo</span></a></span><span>
</span><span id="line-134"></span><span>              </span><span id="local-6989586621689681115"><span class="annot"><span class="annottext">fieldName :: FieldName
</span><a href="#local-6989586621689681115"><span class="hs-identifier hs-var hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RelName -&gt; FieldName
forall a. ToTxt a =&gt; a -&gt; FieldName
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkOrderByFieldName"><span class="hs-identifier hs-var">mkOrderByFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621689681118"><span class="hs-identifier hs-var">relName</span></a></span><span>
</span><span id="line-135"></span><span>              </span><span id="local-6989586621689681114"><span class="annot"><span class="annottext">relSourcePrefix :: Identifier
</span><a href="#local-6989586621689681114"><span class="hs-identifier hs-var hs-var">relSourcePrefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-136"></span><span>                </span><span class="annot"><span class="annottext">Identifier
-&gt; FieldName -&gt; SimilarArrayFields -&gt; FieldName -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkArrayRelationSourcePrefix"><span class="hs-identifier hs-var">mkArrayRelationSourcePrefix</span></a></span><span>
</span><span id="line-137"></span><span>                  </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681149"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span>
</span><span id="line-138"></span><span>                  </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621689681148"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span>
</span><span id="line-139"></span><span>                  </span><span class="annot"><span class="annottext">SimilarArrayFields
</span><a href="#local-6989586621689681170"><span class="hs-identifier hs-var">similarArrayFields</span></a></span><span>
</span><span id="line-140"></span><span>                  </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621689681115"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-141"></span><span>              </span><span id="local-6989586621689681113"><span class="annot"><span class="annottext">relAlias :: TableAlias
</span><a href="#local-6989586621689681113"><span class="hs-identifier hs-var hs-var">relAlias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; SimilarArrayFields -&gt; FieldName -&gt; TableAlias
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkArrayRelationAlias"><span class="hs-identifier hs-var">mkArrayRelationAlias</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621689681148"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span> </span><span class="annot"><span class="annottext">SimilarArrayFields
</span><a href="#local-6989586621689681170"><span class="hs-identifier hs-var">similarArrayFields</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621689681115"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-142"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621689681112"><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621689681112"><span class="hs-identifier hs-var">topExtractor</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689681111"><span class="annot"><span class="annottext">AggregateFields ('Postgres pgKind)
</span><a href="#local-6989586621689681111"><span class="hs-identifier hs-var">fields</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
-&gt; (Extractor, AggregateFields ('Postgres pgKind))
forall (pgKind :: PostgresKind).
Backend ('Postgres pgKind) =&gt;
AnnotatedAggregateOrderBy ('Postgres pgKind)
-&gt; (Extractor, AggregateFields ('Postgres pgKind))
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Extractor.html#mkAggregateOrderByExtractorAndFields"><span class="hs-identifier hs-var">mkAggregateOrderByExtractorAndFields</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="#local-6989586621689681119"><span class="hs-identifier hs-var">aggOrderBy</span></a></span><span>
</span><span id="line-143"></span><span>              </span><span id="local-6989586621689681110"><span class="annot"><span class="annottext">selectSource :: SelectSource
</span><a href="#local-6989586621689681110"><span class="hs-identifier hs-var hs-var">selectSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-144"></span><span>                </span><span class="annot"><span class="annottext">Identifier
-&gt; FromItem -&gt; BoolExp -&gt; SortingAndSlicing -&gt; SelectSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectSource"><span class="hs-identifier hs-var">SelectSource</span></a></span><span>
</span><span id="line-145"></span><span>                  </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681114"><span class="hs-identifier hs-var">relSourcePrefix</span></a></span><span>
</span><span id="line-146"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedTable -&gt; Maybe TableAlias -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FISimple"><span class="hs-identifier hs-var">S.FISimple</span></a></span><span> </span><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
QualifiedTable
</span><a href="#local-6989586621689681116"><span class="hs-identifier hs-var">relTable</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TableAlias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
forall (pgKind :: PostgresKind).
Backend ('Postgres pgKind) =&gt;
Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.Translate.BoolExp.html#toSQLBoolExp"><span class="hs-identifier hs-var">toSQLBoolExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedTable -&gt; Qual
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#QualTable"><span class="hs-identifier hs-var">S.QualTable</span></a></span><span> </span><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
QualifiedTable
</span><a href="#local-6989586621689681116"><span class="hs-identifier hs-var">relTable</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AnnBoolExpSQL ('Postgres pgKind)
AnnBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621689681120"><span class="hs-identifier hs-var">relFilter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>                  </span><span class="annot"><span class="annottext">SortingAndSlicing
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#noSortingAndSlicing"><span class="hs-identifier hs-var">noSortingAndSlicing</span></a></span><span>
</span><span id="line-149"></span><span>              </span><span id="local-6989586621689681107"><span class="annot"><span class="annottext">relSource :: ArrayRelationSource
</span><a href="#local-6989586621689681107"><span class="hs-identifier hs-var hs-var">relSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TableAlias
-&gt; HashMap PGCol PGCol -&gt; SelectSource -&gt; ArrayRelationSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#ArrayRelationSource"><span class="hs-identifier hs-var">ArrayRelationSource</span></a></span><span> </span><span class="annot"><span class="annottext">TableAlias
</span><a href="#local-6989586621689681113"><span class="hs-identifier hs-var">relAlias</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Column ('Postgres pgKind)) (Column ('Postgres pgKind))
HashMap PGCol PGCol
</span><a href="#local-6989586621689681117"><span class="hs-identifier hs-var">colMapping</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621689681110"><span class="hs-identifier hs-var">selectSource</span></a></span><span>
</span><span id="line-150"></span><span>          </span><span class="annot"><span class="annottext">(ArrayRelationSource, Extractor, HashMap ColumnAlias SQLExp,
 SQLExp)
-&gt; m (ArrayRelationSource, Extractor, HashMap ColumnAlias SQLExp,
      SQLExp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-151"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ArrayRelationSource
</span><a href="#local-6989586621689681107"><span class="hs-identifier hs-var">relSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-152"></span><span>              </span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621689681112"><span class="hs-identifier hs-var">topExtractor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-153"></span><span>              </span><span class="annot"><span class="annottext">[(ColumnAlias, SQLExp)] -&gt; HashMap ColumnAlias SQLExp
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(ColumnAlias, SQLExp)] -&gt; HashMap ColumnAlias SQLExp)
-&gt; [(ColumnAlias, SQLExp)] -&gt; HashMap ColumnAlias SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier
-&gt; AggregateFields ('Postgres pgKind) -&gt; [(ColumnAlias, SQLExp)]
forall (pgKind :: PostgresKind).
Identifier
-&gt; AggregateFields ('Postgres pgKind) -&gt; [(ColumnAlias, SQLExp)]
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Extractor.html#aggregateFieldsToExtractorExps"><span class="hs-identifier hs-var">aggregateFieldsToExtractorExps</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681114"><span class="hs-identifier hs-var">relSourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">AggregateFields ('Postgres pgKind)
</span><a href="#local-6989586621689681111"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-154"></span><span>              </span><span class="annot"><span class="annottext">Identifier -&gt; ColumnAlias -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681114"><span class="hs-identifier hs-var">relSourcePrefix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind) -&gt; ColumnAlias
forall (pgKind :: PostgresKind).
AnnotatedAggregateOrderBy ('Postgres pgKind) -&gt; ColumnAlias
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkAggregateOrderByAlias"><span class="hs-identifier hs-var">mkAggregateOrderByAlias</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="#local-6989586621689681119"><span class="hs-identifier hs-var">aggOrderBy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCComputedField"><span class="hs-identifier hs-type">AOCComputedField</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ComputedFieldOrderBy"><span class="hs-identifier hs-type">ComputedFieldOrderBy</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621689681098"><span id="local-6989586621689681099"><span id="local-6989586621689681100"><span id="local-6989586621689681101"><span id="local-6989586621689681102"><span class="annot"><span class="annottext">FunctionName ('Postgres pgKind)
XComputedField ('Postgres pgKind)
FunctionArgsExp ('Postgres pgKind) SQLExp
ComputedFieldName
ComputedFieldOrderByElement ('Postgres pgKind) SQLExp
$sel:_cfobOrderByElement:ComputedFieldOrderBy :: forall (b :: BackendType) v.
ComputedFieldOrderBy b v -&gt; ComputedFieldOrderByElement b v
$sel:_cfobFunctionArgsExp:ComputedFieldOrderBy :: forall (b :: BackendType) v.
ComputedFieldOrderBy b v -&gt; FunctionArgsExp b v
$sel:_cfobFunction:ComputedFieldOrderBy :: forall (b :: BackendType) v.
ComputedFieldOrderBy b v -&gt; FunctionName b
$sel:_cfobName:ComputedFieldOrderBy :: forall (b :: BackendType) v.
ComputedFieldOrderBy b v -&gt; ComputedFieldName
$sel:_cfobXField:ComputedFieldOrderBy :: forall (b :: BackendType) v.
ComputedFieldOrderBy b v -&gt; XComputedField b
_cfobOrderByElement :: ComputedFieldOrderByElement ('Postgres pgKind) SQLExp
_cfobFunctionArgsExp :: FunctionArgsExp ('Postgres pgKind) SQLExp
_cfobFunction :: FunctionName ('Postgres pgKind)
_cfobName :: ComputedFieldName
_cfobXField :: XComputedField ('Postgres pgKind)
</span><a href="Hasura.RQL.IR.Select.html#%24sel%3A_cfobOrderByElement%3AComputedFieldOrderBy"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-157"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ComputedFieldOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621689681098"><span class="hs-identifier hs-var">_cfobOrderByElement</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-158"></span><span>            </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#CFOBEScalar"><span class="hs-identifier hs-type">CFOBEScalar</span></a></span><span> </span><span class="annot"><span class="annottext">ScalarType ('Postgres pgKind)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-159"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689681091"><span class="annot"><span class="annottext">functionArgs :: FunctionArgs
</span><a href="#local-6989586621689681091"><span class="hs-identifier hs-var hs-var">functionArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; FunctionArgsExpG (ArgumentExp SQLExp) -&gt; FunctionArgs
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Helpers.html#fromTableRowArgs"><span class="hs-identifier hs-var">fromTableRowArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681149"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionArgsExp ('Postgres pgKind) SQLExp
FunctionArgsExpG (ArgumentExp SQLExp)
</span><a href="#local-6989586621689681099"><span class="hs-identifier hs-var">_cfobFunctionArgsExp</span></a></span><span>
</span><span id="line-160"></span><span>                  </span><span id="local-6989586621689681090"><span class="annot"><span class="annottext">functionExp :: FunctionExp
</span><a href="#local-6989586621689681090"><span class="hs-identifier hs-var hs-var">functionExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QualifiedFunction
-&gt; FunctionArgs -&gt; Maybe FunctionAlias -&gt; FunctionExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FunctionExp"><span class="hs-identifier hs-var">S.FunctionExp</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName ('Postgres pgKind)
QualifiedFunction
</span><a href="#local-6989586621689681100"><span class="hs-identifier hs-var">_cfobFunction</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionArgs
</span><a href="#local-6989586621689681091"><span class="hs-identifier hs-var">functionArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FunctionAlias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-161"></span><span>              </span><span class="annot"><span class="annottext">SQLExp -&gt; m SQLExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; m SQLExp) -&gt; SQLExp -&gt; m SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FunctionExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEFunction"><span class="hs-identifier hs-var">S.SEFunction</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionExp
</span><a href="#local-6989586621689681090"><span class="hs-identifier hs-var">functionExp</span></a></span><span>
</span><span id="line-162"></span><span>            </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#CFOBETableAggregation"><span class="hs-identifier hs-type">CFOBETableAggregation</span></a></span><span> </span><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621689681086"><span class="annot"><span class="annottext">AnnBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621689681086"><span class="hs-identifier hs-var">tableFilter</span></a></span></span><span> </span><span id="local-6989586621689681085"><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="#local-6989586621689681085"><span class="hs-identifier hs-var">aggOrderBy</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (ComputedFieldTableSetSource, Extractor,
   HashMap ColumnAlias SQLExp, SQLExp)
-&gt; m SQLExp
forall (m :: * -&gt; *) a.
MonadWriter JoinTree m =&gt;
m (ComputedFieldTableSetSource, Extractor,
   HashMap ColumnAlias SQLExp, a)
-&gt; m a
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.JoinTree.html#withWriteComputedFieldTableSet"><span class="hs-identifier hs-var">withWriteComputedFieldTableSet</span></a></span><span> </span><span class="annot"><span class="annottext">(m (ComputedFieldTableSetSource, Extractor,
    HashMap ColumnAlias SQLExp, SQLExp)
 -&gt; m SQLExp)
-&gt; m (ComputedFieldTableSetSource, Extractor,
      HashMap ColumnAlias SQLExp, SQLExp)
-&gt; m SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-163"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689681084"><span class="annot"><span class="annottext">fieldName :: FieldName
</span><a href="#local-6989586621689681084"><span class="hs-identifier hs-var hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ComputedFieldName -&gt; FieldName
forall a. ToTxt a =&gt; a -&gt; FieldName
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkOrderByFieldName"><span class="hs-identifier hs-var">mkOrderByFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">ComputedFieldName
</span><a href="#local-6989586621689681101"><span class="hs-identifier hs-var">_cfobName</span></a></span><span>
</span><span id="line-164"></span><span>                  </span><span id="local-6989586621689681083"><span class="annot"><span class="annottext">computedFieldSourcePrefix :: Identifier
</span><a href="#local-6989586621689681083"><span class="hs-identifier hs-var hs-var">computedFieldSourcePrefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; FieldName -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkComputedFieldTableAlias"><span class="hs-identifier hs-var">mkComputedFieldTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681149"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621689681084"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-165"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621689681082"><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621689681082"><span class="hs-identifier hs-var">topExtractor</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689681081"><span class="annot"><span class="annottext">AggregateFields ('Postgres pgKind)
</span><a href="#local-6989586621689681081"><span class="hs-identifier hs-var">fields</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
-&gt; (Extractor, AggregateFields ('Postgres pgKind))
forall (pgKind :: PostgresKind).
Backend ('Postgres pgKind) =&gt;
AnnotatedAggregateOrderBy ('Postgres pgKind)
-&gt; (Extractor, AggregateFields ('Postgres pgKind))
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Extractor.html#mkAggregateOrderByExtractorAndFields"><span class="hs-identifier hs-var">mkAggregateOrderByExtractorAndFields</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="#local-6989586621689681085"><span class="hs-identifier hs-var">aggOrderBy</span></a></span><span>
</span><span id="line-166"></span><span>                  </span><span id="local-6989586621689681080"><span class="annot"><span class="annottext">fromItem :: FromItem
</span><a href="#local-6989586621689681080"><span class="hs-identifier hs-var hs-var">fromItem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-167"></span><span>                    </span><span class="annot"><span class="annottext">Identifier -&gt; SelectFrom ('Postgres Any) -&gt; FromItem
forall (pgKind :: PostgresKind).
Identifier -&gt; SelectFrom ('Postgres pgKind) -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Helpers.html#selectFromToFromItem"><span class="hs-identifier hs-var">selectFromToFromItem</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681149"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">(SelectFrom ('Postgres Any) -&gt; FromItem)
-&gt; SelectFrom ('Postgres Any) -&gt; FromItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-168"></span><span>                      </span><span class="annot"><span class="annottext">FunctionName ('Postgres Any)
-&gt; FunctionArgsExp ('Postgres Any) SQLExp
-&gt; Maybe [(Column ('Postgres Any), ScalarType ('Postgres Any))]
-&gt; SelectFromG ('Postgres Any) SQLExp
forall (b :: BackendType) v.
FunctionName b
-&gt; FunctionArgsExp b v
-&gt; Maybe [(Column b, ScalarType b)]
-&gt; SelectFromG b v
</span><a href="Hasura.RQL.IR.Select.html#FromFunction"><span class="hs-identifier hs-var">FromFunction</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName ('Postgres pgKind)
FunctionName ('Postgres Any)
</span><a href="#local-6989586621689681100"><span class="hs-identifier hs-var">_cfobFunction</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionArgsExp ('Postgres pgKind) SQLExp
FunctionArgsExp ('Postgres Any) SQLExp
</span><a href="#local-6989586621689681099"><span class="hs-identifier hs-var">_cfobFunctionArgsExp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [(Column ('Postgres Any), ScalarType ('Postgres Any))]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-169"></span><span>                  </span><span id="local-6989586621689681078"><span class="annot"><span class="annottext">functionQual :: Qual
</span><a href="#local-6989586621689681078"><span class="hs-identifier hs-var hs-var">functionQual</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Maybe TypeAnn -&gt; Qual
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#QualifiedIdentifier"><span class="hs-identifier hs-var">S.QualifiedIdentifier</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedFunction -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Helpers.html#functionToIdentifier"><span class="hs-identifier hs-var">functionToIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName ('Postgres pgKind)
QualifiedFunction
</span><a href="#local-6989586621689681100"><span class="hs-identifier hs-var">_cfobFunction</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe TypeAnn
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-170"></span><span>                  </span><span id="local-6989586621689681076"><span class="annot"><span class="annottext">selectSource :: SelectSource
</span><a href="#local-6989586621689681076"><span class="hs-identifier hs-var hs-var">selectSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-171"></span><span>                    </span><span class="annot"><span class="annottext">Identifier
-&gt; FromItem -&gt; BoolExp -&gt; SortingAndSlicing -&gt; SelectSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectSource"><span class="hs-identifier hs-var">SelectSource</span></a></span><span>
</span><span id="line-172"></span><span>                      </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681083"><span class="hs-identifier hs-var">computedFieldSourcePrefix</span></a></span><span>
</span><span id="line-173"></span><span>                      </span><span class="annot"><span class="annottext">FromItem
</span><a href="#local-6989586621689681080"><span class="hs-identifier hs-var">fromItem</span></a></span><span>
</span><span id="line-174"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
forall (pgKind :: PostgresKind).
Backend ('Postgres pgKind) =&gt;
Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.Translate.BoolExp.html#toSQLBoolExp"><span class="hs-identifier hs-var">toSQLBoolExp</span></a></span><span> </span><span class="annot"><span class="annottext">Qual
</span><a href="#local-6989586621689681078"><span class="hs-identifier hs-var">functionQual</span></a></span><span> </span><span class="annot"><span class="annottext">AnnBoolExpSQL ('Postgres pgKind)
AnnBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621689681086"><span class="hs-identifier hs-var">tableFilter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>                      </span><span class="annot"><span class="annottext">SortingAndSlicing
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#noSortingAndSlicing"><span class="hs-identifier hs-var">noSortingAndSlicing</span></a></span><span>
</span><span id="line-176"></span><span>                  </span><span id="local-6989586621689681075"><span class="annot"><span class="annottext">source :: ComputedFieldTableSetSource
</span><a href="#local-6989586621689681075"><span class="hs-identifier hs-var hs-var">source</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; SelectSource -&gt; ComputedFieldTableSetSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#ComputedFieldTableSetSource"><span class="hs-identifier hs-var">ComputedFieldTableSetSource</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621689681084"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621689681076"><span class="hs-identifier hs-var">selectSource</span></a></span><span>
</span><span id="line-177"></span><span>              </span><span class="annot"><span class="annottext">(ComputedFieldTableSetSource, Extractor,
 HashMap ColumnAlias SQLExp, SQLExp)
-&gt; m (ComputedFieldTableSetSource, Extractor,
      HashMap ColumnAlias SQLExp, SQLExp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-178"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ComputedFieldTableSetSource
</span><a href="#local-6989586621689681075"><span class="hs-identifier hs-var">source</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-179"></span><span>                  </span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621689681082"><span class="hs-identifier hs-var">topExtractor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-180"></span><span>                  </span><span class="annot"><span class="annottext">[(ColumnAlias, SQLExp)] -&gt; HashMap ColumnAlias SQLExp
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(ColumnAlias, SQLExp)] -&gt; HashMap ColumnAlias SQLExp)
-&gt; [(ColumnAlias, SQLExp)] -&gt; HashMap ColumnAlias SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier
-&gt; AggregateFields ('Postgres pgKind) -&gt; [(ColumnAlias, SQLExp)]
forall (pgKind :: PostgresKind).
Identifier
-&gt; AggregateFields ('Postgres pgKind) -&gt; [(ColumnAlias, SQLExp)]
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Extractor.html#aggregateFieldsToExtractorExps"><span class="hs-identifier hs-var">aggregateFieldsToExtractorExps</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681083"><span class="hs-identifier hs-var">computedFieldSourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">AggregateFields ('Postgres pgKind)
</span><a href="#local-6989586621689681081"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-181"></span><span>                  </span><span class="annot"><span class="annottext">Identifier -&gt; ColumnAlias -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681083"><span class="hs-identifier hs-var">computedFieldSourcePrefix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind) -&gt; ColumnAlias
forall (pgKind :: PostgresKind).
AnnotatedAggregateOrderBy ('Postgres pgKind) -&gt; ColumnAlias
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkAggregateOrderByAlias"><span class="hs-identifier hs-var">mkAggregateOrderByAlias</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="#local-6989586621689681085"><span class="hs-identifier hs-var">aggOrderBy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span>    </span><span class="annot"><a href="#local-6989586621689681159"><span class="hs-identifier hs-type">generateSorting</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-185"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.OrderBy.html#OrderByItemG"><span class="hs-identifier hs-type">OrderByItemG</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689681176"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnotatedOrderByElement"><span class="hs-identifier hs-type">AnnotatedOrderByElement</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689681176"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#SQLExpression"><span class="hs-identifier hs-type">SQLExpression</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689681176"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#ColumnAlias"><span class="hs-identifier hs-type">S.ColumnAlias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#SQLExpression"><span class="hs-identifier hs-type">SQLExpression</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689681176"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-186"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectSorting"><span class="hs-identifier hs-type">SelectSorting</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-187"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#ColumnAlias"><span class="hs-identifier hs-type">S.ColumnAlias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#SQLExpression"><span class="hs-identifier hs-type">SQLExpression</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689681176"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- 'distinct on' column extractors</span><span>
</span><span id="line-188"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>    </span><span id="local-6989586621689681159"><span class="annot"><span class="annottext">generateSorting :: NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement
        ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
      (ColumnAlias, SQLExpression ('Postgres pgKind))))
-&gt; (SelectSorting,
    [(ColumnAlias, SQLExpression ('Postgres pgKind))])
</span><a href="#local-6989586621689681159"><span class="hs-identifier hs-var hs-var">generateSorting</span></a></span></span><span> </span><span id="local-6989586621689681073"><span class="annot"><span class="annottext">orderByExps :: NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement
        ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
      (ColumnAlias, SQLExpression ('Postgres pgKind))))
</span><a href="#local-6989586621689681073"><span class="hs-identifier hs-var">orderByExps</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621689681072"><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement
     ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
   (ColumnAlias, SQLExpression ('Postgres pgKind)))
</span><a href="#local-6989586621689681072"><span class="hs-identifier hs-var">firstOrderBy</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">NE.:|</span></span><span> </span><span id="local-6989586621689681070"><span class="annot"><span class="annottext">[OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement
      ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
    (ColumnAlias, SQLExpression ('Postgres pgKind)))]
</span><a href="#local-6989586621689681070"><span class="hs-identifier hs-var">restOrderBys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-190"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
 (ColumnAlias, SQLExp))
-&gt; AnnotatedOrderByElement ('Postgres pgKind) SQLExp
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
  (ColumnAlias, SQLExp))
 -&gt; AnnotatedOrderByElement ('Postgres pgKind) SQLExp)
-&gt; (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (ColumnAlias, SQLExp))
-&gt; AnnotatedOrderByElement ('Postgres pgKind) SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
   (ColumnAlias, SQLExp))
-&gt; (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (ColumnAlias, SQLExp))
forall (b :: BackendType) a. OrderByItemG b a -&gt; a
</span><a href="Hasura.RQL.IR.OrderBy.html#obiColumn"><span class="hs-identifier hs-var hs-var">obiColumn</span></a></span><span> </span><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement
     ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
   (ColumnAlias, SQLExpression ('Postgres pgKind)))
OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
   (ColumnAlias, SQLExp))
</span><a href="#local-6989586621689681072"><span class="hs-identifier hs-var">firstOrderBy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-191"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCColumn"><span class="hs-identifier hs-type">AOCColumn</span></a></span><span> </span><span id="local-6989586621689681069"><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621689681069"><span class="hs-identifier hs-var">columnInfo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-192"></span><span>          </span><span class="hs-comment">-- If rest order by expressions are all columns then apply order by clause at base selection.</span><span>
</span><span id="line-193"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (ColumnAlias, SQLExp))
 -&gt; Bool)
-&gt; [OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (ColumnAlias, SQLExp))]
-&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ColumnInfo ('Postgres pgKind)) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (ColumnInfo ('Postgres pgKind)) -&gt; Bool)
-&gt; (OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (ColumnAlias, SQLExp))
    -&gt; Maybe (ColumnInfo ('Postgres pgKind)))
-&gt; OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (ColumnAlias, SQLExp))
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
 (ColumnAlias, SQLExp))
-&gt; Maybe (ColumnInfo ('Postgres pgKind))
forall (b :: BackendType) v b.
(AnnotatedOrderByElement b v, b) -&gt; Maybe (ColumnInfo b)
</span><a href="#local-6989586621689681066"><span class="hs-identifier hs-var">getColumnOrderBy</span></a></span><span> </span><span class="annot"><span class="annottext">((AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
  (ColumnAlias, SQLExp))
 -&gt; Maybe (ColumnInfo ('Postgres pgKind)))
-&gt; (OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (ColumnAlias, SQLExp))
    -&gt; (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
        (ColumnAlias, SQLExp)))
-&gt; OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (ColumnAlias, SQLExp))
-&gt; Maybe (ColumnInfo ('Postgres pgKind))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
   (ColumnAlias, SQLExp))
-&gt; (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (ColumnAlias, SQLExp))
forall (b :: BackendType) a. OrderByItemG b a -&gt; a
</span><a href="Hasura.RQL.IR.OrderBy.html#obiColumn"><span class="hs-identifier hs-var hs-var">obiColumn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement
      ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
    (ColumnAlias, SQLExpression ('Postgres pgKind)))]
[OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (ColumnAlias, SQLExp))]
</span><a href="#local-6989586621689681070"><span class="hs-identifier hs-var">restOrderBys</span></a></span><span>
</span><span id="line-194"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-comment">-- Collect column order by expressions from the rest.</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689681065"><span class="annot"><span class="annottext">restColumnOrderBys :: [OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))]
</span><a href="#local-6989586621689681065"><span class="hs-identifier hs-var hs-var">restColumnOrderBys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (ColumnAlias, SQLExp))
 -&gt; Maybe
      (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))))
-&gt; [OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (ColumnAlias, SQLExp))]
-&gt; [OrderByItemG
      ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))]
forall (f :: * -&gt; *) a b.
Filterable f =&gt;
(a -&gt; Maybe b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
  (ColumnAlias, SQLExp))
 -&gt; Maybe (ColumnInfo ('Postgres pgKind)))
-&gt; OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (ColumnAlias, SQLExp))
-&gt; Maybe
     (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind)))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">(AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
 (ColumnAlias, SQLExp))
-&gt; Maybe (ColumnInfo ('Postgres pgKind))
forall (b :: BackendType) v b.
(AnnotatedOrderByElement b v, b) -&gt; Maybe (ColumnInfo b)
</span><a href="#local-6989586621689681066"><span class="hs-identifier hs-var">getColumnOrderBy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement
      ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
    (ColumnAlias, SQLExpression ('Postgres pgKind)))]
[OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (ColumnAlias, SQLExp))]
</span><a href="#local-6989586621689681070"><span class="hs-identifier hs-var">restOrderBys</span></a></span><span>
</span><span id="line-197"></span><span>                  </span><span id="local-6989586621689681062"><span class="annot"><span class="annottext">firstColumnOrderBy :: OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))
</span><a href="#local-6989586621689681062"><span class="hs-identifier hs-var hs-var">firstColumnOrderBy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement
     ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
   (ColumnAlias, SQLExpression ('Postgres pgKind)))
OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
   (ColumnAlias, SQLExp))
</span><a href="#local-6989586621689681072"><span class="hs-identifier hs-var">firstOrderBy</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">obiColumn :: ColumnInfo ('Postgres pgKind)
</span><a href="Hasura.RQL.IR.OrderBy.html#obiColumn"><span class="hs-identifier hs-var">obiColumn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621689681069"><span class="hs-identifier hs-var">columnInfo</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-198"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind)))
-&gt; (SelectSorting, [(ColumnAlias, SQLExp)])
</span><a href="#local-6989586621689681061"><span class="hs-identifier hs-var">sortAtNodeAndBase</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty
   (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind)))
 -&gt; (SelectSorting, [(ColumnAlias, SQLExp)]))
-&gt; NonEmpty
     (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind)))
-&gt; (SelectSorting, [(ColumnAlias, SQLExp)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))
</span><a href="#local-6989586621689681062"><span class="hs-identifier hs-var">firstColumnOrderBy</span></a></span><span> </span><span class="annot"><span class="annottext">OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))
-&gt; [OrderByItemG
      ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))]
-&gt; NonEmpty
     (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind)))
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="annot"><span class="annottext">[OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))]
</span><a href="#local-6989586621689681065"><span class="hs-identifier hs-var">restColumnOrderBys</span></a></span><span>
</span><span id="line-199"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-comment">-- Else rest order by expressions contain atleast one non-column order by.</span><span>
</span><span id="line-200"></span><span>            </span><span class="hs-comment">-- So, apply order by clause at node selection.</span><span>
</span><span id="line-201"></span><span>              </span><span class="annot"><span class="annottext">(SelectSorting, [(ColumnAlias, SQLExpression ('Postgres pgKind))])
(SelectSorting, [(ColumnAlias, SQLExp)])
</span><a href="#local-6989586621689681060"><span class="hs-identifier hs-var">sortOnlyAtNode</span></a></span><span>
</span><span id="line-202"></span><span>        </span><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-203"></span><span>          </span><span class="hs-comment">-- First order by expression is non-column. So, apply order by clause at node selection.</span><span>
</span><span id="line-204"></span><span>          </span><span class="annot"><span class="annottext">(SelectSorting, [(ColumnAlias, SQLExpression ('Postgres pgKind))])
(SelectSorting, [(ColumnAlias, SQLExp)])
</span><a href="#local-6989586621689681060"><span class="hs-identifier hs-var">sortOnlyAtNode</span></a></span><span>
</span><span id="line-205"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-206"></span><span>        </span><span id="local-6989586621689681066"><span class="annot"><span class="annottext">getColumnOrderBy :: (AnnotatedOrderByElement b v, b) -&gt; Maybe (ColumnInfo b)
</span><a href="#local-6989586621689681066"><span class="hs-identifier hs-var hs-var">getColumnOrderBy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnotatedOrderByElement b v
-&gt; Getting
     (First (ColumnInfo b)) (AnnotatedOrderByElement b v) (ColumnInfo b)
-&gt; Maybe (ColumnInfo b)
forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (First (ColumnInfo b)) (AnnotatedOrderByElement b v) (ColumnInfo b)
forall (b :: BackendType) v.
Prism' (AnnotatedOrderByElement b v) (ColumnInfo b)
</span><a href="Hasura.RQL.IR.Select.html#_AOCColumn"><span class="hs-identifier hs-var">_AOCColumn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(AnnotatedOrderByElement b v -&gt; Maybe (ColumnInfo b))
-&gt; ((AnnotatedOrderByElement b v, b)
    -&gt; AnnotatedOrderByElement b v)
-&gt; (AnnotatedOrderByElement b v, b)
-&gt; Maybe (ColumnInfo b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(AnnotatedOrderByElement b v, b) -&gt; AnnotatedOrderByElement b v
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621689681058"><span class="annot"><span class="annottext">OrderByExp
</span><a href="#local-6989586621689681058"><span class="hs-identifier hs-var">nodeOrderBy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689681057"><span class="annot"><span class="annottext">Maybe DistinctExpr
</span><a href="#local-6989586621689681057"><span class="hs-identifier hs-var">nodeDistinctOn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689681056"><span class="annot"><span class="annottext">[(ColumnAlias, SQLExp)]
</span><a href="#local-6989586621689681056"><span class="hs-identifier hs-var">nodeDistinctOnExtractors</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-209"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689681055"><span class="annot"><span class="annottext">toOrderByExp :: OrderByItemG b (a, (a, b)) -&gt; OrderByItem
</span><a href="#local-6989586621689681055"><span class="hs-identifier hs-var hs-var">toOrderByExp</span></a></span></span><span> </span><span id="local-6989586621689681054"><span class="annot"><span class="annottext">OrderByItemG b (a, (a, b))
</span><a href="#local-6989586621689681054"><span class="hs-identifier hs-var">orderByItemExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-210"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.OrderBy.html#OrderByItemG"><span class="hs-identifier hs-type">OrderByItemG</span></a></span><span> </span><span id="local-6989586621689681053"><span class="annot"><span class="annottext">Maybe (BasicOrderType b)
</span><a href="#local-6989586621689681053"><span class="hs-identifier hs-var">obTyM</span></a></span></span><span> </span><span id="local-6989586621689681052"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689681052"><span class="hs-identifier hs-var">expAlias</span></a></span></span><span> </span><span id="local-6989586621689681051"><span class="annot"><span class="annottext">Maybe (NullsOrderType b)
</span><a href="#local-6989586621689681051"><span class="hs-identifier hs-var">obNullsM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, b) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((a, b) -&gt; a) -&gt; ((a, (a, b)) -&gt; (a, b)) -&gt; (a, (a, b)) -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a, (a, b)) -&gt; (a, b)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((a, (a, b)) -&gt; a)
-&gt; OrderByItemG b (a, (a, b)) -&gt; OrderByItemG b a
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">OrderByItemG b (a, (a, b))
</span><a href="#local-6989586621689681054"><span class="hs-identifier hs-var">orderByItemExp</span></a></span><span>
</span><span id="line-211"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe OrderType -&gt; Maybe NullsOrder -&gt; OrderByItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OrderByItem"><span class="hs-identifier hs-var">S.OrderByItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; Identifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689681052"><span class="hs-identifier hs-var">expAlias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (BasicOrderType b)
Maybe OrderType
</span><a href="#local-6989586621689681053"><span class="hs-identifier hs-var">obTyM</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NullsOrderType b)
Maybe NullsOrder
</span><a href="#local-6989586621689681051"><span class="hs-identifier hs-var">obNullsM</span></a></span><span>
</span><span id="line-212"></span><span>              </span><span id="local-6989586621689681048"><span class="annot"><span class="annottext">orderByExp :: OrderByExp
</span><a href="#local-6989586621689681048"><span class="hs-identifier hs-var hs-var">orderByExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty OrderByItem -&gt; OrderByExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OrderByExp"><span class="hs-identifier hs-var">S.OrderByExp</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty OrderByItem -&gt; OrderByExp)
-&gt; NonEmpty OrderByItem -&gt; OrderByExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
   (ColumnAlias, SQLExp))
-&gt; OrderByItem
forall a (b :: BackendType) a b.
(IsIdentifier a, BasicOrderType b ~ OrderType,
 NullsOrderType b ~ NullsOrder) =&gt;
OrderByItemG b (a, (a, b)) -&gt; OrderByItem
</span><a href="#local-6989586621689681055"><span class="hs-identifier hs-var">toOrderByExp</span></a></span><span> </span><span class="annot"><span class="annottext">(OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (ColumnAlias, SQLExp))
 -&gt; OrderByItem)
-&gt; NonEmpty
     (OrderByItemG
        ('Postgres pgKind)
        (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
         (ColumnAlias, SQLExp)))
-&gt; NonEmpty OrderByItem
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement
        ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
      (ColumnAlias, SQLExpression ('Postgres pgKind))))
NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (ColumnAlias, SQLExp)))
</span><a href="#local-6989586621689681073"><span class="hs-identifier hs-var">orderByExps</span></a></span><span>
</span><span id="line-213"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621689681046"><span class="annot"><span class="annottext">Maybe DistinctExpr
</span><a href="#local-6989586621689681046"><span class="hs-identifier hs-var">maybeDistOn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689681045"><span class="annot"><span class="annottext">Maybe [(ColumnAlias, SQLExp)]
</span><a href="#local-6989586621689681045"><span class="hs-identifier hs-var">distOnExtrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (DistinctExpr, [(ColumnAlias, SQLExp)])
-&gt; (Maybe DistinctExpr, Maybe [(ColumnAlias, SQLExp)])
forall (f :: * -&gt; *) a b. Functor f =&gt; f (a, b) -&gt; (f a, f b)
</span><span class="hs-identifier hs-var">NE.unzip</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (DistinctExpr, [(ColumnAlias, SQLExp)])
 -&gt; (Maybe DistinctExpr, Maybe [(ColumnAlias, SQLExp)]))
-&gt; Maybe (DistinctExpr, [(ColumnAlias, SQLExp)])
-&gt; (Maybe DistinctExpr, Maybe [(ColumnAlias, SQLExp)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier
-&gt; NonEmpty PGCol -&gt; (DistinctExpr, [(ColumnAlias, SQLExp)])
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.OrderBy.html#applyDistinctOnAtNode"><span class="hs-identifier hs-var">applyDistinctOnAtNode</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681172"><span class="hs-identifier hs-var">sourcePrefix'</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty PGCol -&gt; (DistinctExpr, [(ColumnAlias, SQLExp)]))
-&gt; Maybe (NonEmpty PGCol)
-&gt; Maybe (DistinctExpr, [(ColumnAlias, SQLExp)])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty PGCol)
</span><a href="#local-6989586621689681169"><span class="hs-identifier hs-var">distOnCols</span></a></span><span>
</span><span id="line-214"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrderByExp
</span><a href="#local-6989586621689681048"><span class="hs-identifier hs-var">orderByExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe DistinctExpr
</span><a href="#local-6989586621689681046"><span class="hs-identifier hs-var">maybeDistOn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(ColumnAlias, SQLExp)]
-&gt; Maybe [(ColumnAlias, SQLExp)] -&gt; [(ColumnAlias, SQLExp)]
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe [(ColumnAlias, SQLExp)]
</span><a href="#local-6989586621689681045"><span class="hs-identifier hs-var">distOnExtrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span>        </span><span id="local-6989586621689681060"><span class="annot"><span class="annottext">sortOnlyAtNode :: (SelectSorting, [(ColumnAlias, SQLExp)])
</span><a href="#local-6989586621689681060"><span class="hs-identifier hs-var hs-var">sortOnlyAtNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-217"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DistinctAndOrderByExpr -&gt; SelectSorting
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#Sorting"><span class="hs-identifier hs-var">Sorting</span></a></span><span> </span><span class="annot"><span class="annottext">(DistinctAndOrderByExpr -&gt; SelectSorting)
-&gt; DistinctAndOrderByExpr -&gt; SelectSorting
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(OrderByExp, Maybe DistinctExpr)
-&gt; Maybe (OrderByExp, Maybe DistinctExpr) -&gt; DistinctAndOrderByExpr
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#ASorting"><span class="hs-identifier hs-var">ASorting</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrderByExp
</span><a href="#local-6989586621689681058"><span class="hs-identifier hs-var">nodeOrderBy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe DistinctExpr
</span><a href="#local-6989586621689681057"><span class="hs-identifier hs-var">nodeDistinctOn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (OrderByExp, Maybe DistinctExpr)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(ColumnAlias, SQLExp)]
</span><a href="#local-6989586621689681056"><span class="hs-identifier hs-var">nodeDistinctOnExtractors</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>        </span><span id="local-6989586621689681061"><span class="annot"><span class="annottext">sortAtNodeAndBase :: NonEmpty
  (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind)))
-&gt; (SelectSorting, [(ColumnAlias, SQLExp)])
</span><a href="#local-6989586621689681061"><span class="hs-identifier hs-var hs-var">sortAtNodeAndBase</span></a></span></span><span> </span><span id="local-6989586621689681039"><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind)))
</span><a href="#local-6989586621689681039"><span class="hs-identifier hs-var">baseColumnOrderBys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-220"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689681038"><span class="annot"><span class="annottext">mkBaseOrderByItem :: OrderByItemG b (ColumnInfo b) -&gt; OrderByItem
</span><a href="#local-6989586621689681038"><span class="hs-identifier hs-var hs-var">mkBaseOrderByItem</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.OrderBy.html#OrderByItemG"><span class="hs-identifier hs-type">OrderByItemG</span></a></span><span> </span><span id="local-6989586621689681037"><span class="annot"><span class="annottext">Maybe (BasicOrderType b)
</span><a href="#local-6989586621689681037"><span class="hs-identifier hs-var">orderByType</span></a></span></span><span> </span><span id="local-6989586621689681036"><span class="annot"><span class="annottext">ColumnInfo b
</span><a href="#local-6989586621689681036"><span class="hs-identifier hs-var">columnInfo</span></a></span></span><span> </span><span id="local-6989586621689681035"><span class="annot"><span class="annottext">Maybe (NullsOrderType b)
</span><a href="#local-6989586621689681035"><span class="hs-identifier hs-var">nullsOrder</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-221"></span><span>                </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe OrderType -&gt; Maybe NullsOrder -&gt; OrderByItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OrderByItem"><span class="hs-identifier hs-var">S.OrderByItem</span></a></span><span>
</span><span id="line-222"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; Identifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Column b -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Column b -&gt; Identifier) -&gt; Column b -&gt; Identifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b -&gt; Column b
forall (b :: BackendType). ColumnInfo b -&gt; Column b
</span><a href="Hasura.RQL.Types.Column.html#ciColumn"><span class="hs-identifier hs-var hs-var">ciColumn</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b
</span><a href="#local-6989586621689681036"><span class="hs-identifier hs-var">columnInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>                  </span><span class="annot"><span class="annottext">Maybe (BasicOrderType b)
Maybe OrderType
</span><a href="#local-6989586621689681037"><span class="hs-identifier hs-var">orderByType</span></a></span><span>
</span><span id="line-224"></span><span>                  </span><span class="annot"><span class="annottext">Maybe (NullsOrderType b)
Maybe NullsOrder
</span><a href="#local-6989586621689681035"><span class="hs-identifier hs-var">nullsOrder</span></a></span><span>
</span><span id="line-225"></span><span>              </span><span id="local-6989586621689681034"><span class="annot"><span class="annottext">baseOrderByExp :: OrderByExp
</span><a href="#local-6989586621689681034"><span class="hs-identifier hs-var hs-var">baseOrderByExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty OrderByItem -&gt; OrderByExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OrderByExp"><span class="hs-identifier hs-var">S.OrderByExp</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty OrderByItem -&gt; OrderByExp)
-&gt; NonEmpty OrderByItem -&gt; OrderByExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))
-&gt; OrderByItem
forall (b :: BackendType) (b :: BackendType).
(IsIdentifier (Column b), BasicOrderType b ~ OrderType,
 NullsOrderType b ~ NullsOrder) =&gt;
OrderByItemG b (ColumnInfo b) -&gt; OrderByItem
</span><a href="#local-6989586621689681038"><span class="hs-identifier hs-var">mkBaseOrderByItem</span></a></span><span> </span><span class="annot"><span class="annottext">(OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))
 -&gt; OrderByItem)
-&gt; NonEmpty
     (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind)))
-&gt; NonEmpty OrderByItem
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind)))
</span><a href="#local-6989586621689681039"><span class="hs-identifier hs-var">baseColumnOrderBys</span></a></span><span>
</span><span id="line-226"></span><span>              </span><span id="local-6989586621689681033"><span class="annot"><span class="annottext">baseDistOnExp :: Maybe DistinctExpr
</span><a href="#local-6989586621689681033"><span class="hs-identifier hs-var hs-var">baseDistOnExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty PGCol -&gt; DistinctExpr
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.OrderBy.html#applyDistinctOnAtBase"><span class="hs-identifier hs-var">applyDistinctOnAtBase</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty PGCol -&gt; DistinctExpr)
-&gt; Maybe (NonEmpty PGCol) -&gt; Maybe DistinctExpr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty PGCol)
</span><a href="#local-6989586621689681169"><span class="hs-identifier hs-var">distOnCols</span></a></span><span>
</span><span id="line-227"></span><span>              </span><span id="local-6989586621689681032"><span class="annot"><span class="annottext">sorting :: SelectSorting
</span><a href="#local-6989586621689681032"><span class="hs-identifier hs-var hs-var">sorting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistinctAndOrderByExpr -&gt; SelectSorting
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#Sorting"><span class="hs-identifier hs-var">Sorting</span></a></span><span> </span><span class="annot"><span class="annottext">(DistinctAndOrderByExpr -&gt; SelectSorting)
-&gt; DistinctAndOrderByExpr -&gt; SelectSorting
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(OrderByExp, Maybe DistinctExpr)
-&gt; Maybe (OrderByExp, Maybe DistinctExpr) -&gt; DistinctAndOrderByExpr
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#ASorting"><span class="hs-identifier hs-var">ASorting</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrderByExp
</span><a href="#local-6989586621689681058"><span class="hs-identifier hs-var">nodeOrderBy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe DistinctExpr
</span><a href="#local-6989586621689681057"><span class="hs-identifier hs-var">nodeDistinctOn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (OrderByExp, Maybe DistinctExpr) -&gt; DistinctAndOrderByExpr)
-&gt; Maybe (OrderByExp, Maybe DistinctExpr) -&gt; DistinctAndOrderByExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(OrderByExp, Maybe DistinctExpr)
-&gt; Maybe (OrderByExp, Maybe DistinctExpr)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrderByExp
</span><a href="#local-6989586621689681034"><span class="hs-identifier hs-var">baseOrderByExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe DistinctExpr
</span><a href="#local-6989586621689681033"><span class="hs-identifier hs-var">baseDistOnExp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectSorting
</span><a href="#local-6989586621689681032"><span class="hs-identifier hs-var">sorting</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(ColumnAlias, SQLExp)]
</span><a href="#local-6989586621689681056"><span class="hs-identifier hs-var">nodeDistinctOnExtractors</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><a href="#local-6989586621689681153"><span class="hs-identifier hs-type">mkCursorExp</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-231"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.IR.OrderBy.html#OrderByItemG"><span class="hs-identifier hs-type">OrderByItemG</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689681176"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnotatedOrderByElement"><span class="hs-identifier hs-type">AnnotatedOrderByElement</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689681176"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#SQLExpression"><span class="hs-identifier hs-type">SQLExpression</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689681176"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#ColumnAlias"><span class="hs-identifier hs-type">S.ColumnAlias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#SQLExpression"><span class="hs-identifier hs-type">SQLExpression</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689681176"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-232"></span><span>      </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span>
</span><span id="line-233"></span><span>    </span><span id="local-6989586621689681153"><span class="annot"><span class="annottext">mkCursorExp :: [OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement
      ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
    (ColumnAlias, SQLExpression ('Postgres pgKind)))]
-&gt; SQLExp
</span><a href="#local-6989586621689681153"><span class="hs-identifier hs-var hs-var">mkCursorExp</span></a></span></span><span> </span><span id="local-6989586621689681031"><span class="annot"><span class="annottext">[OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement
      ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
    (ColumnAlias, SQLExpression ('Postgres pgKind)))]
</span><a href="#local-6989586621689681031"><span class="hs-identifier hs-var">orderByItemExps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-234"></span><span>      </span><span class="annot"><span class="annottext">[SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyJsonBuildObj"><span class="hs-identifier hs-var">S.applyJsonBuildObj</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; SQLExp) -&gt; [SQLExp] -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-235"></span><span>        </span><span class="annot"><span class="annottext">((OrderByItemG
    ('Postgres pgKind)
    (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
     (ColumnAlias, SQLExp))
  -&gt; [SQLExp])
 -&gt; [OrderByItemG
       ('Postgres pgKind)
       (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
        (ColumnAlias, SQLExp))]
 -&gt; [SQLExp])
-&gt; [OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (ColumnAlias, SQLExp))]
-&gt; (OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (ColumnAlias, SQLExp))
    -&gt; [SQLExp])
-&gt; [SQLExp]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (ColumnAlias, SQLExp))
 -&gt; [SQLExp])
-&gt; [OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (ColumnAlias, SQLExp))]
-&gt; [SQLExp]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">[OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement
      ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
    (ColumnAlias, SQLExpression ('Postgres pgKind)))]
[OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (ColumnAlias, SQLExp))]
</span><a href="#local-6989586621689681031"><span class="hs-identifier hs-var">orderByItemExps</span></a></span><span> </span><span class="annot"><span class="annottext">((OrderByItemG
    ('Postgres pgKind)
    (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
     (ColumnAlias, SQLExp))
  -&gt; [SQLExp])
 -&gt; [SQLExp])
-&gt; (OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (ColumnAlias, SQLExp))
    -&gt; [SQLExp])
-&gt; [SQLExp]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-236"></span><span>          </span><span class="hs-glyph">\</span><span id="local-6989586621689681027"><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
   (ColumnAlias, SQLExp))
</span><a href="#local-6989586621689681027"><span class="hs-identifier hs-var">orderByItemExp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-237"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.OrderBy.html#OrderByItemG"><span class="hs-identifier hs-type">OrderByItemG</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (BasicOrderType ('Postgres pgKind))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621689681026"><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621689681026"><span class="hs-identifier hs-var">annObCol</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ColumnAlias
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689681025"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621689681025"><span class="hs-identifier hs-var">valExp</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (NullsOrderType ('Postgres pgKind))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
   (ColumnAlias, SQLExp))
</span><a href="#local-6989586621689681027"><span class="hs-identifier hs-var">orderByItemExp</span></a></span><span>
</span><span id="line-238"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SQLExp
-&gt; AnnotatedOrderByElement ('Postgres pgKind) SQLExp -&gt; [SQLExp]
forall (b :: BackendType) v.
(Column b ~ PGCol) =&gt;
SQLExp -&gt; AnnotatedOrderByElement b v -&gt; [SQLExp]
</span><a href="#local-6989586621689681024"><span class="hs-identifier hs-var">annObColToJSONField</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621689681025"><span class="hs-identifier hs-var">valExp</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621689681026"><span class="hs-identifier hs-var">annObCol</span></a></span><span>
</span><span id="line-239"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-240"></span><span>        </span><span id="local-6989586621689681023"><span class="annot"><span class="annottext">mkAggOrderByValExp :: SQLExp -&gt; AnnotatedAggregateOrderBy b -&gt; [SQLExp]
</span><a href="#local-6989586621689681023"><span class="hs-identifier hs-var hs-var">mkAggOrderByValExp</span></a></span></span><span> </span><span id="local-6989586621689681022"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621689681022"><span class="hs-identifier hs-var">valExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-241"></span><span>          </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy b
</span><a href="Hasura.RQL.IR.Select.html#AAOCount"><span class="hs-identifier hs-var">AAOCount</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;count&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621689681022"><span class="hs-identifier hs-var">valExp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-242"></span><span>          </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AAOOp"><span class="hs-identifier hs-type">AAOOp</span></a></span><span> </span><span id="local-6989586621689681018"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689681018"><span class="hs-identifier hs-var">opText</span></a></span></span><span> </span><span id="local-6989586621689681017"><span class="annot"><span class="annottext">ColumnInfo b
</span><a href="#local-6989586621689681017"><span class="hs-identifier hs-var">colInfo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-243"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689681018"><span class="hs-identifier hs-var">opText</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-244"></span><span>              </span><span class="annot"><span class="annottext">[SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyJsonBuildObj"><span class="hs-identifier hs-var">S.applyJsonBuildObj</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SQLExp) -&gt; Text -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; Text
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#getPGColTxt"><span class="hs-identifier hs-var hs-var">getPGColTxt</span></a></span><span> </span><span class="annot"><span class="annottext">(PGCol -&gt; Text) -&gt; PGCol -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b -&gt; Column b
forall (b :: BackendType). ColumnInfo b -&gt; Column b
</span><a href="Hasura.RQL.Types.Column.html#ciColumn"><span class="hs-identifier hs-var hs-var">ciColumn</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b
</span><a href="#local-6989586621689681017"><span class="hs-identifier hs-var">colInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621689681022"><span class="hs-identifier hs-var">valExp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-245"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span>        </span><span id="local-6989586621689681024"><span class="annot"><span class="annottext">annObColToJSONField :: SQLExp -&gt; AnnotatedOrderByElement b v -&gt; [SQLExp]
</span><a href="#local-6989586621689681024"><span class="hs-identifier hs-var hs-var">annObColToJSONField</span></a></span></span><span> </span><span id="local-6989586621689681015"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621689681015"><span class="hs-identifier hs-var">valExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-248"></span><span>          </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCColumn"><span class="hs-identifier hs-type">AOCColumn</span></a></span><span> </span><span id="local-6989586621689681014"><span class="annot"><span class="annottext">ColumnInfo b
</span><a href="#local-6989586621689681014"><span class="hs-identifier hs-var">pgCol</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SQLExp) -&gt; Text -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; Text
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#getPGColTxt"><span class="hs-identifier hs-var hs-var">getPGColTxt</span></a></span><span> </span><span class="annot"><span class="annottext">(PGCol -&gt; Text) -&gt; PGCol -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b -&gt; Column b
forall (b :: BackendType). ColumnInfo b -&gt; Column b
</span><a href="Hasura.RQL.Types.Column.html#ciColumn"><span class="hs-identifier hs-var hs-var">ciColumn</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b
</span><a href="#local-6989586621689681014"><span class="hs-identifier hs-var">pgCol</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621689681015"><span class="hs-identifier hs-var">valExp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-249"></span><span>          </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCObjectRelation"><span class="hs-identifier hs-type">AOCObjectRelation</span></a></span><span> </span><span id="local-6989586621689681013"><span class="annot"><span class="annottext">RelInfo b
</span><a href="#local-6989586621689681013"><span class="hs-identifier hs-var">relInfo</span></a></span></span><span> </span><span class="annot"><span class="annottext">AnnBoolExp b v
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621689681012"><span class="annot"><span class="annottext">AnnotatedOrderByElement b v
</span><a href="#local-6989586621689681012"><span class="hs-identifier hs-var">obCol</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-250"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SQLExp) -&gt; Text -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RelName -&gt; Text
</span><a href="Hasura.RQL.Types.Common.html#relNameToTxt"><span class="hs-identifier hs-var">relNameToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">(RelName -&gt; Text) -&gt; RelName -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RelInfo b -&gt; RelName
forall (b :: BackendType). RelInfo b -&gt; RelName
</span><a href="Hasura.RQL.Types.Relationships.Local.html#riName"><span class="hs-identifier hs-var hs-var">riName</span></a></span><span> </span><span class="annot"><span class="annottext">RelInfo b
</span><a href="#local-6989586621689681013"><span class="hs-identifier hs-var">relInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-251"></span><span>              </span><span class="annot"><span class="annottext">[SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyJsonBuildObj"><span class="hs-identifier hs-var">S.applyJsonBuildObj</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; SQLExp) -&gt; [SQLExp] -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; AnnotatedOrderByElement b v -&gt; [SQLExp]
</span><a href="#local-6989586621689681024"><span class="hs-identifier hs-var">annObColToJSONField</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621689681015"><span class="hs-identifier hs-var">valExp</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedOrderByElement b v
</span><a href="#local-6989586621689681012"><span class="hs-identifier hs-var">obCol</span></a></span><span>
</span><span id="line-252"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-253"></span><span>          </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCArrayAggregation"><span class="hs-identifier hs-type">AOCArrayAggregation</span></a></span><span> </span><span id="local-6989586621689681009"><span class="annot"><span class="annottext">RelInfo b
</span><a href="#local-6989586621689681009"><span class="hs-identifier hs-var">relInfo</span></a></span></span><span> </span><span class="annot"><span class="annottext">AnnBoolExp b v
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621689681008"><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy b
</span><a href="#local-6989586621689681008"><span class="hs-identifier hs-var">aggOrderBy</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-254"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SQLExp) -&gt; Text -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RelName -&gt; Text
</span><a href="Hasura.RQL.Types.Common.html#relNameToTxt"><span class="hs-identifier hs-var">relNameToTxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RelInfo b -&gt; RelName
forall (b :: BackendType). RelInfo b -&gt; RelName
</span><a href="Hasura.RQL.Types.Relationships.Local.html#riName"><span class="hs-identifier hs-var hs-var">riName</span></a></span><span> </span><span class="annot"><span class="annottext">RelInfo b
</span><a href="#local-6989586621689681009"><span class="hs-identifier hs-var">relInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_aggregate&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-255"></span><span>              </span><span class="annot"><span class="annottext">[SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyJsonBuildObj"><span class="hs-identifier hs-var">S.applyJsonBuildObj</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; SQLExp) -&gt; [SQLExp] -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; AnnotatedAggregateOrderBy b -&gt; [SQLExp]
forall (b :: BackendType).
(Column b ~ PGCol) =&gt;
SQLExp -&gt; AnnotatedAggregateOrderBy b -&gt; [SQLExp]
</span><a href="#local-6989586621689681023"><span class="hs-identifier hs-var">mkAggOrderByValExp</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621689681015"><span class="hs-identifier hs-var">valExp</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy b
</span><a href="#local-6989586621689681008"><span class="hs-identifier hs-var">aggOrderBy</span></a></span><span>
</span><span id="line-256"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-257"></span><span>          </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCComputedField"><span class="hs-identifier hs-type">AOCComputedField</span></a></span><span> </span><span id="local-6989586621689681007"><span class="annot"><span class="annottext">ComputedFieldOrderBy b v
</span><a href="#local-6989586621689681007"><span class="hs-identifier hs-var">cfOrderBy</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-258"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689681006"><span class="annot"><span class="annottext">fieldNameText :: Text
</span><a href="#local-6989586621689681006"><span class="hs-identifier hs-var hs-var">fieldNameText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ComputedFieldName -&gt; Text
</span><a href="Hasura.RQL.Types.ComputedField.html#computedFieldNameToText"><span class="hs-identifier hs-var">computedFieldNameToText</span></a></span><span> </span><span class="annot"><span class="annottext">(ComputedFieldName -&gt; Text) -&gt; ComputedFieldName -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ComputedFieldOrderBy b v -&gt; ComputedFieldName
forall (b :: BackendType) v.
ComputedFieldOrderBy b v -&gt; ComputedFieldName
</span><a href="Hasura.RQL.IR.Select.html#%24sel%3A_cfobName%3AComputedFieldOrderBy"><span class="hs-identifier hs-var hs-var">_cfobName</span></a></span><span> </span><span class="annot"><span class="annottext">ComputedFieldOrderBy b v
</span><a href="#local-6989586621689681007"><span class="hs-identifier hs-var">cfOrderBy</span></a></span><span>
</span><span id="line-259"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ComputedFieldOrderBy b v -&gt; ComputedFieldOrderByElement b v
forall (b :: BackendType) v.
ComputedFieldOrderBy b v -&gt; ComputedFieldOrderByElement b v
</span><a href="Hasura.RQL.IR.Select.html#%24sel%3A_cfobOrderByElement%3AComputedFieldOrderBy"><span class="hs-identifier hs-var hs-var">_cfobOrderByElement</span></a></span><span> </span><span class="annot"><span class="annottext">ComputedFieldOrderBy b v
</span><a href="#local-6989586621689681007"><span class="hs-identifier hs-var">cfOrderBy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-260"></span><span>                  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#CFOBEScalar"><span class="hs-identifier hs-type">CFOBEScalar</span></a></span><span> </span><span class="annot"><span class="annottext">ScalarType b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689681006"><span class="hs-identifier hs-var">fieldNameText</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621689681015"><span class="hs-identifier hs-var">valExp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-261"></span><span>                  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#CFOBETableAggregation"><span class="hs-identifier hs-type">CFOBETableAggregation</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AnnBoolExp b v
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621689681004"><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy b
</span><a href="#local-6989586621689681004"><span class="hs-identifier hs-var">aggOrderBy</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-262"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SQLExp) -&gt; Text -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689681006"><span class="hs-identifier hs-var">fieldNameText</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_aggregate&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-263"></span><span>                      </span><span class="annot"><span class="annottext">[SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyJsonBuildObj"><span class="hs-identifier hs-var">S.applyJsonBuildObj</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; SQLExp) -&gt; [SQLExp] -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; AnnotatedAggregateOrderBy b -&gt; [SQLExp]
forall (b :: BackendType).
(Column b ~ PGCol) =&gt;
SQLExp -&gt; AnnotatedAggregateOrderBy b -&gt; [SQLExp]
</span><a href="#local-6989586621689681023"><span class="hs-identifier hs-var">mkAggOrderByValExp</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621689681015"><span class="hs-identifier hs-var">valExp</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy b
</span><a href="#local-6989586621689681004"><span class="hs-identifier hs-var">aggOrderBy</span></a></span><span>
</span><span id="line-264"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.OrderBy.html#applyDistinctOnAtBase"><span class="hs-identifier hs-type">applyDistinctOnAtBase</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-267"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#PGCol"><span class="hs-identifier hs-type">PGCol</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#DistinctExpr"><span class="hs-identifier hs-type">S.DistinctExpr</span></a></span><span>
</span><span id="line-268"></span><span id="applyDistinctOnAtBase"><span class="annot"><span class="annottext">applyDistinctOnAtBase :: NonEmpty PGCol -&gt; DistinctExpr
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.OrderBy.html#applyDistinctOnAtBase"><span class="hs-identifier hs-var hs-var">applyDistinctOnAtBase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-269"></span><span>  </span><span class="annot"><span class="annottext">[SQLExp] -&gt; DistinctExpr
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#DistinctOn"><span class="hs-identifier hs-var">S.DistinctOn</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; DistinctExpr)
-&gt; (NonEmpty PGCol -&gt; [SQLExp]) -&gt; NonEmpty PGCol -&gt; DistinctExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PGCol -&gt; SQLExp) -&gt; [PGCol] -&gt; [SQLExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; (PGCol -&gt; Identifier) -&gt; PGCol -&gt; SQLExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([PGCol] -&gt; [SQLExp])
-&gt; (NonEmpty PGCol -&gt; [PGCol]) -&gt; NonEmpty PGCol -&gt; [SQLExp]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty PGCol -&gt; [PGCol]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.Internal.OrderBy.html#applyDistinctOnAtNode"><span class="hs-identifier hs-type">applyDistinctOnAtNode</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-272"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-273"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#PGCol"><span class="hs-identifier hs-type">PGCol</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#DistinctExpr"><span class="hs-identifier hs-type">S.DistinctExpr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#ColumnAlias"><span class="hs-identifier hs-type">S.ColumnAlias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- additional column extractors</span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span id="applyDistinctOnAtNode"><span class="annot"><span class="annottext">applyDistinctOnAtNode :: Identifier
-&gt; NonEmpty PGCol -&gt; (DistinctExpr, [(ColumnAlias, SQLExp)])
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.OrderBy.html#applyDistinctOnAtNode"><span class="hs-identifier hs-var hs-var">applyDistinctOnAtNode</span></a></span></span><span> </span><span id="local-6989586621689681002"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681002"><span class="hs-identifier hs-var">pfx</span></a></span></span><span> </span><span id="local-6989586621689681001"><span class="annot"><span class="annottext">NonEmpty PGCol
</span><a href="#local-6989586621689681001"><span class="hs-identifier hs-var">neCols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DistinctExpr
</span><a href="#local-6989586621689681000"><span class="hs-identifier hs-var">distOnExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(ColumnAlias, SQLExp)]
</span><a href="#local-6989586621689680999"><span class="hs-identifier hs-var">colExtrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-279"></span><span>    </span><span id="local-6989586621689680998"><span class="annot"><span class="annottext">cols :: [PGCol]
</span><a href="#local-6989586621689680998"><span class="hs-identifier hs-var hs-var">cols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty PGCol -&gt; [PGCol]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty PGCol
</span><a href="#local-6989586621689681001"><span class="hs-identifier hs-var">neCols</span></a></span><span>
</span><span id="line-280"></span><span>    </span><span id="local-6989586621689681000"><span class="annot"><span class="annottext">distOnExp :: DistinctExpr
</span><a href="#local-6989586621689681000"><span class="hs-identifier hs-var hs-var">distOnExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SQLExp] -&gt; DistinctExpr
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#DistinctOn"><span class="hs-identifier hs-var">S.DistinctOn</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; DistinctExpr) -&gt; [SQLExp] -&gt; DistinctExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PGCol -&gt; SQLExp) -&gt; [PGCol] -&gt; [SQLExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; (PGCol -&gt; Identifier) -&gt; PGCol -&gt; SQLExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ColumnAlias -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(ColumnAlias -&gt; Identifier)
-&gt; (PGCol -&gt; ColumnAlias) -&gt; PGCol -&gt; Identifier
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; ColumnAlias
</span><a href="#local-6989586621689680997"><span class="hs-identifier hs-var">mkQColAls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PGCol]
</span><a href="#local-6989586621689680998"><span class="hs-identifier hs-var">cols</span></a></span><span>
</span><span id="line-281"></span><span>    </span><span id="local-6989586621689680996"><span class="annot"><span class="annottext">mkQCol :: PGCol -&gt; SQLExp
</span><a href="#local-6989586621689680996"><span class="hs-identifier hs-var hs-var">mkQCol</span></a></span></span><span> </span><span id="local-6989586621689680995"><span class="annot"><span class="annottext">PGCol
</span><a href="#local-6989586621689680995"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TableAlias -&gt; Identifier -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; TableAlias
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkBaseTableAlias"><span class="hs-identifier hs-var">mkBaseTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681002"><span class="hs-identifier hs-var">pfx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; Identifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">PGCol
</span><a href="#local-6989586621689680995"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-282"></span><span>    </span><span id="local-6989586621689680997"><span class="annot"><span class="annottext">mkQColAls :: PGCol -&gt; ColumnAlias
</span><a href="#local-6989586621689680997"><span class="hs-identifier hs-var hs-var">mkQColAls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; PGCol -&gt; ColumnAlias
</span><a href="Hasura.Backends.Postgres.Translate.Select.Internal.Aliases.html#mkBaseTableColumnAlias"><span class="hs-identifier hs-var">mkBaseTableColumnAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689681002"><span class="hs-identifier hs-var">pfx</span></a></span><span>
</span><span id="line-283"></span><span>    </span><span id="local-6989586621689680999"><span class="annot"><span class="annottext">colExtrs :: [(ColumnAlias, SQLExp)]
</span><a href="#local-6989586621689680999"><span class="hs-identifier hs-var hs-var">colExtrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((PGCol -&gt; (ColumnAlias, SQLExp))
 -&gt; [PGCol] -&gt; [(ColumnAlias, SQLExp)])
-&gt; [PGCol]
-&gt; (PGCol -&gt; (ColumnAlias, SQLExp))
-&gt; [(ColumnAlias, SQLExp)]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(PGCol -&gt; (ColumnAlias, SQLExp))
-&gt; [PGCol] -&gt; [(ColumnAlias, SQLExp)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[PGCol]
</span><a href="#local-6989586621689680998"><span class="hs-identifier hs-var">cols</span></a></span><span> </span><span class="annot"><span class="annottext">((PGCol -&gt; (ColumnAlias, SQLExp)) -&gt; [(ColumnAlias, SQLExp)])
-&gt; (PGCol -&gt; (ColumnAlias, SQLExp)) -&gt; [(ColumnAlias, SQLExp)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; ColumnAlias
</span><a href="#local-6989586621689680997"><span class="hs-identifier hs-var">mkQColAls</span></a></span><span> </span><span class="annot"><span class="annottext">(PGCol -&gt; ColumnAlias)
-&gt; (PGCol -&gt; SQLExp) -&gt; PGCol -&gt; (ColumnAlias, SQLExp)
forall (a :: * -&gt; * -&gt; *) b c c'.
Arrow a =&gt;
a b c -&gt; a b c' -&gt; a b (c, c')
</span><span class="hs-operator hs-var">&amp;&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; SQLExp
</span><a href="#local-6989586621689680996"><span class="hs-identifier hs-var">mkQCol</span></a></span><span>
</span><span id="line-284"></span></pre></body></html>