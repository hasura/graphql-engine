<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">-- | Defines the CE version of the engine.</span><span>
</span><span id="line-7"></span><span class="hs-comment">--</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- This module contains everything that is required to run the community edition</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- of the engine: the base application monad and the implementation of all its</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- behaviour classes.</span><span>
</span><span id="line-11"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.App</span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * top-level error handling</span></span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Hasura.App.html#ExitCode"><span class="hs-identifier">ExitCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Hasura.App.html#ExitException"><span class="hs-identifier">ExitException</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Hasura.App.html#throwErrExit"><span class="hs-identifier">throwErrExit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Hasura.App.html#throwErrJExit"><span class="hs-identifier">throwErrJExit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Hasura.App.html#accessDeniedErrMsg"><span class="hs-identifier">accessDeniedErrMsg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><span class="hs-comment">-- * printing helpers</span></span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Hasura.App.html#printJSON"><span class="hs-identifier">printJSON</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><span class="hs-comment">-- * logging</span></span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Hasura.App.html#mkLoggers"><span class="hs-identifier">mkLoggers</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Hasura.App.html#mkPGLogger"><span class="hs-identifier">mkPGLogger</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><span class="hs-comment">-- * basic connection info</span></span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="Hasura.App.html#BasicConnectionInfo"><span class="hs-identifier">BasicConnectionInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="Hasura.App.html#initMetadataConnectionInfo"><span class="hs-identifier">initMetadataConnectionInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="Hasura.App.html#initBasicConnectionInfo"><span class="hs-identifier">initBasicConnectionInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="Hasura.App.html#resolvePostgresConnInfo"><span class="hs-identifier">resolvePostgresConnInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><span class="hs-comment">-- * app init</span></span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><a href="Hasura.App.html#initialiseAppEnv"><span class="hs-identifier">initialiseAppEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="Hasura.App.html#initialiseAppContext"><span class="hs-identifier">initialiseAppContext</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="Hasura.App.html#migrateCatalogAndFetchMetadata"><span class="hs-identifier">migrateCatalogAndFetchMetadata</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="Hasura.App.html#buildFirstSchemaCache"><span class="hs-identifier">buildFirstSchemaCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><a href="Hasura.App.html#initSubscriptionsState"><span class="hs-identifier">initSubscriptionsState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><a href="Hasura.App.html#initLockedEventsCtx"><span class="hs-identifier">initLockedEventsCtx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><span class="hs-comment">-- * app monad</span></span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier">AppM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><a href="Hasura.App.html#runAppM"><span class="hs-identifier">runAppM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><span class="hs-comment">-- * misc</span></span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><a href="Hasura.App.html#getCatalogStateTx"><span class="hs-identifier">getCatalogStateTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><a href="Hasura.App.html#updateJwkCtxThread"><span class="hs-identifier">updateJwkCtxThread</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><a href="Hasura.App.html#notifySchemaCacheSyncTx"><span class="hs-identifier">notifySchemaCacheSyncTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><a href="Hasura.App.html#parseArgs"><span class="hs-identifier">parseArgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><a href="Hasura.App.html#runHGEServer"><span class="hs-identifier">runHGEServer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><a href="Hasura.App.html#setCatalogStateTx"><span class="hs-identifier">setCatalogStateTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><a href="Hasura.App.html#mkHGEServer"><span class="hs-identifier">mkHGEServer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="Hasura.App.html#mkPgSourceResolver"><span class="hs-identifier">mkPgSourceResolver</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><a href="Hasura.App.html#mkMSSQLSourceResolver"><span class="hs-identifier">mkMSSQLSourceResolver</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">where</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.Async.Lifted.Safe</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LA</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.Concurrent.Extended.html"><span class="hs-identifier">Control.Concurrent.Extended</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Concurrent.Extended.html#sleep"><span class="hs-identifier">sleep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.Concurrent.Extended.html"><span class="hs-identifier">Control.Concurrent.Extended</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/stm-2.5.0.2/src"><span class="hs-identifier">Control.Concurrent.STM</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/stm-2.5.0.2/src"><span class="hs-identifier">Control.Concurrent.STM</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">STM</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Control.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">bracket_</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">throwIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier">Control.Monad.Catch</span></a></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Exception</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier">MonadCatch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier">MonadMask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier">MonadThrow</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Morph</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hoist</span></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.Monad.Stateless.html"><span class="hs-identifier">Control.Monad.Stateless</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Control</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadBaseControl</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.Monad.Trans.Managed.html"><span class="hs-identifier">Control.Monad.Trans.Managed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Trans.Managed.html#ManagedT"><span class="hs-identifier">ManagedT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Monad.Trans.Managed.html#allocate"><span class="hs-identifier">allocate</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Monad.Trans.Managed.html#allocate_"><span class="hs-identifier">allocate_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Retry</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Retry</span></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">J</span></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/bytestring-0.11.3.1/src"><span class="hs-identifier">Data.ByteString.Char8</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BC</span></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/bytestring-0.11.3.1/src"><span class="hs-identifier">Data.ByteString.Lazy</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/bytestring-0.11.3.1/src"><span class="hs-identifier">Data.ByteString.Lazy.Char8</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BLC</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Environment</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Env</span></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.FileEmbed</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">makeRelativeToProject</span></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HashMap</span></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set.NonEmpty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/time-1.11.1.1/src"><span class="hs-identifier">Data.Time.Clock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/time-1.11.1.1/src"><span class="hs-identifier">UTCTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/time-1.11.1.1/src"><span class="hs-identifier">Data.Time.Clock</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Clock</span></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.MSSQL.Pool.html"><span class="hs-identifier">Database.MSSQL.Pool</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MSPool</span></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier">Database.PG.Query</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PG</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier">Database.PG.Query</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Q</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.AssertNF.CPP</span></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.App.State.html"><span class="hs-identifier">Hasura.App.State</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.MSSQL.Connection.html"><span class="hs-identifier">Hasura.Backends.MSSQL.Connection</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.html"><span class="hs-identifier">Hasura.Backends.Postgres.Connection</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hasura.Base.Error</span></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.ClientCredentials.html"><span class="hs-identifier">Hasura.ClientCredentials</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.ClientCredentials.html#getEEClientCredentialsTx"><span class="hs-identifier">getEEClientCredentialsTx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.ClientCredentials.html#setEEClientCredentialsTx"><span class="hs-identifier">setEEClientCredentialsTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Eventing.Backend.html"><span class="hs-identifier">Hasura.Eventing.Backend</span></a></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Eventing.Common.html"><span class="hs-identifier">Hasura.Eventing.Common</span></a></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Eventing.EventTrigger.html"><span class="hs-identifier">Hasura.Eventing.EventTrigger</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html"><span class="hs-identifier">Hasura.Eventing.ScheduledTrigger</span></a></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.html"><span class="hs-identifier">Hasura.GraphQL.Execute</span></a></span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Backend.html#ExecutionStep"><span class="hs-identifier">ExecutionStep</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier">MonadGQLExecutionCheck</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.html#checkQueryInAllowlist"><span class="hs-identifier">checkQueryInAllowlist</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Action.html"><span class="hs-identifier">Hasura.GraphQL.Execute.Action</span></a></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Action.Subscription.html"><span class="hs-identifier">Hasura.GraphQL.Execute.Action.Subscription</span></a></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.Poll.html"><span class="hs-identifier">Hasura.GraphQL.Execute.Subscription.Poll</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ES</span></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.State.html"><span class="hs-identifier">Hasura.GraphQL.Execute.Subscription.State</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ES</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Logging.html"><span class="hs-identifier">Hasura.GraphQL.Logging</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Logging.ExecutionLog.html#MonadExecutionLog"><span class="hs-identifier">MonadExecutionLog</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Logging.QueryLog.html#MonadQueryLog"><span class="hs-identifier">MonadQueryLog</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html"><span class="hs-identifier">Hasura.GraphQL.Transport.HTTP</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#CacheResult"><span class="hs-identifier">CacheResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier">MonadExecuteQuery</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html"><span class="hs-identifier">Hasura.GraphQL.Transport.HTTP.Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#toParsed"><span class="hs-identifier">toParsed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WSServerApp.html"><span class="hs-identifier">Hasura.GraphQL.Transport.WSServerApp</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WS</span></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Server.html"><span class="hs-identifier">Hasura.GraphQL.Transport.WebSocket.Server</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WS</span></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Types.html"><span class="hs-identifier">Hasura.GraphQL.Transport.WebSocket.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Types.html#WSServerEnv"><span class="hs-identifier">WSServerEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Logging.html"><span class="hs-identifier">Hasura.Logging</span></a></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Metadata.Class.html"><span class="hs-identifier">Hasura.Metadata.Class</span></a></span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.PingSources.html"><span class="hs-identifier">Hasura.PingSources</span></a></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier">Hasura.Prelude</span></a></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.QueryTags.html"><span class="hs-identifier">Hasura.QueryTags</span></a></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html"><span class="hs-identifier">Hasura.RQL.DDL.EventTrigger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier">MonadEventLogCleanup</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema.Cache</span></a></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema.Cache.Common</span></a></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema.Cache.Config</span></a></span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Catalog.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema.Catalog</span></a></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Allowlist.html"><span class="hs-identifier">Hasura.RQL.Types.Allowlist</span></a></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html"><span class="hs-identifier">Hasura.RQL.Types.Backend</span></a></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html"><span class="hs-identifier">Hasura.RQL.Types.BackendType</span></a></span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html"><span class="hs-identifier">Hasura.RQL.Types.Common</span></a></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html"><span class="hs-identifier">Hasura.RQL.Types.Metadata</span></a></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ResizePool.html"><span class="hs-identifier">Hasura.RQL.Types.ResizePool</span></a></span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Roles.html"><span class="hs-identifier">Hasura.RQL.Types.Roles</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Roles.html#adminRoleName"><span class="hs-identifier">adminRoleName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCache</span></a></span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCache.Build</span></a></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html"><span class="hs-identifier">Hasura.RQL.Types.Source</span></a></span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.AnyBackend.html"><span class="hs-identifier">Hasura.SQL.AnyBackend</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AB</span></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.API.Query.html"><span class="hs-identifier">Hasura.Server.API.Query</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.API.Query.html#requiresAdmin"><span class="hs-identifier">requiresAdmin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.App.html"><span class="hs-identifier">Hasura.Server.App</span></a></span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.AppStateRef.html"><span class="hs-identifier">Hasura.Server.AppStateRef</span></a></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Auth.html"><span class="hs-identifier">Hasura.Server.Auth</span></a></span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.CheckUpdates.html"><span class="hs-identifier">Hasura.Server.CheckUpdates</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.CheckUpdates.html#checkForUpdates"><span class="hs-identifier">checkForUpdates</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.html"><span class="hs-identifier">Hasura.Server.Init</span></a></span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Limits.html"><span class="hs-identifier">Hasura.Server.Limits</span></a></span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Logging.html"><span class="hs-identifier">Hasura.Server.Logging</span></a></span><span>
</span><span id="line-145"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Metrics.html"><span class="hs-identifier">Hasura.Server.Metrics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Metrics.html#ServerMetrics"><span class="hs-identifier">ServerMetrics</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Migrate.html"><span class="hs-identifier">Hasura.Server.Migrate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Migrate.html#migrateCatalog"><span class="hs-identifier">migrateCatalog</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Prometheus.html"><span class="hs-identifier">Hasura.Server.Prometheus</span></a></span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Server.Prometheus.html#PrometheusMetrics"><span class="hs-identifier">PrometheusMetrics</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><a href="Hasura.Server.Prometheus.html#decWarpThreads"><span class="hs-identifier">decWarpThreads</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><a href="Hasura.Server.Prometheus.html#incWarpThreads"><span class="hs-identifier">incWarpThreads</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.SchemaUpdate.html"><span class="hs-identifier">Hasura.Server.SchemaUpdate</span></a></span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Telemetry.html"><span class="hs-identifier">Hasura.Server.Telemetry</span></a></span><span>
</span><span id="line-154"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html"><span class="hs-identifier">Hasura.Server.Types</span></a></span><span>
</span><span id="line-155"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Version.html"><span class="hs-identifier">Hasura.Server.Version</span></a></span><span>
</span><span id="line-156"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Services.html"><span class="hs-identifier">Hasura.Services</span></a></span><span>
</span><span id="line-157"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Session.html"><span class="hs-identifier">Hasura.Session</span></a></span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.ShutdownLatch.html"><span class="hs-identifier">Hasura.ShutdownLatch</span></a></span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Tracing.html"><span class="hs-identifier">Hasura.Tracing</span></a></span><span>
</span><span id="line-160"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Client</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HTTP</span></span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Client.CreateManager</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mkHttpManager</span></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Types.Extended</span></span><span>
</span><span id="line-163"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Application</span></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai.Handler.Warp</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Warp</span></span><span>
</span><span id="line-165"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Options.Applicative</span></span><span>
</span><span id="line-166"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Refined</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unrefine</span></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Metrics</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EKG</span></span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Metrics.Gauge</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EKG.Gauge</span></span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Mustache.Compile</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-170"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Web.Spock.Core</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Spock</span></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- Error handling (move to another module!)</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-keyword">data</span><span> </span><span id="ExitCode"><span class="annot"><a href="Hasura.App.html#ExitCode"><span class="hs-identifier hs-var">ExitCode</span></a></span></span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- these are used during server initialization:</span><span>
</span><span id="line-177"></span><span>    </span><span id="InvalidEnvironmentVariableOptionsError"><span class="annot"><a href="Hasura.App.html#InvalidEnvironmentVariableOptionsError"><span class="hs-identifier hs-var">InvalidEnvironmentVariableOptionsError</span></a></span></span><span>
</span><span id="line-178"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="InvalidDatabaseConnectionParamsError"><span class="annot"><a href="Hasura.App.html#InvalidDatabaseConnectionParamsError"><span class="hs-identifier hs-var">InvalidDatabaseConnectionParamsError</span></a></span></span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="AuthConfigurationError"><span class="annot"><a href="Hasura.App.html#AuthConfigurationError"><span class="hs-identifier hs-var">AuthConfigurationError</span></a></span></span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="DatabaseMigrationError"><span class="annot"><a href="Hasura.App.html#DatabaseMigrationError"><span class="hs-identifier hs-var">DatabaseMigrationError</span></a></span></span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | used by MT because it initialises the schema cache only</span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-comment">-- these are used in app/Main.hs:</span><span>
</span><span id="line-183"></span><span>    </span><span id="SchemaCacheInitError"><span class="annot"><a href="Hasura.App.html#SchemaCacheInitError"><span class="hs-identifier hs-var">SchemaCacheInitError</span></a></span></span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MetadataExportError"><span class="annot"><a href="Hasura.App.html#MetadataExportError"><span class="hs-identifier hs-var">MetadataExportError</span></a></span></span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MetadataCleanError"><span class="annot"><a href="Hasura.App.html#MetadataCleanError"><span class="hs-identifier hs-var">MetadataCleanError</span></a></span></span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="DowngradeProcessError"><span class="annot"><a href="Hasura.App.html#DowngradeProcessError"><span class="hs-identifier hs-var">DowngradeProcessError</span></a></span></span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621691177570"><span id="local-6989586621691177572"><span id="local-6989586621691177574"><span class="annot"><span class="annottext">Int -&gt; ExitCode -&gt; ShowS
[ExitCode] -&gt; ShowS
ExitCode -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ExitCode] -&gt; ShowS
$cshowList :: [ExitCode] -&gt; ShowS
show :: ExitCode -&gt; String
$cshow :: ExitCode -&gt; String
showsPrec :: Int -&gt; ExitCode -&gt; ShowS
$cshowsPrec :: Int -&gt; ExitCode -&gt; ShowS
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-keyword">data</span><span> </span><span id="ExitException"><span class="annot"><a href="Hasura.App.html#ExitException"><span class="hs-identifier hs-var">ExitException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ExitException"><span class="annot"><a href="Hasura.App.html#ExitException"><span class="hs-identifier hs-var">ExitException</span></a></span></span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="eeCode"><span class="annot"><span class="annottext">ExitException -&gt; ExitCode
</span><a href="Hasura.App.html#eeCode"><span class="hs-identifier hs-var hs-var">eeCode</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.App.html#ExitCode"><span class="hs-identifier hs-type">ExitCode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-191"></span><span>    </span><span id="eeMessage"><span class="annot"><span class="annottext">ExitException -&gt; ByteString
</span><a href="Hasura.App.html#eeMessage"><span class="hs-identifier hs-var hs-var">eeMessage</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/bytestring-0.11.3.1/src"><span class="hs-identifier hs-type">BC.ByteString</span></a></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621691177555"><span id="local-6989586621691177557"><span id="local-6989586621691177564"><span class="annot"><span class="annottext">Int -&gt; ExitException -&gt; ShowS
[ExitException] -&gt; ShowS
ExitException -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ExitException] -&gt; ShowS
$cshowList :: [ExitException] -&gt; ShowS
show :: ExitException -&gt; String
$cshow :: ExitException -&gt; String
showsPrec :: Int -&gt; ExitException -&gt; ShowS
$cshowsPrec :: Int -&gt; ExitException -&gt; ShowS
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621691177545"><span id="local-6989586621691177547"><span id="local-6989586621691177549"><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Exception</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#ExitException"><span class="hs-identifier hs-type">ExitException</span></a></span></span></span></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span id="local-6989586621691178618"><span class="annot"><a href="Hasura.App.html#throwErrExit"><span class="hs-identifier hs-type">throwErrExit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178618"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621691178617"><span class="annot"><a href="#local-6989586621691178617"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Hasura.App.html#ExitCode"><span class="hs-identifier hs-type">ExitCode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621691178618"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178617"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-198"></span><span id="throwErrExit"><span class="annot"><span class="annottext">throwErrExit :: forall (m :: * -&gt; *) a. MonadIO m =&gt; ExitCode -&gt; String -&gt; m a
</span><a href="Hasura.App.html#throwErrExit"><span class="hs-identifier hs-var hs-var">throwErrExit</span></a></span></span><span> </span><span id="local-6989586621691177540"><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621691177540"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode -&gt; ByteString -&gt; ExitException
</span><a href="Hasura.App.html#ExitException"><span class="hs-identifier hs-var">ExitException</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621691177540"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/bytestring-0.11.3.1/src"><span class="hs-identifier hs-var">BC.pack</span></a></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span id="local-6989586621691178606"><span id="local-6989586621691178607"><span class="annot"><a href="Hasura.App.html#throwErrJExit"><span class="hs-identifier hs-type">throwErrJExit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">J.ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621691178607"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178606"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621691178605"><span class="annot"><a href="#local-6989586621691178605"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Hasura.App.html#ExitCode"><span class="hs-identifier hs-type">ExitCode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621691178607"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621691178606"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178605"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-201"></span><span id="throwErrJExit"><span class="annot"><span class="annottext">throwErrJExit :: forall a (m :: * -&gt; *) b.
(ToJSON a, MonadIO m) =&gt;
ExitCode -&gt; a -&gt; m b
</span><a href="Hasura.App.html#throwErrJExit"><span class="hs-identifier hs-var hs-var">throwErrJExit</span></a></span></span><span> </span><span id="local-6989586621691177531"><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621691177531"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode -&gt; ByteString -&gt; ExitException
</span><a href="Hasura.App.html#ExitException"><span class="hs-identifier hs-var">ExitException</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621691177531"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/bytestring-0.11.3.1/src"><span class="hs-identifier hs-var">BLC.toStrict</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">J.encode</span></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="annot"><a href="Hasura.App.html#accessDeniedErrMsg"><span class="hs-identifier hs-type">accessDeniedErrMsg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-204"></span><span id="accessDeniedErrMsg"><span class="annot"><span class="annottext">accessDeniedErrMsg :: Text
</span><a href="Hasura.App.html#accessDeniedErrMsg"><span class="hs-identifier hs-var hs-var">accessDeniedErrMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;restricted access : admin only&quot;</span></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- Printing helpers (move to another module!)</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span id="local-6989586621691178598"><span id="local-6989586621691178599"><span class="annot"><a href="Hasura.App.html#printJSON"><span class="hs-identifier hs-type">printJSON</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">J.ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621691178599"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621691178599"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621691178598"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-210"></span><span id="printJSON"><span class="annot"><span class="annottext">printJSON :: forall a (m :: * -&gt; *). (ToJSON a, MonadIO m) =&gt; a -&gt; m ()
</span><a href="Hasura.App.html#printJSON"><span class="hs-identifier hs-var hs-var">printJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ()
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/bytestring-0.11.3.1/src"><span class="hs-identifier hs-var">BLC.putStrLn</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">J.encode</span></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- Logging</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="annot"><a href="Hasura.App.html#mkPGLogger"><span class="hs-identifier hs-type">mkPGLogger</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.PGLogger</span></a></span><span>
</span><span id="line-216"></span><span id="mkPGLogger"><span class="annot"><span class="annottext">mkPGLogger :: Logger Hasura -&gt; PGLogger
</span><a href="Hasura.App.html#mkPGLogger"><span class="hs-identifier hs-var hs-var">mkPGLogger</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span id="local-6989586621691177522"><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621691177522"><span class="hs-identifier hs-var">logger</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.PLERetryMsg</span></a></span><span> </span><span id="local-6989586621691177520"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691177520"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621691177522"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel -&gt; Text -&gt; PGLog
</span><a href="Hasura.Server.Logging.html#PGLog"><span class="hs-identifier hs-var">PGLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelWarn"><span class="hs-identifier hs-var">LevelWarn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691177520"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="hs-comment">-- | Create all loggers based on the set of enabled logs and chosen log level.</span><span>
</span><span id="line-219"></span><span id="local-6989586621691178586"><span class="annot"><a href="Hasura.App.html#mkLoggers"><span class="hs-identifier hs-type">mkLoggers</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178586"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178586"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-221"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HashSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#EngineLogType"><span class="hs-identifier hs-type">EngineLogType</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-222"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#LogLevel"><span class="hs-identifier hs-type">LogLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-223"></span><span>  </span><span class="annot"><a href="Control.Monad.Trans.Managed.html#ManagedT"><span class="hs-identifier hs-type">ManagedT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178586"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.App.State.html#Loggers"><span class="hs-identifier hs-type">Loggers</span></a></span></span><span>
</span><span id="line-224"></span><span id="mkLoggers"><span class="annot"><span class="annottext">mkLoggers :: forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m) =&gt;
HashSet (EngineLogType Hasura) -&gt; LogLevel -&gt; ManagedT m Loggers
</span><a href="Hasura.App.html#mkLoggers"><span class="hs-identifier hs-var hs-var">mkLoggers</span></a></span></span><span> </span><span id="local-6989586621691177507"><span class="annot"><span class="annottext">HashSet (EngineLogType Hasura)
</span><a href="#local-6989586621691177507"><span class="hs-identifier hs-var">enabledLogs</span></a></span></span><span> </span><span id="local-6989586621691177506"><span class="annot"><span class="annottext">LogLevel
</span><a href="#local-6989586621691177506"><span class="hs-identifier hs-var">logLevel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-225"></span><span>  </span><span id="local-6989586621691177505"><span class="annot"><span class="annottext">LoggerCtx Hasura
</span><a href="#local-6989586621691177505"><span class="hs-identifier hs-var">loggerCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (io :: * -&gt; *) impl.
(MonadIO io, MonadBaseControl IO io) =&gt;
LoggerSettings
-&gt; HashSet (EngineLogType impl) -&gt; ManagedT io (LoggerCtx impl)
</span><a href="Hasura.Logging.html#mkLoggerCtx"><span class="hs-identifier hs-var">mkLoggerCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; LogLevel -&gt; LoggerSettings
</span><a href="Hasura.Logging.html#defaultLoggerSettings"><span class="hs-identifier hs-var">defaultLoggerSettings</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="#local-6989586621691177506"><span class="hs-identifier hs-var">logLevel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashSet (EngineLogType Hasura)
</span><a href="#local-6989586621691177507"><span class="hs-identifier hs-var">enabledLogs</span></a></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621691177502"><span class="annot"><span class="annottext">logger :: Logger Hasura
</span><a href="#local-6989586621691177502"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall impl.
ToJSON (EngineLogType impl) =&gt;
LoggerCtx impl -&gt; Logger impl
</span><a href="Hasura.Logging.html#mkLogger"><span class="hs-identifier hs-var">mkLogger</span></a></span><span> </span><span class="annot"><span class="annottext">LoggerCtx Hasura
</span><a href="#local-6989586621691177505"><span class="hs-identifier hs-var">loggerCtx</span></a></span><span>
</span><span id="line-227"></span><span>      </span><span id="local-6989586621691177500"><span class="annot"><span class="annottext">pgLogger :: PGLogger
</span><a href="#local-6989586621691177500"><span class="hs-identifier hs-var hs-var">pgLogger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger Hasura -&gt; PGLogger
</span><a href="Hasura.App.html#mkPGLogger"><span class="hs-identifier hs-var">mkPGLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691177502"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-228"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LoggerCtx Hasura -&gt; Logger Hasura -&gt; PGLogger -&gt; Loggers
</span><a href="Hasura.App.State.html#Loggers"><span class="hs-identifier hs-var">Loggers</span></a></span><span> </span><span class="annot"><span class="annottext">LoggerCtx Hasura
</span><a href="#local-6989586621691177505"><span class="hs-identifier hs-var">loggerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691177502"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">PGLogger
</span><a href="#local-6989586621691177500"><span class="hs-identifier hs-var">pgLogger</span></a></span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-231"></span><span class="hs-comment">-- Basic connection info</span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span class="hs-comment">-- | Basic information required to connect to the metadata DB, and to the</span><span>
</span><span id="line-234"></span><span class="hs-comment">-- default Postgres DB if any.</span><span>
</span><span id="line-235"></span><span class="hs-keyword">data</span><span> </span><span id="BasicConnectionInfo"><span class="annot"><a href="Hasura.App.html#BasicConnectionInfo"><span class="hs-identifier hs-var">BasicConnectionInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BasicConnectionInfo"><span class="annot"><a href="Hasura.App.html#BasicConnectionInfo"><span class="hs-identifier hs-var">BasicConnectionInfo</span></a></span></span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- | metadata db connection info</span><span>
</span><span id="line-237"></span><span>    </span><span id="bciMetadataConnInfo"><span class="annot"><span class="annottext">BasicConnectionInfo -&gt; ConnInfo
</span><a href="Hasura.App.html#bciMetadataConnInfo"><span class="hs-identifier hs-var hs-var">bciMetadataConnInfo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.ConnInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-comment">-- | default postgres connection info, if any</span><span>
</span><span id="line-239"></span><span>    </span><span id="bciDefaultPostgres"><span class="annot"><span class="annottext">BasicConnectionInfo -&gt; Maybe PostgresConnConfiguration
</span><a href="Hasura.App.html#bciDefaultPostgres"><span class="hs-identifier hs-var hs-var">bciDefaultPostgres</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.Settings.html#PostgresConnConfiguration"><span class="hs-identifier hs-type">PostgresConnConfiguration</span></a></span><span>
</span><span id="line-240"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="hs-comment">-- | Only create the metadata connection info.</span><span>
</span><span id="line-243"></span><span class="hs-comment">--</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- Like 'initBasicConnectionInfo', it prioritizes @--metadata-database-url@, and</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- falls back to @--database-url@ otherwise.</span><span>
</span><span id="line-246"></span><span class="hs-comment">--</span><span>
</span><span id="line-247"></span><span class="hs-comment">-- !!! This function throws a fatal error if the @--database-url@ cannot be</span><span>
</span><span id="line-248"></span><span class="hs-comment">-- !!! resolved.</span><span>
</span><span id="line-249"></span><span id="local-6989586621691178568"><span class="annot"><a href="Hasura.App.html#initMetadataConnectionInfo"><span class="hs-identifier hs-type">initMetadataConnectionInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178568"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-251"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Env.Environment</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-comment">-- | metadata DB URL (--metadata-database-url)</span><span>
</span><span id="line-253"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-comment">-- | user's DB URL (--database-url)</span><span>
</span><span id="line-255"></span><span>  </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresConnInfo"><span class="hs-identifier hs-type">PostgresConnInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#UrlConf"><span class="hs-identifier hs-type">UrlConf</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-256"></span><span>  </span><span class="annot"><a href="#local-6989586621691178568"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.ConnInfo</span></a></span></span><span>
</span><span id="line-257"></span><span id="initMetadataConnectionInfo"><span class="annot"><span class="annottext">initMetadataConnectionInfo :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Environment
-&gt; Maybe String -&gt; PostgresConnInfo (Maybe UrlConf) -&gt; m ConnInfo
</span><a href="Hasura.App.html#initMetadataConnectionInfo"><span class="hs-identifier hs-var hs-var">initMetadataConnectionInfo</span></a></span></span><span> </span><span id="local-6989586621691177486"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691177486"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621691177485"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621691177485"><span class="hs-identifier hs-var">metadataDbURL</span></a></span></span><span> </span><span id="local-6989586621691177484"><span class="annot"><span class="annottext">PostgresConnInfo (Maybe UrlConf)
</span><a href="#local-6989586621691177484"><span class="hs-identifier hs-var">dbURL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-258"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">BasicConnectionInfo -&gt; ConnInfo
</span><a href="Hasura.App.html#bciMetadataConnInfo"><span class="hs-identifier hs-var">bciMetadataConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-259"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
Environment
-&gt; Maybe String
-&gt; PostgresConnInfo (Maybe UrlConf)
-&gt; Maybe PostgresPoolSettings
-&gt; Bool
-&gt; TxIsolation
-&gt; m BasicConnectionInfo
</span><a href="Hasura.App.html#initBasicConnectionInfo"><span class="hs-identifier hs-var">initBasicConnectionInfo</span></a></span><span>
</span><span id="line-260"></span><span>      </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691177486"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-261"></span><span>      </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621691177485"><span class="hs-identifier hs-var">metadataDbURL</span></a></span><span>
</span><span id="line-262"></span><span>      </span><span class="annot"><span class="annottext">PostgresConnInfo (Maybe UrlConf)
</span><a href="#local-6989586621691177484"><span class="hs-identifier hs-var">dbURL</span></a></span><span>
</span><span id="line-263"></span><span>      </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-comment">-- ignored</span><span>
</span><span id="line-264"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-comment">-- ignored</span><span>
</span><span id="line-265"></span><span>      </span><span class="annot"><span class="annottext">TxIsolation
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.ReadCommitted</span></a></span><span> </span><span class="hs-comment">-- ignored</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="hs-comment">-- | Create a 'BasicConnectionInfo' based on the given options.</span><span>
</span><span id="line-268"></span><span class="hs-comment">--</span><span>
</span><span id="line-269"></span><span class="hs-comment">-- The default postgres connection is only created when the @--database-url@</span><span>
</span><span id="line-270"></span><span class="hs-comment">-- option is given. If the @--metadata-database-url@ isn't given, the</span><span>
</span><span id="line-271"></span><span class="hs-comment">-- @--database-url@ will be used for the metadata connection.</span><span>
</span><span id="line-272"></span><span class="hs-comment">--</span><span>
</span><span id="line-273"></span><span class="hs-comment">-- All arguments related to the default postgres connection are ignored if the</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- @--database-url@ is missing.</span><span>
</span><span id="line-275"></span><span class="hs-comment">--</span><span>
</span><span id="line-276"></span><span class="hs-comment">-- !!! This function throws a fatal error if the @--database-url@ cannot be</span><span>
</span><span id="line-277"></span><span class="hs-comment">-- !!! resolved.</span><span>
</span><span id="line-278"></span><span id="local-6989586621691178559"><span class="annot"><a href="Hasura.App.html#initBasicConnectionInfo"><span class="hs-identifier hs-type">initBasicConnectionInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178559"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-280"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Env.Environment</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-comment">-- | metadata DB URL (--metadata-database-url)</span><span>
</span><span id="line-282"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-283"></span><span>  </span><span class="hs-comment">-- | user's DB URL (--database-url)</span><span>
</span><span id="line-284"></span><span>  </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresConnInfo"><span class="hs-identifier hs-type">PostgresConnInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#UrlConf"><span class="hs-identifier hs-type">UrlConf</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-comment">-- | pool settings of the default PG connection</span><span>
</span><span id="line-286"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.Settings.html#PostgresPoolSettings"><span class="hs-identifier hs-type">PostgresPoolSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-comment">-- | whether the default PG config should use prepared statements</span><span>
</span><span id="line-288"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-comment">-- | default transaction isolation level</span><span>
</span><span id="line-290"></span><span>  </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.TxIsolation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-291"></span><span>  </span><span class="annot"><a href="#local-6989586621691178559"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#BasicConnectionInfo"><span class="hs-identifier hs-type">BasicConnectionInfo</span></a></span></span><span>
</span><span id="line-292"></span><span id="initBasicConnectionInfo"><span class="annot"><span class="annottext">initBasicConnectionInfo :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Environment
-&gt; Maybe String
-&gt; PostgresConnInfo (Maybe UrlConf)
-&gt; Maybe PostgresPoolSettings
-&gt; Bool
-&gt; TxIsolation
-&gt; m BasicConnectionInfo
</span><a href="Hasura.App.html#initBasicConnectionInfo"><span class="hs-identifier hs-var hs-var">initBasicConnectionInfo</span></a></span></span><span>
</span><span id="line-293"></span><span>  </span><span id="local-6989586621691177465"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691177465"><span class="hs-identifier hs-var">env</span></a></span></span><span>
</span><span id="line-294"></span><span>  </span><span id="local-6989586621691177464"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621691177464"><span class="hs-identifier hs-var">metadataDbUrl</span></a></span></span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresConnInfo"><span class="hs-identifier hs-type">PostgresConnInfo</span></a></span><span> </span><span id="local-6989586621691177462"><span class="annot"><span class="annottext">Maybe UrlConf
</span><a href="#local-6989586621691177462"><span class="hs-identifier hs-var">dbUrlConf</span></a></span></span><span> </span><span id="local-6989586621691177461"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621691177461"><span class="hs-identifier hs-var">maybeRetries</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>  </span><span id="local-6989586621691177460"><span class="annot"><span class="annottext">Maybe PostgresPoolSettings
</span><a href="#local-6989586621691177460"><span class="hs-identifier hs-var">poolSettings</span></a></span></span><span>
</span><span id="line-297"></span><span>  </span><span id="local-6989586621691177459"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621691177459"><span class="hs-identifier hs-var">usePreparedStatements</span></a></span></span><span>
</span><span id="line-298"></span><span>  </span><span id="local-6989586621691177458"><span class="annot"><span class="annottext">TxIsolation
</span><a href="#local-6989586621691177458"><span class="hs-identifier hs-var">isolationLevel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-299"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621691177464"><span class="hs-identifier hs-var">metadataDbUrl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe UrlConf
</span><a href="#local-6989586621691177462"><span class="hs-identifier hs-var">dbUrlConf</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-300"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe String
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe UrlConf
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-301"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; ExitCode -&gt; String -&gt; m a
</span><a href="Hasura.App.html#throwErrExit"><span class="hs-identifier hs-var">throwErrExit</span></a></span><span>
</span><span id="line-302"></span><span>          </span><span class="annot"><span class="annottext">ExitCode
</span><a href="Hasura.App.html#InvalidDatabaseConnectionParamsError"><span class="hs-identifier hs-var">InvalidDatabaseConnectionParamsError</span></a></span><span>
</span><span id="line-303"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Fatal Error: Either of --metadata-database-url or --database-url option expected&quot;</span></span><span>
</span><span id="line-304"></span><span>      </span><span class="hs-comment">-- If no metadata storage specified consider use default database as</span><span>
</span><span id="line-305"></span><span>      </span><span class="hs-comment">-- metadata storage</span><span>
</span><span id="line-306"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe String
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621691177457"><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621691177457"><span class="hs-identifier hs-var">srcURL</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-307"></span><span>        </span><span id="local-6989586621691177456"><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621691177456"><span class="hs-identifier hs-var">srcConnInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
Environment -&gt; UrlConf -&gt; Maybe Int -&gt; m ConnInfo
</span><a href="Hasura.App.html#resolvePostgresConnInfo"><span class="hs-identifier hs-var">resolvePostgresConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691177465"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621691177457"><span class="hs-identifier hs-var">srcURL</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621691177461"><span class="hs-identifier hs-var">maybeRetries</span></a></span><span>
</span><span id="line-308"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo -&gt; Maybe PostgresConnConfiguration -&gt; BasicConnectionInfo
</span><a href="Hasura.App.html#BasicConnectionInfo"><span class="hs-identifier hs-var">BasicConnectionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621691177456"><span class="hs-identifier hs-var">srcConnInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UrlConf -&gt; PostgresConnConfiguration
</span><a href="#local-6989586621691177455"><span class="hs-identifier hs-var">mkSourceConfig</span></a></span><span> </span><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621691177457"><span class="hs-identifier hs-var">srcURL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621691177454"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621691177454"><span class="hs-identifier hs-var">mdURL</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe UrlConf
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-310"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo -&gt; Maybe PostgresConnConfiguration -&gt; BasicConnectionInfo
</span><a href="Hasura.App.html#BasicConnectionInfo"><span class="hs-identifier hs-var">BasicConnectionInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ConnInfo
</span><a href="#local-6989586621691177453"><span class="hs-identifier hs-var">mkConnInfoFromMDB</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621691177454"><span class="hs-identifier hs-var">mdURL</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-311"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621691177452"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621691177452"><span class="hs-identifier hs-var">mdURL</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621691177451"><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621691177451"><span class="hs-identifier hs-var">srcURL</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-312"></span><span>        </span><span id="local-6989586621691177450"><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621691177450"><span class="hs-identifier hs-var">_srcConnInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
Environment -&gt; UrlConf -&gt; Maybe Int -&gt; m ConnInfo
</span><a href="Hasura.App.html#resolvePostgresConnInfo"><span class="hs-identifier hs-var">resolvePostgresConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691177465"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621691177451"><span class="hs-identifier hs-var">srcURL</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621691177461"><span class="hs-identifier hs-var">maybeRetries</span></a></span><span>
</span><span id="line-313"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo -&gt; Maybe PostgresConnConfiguration -&gt; BasicConnectionInfo
</span><a href="Hasura.App.html#BasicConnectionInfo"><span class="hs-identifier hs-var">BasicConnectionInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ConnInfo
</span><a href="#local-6989586621691177453"><span class="hs-identifier hs-var">mkConnInfoFromMDB</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621691177452"><span class="hs-identifier hs-var">mdURL</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UrlConf -&gt; PostgresConnConfiguration
</span><a href="#local-6989586621691177455"><span class="hs-identifier hs-var">mkSourceConfig</span></a></span><span> </span><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621691177451"><span class="hs-identifier hs-var">srcURL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-315"></span><span>      </span><span id="local-6989586621691177453"><span class="annot"><span class="annottext">mkConnInfoFromMDB :: String -&gt; ConnInfo
</span><a href="#local-6989586621691177453"><span class="hs-identifier hs-var hs-var">mkConnInfoFromMDB</span></a></span></span><span> </span><span id="local-6989586621691177449"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621691177449"><span class="hs-identifier hs-var">mdbURL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-316"></span><span>        </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.ConnInfo</span></a></span><span>
</span><span id="line-317"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ciRetries :: Int
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.ciRetries</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621691177461"><span class="hs-identifier hs-var">maybeRetries</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-318"></span><span>            </span><span class="annot"><span class="annottext">ciDetails :: ConnDetails
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.ciDetails</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ConnDetails
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.CDDatabaseURI</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">txtToBs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621691177449"><span class="hs-identifier hs-var">mdbURL</span></a></span><span>
</span><span id="line-319"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-320"></span><span>      </span><span id="local-6989586621691177455"><span class="annot"><span class="annottext">mkSourceConfig :: UrlConf -&gt; PostgresConnConfiguration
</span><a href="#local-6989586621691177455"><span class="hs-identifier hs-var hs-var">mkSourceConfig</span></a></span></span><span> </span><span id="local-6989586621691177441"><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621691177441"><span class="hs-identifier hs-var">srcURL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-321"></span><span>        </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.Settings.html#PostgresConnConfiguration"><span class="hs-identifier hs-type">PostgresConnConfiguration</span></a></span><span>
</span><span id="line-322"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_pccConnectionInfo :: PostgresSourceConnInfo
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_pccConnectionInfo"><span class="hs-identifier hs-var">_pccConnectionInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-323"></span><span>              </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.Settings.html#PostgresSourceConnInfo"><span class="hs-identifier hs-type">PostgresSourceConnInfo</span></a></span><span>
</span><span id="line-324"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_psciDatabaseUrl :: UrlConf
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_psciDatabaseUrl"><span class="hs-identifier hs-var">_psciDatabaseUrl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621691177441"><span class="hs-identifier hs-var">srcURL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-325"></span><span>                  </span><span class="annot"><span class="annottext">_psciPoolSettings :: Maybe PostgresPoolSettings
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_psciPoolSettings"><span class="hs-identifier hs-var">_psciPoolSettings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe PostgresPoolSettings
</span><a href="#local-6989586621691177460"><span class="hs-identifier hs-var">poolSettings</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-326"></span><span>                  </span><span class="annot"><span class="annottext">_psciUsePreparedStatements :: Bool
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_psciUsePreparedStatements"><span class="hs-identifier hs-var">_psciUsePreparedStatements</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621691177459"><span class="hs-identifier hs-var">usePreparedStatements</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-327"></span><span>                  </span><span class="annot"><span class="annottext">_psciIsolationLevel :: TxIsolation
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_psciIsolationLevel"><span class="hs-identifier hs-var">_psciIsolationLevel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIsolation
</span><a href="#local-6989586621691177458"><span class="hs-identifier hs-var">isolationLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-328"></span><span>                  </span><span class="annot"><span class="annottext">_psciSslConfiguration :: Maybe (PGClientCerts CertVar CertVar)
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_psciSslConfiguration"><span class="hs-identifier hs-var">_psciSslConfiguration</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-329"></span><span>                </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-330"></span><span>            </span><span class="annot"><span class="annottext">_pccReadReplicas :: Maybe (NonEmpty PostgresSourceConnInfo)
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_pccReadReplicas"><span class="hs-identifier hs-var">_pccReadReplicas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-331"></span><span>            </span><span class="annot"><span class="annottext">_pccExtensionsSchema :: ExtensionsSchema
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_pccExtensionsSchema"><span class="hs-identifier hs-var">_pccExtensionsSchema</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExtensionsSchema
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#defaultPostgresExtensionsSchema"><span class="hs-identifier hs-var">defaultPostgresExtensionsSchema</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-332"></span><span>            </span><span class="annot"><span class="annottext">_pccConnectionTemplate :: Maybe ConnectionTemplate
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_pccConnectionTemplate"><span class="hs-identifier hs-var">_pccConnectionTemplate</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-333"></span><span>            </span><span class="annot"><span class="annottext">_pccConnectionSet :: Maybe PostgresConnectionSet
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_pccConnectionSet"><span class="hs-identifier hs-var">_pccConnectionSet</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-334"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span class="hs-comment">-- | Creates a 'PG.ConnInfo' from a 'UrlConf' parameter.</span><span>
</span><span id="line-337"></span><span class="hs-comment">--</span><span>
</span><span id="line-338"></span><span class="hs-comment">-- !!! throws a fatal error if the configuration is invalid</span><span>
</span><span id="line-339"></span><span id="local-6989586621691178552"><span class="annot"><a href="Hasura.App.html#resolvePostgresConnInfo"><span class="hs-identifier hs-type">resolvePostgresConnInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-340"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178552"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-341"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Env.Environment</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-342"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#UrlConf"><span class="hs-identifier hs-type">UrlConf</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-343"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-344"></span><span>  </span><span class="annot"><a href="#local-6989586621691178552"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.ConnInfo</span></a></span></span><span>
</span><span id="line-345"></span><span id="resolvePostgresConnInfo"><span class="annot"><span class="annottext">resolvePostgresConnInfo :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Environment -&gt; UrlConf -&gt; Maybe Int -&gt; m ConnInfo
</span><a href="Hasura.App.html#resolvePostgresConnInfo"><span class="hs-identifier hs-var hs-var">resolvePostgresConnInfo</span></a></span></span><span> </span><span id="local-6989586621691177414"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691177414"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621691177413"><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621691177413"><span class="hs-identifier hs-var">dbUrlConf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621691177412"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621691177412"><span class="hs-identifier hs-var">retries</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-346"></span><span>  </span><span id="local-6989586621691177411"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691177411"><span class="hs-identifier hs-var">dbUrlText</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-347"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadError QErr m =&gt;
Environment -&gt; UrlConf -&gt; m Text
</span><a href="Hasura.RQL.Types.Common.html#resolveUrlConf"><span class="hs-identifier hs-var">resolveUrlConf</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691177414"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621691177413"><span class="hs-identifier hs-var">dbUrlConf</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-operator hs-var">`onLeft`</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621691177408"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621691177408"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-348"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *) b.
(ToJSON a, MonadIO m) =&gt;
ExitCode -&gt; a -&gt; m b
</span><a href="Hasura.App.html#throwErrJExit"><span class="hs-identifier hs-var">throwErrJExit</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="Hasura.App.html#InvalidDatabaseConnectionParamsError"><span class="hs-identifier hs-var">InvalidDatabaseConnectionParamsError</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621691177408"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ConnDetails -&gt; ConnInfo
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.ConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621691177412"><span class="hs-identifier hs-var">retries</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ConnDetails
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.CDDatabaseURI</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">txtToBs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691177411"><span class="hs-identifier hs-var">dbUrlText</span></a></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-352"></span><span class="hs-comment">-- App init</span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span class="hs-comment">-- | The initialisation of the app is split into several functions, for clarity;</span><span>
</span><span id="line-355"></span><span class="hs-comment">-- but there are several pieces of information that need to be threaded across</span><span>
</span><span id="line-356"></span><span class="hs-comment">-- those initialisation functions. This small data structure groups together all</span><span>
</span><span id="line-357"></span><span class="hs-comment">-- such pieces of information that are required throughout the initialisation,</span><span>
</span><span id="line-358"></span><span class="hs-comment">-- but that aren't needed in the rest of the application.</span><span>
</span><span id="line-359"></span><span class="hs-keyword">data</span><span> </span><span id="AppInit"><span class="annot"><a href="Hasura.App.html#AppInit"><span class="hs-identifier hs-var">AppInit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AppInit"><span class="annot"><a href="Hasura.App.html#AppInit"><span class="hs-identifier hs-var">AppInit</span></a></span></span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="aiTLSAllowListRef"><span class="annot"><span class="annottext">AppInit -&gt; TLSAllowListRef
</span><a href="Hasura.App.html#aiTLSAllowListRef"><span class="hs-identifier hs-var hs-var">aiTLSAllowListRef</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Server.AppStateRef.html#TLSAllowListRef"><span class="hs-identifier hs-type">TLSAllowListRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-361"></span><span>    </span><span id="aiMetadataWithResourceVersion"><span class="annot"><span class="annottext">AppInit -&gt; MetadataWithResourceVersion
</span><a href="Hasura.App.html#aiMetadataWithResourceVersion"><span class="hs-identifier hs-var hs-var">aiMetadataWithResourceVersion</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#MetadataWithResourceVersion"><span class="hs-identifier hs-type">MetadataWithResourceVersion</span></a></span><span>
</span><span id="line-362"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span class="hs-comment">-- | Initializes or migrates the catalog and creates the 'AppEnv' required to</span><span>
</span><span id="line-365"></span><span class="hs-comment">-- start the server, and also create the 'AppInit' that needs to be threaded</span><span>
</span><span id="line-366"></span><span class="hs-comment">-- along the init code.</span><span>
</span><span id="line-367"></span><span class="hs-comment">--</span><span>
</span><span id="line-368"></span><span class="hs-comment">-- For historical reasons, this function performs a few additional startup tasks</span><span>
</span><span id="line-369"></span><span class="hs-comment">-- that are not required to create the 'AppEnv', such as starting background</span><span>
</span><span id="line-370"></span><span class="hs-comment">-- processes and logging startup information. All of those are flagged with a</span><span>
</span><span id="line-371"></span><span class="hs-comment">-- comment marking them as a side-effect.</span><span>
</span><span id="line-372"></span><span id="local-6989586621691178534"><span class="annot"><a href="Hasura.App.html#initialiseAppEnv"><span class="hs-identifier hs-type">initialiseAppEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Control.Concurrent.Extended.html#ForkableMonadIO"><span class="hs-identifier hs-type">C.ForkableMonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178534"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-374"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Env.Environment</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-375"></span><span>  </span><span class="annot"><a href="Hasura.App.html#BasicConnectionInfo"><span class="hs-identifier hs-type">BasicConnectionInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-376"></span><span>  </span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptions"><span class="hs-identifier hs-type">ServeOptions</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-377"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.Poll.Common.html#SubscriptionPostPollHook"><span class="hs-identifier hs-type">ES.SubscriptionPostPollHook</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-378"></span><span>  </span><span class="annot"><a href="Hasura.Server.Metrics.html#ServerMetrics"><span class="hs-identifier hs-type">ServerMetrics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-379"></span><span>  </span><span class="annot"><a href="Hasura.Server.Prometheus.html#PrometheusMetrics"><span class="hs-identifier hs-type">PrometheusMetrics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-380"></span><span>  </span><span class="annot"><a href="Hasura.Tracing.Sampling.html#SamplingPolicy"><span class="hs-identifier hs-type">SamplingPolicy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-381"></span><span>  </span><span class="annot"><a href="Control.Monad.Trans.Managed.html#ManagedT"><span class="hs-identifier hs-type">ManagedT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178534"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#AppInit"><span class="hs-identifier hs-type">AppInit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">AppEnv</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-382"></span><span id="initialiseAppEnv"><span class="annot"><span class="annottext">initialiseAppEnv :: forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
Environment
-&gt; BasicConnectionInfo
-&gt; ServeOptions Hasura
-&gt; Maybe SubscriptionPostPollHook
-&gt; ServerMetrics
-&gt; PrometheusMetrics
-&gt; SamplingPolicy
-&gt; ManagedT m (AppInit, AppEnv)
</span><a href="Hasura.App.html#initialiseAppEnv"><span class="hs-identifier hs-var hs-var">initialiseAppEnv</span></a></span></span><span> </span><span id="local-6989586621691177328"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691177328"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="annot"><a href="Hasura.App.html#BasicConnectionInfo"><span class="hs-identifier hs-type">BasicConnectionInfo</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621691177326"><span id="local-6989586621691177327"><span class="annot"><span class="annottext">Maybe PostgresConnConfiguration
ConnInfo
bciDefaultPostgres :: Maybe PostgresConnConfiguration
bciMetadataConnInfo :: ConnInfo
bciDefaultPostgres :: BasicConnectionInfo -&gt; Maybe PostgresConnConfiguration
bciMetadataConnInfo :: BasicConnectionInfo -&gt; ConnInfo
</span><a href="#local-6989586621691177326"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621691177325"><span class="annot"><span class="annottext">serveOptions :: ServeOptions Hasura
</span><a href="#local-6989586621691177325"><span class="hs-identifier hs-var">serveOptions</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptions"><span class="hs-identifier hs-type">ServeOptions</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621691177281"><span id="local-6989586621691177282"><span id="local-6989586621691177283"><span id="local-6989586621691177284"><span id="local-6989586621691177285"><span id="local-6989586621691177286"><span id="local-6989586621691177287"><span id="local-6989586621691177288"><span id="local-6989586621691177289"><span id="local-6989586621691177290"><span id="local-6989586621691177291"><span id="local-6989586621691177292"><span id="local-6989586621691177293"><span id="local-6989586621691177294"><span id="local-6989586621691177295"><span id="local-6989586621691177296"><span id="local-6989586621691177297"><span id="local-6989586621691177298"><span id="local-6989586621691177299"><span id="local-6989586621691177300"><span id="local-6989586621691177301"><span id="local-6989586621691177302"><span id="local-6989586621691177303"><span id="local-6989586621691177304"><span id="local-6989586621691177305"><span id="local-6989586621691177306"><span id="local-6989586621691177307"><span id="local-6989586621691177308"><span id="local-6989586621691177309"><span id="local-6989586621691177310"><span id="local-6989586621691177311"><span id="local-6989586621691177312"><span id="local-6989586621691177313"><span id="local-6989586621691177314"><span id="local-6989586621691177315"><span id="local-6989586621691177316"><span id="local-6989586621691177317"><span id="local-6989586621691177318"><span id="local-6989586621691177319"><span id="local-6989586621691177320"><span id="local-6989586621691177321"><span id="local-6989586621691177322"><span id="local-6989586621691177323"><span class="annot"><span class="annottext">[JWTConfig]
Maybe Text
Maybe RoleName
Maybe AuthHook
HashSet (EngineLogType Hasura)
HashSet ExperimentalFeature
HashSet AdminSecretHash
HashSet API
ConnParams
TxIsolation
Refined NonNegative Int
Refined NonNegative Seconds
Refined NonNegative Milliseconds
Refined Positive Int
StreamQueriesOptions
LogLevel
NamingCase
RemoteSchemaPermissions
InferFunctionPermissions
DangerouslyCollapseBooleans
StringifyNumbers
ExtensionsSchema
ApolloFederationStatus
EventingMode
ReadOnlyMode
MaintenanceMode ()
CorsConfig
MetadataQueryLoggingMode
MetadataDefaults
HostPreference
ConnectionOptions
WSConnectionInitTimeout
KeepAliveDelay
OptionalInterval
Port
TelemetryStatus
DevModeStatus
AllowListStatus
AdminInternalErrorsStatus
ConsoleStatus
soApolloFederationStatus :: forall impl. ServeOptions impl -&gt; ApolloFederationStatus
soMetadataDefaults :: forall impl. ServeOptions impl -&gt; MetadataDefaults
soExtensionsSchema :: forall impl. ServeOptions impl -&gt; ExtensionsSchema
soDefaultNamingConvention :: forall impl. ServeOptions impl -&gt; NamingCase
soEnableMetadataQueryLogging :: forall impl. ServeOptions impl -&gt; MetadataQueryLoggingMode
soReadOnlyMode :: forall impl. ServeOptions impl -&gt; ReadOnlyMode
soEventingMode :: forall impl. ServeOptions impl -&gt; EventingMode
soWebSocketConnectionInitTimeout :: forall impl. ServeOptions impl -&gt; WSConnectionInitTimeout
soGracefulShutdownTimeout :: forall impl. ServeOptions impl -&gt; Refined NonNegative Seconds
soAdminInternalErrors :: forall impl. ServeOptions impl -&gt; AdminInternalErrorsStatus
soDevMode :: forall impl. ServeOptions impl -&gt; DevModeStatus
soEventsFetchBatchSize :: forall impl. ServeOptions impl -&gt; Refined NonNegative Int
soExperimentalFeatures :: forall impl. ServeOptions impl -&gt; HashSet ExperimentalFeature
soSchemaPollInterval :: forall impl. ServeOptions impl -&gt; OptionalInterval
soEnableMaintenanceMode :: forall impl. ServeOptions impl -&gt; MaintenanceMode ()
soInferFunctionPermissions :: forall impl. ServeOptions impl -&gt; InferFunctionPermissions
soWebSocketKeepAlive :: forall impl. ServeOptions impl -&gt; KeepAliveDelay
soConnectionOptions :: forall impl. ServeOptions impl -&gt; ConnectionOptions
soEnableRemoteSchemaPermissions :: forall impl. ServeOptions impl -&gt; RemoteSchemaPermissions
soAsyncActionsFetchInterval :: forall impl. ServeOptions impl -&gt; OptionalInterval
soEventsFetchInterval :: forall impl. ServeOptions impl -&gt; Refined NonNegative Milliseconds
soEventsHttpPoolSize :: forall impl. ServeOptions impl -&gt; Refined Positive Int
soLogLevel :: forall impl. ServeOptions impl -&gt; LogLevel
soEnabledLogTypes :: forall impl. ServeOptions impl -&gt; HashSet (EngineLogType impl)
soEnableAllowList :: forall impl. ServeOptions impl -&gt; AllowListStatus
soStreamingQueryOpts :: forall impl. ServeOptions impl -&gt; StreamQueriesOptions
soLiveQueryOpts :: forall impl. ServeOptions impl -&gt; StreamQueriesOptions
soEnabledAPIs :: forall impl. ServeOptions impl -&gt; HashSet API
soDangerousBooleanCollapse :: forall impl. ServeOptions impl -&gt; DangerouslyCollapseBooleans
soStringifyNum :: forall impl. ServeOptions impl -&gt; StringifyNumbers
soEnableTelemetry :: forall impl. ServeOptions impl -&gt; TelemetryStatus
soConsoleSentryDsn :: forall impl. ServeOptions impl -&gt; Maybe Text
soConsoleAssetsDir :: forall impl. ServeOptions impl -&gt; Maybe Text
soConsoleStatus :: forall impl. ServeOptions impl -&gt; ConsoleStatus
soCorsConfig :: forall impl. ServeOptions impl -&gt; CorsConfig
soUnAuthRole :: forall impl. ServeOptions impl -&gt; Maybe RoleName
soJwtSecret :: forall impl. ServeOptions impl -&gt; [JWTConfig]
soAuthHook :: forall impl. ServeOptions impl -&gt; Maybe AuthHook
soAdminSecret :: forall impl. ServeOptions impl -&gt; HashSet AdminSecretHash
soTxIso :: forall impl. ServeOptions impl -&gt; TxIsolation
soConnParams :: forall impl. ServeOptions impl -&gt; ConnParams
soHost :: forall impl. ServeOptions impl -&gt; HostPreference
soPort :: forall impl. ServeOptions impl -&gt; Port
soApolloFederationStatus :: ApolloFederationStatus
soMetadataDefaults :: MetadataDefaults
soExtensionsSchema :: ExtensionsSchema
soDefaultNamingConvention :: NamingCase
soEnableMetadataQueryLogging :: MetadataQueryLoggingMode
soReadOnlyMode :: ReadOnlyMode
soEventingMode :: EventingMode
soWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
soGracefulShutdownTimeout :: Refined NonNegative Seconds
soAdminInternalErrors :: AdminInternalErrorsStatus
soDevMode :: DevModeStatus
soEventsFetchBatchSize :: Refined NonNegative Int
soExperimentalFeatures :: HashSet ExperimentalFeature
soSchemaPollInterval :: OptionalInterval
soEnableMaintenanceMode :: MaintenanceMode ()
soInferFunctionPermissions :: InferFunctionPermissions
soWebSocketKeepAlive :: KeepAliveDelay
soConnectionOptions :: ConnectionOptions
soEnableRemoteSchemaPermissions :: RemoteSchemaPermissions
soAsyncActionsFetchInterval :: OptionalInterval
soEventsFetchInterval :: Refined NonNegative Milliseconds
soEventsHttpPoolSize :: Refined Positive Int
soLogLevel :: LogLevel
soEnabledLogTypes :: HashSet (EngineLogType Hasura)
soEnableAllowList :: AllowListStatus
soStreamingQueryOpts :: StreamQueriesOptions
soLiveQueryOpts :: StreamQueriesOptions
soEnabledAPIs :: HashSet API
soDangerousBooleanCollapse :: DangerouslyCollapseBooleans
soStringifyNum :: StringifyNumbers
soEnableTelemetry :: TelemetryStatus
soConsoleSentryDsn :: Maybe Text
soConsoleAssetsDir :: Maybe Text
soConsoleStatus :: ConsoleStatus
soCorsConfig :: CorsConfig
soUnAuthRole :: Maybe RoleName
soJwtSecret :: [JWTConfig]
soAuthHook :: Maybe AuthHook
soAdminSecret :: HashSet AdminSecretHash
soTxIso :: TxIsolation
soConnParams :: ConnParams
soHost :: HostPreference
soPort :: Port
</span><a href="Hasura.Server.Init.Config.html#soApolloFederationStatus"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621691177237"><span class="annot"><span class="annottext">Maybe SubscriptionPostPollHook
</span><a href="#local-6989586621691177237"><span class="hs-identifier hs-var">liveQueryHook</span></a></span></span><span> </span><span id="local-6989586621691177236"><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621691177236"><span class="hs-identifier hs-var">serverMetrics</span></a></span></span><span> </span><span id="local-6989586621691177235"><span class="annot"><span class="annottext">PrometheusMetrics
</span><a href="#local-6989586621691177235"><span class="hs-identifier hs-var">prometheusMetrics</span></a></span></span><span> </span><span id="local-6989586621691177234"><span class="annot"><span class="annottext">SamplingPolicy
</span><a href="#local-6989586621691177234"><span class="hs-identifier hs-var">traceSamplingPolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-383"></span><span>  </span><span id="local-6989586621691177233"><span class="annot"><span class="annottext">loggers :: Loggers
</span><a href="#local-6989586621691177233"><span class="hs-identifier hs-var">loggers</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.State.html#Loggers"><span class="hs-identifier hs-type">Loggers</span></a></span><span> </span><span id="local-6989586621691177232"><span class="annot"><span class="annottext">LoggerCtx Hasura
</span><a href="#local-6989586621691177232"><span class="hs-identifier hs-var">_loggerCtx</span></a></span></span><span> </span><span id="local-6989586621691177231"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691177231"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621691177230"><span class="annot"><span class="annottext">PGLogger
</span><a href="#local-6989586621691177230"><span class="hs-identifier hs-var">pgLogger</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m) =&gt;
HashSet (EngineLogType Hasura) -&gt; LogLevel -&gt; ManagedT m Loggers
</span><a href="Hasura.App.html#mkLoggers"><span class="hs-identifier hs-var">mkLoggers</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet (EngineLogType Hasura)
</span><a href="#local-6989586621691177304"><span class="hs-identifier hs-var">soEnabledLogTypes</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="#local-6989586621691177303"><span class="hs-identifier hs-var">soLogLevel</span></a></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-comment">-- SIDE EFFECT: print a warning if no admin secret is set.</span><span>
</span><span id="line-386"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet AdminSecretHash
</span><a href="#local-6989586621691177319"><span class="hs-identifier hs-var">soAdminSecret</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-387"></span><span>    </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span>
</span><span id="line-388"></span><span>      </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691177231"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-389"></span><span>      </span><span class="annot"><a href="Hasura.Server.Logging.html#StartupLog"><span class="hs-identifier hs-type">StartupLog</span></a></span><span>
</span><span id="line-390"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">slLogLevel :: LogLevel
</span><a href="Hasura.Server.Logging.html#slLogLevel"><span class="hs-identifier hs-var">slLogLevel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelWarn"><span class="hs-identifier hs-var">LevelWarn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-391"></span><span>          </span><span class="annot"><span class="annottext">slKind :: Text
</span><a href="Hasura.Server.Logging.html#slKind"><span class="hs-identifier hs-var">slKind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;no_admin_secret&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-392"></span><span>          </span><span class="annot"><span class="annottext">slInfo :: Value
</span><a href="Hasura.Server.Logging.html#slInfo"><span class="hs-identifier hs-var">slInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">J.toJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;WARNING: No admin secret provided&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-comment">-- SIDE EFFECT: log all server options.</span><span>
</span><span id="line-396"></span><span>  </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691177231"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall impl.
ToJSON (EngineLogType impl) =&gt;
ServeOptions impl -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#serveOptsToLog"><span class="hs-identifier hs-var">serveOptsToLog</span></a></span><span> </span><span class="annot"><span class="annottext">ServeOptions Hasura
</span><a href="#local-6989586621691177325"><span class="hs-identifier hs-var">serveOptions</span></a></span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span>  </span><span class="hs-comment">-- SIDE EFFECT: log metadata postgres connection info.</span><span>
</span><span id="line-399"></span><span>  </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691177231"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#connInfoToLog"><span class="hs-identifier hs-var">connInfoToLog</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621691177327"><span class="hs-identifier hs-var">bciMetadataConnInfo</span></a></span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span>  </span><span class="hs-comment">-- Generate the instance id.</span><span>
</span><span id="line-402"></span><span>  </span><span id="local-6989586621691177219"><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621691177219"><span class="hs-identifier hs-var">instanceId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO InstanceId
</span><a href="Hasura.Server.Types.html#generateInstanceId"><span class="hs-identifier hs-var">generateInstanceId</span></a></span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span>  </span><span class="hs-comment">-- Init metadata db pool.</span><span>
</span><span id="line-405"></span><span>  </span><span id="local-6989586621691177217"><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621691177217"><span class="hs-identifier hs-var">metadataDbPool</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-406"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
MonadBaseControl IO m =&gt;
m a -&gt; (a -&gt; m b) -&gt; ManagedT m a
</span><a href="Control.Monad.Trans.Managed.html#allocate"><span class="hs-identifier hs-var">allocate</span></a></span><span>
</span><span id="line-407"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo -&gt; ConnParams -&gt; PGLogger -&gt; IO PGPool
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.initPGPool</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621691177327"><span class="hs-identifier hs-var">bciMetadataConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ConnParams
</span><a href="#local-6989586621691177321"><span class="hs-identifier hs-var">soConnParams</span></a></span><span> </span><span class="annot"><span class="annottext">PGLogger
</span><a href="#local-6989586621691177230"><span class="hs-identifier hs-var">pgLogger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PGPool -&gt; IO ()
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.destroyPGPool</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span>  </span><span class="hs-comment">-- Migrate the catalog and fetch the metdata.</span><span>
</span><span id="line-411"></span><span>  </span><span id="local-6989586621691177214"><span class="annot"><span class="annottext">MetadataWithResourceVersion
</span><a href="#local-6989586621691177214"><span class="hs-identifier hs-var">metadataWithVersion</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-412"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-413"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m) =&gt;
Logger Hasura
-&gt; PGPool
-&gt; Maybe (SourceConnConfiguration ('Postgres 'Vanilla))
-&gt; MaintenanceMode ()
-&gt; ExtensionsSchema
-&gt; m MetadataWithResourceVersion
</span><a href="Hasura.App.html#migrateCatalogAndFetchMetadata"><span class="hs-identifier hs-var">migrateCatalogAndFetchMetadata</span></a></span><span>
</span><span id="line-414"></span><span>        </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691177231"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-415"></span><span>        </span><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621691177217"><span class="hs-identifier hs-var">metadataDbPool</span></a></span><span>
</span><span id="line-416"></span><span>        </span><span class="annot"><span class="annottext">Maybe PostgresConnConfiguration
</span><a href="#local-6989586621691177326"><span class="hs-identifier hs-var">bciDefaultPostgres</span></a></span><span>
</span><span id="line-417"></span><span>        </span><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621691177295"><span class="hs-identifier hs-var">soEnableMaintenanceMode</span></a></span><span>
</span><span id="line-418"></span><span>        </span><span class="annot"><span class="annottext">ExtensionsSchema
</span><a href="#local-6989586621691177283"><span class="hs-identifier hs-var">soExtensionsSchema</span></a></span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span>  </span><span class="hs-comment">-- Create the TLSAllowListRef and the HTTP Manager.</span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621691177212"><span class="annot"><span class="annottext">metadata :: Metadata
</span><a href="#local-6989586621691177212"><span class="hs-identifier hs-var hs-var">metadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetadataWithResourceVersion -&gt; Metadata
</span><a href="Hasura.RQL.Types.SchemaCache.html#_mwrvMetadata"><span class="hs-identifier hs-var">_mwrvMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataWithResourceVersion
</span><a href="#local-6989586621691177214"><span class="hs-identifier hs-var">metadataWithVersion</span></a></span><span>
</span><span id="line-422"></span><span>  </span><span id="local-6989586621691177210"><span class="annot"><span class="annottext">TLSAllowListRef
</span><a href="#local-6989586621691177210"><span class="hs-identifier hs-var">tlsAllowListRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[TlsAllow] -&gt; IO TLSAllowListRef
</span><a href="Hasura.Server.AppStateRef.html#createTLSAllowListRef"><span class="hs-identifier hs-var">createTLSAllowListRef</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Network -&gt; [TlsAllow]
</span><span class="hs-identifier hs-var">networkTlsAllowlist</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; Network
</span><a href="Hasura.RQL.Types.Metadata.html#_metaNetwork"><span class="hs-identifier hs-var">_metaNetwork</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621691177212"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-423"></span><span>  </span><span id="local-6989586621691177206"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621691177206"><span class="hs-identifier hs-var">httpManager</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO [TlsAllow] -&gt; Blocklist -&gt; IO Manager
</span><span class="hs-identifier hs-var">mkHttpManager</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TLSAllowListRef -&gt; IO [TlsAllow]
</span><a href="Hasura.Server.AppStateRef.html#readTLSAllowList"><span class="hs-identifier hs-var">readTLSAllowList</span></a></span><span> </span><span class="annot"><span class="annottext">TLSAllowListRef
</span><a href="#local-6989586621691177210"><span class="hs-identifier hs-var">tlsAllowListRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span>  </span><span class="hs-comment">-- Start a background thread for listening schema sync events from other</span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-comment">-- server instances (an interval of 0 indicates that no schema sync is</span><span>
</span><span id="line-427"></span><span>  </span><span class="hs-comment">-- required). Logs whether the thread is started or not, and with what</span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-comment">-- interval.</span><span>
</span><span id="line-429"></span><span>  </span><span class="hs-comment">-- TODO: extract into a separate init function.</span><span>
</span><span id="line-430"></span><span>  </span><span id="local-6989586621691177204"><span class="annot"><span class="annottext">TMVar MetadataResourceVersion
</span><a href="#local-6989586621691177204"><span class="hs-identifier hs-var">metaVersionRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. IO (TMVar a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/stm-2.5.0.2/src"><span class="hs-identifier hs-var">STM.newEmptyTMVarIO</span></a></span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OptionalInterval
</span><a href="#local-6989586621691177294"><span class="hs-identifier hs-var">soSchemaPollInterval</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-432"></span><span>    </span><span class="annot"><span class="annottext">OptionalInterval
</span><a href="Hasura.Server.Init.Config.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691177231"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; LogLevel -&gt; Text -&gt; a -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericLog"><span class="hs-identifier hs-var">mkGenericLog</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;schema-sync&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Schema sync disabled&quot;</span></span><span>
</span><span id="line-433"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.Config.html#Interval"><span class="hs-identifier hs-type">Interval</span></a></span><span> </span><span id="local-6989586621691177198"><span class="annot"><span class="annottext">Refined NonNegative Milliseconds
</span><a href="#local-6989586621691177198"><span class="hs-identifier hs-var">interval</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-434"></span><span>      </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691177231"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; LogLevel -&gt; Text -&gt; a -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericLog"><span class="hs-identifier hs-var">mkGenericLog</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;schema-sync&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Schema sync enabled. Polling at &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Refined NonNegative Milliseconds
</span><a href="#local-6989586621691177198"><span class="hs-identifier hs-var">interval</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
Logger Hasura
-&gt; PGPool
-&gt; InstanceId
-&gt; Refined NonNegative Milliseconds
-&gt; TMVar MetadataResourceVersion
-&gt; ManagedT m Thread
</span><a href="Hasura.Server.SchemaUpdate.html#startSchemaSyncListenerThread"><span class="hs-identifier hs-var">startSchemaSyncListenerThread</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691177231"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621691177217"><span class="hs-identifier hs-var">metadataDbPool</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621691177219"><span class="hs-identifier hs-var">instanceId</span></a></span><span> </span><span class="annot"><span class="annottext">Refined NonNegative Milliseconds
</span><a href="#local-6989586621691177198"><span class="hs-identifier hs-var">interval</span></a></span><span> </span><span class="annot"><span class="annottext">TMVar MetadataResourceVersion
</span><a href="#local-6989586621691177204"><span class="hs-identifier hs-var">metaVersionRef</span></a></span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-comment">-- Generate the shutdown latch.</span><span>
</span><span id="line-438"></span><span>  </span><span id="local-6989586621691177194"><span class="annot"><span class="annottext">ShutdownLatch
</span><a href="#local-6989586621691177194"><span class="hs-identifier hs-var">latch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO ShutdownLatch
</span><a href="Hasura.ShutdownLatch.html#newShutdownLatch"><span class="hs-identifier hs-var">newShutdownLatch</span></a></span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span>  </span><span class="hs-comment">-- Generate subscription state.</span><span>
</span><span id="line-441"></span><span>  </span><span id="local-6989586621691177192"><span class="annot"><span class="annottext">SubscriptionsState
</span><a href="#local-6989586621691177192"><span class="hs-identifier hs-var">subscriptionsState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; Maybe SubscriptionPostPollHook -&gt; IO SubscriptionsState
</span><a href="Hasura.App.html#initSubscriptionsState"><span class="hs-identifier hs-var">initSubscriptionsState</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691177231"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SubscriptionPostPollHook
</span><a href="#local-6989586621691177237"><span class="hs-identifier hs-var">liveQueryHook</span></a></span><span>
</span><span id="line-442"></span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-comment">-- Generate event's trigger shared state</span><span>
</span><span id="line-444"></span><span>  </span><span id="local-6989586621691177191"><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621691177191"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO LockedEventsCtx
</span><a href="Hasura.App.html#initLockedEventsCtx"><span class="hs-identifier hs-var">initLockedEventsCtx</span></a></span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-447"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.App.html#AppInit"><span class="hs-identifier hs-type">AppInit</span></a></span><span>
</span><span id="line-448"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">aiTLSAllowListRef :: TLSAllowListRef
</span><a href="Hasura.App.html#aiTLSAllowListRef"><span class="hs-identifier hs-var">aiTLSAllowListRef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLSAllowListRef
</span><a href="#local-6989586621691177210"><span class="hs-identifier hs-var">tlsAllowListRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-449"></span><span>          </span><span class="annot"><span class="annottext">aiMetadataWithResourceVersion :: MetadataWithResourceVersion
</span><a href="Hasura.App.html#aiMetadataWithResourceVersion"><span class="hs-identifier hs-var">aiMetadataWithResourceVersion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetadataWithResourceVersion
</span><a href="#local-6989586621691177214"><span class="hs-identifier hs-var">metadataWithVersion</span></a></span><span>
</span><span id="line-450"></span><span>        </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-451"></span><span>      </span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">AppEnv</span></a></span><span>
</span><span id="line-452"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">appEnvPort :: Port
</span><a href="Hasura.App.State.html#appEnvPort"><span class="hs-identifier hs-var">appEnvPort</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621691177323"><span class="hs-identifier hs-var">soPort</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-453"></span><span>          </span><span class="annot"><span class="annottext">appEnvHost :: HostPreference
</span><a href="Hasura.App.State.html#appEnvHost"><span class="hs-identifier hs-var">appEnvHost</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HostPreference
</span><a href="#local-6989586621691177322"><span class="hs-identifier hs-var">soHost</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-454"></span><span>          </span><span class="annot"><span class="annottext">appEnvMetadataDbPool :: PGPool
</span><a href="Hasura.App.State.html#appEnvMetadataDbPool"><span class="hs-identifier hs-var">appEnvMetadataDbPool</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621691177217"><span class="hs-identifier hs-var">metadataDbPool</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-455"></span><span>          </span><span class="annot"><span class="annottext">appEnvIntrospectionDbPool :: Maybe PGPool
</span><a href="Hasura.App.State.html#appEnvIntrospectionDbPool"><span class="hs-identifier hs-var">appEnvIntrospectionDbPool</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- No introspection storage for self-hosted CE</span><span>
</span><span id="line-456"></span><span>          </span><span class="annot"><span class="annottext">appEnvManager :: Manager
</span><a href="Hasura.App.State.html#appEnvManager"><span class="hs-identifier hs-var">appEnvManager</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621691177206"><span class="hs-identifier hs-var">httpManager</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-457"></span><span>          </span><span class="annot"><span class="annottext">appEnvLoggers :: Loggers
</span><a href="Hasura.App.State.html#appEnvLoggers"><span class="hs-identifier hs-var">appEnvLoggers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Loggers
</span><a href="#local-6989586621691177233"><span class="hs-identifier hs-var">loggers</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-458"></span><span>          </span><span class="annot"><span class="annottext">appEnvMetadataVersionRef :: TMVar MetadataResourceVersion
</span><a href="Hasura.App.State.html#appEnvMetadataVersionRef"><span class="hs-identifier hs-var">appEnvMetadataVersionRef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TMVar MetadataResourceVersion
</span><a href="#local-6989586621691177204"><span class="hs-identifier hs-var">metaVersionRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-459"></span><span>          </span><span class="annot"><span class="annottext">appEnvInstanceId :: InstanceId
</span><a href="Hasura.App.State.html#appEnvInstanceId"><span class="hs-identifier hs-var">appEnvInstanceId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621691177219"><span class="hs-identifier hs-var">instanceId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-460"></span><span>          </span><span class="annot"><span class="annottext">appEnvEnableMaintenanceMode :: MaintenanceMode ()
</span><a href="Hasura.App.State.html#appEnvEnableMaintenanceMode"><span class="hs-identifier hs-var">appEnvEnableMaintenanceMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621691177295"><span class="hs-identifier hs-var">soEnableMaintenanceMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-461"></span><span>          </span><span class="annot"><span class="annottext">appEnvLoggingSettings :: LoggingSettings
</span><a href="Hasura.App.State.html#appEnvLoggingSettings"><span class="hs-identifier hs-var">appEnvLoggingSettings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet (EngineLogType Hasura)
-&gt; MetadataQueryLoggingMode -&gt; LoggingSettings
</span><a href="Hasura.Server.Logging.html#LoggingSettings"><span class="hs-identifier hs-var">LoggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet (EngineLogType Hasura)
</span><a href="#local-6989586621691177304"><span class="hs-identifier hs-var">soEnabledLogTypes</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataQueryLoggingMode
</span><a href="#local-6989586621691177285"><span class="hs-identifier hs-var">soEnableMetadataQueryLogging</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-462"></span><span>          </span><span class="annot"><span class="annottext">appEnvEventingMode :: EventingMode
</span><a href="Hasura.App.State.html#appEnvEventingMode"><span class="hs-identifier hs-var">appEnvEventingMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EventingMode
</span><a href="#local-6989586621691177287"><span class="hs-identifier hs-var">soEventingMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-463"></span><span>          </span><span class="annot"><span class="annottext">appEnvEnableReadOnlyMode :: ReadOnlyMode
</span><a href="Hasura.App.State.html#appEnvEnableReadOnlyMode"><span class="hs-identifier hs-var">appEnvEnableReadOnlyMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="#local-6989586621691177286"><span class="hs-identifier hs-var">soReadOnlyMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-464"></span><span>          </span><span class="annot"><span class="annottext">appEnvServerMetrics :: ServerMetrics
</span><a href="Hasura.App.State.html#appEnvServerMetrics"><span class="hs-identifier hs-var">appEnvServerMetrics</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621691177236"><span class="hs-identifier hs-var">serverMetrics</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-465"></span><span>          </span><span class="annot"><span class="annottext">appEnvShutdownLatch :: ShutdownLatch
</span><a href="Hasura.App.State.html#appEnvShutdownLatch"><span class="hs-identifier hs-var">appEnvShutdownLatch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShutdownLatch
</span><a href="#local-6989586621691177194"><span class="hs-identifier hs-var">latch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-466"></span><span>          </span><span class="annot"><span class="annottext">appEnvMetaVersionRef :: TMVar MetadataResourceVersion
</span><a href="Hasura.App.State.html#appEnvMetaVersionRef"><span class="hs-identifier hs-var">appEnvMetaVersionRef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TMVar MetadataResourceVersion
</span><a href="#local-6989586621691177204"><span class="hs-identifier hs-var">metaVersionRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-467"></span><span>          </span><span class="annot"><span class="annottext">appEnvPrometheusMetrics :: PrometheusMetrics
</span><a href="Hasura.App.State.html#appEnvPrometheusMetrics"><span class="hs-identifier hs-var">appEnvPrometheusMetrics</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrometheusMetrics
</span><a href="#local-6989586621691177235"><span class="hs-identifier hs-var">prometheusMetrics</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-468"></span><span>          </span><span class="annot"><span class="annottext">appEnvTraceSamplingPolicy :: SamplingPolicy
</span><a href="Hasura.App.State.html#appEnvTraceSamplingPolicy"><span class="hs-identifier hs-var">appEnvTraceSamplingPolicy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SamplingPolicy
</span><a href="#local-6989586621691177234"><span class="hs-identifier hs-var">traceSamplingPolicy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-469"></span><span>          </span><span class="annot"><span class="annottext">appEnvSubscriptionState :: SubscriptionsState
</span><a href="Hasura.App.State.html#appEnvSubscriptionState"><span class="hs-identifier hs-var">appEnvSubscriptionState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubscriptionsState
</span><a href="#local-6989586621691177192"><span class="hs-identifier hs-var">subscriptionsState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-470"></span><span>          </span><span class="annot"><span class="annottext">appEnvLockedEventsCtx :: LockedEventsCtx
</span><a href="Hasura.App.State.html#appEnvLockedEventsCtx"><span class="hs-identifier hs-var">appEnvLockedEventsCtx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621691177191"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-471"></span><span>          </span><span class="annot"><span class="annottext">appEnvConnParams :: ConnParams
</span><a href="Hasura.App.State.html#appEnvConnParams"><span class="hs-identifier hs-var">appEnvConnParams</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConnParams
</span><a href="#local-6989586621691177321"><span class="hs-identifier hs-var">soConnParams</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-472"></span><span>          </span><span class="annot"><span class="annottext">appEnvTxIso :: TxIsolation
</span><a href="Hasura.App.State.html#appEnvTxIso"><span class="hs-identifier hs-var">appEnvTxIso</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIsolation
</span><a href="#local-6989586621691177320"><span class="hs-identifier hs-var">soTxIso</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-473"></span><span>          </span><span class="annot"><span class="annottext">appEnvConsoleAssetsDir :: Maybe Text
</span><a href="Hasura.App.State.html#appEnvConsoleAssetsDir"><span class="hs-identifier hs-var">appEnvConsoleAssetsDir</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621691177313"><span class="hs-identifier hs-var">soConsoleAssetsDir</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-474"></span><span>          </span><span class="annot"><span class="annottext">appEnvConsoleSentryDsn :: Maybe Text
</span><a href="Hasura.App.State.html#appEnvConsoleSentryDsn"><span class="hs-identifier hs-var">appEnvConsoleSentryDsn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621691177312"><span class="hs-identifier hs-var">soConsoleSentryDsn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-475"></span><span>          </span><span class="annot"><span class="annottext">appEnvConnectionOptions :: ConnectionOptions
</span><a href="Hasura.App.State.html#appEnvConnectionOptions"><span class="hs-identifier hs-var">appEnvConnectionOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConnectionOptions
</span><a href="#local-6989586621691177298"><span class="hs-identifier hs-var">soConnectionOptions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-476"></span><span>          </span><span class="annot"><span class="annottext">appEnvWebSocketKeepAlive :: KeepAliveDelay
</span><a href="Hasura.App.State.html#appEnvWebSocketKeepAlive"><span class="hs-identifier hs-var">appEnvWebSocketKeepAlive</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KeepAliveDelay
</span><a href="#local-6989586621691177297"><span class="hs-identifier hs-var">soWebSocketKeepAlive</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-477"></span><span>          </span><span class="annot"><span class="annottext">appEnvWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
</span><a href="Hasura.App.State.html#appEnvWebSocketConnectionInitTimeout"><span class="hs-identifier hs-var">appEnvWebSocketConnectionInitTimeout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WSConnectionInitTimeout
</span><a href="#local-6989586621691177288"><span class="hs-identifier hs-var">soWebSocketConnectionInitTimeout</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-478"></span><span>          </span><span class="annot"><span class="annottext">appEnvGracefulShutdownTimeout :: Refined NonNegative Seconds
</span><a href="Hasura.App.State.html#appEnvGracefulShutdownTimeout"><span class="hs-identifier hs-var">appEnvGracefulShutdownTimeout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Refined NonNegative Seconds
</span><a href="#local-6989586621691177289"><span class="hs-identifier hs-var">soGracefulShutdownTimeout</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-479"></span><span>          </span><span class="annot"><span class="annottext">appEnvCheckFeatureFlag :: CheckFeatureFlag
</span><a href="Hasura.App.State.html#appEnvCheckFeatureFlag"><span class="hs-identifier hs-var">appEnvCheckFeatureFlag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FeatureFlag -&gt; IO Bool) -&gt; CheckFeatureFlag
</span><a href="Hasura.Server.Init.FeatureFlag.html#CheckFeatureFlag"><span class="hs-identifier hs-var">CheckFeatureFlag</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Environment -&gt; FeatureFlag -&gt; IO Bool
</span><a href="Hasura.Server.Init.FeatureFlag.html#checkFeatureFlag"><span class="hs-identifier hs-var">checkFeatureFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691177328"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-480"></span><span>          </span><span class="annot"><span class="annottext">appEnvSchemaPollInterval :: OptionalInterval
</span><a href="Hasura.App.State.html#appEnvSchemaPollInterval"><span class="hs-identifier hs-var">appEnvSchemaPollInterval</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OptionalInterval
</span><a href="#local-6989586621691177294"><span class="hs-identifier hs-var">soSchemaPollInterval</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-481"></span><span>          </span><span class="annot"><span class="annottext">appEnvLicenseKeyCache :: Maybe (CredentialCache AgentLicenseKey)
</span><a href="Hasura.App.State.html#appEnvLicenseKeyCache"><span class="hs-identifier hs-var">appEnvLicenseKeyCache</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-482"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-483"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span class="hs-comment">-- | Initializes the 'AppContext' and returns a corresponding 'AppStateRef'.</span><span>
</span><span id="line-486"></span><span class="hs-comment">--</span><span>
</span><span id="line-487"></span><span class="hs-comment">-- This function is meant to be run in the app monad, which provides the</span><span>
</span><span id="line-488"></span><span class="hs-comment">-- 'AppEnv'.</span><span>
</span><span id="line-489"></span><span id="local-6989586621691178395"><span class="annot"><a href="Hasura.App.html#initialiseAppContext"><span class="hs-identifier hs-type">initialiseAppContext</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-490"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Control.Concurrent.Extended.html#ForkableMonadIO"><span class="hs-identifier hs-type">C.ForkableMonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178395"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.App.State.html#HasAppEnv"><span class="hs-identifier hs-type">HasAppEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178395"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-491"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Env.Environment</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-492"></span><span>  </span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptions"><span class="hs-identifier hs-type">ServeOptions</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-493"></span><span>  </span><span class="annot"><a href="Hasura.App.html#AppInit"><span class="hs-identifier hs-type">AppInit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-494"></span><span>  </span><span class="annot"><a href="#local-6989586621691178395"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.AppStateRef.html#AppStateRef"><span class="hs-identifier hs-type">AppStateRef</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-495"></span><span id="initialiseAppContext"><span class="annot"><span class="annottext">initialiseAppContext :: forall (m :: * -&gt; *).
(ForkableMonadIO m, HasAppEnv m) =&gt;
Environment
-&gt; ServeOptions Hasura -&gt; AppInit -&gt; m (AppStateRef Hasura)
</span><a href="Hasura.App.html#initialiseAppContext"><span class="hs-identifier hs-var hs-var">initialiseAppContext</span></a></span></span><span> </span><span id="local-6989586621691177141"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691177141"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621691177140"><span class="annot"><span class="annottext">serveOptions :: ServeOptions Hasura
</span><a href="#local-6989586621691177140"><span class="hs-identifier hs-var">serveOptions</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptions"><span class="hs-identifier hs-type">ServeOptions</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621691177097"><span id="local-6989586621691177098"><span id="local-6989586621691177099"><span id="local-6989586621691177100"><span id="local-6989586621691177101"><span id="local-6989586621691177102"><span id="local-6989586621691177103"><span id="local-6989586621691177104"><span id="local-6989586621691177105"><span id="local-6989586621691177106"><span id="local-6989586621691177107"><span id="local-6989586621691177108"><span id="local-6989586621691177109"><span id="local-6989586621691177110"><span id="local-6989586621691177111"><span id="local-6989586621691177112"><span id="local-6989586621691177113"><span id="local-6989586621691177114"><span id="local-6989586621691177115"><span id="local-6989586621691177116"><span id="local-6989586621691177117"><span id="local-6989586621691177118"><span id="local-6989586621691177119"><span id="local-6989586621691177120"><span id="local-6989586621691177121"><span id="local-6989586621691177122"><span id="local-6989586621691177123"><span id="local-6989586621691177124"><span id="local-6989586621691177125"><span id="local-6989586621691177126"><span id="local-6989586621691177127"><span id="local-6989586621691177128"><span id="local-6989586621691177129"><span id="local-6989586621691177130"><span id="local-6989586621691177131"><span id="local-6989586621691177132"><span id="local-6989586621691177133"><span id="local-6989586621691177134"><span id="local-6989586621691177135"><span id="local-6989586621691177136"><span id="local-6989586621691177137"><span id="local-6989586621691177138"><span id="local-6989586621691177139"><span class="annot"><span class="annottext">[JWTConfig]
Maybe Text
Maybe RoleName
Maybe AuthHook
HashSet (EngineLogType Hasura)
HashSet ExperimentalFeature
HashSet AdminSecretHash
HashSet API
ConnParams
TxIsolation
Refined NonNegative Int
Refined NonNegative Seconds
Refined NonNegative Milliseconds
Refined Positive Int
StreamQueriesOptions
LogLevel
NamingCase
RemoteSchemaPermissions
InferFunctionPermissions
DangerouslyCollapseBooleans
StringifyNumbers
ExtensionsSchema
ApolloFederationStatus
EventingMode
ReadOnlyMode
MaintenanceMode ()
CorsConfig
MetadataQueryLoggingMode
MetadataDefaults
HostPreference
ConnectionOptions
WSConnectionInitTimeout
KeepAliveDelay
OptionalInterval
Port
TelemetryStatus
DevModeStatus
AllowListStatus
AdminInternalErrorsStatus
ConsoleStatus
soApolloFederationStatus :: ApolloFederationStatus
soMetadataDefaults :: MetadataDefaults
soExtensionsSchema :: ExtensionsSchema
soDefaultNamingConvention :: NamingCase
soEnableMetadataQueryLogging :: MetadataQueryLoggingMode
soReadOnlyMode :: ReadOnlyMode
soEventingMode :: EventingMode
soWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
soGracefulShutdownTimeout :: Refined NonNegative Seconds
soAdminInternalErrors :: AdminInternalErrorsStatus
soDevMode :: DevModeStatus
soEventsFetchBatchSize :: Refined NonNegative Int
soExperimentalFeatures :: HashSet ExperimentalFeature
soSchemaPollInterval :: OptionalInterval
soEnableMaintenanceMode :: MaintenanceMode ()
soInferFunctionPermissions :: InferFunctionPermissions
soWebSocketKeepAlive :: KeepAliveDelay
soConnectionOptions :: ConnectionOptions
soEnableRemoteSchemaPermissions :: RemoteSchemaPermissions
soAsyncActionsFetchInterval :: OptionalInterval
soEventsFetchInterval :: Refined NonNegative Milliseconds
soEventsHttpPoolSize :: Refined Positive Int
soLogLevel :: LogLevel
soEnabledLogTypes :: HashSet (EngineLogType Hasura)
soEnableAllowList :: AllowListStatus
soStreamingQueryOpts :: StreamQueriesOptions
soLiveQueryOpts :: StreamQueriesOptions
soEnabledAPIs :: HashSet API
soDangerousBooleanCollapse :: DangerouslyCollapseBooleans
soStringifyNum :: StringifyNumbers
soEnableTelemetry :: TelemetryStatus
soConsoleSentryDsn :: Maybe Text
soConsoleAssetsDir :: Maybe Text
soConsoleStatus :: ConsoleStatus
soCorsConfig :: CorsConfig
soUnAuthRole :: Maybe RoleName
soJwtSecret :: [JWTConfig]
soAuthHook :: Maybe AuthHook
soAdminSecret :: HashSet AdminSecretHash
soTxIso :: TxIsolation
soConnParams :: ConnParams
soHost :: HostPreference
soPort :: Port
soApolloFederationStatus :: forall impl. ServeOptions impl -&gt; ApolloFederationStatus
soMetadataDefaults :: forall impl. ServeOptions impl -&gt; MetadataDefaults
soExtensionsSchema :: forall impl. ServeOptions impl -&gt; ExtensionsSchema
soDefaultNamingConvention :: forall impl. ServeOptions impl -&gt; NamingCase
soEnableMetadataQueryLogging :: forall impl. ServeOptions impl -&gt; MetadataQueryLoggingMode
soReadOnlyMode :: forall impl. ServeOptions impl -&gt; ReadOnlyMode
soEventingMode :: forall impl. ServeOptions impl -&gt; EventingMode
soWebSocketConnectionInitTimeout :: forall impl. ServeOptions impl -&gt; WSConnectionInitTimeout
soGracefulShutdownTimeout :: forall impl. ServeOptions impl -&gt; Refined NonNegative Seconds
soAdminInternalErrors :: forall impl. ServeOptions impl -&gt; AdminInternalErrorsStatus
soDevMode :: forall impl. ServeOptions impl -&gt; DevModeStatus
soEventsFetchBatchSize :: forall impl. ServeOptions impl -&gt; Refined NonNegative Int
soExperimentalFeatures :: forall impl. ServeOptions impl -&gt; HashSet ExperimentalFeature
soSchemaPollInterval :: forall impl. ServeOptions impl -&gt; OptionalInterval
soEnableMaintenanceMode :: forall impl. ServeOptions impl -&gt; MaintenanceMode ()
soInferFunctionPermissions :: forall impl. ServeOptions impl -&gt; InferFunctionPermissions
soWebSocketKeepAlive :: forall impl. ServeOptions impl -&gt; KeepAliveDelay
soConnectionOptions :: forall impl. ServeOptions impl -&gt; ConnectionOptions
soEnableRemoteSchemaPermissions :: forall impl. ServeOptions impl -&gt; RemoteSchemaPermissions
soAsyncActionsFetchInterval :: forall impl. ServeOptions impl -&gt; OptionalInterval
soEventsFetchInterval :: forall impl. ServeOptions impl -&gt; Refined NonNegative Milliseconds
soEventsHttpPoolSize :: forall impl. ServeOptions impl -&gt; Refined Positive Int
soLogLevel :: forall impl. ServeOptions impl -&gt; LogLevel
soEnabledLogTypes :: forall impl. ServeOptions impl -&gt; HashSet (EngineLogType impl)
soEnableAllowList :: forall impl. ServeOptions impl -&gt; AllowListStatus
soStreamingQueryOpts :: forall impl. ServeOptions impl -&gt; StreamQueriesOptions
soLiveQueryOpts :: forall impl. ServeOptions impl -&gt; StreamQueriesOptions
soEnabledAPIs :: forall impl. ServeOptions impl -&gt; HashSet API
soDangerousBooleanCollapse :: forall impl. ServeOptions impl -&gt; DangerouslyCollapseBooleans
soStringifyNum :: forall impl. ServeOptions impl -&gt; StringifyNumbers
soEnableTelemetry :: forall impl. ServeOptions impl -&gt; TelemetryStatus
soConsoleSentryDsn :: forall impl. ServeOptions impl -&gt; Maybe Text
soConsoleAssetsDir :: forall impl. ServeOptions impl -&gt; Maybe Text
soConsoleStatus :: forall impl. ServeOptions impl -&gt; ConsoleStatus
soCorsConfig :: forall impl. ServeOptions impl -&gt; CorsConfig
soUnAuthRole :: forall impl. ServeOptions impl -&gt; Maybe RoleName
soJwtSecret :: forall impl. ServeOptions impl -&gt; [JWTConfig]
soAuthHook :: forall impl. ServeOptions impl -&gt; Maybe AuthHook
soAdminSecret :: forall impl. ServeOptions impl -&gt; HashSet AdminSecretHash
soTxIso :: forall impl. ServeOptions impl -&gt; TxIsolation
soConnParams :: forall impl. ServeOptions impl -&gt; ConnParams
soHost :: forall impl. ServeOptions impl -&gt; HostPreference
soPort :: forall impl. ServeOptions impl -&gt; Port
</span><a href="#local-6989586621691177097"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="annot"><a href="Hasura.App.html#AppInit"><span class="hs-identifier hs-type">AppInit</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621691177095"><span id="local-6989586621691177096"><span class="annot"><span class="annottext">MetadataWithResourceVersion
TLSAllowListRef
aiMetadataWithResourceVersion :: MetadataWithResourceVersion
aiTLSAllowListRef :: TLSAllowListRef
aiMetadataWithResourceVersion :: AppInit -&gt; MetadataWithResourceVersion
aiTLSAllowListRef :: AppInit -&gt; TLSAllowListRef
</span><a href="#local-6989586621691177095"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-496"></span><span>  </span><span id="local-6989586621691177094"><span class="annot"><span class="annottext">appEnv :: AppEnv
</span><a href="#local-6989586621691177094"><span class="hs-identifier hs-var">appEnv</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">AppEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621691177064"><span id="local-6989586621691177065"><span id="local-6989586621691177066"><span id="local-6989586621691177067"><span id="local-6989586621691177068"><span id="local-6989586621691177069"><span id="local-6989586621691177070"><span id="local-6989586621691177071"><span id="local-6989586621691177072"><span id="local-6989586621691177073"><span id="local-6989586621691177074"><span id="local-6989586621691177075"><span id="local-6989586621691177076"><span id="local-6989586621691177077"><span id="local-6989586621691177078"><span id="local-6989586621691177079"><span id="local-6989586621691177080"><span id="local-6989586621691177081"><span id="local-6989586621691177082"><span id="local-6989586621691177083"><span id="local-6989586621691177084"><span id="local-6989586621691177085"><span id="local-6989586621691177086"><span id="local-6989586621691177087"><span id="local-6989586621691177088"><span id="local-6989586621691177089"><span id="local-6989586621691177090"><span id="local-6989586621691177091"><span id="local-6989586621691177092"><span id="local-6989586621691177093"><span class="annot"><span class="annottext">Maybe Text
Maybe PGPool
Maybe (CredentialCache AgentLicenseKey)
SamplingPolicy
PGPool
ConnParams
TxIsolation
TMVar MetadataResourceVersion
Refined NonNegative Seconds
Manager
CheckFeatureFlag
ServerMetrics
EventingMode
ReadOnlyMode
MaintenanceMode ()
InstanceId
PrometheusMetrics
ShutdownLatch
LoggingSettings
LockedEventsCtx
HostPreference
ConnectionOptions
WSConnectionInitTimeout
KeepAliveDelay
OptionalInterval
Port
SubscriptionsState
Loggers
appEnvLicenseKeyCache :: Maybe (CredentialCache AgentLicenseKey)
appEnvCheckFeatureFlag :: CheckFeatureFlag
appEnvSchemaPollInterval :: OptionalInterval
appEnvGracefulShutdownTimeout :: Refined NonNegative Seconds
appEnvWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
appEnvWebSocketKeepAlive :: KeepAliveDelay
appEnvConnectionOptions :: ConnectionOptions
appEnvConsoleSentryDsn :: Maybe Text
appEnvConsoleAssetsDir :: Maybe Text
appEnvTxIso :: TxIsolation
appEnvConnParams :: ConnParams
appEnvLockedEventsCtx :: LockedEventsCtx
appEnvSubscriptionState :: SubscriptionsState
appEnvTraceSamplingPolicy :: SamplingPolicy
appEnvPrometheusMetrics :: PrometheusMetrics
appEnvMetaVersionRef :: TMVar MetadataResourceVersion
appEnvShutdownLatch :: ShutdownLatch
appEnvServerMetrics :: ServerMetrics
appEnvEnableReadOnlyMode :: ReadOnlyMode
appEnvEventingMode :: EventingMode
appEnvLoggingSettings :: LoggingSettings
appEnvEnableMaintenanceMode :: MaintenanceMode ()
appEnvInstanceId :: InstanceId
appEnvMetadataVersionRef :: TMVar MetadataResourceVersion
appEnvLoggers :: Loggers
appEnvManager :: Manager
appEnvIntrospectionDbPool :: Maybe PGPool
appEnvMetadataDbPool :: PGPool
appEnvHost :: HostPreference
appEnvPort :: Port
appEnvLicenseKeyCache :: AppEnv -&gt; Maybe (CredentialCache AgentLicenseKey)
appEnvSchemaPollInterval :: AppEnv -&gt; OptionalInterval
appEnvCheckFeatureFlag :: AppEnv -&gt; CheckFeatureFlag
appEnvGracefulShutdownTimeout :: AppEnv -&gt; Refined NonNegative Seconds
appEnvWebSocketConnectionInitTimeout :: AppEnv -&gt; WSConnectionInitTimeout
appEnvWebSocketKeepAlive :: AppEnv -&gt; KeepAliveDelay
appEnvConnectionOptions :: AppEnv -&gt; ConnectionOptions
appEnvConsoleSentryDsn :: AppEnv -&gt; Maybe Text
appEnvConsoleAssetsDir :: AppEnv -&gt; Maybe Text
appEnvTxIso :: AppEnv -&gt; TxIsolation
appEnvConnParams :: AppEnv -&gt; ConnParams
appEnvLockedEventsCtx :: AppEnv -&gt; LockedEventsCtx
appEnvSubscriptionState :: AppEnv -&gt; SubscriptionsState
appEnvTraceSamplingPolicy :: AppEnv -&gt; SamplingPolicy
appEnvPrometheusMetrics :: AppEnv -&gt; PrometheusMetrics
appEnvMetaVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvShutdownLatch :: AppEnv -&gt; ShutdownLatch
appEnvServerMetrics :: AppEnv -&gt; ServerMetrics
appEnvEnableReadOnlyMode :: AppEnv -&gt; ReadOnlyMode
appEnvEventingMode :: AppEnv -&gt; EventingMode
appEnvLoggingSettings :: AppEnv -&gt; LoggingSettings
appEnvEnableMaintenanceMode :: AppEnv -&gt; MaintenanceMode ()
appEnvInstanceId :: AppEnv -&gt; InstanceId
appEnvMetadataVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvLoggers :: AppEnv -&gt; Loggers
appEnvManager :: AppEnv -&gt; Manager
appEnvIntrospectionDbPool :: AppEnv -&gt; Maybe PGPool
appEnvMetadataDbPool :: AppEnv -&gt; PGPool
appEnvHost :: AppEnv -&gt; HostPreference
appEnvPort :: AppEnv -&gt; Port
</span><a href="#local-6989586621691177064"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasAppEnv m =&gt; m AppEnv
</span><a href="Hasura.App.State.html#askAppEnv"><span class="hs-identifier hs-var">askAppEnv</span></a></span><span>
</span><span id="line-497"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621691177062"><span class="annot"><span class="annottext">cacheStaticConfig :: CacheStaticConfig
</span><a href="#local-6989586621691177062"><span class="hs-identifier hs-var hs-var">cacheStaticConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppEnv -&gt; CacheStaticConfig
</span><a href="Hasura.App.State.html#buildCacheStaticConfig"><span class="hs-identifier hs-var">buildCacheStaticConfig</span></a></span><span> </span><span class="annot"><span class="annottext">AppEnv
</span><a href="#local-6989586621691177094"><span class="hs-identifier hs-var">appEnv</span></a></span><span>
</span><span id="line-498"></span><span>      </span><span class="annot"><a href="Hasura.App.State.html#Loggers"><span class="hs-identifier hs-type">Loggers</span></a></span><span> </span><span class="annot"><span class="annottext">LoggerCtx Hasura
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621691177060"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691177060"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621691177059"><span class="annot"><span class="annottext">PGLogger
</span><a href="#local-6989586621691177059"><span class="hs-identifier hs-var">pgLogger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Loggers
</span><a href="#local-6989586621691177088"><span class="hs-identifier hs-var">appEnvLoggers</span></a></span><span>
</span><span id="line-499"></span><span>      </span><span id="local-6989586621691177058"><span class="annot"><span class="annottext">sqlGenCtx :: SQLGenCtx
</span><a href="#local-6989586621691177058"><span class="hs-identifier hs-var hs-var">sqlGenCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
-&gt; StringifyNumbers -&gt; DangerouslyCollapseBooleans -&gt; SQLGenCtx
</span><a href="Hasura.App.State.html#initSQLGenCtx"><span class="hs-identifier hs-var">initSQLGenCtx</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621691177109"><span class="hs-identifier hs-var">soExperimentalFeatures</span></a></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621691177126"><span class="hs-identifier hs-var">soStringifyNum</span></a></span><span> </span><span class="annot"><span class="annottext">DangerouslyCollapseBooleans
</span><a href="#local-6989586621691177125"><span class="hs-identifier hs-var">soDangerousBooleanCollapse</span></a></span><span>
</span><span id="line-500"></span><span>      </span><span id="local-6989586621691177056"><span class="annot"><span class="annottext">cacheDynamicConfig :: CacheDynamicConfig
</span><a href="#local-6989586621691177056"><span class="hs-identifier hs-var hs-var">cacheDynamicConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-501"></span><span>        </span><span class="annot"><span class="annottext">InferFunctionPermissions
-&gt; RemoteSchemaPermissions
-&gt; SQLGenCtx
-&gt; HashSet ExperimentalFeature
-&gt; NamingCase
-&gt; MetadataDefaults
-&gt; ApolloFederationStatus
-&gt; CacheDynamicConfig
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#CacheDynamicConfig"><span class="hs-identifier hs-var">CacheDynamicConfig</span></a></span><span>
</span><span id="line-502"></span><span>          </span><span class="annot"><span class="annottext">InferFunctionPermissions
</span><a href="#local-6989586621691177112"><span class="hs-identifier hs-var">soInferFunctionPermissions</span></a></span><span>
</span><span id="line-503"></span><span>          </span><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621691177115"><span class="hs-identifier hs-var">soEnableRemoteSchemaPermissions</span></a></span><span>
</span><span id="line-504"></span><span>          </span><span class="annot"><span class="annottext">SQLGenCtx
</span><a href="#local-6989586621691177058"><span class="hs-identifier hs-var">sqlGenCtx</span></a></span><span>
</span><span id="line-505"></span><span>          </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621691177109"><span class="hs-identifier hs-var">soExperimentalFeatures</span></a></span><span>
</span><span id="line-506"></span><span>          </span><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621691177100"><span class="hs-identifier hs-var">soDefaultNamingConvention</span></a></span><span>
</span><span id="line-507"></span><span>          </span><span class="annot"><span class="annottext">MetadataDefaults
</span><a href="#local-6989586621691177098"><span class="hs-identifier hs-var">soMetadataDefaults</span></a></span><span>
</span><span id="line-508"></span><span>          </span><span class="annot"><span class="annottext">ApolloFederationStatus
</span><a href="#local-6989586621691177097"><span class="hs-identifier hs-var">soApolloFederationStatus</span></a></span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span>  </span><span class="hs-comment">-- Create the schema cache</span><span>
</span><span id="line-511"></span><span>  </span><span id="local-6989586621691177054"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621691177054"><span class="hs-identifier hs-var">rebuildableSchemaCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-512"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
Environment
-&gt; Logger Hasura
-&gt; SourceResolver ('Postgres 'Vanilla)
-&gt; SourceResolver 'MSSQL
-&gt; MetadataWithResourceVersion
-&gt; CacheStaticConfig
-&gt; CacheDynamicConfig
-&gt; Manager
-&gt; m RebuildableSchemaCache
</span><a href="Hasura.App.html#buildFirstSchemaCache"><span class="hs-identifier hs-var">buildFirstSchemaCache</span></a></span><span>
</span><span id="line-513"></span><span>      </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691177141"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-514"></span><span>      </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691177060"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-515"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PGLogger -&gt; SourceResolver ('Postgres 'Vanilla)
</span><a href="Hasura.App.html#mkPgSourceResolver"><span class="hs-identifier hs-var">mkPgSourceResolver</span></a></span><span> </span><span class="annot"><span class="annottext">PGLogger
</span><a href="#local-6989586621691177059"><span class="hs-identifier hs-var">pgLogger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span>      </span><span class="annot"><span class="annottext">SourceResolver 'MSSQL
</span><a href="Hasura.App.html#mkMSSQLSourceResolver"><span class="hs-identifier hs-var">mkMSSQLSourceResolver</span></a></span><span>
</span><span id="line-517"></span><span>      </span><span class="annot"><span class="annottext">MetadataWithResourceVersion
</span><a href="#local-6989586621691177095"><span class="hs-identifier hs-var">aiMetadataWithResourceVersion</span></a></span><span>
</span><span id="line-518"></span><span>      </span><span class="annot"><span class="annottext">CacheStaticConfig
</span><a href="#local-6989586621691177062"><span class="hs-identifier hs-var">cacheStaticConfig</span></a></span><span>
</span><span id="line-519"></span><span>      </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621691177056"><span class="hs-identifier hs-var">cacheDynamicConfig</span></a></span><span>
</span><span id="line-520"></span><span>      </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621691177089"><span class="hs-identifier hs-var">appEnvManager</span></a></span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span>  </span><span class="hs-comment">-- Build the RebuildableAppContext.</span><span>
</span><span id="line-523"></span><span>  </span><span class="hs-comment">-- (See note [Hasura Application State].)</span><span>
</span><span id="line-524"></span><span>  </span><span id="local-6989586621691177053"><span class="annot"><span class="annottext">Either QErr (RebuildableAppContext Hasura)
</span><a href="#local-6989586621691177053"><span class="hs-identifier hs-var">rebuildableAppCtxE</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall impl.
(Logger Hasura, Manager)
-&gt; ServeOptions impl
-&gt; Environment
-&gt; ExceptT QErr IO (RebuildableAppContext impl)
</span><a href="Hasura.App.State.html#buildRebuildableAppContext"><span class="hs-identifier hs-var">buildRebuildableAppContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691177060"><span class="hs-identifier hs-var">logger</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621691177089"><span class="hs-identifier hs-var">appEnvManager</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ServeOptions Hasura
</span><a href="#local-6989586621691177140"><span class="hs-identifier hs-var">serveOptions</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691177141"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621691177050"><span class="annot"><span class="annottext">RebuildableAppContext Hasura
</span><a href="#local-6989586621691177050"><span class="hs-identifier hs-var">rebuildableAppCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">onLeft</span></a></span><span> </span><span class="annot"><span class="annottext">Either QErr (RebuildableAppContext Hasura)
</span><a href="#local-6989586621691177053"><span class="hs-identifier hs-var">rebuildableAppCtxE</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621691177049"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621691177049"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; ExitCode -&gt; String -&gt; m a
</span><a href="Hasura.App.html#throwErrExit"><span class="hs-identifier hs-var">throwErrExit</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="Hasura.App.html#InvalidEnvironmentVariableOptionsError"><span class="hs-identifier hs-var">InvalidEnvironmentVariableOptionsError</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; Text
</span><span class="hs-identifier hs-var">qeError</span></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621691177049"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span>  </span><span class="hs-comment">-- Initialise the 'AppStateRef' from 'RebuildableSchemaCacheRef' and 'RebuildableAppContext'.</span><span>
</span><span id="line-528"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) impl.
MonadIO m =&gt;
TLSAllowListRef
-&gt; Maybe MetricsConfigRef
-&gt; ServerMetrics
-&gt; RebuildableSchemaCache
-&gt; RebuildableAppContext impl
-&gt; m (AppStateRef impl)
</span><a href="Hasura.Server.AppStateRef.html#initialiseAppStateRef"><span class="hs-identifier hs-var">initialiseAppStateRef</span></a></span><span> </span><span class="annot"><span class="annottext">TLSAllowListRef
</span><a href="#local-6989586621691177096"><span class="hs-identifier hs-var">aiTLSAllowListRef</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621691177081"><span class="hs-identifier hs-var">appEnvServerMetrics</span></a></span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621691177054"><span class="hs-identifier hs-var">rebuildableSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">RebuildableAppContext Hasura
</span><a href="#local-6989586621691177050"><span class="hs-identifier hs-var">rebuildableAppCtx</span></a></span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span class="hs-comment">-- | Runs catalogue migration, and returns the metadata that was fetched.</span><span>
</span><span id="line-531"></span><span class="hs-comment">--</span><span>
</span><span id="line-532"></span><span class="hs-comment">-- On success, this function logs the result of the migration, on failure it</span><span>
</span><span id="line-533"></span><span class="hs-comment">-- logs a 'catalog_migrate' error and throws a fatal error.</span><span>
</span><span id="line-534"></span><span id="local-6989586621691178420"><span class="annot"><a href="Hasura.App.html#migrateCatalogAndFetchMetadata"><span class="hs-identifier hs-type">migrateCatalogAndFetchMetadata</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-535"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178420"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178420"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-536"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-537"></span><span>  </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.PGPool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-538"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SourceConfiguration.html#SourceConnConfiguration"><span class="hs-identifier hs-type">SourceConnConfiguration</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#Vanilla"><span class="hs-identifier hs-type">Vanilla</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-539"></span><span>  </span><span class="annot"><a href="Hasura.Server.Types.html#MaintenanceMode"><span class="hs-identifier hs-type">MaintenanceMode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-540"></span><span>  </span><span class="annot"><a href="Hasura.SQL.Types.html#ExtensionsSchema"><span class="hs-identifier hs-type">ExtensionsSchema</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-541"></span><span>  </span><span class="annot"><a href="#local-6989586621691178420"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#MetadataWithResourceVersion"><span class="hs-identifier hs-type">MetadataWithResourceVersion</span></a></span></span><span>
</span><span id="line-542"></span><span id="migrateCatalogAndFetchMetadata"><span class="annot"><span class="annottext">migrateCatalogAndFetchMetadata :: forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m) =&gt;
Logger Hasura
-&gt; PGPool
-&gt; Maybe (SourceConnConfiguration ('Postgres 'Vanilla))
-&gt; MaintenanceMode ()
-&gt; ExtensionsSchema
-&gt; m MetadataWithResourceVersion
</span><a href="Hasura.App.html#migrateCatalogAndFetchMetadata"><span class="hs-identifier hs-var hs-var">migrateCatalogAndFetchMetadata</span></a></span></span><span>
</span><span id="line-543"></span><span>  </span><span id="local-6989586621691177013"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691177013"><span class="hs-identifier hs-var">logger</span></a></span></span><span>
</span><span id="line-544"></span><span>  </span><span id="local-6989586621691177012"><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621691177012"><span class="hs-identifier hs-var">pool</span></a></span></span><span>
</span><span id="line-545"></span><span>  </span><span id="local-6989586621691177011"><span class="annot"><span class="annottext">Maybe (SourceConnConfiguration ('Postgres 'Vanilla))
</span><a href="#local-6989586621691177011"><span class="hs-identifier hs-var">defaultSourceConfig</span></a></span></span><span>
</span><span id="line-546"></span><span>  </span><span id="local-6989586621691177010"><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621691177010"><span class="hs-identifier hs-var">maintenanceMode</span></a></span></span><span>
</span><span id="line-547"></span><span>  </span><span id="local-6989586621691177009"><span class="annot"><span class="annottext">ExtensionsSchema
</span><a href="#local-6989586621691177009"><span class="hs-identifier hs-var">extensionsSchema</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-548"></span><span>    </span><span class="hs-comment">-- TODO: should we allow the migration to happen during maintenance mode?</span><span>
</span><span id="line-549"></span><span>    </span><span class="hs-comment">-- Allowing this can be a sanity check, to see if the hdb_catalog in the</span><span>
</span><span id="line-550"></span><span>    </span><span class="hs-comment">-- DB has been set correctly</span><span>
</span><span id="line-551"></span><span>    </span><span id="local-6989586621691177008"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621691177008"><span class="hs-identifier hs-var">currentTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/time-1.11.1.1/src"><span class="hs-identifier hs-var">Clock.getCurrentTime</span></a></span><span>
</span><span id="line-552"></span><span>    </span><span id="local-6989586621691177006"><span class="annot"><span class="annottext">Either QErr (MigrationResult, MetadataWithResourceVersion)
</span><a href="#local-6989586621691177006"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-553"></span><span>      </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-554"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
(MonadIO m, MonadBaseControl IO m, FromPGTxErr e,
 FromPGConnErr e) =&gt;
PGPool -&gt; TxMode -&gt; TxET e m a -&gt; ExceptT e m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.runTx</span></a></span><span> </span><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621691177012"><span class="hs-identifier hs-var">pool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIsolation
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.Serializable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TxAccess
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.ReadWrite</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-555"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(MonadTx m, MonadIO m, MonadBaseControl IO m) =&gt;
Maybe (SourceConnConfiguration ('Postgres 'Vanilla))
-&gt; ExtensionsSchema
-&gt; MaintenanceMode ()
-&gt; UTCTime
-&gt; m (MigrationResult, MetadataWithResourceVersion)
</span><a href="Hasura.Server.Migrate.html#migrateCatalog"><span class="hs-identifier hs-var">migrateCatalog</span></a></span><span>
</span><span id="line-556"></span><span>            </span><span class="annot"><span class="annottext">Maybe (SourceConnConfiguration ('Postgres 'Vanilla))
</span><a href="#local-6989586621691177011"><span class="hs-identifier hs-var">defaultSourceConfig</span></a></span><span>
</span><span id="line-557"></span><span>            </span><span class="annot"><span class="annottext">ExtensionsSchema
</span><a href="#local-6989586621691177009"><span class="hs-identifier hs-var">extensionsSchema</span></a></span><span>
</span><span id="line-558"></span><span>            </span><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621691177010"><span class="hs-identifier hs-var">maintenanceMode</span></a></span><span>
</span><span id="line-559"></span><span>            </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621691177008"><span class="hs-identifier hs-var">currentTime</span></a></span><span>
</span><span id="line-560"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either QErr (MigrationResult, MetadataWithResourceVersion)
</span><a href="#local-6989586621691177006"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-561"></span><span>      </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621691177002"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621691177002"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-562"></span><span>        </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span>
</span><span id="line-563"></span><span>          </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691177013"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-564"></span><span>          </span><span class="annot"><a href="Hasura.Server.Logging.html#StartupLog"><span class="hs-identifier hs-type">StartupLog</span></a></span><span>
</span><span id="line-565"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">slLogLevel :: LogLevel
</span><a href="Hasura.Server.Logging.html#slLogLevel"><span class="hs-identifier hs-var">slLogLevel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelError"><span class="hs-identifier hs-var">LevelError</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-566"></span><span>              </span><span class="annot"><span class="annottext">slKind :: Text
</span><a href="Hasura.Server.Logging.html#slKind"><span class="hs-identifier hs-var">slKind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;catalog_migrate&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-567"></span><span>              </span><span class="annot"><span class="annottext">slInfo :: Value
</span><a href="Hasura.Server.Logging.html#slInfo"><span class="hs-identifier hs-var">slInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">J.toJSON</span></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621691177002"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-568"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-569"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *) b.
(ToJSON a, MonadIO m) =&gt;
ExitCode -&gt; a -&gt; m b
</span><a href="Hasura.App.html#throwErrJExit"><span class="hs-identifier hs-var">throwErrJExit</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="Hasura.App.html#DatabaseMigrationError"><span class="hs-identifier hs-var">DatabaseMigrationError</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621691177002"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span>      </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621691177000"><span class="annot"><span class="annottext">MigrationResult
</span><a href="#local-6989586621691177000"><span class="hs-identifier hs-var">migrationResult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621691176999"><span class="annot"><span class="annottext">MetadataWithResourceVersion
</span><a href="#local-6989586621691176999"><span class="hs-identifier hs-var">metadataWithVersion</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-571"></span><span>        </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691177013"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">MigrationResult
</span><a href="#local-6989586621691177000"><span class="hs-identifier hs-var">migrationResult</span></a></span><span>
</span><span id="line-572"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataWithResourceVersion
</span><a href="#local-6989586621691176999"><span class="hs-identifier hs-var">metadataWithVersion</span></a></span><span>
</span><span id="line-573"></span><span>
</span><span id="line-574"></span><span class="hs-comment">-- | Build the original 'RebuildableSchemaCache'.</span><span>
</span><span id="line-575"></span><span class="hs-comment">--</span><span>
</span><span id="line-576"></span><span class="hs-comment">-- On error, it logs a 'catalog_migrate' error and throws a fatal error. This</span><span>
</span><span id="line-577"></span><span class="hs-comment">-- misnomer is intentional: it is to preserve a previous behaviour of the code</span><span>
</span><span id="line-578"></span><span class="hs-comment">-- and avoid a breaking change.</span><span>
</span><span id="line-579"></span><span id="local-6989586621691178386"><span class="annot"><a href="Hasura.App.html#buildFirstSchemaCache"><span class="hs-identifier hs-type">buildFirstSchemaCache</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-580"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178386"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-581"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Env.Environment</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-582"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-583"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceResolver"><span class="hs-identifier hs-type">SourceResolver</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#Vanilla"><span class="hs-identifier hs-type">Vanilla</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-584"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceResolver"><span class="hs-identifier hs-type">SourceResolver</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#MSSQL"><span class="hs-identifier hs-type">MSSQL</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-585"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#MetadataWithResourceVersion"><span class="hs-identifier hs-type">MetadataWithResourceVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-586"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#CacheStaticConfig"><span class="hs-identifier hs-type">CacheStaticConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-587"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#CacheDynamicConfig"><span class="hs-identifier hs-type">CacheDynamicConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-588"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HTTP.Manager</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-589"></span><span>  </span><span class="annot"><a href="#local-6989586621691178386"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span></span><span>
</span><span id="line-590"></span><span id="buildFirstSchemaCache"><span class="annot"><span class="annottext">buildFirstSchemaCache :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Environment
-&gt; Logger Hasura
-&gt; SourceResolver ('Postgres 'Vanilla)
-&gt; SourceResolver 'MSSQL
-&gt; MetadataWithResourceVersion
-&gt; CacheStaticConfig
-&gt; CacheDynamicConfig
-&gt; Manager
-&gt; m RebuildableSchemaCache
</span><a href="Hasura.App.html#buildFirstSchemaCache"><span class="hs-identifier hs-var hs-var">buildFirstSchemaCache</span></a></span></span><span>
</span><span id="line-591"></span><span>  </span><span id="local-6989586621691176983"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691176983"><span class="hs-identifier hs-var">env</span></a></span></span><span>
</span><span id="line-592"></span><span>  </span><span id="local-6989586621691176982"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691176982"><span class="hs-identifier hs-var">logger</span></a></span></span><span>
</span><span id="line-593"></span><span>  </span><span id="local-6989586621691176981"><span class="annot"><span class="annottext">SourceResolver ('Postgres 'Vanilla)
</span><a href="#local-6989586621691176981"><span class="hs-identifier hs-var">pgSourceResolver</span></a></span></span><span>
</span><span id="line-594"></span><span>  </span><span id="local-6989586621691176980"><span class="annot"><span class="annottext">SourceResolver 'MSSQL
</span><a href="#local-6989586621691176980"><span class="hs-identifier hs-var">mssqlSourceResolver</span></a></span></span><span>
</span><span id="line-595"></span><span>  </span><span id="local-6989586621691176979"><span class="annot"><span class="annottext">MetadataWithResourceVersion
</span><a href="#local-6989586621691176979"><span class="hs-identifier hs-var">metadataWithVersion</span></a></span></span><span>
</span><span id="line-596"></span><span>  </span><span id="local-6989586621691176978"><span class="annot"><span class="annottext">CacheStaticConfig
</span><a href="#local-6989586621691176978"><span class="hs-identifier hs-var">cacheStaticConfig</span></a></span></span><span>
</span><span id="line-597"></span><span>  </span><span id="local-6989586621691176977"><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621691176977"><span class="hs-identifier hs-var">cacheDynamicConfig</span></a></span></span><span>
</span><span id="line-598"></span><span>  </span><span id="local-6989586621691176976"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621691176976"><span class="hs-identifier hs-var">httpManager</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-599"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621691176975"><span class="annot"><span class="annottext">cacheBuildParams :: CacheBuildParams
</span><a href="#local-6989586621691176975"><span class="hs-identifier hs-var hs-var">cacheBuildParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Manager
-&gt; SourceResolver ('Postgres 'Vanilla)
-&gt; SourceResolver 'MSSQL
-&gt; CacheStaticConfig
-&gt; CacheBuildParams
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#CacheBuildParams"><span class="hs-identifier hs-var">CacheBuildParams</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621691176976"><span class="hs-identifier hs-var">httpManager</span></a></span><span> </span><span class="annot"><span class="annottext">SourceResolver ('Postgres 'Vanilla)
</span><a href="#local-6989586621691176981"><span class="hs-identifier hs-var">pgSourceResolver</span></a></span><span> </span><span class="annot"><span class="annottext">SourceResolver 'MSSQL
</span><a href="#local-6989586621691176980"><span class="hs-identifier hs-var">mssqlSourceResolver</span></a></span><span> </span><span class="annot"><span class="annottext">CacheStaticConfig
</span><a href="#local-6989586621691176978"><span class="hs-identifier hs-var">cacheStaticConfig</span></a></span><span>
</span><span id="line-600"></span><span>        </span><span id="local-6989586621691176973"><span class="annot"><span class="annottext">buildReason :: BuildReason
</span><a href="#local-6989586621691176973"><span class="hs-identifier hs-var hs-var">buildReason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuildReason
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogSync"><span class="hs-identifier hs-var">CatalogSync</span></a></span><span>
</span><span id="line-601"></span><span>    </span><span id="local-6989586621691176971"><span class="annot"><span class="annottext">Either QErr RebuildableSchemaCache
</span><a href="#local-6989586621691176971"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-602"></span><span>      </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-603"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(MonadIO m, MonadError QErr m) =&gt;
CacheBuildParams -&gt; CacheBuild a -&gt; m a
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#runCacheBuild"><span class="hs-identifier hs-var">runCacheBuild</span></a></span><span> </span><span class="annot"><span class="annottext">CacheBuildParams
</span><a href="#local-6989586621691176975"><span class="hs-identifier hs-var">cacheBuildParams</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-604"></span><span>          </span><span class="annot"><span class="annottext">BuildReason
-&gt; Logger Hasura
-&gt; Environment
-&gt; MetadataWithResourceVersion
-&gt; CacheDynamicConfig
-&gt; CacheBuild RebuildableSchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildRebuildableSchemaCacheWithReason"><span class="hs-identifier hs-var">buildRebuildableSchemaCacheWithReason</span></a></span><span> </span><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621691176973"><span class="hs-identifier hs-var">buildReason</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691176982"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691176983"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataWithResourceVersion
</span><a href="#local-6989586621691176979"><span class="hs-identifier hs-var">metadataWithVersion</span></a></span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621691176977"><span class="hs-identifier hs-var">cacheDynamicConfig</span></a></span><span>
</span><span id="line-605"></span><span>    </span><span class="annot"><span class="annottext">Either QErr RebuildableSchemaCache
</span><a href="#local-6989586621691176971"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-operator hs-var">`onLeft`</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621691176968"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621691176968"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-606"></span><span>      </span><span class="hs-comment">-- TODO: we used to bundle the first schema cache build with the catalog</span><span>
</span><span id="line-607"></span><span>      </span><span class="hs-comment">-- migration, using the same error handler for both, meaning that an</span><span>
</span><span id="line-608"></span><span>      </span><span class="hs-comment">-- error in the first schema cache build would be reported as</span><span>
</span><span id="line-609"></span><span>      </span><span class="hs-comment">-- follows. Changing this will be a breaking change.</span><span>
</span><span id="line-610"></span><span>      </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span>
</span><span id="line-611"></span><span>        </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691176982"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-612"></span><span>        </span><span class="annot"><a href="Hasura.Server.Logging.html#StartupLog"><span class="hs-identifier hs-type">StartupLog</span></a></span><span>
</span><span id="line-613"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">slLogLevel :: LogLevel
</span><a href="Hasura.Server.Logging.html#slLogLevel"><span class="hs-identifier hs-var">slLogLevel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelError"><span class="hs-identifier hs-var">LevelError</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-614"></span><span>            </span><span class="annot"><span class="annottext">slKind :: Text
</span><a href="Hasura.Server.Logging.html#slKind"><span class="hs-identifier hs-var">slKind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;catalog_migrate&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-615"></span><span>            </span><span class="annot"><span class="annottext">slInfo :: Value
</span><a href="Hasura.Server.Logging.html#slInfo"><span class="hs-identifier hs-var">slInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">J.toJSON</span></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621691176968"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-616"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-617"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *) b.
(ToJSON a, MonadIO m) =&gt;
ExitCode -&gt; a -&gt; m b
</span><a href="Hasura.App.html#throwErrJExit"><span class="hs-identifier hs-var">throwErrJExit</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="Hasura.App.html#DatabaseMigrationError"><span class="hs-identifier hs-var">DatabaseMigrationError</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621691176968"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>
</span><span id="line-619"></span><span class="annot"><a href="Hasura.App.html#initSubscriptionsState"><span class="hs-identifier hs-type">initSubscriptionsState</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-620"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-621"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.Poll.Common.html#SubscriptionPostPollHook"><span class="hs-identifier hs-type">ES.SubscriptionPostPollHook</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-622"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.State.html#SubscriptionsState"><span class="hs-identifier hs-type">ES.SubscriptionsState</span></a></span><span>
</span><span id="line-623"></span><span id="initSubscriptionsState"><span class="annot"><span class="annottext">initSubscriptionsState :: Logger Hasura
-&gt; Maybe SubscriptionPostPollHook -&gt; IO SubscriptionsState
</span><a href="Hasura.App.html#initSubscriptionsState"><span class="hs-identifier hs-var hs-var">initSubscriptionsState</span></a></span></span><span> </span><span id="local-6989586621691176967"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691176967"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621691176966"><span class="annot"><span class="annottext">Maybe SubscriptionPostPollHook
</span><a href="#local-6989586621691176966"><span class="hs-identifier hs-var">liveQueryHook</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubscriptionPostPollHook -&gt; IO SubscriptionsState
</span><a href="Hasura.GraphQL.Execute.Subscription.State.html#initSubscriptionsState"><span class="hs-identifier hs-var">ES.initSubscriptionsState</span></a></span><span> </span><span class="annot"><span class="annottext">SubscriptionPostPollHook
</span><a href="#local-6989586621691176964"><span class="hs-identifier hs-var">postPollHook</span></a></span><span>
</span><span id="line-624"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-625"></span><span>    </span><span id="local-6989586621691176964"><span class="annot"><span class="annottext">postPollHook :: SubscriptionPostPollHook
</span><a href="#local-6989586621691176964"><span class="hs-identifier hs-var hs-var">postPollHook</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger Hasura -&gt; SubscriptionPostPollHook
</span><a href="Hasura.GraphQL.Execute.Subscription.Poll.Common.html#defaultSubscriptionPostPollHook"><span class="hs-identifier hs-var">ES.defaultSubscriptionPostPollHook</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691176967"><span class="hs-identifier hs-var">logger</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe SubscriptionPostPollHook
</span><a href="#local-6989586621691176966"><span class="hs-identifier hs-var">liveQueryHook</span></a></span><span>
</span><span id="line-626"></span><span>
</span><span id="line-627"></span><span class="annot"><a href="Hasura.App.html#initLockedEventsCtx"><span class="hs-identifier hs-type">initLockedEventsCtx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Hasura.Eventing.Common.html#LockedEventsCtx"><span class="hs-identifier hs-type">LockedEventsCtx</span></a></span><span>
</span><span id="line-628"></span><span id="initLockedEventsCtx"><span class="annot"><span class="annottext">initLockedEventsCtx :: IO LockedEventsCtx
</span><a href="Hasura.App.html#initLockedEventsCtx"><span class="hs-identifier hs-var hs-var">initLockedEventsCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-629"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a1 a2 a3 a4 r.
Monad m =&gt;
(a1 -&gt; a2 -&gt; a3 -&gt; a4 -&gt; r) -&gt; m a1 -&gt; m a2 -&gt; m a3 -&gt; m a4 -&gt; m r
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftM4</span></a></span><span>
</span><span id="line-630"></span><span>    </span><span class="annot"><span class="annottext">TVar (Set CronEventId)
-&gt; TVar (Set CronEventId)
-&gt; TVar (HashMap SourceName (Set CronEventId))
-&gt; TVar (Set CronEventId)
-&gt; LockedEventsCtx
</span><a href="Hasura.Eventing.Common.html#LockedEventsCtx"><span class="hs-identifier hs-var">LockedEventsCtx</span></a></span><span>
</span><span id="line-631"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">STM.newTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-632"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">STM.newTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-633"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">STM.newTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-634"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">STM.newTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-635"></span><span>
</span><span id="line-636"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-637"></span><span class="hs-comment">-- App monad</span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span class="hs-comment">-- | The base app monad of the CE engine.</span><span>
</span><span id="line-640"></span><span class="hs-keyword">newtype</span><span> </span><span id="AppM"><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-var">AppM</span></a></span></span><span> </span><span id="local-6989586621691178207"><span class="annot"><a href="#local-6989586621691178207"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AppM"><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-var">AppM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-type">ReaderT</span></a></span><span> </span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">AppEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.Monad.html#TraceT"><span class="hs-identifier hs-type">TraceT</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621691178207"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-641"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span>
</span><span id="line-642"></span><span>    </span><span class="hs-special">(</span><span> </span><span id="local-6989586621691176951"><span id="local-6989586621691176957"><span class="annot"><span class="annottext">forall a b. a -&gt; AppM b -&gt; AppM a
forall a b. (a -&gt; b) -&gt; AppM a -&gt; AppM b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: forall a b. a -&gt; AppM b -&gt; AppM a
$c&lt;$ :: forall a b. a -&gt; AppM b -&gt; AppM a
fmap :: forall a b. (a -&gt; b) -&gt; AppM a -&gt; AppM b
$cfmap :: forall a b. (a -&gt; b) -&gt; AppM a -&gt; AppM b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></a></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-643"></span><span>      </span><span id="local-6989586621691176920"><span id="local-6989586621691176925"><span id="local-6989586621691176930"><span id="local-6989586621691176935"><span id="local-6989586621691176941"><span class="annot"><span class="annottext">Functor AppM
forall a. a -&gt; AppM a
forall a b. AppM a -&gt; AppM b -&gt; AppM a
forall a b. AppM a -&gt; AppM b -&gt; AppM b
forall a b. AppM (a -&gt; b) -&gt; AppM a -&gt; AppM b
forall a b c. (a -&gt; b -&gt; c) -&gt; AppM a -&gt; AppM b -&gt; AppM c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
&lt;* :: forall a b. AppM a -&gt; AppM b -&gt; AppM a
$c&lt;* :: forall a b. AppM a -&gt; AppM b -&gt; AppM a
*&gt; :: forall a b. AppM a -&gt; AppM b -&gt; AppM b
$c*&gt; :: forall a b. AppM a -&gt; AppM b -&gt; AppM b
liftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; AppM a -&gt; AppM b -&gt; AppM c
$cliftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; AppM a -&gt; AppM b -&gt; AppM c
&lt;*&gt; :: forall a b. AppM (a -&gt; b) -&gt; AppM a -&gt; AppM b
$c&lt;*&gt; :: forall a b. AppM (a -&gt; b) -&gt; AppM a -&gt; AppM b
pure :: forall a. a -&gt; AppM a
$cpure :: forall a. a -&gt; AppM a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></a></span></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-644"></span><span>      </span><span id="local-6989586621691176893"><span id="local-6989586621691176898"><span id="local-6989586621691176904"><span class="annot"><span class="annottext">Applicative AppM
forall a. a -&gt; AppM a
forall a b. AppM a -&gt; AppM b -&gt; AppM b
forall a b. AppM a -&gt; (a -&gt; AppM b) -&gt; AppM b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
return :: forall a. a -&gt; AppM a
$creturn :: forall a. a -&gt; AppM a
&gt;&gt; :: forall a b. AppM a -&gt; AppM b -&gt; AppM b
$c&gt;&gt; :: forall a b. AppM a -&gt; AppM b -&gt; AppM b
&gt;&gt;= :: forall a b. AppM a -&gt; (a -&gt; AppM b) -&gt; AppM b
$c&gt;&gt;= :: forall a b. AppM a -&gt; (a -&gt; AppM b) -&gt; AppM b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-645"></span><span>      </span><span id="local-6989586621691176883"><span class="annot"><span class="annottext">Monad AppM
forall a. IO a -&gt; AppM a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. IO a -&gt; m a) -&gt; MonadIO m
liftIO :: forall a. IO a -&gt; AppM a
$cliftIO :: forall a. IO a -&gt; AppM a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-646"></span><span>      </span><span id="local-6989586621691176872"><span class="annot"><span class="annottext">Monad AppM
forall a. (a -&gt; AppM a) -&gt; AppM a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. (a -&gt; m a) -&gt; m a) -&gt; MonadFix m
mfix :: forall a. (a -&gt; AppM a) -&gt; AppM a
$cmfix :: forall a. (a -&gt; AppM a) -&gt; AppM a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadFix</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-647"></span><span>      </span><span id="local-6989586621691176856"><span class="annot"><span class="annottext">MonadThrow AppM
forall e a. Exception e =&gt; AppM a -&gt; (e -&gt; AppM a) -&gt; AppM a
forall (m :: * -&gt; *).
MonadThrow m
-&gt; (forall e a. Exception e =&gt; m a -&gt; (e -&gt; m a) -&gt; m a)
-&gt; MonadCatch m
catch :: forall e a. Exception e =&gt; AppM a -&gt; (e -&gt; AppM a) -&gt; AppM a
$ccatch :: forall e a. Exception e =&gt; AppM a -&gt; (e -&gt; AppM a) -&gt; AppM a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadCatch</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-648"></span><span>      </span><span id="local-6989586621691176839"><span class="annot"><span class="annottext">Monad AppM
forall e a. Exception e =&gt; e -&gt; AppM a
forall (m :: * -&gt; *).
Monad m -&gt; (forall e a. Exception e =&gt; e -&gt; m a) -&gt; MonadThrow m
throwM :: forall e a. Exception e =&gt; e -&gt; AppM a
$cthrowM :: forall e a. Exception e =&gt; e -&gt; AppM a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadThrow</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-649"></span><span>      </span><span id="local-6989586621691176814"><span id="local-6989586621691176819"><span id="local-6989586621691176825"><span class="annot"><span class="annottext">MonadCatch AppM
forall b. ((forall a. AppM a -&gt; AppM a) -&gt; AppM b) -&gt; AppM b
forall a b c.
AppM a
-&gt; (a -&gt; ExitCase b -&gt; AppM c) -&gt; (a -&gt; AppM b) -&gt; AppM (b, c)
forall (m :: * -&gt; *).
MonadCatch m
-&gt; (forall b. ((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b)
-&gt; (forall b. ((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b)
-&gt; (forall a b c.
    m a -&gt; (a -&gt; ExitCase b -&gt; m c) -&gt; (a -&gt; m b) -&gt; m (b, c))
-&gt; MonadMask m
generalBracket :: forall a b c.
AppM a
-&gt; (a -&gt; ExitCase b -&gt; AppM c) -&gt; (a -&gt; AppM b) -&gt; AppM (b, c)
$cgeneralBracket :: forall a b c.
AppM a
-&gt; (a -&gt; ExitCase b -&gt; AppM c) -&gt; (a -&gt; AppM b) -&gt; AppM (b, c)
uninterruptibleMask :: forall b. ((forall a. AppM a -&gt; AppM a) -&gt; AppM b) -&gt; AppM b
$cuninterruptibleMask :: forall b. ((forall a. AppM a -&gt; AppM a) -&gt; AppM b) -&gt; AppM b
mask :: forall b. ((forall a. AppM a -&gt; AppM a) -&gt; AppM b) -&gt; AppM b
$cmask :: forall b. ((forall a. AppM a -&gt; AppM a) -&gt; AppM b) -&gt; AppM b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadMask</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-650"></span><span>      </span><span id="local-6989586621691176789"><span id="local-6989586621691176794"><span id="local-6989586621691176800"><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-type">MonadReader</span></a></span><span> </span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">AppEnv</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-651"></span><span>      </span><span id="local-6989586621691176774"><span class="annot"><span class="hs-identifier hs-type">MonadBase</span></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-652"></span><span>      </span><span id="local-6989586621691176754"><span id="local-6989586621691176761"><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span></span></span><span>
</span><span id="line-653"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-654"></span><span>
</span><span id="line-655"></span><span id="local-6989586621691178216"><span class="annot"><a href="Hasura.App.html#runAppM"><span class="hs-identifier hs-type">runAppM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">AppEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178216"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178216"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-656"></span><span id="runAppM"><span class="annot"><span class="annottext">runAppM :: forall a. AppEnv -&gt; AppM a -&gt; IO a
</span><a href="Hasura.App.html#runAppM"><span class="hs-identifier hs-var hs-var">runAppM</span></a></span></span><span> </span><span id="local-6989586621691176743"><span class="annot"><span class="annottext">AppEnv
</span><a href="#local-6989586621691176743"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span id="local-6989586621691176742"><span class="annot"><span class="annottext">ReaderT AppEnv (TraceT IO) a
</span><a href="#local-6989586621691176742"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. TraceT m a -&gt; m a
</span><a href="Hasura.Tracing.Monad.html#ignoreTraceT"><span class="hs-identifier hs-var">ignoreTraceT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runReaderT</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT AppEnv (TraceT IO) a
</span><a href="#local-6989586621691176742"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">AppEnv
</span><a href="#local-6989586621691176743"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.App.State.html#HasAppEnv"><span class="hs-identifier hs-type">HasAppEnv</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-659"></span><span>  </span><span id="local-6989586621691176733"><span class="annot"><span class="annottext">askAppEnv :: AppM AppEnv
</span><a href="#local-6989586621691176733"><span class="hs-identifier hs-var hs-var hs-var hs-var">askAppEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-var">ask</span></a></span><span>
</span><span id="line-660"></span><span>
</span><span id="line-661"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Server.Init.FeatureFlag.html#HasFeatureFlagChecker"><span class="hs-identifier hs-type">HasFeatureFlagChecker</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-662"></span><span>  </span><span id="local-6989586621691176721"><span class="annot"><span class="annottext">checkFlag :: FeatureFlag -&gt; AppM Bool
</span><a href="Hasura.Server.Init.FeatureFlag.html#checkFlag"><span class="hs-identifier hs-var hs-var hs-var hs-var">checkFlag</span></a></span></span><span> </span><span id="local-6989586621691176719"><span class="annot"><span class="annottext">FeatureFlag
</span><a href="#local-6989586621691176719"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. ReaderT AppEnv (TraceT IO) a -&gt; AppM a
</span><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-var">AppM</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-663"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.FeatureFlag.html#CheckFeatureFlag"><span class="hs-identifier hs-type">CheckFeatureFlag</span></a></span><span> </span><span id="local-6989586621691176718"><span class="annot"><span class="annottext">FeatureFlag -&gt; IO Bool
</span><a href="#local-6989586621691176718"><span class="hs-identifier hs-var">runCheckFeatureFlag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">AppEnv -&gt; CheckFeatureFlag
</span><a href="Hasura.App.State.html#appEnvCheckFeatureFlag"><span class="hs-identifier hs-var">appEnvCheckFeatureFlag</span></a></span><span>
</span><span id="line-664"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FeatureFlag -&gt; IO Bool
</span><a href="#local-6989586621691176718"><span class="hs-identifier hs-var">runCheckFeatureFlag</span></a></span><span> </span><span class="annot"><span class="annottext">FeatureFlag
</span><a href="#local-6989586621691176719"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-665"></span><span>
</span><span id="line-666"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#HasCacheStaticConfig"><span class="hs-identifier hs-type">HasCacheStaticConfig</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-667"></span><span>  </span><span id="local-6989586621691176709"><span class="annot"><span class="annottext">askCacheStaticConfig :: AppM CacheStaticConfig
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#askCacheStaticConfig"><span class="hs-identifier hs-var hs-var hs-var hs-var">askCacheStaticConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppEnv -&gt; CacheStaticConfig
</span><a href="Hasura.App.State.html#buildCacheStaticConfig"><span class="hs-identifier hs-var">buildCacheStaticConfig</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasAppEnv m =&gt; m AppEnv
</span><a href="Hasura.App.State.html#askAppEnv"><span class="hs-identifier hs-var">askAppEnv</span></a></span><span>
</span><span id="line-668"></span><span>
</span><span id="line-669"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-type">MonadTrace</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-670"></span><span>  </span><span id="local-6989586621691176693"><span class="annot"><span class="annottext">newTraceWith :: forall a.
TraceContext -&gt; SamplingPolicy -&gt; Text -&gt; AppM a -&gt; AppM a
</span><a href="Hasura.Tracing.Class.html#newTraceWith"><span class="hs-identifier hs-var hs-var hs-var hs-var">newTraceWith</span></a></span></span><span> </span><span id="local-6989586621691176691"><span class="annot"><span class="annottext">TraceContext
</span><a href="#local-6989586621691176691"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621691176690"><span class="annot"><span class="annottext">SamplingPolicy
</span><a href="#local-6989586621691176690"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621691176689"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691176689"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span id="local-6989586621691176688"><span class="annot"><span class="annottext">ReaderT AppEnv (TraceT IO) a
</span><a href="#local-6989586621691176688"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. ReaderT AppEnv (TraceT IO) a -&gt; AppM a
</span><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-var">AppM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadTrace m =&gt;
TraceContext -&gt; SamplingPolicy -&gt; Text -&gt; m a -&gt; m a
</span><a href="Hasura.Tracing.Class.html#newTraceWith"><span class="hs-identifier hs-var">newTraceWith</span></a></span><span> </span><span class="annot"><span class="annottext">TraceContext
</span><a href="#local-6989586621691176691"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">SamplingPolicy
</span><a href="#local-6989586621691176690"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691176689"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT AppEnv (TraceT IO) a
</span><a href="#local-6989586621691176688"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-671"></span><span>  </span><span id="local-6989586621691176684"><span class="annot"><span class="annottext">newSpanWith :: forall a. SpanId -&gt; Text -&gt; AppM a -&gt; AppM a
</span><a href="Hasura.Tracing.Class.html#newSpanWith"><span class="hs-identifier hs-var hs-var hs-var hs-var">newSpanWith</span></a></span></span><span> </span><span id="local-6989586621691176682"><span class="annot"><span class="annottext">SpanId
</span><a href="#local-6989586621691176682"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621691176681"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691176681"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span id="local-6989586621691176680"><span class="annot"><span class="annottext">ReaderT AppEnv (TraceT IO) a
</span><a href="#local-6989586621691176680"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. ReaderT AppEnv (TraceT IO) a -&gt; AppM a
</span><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-var">AppM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadTrace m =&gt;
SpanId -&gt; Text -&gt; m a -&gt; m a
</span><a href="Hasura.Tracing.Class.html#newSpanWith"><span class="hs-identifier hs-var">newSpanWith</span></a></span><span> </span><span class="annot"><span class="annottext">SpanId
</span><a href="#local-6989586621691176682"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691176681"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT AppEnv (TraceT IO) a
</span><a href="#local-6989586621691176680"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-672"></span><span>  </span><span id="local-6989586621691176676"><span class="annot"><span class="annottext">currentContext :: AppM (Maybe TraceContext)
</span><a href="Hasura.Tracing.Class.html#currentContext"><span class="hs-identifier hs-var hs-var hs-var hs-var">currentContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. ReaderT AppEnv (TraceT IO) a -&gt; AppM a
</span><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-var">AppM</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadTrace m =&gt; m (Maybe TraceContext)
</span><a href="Hasura.Tracing.Class.html#currentContext"><span class="hs-identifier hs-var">currentContext</span></a></span><span>
</span><span id="line-673"></span><span>  </span><span id="local-6989586621691176671"><span class="annot"><span class="annottext">attachMetadata :: TraceMetadata -&gt; AppM ()
</span><a href="Hasura.Tracing.Class.html#attachMetadata"><span class="hs-identifier hs-var hs-var hs-var hs-var">attachMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. ReaderT AppEnv (TraceT IO) a -&gt; AppM a
</span><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-var">AppM</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadTrace m =&gt; TraceMetadata -&gt; m ()
</span><a href="Hasura.Tracing.Class.html#attachMetadata"><span class="hs-identifier hs-var">attachMetadata</span></a></span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-676"></span><span>  </span><span id="local-6989586621691176663"><span class="annot"><span class="annottext">askHTTPManager :: AppM Manager
</span><a href="Hasura.Services.Network.html#askHTTPManager"><span class="hs-identifier hs-var hs-var hs-var hs-var">askHTTPManager</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">AppEnv -&gt; Manager
</span><a href="Hasura.App.State.html#appEnvManager"><span class="hs-identifier hs-var">appEnvManager</span></a></span><span>
</span><span id="line-677"></span><span>
</span><span id="line-678"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-679"></span><span>  </span><span id="local-6989586621691176654"><span class="annot"><span class="annottext">askHTTPHandlerLimit :: AppM ResourceLimits
</span><a href="Hasura.Server.Limits.html#askHTTPHandlerLimit"><span class="hs-identifier hs-var hs-var hs-var hs-var">askHTTPHandlerLimit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(forall (m :: * -&gt; *) a.
 (MonadBaseControl IO m, MonadError QErr m) =&gt;
 m a -&gt; m a)
-&gt; ResourceLimits
</span><a href="Hasura.Server.Limits.html#ResourceLimits"><span class="hs-identifier hs-var">ResourceLimits</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-680"></span><span>  </span><span id="local-6989586621691176647"><span class="annot"><span class="annottext">askGraphqlOperationLimit :: RequestId -&gt; UserInfo -&gt; ApiLimit -&gt; AppM ResourceLimits
</span><a href="Hasura.Server.Limits.html#askGraphqlOperationLimit"><span class="hs-identifier hs-var hs-var hs-var hs-var">askGraphqlOperationLimit</span></a></span></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ApiLimit
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(forall (m :: * -&gt; *) a.
 (MonadBaseControl IO m, MonadError QErr m) =&gt;
 m a -&gt; m a)
-&gt; ResourceLimits
</span><a href="Hasura.Server.Limits.html#ResourceLimits"><span class="hs-identifier hs-var">ResourceLimits</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-681"></span><span>
</span><span id="line-682"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-683"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ExtraHttpLogMetadata"><span class="annot"><a href="Hasura.Server.Logging.html#ExtraHttpLogMetadata"><span class="hs-identifier hs-var">ExtraHttpLogMetadata</span></a></span></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-684"></span><span>
</span><span id="line-685"></span><span>  </span><span id="local-6989586621691176635"><span class="annot"><span class="annottext">emptyExtraHttpLogMetadata :: ExtraHttpLogMetadata AppM
</span><a href="Hasura.Server.Logging.html#emptyExtraHttpLogMetadata"><span class="hs-identifier hs-var hs-var hs-var hs-var">emptyExtraHttpLogMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-686"></span><span>
</span><span id="line-687"></span><span>  </span><span id="local-6989586621691176633"><span class="annot"><span class="annottext">buildExtraHttpLogMetadata :: ParameterizedQueryHashList
-&gt; ExtraUserInfo -&gt; ExtraHttpLogMetadata AppM
</span><a href="Hasura.Server.Logging.html#buildExtraHttpLogMetadata"><span class="hs-identifier hs-var hs-var hs-var hs-var">buildExtraHttpLogMetadata</span></a></span></span><span> </span><span class="annot"><span class="annottext">ParameterizedQueryHashList
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ExtraUserInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span>  </span><span id="local-6989586621691176628"><span class="annot"><span class="annottext">logHttpError :: Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; QErr
-&gt; [Header]
-&gt; HttpLogMetadata AppM
-&gt; AppM ()
</span><a href="Hasura.Server.Logging.html#logHttpError"><span class="hs-identifier hs-var hs-var hs-var hs-var">logHttpError</span></a></span></span><span> </span><span id="local-6989586621691176626"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691176626"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621691176625"><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621691176625"><span class="hs-identifier hs-var">loggingSettings</span></a></span></span><span> </span><span id="local-6989586621691176624"><span class="annot"><span class="annottext">Maybe UserInfo
</span><a href="#local-6989586621691176624"><span class="hs-identifier hs-var">userInfoM</span></a></span></span><span> </span><span id="local-6989586621691176623"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621691176623"><span class="hs-identifier hs-var">reqId</span></a></span></span><span> </span><span id="local-6989586621691176622"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621691176622"><span class="hs-identifier hs-var">waiReq</span></a></span></span><span> </span><span id="local-6989586621691176621"><span class="annot"><span class="annottext">(ByteString, Maybe Value)
</span><a href="#local-6989586621691176621"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span id="local-6989586621691176620"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621691176620"><span class="hs-identifier hs-var">qErr</span></a></span></span><span> </span><span id="local-6989586621691176619"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621691176619"><span class="hs-identifier hs-var">headers</span></a></span></span><span> </span><span class="annot"><span class="annottext">HttpLogMetadata AppM
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-690"></span><span>    </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691176626"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-691"></span><span>      </span><span class="annot"><span class="annottext">HttpLogContext -&gt; HttpLogLine
</span><a href="Hasura.Server.Logging.html#mkHttpLog"><span class="hs-identifier hs-var">mkHttpLog</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-692"></span><span>        </span><span class="annot"><span class="annottext">Maybe UserInfo
-&gt; LoggingSettings
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; QErr
-&gt; Maybe (DiffTime, DiffTime)
-&gt; Maybe CompressionType
-&gt; [Header]
-&gt; HttpLogContext
</span><a href="Hasura.Server.Logging.html#mkHttpErrorLogContext"><span class="hs-identifier hs-var">mkHttpErrorLogContext</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UserInfo
</span><a href="#local-6989586621691176624"><span class="hs-identifier hs-var">userInfoM</span></a></span><span> </span><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621691176625"><span class="hs-identifier hs-var">loggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621691176623"><span class="hs-identifier hs-var">reqId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621691176622"><span class="hs-identifier hs-var">waiReq</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString, Maybe Value)
</span><a href="#local-6989586621691176621"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621691176620"><span class="hs-identifier hs-var">qErr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621691176619"><span class="hs-identifier hs-var">headers</span></a></span><span>
</span><span id="line-693"></span><span>
</span><span id="line-694"></span><span>  </span><span id="local-6989586621691176614"><span class="annot"><span class="annottext">logHttpSuccess :: Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; ByteString
-&gt; ByteString
-&gt; Maybe (DiffTime, DiffTime)
-&gt; Maybe CompressionType
-&gt; [Header]
-&gt; HttpLogMetadata AppM
-&gt; AppM ()
</span><a href="Hasura.Server.Logging.html#logHttpSuccess"><span class="hs-identifier hs-var hs-var hs-var hs-var">logHttpSuccess</span></a></span></span><span> </span><span id="local-6989586621691176612"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691176612"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621691176611"><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621691176611"><span class="hs-identifier hs-var">loggingSettings</span></a></span></span><span> </span><span id="local-6989586621691176610"><span class="annot"><span class="annottext">Maybe UserInfo
</span><a href="#local-6989586621691176610"><span class="hs-identifier hs-var">userInfoM</span></a></span></span><span> </span><span id="local-6989586621691176609"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621691176609"><span class="hs-identifier hs-var">reqId</span></a></span></span><span> </span><span id="local-6989586621691176608"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621691176608"><span class="hs-identifier hs-var">waiReq</span></a></span></span><span> </span><span id="local-6989586621691176607"><span class="annot"><span class="annottext">(ByteString, Maybe Value)
</span><a href="#local-6989586621691176607"><span class="hs-identifier hs-var">reqBody</span></a></span></span><span> </span><span id="local-6989586621691176606"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621691176606"><span class="hs-identifier hs-var">response</span></a></span></span><span> </span><span id="local-6989586621691176605"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621691176605"><span class="hs-identifier hs-var">compressedResponse</span></a></span></span><span> </span><span id="local-6989586621691176604"><span class="annot"><span class="annottext">Maybe (DiffTime, DiffTime)
</span><a href="#local-6989586621691176604"><span class="hs-identifier hs-var">qTime</span></a></span></span><span> </span><span id="local-6989586621691176603"><span class="annot"><span class="annottext">Maybe CompressionType
</span><a href="#local-6989586621691176603"><span class="hs-identifier hs-var">cType</span></a></span></span><span> </span><span id="local-6989586621691176602"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621691176602"><span class="hs-identifier hs-var">headers</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#CommonHttpLogMetadata"><span class="hs-identifier hs-type">CommonHttpLogMetadata</span></a></span><span> </span><span id="local-6989586621691176600"><span class="annot"><span class="annottext">RequestMode
</span><a href="#local-6989586621691176600"><span class="hs-identifier hs-var">rb</span></a></span></span><span> </span><span id="local-6989586621691176599"><span class="annot"><span class="annottext">Maybe (GQLBatchedReqs GQLBatchQueryOperationLog)
</span><a href="#local-6989586621691176599"><span class="hs-identifier hs-var">batchQueryOpLogs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-695"></span><span>    </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691176612"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-696"></span><span>      </span><span class="annot"><span class="annottext">HttpLogContext -&gt; HttpLogLine
</span><a href="Hasura.Server.Logging.html#mkHttpLog"><span class="hs-identifier hs-var">mkHttpLog</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-697"></span><span>        </span><span class="annot"><span class="annottext">Maybe UserInfo
-&gt; LoggingSettings
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; Int64
-&gt; ByteString
-&gt; Maybe (DiffTime, DiffTime)
-&gt; Maybe CompressionType
-&gt; [Header]
-&gt; RequestMode
-&gt; Maybe (GQLBatchedReqs GQLBatchQueryOperationLog)
-&gt; HttpLogContext
</span><a href="Hasura.Server.Logging.html#mkHttpAccessLogContext"><span class="hs-identifier hs-var">mkHttpAccessLogContext</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UserInfo
</span><a href="#local-6989586621691176610"><span class="hs-identifier hs-var">userInfoM</span></a></span><span> </span><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621691176611"><span class="hs-identifier hs-var">loggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621691176609"><span class="hs-identifier hs-var">reqId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621691176608"><span class="hs-identifier hs-var">waiReq</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString, Maybe Value)
</span><a href="#local-6989586621691176607"><span class="hs-identifier hs-var">reqBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Int64
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/bytestring-0.11.3.1/src"><span class="hs-identifier hs-var">BL.length</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621691176606"><span class="hs-identifier hs-var">response</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621691176605"><span class="hs-identifier hs-var">compressedResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (DiffTime, DiffTime)
</span><a href="#local-6989586621691176604"><span class="hs-identifier hs-var">qTime</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CompressionType
</span><a href="#local-6989586621691176603"><span class="hs-identifier hs-var">cType</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621691176602"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">RequestMode
</span><a href="#local-6989586621691176600"><span class="hs-identifier hs-var">rb</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (GQLBatchedReqs GQLBatchQueryOperationLog)
</span><a href="#local-6989586621691176599"><span class="hs-identifier hs-var">batchQueryOpLogs</span></a></span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier hs-type">MonadExecuteQuery</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-700"></span><span>  </span><span id="local-6989586621691176590"><span class="annot"><span class="annottext">cacheLookup :: ExecutionPlan
-&gt; [QueryRootField UnpreparedValue]
-&gt; Maybe CachedDirective
-&gt; GQLReqParsed
-&gt; UserInfo
-&gt; [Header]
-&gt; AppM (Either QErr ([Header], CacheResult))
</span><a href="Hasura.GraphQL.Transport.HTTP.html#cacheLookup"><span class="hs-identifier hs-var hs-var hs-var hs-var">cacheLookup</span></a></span></span><span> </span><span class="annot"><span class="annottext">ExecutionPlan
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[QueryRootField UnpreparedValue]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe CachedDirective
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">GQLReqParsed
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ResponseCacher -&gt; CacheResult
</span><a href="Hasura.GraphQL.Transport.HTTP.html#ResponseUncached"><span class="hs-identifier hs-var">ResponseUncached</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>
</span><span id="line-702"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Server.Auth.html#UserAuthentication"><span class="hs-identifier hs-type">UserAuthentication</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-703"></span><span>  </span><span id="local-6989586621691176572"><span class="annot"><span class="annottext">resolveUserInfo :: Logger Hasura
-&gt; Manager
-&gt; [Header]
-&gt; AuthMode
-&gt; Maybe ReqsText
-&gt; AppM
     (Either QErr (UserInfo, Maybe UTCTime, [Header], ExtraUserInfo))
</span><a href="Hasura.Server.Auth.html#resolveUserInfo"><span class="hs-identifier hs-var hs-var hs-var hs-var">resolveUserInfo</span></a></span></span><span> </span><span id="local-6989586621691176570"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691176570"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621691176569"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621691176569"><span class="hs-identifier hs-var">manager</span></a></span></span><span> </span><span id="local-6989586621691176568"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621691176568"><span class="hs-identifier hs-var">headers</span></a></span></span><span> </span><span id="local-6989586621691176567"><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621691176567"><span class="hs-identifier hs-var">authMode</span></a></span></span><span> </span><span id="local-6989586621691176566"><span class="annot"><span class="annottext">Maybe ReqsText
</span><a href="#local-6989586621691176566"><span class="hs-identifier hs-var">reqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-704"></span><span>    </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-705"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621691176565"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621691176565"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621691176564"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621691176564"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621691176563"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621691176563"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadError QErr m) =&gt;
Logger Hasura
-&gt; Manager
-&gt; [Header]
-&gt; AuthMode
-&gt; Maybe ReqsText
-&gt; m (UserInfo, Maybe UTCTime, [Header])
</span><a href="Hasura.Server.Auth.html#getUserInfoWithExpTime"><span class="hs-identifier hs-var">getUserInfoWithExpTime</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691176570"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621691176569"><span class="hs-identifier hs-var">manager</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621691176568"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621691176567"><span class="hs-identifier hs-var">authMode</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ReqsText
</span><a href="#local-6989586621691176566"><span class="hs-identifier hs-var">reqs</span></a></span><span>
</span><span id="line-706"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621691176565"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621691176564"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621691176563"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; ExtraUserInfo
</span><a href="Hasura.RQL.Types.Session.html#ExtraUserInfo"><span class="hs-identifier hs-var">ExtraUserInfo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-707"></span><span>
</span><span id="line-708"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-709"></span><span>  </span><span id="local-6989586621691176545"><span class="annot"><span class="annottext">authorizeV1QueryApi :: RQLQuery -&gt; HandlerCtx -&gt; AppM (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1QueryApi"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV1QueryApi</span></a></span></span><span> </span><span id="local-6989586621691176543"><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621691176543"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span id="local-6989586621691176542"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621691176542"><span class="hs-identifier hs-var">handlerCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-710"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621691176541"><span class="annot"><span class="annottext">currRole :: RoleName
</span><a href="#local-6989586621691176541"><span class="hs-identifier hs-var hs-var">currRole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserInfo -&gt; RoleName
</span><a href="Hasura.RQL.Types.Session.html#_uiRole"><span class="hs-identifier hs-var">_uiRole</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; UserInfo
</span><a href="Hasura.Server.App.html#hcUser"><span class="hs-identifier hs-var">hcUser</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621691176542"><span class="hs-identifier hs-var">handlerCtx</span></a></span><span>
</span><span id="line-711"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RQLQuery -&gt; Bool
</span><a href="Hasura.Server.API.Query.html#requiresAdmin"><span class="hs-identifier hs-var">requiresAdmin</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621691176543"><span class="hs-identifier hs-var">query</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621691176541"><span class="hs-identifier hs-var">currRole</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="Hasura.RQL.Types.Roles.html#adminRoleName"><span class="hs-identifier hs-var">adminRoleName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-712"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">withPathK</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;args&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-713"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><span class="hs-identifier hs-var">throw400</span></span><span> </span><span class="annot"><span class="annottext">Code
</span><span class="hs-identifier hs-var">AccessDenied</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Hasura.App.html#accessDeniedErrMsg"><span class="hs-identifier hs-var">accessDeniedErrMsg</span></a></span><span>
</span><span id="line-714"></span><span>
</span><span id="line-715"></span><span>  </span><span id="local-6989586621691176526"><span class="annot"><span class="annottext">authorizeV1MetadataApi :: RQLMetadata -&gt; HandlerCtx -&gt; AppM (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1MetadataApi"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV1MetadataApi</span></a></span></span><span> </span><span class="annot"><span class="annottext">RQLMetadata
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621691176524"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621691176524"><span class="hs-identifier hs-var">handlerCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-716"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621691176523"><span class="annot"><span class="annottext">currRole :: RoleName
</span><a href="#local-6989586621691176523"><span class="hs-identifier hs-var hs-var">currRole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserInfo -&gt; RoleName
</span><a href="Hasura.RQL.Types.Session.html#_uiRole"><span class="hs-identifier hs-var">_uiRole</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; UserInfo
</span><a href="Hasura.Server.App.html#hcUser"><span class="hs-identifier hs-var">hcUser</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621691176524"><span class="hs-identifier hs-var">handlerCtx</span></a></span><span>
</span><span id="line-717"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621691176523"><span class="hs-identifier hs-var">currRole</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="Hasura.RQL.Types.Roles.html#adminRoleName"><span class="hs-identifier hs-var">adminRoleName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-718"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">withPathK</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;args&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-719"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><span class="hs-identifier hs-var">throw400</span></span><span> </span><span class="annot"><span class="annottext">Code
</span><span class="hs-identifier hs-var">AccessDenied</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Hasura.App.html#accessDeniedErrMsg"><span class="hs-identifier hs-var">accessDeniedErrMsg</span></a></span><span>
</span><span id="line-720"></span><span>
</span><span id="line-721"></span><span>  </span><span id="local-6989586621691176515"><span class="annot"><span class="annottext">authorizeV2QueryApi :: RQLQuery -&gt; HandlerCtx -&gt; AppM (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV2QueryApi"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV2QueryApi</span></a></span></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621691176513"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621691176513"><span class="hs-identifier hs-var">handlerCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-722"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621691176512"><span class="annot"><span class="annottext">currRole :: RoleName
</span><a href="#local-6989586621691176512"><span class="hs-identifier hs-var hs-var">currRole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserInfo -&gt; RoleName
</span><a href="Hasura.RQL.Types.Session.html#_uiRole"><span class="hs-identifier hs-var">_uiRole</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; UserInfo
</span><a href="Hasura.Server.App.html#hcUser"><span class="hs-identifier hs-var">hcUser</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621691176513"><span class="hs-identifier hs-var">handlerCtx</span></a></span><span>
</span><span id="line-723"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621691176512"><span class="hs-identifier hs-var">currRole</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="Hasura.RQL.Types.Roles.html#adminRoleName"><span class="hs-identifier hs-var">adminRoleName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-724"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">withPathK</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;args&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-725"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><span class="hs-identifier hs-var">throw400</span></span><span> </span><span class="annot"><span class="annottext">Code
</span><span class="hs-identifier hs-var">AccessDenied</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Hasura.App.html#accessDeniedErrMsg"><span class="hs-identifier hs-var">accessDeniedErrMsg</span></a></span><span>
</span><span id="line-726"></span><span>
</span><span id="line-727"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleRenderer"><span class="hs-identifier hs-type">ConsoleRenderer</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-728"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ConsoleType"><span class="annot"><a href="Hasura.Server.App.html#ConsoleType"><span class="hs-identifier hs-var">ConsoleType</span></a></span></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#CEConsoleType"><span class="hs-identifier hs-type">CEConsoleType</span></a></span><span>
</span><span id="line-729"></span><span>  </span><span id="local-6989586621691176505"><span class="annot"><span class="annottext">renderConsole :: Text
-&gt; AuthMode
-&gt; TelemetryStatus
-&gt; Maybe Text
-&gt; Maybe Text
-&gt; ConsoleType AppM
-&gt; AppM (Either String Text)
</span><a href="Hasura.Server.App.html#renderConsole"><span class="hs-identifier hs-var hs-var hs-var hs-var">renderConsole</span></a></span></span><span> </span><span id="local-6989586621691176503"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691176503"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621691176502"><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621691176502"><span class="hs-identifier hs-var">authMode</span></a></span></span><span> </span><span id="local-6989586621691176501"><span class="annot"><span class="annottext">TelemetryStatus
</span><a href="#local-6989586621691176501"><span class="hs-identifier hs-var">enableTelemetry</span></a></span></span><span> </span><span id="local-6989586621691176500"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621691176500"><span class="hs-identifier hs-var">consoleAssetsDir</span></a></span></span><span> </span><span id="local-6989586621691176499"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621691176499"><span class="hs-identifier hs-var">consoleSentryDsn</span></a></span></span><span> </span><span id="local-6989586621691176498"><span class="annot"><span class="annottext">ConsoleType AppM
</span><a href="#local-6989586621691176498"><span class="hs-identifier hs-var">consoleType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-730"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; AuthMode
-&gt; TelemetryStatus
-&gt; Maybe Text
-&gt; Maybe Text
-&gt; CEConsoleType
-&gt; Either String Text
</span><a href="Hasura.App.html#mkConsoleHTML"><span class="hs-identifier hs-var">mkConsoleHTML</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691176503"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621691176502"><span class="hs-identifier hs-var">authMode</span></a></span><span> </span><span class="annot"><span class="annottext">TelemetryStatus
</span><a href="#local-6989586621691176501"><span class="hs-identifier hs-var">enableTelemetry</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621691176500"><span class="hs-identifier hs-var">consoleAssetsDir</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621691176499"><span class="hs-identifier hs-var">consoleSentryDsn</span></a></span><span> </span><span class="annot"><span class="annottext">ConsoleType AppM
</span><a href="#local-6989586621691176498"><span class="hs-identifier hs-var">consoleType</span></a></span><span>
</span><span id="line-731"></span><span>
</span><span id="line-732"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#MonadVersionAPIWithExtraData"><span class="hs-identifier hs-type">MonadVersionAPIWithExtraData</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-733"></span><span>  </span><span class="hs-comment">-- we always default to CE as the `server_type` in this codebase</span><span>
</span><span id="line-734"></span><span>  </span><span id="local-6989586621691176486"><span class="annot"><span class="annottext">getExtraDataForVersionAPI :: AppM [Pair]
</span><a href="Hasura.Server.App.html#getExtraDataForVersionAPI"><span class="hs-identifier hs-var hs-var hs-var hs-var">getExtraDataForVersionAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;server_type&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">J..=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ce&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-735"></span><span>
</span><span id="line-736"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier hs-type">MonadGQLExecutionCheck</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-737"></span><span>  </span><span id="local-6989586621691176470"><span class="annot"><span class="annottext">checkGQLExecution :: UserInfo
-&gt; ([Header], IpAddress)
-&gt; AllowListStatus
-&gt; SchemaCache
-&gt; GQLReqUnparsed
-&gt; RequestId
-&gt; AppM (Either QErr GQLReqParsed)
</span><a href="Hasura.GraphQL.Execute.Common.html#checkGQLExecution"><span class="hs-identifier hs-var hs-var hs-var hs-var">checkGQLExecution</span></a></span></span><span> </span><span id="local-6989586621691176468"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621691176468"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span> </span><span class="annot"><span class="annottext">([Header], IpAddress)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621691176467"><span class="annot"><span class="annottext">AllowListStatus
</span><a href="#local-6989586621691176467"><span class="hs-identifier hs-var">enableAL</span></a></span></span><span> </span><span id="local-6989586621691176466"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621691176466"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span id="local-6989586621691176465"><span class="annot"><span class="annottext">GQLReqUnparsed
</span><a href="#local-6989586621691176465"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-738"></span><span>    </span><span id="local-6989586621691176464"><span class="annot"><span class="annottext">GQLReqParsed
</span><a href="#local-6989586621691176464"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadError QErr m =&gt;
GQLReqUnparsed -&gt; m GQLReqParsed
</span><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#toParsed"><span class="hs-identifier hs-var">toParsed</span></a></span><span> </span><span class="annot"><span class="annottext">GQLReqUnparsed
</span><a href="#local-6989586621691176465"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-739"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadError QErr m =&gt;
AllowListStatus
-&gt; AllowlistMode -&gt; UserInfo -&gt; GQLReqParsed -&gt; SchemaCache -&gt; m ()
</span><a href="Hasura.GraphQL.Execute.html#checkQueryInAllowlist"><span class="hs-identifier hs-var">checkQueryInAllowlist</span></a></span><span> </span><span class="annot"><span class="annottext">AllowListStatus
</span><a href="#local-6989586621691176467"><span class="hs-identifier hs-var">enableAL</span></a></span><span> </span><span class="annot"><span class="annottext">AllowlistMode
</span><a href="Hasura.RQL.Types.Allowlist.html#AllowlistModeGlobalOnly"><span class="hs-identifier hs-var">AllowlistModeGlobalOnly</span></a></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621691176468"><span class="hs-identifier hs-var">userInfo</span></a></span><span> </span><span class="annot"><span class="annottext">GQLReqParsed
</span><a href="#local-6989586621691176464"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621691176466"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-740"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">GQLReqParsed
</span><a href="#local-6989586621691176464"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-741"></span><span>
</span><span id="line-742"></span><span>  </span><span id="local-6989586621691176461"><span class="annot"><span class="annottext">executeIntrospection :: UserInfo
-&gt; Value
-&gt; SetGraphqlIntrospectionOptions
-&gt; AppM (Either QErr ExecutionStep)
</span><a href="Hasura.GraphQL.Execute.Common.html#executeIntrospection"><span class="hs-identifier hs-var hs-var hs-var hs-var">executeIntrospection</span></a></span></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621691176459"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621691176459"><span class="hs-identifier hs-var">introspectionQuery</span></a></span></span><span> </span><span class="annot"><span class="annottext">SetGraphqlIntrospectionOptions
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-743"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ExecutionStep
</span><a href="Hasura.GraphQL.Execute.Backend.html#ExecStepRaw"><span class="hs-identifier hs-var">ExecStepRaw</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621691176459"><span class="hs-identifier hs-var">introspectionQuery</span></a></span><span>
</span><span id="line-744"></span><span>
</span><span id="line-745"></span><span>  </span><span id="local-6989586621691176454"><span class="annot"><span class="annottext">checkGQLBatchedReqs :: UserInfo
-&gt; RequestId
-&gt; [GQLReqUnparsed]
-&gt; SchemaCache
-&gt; AppM (Either QErr ())
</span><a href="Hasura.GraphQL.Execute.Common.html#checkGQLBatchedReqs"><span class="hs-identifier hs-var hs-var hs-var hs-var">checkGQLBatchedReqs</span></a></span></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[GQLReqUnparsed]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-746"></span><span>
</span><span id="line-747"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#MonadConfigApiHandler"><span class="hs-identifier hs-type">MonadConfigApiHandler</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-748"></span><span>  </span><span id="local-6989586621691176440"><span class="annot"><span class="annottext">runConfigApiHandler :: forall impl. AppStateRef impl -&gt; SpockCtxT () AppM ()
</span><a href="Hasura.Server.App.html#runConfigApiHandler"><span class="hs-identifier hs-var hs-var hs-var hs-var">runConfigApiHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) impl.
(MonadIO m, MonadBaseControl IO m, HasAppEnv m,
 UserAuthentication m, HttpLog m, HasResourceLimits m,
 MonadTrace m) =&gt;
AppStateRef impl -&gt; SpockCtxT () m ()
</span><a href="Hasura.Server.App.html#configApiGetHandler"><span class="hs-identifier hs-var">configApiGetHandler</span></a></span><span>
</span><span id="line-749"></span><span>
</span><span id="line-750"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Logging.QueryLog.html#MonadQueryLog"><span class="hs-identifier hs-type">MonadQueryLog</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-751"></span><span>  </span><span id="local-6989586621691176429"><span class="annot"><span class="annottext">logQueryLog :: Logger Hasura -&gt; QueryLog -&gt; AppM ()
</span><a href="Hasura.GraphQL.Logging.QueryLog.html#logQueryLog"><span class="hs-identifier hs-var hs-var hs-var hs-var">logQueryLog</span></a></span></span><span> </span><span id="local-6989586621691176427"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691176427"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691176427"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-752"></span><span>
</span><span id="line-753"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Logging.ExecutionLog.html#MonadExecutionLog"><span class="hs-identifier hs-type">MonadExecutionLog</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-754"></span><span>  </span><span id="local-6989586621691176418"><span class="annot"><span class="annottext">logExecutionLog :: Logger Hasura -&gt; ExecutionLog -&gt; AppM ()
</span><a href="Hasura.GraphQL.Logging.ExecutionLog.html#logExecutionLog"><span class="hs-identifier hs-var hs-var hs-var hs-var">logExecutionLog</span></a></span></span><span> </span><span id="local-6989586621691176416"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691176416"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691176416"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-755"></span><span>
</span><span id="line-756"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#MonadWSLog"><span class="hs-identifier hs-type">WS.MonadWSLog</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-757"></span><span>  </span><span id="local-6989586621691176407"><span class="annot"><span class="annottext">logWSLog :: Logger Hasura -&gt; WSLog -&gt; AppM ()
</span><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#logWSLog"><span class="hs-identifier hs-var hs-var hs-var hs-var">logWSLog</span></a></span></span><span> </span><span id="local-6989586621691176405"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691176405"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691176405"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-758"></span><span>
</span><span id="line-759"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-760"></span><span>  </span><span id="local-6989586621691176397"><span class="annot"><span class="annottext">getPGSourceResolver :: AppM (SourceResolver ('Postgres 'Vanilla))
</span><a href="Hasura.RQL.Types.Source.html#getPGSourceResolver"><span class="hs-identifier hs-var hs-var hs-var hs-var">getPGSourceResolver</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PGLogger -&gt; SourceResolver ('Postgres 'Vanilla)
</span><a href="Hasura.App.html#mkPgSourceResolver"><span class="hs-identifier hs-var">mkPgSourceResolver</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Loggers -&gt; PGLogger
</span><a href="Hasura.App.State.html#_lsPgLogger"><span class="hs-identifier hs-var">_lsPgLogger</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">AppEnv -&gt; Loggers
</span><a href="Hasura.App.State.html#appEnvLoggers"><span class="hs-identifier hs-var">appEnvLoggers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-761"></span><span>  </span><span id="local-6989586621691176393"><span class="annot"><span class="annottext">getMSSQLSourceResolver :: AppM (SourceResolver 'MSSQL)
</span><a href="Hasura.RQL.Types.Source.html#getMSSQLSourceResolver"><span class="hs-identifier hs-var hs-var hs-var hs-var">getMSSQLSourceResolver</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SourceResolver 'MSSQL
</span><a href="Hasura.App.html#mkMSSQLSourceResolver"><span class="hs-identifier hs-var">mkMSSQLSourceResolver</span></a></span><span>
</span><span id="line-762"></span><span>
</span><span id="line-763"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.QueryTags.html#MonadQueryTags"><span class="hs-identifier hs-type">MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-764"></span><span>  </span><span id="local-6989586621691176384"><span class="annot"><span class="annottext">createQueryTags :: QueryTagsAttributes
-&gt; Maybe QueryTagsConfig -&gt; Tagged AppM QueryTagsComment
</span><a href="Hasura.QueryTags.html#createQueryTags"><span class="hs-identifier hs-var hs-var hs-var hs-var">createQueryTags</span></a></span></span><span> </span><span id="local-6989586621691176382"><span class="annot"><span class="annottext">QueryTagsAttributes
</span><a href="#local-6989586621691176382"><span class="hs-identifier hs-var">_attributes</span></a></span></span><span> </span><span id="local-6989586621691176381"><span class="annot"><span class="annottext">Maybe QueryTagsConfig
</span><a href="#local-6989586621691176381"><span class="hs-identifier hs-var">_qtSourceConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">QueryTagsComment
</span><a href="Hasura.QueryTags.html#emptyQueryTagsComment"><span class="hs-identifier hs-var">emptyQueryTagsComment</span></a></span><span>
</span><span id="line-765"></span><span>
</span><span id="line-766"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier hs-type">MonadEventLogCleanup</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-767"></span><span>  </span><span id="local-6989586621691176369"><span class="annot"><span class="annottext">runLogCleaner :: SourceCache
-&gt; TriggerLogCleanupConfig -&gt; AppM (Either QErr EncJSON)
</span><a href="Hasura.RQL.DDL.EventTrigger.html#runLogCleaner"><span class="hs-identifier hs-var hs-var hs-var hs-var">runLogCleaner</span></a></span></span><span> </span><span class="annot"><span class="annottext">SourceCache
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TriggerLogCleanupConfig
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><span class="hs-identifier hs-var">throw400</span></span><span> </span><span class="annot"><span class="annottext">Code
</span><span class="hs-identifier hs-var">NotSupported</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Event log cleanup feature is enterprise edition only&quot;</span></span><span>
</span><span id="line-768"></span><span>  </span><span id="local-6989586621691176365"><span class="annot"><span class="annottext">generateCleanupSchedules :: AnyBackend SourceInfo
-&gt; TriggerName
-&gt; AutoTriggerLogCleanupConfig
-&gt; AppM (Either QErr ())
</span><a href="Hasura.RQL.DDL.EventTrigger.html#generateCleanupSchedules"><span class="hs-identifier hs-var hs-var hs-var hs-var">generateCleanupSchedules</span></a></span></span><span> </span><span class="annot"><span class="annottext">AnyBackend SourceInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AutoTriggerLogCleanupConfig
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-769"></span><span>  </span><span id="local-6989586621691176362"><span class="annot"><span class="annottext">updateTriggerCleanupSchedules :: Logger Hasura
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; SchemaCache
-&gt; AppM (Either QErr ())
</span><a href="Hasura.RQL.DDL.EventTrigger.html#updateTriggerCleanupSchedules"><span class="hs-identifier hs-var hs-var hs-var hs-var">updateTriggerCleanupSchedules</span></a></span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-770"></span><span>
</span><span id="line-771"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier hs-type">MonadGetPolicies</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-772"></span><span>  </span><span id="local-6989586621691176353"><span class="annot"><span class="annottext">runGetApiTimeLimit :: AppM (Maybe MaxTime)
</span><a href="Hasura.Server.Types.html#runGetApiTimeLimit"><span class="hs-identifier hs-var hs-var hs-var hs-var">runGetApiTimeLimit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-773"></span><span>  </span><span id="local-6989586621691176349"><span class="annot"><span class="annottext">runGetPrometheusMetricsGranularity :: AppM (IO GranularPrometheusMetricsState)
</span><a href="Hasura.Server.Types.html#runGetPrometheusMetricsGranularity"><span class="hs-identifier hs-var hs-var hs-var hs-var">runGetPrometheusMetricsGranularity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">GranularPrometheusMetricsState
</span><a href="Hasura.Server.Types.html#GranularMetricsOff"><span class="hs-identifier hs-var">GranularMetricsOff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-774"></span><span>
</span><span id="line-775"></span><span class="hs-comment">-- | Each of the function in the type class is executed in a totally separate transaction.</span><span>
</span><span id="line-776"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-777"></span><span>  </span><span id="local-6989586621691176312"><span class="annot"><span class="annottext">fetchMetadataResourceVersion :: AppM (Either QErr MetadataResourceVersion)
</span><a href="Hasura.Metadata.Class.html#fetchMetadataResourceVersion"><span class="hs-identifier hs-var hs-var hs-var hs-var">fetchMetadataResourceVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxE QErr MetadataResourceVersion
</span><a href="Hasura.RQL.DDL.Schema.Catalog.html#fetchMetadataResourceVersionFromCatalog"><span class="hs-identifier hs-var">fetchMetadataResourceVersionFromCatalog</span></a></span><span>
</span><span id="line-778"></span><span>  </span><span id="local-6989586621691176308"><span class="annot"><span class="annottext">fetchMetadata :: AppM (Either QErr MetadataWithResourceVersion)
</span><a href="Hasura.Metadata.Class.html#fetchMetadata"><span class="hs-identifier hs-var hs-var hs-var hs-var">fetchMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxE QErr MetadataWithResourceVersion
</span><a href="Hasura.RQL.DDL.Schema.Catalog.html#fetchMetadataAndResourceVersionFromCatalog"><span class="hs-identifier hs-var">fetchMetadataAndResourceVersionFromCatalog</span></a></span><span>
</span><span id="line-779"></span><span>  </span><span id="local-6989586621691176305"><span class="annot"><span class="annottext">fetchMetadataNotifications :: MetadataResourceVersion
-&gt; InstanceId
-&gt; AppM
     (Either QErr [(MetadataResourceVersion, CacheInvalidations)])
</span><a href="Hasura.Metadata.Class.html#fetchMetadataNotifications"><span class="hs-identifier hs-var hs-var hs-var hs-var">fetchMetadataNotifications</span></a></span></span><span> </span><span id="local-6989586621691176303"><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621691176303"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621691176302"><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621691176302"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
-&gt; InstanceId
-&gt; TxE QErr [(MetadataResourceVersion, CacheInvalidations)]
</span><a href="Hasura.RQL.DDL.Schema.Catalog.html#fetchMetadataNotificationsFromCatalog"><span class="hs-identifier hs-var">fetchMetadataNotificationsFromCatalog</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621691176303"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621691176302"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-780"></span><span>  </span><span id="local-6989586621691176300"><span class="annot"><span class="annottext">setMetadata :: MetadataResourceVersion
-&gt; Metadata -&gt; AppM (Either QErr MetadataResourceVersion)
</span><a href="Hasura.Metadata.Class.html#setMetadata"><span class="hs-identifier hs-var hs-var hs-var hs-var">setMetadata</span></a></span></span><span> </span><span id="local-6989586621691176298"><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621691176298"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
-&gt; Metadata -&gt; TxE QErr MetadataResourceVersion
</span><a href="Hasura.RQL.DDL.Schema.Catalog.html#setMetadataInCatalog"><span class="hs-identifier hs-var">setMetadataInCatalog</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621691176298"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-781"></span><span>  </span><span id="local-6989586621691176296"><span class="annot"><span class="annottext">notifySchemaCacheSync :: MetadataResourceVersion
-&gt; InstanceId -&gt; CacheInvalidations -&gt; AppM (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#notifySchemaCacheSync"><span class="hs-identifier hs-var hs-var hs-var hs-var">notifySchemaCacheSync</span></a></span></span><span> </span><span id="local-6989586621691176294"><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621691176294"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621691176293"><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621691176293"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621691176292"><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621691176292"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
-&gt; InstanceId -&gt; CacheInvalidations -&gt; TxE QErr ()
</span><a href="Hasura.App.html#notifySchemaCacheSyncTx"><span class="hs-identifier hs-var">notifySchemaCacheSyncTx</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621691176294"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621691176293"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621691176292"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-782"></span><span>  </span><span id="local-6989586621691176291"><span class="annot"><span class="annottext">getCatalogState :: AppM (Either QErr CatalogState)
</span><a href="Hasura.Metadata.Class.html#getCatalogState"><span class="hs-identifier hs-var hs-var hs-var hs-var">getCatalogState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxE QErr CatalogState
</span><a href="Hasura.App.html#getCatalogStateTx"><span class="hs-identifier hs-var">getCatalogStateTx</span></a></span><span>
</span><span id="line-783"></span><span>  </span><span id="local-6989586621691176289"><span class="annot"><span class="annottext">setCatalogState :: CatalogStateType -&gt; Value -&gt; AppM (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#setCatalogState"><span class="hs-identifier hs-var hs-var hs-var hs-var">setCatalogState</span></a></span></span><span> </span><span id="local-6989586621691176287"><span class="annot"><span class="annottext">CatalogStateType
</span><a href="#local-6989586621691176287"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621691176286"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621691176286"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CatalogStateType -&gt; Value -&gt; TxE QErr ()
</span><a href="Hasura.App.html#setCatalogStateTx"><span class="hs-identifier hs-var">setCatalogStateTx</span></a></span><span> </span><span class="annot"><span class="annottext">CatalogStateType
</span><a href="#local-6989586621691176287"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621691176286"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-784"></span><span>
</span><span id="line-785"></span><span>  </span><span class="hs-comment">-- stored source introspection is not available in this distribution</span><span>
</span><span id="line-786"></span><span>  </span><span id="local-6989586621691176284"><span class="annot"><span class="annottext">fetchSourceIntrospection :: MetadataResourceVersion
-&gt; AppM (Either QErr (Maybe StoredIntrospection))
</span><a href="Hasura.Metadata.Class.html#fetchSourceIntrospection"><span class="hs-identifier hs-var hs-var hs-var hs-var">fetchSourceIntrospection</span></a></span></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-787"></span><span>  </span><span id="local-6989586621691176281"><span class="annot"><span class="annottext">storeSourceIntrospection :: StoredIntrospection
-&gt; MetadataResourceVersion -&gt; AppM (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#storeSourceIntrospection"><span class="hs-identifier hs-var hs-var hs-var hs-var">storeSourceIntrospection</span></a></span></span><span> </span><span class="annot"><span class="annottext">StoredIntrospection
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-788"></span><span>
</span><span id="line-789"></span><span>  </span><span id="local-6989586621691176279"><span class="annot"><span class="annottext">getMetadataDbUid :: AppM (Either QErr MetadataDbId)
</span><a href="Hasura.Metadata.Class.html#getMetadataDbUid"><span class="hs-identifier hs-var hs-var hs-var hs-var">getMetadataDbUid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxE QErr MetadataDbId
</span><a href="Hasura.Server.Init.html#getDbId"><span class="hs-identifier hs-var">getDbId</span></a></span><span>
</span><span id="line-790"></span><span>  </span><span id="local-6989586621691176275"><span class="annot"><span class="annottext">checkMetadataStorageHealth :: AppM (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#checkMetadataStorageHealth"><span class="hs-identifier hs-var hs-var hs-var hs-var">checkMetadataStorageHealth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadTx m =&gt; m ()
</span><a href="Hasura.Backends.Postgres.Connection.MonadTx.html#checkDbConnection"><span class="hs-identifier hs-var">checkDbConnection</span></a></span><span>
</span><span id="line-791"></span><span>
</span><span id="line-792"></span><span>  </span><span id="local-6989586621691176272"><span class="annot"><span class="annottext">getDeprivedCronTriggerStats :: [TriggerName] -&gt; AppM (Either QErr [CronTriggerStats])
</span><a href="Hasura.Metadata.Class.html#getDeprivedCronTriggerStats"><span class="hs-identifier hs-var hs-var hs-var hs-var">getDeprivedCronTriggerStats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[TriggerName] -&gt; TxE QErr [CronTriggerStats]
</span><a href="Hasura.Eventing.ScheduledTrigger.html#getDeprivedCronTriggerStatsTx"><span class="hs-identifier hs-var">getDeprivedCronTriggerStatsTx</span></a></span><span>
</span><span id="line-793"></span><span>  </span><span id="local-6989586621691176269"><span class="annot"><span class="annottext">getScheduledEventsForDelivery :: [TriggerName]
-&gt; AppM (Either QErr ([CronEvent], [OneOffScheduledEvent]))
</span><a href="Hasura.Metadata.Class.html#getScheduledEventsForDelivery"><span class="hs-identifier hs-var hs-var hs-var hs-var">getScheduledEventsForDelivery</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[TriggerName] -&gt; TxE QErr ([CronEvent], [OneOffScheduledEvent])
</span><a href="Hasura.Eventing.ScheduledTrigger.html#getScheduledEventsForDeliveryTx"><span class="hs-identifier hs-var">getScheduledEventsForDeliveryTx</span></a></span><span>
</span><span id="line-794"></span><span>  </span><span id="local-6989586621691176266"><span class="annot"><span class="annottext">insertCronEvents :: [CronEventSeed] -&gt; AppM (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#insertCronEvents"><span class="hs-identifier hs-var hs-var hs-var hs-var">insertCronEvents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[CronEventSeed] -&gt; TxE QErr ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#insertCronEventsTx"><span class="hs-identifier hs-var">insertCronEventsTx</span></a></span><span>
</span><span id="line-795"></span><span>  </span><span id="local-6989586621691176263"><span class="annot"><span class="annottext">insertOneOffScheduledEvent :: OneOffEvent -&gt; AppM (Either QErr CronEventId)
</span><a href="Hasura.Metadata.Class.html#insertOneOffScheduledEvent"><span class="hs-identifier hs-var hs-var hs-var hs-var">insertOneOffScheduledEvent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">OneOffEvent -&gt; TxE QErr CronEventId
</span><a href="Hasura.Eventing.ScheduledTrigger.html#insertOneOffScheduledEventTx"><span class="hs-identifier hs-var">insertOneOffScheduledEventTx</span></a></span><span>
</span><span id="line-796"></span><span>  </span><span id="local-6989586621691176260"><span class="annot"><span class="annottext">insertScheduledEventInvocation :: Invocation 'ScheduledType
-&gt; ScheduledEventType -&gt; AppM (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#insertScheduledEventInvocation"><span class="hs-identifier hs-var hs-var hs-var hs-var">insertScheduledEventInvocation</span></a></span></span><span> </span><span id="local-6989586621691176258"><span class="annot"><span class="annottext">Invocation 'ScheduledType
</span><a href="#local-6989586621691176258"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621691176257"><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621691176257"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType -&gt; ScheduledEventType -&gt; TxE QErr ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#insertInvocationTx"><span class="hs-identifier hs-var">insertInvocationTx</span></a></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType
</span><a href="#local-6989586621691176258"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621691176257"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-797"></span><span>  </span><span id="local-6989586621691176255"><span class="annot"><span class="annottext">setScheduledEventOp :: CronEventId
-&gt; ScheduledEventOp -&gt; ScheduledEventType -&gt; AppM (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#setScheduledEventOp"><span class="hs-identifier hs-var hs-var hs-var hs-var">setScheduledEventOp</span></a></span></span><span> </span><span id="local-6989586621691176253"><span class="annot"><span class="annottext">CronEventId
</span><a href="#local-6989586621691176253"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621691176252"><span class="annot"><span class="annottext">ScheduledEventOp
</span><a href="#local-6989586621691176252"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621691176251"><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621691176251"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CronEventId
-&gt; ScheduledEventOp -&gt; ScheduledEventType -&gt; TxE QErr ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#setScheduledEventOpTx"><span class="hs-identifier hs-var">setScheduledEventOpTx</span></a></span><span> </span><span class="annot"><span class="annottext">CronEventId
</span><a href="#local-6989586621691176253"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventOp
</span><a href="#local-6989586621691176252"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621691176251"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-798"></span><span>  </span><span id="local-6989586621691176249"><span class="annot"><span class="annottext">unlockScheduledEvents :: ScheduledEventType -&gt; [CronEventId] -&gt; AppM (Either QErr Int)
</span><a href="Hasura.Metadata.Class.html#unlockScheduledEvents"><span class="hs-identifier hs-var hs-var hs-var hs-var">unlockScheduledEvents</span></a></span></span><span> </span><span id="local-6989586621691176247"><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621691176247"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621691176246"><span class="annot"><span class="annottext">[CronEventId]
</span><a href="#local-6989586621691176246"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventType -&gt; [CronEventId] -&gt; TxE QErr Int
</span><a href="Hasura.Eventing.ScheduledTrigger.html#unlockScheduledEventsTx"><span class="hs-identifier hs-var">unlockScheduledEventsTx</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621691176247"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[CronEventId]
</span><a href="#local-6989586621691176246"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-799"></span><span>  </span><span id="local-6989586621691176244"><span class="annot"><span class="annottext">unlockAllLockedScheduledEvents :: AppM (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#unlockAllLockedScheduledEvents"><span class="hs-identifier hs-var hs-var hs-var hs-var">unlockAllLockedScheduledEvents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxE QErr ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#unlockAllLockedScheduledEventsTx"><span class="hs-identifier hs-var">unlockAllLockedScheduledEventsTx</span></a></span><span>
</span><span id="line-800"></span><span>  </span><span id="local-6989586621691176241"><span class="annot"><span class="annottext">clearFutureCronEvents :: ClearCronEvents -&gt; AppM (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#clearFutureCronEvents"><span class="hs-identifier hs-var hs-var hs-var hs-var">clearFutureCronEvents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ClearCronEvents -&gt; TxE QErr ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#dropFutureCronEventsTx"><span class="hs-identifier hs-var">dropFutureCronEventsTx</span></a></span><span>
</span><span id="line-801"></span><span>  </span><span id="local-6989586621691176238"><span class="annot"><span class="annottext">getOneOffScheduledEvents :: ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; AppM
     (Either QErr (WithOptionalTotalCount [OneOffScheduledEvent]))
</span><a href="Hasura.Metadata.Class.html#getOneOffScheduledEvents"><span class="hs-identifier hs-var hs-var hs-var hs-var">getOneOffScheduledEvents</span></a></span></span><span> </span><span id="local-6989586621691176236"><span class="annot"><span class="annottext">ScheduledEventPagination
</span><a href="#local-6989586621691176236"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621691176235"><span class="annot"><span class="annottext">[ScheduledEventStatus]
</span><a href="#local-6989586621691176235"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621691176234"><span class="annot"><span class="annottext">RowsCountOption
</span><a href="#local-6989586621691176234"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; TxE QErr (WithOptionalTotalCount [OneOffScheduledEvent])
</span><a href="Hasura.Eventing.ScheduledTrigger.html#getOneOffScheduledEventsTx"><span class="hs-identifier hs-var">getOneOffScheduledEventsTx</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventPagination
</span><a href="#local-6989586621691176236"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[ScheduledEventStatus]
</span><a href="#local-6989586621691176235"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">RowsCountOption
</span><a href="#local-6989586621691176234"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-802"></span><span>  </span><span id="local-6989586621691176232"><span class="annot"><span class="annottext">getCronEvents :: TriggerName
-&gt; ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; AppM (Either QErr (WithOptionalTotalCount [CronEvent]))
</span><a href="Hasura.Metadata.Class.html#getCronEvents"><span class="hs-identifier hs-var hs-var hs-var hs-var">getCronEvents</span></a></span></span><span> </span><span id="local-6989586621691176230"><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621691176230"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621691176229"><span class="annot"><span class="annottext">ScheduledEventPagination
</span><a href="#local-6989586621691176229"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621691176228"><span class="annot"><span class="annottext">[ScheduledEventStatus]
</span><a href="#local-6989586621691176228"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621691176227"><span class="annot"><span class="annottext">RowsCountOption
</span><a href="#local-6989586621691176227"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
-&gt; ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; TxE QErr (WithOptionalTotalCount [CronEvent])
</span><a href="Hasura.Eventing.ScheduledTrigger.html#getCronEventsTx"><span class="hs-identifier hs-var">getCronEventsTx</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621691176230"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventPagination
</span><a href="#local-6989586621691176229"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">[ScheduledEventStatus]
</span><a href="#local-6989586621691176228"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">RowsCountOption
</span><a href="#local-6989586621691176227"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-803"></span><span>  </span><span id="local-6989586621691176225"><span class="annot"><span class="annottext">getScheduledEventInvocations :: GetScheduledEventInvocations
-&gt; AppM
     (Either QErr (WithOptionalTotalCount [ScheduledEventInvocation]))
</span><a href="Hasura.Metadata.Class.html#getScheduledEventInvocations"><span class="hs-identifier hs-var hs-var hs-var hs-var">getScheduledEventInvocations</span></a></span></span><span> </span><span id="local-6989586621691176223"><span class="annot"><span class="annottext">GetScheduledEventInvocations
</span><a href="#local-6989586621691176223"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GetScheduledEventInvocations
-&gt; TxE QErr (WithOptionalTotalCount [ScheduledEventInvocation])
</span><a href="Hasura.Eventing.ScheduledTrigger.html#getScheduledEventInvocationsTx"><span class="hs-identifier hs-var">getScheduledEventInvocationsTx</span></a></span><span> </span><span class="annot"><span class="annottext">GetScheduledEventInvocations
</span><a href="#local-6989586621691176223"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-804"></span><span>  </span><span id="local-6989586621691176221"><span class="annot"><span class="annottext">deleteScheduledEvent :: CronEventId -&gt; ScheduledEventType -&gt; AppM (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#deleteScheduledEvent"><span class="hs-identifier hs-var hs-var hs-var hs-var">deleteScheduledEvent</span></a></span></span><span> </span><span id="local-6989586621691176219"><span class="annot"><span class="annottext">CronEventId
</span><a href="#local-6989586621691176219"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621691176218"><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621691176218"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CronEventId -&gt; ScheduledEventType -&gt; TxE QErr ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#deleteScheduledEventTx"><span class="hs-identifier hs-var">deleteScheduledEventTx</span></a></span><span> </span><span class="annot"><span class="annottext">CronEventId
</span><a href="#local-6989586621691176219"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621691176218"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-805"></span><span>
</span><span id="line-806"></span><span>  </span><span id="local-6989586621691176216"><span class="annot"><span class="annottext">insertAction :: ActionName
-&gt; SessionVariables
-&gt; [Header]
-&gt; Value
-&gt; AppM (Either QErr ActionId)
</span><a href="Hasura.Metadata.Class.html#insertAction"><span class="hs-identifier hs-var hs-var hs-var hs-var">insertAction</span></a></span></span><span> </span><span id="local-6989586621691176214"><span class="annot"><span class="annottext">ActionName
</span><a href="#local-6989586621691176214"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621691176213"><span class="annot"><span class="annottext">SessionVariables
</span><a href="#local-6989586621691176213"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621691176212"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621691176212"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621691176211"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621691176211"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ActionName
-&gt; SessionVariables -&gt; [Header] -&gt; Value -&gt; TxE QErr ActionId
</span><a href="Hasura.GraphQL.Execute.Action.html#insertActionTx"><span class="hs-identifier hs-var">insertActionTx</span></a></span><span> </span><span class="annot"><span class="annottext">ActionName
</span><a href="#local-6989586621691176214"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">SessionVariables
</span><a href="#local-6989586621691176213"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621691176212"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621691176211"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-807"></span><span>  </span><span id="local-6989586621691176209"><span class="annot"><span class="annottext">fetchUndeliveredActionEvents :: AppM (Either QErr [ActionLogItem])
</span><a href="Hasura.Metadata.Class.html#fetchUndeliveredActionEvents"><span class="hs-identifier hs-var hs-var hs-var hs-var">fetchUndeliveredActionEvents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxE QErr [ActionLogItem]
</span><a href="Hasura.GraphQL.Execute.Action.html#fetchUndeliveredActionEventsTx"><span class="hs-identifier hs-var">fetchUndeliveredActionEventsTx</span></a></span><span>
</span><span id="line-808"></span><span>  </span><span id="local-6989586621691176206"><span class="annot"><span class="annottext">setActionStatus :: ActionId -&gt; AsyncActionStatus -&gt; AppM (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#setActionStatus"><span class="hs-identifier hs-var hs-var hs-var hs-var">setActionStatus</span></a></span></span><span> </span><span id="local-6989586621691176204"><span class="annot"><span class="annottext">ActionId
</span><a href="#local-6989586621691176204"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621691176203"><span class="annot"><span class="annottext">AsyncActionStatus
</span><a href="#local-6989586621691176203"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ActionId -&gt; AsyncActionStatus -&gt; TxE QErr ()
</span><a href="Hasura.GraphQL.Execute.Action.html#setActionStatusTx"><span class="hs-identifier hs-var">setActionStatusTx</span></a></span><span> </span><span class="annot"><span class="annottext">ActionId
</span><a href="#local-6989586621691176204"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">AsyncActionStatus
</span><a href="#local-6989586621691176203"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-809"></span><span>  </span><span id="local-6989586621691176201"><span class="annot"><span class="annottext">fetchActionResponse :: ActionId -&gt; AppM (Either QErr ActionLogResponse)
</span><a href="Hasura.Metadata.Class.html#fetchActionResponse"><span class="hs-identifier hs-var hs-var hs-var hs-var">fetchActionResponse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ActionId -&gt; TxE QErr ActionLogResponse
</span><a href="Hasura.GraphQL.Execute.Action.html#fetchActionResponseTx"><span class="hs-identifier hs-var">fetchActionResponseTx</span></a></span><span>
</span><span id="line-810"></span><span>  </span><span id="local-6989586621691176198"><span class="annot"><span class="annottext">clearActionData :: ActionName -&gt; AppM (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#clearActionData"><span class="hs-identifier hs-var hs-var hs-var hs-var">clearActionData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ActionName -&gt; TxE QErr ()
</span><a href="Hasura.GraphQL.Execute.Action.html#clearActionDataTx"><span class="hs-identifier hs-var">clearActionDataTx</span></a></span><span>
</span><span id="line-811"></span><span>  </span><span id="local-6989586621691176195"><span class="annot"><span class="annottext">setProcessingActionLogsToPending :: LockedActionIdArray -&gt; AppM (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#setProcessingActionLogsToPending"><span class="hs-identifier hs-var hs-var hs-var hs-var">setProcessingActionLogsToPending</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LockedActionIdArray -&gt; TxE QErr ()
</span><a href="Hasura.GraphQL.Execute.Action.html#setProcessingActionLogsToPendingTx"><span class="hs-identifier hs-var">setProcessingActionLogsToPendingTx</span></a></span><span>
</span><span id="line-812"></span><span>
</span><span id="line-813"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadEECredentialsStorage"><span class="hs-identifier hs-type">MonadEECredentialsStorage</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-814"></span><span>  </span><span id="local-6989586621691176186"><span class="annot"><span class="annottext">getEEClientCredentials :: AppM (Either QErr (Maybe EEClientCredentials))
</span><a href="Hasura.Metadata.Class.html#getEEClientCredentials"><span class="hs-identifier hs-var hs-var hs-var hs-var">getEEClientCredentials</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxE QErr (Maybe EEClientCredentials)
</span><a href="Hasura.ClientCredentials.html#getEEClientCredentialsTx"><span class="hs-identifier hs-var">getEEClientCredentialsTx</span></a></span><span>
</span><span id="line-815"></span><span>  </span><span id="local-6989586621691176184"><span class="annot"><span class="annottext">setEEClientCredentials :: EEClientCredentials -&gt; AppM (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#setEEClientCredentials"><span class="hs-identifier hs-var hs-var hs-var hs-var">setEEClientCredentials</span></a></span></span><span> </span><span id="local-6989586621691176182"><span class="annot"><span class="annottext">EEClientCredentials
</span><a href="#local-6989586621691176182"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EEClientCredentials -&gt; TxE QErr ()
</span><a href="Hasura.ClientCredentials.html#setEEClientCredentialsTx"><span class="hs-identifier hs-var">setEEClientCredentialsTx</span></a></span><span> </span><span class="annot"><span class="annottext">EEClientCredentials
</span><a href="#local-6989586621691176182"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-816"></span><span>
</span><span id="line-817"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-818"></span><span class="hs-comment">-- misc</span><span>
</span><span id="line-819"></span><span>
</span><span id="line-820"></span><span class="hs-comment">-- TODO(SOLOMON): Move Into `Hasura.Server.Init`. Unable to do so</span><span>
</span><span id="line-821"></span><span class="hs-comment">-- currently due `throwErrExit`.</span><span>
</span><span id="line-822"></span><span>
</span><span id="line-823"></span><span class="hs-comment">-- | Parse cli arguments to graphql-engine executable.</span><span>
</span><span id="line-824"></span><span id="local-6989586621691178031"><span class="annot"><a href="Hasura.App.html#parseArgs"><span class="hs-identifier hs-type">parseArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Logging.html#EnabledLogTypes"><span class="hs-identifier hs-type">EnabledLogTypes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178031"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Env.Environment</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#HGEOptions"><span class="hs-identifier hs-type">HGEOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptions"><span class="hs-identifier hs-type">ServeOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178031"><span class="hs-identifier hs-type">impl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-825"></span><span id="parseArgs"><span class="annot"><span class="annottext">parseArgs :: forall impl.
EnabledLogTypes impl =&gt;
Environment -&gt; IO (HGEOptions (ServeOptions impl))
</span><a href="Hasura.App.html#parseArgs"><span class="hs-identifier hs-var hs-var">parseArgs</span></a></span></span><span> </span><span id="local-6989586621691176176"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691176176"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-826"></span><span>  </span><span id="local-6989586621691176175"><span class="annot"><span class="annottext">HGEOptionsRaw (ServeOptionsRaw impl)
</span><a href="#local-6989586621691176175"><span class="hs-identifier hs-var">rawHGEOpts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. ParserInfo a -&gt; IO a
</span><span class="hs-identifier hs-var">execParser</span></span><span> </span><span class="annot"><span class="annottext">ParserInfo (HGEOptionsRaw (ServeOptionsRaw impl))
</span><a href="#local-6989586621691176173"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-827"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621691176172"><span class="annot"><span class="annottext">eitherOpts :: Either String (HGEOptions (ServeOptions impl))
</span><a href="#local-6989586621691176172"><span class="hs-identifier hs-var hs-var">eitherOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [(String, String)] -&gt; WithEnv a -&gt; Either String a
</span><a href="Hasura.Server.Init.Env.html#runWithEnv"><span class="hs-identifier hs-var">runWithEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Environment -&gt; [(String, String)]
</span><span class="hs-identifier hs-var">Env.toList</span></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691176176"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall impl.
EnabledLogTypes impl =&gt;
HGEOptionsRaw (ServeOptionsRaw impl)
-&gt; WithEnv (HGEOptions (ServeOptions impl))
</span><a href="Hasura.Server.Init.html#mkHGEOptions"><span class="hs-identifier hs-var">mkHGEOptions</span></a></span><span> </span><span class="annot"><span class="annottext">HGEOptionsRaw (ServeOptionsRaw impl)
</span><a href="#local-6989586621691176175"><span class="hs-identifier hs-var">rawHGEOpts</span></a></span><span>
</span><span id="line-828"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">onLeft</span></a></span><span> </span><span class="annot"><span class="annottext">Either String (HGEOptions (ServeOptions impl))
</span><a href="#local-6989586621691176172"><span class="hs-identifier hs-var">eitherOpts</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; ExitCode -&gt; String -&gt; m a
</span><a href="Hasura.App.html#throwErrExit"><span class="hs-identifier hs-var">throwErrExit</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="Hasura.App.html#InvalidEnvironmentVariableOptionsError"><span class="hs-identifier hs-var">InvalidEnvironmentVariableOptionsError</span></a></span><span>
</span><span id="line-829"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-830"></span><span>    </span><span id="local-6989586621691176173"><span class="annot"><span class="annottext">opts :: ParserInfo (HGEOptionsRaw (ServeOptionsRaw impl))
</span><a href="#local-6989586621691176173"><span class="hs-identifier hs-var hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-831"></span><span>      </span><span class="annot"><span class="annottext">forall a. Parser a -&gt; InfoMod a -&gt; ParserInfo a
</span><span class="hs-identifier hs-var">info</span></span><span>
</span><span id="line-832"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Parser (a -&gt; a)
</span><span class="hs-identifier hs-var">helper</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall impl.
EnabledLogTypes impl =&gt;
Parser (HGEOptionsRaw (ServeOptionsRaw impl))
</span><a href="Hasura.Server.Init.Arg.html#parseHgeOpts"><span class="hs-identifier hs-var">parseHgeOpts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-833"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall a. InfoMod a
</span><span class="hs-identifier hs-var">fullDesc</span></span><span>
</span><span id="line-834"></span><span>            </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; InfoMod a
</span><span class="hs-identifier hs-var">header</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Hasura GraphQL Engine: Blazing fast, instant realtime GraphQL APIs on your DB with fine grained access control, also trigger webhooks on database events.&quot;</span></span><span>
</span><span id="line-835"></span><span>            </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe Doc -&gt; InfoMod a
</span><span class="hs-identifier hs-var">footerDoc</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="Hasura.Server.Init.Arg.html#mainCmdFooter"><span class="hs-identifier hs-var">mainCmdFooter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-836"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-837"></span><span>
</span><span id="line-838"></span><span class="hs-comment">-- | Core logic to fork a poller thread to update the JWK based on the</span><span>
</span><span id="line-839"></span><span class="hs-comment">-- expiry time specified in @Expires@ header or @Cache-Control@ header</span><span>
</span><span id="line-840"></span><span id="local-6989586621691178010"><span class="annot"><a href="Hasura.App.html#updateJwkCtxThread"><span class="hs-identifier hs-type">updateJwkCtxThread</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-841"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Control.Concurrent.Extended.html#ForkableMonadIO"><span class="hs-identifier hs-type">C.ForkableMonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178010"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-842"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Hasura.App.State.html#AppContext"><span class="hs-identifier hs-type">AppContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-843"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HTTP.Manager</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-844"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-845"></span><span>  </span><span class="annot"><a href="#local-6989586621691178010"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Void</span></a></span></span><span>
</span><span id="line-846"></span><span id="updateJwkCtxThread"><span class="annot"><span class="annottext">updateJwkCtxThread :: forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
IO AppContext -&gt; Manager -&gt; Logger Hasura -&gt; m Void
</span><a href="Hasura.App.html#updateJwkCtxThread"><span class="hs-identifier hs-var hs-var">updateJwkCtxThread</span></a></span></span><span> </span><span id="local-6989586621691176135"><span class="annot"><span class="annottext">IO AppContext
</span><a href="#local-6989586621691176135"><span class="hs-identifier hs-var">getAppCtx</span></a></span></span><span> </span><span id="local-6989586621691176134"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621691176134"><span class="hs-identifier hs-var">httpManager</span></a></span></span><span> </span><span id="local-6989586621691176133"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691176133"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">forever</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-847"></span><span>  </span><span id="local-6989586621691176131"><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621691176131"><span class="hs-identifier hs-var">authMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; AuthMode
</span><a href="Hasura.App.State.html#acAuthMode"><span class="hs-identifier hs-var">acAuthMode</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IO AppContext
</span><a href="#local-6989586621691176135"><span class="hs-identifier hs-var">getAppCtx</span></a></span><span>
</span><span id="line-848"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m) =&gt;
AuthMode -&gt; Manager -&gt; Logger Hasura -&gt; m ()
</span><a href="Hasura.Server.Auth.html#updateJwkCtx"><span class="hs-identifier hs-var">updateJwkCtx</span></a></span><span> </span><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621691176131"><span class="hs-identifier hs-var">authMode</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621691176134"><span class="hs-identifier hs-var">httpManager</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691176133"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-849"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; IO ()
</span><a href="Control.Concurrent.Extended.html#sleep"><span class="hs-identifier hs-var">sleep</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Seconds -&gt; DiffTime
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">seconds</span></a></span><span> </span><span class="annot"><span class="annottext">Seconds
</span><span class="hs-number">1</span></span><span>
</span><span id="line-850"></span><span>
</span><span id="line-851"></span><span class="hs-comment">-- | Event triggers live in the user's DB and other events</span><span>
</span><span id="line-852"></span><span class="hs-comment">--  (cron, one-off and async actions)</span><span>
</span><span id="line-853"></span><span class="hs-comment">--   live in the metadata DB, so we need a way to differentiate the</span><span>
</span><span id="line-854"></span><span class="hs-comment">--   type of shutdown action</span><span>
</span><span id="line-855"></span><span class="hs-keyword">data</span><span> </span><span id="ShutdownAction"><span class="annot"><a href="Hasura.App.html#ShutdownAction"><span class="hs-identifier hs-var">ShutdownAction</span></a></span></span><span>
</span><span id="line-856"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="EventTriggerShutdownAction"><span class="annot"><a href="Hasura.App.html#EventTriggerShutdownAction"><span class="hs-identifier hs-var">EventTriggerShutdownAction</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-857"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MetadataDBShutdownAction"><span class="annot"><a href="Hasura.App.html#MetadataDBShutdownAction"><span class="hs-identifier hs-var">MetadataDBShutdownAction</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">QErr</span></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-858"></span><span>
</span><span id="line-859"></span><span class="hs-comment">-- | This function acts as the entrypoint for the graphql-engine webserver.</span><span>
</span><span id="line-860"></span><span class="hs-comment">--</span><span>
</span><span id="line-861"></span><span class="hs-comment">-- Note: at the exit of this function, or in case of a graceful server shutdown</span><span>
</span><span id="line-862"></span><span class="hs-comment">-- (SIGTERM, or more generally, whenever the shutdown latch is set),  we need to</span><span>
</span><span id="line-863"></span><span class="hs-comment">-- make absolutely sure that we clean up any resources which were allocated during</span><span>
</span><span id="line-864"></span><span class="hs-comment">-- server setup. In the case of a multitenant process, failure to do so can lead to</span><span>
</span><span id="line-865"></span><span class="hs-comment">-- resource leaks.</span><span>
</span><span id="line-866"></span><span class="hs-comment">--</span><span>
</span><span id="line-867"></span><span class="hs-comment">-- To track these resources, we use the ManagedT monad, and attach finalizers at</span><span>
</span><span id="line-868"></span><span class="hs-comment">-- the same point in the code where we allocate resources. If you fork a new</span><span>
</span><span id="line-869"></span><span class="hs-comment">-- long-lived thread, or create a connection pool, or allocate any other</span><span>
</span><span id="line-870"></span><span class="hs-comment">-- long-lived resource, make sure to pair the allocator  with its finalizer.</span><span>
</span><span id="line-871"></span><span class="hs-comment">-- There are plenty of examples throughout the code. For example, see</span><span>
</span><span id="line-872"></span><span class="hs-comment">-- 'C.forkManagedT'.</span><span>
</span><span id="line-873"></span><span class="hs-comment">--</span><span>
</span><span id="line-874"></span><span class="hs-comment">-- Note also: the order in which the finalizers run can be important. Specifically,</span><span>
</span><span id="line-875"></span><span class="hs-comment">-- we want the finalizers for the logger threads to run last, so that we retain as</span><span>
</span><span id="line-876"></span><span class="hs-comment">-- many &quot;thread stopping&quot; log messages as possible. The order in which the</span><span>
</span><span id="line-877"></span><span class="hs-comment">-- finalizers is run is determined by the order in which they are introduced in the</span><span>
</span><span id="line-878"></span><span class="hs-comment">-- code.</span><span>
</span><span id="line-879"></span><span>
</span><span id="line-880"></span><span class="hs-comment">{- HLINT ignore runHGEServer &quot;Avoid lambda&quot; -}</span><span>
</span><span id="line-881"></span><span class="hs-comment">{- HLINT ignore runHGEServer &quot;Use withAsync&quot; -}</span><span>
</span><span id="line-882"></span><span class="annot"><a href="Hasura.App.html#runHGEServer"><span class="hs-identifier hs-type">runHGEServer</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-883"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621691178002"><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621691177998"><span class="annot"><a href="#local-6989586621691177998"><span class="hs-identifier hs-type">impl</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-884"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-885"></span><span>    </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadFix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-886"></span><span>    </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier hs-type">MonadMask</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-887"></span><span>    </span><span class="annot"><a href="Control.Monad.Stateless.html#MonadStateless"><span class="hs-identifier hs-type">MonadStateless</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-888"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">LA.Forall</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LA.Pure</span></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-889"></span><span>    </span><span class="annot"><a href="Hasura.Server.Auth.html#UserAuthentication"><span class="hs-identifier hs-type">UserAuthentication</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-890"></span><span>    </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-891"></span><span>    </span><span class="annot"><a href="Hasura.App.State.html#HasAppEnv"><span class="hs-identifier hs-type">HasAppEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-892"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#HasCacheStaticConfig"><span class="hs-identifier hs-type">HasCacheStaticConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-893"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.FeatureFlag.html#HasFeatureFlagChecker"><span class="hs-identifier hs-type">HasFeatureFlagChecker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-894"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleRenderer"><span class="hs-identifier hs-type">ConsoleRenderer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-895"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadVersionAPIWithExtraData"><span class="hs-identifier hs-type">MonadVersionAPIWithExtraData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-896"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-897"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier hs-type">MonadGQLExecutionCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-898"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadConfigApiHandler"><span class="hs-identifier hs-type">MonadConfigApiHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-899"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.QueryLog.html#MonadQueryLog"><span class="hs-identifier hs-type">MonadQueryLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-900"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.ExecutionLog.html#MonadExecutionLog"><span class="hs-identifier hs-type">MonadExecutionLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-901"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#MonadWSLog"><span class="hs-identifier hs-type">WS.MonadWSLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-902"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier hs-type">MonadExecuteQuery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-903"></span><span>    </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-904"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-905"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-906"></span><span>    </span><span class="annot"><a href="Hasura.QueryTags.html#MonadQueryTags"><span class="hs-identifier hs-type">MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-907"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier hs-type">MonadEventLogCleanup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-908"></span><span>    </span><span class="annot"><a href="Hasura.Services.html#ProvidesHasuraServices"><span class="hs-identifier hs-type">ProvidesHasuraServices</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-909"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-type">MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-910"></span><span>    </span><span class="annot"><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier hs-type">MonadGetPolicies</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-911"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-912"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.AppStateRef.html#AppStateRef"><span class="hs-identifier hs-type">AppStateRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177998"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spock.SpockT</span></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-913"></span><span>  </span><span class="annot"><a href="Hasura.Server.AppStateRef.html#AppStateRef"><span class="hs-identifier hs-type">AppStateRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177998"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-914"></span><span>  </span><span class="hs-comment">-- | start time</span><span>
</span><span id="line-915"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/time-1.11.1.1/src"><span class="hs-identifier hs-type">UTCTime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-916"></span><span>  </span><span class="hs-comment">-- | A hook which can be called to indicate when the server is started succesfully</span><span>
</span><span id="line-917"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-918"></span><span>  </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleType"><span class="hs-identifier hs-type">ConsoleType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-919"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">EKG.Store</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EKG.EmptyMetrics</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-920"></span><span>  </span><span class="annot"><a href="Control.Monad.Trans.Managed.html#ManagedT"><span class="hs-identifier hs-type">ManagedT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691178002"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-921"></span><span id="runHGEServer"><span class="annot"><span class="annottext">runHGEServer :: forall (m :: * -&gt; *) impl.
(MonadIO m, MonadFix m, MonadMask m, MonadStateless IO m,
 Forall (Pure m), UserAuthentication m, HttpLog m, HasAppEnv m,
 HasCacheStaticConfig m, HasFeatureFlagChecker m, ConsoleRenderer m,
 MonadVersionAPIWithExtraData m, MonadMetadataApiAuthorization m,
 MonadGQLExecutionCheck m, MonadConfigApiHandler m, MonadQueryLog m,
 MonadExecutionLog m, MonadWSLog m, MonadExecuteQuery m,
 HasResourceLimits m, MonadMetadataStorage m, MonadResolveSource m,
 MonadQueryTags m, MonadEventLogCleanup m, ProvidesHasuraServices m,
 MonadTrace m, MonadGetPolicies m) =&gt;
(AppStateRef impl -&gt; SpockT m ())
-&gt; AppStateRef impl
-&gt; UTCTime
-&gt; Maybe (IO ())
-&gt; ConsoleType m
-&gt; Store EmptyMetrics
-&gt; ManagedT m ()
</span><a href="Hasura.App.html#runHGEServer"><span class="hs-identifier hs-var hs-var">runHGEServer</span></a></span></span><span> </span><span id="local-6989586621691176019"><span class="annot"><span class="annottext">AppStateRef impl -&gt; SpockT m ()
</span><a href="#local-6989586621691176019"><span class="hs-identifier hs-var">setupHook</span></a></span></span><span> </span><span id="local-6989586621691176018"><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691176018"><span class="hs-identifier hs-var">appStateRef</span></a></span></span><span> </span><span id="local-6989586621691176017"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621691176017"><span class="hs-identifier hs-var">initTime</span></a></span></span><span> </span><span id="local-6989586621691176016"><span class="annot"><span class="annottext">Maybe (IO ())
</span><a href="#local-6989586621691176016"><span class="hs-identifier hs-var">startupStatusHook</span></a></span></span><span> </span><span id="local-6989586621691176015"><span class="annot"><span class="annottext">ConsoleType m
</span><a href="#local-6989586621691176015"><span class="hs-identifier hs-var">consoleType</span></a></span></span><span> </span><span id="local-6989586621691176014"><span class="annot"><span class="annottext">Store EmptyMetrics
</span><a href="#local-6989586621691176014"><span class="hs-identifier hs-var">ekgStore</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-922"></span><span>  </span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">AppEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621691175984"><span id="local-6989586621691175985"><span id="local-6989586621691175986"><span id="local-6989586621691175987"><span id="local-6989586621691175988"><span id="local-6989586621691175989"><span id="local-6989586621691175990"><span id="local-6989586621691175991"><span id="local-6989586621691175992"><span id="local-6989586621691175993"><span id="local-6989586621691175994"><span id="local-6989586621691175995"><span id="local-6989586621691175996"><span id="local-6989586621691175997"><span id="local-6989586621691175998"><span id="local-6989586621691175999"><span id="local-6989586621691176000"><span id="local-6989586621691176001"><span id="local-6989586621691176002"><span id="local-6989586621691176003"><span id="local-6989586621691176004"><span id="local-6989586621691176005"><span id="local-6989586621691176006"><span id="local-6989586621691176007"><span id="local-6989586621691176008"><span id="local-6989586621691176009"><span id="local-6989586621691176010"><span id="local-6989586621691176011"><span id="local-6989586621691176012"><span id="local-6989586621691176013"><span class="annot"><span class="annottext">Maybe Text
Maybe PGPool
Maybe (CredentialCache AgentLicenseKey)
SamplingPolicy
PGPool
ConnParams
TxIsolation
TMVar MetadataResourceVersion
Refined NonNegative Seconds
Manager
CheckFeatureFlag
ServerMetrics
EventingMode
ReadOnlyMode
MaintenanceMode ()
InstanceId
PrometheusMetrics
ShutdownLatch
LoggingSettings
LockedEventsCtx
HostPreference
ConnectionOptions
WSConnectionInitTimeout
KeepAliveDelay
OptionalInterval
Port
SubscriptionsState
Loggers
appEnvLicenseKeyCache :: Maybe (CredentialCache AgentLicenseKey)
appEnvCheckFeatureFlag :: CheckFeatureFlag
appEnvSchemaPollInterval :: OptionalInterval
appEnvGracefulShutdownTimeout :: Refined NonNegative Seconds
appEnvWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
appEnvWebSocketKeepAlive :: KeepAliveDelay
appEnvConnectionOptions :: ConnectionOptions
appEnvConsoleSentryDsn :: Maybe Text
appEnvConsoleAssetsDir :: Maybe Text
appEnvTxIso :: TxIsolation
appEnvConnParams :: ConnParams
appEnvLockedEventsCtx :: LockedEventsCtx
appEnvSubscriptionState :: SubscriptionsState
appEnvTraceSamplingPolicy :: SamplingPolicy
appEnvPrometheusMetrics :: PrometheusMetrics
appEnvMetaVersionRef :: TMVar MetadataResourceVersion
appEnvShutdownLatch :: ShutdownLatch
appEnvServerMetrics :: ServerMetrics
appEnvEnableReadOnlyMode :: ReadOnlyMode
appEnvEventingMode :: EventingMode
appEnvLoggingSettings :: LoggingSettings
appEnvEnableMaintenanceMode :: MaintenanceMode ()
appEnvInstanceId :: InstanceId
appEnvMetadataVersionRef :: TMVar MetadataResourceVersion
appEnvLoggers :: Loggers
appEnvManager :: Manager
appEnvIntrospectionDbPool :: Maybe PGPool
appEnvMetadataDbPool :: PGPool
appEnvHost :: HostPreference
appEnvPort :: Port
appEnvLicenseKeyCache :: AppEnv -&gt; Maybe (CredentialCache AgentLicenseKey)
appEnvSchemaPollInterval :: AppEnv -&gt; OptionalInterval
appEnvCheckFeatureFlag :: AppEnv -&gt; CheckFeatureFlag
appEnvGracefulShutdownTimeout :: AppEnv -&gt; Refined NonNegative Seconds
appEnvWebSocketConnectionInitTimeout :: AppEnv -&gt; WSConnectionInitTimeout
appEnvWebSocketKeepAlive :: AppEnv -&gt; KeepAliveDelay
appEnvConnectionOptions :: AppEnv -&gt; ConnectionOptions
appEnvConsoleSentryDsn :: AppEnv -&gt; Maybe Text
appEnvConsoleAssetsDir :: AppEnv -&gt; Maybe Text
appEnvTxIso :: AppEnv -&gt; TxIsolation
appEnvConnParams :: AppEnv -&gt; ConnParams
appEnvLockedEventsCtx :: AppEnv -&gt; LockedEventsCtx
appEnvSubscriptionState :: AppEnv -&gt; SubscriptionsState
appEnvTraceSamplingPolicy :: AppEnv -&gt; SamplingPolicy
appEnvPrometheusMetrics :: AppEnv -&gt; PrometheusMetrics
appEnvMetaVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvShutdownLatch :: AppEnv -&gt; ShutdownLatch
appEnvServerMetrics :: AppEnv -&gt; ServerMetrics
appEnvEnableReadOnlyMode :: AppEnv -&gt; ReadOnlyMode
appEnvEventingMode :: AppEnv -&gt; EventingMode
appEnvLoggingSettings :: AppEnv -&gt; LoggingSettings
appEnvEnableMaintenanceMode :: AppEnv -&gt; MaintenanceMode ()
appEnvInstanceId :: AppEnv -&gt; InstanceId
appEnvMetadataVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvLoggers :: AppEnv -&gt; Loggers
appEnvManager :: AppEnv -&gt; Manager
appEnvIntrospectionDbPool :: AppEnv -&gt; Maybe PGPool
appEnvMetadataDbPool :: AppEnv -&gt; PGPool
appEnvHost :: AppEnv -&gt; HostPreference
appEnvPort :: AppEnv -&gt; Port
</span><a href="#local-6989586621691175984"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasAppEnv m =&gt; m AppEnv
</span><a href="Hasura.App.State.html#askAppEnv"><span class="hs-identifier hs-var">askAppEnv</span></a></span><span>
</span><span id="line-923"></span><span>  </span><span id="local-6989586621691175983"><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621691175983"><span class="hs-identifier hs-var">waiApplication</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) impl.
(MonadIO m, MonadFix m, MonadMask m, MonadStateless IO m,
 Forall (Pure m), UserAuthentication m, HttpLog m, HasAppEnv m,
 HasCacheStaticConfig m, HasFeatureFlagChecker m, ConsoleRenderer m,
 MonadVersionAPIWithExtraData m, MonadMetadataApiAuthorization m,
 MonadGQLExecutionCheck m, MonadConfigApiHandler m, MonadQueryLog m,
 MonadExecutionLog m, MonadWSLog m, MonadExecuteQuery m,
 HasResourceLimits m, MonadMetadataStorage m, MonadResolveSource m,
 MonadQueryTags m, MonadEventLogCleanup m, ProvidesHasuraServices m,
 MonadTrace m, MonadGetPolicies m) =&gt;
(AppStateRef impl -&gt; SpockT m ())
-&gt; AppStateRef impl
-&gt; ConsoleType m
-&gt; Store EmptyMetrics
-&gt; ManagedT m Application
</span><a href="Hasura.App.html#mkHGEServer"><span class="hs-identifier hs-var">mkHGEServer</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; SpockT m ()
</span><a href="#local-6989586621691176019"><span class="hs-identifier hs-var">setupHook</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691176018"><span class="hs-identifier hs-var">appStateRef</span></a></span><span> </span><span class="annot"><span class="annottext">ConsoleType m
</span><a href="#local-6989586621691176015"><span class="hs-identifier hs-var">consoleType</span></a></span><span> </span><span class="annot"><span class="annottext">Store EmptyMetrics
</span><a href="#local-6989586621691176014"><span class="hs-identifier hs-var">ekgStore</span></a></span><span>
</span><span id="line-924"></span><span>
</span><span id="line-925"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621691175982"><span class="annot"><span class="annottext">logger :: Logger Hasura
</span><a href="#local-6989586621691175982"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Loggers -&gt; Logger Hasura
</span><a href="Hasura.App.State.html#_lsLogger"><span class="hs-identifier hs-var">_lsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Loggers
</span><a href="#local-6989586621691176008"><span class="hs-identifier hs-var">appEnvLoggers</span></a></span><span>
</span><span id="line-926"></span><span>  </span><span class="hs-comment">-- `startupStatusHook`: add `Service started successfully` message to config_status</span><span>
</span><span id="line-927"></span><span>  </span><span class="hs-comment">-- table when a tenant starts up in multitenant</span><span>
</span><span id="line-928"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621691175980"><span class="hs-identifier hs-type">warpSettings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Warp.Settings</span></span><span>
</span><span id="line-929"></span><span>      </span><span id="local-6989586621691175980"><span class="annot"><span class="annottext">warpSettings :: Settings
</span><a href="#local-6989586621691175980"><span class="hs-identifier hs-var hs-var">warpSettings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-930"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">Warp.setPort</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port -&gt; Int
</span><a href="Hasura.Server.Init.Config.html#_getPort"><span class="hs-identifier hs-var">_getPort</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621691176013"><span class="hs-identifier hs-var">appEnvPort</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-931"></span><span>          </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HostPreference -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">Warp.setHost</span></span><span> </span><span class="annot"><span class="annottext">HostPreference
</span><a href="#local-6989586621691176012"><span class="hs-identifier hs-var">appEnvHost</span></a></span><span>
</span><span id="line-932"></span><span>          </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">Warp.setGracefulShutdownTimeout</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- 30s graceful shutdown</span><span>
</span><span id="line-933"></span><span>          </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">Warp.setInstallShutdownHandler</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
</span><a href="#local-6989586621691175974"><span class="hs-identifier hs-var">shutdownHandler</span></a></span><span>
</span><span id="line-934"></span><span>          </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">Warp.setBeforeMainLoop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">for_</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (IO ())
</span><a href="#local-6989586621691176016"><span class="hs-identifier hs-var">startupStatusHook</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-935"></span><span>          </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Settings -&gt; Settings
</span><a href="#local-6989586621691175971"><span class="hs-identifier hs-var">setForkIOWithMetrics</span></a></span><span>
</span><span id="line-936"></span><span>          </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Settings
</span><span class="hs-identifier hs-var">Warp.defaultSettings</span></span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span>      </span><span class="annot"><a href="#local-6989586621691175971"><span class="hs-identifier hs-type">setForkIOWithMetrics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Warp.Settings</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Warp.Settings</span></span><span>
</span><span id="line-939"></span><span>      </span><span id="local-6989586621691175971"><span class="annot"><span class="annottext">setForkIOWithMetrics :: Settings -&gt; Settings
</span><a href="#local-6989586621691175971"><span class="hs-identifier hs-var hs-var">setForkIOWithMetrics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO ())
-&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">Warp.setFork</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621691175968"><span class="annot"><span class="annottext">(forall a. IO a -&gt; IO a) -&gt; IO ()
</span><a href="#local-6989586621691175968"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-940"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-941"></span><span>          </span><span class="annot"><span class="annottext">((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO ThreadId
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">C.forkIOWithUnmask</span></a></span><span>
</span><span id="line-942"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621691175966"><span class="annot"><span class="annottext">forall a. IO a -&gt; IO a
</span><a href="#local-6989586621691175966"><span class="hs-identifier hs-var">unmask</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-943"></span><span>                </span><span class="annot"><span class="annottext">forall a b c. IO a -&gt; IO b -&gt; IO c -&gt; IO c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">bracket_</span></a></span><span>
</span><span id="line-944"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-945"></span><span>                      </span><span class="annot"><span class="annottext">Gauge -&gt; IO ()
</span><span class="hs-identifier hs-var">EKG.Gauge.inc</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerMetrics -&gt; Gauge
</span><a href="Hasura.Server.Metrics.html#smWarpThreads"><span class="hs-identifier hs-var">smWarpThreads</span></a></span><span> </span><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621691176001"><span class="hs-identifier hs-var">appEnvServerMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-946"></span><span>                      </span><span class="annot"><span class="annottext">ConnectionsGauge -&gt; IO ()
</span><a href="Hasura.Server.Prometheus.html#incWarpThreads"><span class="hs-identifier hs-var">incWarpThreads</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrometheusMetrics -&gt; ConnectionsGauge
</span><a href="Hasura.Server.Prometheus.html#pmConnections"><span class="hs-identifier hs-var">pmConnections</span></a></span><span> </span><span class="annot"><span class="annottext">PrometheusMetrics
</span><a href="#local-6989586621691175998"><span class="hs-identifier hs-var">appEnvPrometheusMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-947"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-948"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-949"></span><span>                      </span><span class="annot"><span class="annottext">Gauge -&gt; IO ()
</span><span class="hs-identifier hs-var">EKG.Gauge.dec</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerMetrics -&gt; Gauge
</span><a href="Hasura.Server.Metrics.html#smWarpThreads"><span class="hs-identifier hs-var">smWarpThreads</span></a></span><span> </span><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621691176001"><span class="hs-identifier hs-var">appEnvServerMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-950"></span><span>                      </span><span class="annot"><span class="annottext">ConnectionsGauge -&gt; IO ()
</span><a href="Hasura.Server.Prometheus.html#decWarpThreads"><span class="hs-identifier hs-var">decWarpThreads</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrometheusMetrics -&gt; ConnectionsGauge
</span><a href="Hasura.Server.Prometheus.html#pmConnections"><span class="hs-identifier hs-var">pmConnections</span></a></span><span> </span><span class="annot"><span class="annottext">PrometheusMetrics
</span><a href="#local-6989586621691175998"><span class="hs-identifier hs-var">appEnvPrometheusMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-951"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-952"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall a. IO a -&gt; IO a) -&gt; IO ()
</span><a href="#local-6989586621691175968"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. IO a -&gt; IO a
</span><a href="#local-6989586621691175966"><span class="hs-identifier hs-var">unmask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-953"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-954"></span><span>
</span><span id="line-955"></span><span>      </span><span class="annot"><a href="#local-6989586621691175974"><span class="hs-identifier hs-type">shutdownHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-956"></span><span>      </span><span id="local-6989586621691175974"><span class="annot"><span class="annottext">shutdownHandler :: IO () -&gt; IO ()
</span><a href="#local-6989586621691175974"><span class="hs-identifier hs-var hs-var">shutdownHandler</span></a></span></span><span> </span><span id="local-6989586621691175961"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621691175961"><span class="hs-identifier hs-var">closeSocket</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-957"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadBase IO m =&gt; Async a -&gt; m ()
</span><span class="hs-identifier hs-var">LA.link</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(MonadBaseControl IO m, Forall (Pure m)) =&gt;
m a -&gt; m (Async a)
</span><span class="hs-identifier hs-var">LA.async</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-958"></span><span>          </span><span class="annot"><span class="annottext">ShutdownLatch -&gt; IO ()
</span><a href="Hasura.ShutdownLatch.html#waitForShutdown"><span class="hs-identifier hs-var">waitForShutdown</span></a></span><span> </span><span class="annot"><span class="annottext">ShutdownLatch
</span><a href="#local-6989586621691176000"><span class="hs-identifier hs-var">appEnvShutdownLatch</span></a></span><span>
</span><span id="line-959"></span><span>          </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175982"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; LogLevel -&gt; Text -&gt; a -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericLog"><span class="hs-identifier hs-var">mkGenericLog</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;server&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;gracefully shutting down server&quot;</span></span><span>
</span><span id="line-960"></span><span>          </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621691175961"><span class="hs-identifier hs-var">closeSocket</span></a></span><span>
</span><span id="line-961"></span><span>
</span><span id="line-962"></span><span>  </span><span id="local-6989586621691175956"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621691175956"><span class="hs-identifier hs-var">finishTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/time-1.11.1.1/src"><span class="hs-identifier hs-var">Clock.getCurrentTime</span></a></span><span>
</span><span id="line-963"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621691175955"><span class="annot"><span class="annottext">apiInitTime :: Double
</span><a href="#local-6989586621691175955"><span class="hs-identifier hs-var hs-var">apiInitTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Real a, Fractional b) =&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">realToFrac</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; NominalDiffTime
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/time-1.11.1.1/src"><span class="hs-identifier hs-var">Clock.diffUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621691175956"><span class="hs-identifier hs-var">finishTime</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621691176017"><span class="hs-identifier hs-var">initTime</span></a></span><span>
</span><span id="line-964"></span><span>  </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175982"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-965"></span><span>    </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; LogLevel -&gt; Text -&gt; a -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericLog"><span class="hs-identifier hs-var">mkGenericLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;server&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-966"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Double -&gt; StartupTimeInfo
</span><a href="Hasura.Server.Init.Logging.html#StartupTimeInfo"><span class="hs-identifier hs-var">StartupTimeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;starting API server&quot;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621691175955"><span class="hs-identifier hs-var">apiInitTime</span></a></span><span>
</span><span id="line-967"></span><span>
</span><span id="line-968"></span><span>  </span><span class="hs-comment">-- Here we block until the shutdown latch 'MVar' is filled, and then</span><span>
</span><span id="line-969"></span><span>  </span><span class="hs-comment">-- shut down the server. Once this blocking call returns, we'll tidy up</span><span>
</span><span id="line-970"></span><span>  </span><span class="hs-comment">-- any resources using the finalizers attached using 'ManagedT' above.</span><span>
</span><span id="line-971"></span><span>  </span><span class="hs-comment">-- Structuring things using the shutdown latch in this way lets us decide</span><span>
</span><span id="line-972"></span><span>  </span><span class="hs-comment">-- elsewhere exactly how we want to control shutdown.</span><span>
</span><span id="line-973"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Settings -&gt; Application -&gt; IO ()
</span><span class="hs-identifier hs-var">Warp.runSettings</span></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621691175980"><span class="hs-identifier hs-var">warpSettings</span></a></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621691175983"><span class="hs-identifier hs-var">waiApplication</span></a></span><span>
</span><span id="line-974"></span><span>
</span><span id="line-975"></span><span class="hs-comment">-- | Part of a factorization of 'runHGEServer' to expose the constructed WAI</span><span>
</span><span id="line-976"></span><span class="hs-comment">-- application for testing purposes. See 'runHGEServer' for documentation.</span><span>
</span><span id="line-977"></span><span class="annot"><a href="Hasura.App.html#mkHGEServer"><span class="hs-identifier hs-type">mkHGEServer</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-978"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621691177982"><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621691177981"><span class="annot"><a href="#local-6989586621691177981"><span class="hs-identifier hs-type">impl</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-979"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-980"></span><span>    </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadFix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-981"></span><span>    </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier hs-type">MonadMask</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-982"></span><span>    </span><span class="annot"><a href="Control.Monad.Stateless.html#MonadStateless"><span class="hs-identifier hs-type">MonadStateless</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-983"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">LA.Forall</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LA.Pure</span></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-984"></span><span>    </span><span class="annot"><a href="Hasura.Server.Auth.html#UserAuthentication"><span class="hs-identifier hs-type">UserAuthentication</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-985"></span><span>    </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-986"></span><span>    </span><span class="annot"><a href="Hasura.App.State.html#HasAppEnv"><span class="hs-identifier hs-type">HasAppEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-987"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#HasCacheStaticConfig"><span class="hs-identifier hs-type">HasCacheStaticConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-988"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.FeatureFlag.html#HasFeatureFlagChecker"><span class="hs-identifier hs-type">HasFeatureFlagChecker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-989"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleRenderer"><span class="hs-identifier hs-type">ConsoleRenderer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-990"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadVersionAPIWithExtraData"><span class="hs-identifier hs-type">MonadVersionAPIWithExtraData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-991"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-992"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier hs-type">MonadGQLExecutionCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-993"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadConfigApiHandler"><span class="hs-identifier hs-type">MonadConfigApiHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-994"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.QueryLog.html#MonadQueryLog"><span class="hs-identifier hs-type">MonadQueryLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-995"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.ExecutionLog.html#MonadExecutionLog"><span class="hs-identifier hs-type">MonadExecutionLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-996"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#MonadWSLog"><span class="hs-identifier hs-type">WS.MonadWSLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-997"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier hs-type">MonadExecuteQuery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-998"></span><span>    </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-999"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1000"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1001"></span><span>    </span><span class="annot"><a href="Hasura.QueryTags.html#MonadQueryTags"><span class="hs-identifier hs-type">MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1002"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier hs-type">MonadEventLogCleanup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1003"></span><span>    </span><span class="annot"><a href="Hasura.Services.html#ProvidesHasuraServices"><span class="hs-identifier hs-type">ProvidesHasuraServices</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1004"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-type">MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1005"></span><span>    </span><span class="annot"><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier hs-type">MonadGetPolicies</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-1006"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1007"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.AppStateRef.html#AppStateRef"><span class="hs-identifier hs-type">AppStateRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177981"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spock.SpockT</span></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1008"></span><span>  </span><span class="annot"><a href="Hasura.Server.AppStateRef.html#AppStateRef"><span class="hs-identifier hs-type">AppStateRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177981"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1009"></span><span>  </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleType"><span class="hs-identifier hs-type">ConsoleType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1010"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">EKG.Store</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EKG.EmptyMetrics</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1011"></span><span>  </span><span class="annot"><a href="Control.Monad.Trans.Managed.html#ManagedT"><span class="hs-identifier hs-type">ManagedT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Application</span></span><span>
</span><span id="line-1012"></span><span id="mkHGEServer"><span class="annot"><span class="annottext">mkHGEServer :: forall (m :: * -&gt; *) impl.
(MonadIO m, MonadFix m, MonadMask m, MonadStateless IO m,
 Forall (Pure m), UserAuthentication m, HttpLog m, HasAppEnv m,
 HasCacheStaticConfig m, HasFeatureFlagChecker m, ConsoleRenderer m,
 MonadVersionAPIWithExtraData m, MonadMetadataApiAuthorization m,
 MonadGQLExecutionCheck m, MonadConfigApiHandler m, MonadQueryLog m,
 MonadExecutionLog m, MonadWSLog m, MonadExecuteQuery m,
 HasResourceLimits m, MonadMetadataStorage m, MonadResolveSource m,
 MonadQueryTags m, MonadEventLogCleanup m, ProvidesHasuraServices m,
 MonadTrace m, MonadGetPolicies m) =&gt;
(AppStateRef impl -&gt; SpockT m ())
-&gt; AppStateRef impl
-&gt; ConsoleType m
-&gt; Store EmptyMetrics
-&gt; ManagedT m Application
</span><a href="Hasura.App.html#mkHGEServer"><span class="hs-identifier hs-var hs-var">mkHGEServer</span></a></span></span><span> </span><span id="local-6989586621691175642"><span class="annot"><span class="annottext">AppStateRef impl -&gt; SpockT m ()
</span><a href="#local-6989586621691175642"><span class="hs-identifier hs-var">setupHook</span></a></span></span><span> </span><span id="local-6989586621691175641"><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span></span><span> </span><span id="local-6989586621691175640"><span class="annot"><span class="annottext">ConsoleType m
</span><a href="#local-6989586621691175640"><span class="hs-identifier hs-var">consoleType</span></a></span></span><span> </span><span id="local-6989586621691175639"><span class="annot"><span class="annottext">Store EmptyMetrics
</span><a href="#local-6989586621691175639"><span class="hs-identifier hs-var">ekgStore</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1013"></span><span>  </span><span class="hs-comment">-- Comment this to enable expensive assertions from &quot;GHC.AssertNF&quot;. These</span><span>
</span><span id="line-1014"></span><span>  </span><span class="hs-comment">-- will log lines to STDOUT containing &quot;not in normal form&quot;. In the future we</span><span>
</span><span id="line-1015"></span><span>  </span><span class="hs-comment">-- could try to integrate this into our tests. For now this is a development</span><span>
</span><span id="line-1016"></span><span>  </span><span class="hs-comment">-- tool.</span><span>
</span><span id="line-1017"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-1018"></span><span>  </span><span class="hs-comment">-- NOTE: be sure to compile WITHOUT code coverage, for this to work properly.</span><span>
</span><span id="line-1019"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><span class="hs-identifier hs-var">disableAssertNF</span></span><span>
</span><span id="line-1020"></span><span>  </span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">AppEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621691175608"><span id="local-6989586621691175609"><span id="local-6989586621691175610"><span id="local-6989586621691175611"><span id="local-6989586621691175612"><span id="local-6989586621691175613"><span id="local-6989586621691175614"><span id="local-6989586621691175615"><span id="local-6989586621691175616"><span id="local-6989586621691175617"><span id="local-6989586621691175618"><span id="local-6989586621691175619"><span id="local-6989586621691175620"><span id="local-6989586621691175621"><span id="local-6989586621691175622"><span id="local-6989586621691175623"><span id="local-6989586621691175624"><span id="local-6989586621691175625"><span id="local-6989586621691175626"><span id="local-6989586621691175627"><span id="local-6989586621691175628"><span id="local-6989586621691175629"><span id="local-6989586621691175630"><span id="local-6989586621691175631"><span id="local-6989586621691175632"><span id="local-6989586621691175633"><span id="local-6989586621691175634"><span id="local-6989586621691175635"><span id="local-6989586621691175636"><span id="local-6989586621691175637"><span class="annot"><span class="annottext">Maybe Text
Maybe PGPool
Maybe (CredentialCache AgentLicenseKey)
SamplingPolicy
PGPool
ConnParams
TxIsolation
TMVar MetadataResourceVersion
Refined NonNegative Seconds
Manager
CheckFeatureFlag
ServerMetrics
EventingMode
ReadOnlyMode
MaintenanceMode ()
InstanceId
PrometheusMetrics
ShutdownLatch
LoggingSettings
LockedEventsCtx
HostPreference
ConnectionOptions
WSConnectionInitTimeout
KeepAliveDelay
OptionalInterval
Port
SubscriptionsState
Loggers
appEnvLicenseKeyCache :: Maybe (CredentialCache AgentLicenseKey)
appEnvCheckFeatureFlag :: CheckFeatureFlag
appEnvSchemaPollInterval :: OptionalInterval
appEnvGracefulShutdownTimeout :: Refined NonNegative Seconds
appEnvWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
appEnvWebSocketKeepAlive :: KeepAliveDelay
appEnvConnectionOptions :: ConnectionOptions
appEnvConsoleSentryDsn :: Maybe Text
appEnvConsoleAssetsDir :: Maybe Text
appEnvTxIso :: TxIsolation
appEnvConnParams :: ConnParams
appEnvLockedEventsCtx :: LockedEventsCtx
appEnvSubscriptionState :: SubscriptionsState
appEnvTraceSamplingPolicy :: SamplingPolicy
appEnvPrometheusMetrics :: PrometheusMetrics
appEnvMetaVersionRef :: TMVar MetadataResourceVersion
appEnvShutdownLatch :: ShutdownLatch
appEnvServerMetrics :: ServerMetrics
appEnvEnableReadOnlyMode :: ReadOnlyMode
appEnvEventingMode :: EventingMode
appEnvLoggingSettings :: LoggingSettings
appEnvEnableMaintenanceMode :: MaintenanceMode ()
appEnvInstanceId :: InstanceId
appEnvMetadataVersionRef :: TMVar MetadataResourceVersion
appEnvLoggers :: Loggers
appEnvManager :: Manager
appEnvIntrospectionDbPool :: Maybe PGPool
appEnvMetadataDbPool :: PGPool
appEnvHost :: HostPreference
appEnvPort :: Port
appEnvLicenseKeyCache :: AppEnv -&gt; Maybe (CredentialCache AgentLicenseKey)
appEnvSchemaPollInterval :: AppEnv -&gt; OptionalInterval
appEnvCheckFeatureFlag :: AppEnv -&gt; CheckFeatureFlag
appEnvGracefulShutdownTimeout :: AppEnv -&gt; Refined NonNegative Seconds
appEnvWebSocketConnectionInitTimeout :: AppEnv -&gt; WSConnectionInitTimeout
appEnvWebSocketKeepAlive :: AppEnv -&gt; KeepAliveDelay
appEnvConnectionOptions :: AppEnv -&gt; ConnectionOptions
appEnvConsoleSentryDsn :: AppEnv -&gt; Maybe Text
appEnvConsoleAssetsDir :: AppEnv -&gt; Maybe Text
appEnvTxIso :: AppEnv -&gt; TxIsolation
appEnvConnParams :: AppEnv -&gt; ConnParams
appEnvLockedEventsCtx :: AppEnv -&gt; LockedEventsCtx
appEnvSubscriptionState :: AppEnv -&gt; SubscriptionsState
appEnvTraceSamplingPolicy :: AppEnv -&gt; SamplingPolicy
appEnvPrometheusMetrics :: AppEnv -&gt; PrometheusMetrics
appEnvMetaVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvShutdownLatch :: AppEnv -&gt; ShutdownLatch
appEnvServerMetrics :: AppEnv -&gt; ServerMetrics
appEnvEnableReadOnlyMode :: AppEnv -&gt; ReadOnlyMode
appEnvEventingMode :: AppEnv -&gt; EventingMode
appEnvLoggingSettings :: AppEnv -&gt; LoggingSettings
appEnvEnableMaintenanceMode :: AppEnv -&gt; MaintenanceMode ()
appEnvInstanceId :: AppEnv -&gt; InstanceId
appEnvMetadataVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvLoggers :: AppEnv -&gt; Loggers
appEnvManager :: AppEnv -&gt; Manager
appEnvIntrospectionDbPool :: AppEnv -&gt; Maybe PGPool
appEnvMetadataDbPool :: AppEnv -&gt; PGPool
appEnvHost :: AppEnv -&gt; HostPreference
appEnvPort :: AppEnv -&gt; Port
</span><a href="#local-6989586621691175608"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasAppEnv m =&gt; m AppEnv
</span><a href="Hasura.App.State.html#askAppEnv"><span class="hs-identifier hs-var">askAppEnv</span></a></span><span>
</span><span id="line-1021"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.App.State.html#Loggers"><span class="hs-identifier hs-type">Loggers</span></a></span><span> </span><span id="local-6989586621691175607"><span class="annot"><span class="annottext">LoggerCtx Hasura
</span><a href="#local-6989586621691175607"><span class="hs-identifier hs-var">loggerCtx</span></a></span></span><span> </span><span id="local-6989586621691175606"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175606"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="annot"><span class="annottext">PGLogger
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Loggers
</span><a href="#local-6989586621691175632"><span class="hs-identifier hs-var">appEnvLoggers</span></a></span><span>
</span><span id="line-1022"></span><span>
</span><span id="line-1023"></span><span>  </span><span id="local-6989586621691175605"><span class="annot"><span class="annottext">WSServerEnv impl
</span><a href="#local-6989586621691175605"><span class="hs-identifier hs-var">wsServerEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) impl.
(HasAppEnv m, MonadIO m) =&gt;
AppStateRef impl -&gt; m (WSServerEnv impl)
</span><a href="Hasura.GraphQL.Transport.WSServerApp.html#createWSServerEnv"><span class="hs-identifier hs-var">WS.createWSServerEnv</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-1024"></span><span>
</span><span id="line-1025"></span><span>  </span><span class="annot"><a href="Hasura.Server.App.html#HasuraApp"><span class="hs-identifier hs-type">HasuraApp</span></a></span><span> </span><span id="local-6989586621691175602"><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621691175602"><span class="hs-identifier hs-var">app</span></a></span></span><span> </span><span id="local-6989586621691175601"><span class="annot"><span class="annottext">AsyncActionSubscriptionState
</span><a href="#local-6989586621691175601"><span class="hs-identifier hs-var">actionSubState</span></a></span></span><span> </span><span id="local-6989586621691175600"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621691175600"><span class="hs-identifier hs-var">stopWsServer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1026"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1027"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) impl.
(MonadIO m, MonadFix m, MonadStateless IO m, Forall (Pure m),
 ConsoleRenderer m, MonadVersionAPIWithExtraData m, HttpLog m,
 HasAppEnv m, HasCacheStaticConfig m, HasFeatureFlagChecker m,
 UserAuthentication m, MonadMetadataApiAuthorization m,
 MonadGQLExecutionCheck m, MonadConfigApiHandler m, MonadQueryLog m,
 MonadExecutionLog m, MonadWSLog m, MonadTrace m,
 MonadExecuteQuery m, HasResourceLimits m, MonadMetadataStorage m,
 MonadResolveSource m, MonadQueryTags m, MonadEventLogCleanup m,
 ProvidesNetwork m, MonadGetPolicies m) =&gt;
(AppStateRef impl -&gt; SpockT m ())
-&gt; AppStateRef impl
-&gt; ConsoleType m
-&gt; Store EmptyMetrics
-&gt; WSServerEnv impl
-&gt; m HasuraApp
</span><a href="Hasura.Server.App.html#mkWaiApp"><span class="hs-identifier hs-var">mkWaiApp</span></a></span><span>
</span><span id="line-1028"></span><span>        </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; SpockT m ()
</span><a href="#local-6989586621691175642"><span class="hs-identifier hs-var">setupHook</span></a></span><span>
</span><span id="line-1029"></span><span>        </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-1030"></span><span>        </span><span class="annot"><span class="annottext">ConsoleType m
</span><a href="#local-6989586621691175640"><span class="hs-identifier hs-var">consoleType</span></a></span><span>
</span><span id="line-1031"></span><span>        </span><span class="annot"><span class="annottext">Store EmptyMetrics
</span><a href="#local-6989586621691175639"><span class="hs-identifier hs-var">ekgStore</span></a></span><span>
</span><span id="line-1032"></span><span>        </span><span class="annot"><span class="annottext">WSServerEnv impl
</span><a href="#local-6989586621691175605"><span class="hs-identifier hs-var">wsServerEnv</span></a></span><span>
</span><span id="line-1033"></span><span>
</span><span id="line-1034"></span><span>  </span><span class="hs-comment">-- Log Warning if deprecated environment variables are used</span><span>
</span><span id="line-1035"></span><span>  </span><span id="local-6989586621691175598"><span class="annot"><span class="annottext">SourceCache
</span><a href="#local-6989586621691175598"><span class="hs-identifier hs-var">sources</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; SourceCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#scSources"><span class="hs-identifier hs-var">scSources</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall impl. AppStateRef impl -&gt; IO SchemaCache
</span><a href="Hasura.Server.AppStateRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1036"></span><span>  </span><span class="hs-comment">-- TODO: naveen: send IO to logDeprecatedEnvVars</span><span>
</span><span id="line-1037"></span><span>  </span><span class="annot"><a href="Hasura.App.State.html#AppContext"><span class="hs-identifier hs-type">AppContext</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621691175576"><span id="local-6989586621691175577"><span id="local-6989586621691175578"><span id="local-6989586621691175579"><span id="local-6989586621691175580"><span id="local-6989586621691175581"><span id="local-6989586621691175582"><span id="local-6989586621691175583"><span id="local-6989586621691175584"><span id="local-6989586621691175585"><span id="local-6989586621691175586"><span id="local-6989586621691175587"><span id="local-6989586621691175588"><span id="local-6989586621691175589"><span id="local-6989586621691175590"><span id="local-6989586621691175591"><span id="local-6989586621691175592"><span id="local-6989586621691175593"><span id="local-6989586621691175594"><span class="annot"><span class="annottext">HashSet ExperimentalFeature
HashSet API
Environment
StreamQueriesOptions
NamingCase
RemoteSchemaPermissions
InferFunctionPermissions
SQLGenCtx
ApolloFederationStatus
CorsPolicy
AuthMode
MetadataDefaults
ResponseInternalErrorsConfig
OptionalInterval
TelemetryStatus
AllowListStatus
ConsoleStatus
EventEngineCtx
acApolloFederationStatus :: AppContext -&gt; ApolloFederationStatus
acAsyncActionsFetchInterval :: AppContext -&gt; OptionalInterval
acEventEngineCtx :: AppContext -&gt; EventEngineCtx
acEnableTelemetry :: AppContext -&gt; TelemetryStatus
acConsoleStatus :: AppContext -&gt; ConsoleStatus
acCorsPolicy :: AppContext -&gt; CorsPolicy
acStreamQueryOptions :: AppContext -&gt; StreamQueriesOptions
acLiveQueryOptions :: AppContext -&gt; StreamQueriesOptions
acMetadataDefaults :: AppContext -&gt; MetadataDefaults
acDefaultNamingConvention :: AppContext -&gt; NamingCase
acExperimentalFeatures :: AppContext -&gt; HashSet ExperimentalFeature
acFunctionPermsCtx :: AppContext -&gt; InferFunctionPermissions
acRemoteSchemaPermsCtx :: AppContext -&gt; RemoteSchemaPermissions
acEnvironment :: AppContext -&gt; Environment
acResponseInternalErrorsConfig :: AppContext -&gt; ResponseInternalErrorsConfig
acEnableAllowlist :: AppContext -&gt; AllowListStatus
acEnabledAPIs :: AppContext -&gt; HashSet API
acSQLGenCtx :: AppContext -&gt; SQLGenCtx
acApolloFederationStatus :: ApolloFederationStatus
acAsyncActionsFetchInterval :: OptionalInterval
acEventEngineCtx :: EventEngineCtx
acEnableTelemetry :: TelemetryStatus
acConsoleStatus :: ConsoleStatus
acCorsPolicy :: CorsPolicy
acStreamQueryOptions :: StreamQueriesOptions
acLiveQueryOptions :: StreamQueriesOptions
acMetadataDefaults :: MetadataDefaults
acDefaultNamingConvention :: NamingCase
acExperimentalFeatures :: HashSet ExperimentalFeature
acFunctionPermsCtx :: InferFunctionPermissions
acRemoteSchemaPermsCtx :: RemoteSchemaPermissions
acEnvironment :: Environment
acResponseInternalErrorsConfig :: ResponseInternalErrorsConfig
acEnableAllowlist :: AllowListStatus
acEnabledAPIs :: HashSet API
acSQLGenCtx :: SQLGenCtx
acAuthMode :: AuthMode
acAuthMode :: AppContext -&gt; AuthMode
</span><a href="Hasura.App.State.html#acApolloFederationStatus"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">getAppContext</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-1038"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura -&gt; Environment -&gt; SourceCache -&gt; IO ()
</span><a href="Hasura.Server.Logging.html#logDeprecatedEnvVars"><span class="hs-identifier hs-var">logDeprecatedEnvVars</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175606"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691175589"><span class="hs-identifier hs-var">acEnvironment</span></a></span><span> </span><span class="annot"><span class="annottext">SourceCache
</span><a href="#local-6989586621691175598"><span class="hs-identifier hs-var">sources</span></a></span><span>
</span><span id="line-1039"></span><span>
</span><span id="line-1040"></span><span>  </span><span class="hs-comment">-- log inconsistent schema objects</span><span>
</span><span id="line-1041"></span><span>  </span><span id="local-6989586621691175555"><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621691175555"><span class="hs-identifier hs-var">inconsObjs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; [InconsistentMetadata]
</span><a href="Hasura.RQL.Types.SchemaCache.html#scInconsistentObjs"><span class="hs-identifier hs-var">scInconsistentObjs</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall impl. AppStateRef impl -&gt; IO SchemaCache
</span><a href="Hasura.Server.AppStateRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1042"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura -&gt; [InconsistentMetadata] -&gt; IO ()
</span><a href="Hasura.Server.AppStateRef.html#logInconsistentMetadata"><span class="hs-identifier hs-var">logInconsistentMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175606"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621691175555"><span class="hs-identifier hs-var">inconsObjs</span></a></span><span>
</span><span id="line-1043"></span><span>
</span><span id="line-1044"></span><span>  </span><span class="hs-comment">-- NOTE: `newLogTVar` is being used to make sure that the metadata logger runs only once</span><span>
</span><span id="line-1045"></span><span>  </span><span class="hs-comment">--       while logging errors or any `inconsistent_metadata` logs.</span><span>
</span><span id="line-1046"></span><span>  </span><span id="local-6989586621691175552"><span class="annot"><span class="annottext">TVar Bool
</span><a href="#local-6989586621691175552"><span class="hs-identifier hs-var">newLogTVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">STM.newTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1047"></span><span>
</span><span id="line-1048"></span><span>  </span><span class="hs-comment">-- Start a background thread for processing schema sync event present in the '_sscSyncEventRef'</span><span>
</span><span id="line-1049"></span><span>  </span><span class="annot"><span class="annottext">Thread
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) impl.
(ForkableMonadIO m, HasAppEnv m, HasCacheStaticConfig m,
 MonadMetadataStorage m, MonadResolveSource m, ProvidesNetwork m) =&gt;
AppStateRef impl -&gt; TVar Bool -&gt; ManagedT m Thread
</span><a href="Hasura.Server.SchemaUpdate.html#startSchemaSyncProcessorThread"><span class="hs-identifier hs-var">startSchemaSyncProcessorThread</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span><span> </span><span class="annot"><span class="annottext">TVar Bool
</span><a href="#local-6989586621691175552"><span class="hs-identifier hs-var">newLogTVar</span></a></span><span>
</span><span id="line-1050"></span><span>
</span><span id="line-1051"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EventingMode
</span><a href="#local-6989586621691175627"><span class="hs-identifier hs-var">appEnvEventingMode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1052"></span><span>    </span><span class="annot"><span class="annottext">EventingMode
</span><a href="Hasura.Server.Types.html#EventingEnabled"><span class="hs-identifier hs-var">EventingEnabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1053"></span><span>      </span><span class="annot"><span class="annottext">Logger Hasura -&gt; LockedEventsCtx -&gt; ManagedT m ()
</span><a href="#local-6989586621691175549"><span class="hs-identifier hs-var">startEventTriggerPollerThread</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175606"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621691175619"><span class="hs-identifier hs-var">appEnvLockedEventsCtx</span></a></span><span>
</span><span id="line-1054"></span><span>      </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; LockedEventsCtx -&gt; AsyncActionSubscriptionState -&gt; ManagedT m ()
</span><a href="#local-6989586621691175548"><span class="hs-identifier hs-var">startAsyncActionsPollerThread</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175606"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621691175619"><span class="hs-identifier hs-var">appEnvLockedEventsCtx</span></a></span><span> </span><span class="annot"><span class="annottext">AsyncActionSubscriptionState
</span><a href="#local-6989586621691175601"><span class="hs-identifier hs-var">actionSubState</span></a></span><span>
</span><span id="line-1055"></span><span>
</span><span id="line-1056"></span><span>      </span><span class="hs-comment">-- Create logger for logging the statistics of fetched cron triggers</span><span>
</span><span id="line-1057"></span><span>      </span><span id="local-6989586621691175547"><span class="annot"><span class="annottext">FetchedCronTriggerStatsLogger
</span><a href="#local-6989586621691175547"><span class="hs-identifier hs-var">fetchedCronTriggerStatsLogger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1058"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
MonadBaseControl IO m =&gt;
m a -&gt; (a -&gt; m b) -&gt; ManagedT m a
</span><a href="Control.Monad.Trans.Managed.html#allocate"><span class="hs-identifier hs-var">allocate</span></a></span><span>
</span><span id="line-1059"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
Logger Hasura -&gt; m FetchedCronTriggerStatsLogger
</span><a href="Hasura.Eventing.ScheduledTrigger.html#createFetchedCronTriggerStatsLogger"><span class="hs-identifier hs-var">createFetchedCronTriggerStatsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175606"><span class="hs-identifier hs-var">logger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1060"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
Logger Hasura -&gt; FetchedCronTriggerStatsLogger -&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#closeFetchedCronTriggersStatsLogger"><span class="hs-identifier hs-var">closeFetchedCronTriggersStatsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175606"><span class="hs-identifier hs-var">logger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1061"></span><span>
</span><span id="line-1062"></span><span>      </span><span class="hs-comment">-- start a background thread to create new cron events</span><span>
</span><span id="line-1063"></span><span>      </span><span id="local-6989586621691175544"><span class="annot"><span class="annottext">Thread
</span><a href="#local-6989586621691175544"><span class="hs-identifier hs-var">_cronEventsThread</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1064"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
String -&gt; Logger Hasura -&gt; m Void -&gt; ManagedT m Thread
</span><a href="Control.Concurrent.Extended.html#forkManagedT"><span class="hs-identifier hs-var">C.forkManagedT</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runCronEventsGenerator&quot;</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175606"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1065"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) void.
(MonadIO m, MonadMetadataStorage m) =&gt;
Logger Hasura
-&gt; FetchedCronTriggerStatsLogger -&gt; IO SchemaCache -&gt; m void
</span><a href="Hasura.Eventing.ScheduledTrigger.html#runCronEventsGenerator"><span class="hs-identifier hs-var">runCronEventsGenerator</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175606"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">FetchedCronTriggerStatsLogger
</span><a href="#local-6989586621691175547"><span class="hs-identifier hs-var">fetchedCronTriggerStatsLogger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall impl. AppStateRef impl -&gt; IO SchemaCache
</span><a href="Hasura.Server.AppStateRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1066"></span><span>
</span><span id="line-1067"></span><span>      </span><span class="annot"><span class="annottext">Logger Hasura -&gt; LockedEventsCtx -&gt; ManagedT m ()
</span><a href="#local-6989586621691175541"><span class="hs-identifier hs-var">startScheduledEventsPollerThread</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175606"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621691175619"><span class="hs-identifier hs-var">appEnvLockedEventsCtx</span></a></span><span>
</span><span id="line-1068"></span><span>    </span><span class="annot"><span class="annottext">EventingMode
</span><a href="Hasura.Server.Types.html#EventingDisabled"><span class="hs-identifier hs-var">EventingDisabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1069"></span><span>      </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175606"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; LogLevel -&gt; Text -&gt; a -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericLog"><span class="hs-identifier hs-var">mkGenericLog</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;server&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;starting in eventing disabled mode&quot;</span></span><span>
</span><span id="line-1070"></span><span>
</span><span id="line-1071"></span><span>  </span><span class="hs-comment">-- start a background thread to check for updates</span><span>
</span><span id="line-1072"></span><span>  </span><span id="local-6989586621691175539"><span class="annot"><span class="annottext">Thread
</span><a href="#local-6989586621691175539"><span class="hs-identifier hs-var">_updateThread</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1073"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
String -&gt; Logger Hasura -&gt; m Void -&gt; ManagedT m Thread
</span><a href="Control.Concurrent.Extended.html#forkManagedT"><span class="hs-identifier hs-var">C.forkManagedT</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkForUpdates&quot;</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175606"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1074"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1075"></span><span>        </span><span class="annot"><span class="annottext">forall a void. LoggerCtx a -&gt; Manager -&gt; IO void
</span><a href="Hasura.Server.CheckUpdates.html#checkForUpdates"><span class="hs-identifier hs-var">checkForUpdates</span></a></span><span> </span><span class="annot"><span class="annottext">LoggerCtx Hasura
</span><a href="#local-6989586621691175607"><span class="hs-identifier hs-var">loggerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621691175633"><span class="hs-identifier hs-var">appEnvManager</span></a></span><span>
</span><span id="line-1076"></span><span>
</span><span id="line-1077"></span><span>  </span><span class="hs-comment">-- Start a background thread for source pings</span><span>
</span><span id="line-1078"></span><span>  </span><span id="local-6989586621691175538"><span class="annot"><span class="annottext">Thread
</span><a href="#local-6989586621691175538"><span class="hs-identifier hs-var">_sourcePingPoller</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1079"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
String -&gt; Logger Hasura -&gt; m Void -&gt; ManagedT m Thread
</span><a href="Control.Concurrent.Extended.html#forkManagedT"><span class="hs-identifier hs-var">C.forkManagedT</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;sourcePingPoller&quot;</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175606"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1080"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621691175537"><span class="annot"><span class="annottext">pingLog :: String -&gt; IO ()
</span><a href="#local-6989586621691175537"><span class="hs-identifier hs-var hs-var">pingLog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1081"></span><span>            </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175606"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; LogLevel -&gt; Text -&gt; a -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericLog"><span class="hs-identifier hs-var">mkGenericLog</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;sources-ping&quot;</span></span><span>
</span><span id="line-1082"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span>
</span><span id="line-1083"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall a.
Environment -&gt; (String -&gt; IO ()) -&gt; IO SourcePingCache -&gt; IO a
</span><a href="Hasura.PingSources.html#runPingSources"><span class="hs-identifier hs-var">runPingSources</span></a></span><span>
</span><span id="line-1084"></span><span>            </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691175589"><span class="hs-identifier hs-var">acEnvironment</span></a></span><span>
</span><span id="line-1085"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="#local-6989586621691175537"><span class="hs-identifier hs-var">pingLog</span></a></span><span>
</span><span id="line-1086"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaCache -&gt; SourcePingCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#scSourcePingConfig"><span class="hs-identifier hs-var">scSourcePingConfig</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall impl. AppStateRef impl -&gt; IO SchemaCache
</span><a href="Hasura.Server.AppStateRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1087"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1088"></span><span>
</span><span id="line-1089"></span><span>  </span><span class="hs-comment">-- initialise the websocket connection reaper thread</span><span>
</span><span id="line-1090"></span><span>  </span><span id="local-6989586621691175534"><span class="annot"><span class="annottext">Thread
</span><a href="#local-6989586621691175534"><span class="hs-identifier hs-var">_websocketConnectionReaperThread</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1091"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
String -&gt; Logger Hasura -&gt; m Void -&gt; ManagedT m Thread
</span><a href="Control.Concurrent.Extended.html#forkManagedT"><span class="hs-identifier hs-var">C.forkManagedT</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;websocket connection reaper thread&quot;</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175606"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1092"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1093"></span><span>        </span><span class="annot"><span class="annottext">forall a.
IO
  (AuthMode, AllowListStatus, CorsPolicy, SQLGenCtx,
   HashSet ExperimentalFeature, NamingCase)
-&gt; IO SchemaCache -&gt; WSServer a -&gt; IO Void
</span><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#websocketConnectionReaper"><span class="hs-identifier hs-var">WS.websocketConnectionReaper</span></a></span><span> </span><span class="annot"><span class="annottext">IO
  (AuthMode, AllowListStatus, CorsPolicy, SQLGenCtx,
   HashSet ExperimentalFeature, NamingCase)
</span><a href="#local-6989586621691175532"><span class="hs-identifier hs-var">getLatestConfigForWSServer</span></a></span><span> </span><span class="annot"><span class="annottext">IO SchemaCache
</span><a href="#local-6989586621691175531"><span class="hs-identifier hs-var">getSchemaCache'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall impl. WSServerEnv impl -&gt; WSServer
</span><a href="Hasura.GraphQL.Transport.WebSocket.Types.html#_wseServer"><span class="hs-identifier hs-var">_wseServer</span></a></span><span> </span><span class="annot"><span class="annottext">WSServerEnv impl
</span><a href="#local-6989586621691175605"><span class="hs-identifier hs-var">wsServerEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1094"></span><span>
</span><span id="line-1095"></span><span>  </span><span id="local-6989586621691175529"><span class="annot"><span class="annottext">MetadataDbId
</span><a href="#local-6989586621691175529"><span class="hs-identifier hs-var">dbUid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1096"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
m (Either QErr MetadataDbId)
</span><a href="Hasura.Metadata.Class.html#getMetadataDbUid"><span class="hs-identifier hs-var">getMetadataDbUid</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
Monad m =&gt;
m (Either e a) -&gt; (e -&gt; m a) -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-operator hs-var">`onLeftM`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *) b.
(ToJSON a, MonadIO m) =&gt;
ExitCode -&gt; a -&gt; m b
</span><a href="Hasura.App.html#throwErrJExit"><span class="hs-identifier hs-var">throwErrJExit</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="Hasura.App.html#DatabaseMigrationError"><span class="hs-identifier hs-var">DatabaseMigrationError</span></a></span><span>
</span><span id="line-1097"></span><span>  </span><span id="local-6989586621691175527"><span class="annot"><span class="annottext">PGVersion
</span><a href="#local-6989586621691175527"><span class="hs-identifier hs-var">pgVersion</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1098"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
(MonadIO m, MonadBaseControl IO m, FromPGTxErr e,
 FromPGConnErr e) =&gt;
PGPool -&gt; TxMode -&gt; TxET e m a -&gt; ExceptT e m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.runTx</span></a></span><span> </span><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621691175635"><span class="hs-identifier hs-var">appEnvMetadataDbPool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIsolation
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.ReadCommitted</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxE QErr PGVersion
</span><a href="Hasura.Server.Init.html#getPgVersion"><span class="hs-identifier hs-var">getPgVersion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1099"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
Monad m =&gt;
m (Either e a) -&gt; (e -&gt; m a) -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-operator hs-var">`onLeftM`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *) b.
(ToJSON a, MonadIO m) =&gt;
ExitCode -&gt; a -&gt; m b
</span><a href="Hasura.App.html#throwErrJExit"><span class="hs-identifier hs-var">throwErrJExit</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="Hasura.App.html#DatabaseMigrationError"><span class="hs-identifier hs-var">DatabaseMigrationError</span></a></span><span>
</span><span id="line-1100"></span><span>
</span><span id="line-1101"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175606"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; LogLevel -&gt; Text -&gt; a -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericLog"><span class="hs-identifier hs-var">mkGenericLog</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;telemetry&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Hasura.App.html#telemetryNotice"><span class="hs-identifier hs-var">telemetryNotice</span></a></span><span>
</span><span id="line-1102"></span><span>
</span><span id="line-1103"></span><span>  </span><span class="hs-comment">-- start a background thread for telemetry</span><span>
</span><span id="line-1104"></span><span>  </span><span id="local-6989586621691175524"><span class="annot"><span class="annottext">Thread
</span><a href="#local-6989586621691175524"><span class="hs-identifier hs-var">_telemetryThread</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1105"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
String -&gt; Logger Hasura -&gt; m Void -&gt; ManagedT m Thread
</span><a href="Control.Concurrent.Extended.html#forkManagedT"><span class="hs-identifier hs-var">C.forkManagedT</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runTelemetry&quot;</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175606"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1106"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) impl.
(MonadIO m, HasAppEnv m) =&gt;
Logger Hasura
-&gt; AppStateRef impl -&gt; MetadataDbId -&gt; PGVersion -&gt; m Void
</span><a href="Hasura.Server.Telemetry.html#runTelemetry"><span class="hs-identifier hs-var">runTelemetry</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175606"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataDbId
</span><a href="#local-6989586621691175529"><span class="hs-identifier hs-var">dbUid</span></a></span><span> </span><span class="annot"><span class="annottext">PGVersion
</span><a href="#local-6989586621691175527"><span class="hs-identifier hs-var">pgVersion</span></a></span><span>
</span><span id="line-1107"></span><span>
</span><span id="line-1108"></span><span>  </span><span class="hs-comment">-- forking a dedicated polling thread to dynamically get the latest JWK settings</span><span>
</span><span id="line-1109"></span><span>  </span><span class="hs-comment">-- set by the user and update the JWK accordingly. This will help in applying the</span><span>
</span><span id="line-1110"></span><span>  </span><span class="hs-comment">-- updates without restarting HGE.</span><span>
</span><span id="line-1111"></span><span>  </span><span class="annot"><span class="annottext">Thread
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1112"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
String -&gt; Logger Hasura -&gt; m Void -&gt; ManagedT m Thread
</span><a href="Control.Concurrent.Extended.html#forkManagedT"><span class="hs-identifier hs-var">C.forkManagedT</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;update JWK&quot;</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175606"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1113"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
IO AppContext -&gt; Manager -&gt; Logger Hasura -&gt; m Void
</span><a href="Hasura.App.html#updateJwkCtxThread"><span class="hs-identifier hs-var">updateJwkCtxThread</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">getAppContext</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621691175633"><span class="hs-identifier hs-var">appEnvManager</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175606"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-1114"></span><span>
</span><span id="line-1115"></span><span>  </span><span class="hs-comment">-- These cleanup actions are not directly associated with any</span><span>
</span><span id="line-1116"></span><span>  </span><span class="hs-comment">-- resource, but we still need to make sure we clean them up here.</span><span>
</span><span id="line-1117"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
MonadBaseControl IO m =&gt;
m a -&gt; m b -&gt; ManagedT m ()
</span><a href="Control.Monad.Trans.Managed.html#allocate_"><span class="hs-identifier hs-var">allocate_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621691175600"><span class="hs-identifier hs-var">stopWsServer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1118"></span><span>
</span><span id="line-1119"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621691175602"><span class="hs-identifier hs-var">app</span></a></span><span>
</span><span id="line-1120"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1121"></span><span>    </span><span id="local-6989586621691175518"><span class="annot"><span class="annottext">isRetryRequired :: p -&gt; Either QErr b -&gt; m Bool
</span><a href="#local-6989586621691175518"><span class="hs-identifier hs-var hs-var">isRetryRequired</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621691175517"><span class="annot"><span class="annottext">Either QErr b
</span><a href="#local-6989586621691175517"><span class="hs-identifier hs-var">resp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1122"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either QErr b
</span><a href="#local-6989586621691175517"><span class="hs-identifier hs-var">resp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1123"></span><span>        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1124"></span><span>        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621691175516"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621691175516"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QErr -&gt; Code
</span><span class="hs-identifier hs-var">qeCode</span></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621691175516"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><span class="hs-identifier hs-var">ConcurrentUpdate</span></span><span>
</span><span id="line-1125"></span><span>
</span><span id="line-1126"></span><span>    </span><span id="local-6989586621691175532"><span class="annot"><span class="annottext">getLatestConfigForWSServer :: IO
  (AuthMode, AllowListStatus, CorsPolicy, SQLGenCtx,
   HashSet ExperimentalFeature, NamingCase)
</span><a href="#local-6989586621691175532"><span class="hs-identifier hs-var hs-var">getLatestConfigForWSServer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1127"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span>
</span><span id="line-1128"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621691175513"><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621691175513"><span class="hs-identifier hs-var">appCtx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppContext -&gt; AuthMode
</span><a href="Hasura.App.State.html#acAuthMode"><span class="hs-identifier hs-var">acAuthMode</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621691175513"><span class="hs-identifier hs-var">appCtx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; AllowListStatus
</span><a href="Hasura.App.State.html#acEnableAllowlist"><span class="hs-identifier hs-var">acEnableAllowlist</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621691175513"><span class="hs-identifier hs-var">appCtx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; CorsPolicy
</span><a href="Hasura.App.State.html#acCorsPolicy"><span class="hs-identifier hs-var">acCorsPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621691175513"><span class="hs-identifier hs-var">appCtx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; SQLGenCtx
</span><a href="Hasura.App.State.html#acSQLGenCtx"><span class="hs-identifier hs-var">acSQLGenCtx</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621691175513"><span class="hs-identifier hs-var">appCtx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; HashSet ExperimentalFeature
</span><a href="Hasura.App.State.html#acExperimentalFeatures"><span class="hs-identifier hs-var">acExperimentalFeatures</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621691175513"><span class="hs-identifier hs-var">appCtx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; NamingCase
</span><a href="Hasura.App.State.html#acDefaultNamingConvention"><span class="hs-identifier hs-var">acDefaultNamingConvention</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621691175513"><span class="hs-identifier hs-var">appCtx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1129"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">getAppContext</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1130"></span><span>    </span><span id="local-6989586621691175531"><span class="annot"><span class="annottext">getSchemaCache' :: IO SchemaCache
</span><a href="#local-6989586621691175531"><span class="hs-identifier hs-var hs-var">getSchemaCache'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall impl. AppStateRef impl -&gt; IO SchemaCache
</span><a href="Hasura.Server.AppStateRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-1131"></span><span>
</span><span id="line-1132"></span><span>    </span><span id="local-6989586621691175485"><span class="annot"><span class="annottext">prepareScheduledEvents :: Logger impl -&gt; m ()
</span><a href="#local-6989586621691175485"><span class="hs-identifier hs-var hs-var">prepareScheduledEvents</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span id="local-6989586621691175484"><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a impl, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621691175484"><span class="hs-identifier hs-var">logger</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1133"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a impl, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621691175484"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; LogLevel -&gt; Text -&gt; a -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericLog"><span class="hs-identifier hs-var">mkGenericLog</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;scheduled_triggers&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;preparing data&quot;</span></span><span>
</span><span id="line-1134"></span><span>      </span><span id="local-6989586621691175483"><span class="annot"><span class="annottext">Either QErr ()
</span><a href="#local-6989586621691175483"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) b.
MonadIO m =&gt;
RetryPolicyM m
-&gt; (RetryStatus -&gt; b -&gt; m Bool) -&gt; (RetryStatus -&gt; m b) -&gt; m b
</span><span class="hs-identifier hs-var">Retry.retrying</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Monad m =&gt; RetryPolicyM m
</span><span class="hs-identifier hs-var">Retry.retryPolicyDefault</span></span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {p} {b}.
Monad m =&gt;
p -&gt; Either QErr b -&gt; m Bool
</span><a href="#local-6989586621691175518"><span class="hs-identifier hs-var">isRetryRequired</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadMetadataStorage m =&gt; m (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#unlockAllLockedScheduledEvents"><span class="hs-identifier hs-var">unlockAllLockedScheduledEvents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1135"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">onLeft</span></a></span><span> </span><span class="annot"><span class="annottext">Either QErr ()
</span><a href="#local-6989586621691175483"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621691175480"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621691175480"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a impl, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621691175484"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; LogLevel -&gt; Text -&gt; a -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericLog"><span class="hs-identifier hs-var">mkGenericLog</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelError"><span class="hs-identifier hs-var">LevelError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;scheduled_triggers&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; Text
</span><span class="hs-identifier hs-var">qeError</span></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621691175480"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1136"></span><span>
</span><span id="line-1137"></span><span>    </span><span class="annot"><a href="#local-6989586621691175479"><span class="hs-identifier hs-type">getProcessingScheduledEventsCount</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Eventing.Common.html#LockedEventsCtx"><span class="hs-identifier hs-type">LockedEventsCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-1138"></span><span>    </span><span id="local-6989586621691175479"><span class="annot"><span class="annottext">getProcessingScheduledEventsCount :: LockedEventsCtx -&gt; IO Int
</span><a href="#local-6989586621691175479"><span class="hs-identifier hs-var hs-var">getProcessingScheduledEventsCount</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Eventing.Common.html#LockedEventsCtx"><span class="hs-identifier hs-type">LockedEventsCtx</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621691175475"><span id="local-6989586621691175476"><span id="local-6989586621691175477"><span id="local-6989586621691175478"><span class="annot"><span class="annottext">TVar (Set CronEventId)
TVar (HashMap SourceName (Set CronEventId))
leActionEvents :: LockedEventsCtx -&gt; TVar (Set CronEventId)
leEvents :: LockedEventsCtx -&gt; TVar (HashMap SourceName (Set CronEventId))
leOneOffEvents :: LockedEventsCtx -&gt; TVar (Set CronEventId)
leCronEvents :: LockedEventsCtx -&gt; TVar (Set CronEventId)
leActionEvents :: TVar (Set CronEventId)
leEvents :: TVar (HashMap SourceName (Set CronEventId))
leOneOffEvents :: TVar (Set CronEventId)
leCronEvents :: TVar (Set CronEventId)
</span><a href="Hasura.Eventing.Common.html#leActionEvents"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1139"></span><span>      </span><span id="local-6989586621691175470"><span class="annot"><span class="annottext">Set CronEventId
</span><a href="#local-6989586621691175470"><span class="hs-identifier hs-var">processingCronEvents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">readTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">TVar (Set CronEventId)
</span><a href="#local-6989586621691175478"><span class="hs-identifier hs-var">leCronEvents</span></a></span><span>
</span><span id="line-1140"></span><span>      </span><span id="local-6989586621691175468"><span class="annot"><span class="annottext">Set CronEventId
</span><a href="#local-6989586621691175468"><span class="hs-identifier hs-var">processingOneOffEvents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">readTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">TVar (Set CronEventId)
</span><a href="#local-6989586621691175477"><span class="hs-identifier hs-var">leOneOffEvents</span></a></span><span>
</span><span id="line-1141"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">Set CronEventId
</span><a href="#local-6989586621691175468"><span class="hs-identifier hs-var">processingOneOffEvents</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">Set CronEventId
</span><a href="#local-6989586621691175470"><span class="hs-identifier hs-var">processingCronEvents</span></a></span><span>
</span><span id="line-1142"></span><span>
</span><span id="line-1143"></span><span>    </span><span class="annot"><a href="#local-6989586621691175465"><span class="hs-identifier hs-type">shutdownEventTriggerEvents</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1144"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Source.html#BackendSourceInfo"><span class="hs-identifier hs-type">BackendSourceInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1145"></span><span>      </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1146"></span><span>      </span><span class="annot"><a href="Hasura.Eventing.Common.html#LockedEventsCtx"><span class="hs-identifier hs-type">LockedEventsCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1147"></span><span>      </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1148"></span><span>    </span><span id="local-6989586621691175465"><span class="annot"><span class="annottext">shutdownEventTriggerEvents :: [AnyBackend SourceInfo]
-&gt; Logger Hasura -&gt; LockedEventsCtx -&gt; IO ()
</span><a href="#local-6989586621691175465"><span class="hs-identifier hs-var hs-var">shutdownEventTriggerEvents</span></a></span></span><span> </span><span id="local-6989586621691175463"><span class="annot"><span class="annottext">[AnyBackend SourceInfo]
</span><a href="#local-6989586621691175463"><span class="hs-identifier hs-var">sources</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span id="local-6989586621691175462"><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621691175462"><span class="hs-identifier hs-var">logger</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Hasura.Eventing.Common.html#LockedEventsCtx"><span class="hs-identifier hs-type">LockedEventsCtx</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621691175458"><span id="local-6989586621691175459"><span id="local-6989586621691175460"><span id="local-6989586621691175461"><span class="annot"><span class="annottext">TVar (Set CronEventId)
TVar (HashMap SourceName (Set CronEventId))
leActionEvents :: TVar (Set CronEventId)
leEvents :: TVar (HashMap SourceName (Set CronEventId))
leOneOffEvents :: TVar (Set CronEventId)
leCronEvents :: TVar (Set CronEventId)
leActionEvents :: LockedEventsCtx -&gt; TVar (Set CronEventId)
leEvents :: LockedEventsCtx -&gt; TVar (HashMap SourceName (Set CronEventId))
leOneOffEvents :: LockedEventsCtx -&gt; TVar (Set CronEventId)
leCronEvents :: LockedEventsCtx -&gt; TVar (Set CronEventId)
</span><a href="#local-6989586621691175458"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1149"></span><span>      </span><span class="hs-comment">-- TODO: is this correct?</span><span>
</span><span id="line-1150"></span><span>      </span><span class="hs-comment">-- event triggers should be tied to the life cycle of a source</span><span>
</span><span id="line-1151"></span><span>      </span><span id="local-6989586621691175457"><span class="annot"><span class="annottext">HashMap SourceName (Set CronEventId)
</span><a href="#local-6989586621691175457"><span class="hs-identifier hs-var">lockedEvents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">readTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">TVar (HashMap SourceName (Set CronEventId))
</span><a href="#local-6989586621691175459"><span class="hs-identifier hs-var">leEvents</span></a></span><span>
</span><span id="line-1152"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[AnyBackend SourceInfo]
</span><a href="#local-6989586621691175463"><span class="hs-identifier hs-var">sources</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621691175455"><span class="annot"><span class="annottext">AnyBackend SourceInfo
</span><a href="#local-6989586621691175455"><span class="hs-identifier hs-var">backendSourceInfo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1153"></span><span>        </span><span class="annot"><span class="annottext">forall (c :: BackendType -&gt; Constraint) (i :: BackendType -&gt; *) r.
AllBackendsSatisfy c =&gt;
AnyBackend i -&gt; (forall (b :: BackendType). c b =&gt; i b -&gt; r) -&gt; r
</span><a href="Hasura.SQL.AnyBackend.html#dispatchAnyBackend"><span class="hs-identifier hs-var">AB.dispatchAnyBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.Eventing.Backend.html#BackendEventTrigger"><span class="hs-identifier hs-type">BackendEventTrigger</span></a></span><span> </span><span class="annot"><span class="annottext">AnyBackend SourceInfo
</span><a href="#local-6989586621691175455"><span class="hs-identifier hs-var">backendSourceInfo</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621691175412"><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceInfo"><span class="hs-identifier hs-type">SourceInfo</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621691175400"><span id="local-6989586621691175401"><span id="local-6989586621691175402"><span id="local-6989586621691175403"><span id="local-6989586621691175404"><span id="local-6989586621691175405"><span id="local-6989586621691175406"><span id="local-6989586621691175407"><span id="local-6989586621691175408"><span id="local-6989586621691175409"><span id="local-6989586621691175410"><span class="annot"><span class="annottext">Maybe QueryTagsConfig
TableCache b
FunctionCache b
StoredProcedureCache b
LogicalModelCache b
NativeQueryCache b
BackendSourceKind b
SourceName
SourceConfig b
ResolvedSourceCustomization
DBObjectsIntrospection b
_siDbObjectsIntrospection :: forall (b :: BackendType). SourceInfo b -&gt; DBObjectsIntrospection b
_siCustomization :: forall (b :: BackendType).
SourceInfo b -&gt; ResolvedSourceCustomization
_siQueryTagsConfig :: forall (b :: BackendType). SourceInfo b -&gt; Maybe QueryTagsConfig
_siConfiguration :: forall (b :: BackendType). SourceInfo b -&gt; SourceConfig b
_siLogicalModels :: forall (b :: BackendType). SourceInfo b -&gt; LogicalModelCache b
_siStoredProcedures :: forall (b :: BackendType). SourceInfo b -&gt; StoredProcedureCache b
_siNativeQueries :: forall (b :: BackendType). SourceInfo b -&gt; NativeQueryCache b
_siFunctions :: forall (b :: BackendType). SourceInfo b -&gt; FunctionCache b
_siTables :: forall (b :: BackendType). SourceInfo b -&gt; TableCache b
_siSourceKind :: forall (b :: BackendType). SourceInfo b -&gt; BackendSourceKind b
_siName :: forall (b :: BackendType). SourceInfo b -&gt; SourceName
_siDbObjectsIntrospection :: DBObjectsIntrospection b
_siCustomization :: ResolvedSourceCustomization
_siQueryTagsConfig :: Maybe QueryTagsConfig
_siConfiguration :: SourceConfig b
_siLogicalModels :: LogicalModelCache b
_siStoredProcedures :: StoredProcedureCache b
_siNativeQueries :: NativeQueryCache b
_siFunctions :: FunctionCache b
_siTables :: TableCache b
_siSourceKind :: BackendSourceKind b
_siName :: SourceName
</span><a href="Hasura.RQL.Types.Source.html#_siDbObjectsIntrospection"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceInfo"><span class="hs-identifier hs-type">SourceInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621691175412"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1154"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621691175388"><span class="annot"><span class="annottext">sourceNameText :: Text
</span><a href="#local-6989586621691175388"><span class="hs-identifier hs-var hs-var">sourceNameText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; Text
</span><a href="Hasura.RQL.Types.Common.html#sourceNameToText"><span class="hs-identifier hs-var">sourceNameToText</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621691175410"><span class="hs-identifier hs-var">_siName</span></a></span><span>
</span><span id="line-1155"></span><span>          </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621691175462"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; LogLevel -&gt; Text -&gt; a -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericLog"><span class="hs-identifier hs-var">mkGenericLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;event_triggers&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unlocking events of source: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691175388"><span class="hs-identifier hs-var">sourceNameText</span></a></span><span>
</span><span id="line-1156"></span><span>          </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">for_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HashMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621691175410"><span class="hs-identifier hs-var">_siName</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap SourceName (Set CronEventId)
</span><a href="#local-6989586621691175457"><span class="hs-identifier hs-var">lockedEvents</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621691175385"><span class="annot"><span class="annottext">Set CronEventId
</span><a href="#local-6989586621691175385"><span class="hs-identifier hs-var">sourceLockedEvents</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1157"></span><span>            </span><span class="hs-comment">-- No need to execute unlockEventsTx when events are not present</span><span>
</span><span id="line-1158"></span><span>            </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">for_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Set a -&gt; Maybe (NESet a)
</span><span class="hs-identifier hs-var">NE.nonEmptySet</span></span><span> </span><span class="annot"><span class="annottext">Set CronEventId
</span><a href="#local-6989586621691175385"><span class="hs-identifier hs-var">sourceLockedEvents</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621691175383"><span class="annot"><span class="annottext">NESet CronEventId
</span><a href="#local-6989586621691175383"><span class="hs-identifier hs-var">nonEmptyLockedEvents</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1159"></span><span>              </span><span id="local-6989586621691175382"><span class="annot"><span class="annottext">Either QErr Int
</span><a href="#local-6989586621691175382"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) b.
MonadIO m =&gt;
RetryPolicyM m
-&gt; (RetryStatus -&gt; b -&gt; m Bool) -&gt; (RetryStatus -&gt; m b) -&gt; m b
</span><span class="hs-identifier hs-var">Retry.retrying</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Monad m =&gt; RetryPolicyM m
</span><span class="hs-identifier hs-var">Retry.retryPolicyDefault</span></span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {p} {b}.
Monad m =&gt;
p -&gt; Either QErr b -&gt; m Bool
</span><a href="#local-6989586621691175518"><span class="hs-identifier hs-var">isRetryRequired</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(BackendEventTrigger b, MonadIO m) =&gt;
SourceConfig b -&gt; NESet CronEventId -&gt; m (Either QErr Int)
</span><a href="Hasura.Eventing.Backend.html#unlockEventsInSource"><span class="hs-identifier hs-var">unlockEventsInSource</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621691175412"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621691175403"><span class="hs-identifier hs-var">_siConfiguration</span></a></span><span> </span><span class="annot"><span class="annottext">NESet CronEventId
</span><a href="#local-6989586621691175383"><span class="hs-identifier hs-var">nonEmptyLockedEvents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1160"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either QErr Int
</span><a href="#local-6989586621691175382"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1161"></span><span>                </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621691175380"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621691175380"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1162"></span><span>                  </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621691175462"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1163"></span><span>                    </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; LogLevel -&gt; Text -&gt; a -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericLog"><span class="hs-identifier hs-var">mkGenericLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelWarn"><span class="hs-identifier hs-var">LevelWarn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;event_trigger&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1164"></span><span>                      </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Error while unlocking event trigger events of source: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691175388"><span class="hs-identifier hs-var">sourceNameText</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; error:&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; Text
</span><span class="hs-identifier hs-var">showQErr</span></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621691175380"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1165"></span><span>                </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621691175378"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621691175378"><span class="hs-identifier hs-var">count</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1166"></span><span>                  </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621691175462"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1167"></span><span>                    </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; LogLevel -&gt; Text -&gt; a -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericLog"><span class="hs-identifier hs-var">mkGenericLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;event_trigger&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1168"></span><span>                      </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">tshow</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621691175378"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; events of source &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691175388"><span class="hs-identifier hs-var">sourceNameText</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; were successfully unlocked&quot;</span></span><span>
</span><span id="line-1169"></span><span>
</span><span id="line-1170"></span><span>    </span><span class="annot"><a href="#local-6989586621691175376"><span class="hs-identifier hs-type">shutdownAsyncActions</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1171"></span><span>      </span><span class="annot"><a href="Hasura.Eventing.Common.html#LockedEventsCtx"><span class="hs-identifier hs-type">LockedEventsCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1172"></span><span>      </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">QErr</span></span><span> </span><span class="annot"><a href="#local-6989586621691177982"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1173"></span><span>    </span><span id="local-6989586621691175376"><span class="annot"><span class="annottext">shutdownAsyncActions :: LockedEventsCtx -&gt; ExceptT QErr m ()
</span><a href="#local-6989586621691175376"><span class="hs-identifier hs-var hs-var">shutdownAsyncActions</span></a></span></span><span> </span><span id="local-6989586621691175375"><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621691175375"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1174"></span><span>      </span><span id="local-6989586621691175374"><span class="annot"><span class="annottext">Set CronEventId
</span><a href="#local-6989586621691175374"><span class="hs-identifier hs-var">lockedActionEvents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">readTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx -&gt; TVar (Set CronEventId)
</span><a href="Hasura.Eventing.Common.html#leActionEvents"><span class="hs-identifier hs-var">leActionEvents</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621691175375"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span>
</span><span id="line-1175"></span><span>      </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
LockedActionIdArray -&gt; m (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#setProcessingActionLogsToPending"><span class="hs-identifier hs-var">setProcessingActionLogsToPending</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CronEventId] -&gt; LockedActionIdArray
</span><a href="Hasura.RQL.Types.Action.html#LockedActionIdArray"><span class="hs-identifier hs-var">LockedActionIdArray</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set CronEventId
</span><a href="#local-6989586621691175374"><span class="hs-identifier hs-var">lockedActionEvents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1176"></span><span>
</span><span id="line-1177"></span><span>    </span><span class="hs-comment">-- This function is a helper function to do couple of things:</span><span>
</span><span id="line-1178"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1179"></span><span>    </span><span class="hs-comment">-- 1. When the value of the `graceful-shutdown-timeout` &gt; 0, we poll</span><span>
</span><span id="line-1180"></span><span>    </span><span class="hs-comment">--    the in-flight events queue we maintain using the `processingEventsCountAction`</span><span>
</span><span id="line-1181"></span><span>    </span><span class="hs-comment">--    number of in-flight processing events, in case of actions it is the</span><span>
</span><span id="line-1182"></span><span>    </span><span class="hs-comment">--    actions which are in 'processing' state and in scheduled events</span><span>
</span><span id="line-1183"></span><span>    </span><span class="hs-comment">--    it is the events which are in 'locked' state. The in-flight events queue is polled</span><span>
</span><span id="line-1184"></span><span>    </span><span class="hs-comment">--    every 5 seconds until either the graceful shutdown time is exhausted</span><span>
</span><span id="line-1185"></span><span>    </span><span class="hs-comment">--    or the number of in-flight processing events is 0.</span><span>
</span><span id="line-1186"></span><span>    </span><span class="hs-comment">-- 2. After step 1, we unlock all the events which were attempted to process by the current</span><span>
</span><span id="line-1187"></span><span>    </span><span class="hs-comment">--    graphql-engine instance that are still in the processing</span><span>
</span><span id="line-1188"></span><span>    </span><span class="hs-comment">--    state. In actions, it means to set the status of such actions to 'pending'</span><span>
</span><span id="line-1189"></span><span>    </span><span class="hs-comment">--    and in scheduled events, the status will be set to 'unlocked'.</span><span>
</span><span id="line-1190"></span><span>    </span><span class="annot"><a href="#local-6989586621691175370"><span class="hs-identifier hs-type">waitForProcessingAction</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1191"></span><span>      </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1192"></span><span>      </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1193"></span><span>      </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1194"></span><span>      </span><span class="annot"><a href="Hasura.App.html#ShutdownAction"><span class="hs-identifier hs-type">ShutdownAction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1195"></span><span>      </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-type">Seconds</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1196"></span><span>      </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1197"></span><span>    </span><span id="local-6989586621691175370"><span class="annot"><span class="annottext">waitForProcessingAction :: Logger Hasura
-&gt; String -&gt; IO Int -&gt; ShutdownAction -&gt; Seconds -&gt; IO ()
</span><a href="#local-6989586621691175370"><span class="hs-identifier hs-var hs-var">waitForProcessingAction</span></a></span></span><span> </span><span id="local-6989586621691175369"><span class="annot"><span class="annottext">l :: Logger Hasura
</span><a href="#local-6989586621691175369"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span id="local-6989586621691175368"><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621691175368"><span class="hs-identifier hs-var">logger</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621691175367"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621691175367"><span class="hs-identifier hs-var">actionType</span></a></span></span><span> </span><span id="local-6989586621691175366"><span class="annot"><span class="annottext">IO Int
</span><a href="#local-6989586621691175366"><span class="hs-identifier hs-var">processingEventsCountAction'</span></a></span></span><span> </span><span id="local-6989586621691175365"><span class="annot"><span class="annottext">ShutdownAction
</span><a href="#local-6989586621691175365"><span class="hs-identifier hs-var">shutdownAction</span></a></span></span><span> </span><span id="local-6989586621691175364"><span class="annot"><span class="annottext">Seconds
</span><a href="#local-6989586621691175364"><span class="hs-identifier hs-var">maxTimeout</span></a></span></span><span>
</span><span id="line-1198"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Seconds
</span><a href="#local-6989586621691175364"><span class="hs-identifier hs-var">maxTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Seconds
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1199"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ShutdownAction
</span><a href="#local-6989586621691175365"><span class="hs-identifier hs-var">shutdownAction</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1200"></span><span>            </span><span class="annot"><a href="Hasura.App.html#EventTriggerShutdownAction"><span class="hs-identifier hs-type">EventTriggerShutdownAction</span></a></span><span> </span><span id="local-6989586621691175362"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621691175362"><span class="hs-identifier hs-var">userDBShutdownAction</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621691175362"><span class="hs-identifier hs-var">userDBShutdownAction</span></a></span><span>
</span><span id="line-1201"></span><span>            </span><span class="annot"><a href="Hasura.App.html#MetadataDBShutdownAction"><span class="hs-identifier hs-type">MetadataDBShutdownAction</span></a></span><span> </span><span id="local-6989586621691175361"><span class="annot"><span class="annottext">ExceptT QErr IO ()
</span><a href="#local-6989586621691175361"><span class="hs-identifier hs-var">metadataDBShutdownAction</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1202"></span><span>              </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT QErr IO ()
</span><a href="#local-6989586621691175361"><span class="hs-identifier hs-var">metadataDBShutdownAction</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1203"></span><span>                </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621691175360"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621691175360"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1204"></span><span>                  </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621691175368"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1205"></span><span>                    </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; LogLevel -&gt; Text -&gt; a -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericLog"><span class="hs-identifier hs-var">mkGenericLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelWarn"><span class="hs-identifier hs-var">LevelWarn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621691175367"><span class="hs-identifier hs-var">actionType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1206"></span><span>                      </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Error while unlocking the processing  &quot;</span></span><span>
</span><span id="line-1207"></span><span>                        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">tshow</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621691175367"><span class="hs-identifier hs-var">actionType</span></a></span><span>
</span><span id="line-1208"></span><span>                        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; err - &quot;</span></span><span>
</span><span id="line-1209"></span><span>                        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; Text
</span><span class="hs-identifier hs-var">showQErr</span></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621691175360"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1210"></span><span>                </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1211"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1212"></span><span>          </span><span id="local-6989586621691175359"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621691175359"><span class="hs-identifier hs-var">processingEventsCount</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int
</span><a href="#local-6989586621691175366"><span class="hs-identifier hs-var">processingEventsCountAction'</span></a></span><span>
</span><span id="line-1213"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621691175359"><span class="hs-identifier hs-var">processingEventsCount</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-1214"></span><span>            </span><span class="hs-keyword">then</span><span>
</span><span id="line-1215"></span><span>              </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621691175368"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1216"></span><span>                </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; LogLevel -&gt; Text -&gt; a -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericLog"><span class="hs-identifier hs-var">mkGenericLog</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621691175367"><span class="hs-identifier hs-var">actionType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1217"></span><span>                  </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;All in-flight events have finished processing&quot;</span></span><span>
</span><span id="line-1218"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621691175359"><span class="hs-identifier hs-var">processingEventsCount</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1219"></span><span>              </span><span class="annot"><span class="annottext">DiffTime -&gt; IO ()
</span><a href="Control.Concurrent.Extended.html#sleep"><span class="hs-identifier hs-var">C.sleep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">5</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- sleep for 5 seconds and then repeat</span><span>
</span><span id="line-1220"></span><span>              </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; String -&gt; IO Int -&gt; ShutdownAction -&gt; Seconds -&gt; IO ()
</span><a href="#local-6989586621691175370"><span class="hs-identifier hs-var">waitForProcessingAction</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175369"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621691175367"><span class="hs-identifier hs-var">actionType</span></a></span><span> </span><span class="annot"><span class="annottext">IO Int
</span><a href="#local-6989586621691175366"><span class="hs-identifier hs-var">processingEventsCountAction'</span></a></span><span> </span><span class="annot"><span class="annottext">ShutdownAction
</span><a href="#local-6989586621691175365"><span class="hs-identifier hs-var">shutdownAction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seconds
</span><a href="#local-6989586621691175364"><span class="hs-identifier hs-var">maxTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiffTime -&gt; Seconds
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">Seconds</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">5</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1221"></span><span>
</span><span id="line-1222"></span><span>    </span><span id="local-6989586621691175549"><span class="annot"><span class="annottext">startEventTriggerPollerThread :: Logger Hasura -&gt; LockedEventsCtx -&gt; ManagedT m ()
</span><a href="#local-6989586621691175549"><span class="hs-identifier hs-var hs-var">startEventTriggerPollerThread</span></a></span></span><span> </span><span id="local-6989586621691175356"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175356"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621691175355"><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621691175355"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1223"></span><span>      </span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">AppEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621691175325"><span id="local-6989586621691175326"><span id="local-6989586621691175327"><span id="local-6989586621691175328"><span id="local-6989586621691175329"><span id="local-6989586621691175330"><span id="local-6989586621691175331"><span id="local-6989586621691175332"><span id="local-6989586621691175333"><span id="local-6989586621691175334"><span id="local-6989586621691175335"><span id="local-6989586621691175336"><span id="local-6989586621691175337"><span id="local-6989586621691175338"><span id="local-6989586621691175339"><span id="local-6989586621691175340"><span id="local-6989586621691175341"><span id="local-6989586621691175342"><span id="local-6989586621691175343"><span id="local-6989586621691175344"><span id="local-6989586621691175345"><span id="local-6989586621691175346"><span id="local-6989586621691175347"><span id="local-6989586621691175348"><span id="local-6989586621691175349"><span id="local-6989586621691175350"><span id="local-6989586621691175351"><span id="local-6989586621691175352"><span id="local-6989586621691175353"><span id="local-6989586621691175354"><span class="annot"><span class="annottext">Maybe Text
Maybe PGPool
Maybe (CredentialCache AgentLicenseKey)
SamplingPolicy
PGPool
ConnParams
TxIsolation
TMVar MetadataResourceVersion
Refined NonNegative Seconds
Manager
CheckFeatureFlag
ServerMetrics
EventingMode
ReadOnlyMode
MaintenanceMode ()
InstanceId
PrometheusMetrics
ShutdownLatch
LoggingSettings
LockedEventsCtx
HostPreference
ConnectionOptions
WSConnectionInitTimeout
KeepAliveDelay
OptionalInterval
Port
SubscriptionsState
Loggers
appEnvLicenseKeyCache :: Maybe (CredentialCache AgentLicenseKey)
appEnvCheckFeatureFlag :: CheckFeatureFlag
appEnvSchemaPollInterval :: OptionalInterval
appEnvGracefulShutdownTimeout :: Refined NonNegative Seconds
appEnvWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
appEnvWebSocketKeepAlive :: KeepAliveDelay
appEnvConnectionOptions :: ConnectionOptions
appEnvConsoleSentryDsn :: Maybe Text
appEnvConsoleAssetsDir :: Maybe Text
appEnvTxIso :: TxIsolation
appEnvConnParams :: ConnParams
appEnvLockedEventsCtx :: LockedEventsCtx
appEnvSubscriptionState :: SubscriptionsState
appEnvTraceSamplingPolicy :: SamplingPolicy
appEnvPrometheusMetrics :: PrometheusMetrics
appEnvMetaVersionRef :: TMVar MetadataResourceVersion
appEnvShutdownLatch :: ShutdownLatch
appEnvServerMetrics :: ServerMetrics
appEnvEnableReadOnlyMode :: ReadOnlyMode
appEnvEventingMode :: EventingMode
appEnvLoggingSettings :: LoggingSettings
appEnvEnableMaintenanceMode :: MaintenanceMode ()
appEnvInstanceId :: InstanceId
appEnvMetadataVersionRef :: TMVar MetadataResourceVersion
appEnvLoggers :: Loggers
appEnvManager :: Manager
appEnvIntrospectionDbPool :: Maybe PGPool
appEnvMetadataDbPool :: PGPool
appEnvHost :: HostPreference
appEnvPort :: Port
appEnvLicenseKeyCache :: AppEnv -&gt; Maybe (CredentialCache AgentLicenseKey)
appEnvSchemaPollInterval :: AppEnv -&gt; OptionalInterval
appEnvCheckFeatureFlag :: AppEnv -&gt; CheckFeatureFlag
appEnvGracefulShutdownTimeout :: AppEnv -&gt; Refined NonNegative Seconds
appEnvWebSocketConnectionInitTimeout :: AppEnv -&gt; WSConnectionInitTimeout
appEnvWebSocketKeepAlive :: AppEnv -&gt; KeepAliveDelay
appEnvConnectionOptions :: AppEnv -&gt; ConnectionOptions
appEnvConsoleSentryDsn :: AppEnv -&gt; Maybe Text
appEnvConsoleAssetsDir :: AppEnv -&gt; Maybe Text
appEnvTxIso :: AppEnv -&gt; TxIsolation
appEnvConnParams :: AppEnv -&gt; ConnParams
appEnvLockedEventsCtx :: AppEnv -&gt; LockedEventsCtx
appEnvSubscriptionState :: AppEnv -&gt; SubscriptionsState
appEnvTraceSamplingPolicy :: AppEnv -&gt; SamplingPolicy
appEnvPrometheusMetrics :: AppEnv -&gt; PrometheusMetrics
appEnvMetaVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvShutdownLatch :: AppEnv -&gt; ShutdownLatch
appEnvServerMetrics :: AppEnv -&gt; ServerMetrics
appEnvEnableReadOnlyMode :: AppEnv -&gt; ReadOnlyMode
appEnvEventingMode :: AppEnv -&gt; EventingMode
appEnvLoggingSettings :: AppEnv -&gt; LoggingSettings
appEnvEnableMaintenanceMode :: AppEnv -&gt; MaintenanceMode ()
appEnvInstanceId :: AppEnv -&gt; InstanceId
appEnvMetadataVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvLoggers :: AppEnv -&gt; Loggers
appEnvManager :: AppEnv -&gt; Manager
appEnvIntrospectionDbPool :: AppEnv -&gt; Maybe PGPool
appEnvMetadataDbPool :: AppEnv -&gt; PGPool
appEnvHost :: AppEnv -&gt; HostPreference
appEnvPort :: AppEnv -&gt; Port
</span><a href="#local-6989586621691175325"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasAppEnv m =&gt; m AppEnv
</span><a href="Hasura.App.State.html#askAppEnv"><span class="hs-identifier hs-var">askAppEnv</span></a></span><span>
</span><span id="line-1224"></span><span>      </span><span id="local-6989586621691175324"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621691175324"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall impl. AppStateRef impl -&gt; IO SchemaCache
</span><a href="Hasura.Server.AppStateRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-1225"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621691175323"><span class="annot"><span class="annottext">allSources :: [AnyBackend SourceInfo]
</span><a href="#local-6989586621691175323"><span class="hs-identifier hs-var hs-var">allSources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v. HashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">HashMap.elems</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; SourceCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#scSources"><span class="hs-identifier hs-var">scSources</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621691175324"><span class="hs-identifier hs-var">schemaCache</span></a></span><span>
</span><span id="line-1226"></span><span>      </span><span id="local-6989586621691175321"><span class="annot"><span class="annottext">TVar Int
</span><a href="#local-6989586621691175321"><span class="hs-identifier hs-var">activeEventProcessingThreads</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">newTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1227"></span><span>
</span><span id="line-1228"></span><span>      </span><span class="hs-comment">-- Initialise the event processing thread</span><span>
</span><span id="line-1229"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621691175320"><span class="annot"><span class="annottext">eventsGracefulShutdownAction :: IO ()
</span><a href="#local-6989586621691175320"><span class="hs-identifier hs-var hs-var">eventsGracefulShutdownAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1230"></span><span>            </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; String -&gt; IO Int -&gt; ShutdownAction -&gt; Seconds -&gt; IO ()
</span><a href="#local-6989586621691175370"><span class="hs-identifier hs-var">waitForProcessingAction</span></a></span><span>
</span><span id="line-1231"></span><span>              </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175356"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-1232"></span><span>              </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;event_triggers&quot;</span></span><span>
</span><span id="line-1233"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">readTVarIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LockedEventsCtx -&gt; TVar (HashMap SourceName (Set CronEventId))
</span><a href="Hasura.Eventing.Common.html#leEvents"><span class="hs-identifier hs-var">leEvents</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621691175355"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1234"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; ShutdownAction
</span><a href="Hasura.App.html#EventTriggerShutdownAction"><span class="hs-identifier hs-var">EventTriggerShutdownAction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[AnyBackend SourceInfo]
-&gt; Logger Hasura -&gt; LockedEventsCtx -&gt; IO ()
</span><a href="#local-6989586621691175465"><span class="hs-identifier hs-var">shutdownEventTriggerEvents</span></a></span><span> </span><span class="annot"><span class="annottext">[AnyBackend SourceInfo]
</span><a href="#local-6989586621691175323"><span class="hs-identifier hs-var">allSources</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175356"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621691175355"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1235"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (p :: k) x. Refined p x -&gt; x
</span><span class="hs-identifier hs-var">unrefine</span></span><span> </span><span class="annot"><span class="annottext">Refined NonNegative Seconds
</span><a href="#local-6989586621691175328"><span class="hs-identifier hs-var">appEnvGracefulShutdownTimeout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1236"></span><span>
</span><span id="line-1237"></span><span>      </span><span class="hs-comment">-- Create logger for logging the statistics of events fetched</span><span>
</span><span id="line-1238"></span><span>      </span><span id="local-6989586621691175319"><span class="annot"><span class="annottext">FetchedEventsStatsLogger
</span><a href="#local-6989586621691175319"><span class="hs-identifier hs-var">fetchedEventsStatsLogger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1239"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
MonadBaseControl IO m =&gt;
m a -&gt; (a -&gt; m b) -&gt; ManagedT m a
</span><a href="Control.Monad.Trans.Managed.html#allocate"><span class="hs-identifier hs-var">allocate</span></a></span><span>
</span><span id="line-1240"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
Logger Hasura -&gt; m FetchedEventsStatsLogger
</span><a href="Hasura.Eventing.EventTrigger.html#createFetchedEventsStatsLogger"><span class="hs-identifier hs-var">createFetchedEventsStatsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175356"><span class="hs-identifier hs-var">logger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1241"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
Logger Hasura -&gt; FetchedEventsStatsLogger -&gt; m ()
</span><a href="Hasura.Eventing.EventTrigger.html#closeFetchedEventsStatsLogger"><span class="hs-identifier hs-var">closeFetchedEventsStatsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175356"><span class="hs-identifier hs-var">logger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1242"></span><span>
</span><span id="line-1243"></span><span>      </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175356"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; LogLevel -&gt; Text -&gt; a -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericLog"><span class="hs-identifier hs-var">mkGenericLog</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;event_triggers&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;starting workers&quot;</span></span><span>
</span><span id="line-1244"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">void</span></a></span><span>
</span><span id="line-1245"></span><span>        </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
String
-&gt; Logger Hasura
-&gt; ThreadShutdown m
-&gt; m (Forever m)
-&gt; ManagedT m Thread
</span><a href="Control.Concurrent.Extended.html#forkManagedTWithGracefulShutdown"><span class="hs-identifier hs-var">C.forkManagedTWithGracefulShutdown</span></a></span><span>
</span><span id="line-1246"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;processEventQueue&quot;</span></span><span>
</span><span id="line-1247"></span><span>          </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175356"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-1248"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). m () -&gt; ThreadShutdown m
</span><a href="Control.Concurrent.Extended.html#ThreadShutdown"><span class="hs-identifier hs-var">C.ThreadShutdown</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621691175320"><span class="hs-identifier hs-var">eventsGracefulShutdownAction</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1249"></span><span>        </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, Forall (Pure m), MonadMask m,
 MonadTrace m, MonadGetPolicies m) =&gt;
Logger Hasura
-&gt; FetchedEventsStatsLogger
-&gt; Manager
-&gt; IO SchemaCache
-&gt; IO EventEngineCtx
-&gt; TVar Int
-&gt; LockedEventsCtx
-&gt; ServerMetrics
-&gt; EventTriggerMetrics
-&gt; MaintenanceMode ()
-&gt; m (Forever m)
</span><a href="Hasura.Eventing.EventTrigger.html#processEventQueue"><span class="hs-identifier hs-var">processEventQueue</span></a></span><span>
</span><span id="line-1250"></span><span>          </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175356"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-1251"></span><span>          </span><span class="annot"><span class="annottext">FetchedEventsStatsLogger
</span><a href="#local-6989586621691175319"><span class="hs-identifier hs-var">fetchedEventsStatsLogger</span></a></span><span>
</span><span id="line-1252"></span><span>          </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621691175350"><span class="hs-identifier hs-var">appEnvManager</span></a></span><span>
</span><span id="line-1253"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall impl. AppStateRef impl -&gt; IO SchemaCache
</span><a href="Hasura.Server.AppStateRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1254"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppContext -&gt; EventEngineCtx
</span><a href="Hasura.App.State.html#acEventEngineCtx"><span class="hs-identifier hs-var">acEventEngineCtx</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">getAppContext</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1255"></span><span>          </span><span class="annot"><span class="annottext">TVar Int
</span><a href="#local-6989586621691175321"><span class="hs-identifier hs-var">activeEventProcessingThreads</span></a></span><span>
</span><span id="line-1256"></span><span>          </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621691175355"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span>
</span><span id="line-1257"></span><span>          </span><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621691175342"><span class="hs-identifier hs-var">appEnvServerMetrics</span></a></span><span>
</span><span id="line-1258"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrometheusMetrics -&gt; EventTriggerMetrics
</span><a href="Hasura.Server.Prometheus.html#pmEventTriggerMetrics"><span class="hs-identifier hs-var">pmEventTriggerMetrics</span></a></span><span> </span><span class="annot"><span class="annottext">PrometheusMetrics
</span><a href="#local-6989586621691175339"><span class="hs-identifier hs-var">appEnvPrometheusMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1259"></span><span>          </span><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621691175346"><span class="hs-identifier hs-var">appEnvEnableMaintenanceMode</span></a></span><span>
</span><span id="line-1260"></span><span>
</span><span id="line-1261"></span><span>    </span><span id="local-6989586621691175548"><span class="annot"><span class="annottext">startAsyncActionsPollerThread :: Logger Hasura
-&gt; LockedEventsCtx -&gt; AsyncActionSubscriptionState -&gt; ManagedT m ()
</span><a href="#local-6989586621691175548"><span class="hs-identifier hs-var hs-var">startAsyncActionsPollerThread</span></a></span></span><span> </span><span id="local-6989586621691175312"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175312"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621691175311"><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621691175311"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span></span><span> </span><span id="local-6989586621691175310"><span class="annot"><span class="annottext">AsyncActionSubscriptionState
</span><a href="#local-6989586621691175310"><span class="hs-identifier hs-var">actionSubState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1262"></span><span>      </span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">AppEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621691175280"><span id="local-6989586621691175281"><span id="local-6989586621691175282"><span id="local-6989586621691175283"><span id="local-6989586621691175284"><span id="local-6989586621691175285"><span id="local-6989586621691175286"><span id="local-6989586621691175287"><span id="local-6989586621691175288"><span id="local-6989586621691175289"><span id="local-6989586621691175290"><span id="local-6989586621691175291"><span id="local-6989586621691175292"><span id="local-6989586621691175293"><span id="local-6989586621691175294"><span id="local-6989586621691175295"><span id="local-6989586621691175296"><span id="local-6989586621691175297"><span id="local-6989586621691175298"><span id="local-6989586621691175299"><span id="local-6989586621691175300"><span id="local-6989586621691175301"><span id="local-6989586621691175302"><span id="local-6989586621691175303"><span id="local-6989586621691175304"><span id="local-6989586621691175305"><span id="local-6989586621691175306"><span id="local-6989586621691175307"><span id="local-6989586621691175308"><span id="local-6989586621691175309"><span class="annot"><span class="annottext">Maybe Text
Maybe PGPool
Maybe (CredentialCache AgentLicenseKey)
SamplingPolicy
PGPool
ConnParams
TxIsolation
TMVar MetadataResourceVersion
Refined NonNegative Seconds
Manager
CheckFeatureFlag
ServerMetrics
EventingMode
ReadOnlyMode
MaintenanceMode ()
InstanceId
PrometheusMetrics
ShutdownLatch
LoggingSettings
LockedEventsCtx
HostPreference
ConnectionOptions
WSConnectionInitTimeout
KeepAliveDelay
OptionalInterval
Port
SubscriptionsState
Loggers
appEnvLicenseKeyCache :: Maybe (CredentialCache AgentLicenseKey)
appEnvCheckFeatureFlag :: CheckFeatureFlag
appEnvSchemaPollInterval :: OptionalInterval
appEnvGracefulShutdownTimeout :: Refined NonNegative Seconds
appEnvWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
appEnvWebSocketKeepAlive :: KeepAliveDelay
appEnvConnectionOptions :: ConnectionOptions
appEnvConsoleSentryDsn :: Maybe Text
appEnvConsoleAssetsDir :: Maybe Text
appEnvTxIso :: TxIsolation
appEnvConnParams :: ConnParams
appEnvLockedEventsCtx :: LockedEventsCtx
appEnvSubscriptionState :: SubscriptionsState
appEnvTraceSamplingPolicy :: SamplingPolicy
appEnvPrometheusMetrics :: PrometheusMetrics
appEnvMetaVersionRef :: TMVar MetadataResourceVersion
appEnvShutdownLatch :: ShutdownLatch
appEnvServerMetrics :: ServerMetrics
appEnvEnableReadOnlyMode :: ReadOnlyMode
appEnvEventingMode :: EventingMode
appEnvLoggingSettings :: LoggingSettings
appEnvEnableMaintenanceMode :: MaintenanceMode ()
appEnvInstanceId :: InstanceId
appEnvMetadataVersionRef :: TMVar MetadataResourceVersion
appEnvLoggers :: Loggers
appEnvManager :: Manager
appEnvIntrospectionDbPool :: Maybe PGPool
appEnvMetadataDbPool :: PGPool
appEnvHost :: HostPreference
appEnvPort :: Port
appEnvLicenseKeyCache :: AppEnv -&gt; Maybe (CredentialCache AgentLicenseKey)
appEnvSchemaPollInterval :: AppEnv -&gt; OptionalInterval
appEnvCheckFeatureFlag :: AppEnv -&gt; CheckFeatureFlag
appEnvGracefulShutdownTimeout :: AppEnv -&gt; Refined NonNegative Seconds
appEnvWebSocketConnectionInitTimeout :: AppEnv -&gt; WSConnectionInitTimeout
appEnvWebSocketKeepAlive :: AppEnv -&gt; KeepAliveDelay
appEnvConnectionOptions :: AppEnv -&gt; ConnectionOptions
appEnvConsoleSentryDsn :: AppEnv -&gt; Maybe Text
appEnvConsoleAssetsDir :: AppEnv -&gt; Maybe Text
appEnvTxIso :: AppEnv -&gt; TxIsolation
appEnvConnParams :: AppEnv -&gt; ConnParams
appEnvLockedEventsCtx :: AppEnv -&gt; LockedEventsCtx
appEnvSubscriptionState :: AppEnv -&gt; SubscriptionsState
appEnvTraceSamplingPolicy :: AppEnv -&gt; SamplingPolicy
appEnvPrometheusMetrics :: AppEnv -&gt; PrometheusMetrics
appEnvMetaVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvShutdownLatch :: AppEnv -&gt; ShutdownLatch
appEnvServerMetrics :: AppEnv -&gt; ServerMetrics
appEnvEnableReadOnlyMode :: AppEnv -&gt; ReadOnlyMode
appEnvEventingMode :: AppEnv -&gt; EventingMode
appEnvLoggingSettings :: AppEnv -&gt; LoggingSettings
appEnvEnableMaintenanceMode :: AppEnv -&gt; MaintenanceMode ()
appEnvInstanceId :: AppEnv -&gt; InstanceId
appEnvMetadataVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvLoggers :: AppEnv -&gt; Loggers
appEnvManager :: AppEnv -&gt; Manager
appEnvIntrospectionDbPool :: AppEnv -&gt; Maybe PGPool
appEnvMetadataDbPool :: AppEnv -&gt; PGPool
appEnvHost :: AppEnv -&gt; HostPreference
appEnvPort :: AppEnv -&gt; Port
</span><a href="#local-6989586621691175280"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasAppEnv m =&gt; m AppEnv
</span><a href="Hasura.App.State.html#askAppEnv"><span class="hs-identifier hs-var">askAppEnv</span></a></span><span>
</span><span id="line-1263"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621691175277"><span class="annot"><span class="annottext">label :: String
</span><a href="#local-6989586621691175277"><span class="hs-keyword hs-var hs-var">label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;asyncActionsProcessor&quot;</span></span><span>
</span><span id="line-1264"></span><span>          </span><span id="local-6989586621691175276"><span class="annot"><span class="annottext">asyncActionGracefulShutdownAction :: m ()
</span><a href="#local-6989586621691175276"><span class="hs-identifier hs-var hs-var">asyncActionGracefulShutdownAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1265"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (b :: * -&gt; *) (m :: * -&gt; *) c.
MonadStateless b m =&gt;
((forall a. m a -&gt; b a) -&gt; b c) -&gt; m c
</span><a href="Control.Monad.Stateless.html#liftWithStateless"><span class="hs-identifier hs-var">liftWithStateless</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621691175274"><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621691175274"><span class="hs-identifier hs-var">lowerIO</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1266"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; String -&gt; IO Int -&gt; ShutdownAction -&gt; Seconds -&gt; IO ()
</span><a href="#local-6989586621691175370"><span class="hs-identifier hs-var">waitForProcessingAction</span></a></span><span>
</span><span id="line-1267"></span><span>                    </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175312"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-1268"></span><span>                    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;async_actions&quot;</span></span><span>
</span><span id="line-1269"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">readTVarIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LockedEventsCtx -&gt; TVar (Set CronEventId)
</span><a href="Hasura.Eventing.Common.html#leActionEvents"><span class="hs-identifier hs-var">leActionEvents</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621691175311"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1270"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExceptT QErr IO () -&gt; ShutdownAction
</span><a href="Hasura.App.html#MetadataDBShutdownAction"><span class="hs-identifier hs-var">MetadataDBShutdownAction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (t :: (* -&gt; *) -&gt; k -&gt; *) (m :: * -&gt; *) (n :: * -&gt; *)
       (b :: k).
(MFunctor t, Monad m) =&gt;
(forall a. m a -&gt; n a) -&gt; t m b -&gt; t n b
</span><span class="hs-identifier hs-var">hoist</span></span><span> </span><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621691175274"><span class="hs-identifier hs-var">lowerIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LockedEventsCtx -&gt; ExceptT QErr m ()
</span><a href="#local-6989586621691175376"><span class="hs-identifier hs-var">shutdownAsyncActions</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621691175311"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1271"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (p :: k) x. Refined p x -&gt; x
</span><span class="hs-identifier hs-var">unrefine</span></span><span> </span><span class="annot"><span class="annottext">Refined NonNegative Seconds
</span><a href="#local-6989586621691175283"><span class="hs-identifier hs-var">appEnvGracefulShutdownTimeout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1272"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-1273"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-1274"></span><span>
</span><span id="line-1275"></span><span>      </span><span class="hs-comment">-- start a background thread to handle async actions</span><span>
</span><span id="line-1276"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">void</span></a></span><span>
</span><span id="line-1277"></span><span>        </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
String
-&gt; Logger Hasura
-&gt; ThreadShutdown m
-&gt; m (Forever m)
-&gt; ManagedT m Thread
</span><a href="Control.Concurrent.Extended.html#forkManagedTWithGracefulShutdown"><span class="hs-identifier hs-var">C.forkManagedTWithGracefulShutdown</span></a></span><span>
</span><span id="line-1278"></span><span>          </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621691175277"><span class="hs-keyword hs-var">label</span></a></span><span>
</span><span id="line-1279"></span><span>          </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175312"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-1280"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). m () -&gt; ThreadShutdown m
</span><a href="Control.Concurrent.Extended.html#ThreadShutdown"><span class="hs-identifier hs-var">C.ThreadShutdown</span></a></span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621691175276"><span class="hs-identifier hs-var">asyncActionGracefulShutdownAction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1281"></span><span>        </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(HasAppEnv m, MonadIO m, MonadBaseControl IO m, Forall (Pure m),
 MonadMetadataStorage m, MonadTrace m) =&gt;
IO Environment
-&gt; Logger Hasura
-&gt; IO SchemaCache
-&gt; IO OptionalInterval
-&gt; TVar (Set CronEventId)
-&gt; Maybe GQLQueryText
-&gt; m (Forever m)
</span><a href="Hasura.GraphQL.Execute.Action.html#asyncActionsProcessor"><span class="hs-identifier hs-var">asyncActionsProcessor</span></a></span><span>
</span><span id="line-1282"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppContext -&gt; Environment
</span><a href="Hasura.App.State.html#acEnvironment"><span class="hs-identifier hs-var">acEnvironment</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">getAppContext</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1283"></span><span>          </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175312"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-1284"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall impl. AppStateRef impl -&gt; IO SchemaCache
</span><a href="Hasura.Server.AppStateRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1285"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppContext -&gt; OptionalInterval
</span><a href="Hasura.App.State.html#acAsyncActionsFetchInterval"><span class="hs-identifier hs-var">acAsyncActionsFetchInterval</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">getAppContext</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1286"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LockedEventsCtx -&gt; TVar (Set CronEventId)
</span><a href="Hasura.Eventing.Common.html#leActionEvents"><span class="hs-identifier hs-var">leActionEvents</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621691175311"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1287"></span><span>          </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1288"></span><span>
</span><span id="line-1289"></span><span>      </span><span class="hs-comment">-- start a background thread to handle async action live queries</span><span>
</span><span id="line-1290"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1291"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
String -&gt; Logger Hasura -&gt; m Void -&gt; ManagedT m Thread
</span><a href="Control.Concurrent.Extended.html#forkManagedT"><span class="hs-identifier hs-var">C.forkManagedT</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;asyncActionSubscriptionsProcessor&quot;</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175312"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1292"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) void.
(MonadIO m, MonadMetadataStorage m) =&gt;
AsyncActionSubscriptionState -&gt; m void
</span><a href="Hasura.GraphQL.Execute.Action.Subscription.html#asyncActionSubscriptionsProcessor"><span class="hs-identifier hs-var">asyncActionSubscriptionsProcessor</span></a></span><span> </span><span class="annot"><span class="annottext">AsyncActionSubscriptionState
</span><a href="#local-6989586621691175310"><span class="hs-identifier hs-var">actionSubState</span></a></span><span>
</span><span id="line-1293"></span><span>
</span><span id="line-1294"></span><span>    </span><span id="local-6989586621691175541"><span class="annot"><span class="annottext">startScheduledEventsPollerThread :: Logger Hasura -&gt; LockedEventsCtx -&gt; ManagedT m ()
</span><a href="#local-6989586621691175541"><span class="hs-identifier hs-var hs-var">startScheduledEventsPollerThread</span></a></span></span><span> </span><span id="local-6989586621691175271"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175271"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621691175270"><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621691175270"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1295"></span><span>      </span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">AppEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621691175240"><span id="local-6989586621691175241"><span id="local-6989586621691175242"><span id="local-6989586621691175243"><span id="local-6989586621691175244"><span id="local-6989586621691175245"><span id="local-6989586621691175246"><span id="local-6989586621691175247"><span id="local-6989586621691175248"><span id="local-6989586621691175249"><span id="local-6989586621691175250"><span id="local-6989586621691175251"><span id="local-6989586621691175252"><span id="local-6989586621691175253"><span id="local-6989586621691175254"><span id="local-6989586621691175255"><span id="local-6989586621691175256"><span id="local-6989586621691175257"><span id="local-6989586621691175258"><span id="local-6989586621691175259"><span id="local-6989586621691175260"><span id="local-6989586621691175261"><span id="local-6989586621691175262"><span id="local-6989586621691175263"><span id="local-6989586621691175264"><span id="local-6989586621691175265"><span id="local-6989586621691175266"><span id="local-6989586621691175267"><span id="local-6989586621691175268"><span id="local-6989586621691175269"><span class="annot"><span class="annottext">Maybe Text
Maybe PGPool
Maybe (CredentialCache AgentLicenseKey)
SamplingPolicy
PGPool
ConnParams
TxIsolation
TMVar MetadataResourceVersion
Refined NonNegative Seconds
Manager
CheckFeatureFlag
ServerMetrics
EventingMode
ReadOnlyMode
MaintenanceMode ()
InstanceId
PrometheusMetrics
ShutdownLatch
LoggingSettings
LockedEventsCtx
HostPreference
ConnectionOptions
WSConnectionInitTimeout
KeepAliveDelay
OptionalInterval
Port
SubscriptionsState
Loggers
appEnvLicenseKeyCache :: Maybe (CredentialCache AgentLicenseKey)
appEnvCheckFeatureFlag :: CheckFeatureFlag
appEnvSchemaPollInterval :: OptionalInterval
appEnvGracefulShutdownTimeout :: Refined NonNegative Seconds
appEnvWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
appEnvWebSocketKeepAlive :: KeepAliveDelay
appEnvConnectionOptions :: ConnectionOptions
appEnvConsoleSentryDsn :: Maybe Text
appEnvConsoleAssetsDir :: Maybe Text
appEnvTxIso :: TxIsolation
appEnvConnParams :: ConnParams
appEnvLockedEventsCtx :: LockedEventsCtx
appEnvSubscriptionState :: SubscriptionsState
appEnvTraceSamplingPolicy :: SamplingPolicy
appEnvPrometheusMetrics :: PrometheusMetrics
appEnvMetaVersionRef :: TMVar MetadataResourceVersion
appEnvShutdownLatch :: ShutdownLatch
appEnvServerMetrics :: ServerMetrics
appEnvEnableReadOnlyMode :: ReadOnlyMode
appEnvEventingMode :: EventingMode
appEnvLoggingSettings :: LoggingSettings
appEnvEnableMaintenanceMode :: MaintenanceMode ()
appEnvInstanceId :: InstanceId
appEnvMetadataVersionRef :: TMVar MetadataResourceVersion
appEnvLoggers :: Loggers
appEnvManager :: Manager
appEnvIntrospectionDbPool :: Maybe PGPool
appEnvMetadataDbPool :: PGPool
appEnvHost :: HostPreference
appEnvPort :: Port
appEnvLicenseKeyCache :: AppEnv -&gt; Maybe (CredentialCache AgentLicenseKey)
appEnvSchemaPollInterval :: AppEnv -&gt; OptionalInterval
appEnvCheckFeatureFlag :: AppEnv -&gt; CheckFeatureFlag
appEnvGracefulShutdownTimeout :: AppEnv -&gt; Refined NonNegative Seconds
appEnvWebSocketConnectionInitTimeout :: AppEnv -&gt; WSConnectionInitTimeout
appEnvWebSocketKeepAlive :: AppEnv -&gt; KeepAliveDelay
appEnvConnectionOptions :: AppEnv -&gt; ConnectionOptions
appEnvConsoleSentryDsn :: AppEnv -&gt; Maybe Text
appEnvConsoleAssetsDir :: AppEnv -&gt; Maybe Text
appEnvTxIso :: AppEnv -&gt; TxIsolation
appEnvConnParams :: AppEnv -&gt; ConnParams
appEnvLockedEventsCtx :: AppEnv -&gt; LockedEventsCtx
appEnvSubscriptionState :: AppEnv -&gt; SubscriptionsState
appEnvTraceSamplingPolicy :: AppEnv -&gt; SamplingPolicy
appEnvPrometheusMetrics :: AppEnv -&gt; PrometheusMetrics
appEnvMetaVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvShutdownLatch :: AppEnv -&gt; ShutdownLatch
appEnvServerMetrics :: AppEnv -&gt; ServerMetrics
appEnvEnableReadOnlyMode :: AppEnv -&gt; ReadOnlyMode
appEnvEventingMode :: AppEnv -&gt; EventingMode
appEnvLoggingSettings :: AppEnv -&gt; LoggingSettings
appEnvEnableMaintenanceMode :: AppEnv -&gt; MaintenanceMode ()
appEnvInstanceId :: AppEnv -&gt; InstanceId
appEnvMetadataVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvLoggers :: AppEnv -&gt; Loggers
appEnvManager :: AppEnv -&gt; Manager
appEnvIntrospectionDbPool :: AppEnv -&gt; Maybe PGPool
appEnvMetadataDbPool :: AppEnv -&gt; PGPool
appEnvHost :: AppEnv -&gt; HostPreference
appEnvPort :: AppEnv -&gt; Port
</span><a href="#local-6989586621691175240"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasAppEnv m =&gt; m AppEnv
</span><a href="Hasura.App.State.html#askAppEnv"><span class="hs-identifier hs-var">askAppEnv</span></a></span><span>
</span><span id="line-1296"></span><span>      </span><span class="hs-comment">-- prepare scheduled triggers</span><span>
</span><span id="line-1297"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {impl}.
(MonadIO m, ToEngineLog StartupLog impl, MonadMetadataStorage m) =&gt;
Logger impl -&gt; m ()
</span><a href="#local-6989586621691175485"><span class="hs-identifier hs-var">prepareScheduledEvents</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175271"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-1298"></span><span>
</span><span id="line-1299"></span><span>      </span><span class="hs-comment">-- Create logger for logging the statistics of scheduled events fetched</span><span>
</span><span id="line-1300"></span><span>      </span><span id="local-6989586621691175239"><span class="annot"><span class="annottext">FetchedScheduledEventsStatsLogger
</span><a href="#local-6989586621691175239"><span class="hs-identifier hs-var">scheduledEventsStatsLogger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1301"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
MonadBaseControl IO m =&gt;
m a -&gt; (a -&gt; m b) -&gt; ManagedT m a
</span><a href="Control.Monad.Trans.Managed.html#allocate"><span class="hs-identifier hs-var">allocate</span></a></span><span>
</span><span id="line-1302"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
Logger Hasura -&gt; m FetchedScheduledEventsStatsLogger
</span><a href="Hasura.Eventing.ScheduledTrigger.html#createFetchedScheduledEventsStatsLogger"><span class="hs-identifier hs-var">createFetchedScheduledEventsStatsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175271"><span class="hs-identifier hs-var">logger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1303"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
Logger Hasura -&gt; FetchedScheduledEventsStatsLogger -&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#closeFetchedScheduledEventsStatsLogger"><span class="hs-identifier hs-var">closeFetchedScheduledEventsStatsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175271"><span class="hs-identifier hs-var">logger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1304"></span><span>
</span><span id="line-1305"></span><span>      </span><span class="hs-comment">-- start a background thread to deliver the scheduled events</span><span>
</span><span id="line-1306"></span><span>      </span><span class="hs-comment">-- _scheduledEventsThread &lt;- do</span><span>
</span><span id="line-1307"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621691175236"><span class="annot"><span class="annottext">scheduledEventsGracefulShutdownAction :: m ()
</span><a href="#local-6989586621691175236"><span class="hs-identifier hs-var hs-var">scheduledEventsGracefulShutdownAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1308"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (b :: * -&gt; *) (m :: * -&gt; *) c.
MonadStateless b m =&gt;
((forall a. m a -&gt; b a) -&gt; b c) -&gt; m c
</span><a href="Control.Monad.Stateless.html#liftWithStateless"><span class="hs-identifier hs-var">liftWithStateless</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621691175235"><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621691175235"><span class="hs-identifier hs-var">lowerIO</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1309"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; String -&gt; IO Int -&gt; ShutdownAction -&gt; Seconds -&gt; IO ()
</span><a href="#local-6989586621691175370"><span class="hs-identifier hs-var">waitForProcessingAction</span></a></span><span>
</span><span id="line-1310"></span><span>                    </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175271"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-1311"></span><span>                    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;scheduled_events&quot;</span></span><span>
</span><span id="line-1312"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LockedEventsCtx -&gt; IO Int
</span><a href="#local-6989586621691175479"><span class="hs-identifier hs-var">getProcessingScheduledEventsCount</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621691175270"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1313"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExceptT QErr IO () -&gt; ShutdownAction
</span><a href="Hasura.App.html#MetadataDBShutdownAction"><span class="hs-identifier hs-var">MetadataDBShutdownAction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {k} (t :: (* -&gt; *) -&gt; k -&gt; *) (m :: * -&gt; *) (n :: * -&gt; *)
       (b :: k).
(MFunctor t, Monad m) =&gt;
(forall a. m a -&gt; n a) -&gt; t m b -&gt; t n b
</span><span class="hs-identifier hs-var">hoist</span></span><span> </span><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621691175235"><span class="hs-identifier hs-var">lowerIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadMetadataStorage m =&gt; m (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#unlockAllLockedScheduledEvents"><span class="hs-identifier hs-var">unlockAllLockedScheduledEvents</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1314"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (p :: k) x. Refined p x -&gt; x
</span><span class="hs-identifier hs-var">unrefine</span></span><span> </span><span class="annot"><span class="annottext">Refined NonNegative Seconds
</span><a href="#local-6989586621691175243"><span class="hs-identifier hs-var">appEnvGracefulShutdownTimeout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1315"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-1316"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-1317"></span><span>
</span><span id="line-1318"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">void</span></a></span><span>
</span><span id="line-1319"></span><span>        </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
String
-&gt; Logger Hasura
-&gt; ThreadShutdown m
-&gt; m (Forever m)
-&gt; ManagedT m Thread
</span><a href="Control.Concurrent.Extended.html#forkManagedTWithGracefulShutdown"><span class="hs-identifier hs-var">C.forkManagedTWithGracefulShutdown</span></a></span><span>
</span><span id="line-1320"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;processScheduledTriggers&quot;</span></span><span>
</span><span id="line-1321"></span><span>          </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175271"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-1322"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). m () -&gt; ThreadShutdown m
</span><a href="Control.Concurrent.Extended.html#ThreadShutdown"><span class="hs-identifier hs-var">C.ThreadShutdown</span></a></span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621691175236"><span class="hs-identifier hs-var">scheduledEventsGracefulShutdownAction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1323"></span><span>        </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(MonadIO m, MonadTrace m, MonadMetadataStorage m,
 MonadBaseControl IO m) =&gt;
IO Environment
-&gt; Logger Hasura
-&gt; FetchedScheduledEventsStatsLogger
-&gt; Manager
-&gt; ScheduledTriggerMetrics
-&gt; IO SchemaCache
-&gt; LockedEventsCtx
-&gt; m (Forever m)
</span><a href="Hasura.Eventing.ScheduledTrigger.html#processScheduledTriggers"><span class="hs-identifier hs-var">processScheduledTriggers</span></a></span><span>
</span><span id="line-1324"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppContext -&gt; Environment
</span><a href="Hasura.App.State.html#acEnvironment"><span class="hs-identifier hs-var">acEnvironment</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">getAppContext</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1325"></span><span>          </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621691175271"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-1326"></span><span>          </span><span class="annot"><span class="annottext">FetchedScheduledEventsStatsLogger
</span><a href="#local-6989586621691175239"><span class="hs-identifier hs-var">scheduledEventsStatsLogger</span></a></span><span>
</span><span id="line-1327"></span><span>          </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621691175265"><span class="hs-identifier hs-var">appEnvManager</span></a></span><span>
</span><span id="line-1328"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrometheusMetrics -&gt; ScheduledTriggerMetrics
</span><a href="Hasura.Server.Prometheus.html#pmScheduledTriggerMetrics"><span class="hs-identifier hs-var">pmScheduledTriggerMetrics</span></a></span><span> </span><span class="annot"><span class="annottext">PrometheusMetrics
</span><a href="#local-6989586621691175254"><span class="hs-identifier hs-var">appEnvPrometheusMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1329"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall impl. AppStateRef impl -&gt; IO SchemaCache
</span><a href="Hasura.Server.AppStateRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621691175641"><span class="hs-identifier hs-var">appStateRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1330"></span><span>          </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621691175270"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span>
</span><span id="line-1331"></span><span>
</span><span id="line-1332"></span><span id="local-6989586621691178037"><span class="annot"><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-type">runInSeparateTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1333"></span><span>  </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">QErr</span></span><span> </span><span class="annot"><a href="#local-6989586621691178037"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1334"></span><span>  </span><span class="annot"><a href="Hasura.App.html#AppM"><span class="hs-identifier hs-type">AppM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">QErr</span></span><span> </span><span class="annot"><a href="#local-6989586621691178037"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1335"></span><span id="runInSeparateTx"><span class="annot"><span class="annottext">runInSeparateTx :: forall a. TxE QErr a -&gt; AppM (Either QErr a)
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var hs-var">runInSeparateTx</span></a></span></span><span> </span><span id="local-6989586621691175225"><span class="annot"><span class="annottext">TxE QErr a
</span><a href="#local-6989586621691175225"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1336"></span><span>  </span><span id="local-6989586621691175224"><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621691175224"><span class="hs-identifier hs-var">pool</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">AppEnv -&gt; PGPool
</span><a href="Hasura.App.State.html#appEnvMetadataDbPool"><span class="hs-identifier hs-var">appEnvMetadataDbPool</span></a></span><span>
</span><span id="line-1337"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
(MonadIO m, MonadBaseControl IO m, FromPGTxErr e,
 FromPGConnErr e) =&gt;
PGPool -&gt; TxMode -&gt; TxET e m a -&gt; ExceptT e m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.runTx</span></a></span><span> </span><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621691175224"><span class="hs-identifier hs-var">pool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIsolation
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.RepeatableRead</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxE QErr a
</span><a href="#local-6989586621691175225"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1338"></span><span>
</span><span id="line-1339"></span><span class="annot"><a href="Hasura.App.html#notifySchemaCacheSyncTx"><span class="hs-identifier hs-type">notifySchemaCacheSyncTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#MetadataResourceVersion"><span class="hs-identifier hs-type">MetadataResourceVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html#InstanceId"><span class="hs-identifier hs-type">InstanceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-type">CacheInvalidations</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">QErr</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1340"></span><span id="notifySchemaCacheSyncTx"><span class="annot"><span class="annottext">notifySchemaCacheSyncTx :: MetadataResourceVersion
-&gt; InstanceId -&gt; CacheInvalidations -&gt; TxE QErr ()
</span><a href="Hasura.App.html#notifySchemaCacheSyncTx"><span class="hs-identifier hs-var hs-var">notifySchemaCacheSyncTx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#MetadataResourceVersion"><span class="hs-identifier hs-type">MetadataResourceVersion</span></a></span><span> </span><span id="local-6989586621691175221"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621691175221"><span class="hs-identifier hs-var">resourceVersion</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621691175220"><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621691175220"><span class="hs-identifier hs-var">instanceId</span></a></span></span><span> </span><span id="local-6989586621691175219"><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621691175219"><span class="hs-identifier hs-var">invalidations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1341"></span><span>  </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.Discard</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1342"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a r e.
(MonadIO m, FromRes a, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.withQE</span></a></span><span>
</span><span id="line-1343"></span><span>      </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-1344"></span><span>      </span><span class="annot"><span class="">[PG.sql|
      INSERT INTO hdb_catalog.hdb_schema_notifications(id, notification, resource_version, instance_id)
      VALUES (1, $1::json, $2, $3::uuid)
      ON CONFLICT (id) DO UPDATE SET
        notification = $1::json,
        resource_version = $2,
        instance_id = $3::uuid
    |]</span></span><span>
</span><span id="line-1352"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; ViaJSON a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.ViaJSON</span></a></span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621691175219"><span class="hs-identifier hs-var">invalidations</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621691175221"><span class="hs-identifier hs-var">resourceVersion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621691175220"><span class="hs-identifier hs-var">instanceId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1353"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1354"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1355"></span><span>
</span><span id="line-1356"></span><span class="annot"><a href="Hasura.App.html#getCatalogStateTx"><span class="hs-identifier hs-type">getCatalogStateTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">QErr</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#CatalogState"><span class="hs-identifier hs-type">CatalogState</span></a></span><span>
</span><span id="line-1357"></span><span id="getCatalogStateTx"><span class="annot"><span class="annottext">getCatalogStateTx :: TxE QErr CatalogState
</span><a href="Hasura.App.html#getCatalogStateTx"><span class="hs-identifier hs-var hs-var">getCatalogStateTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1358"></span><span>  </span><span class="annot"><span class="annottext">(Text, ViaJSON Value, ViaJSON Value) -&gt; CatalogState
</span><a href="#local-6989586621691175214"><span class="hs-identifier hs-var">mkCatalogState</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. SingleRow a -&gt; a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.getRow</span></a></span><span>
</span><span id="line-1359"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a r e.
(MonadIO m, FromRes a, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.withQE</span></a></span><span>
</span><span id="line-1360"></span><span>      </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-1361"></span><span>      </span><span class="annot"><span class="">[PG.sql|
    SELECT hasura_uuid::text, cli_state::json, console_state::json
      FROM hdb_catalog.hdb_version
  |]</span></span><span>
</span><span id="line-1365"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1366"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1367"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1368"></span><span>    </span><span id="local-6989586621691175214"><span class="annot"><span class="annottext">mkCatalogState :: (Text, ViaJSON Value, ViaJSON Value) -&gt; CatalogState
</span><a href="#local-6989586621691175214"><span class="hs-identifier hs-var hs-var">mkCatalogState</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621691175212"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691175212"><span class="hs-identifier hs-var">dbId</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.ViaJSON</span></a></span><span> </span><span id="local-6989586621691175211"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621691175211"><span class="hs-identifier hs-var">cliState</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.ViaJSON</span></a></span><span> </span><span id="local-6989586621691175210"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621691175210"><span class="hs-identifier hs-var">consoleState</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1369"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Value -&gt; Value -&gt; CatalogState
</span><a href="Hasura.RQL.Types.Metadata.Common.html#CatalogState"><span class="hs-identifier hs-var">CatalogState</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691175212"><span class="hs-identifier hs-var">dbId</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621691175211"><span class="hs-identifier hs-var">cliState</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621691175210"><span class="hs-identifier hs-var">consoleState</span></a></span><span>
</span><span id="line-1370"></span><span>
</span><span id="line-1371"></span><span class="annot"><a href="Hasura.App.html#setCatalogStateTx"><span class="hs-identifier hs-type">setCatalogStateTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#CatalogStateType"><span class="hs-identifier hs-type">CatalogStateType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">J.Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">QErr</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1372"></span><span id="setCatalogStateTx"><span class="annot"><span class="annottext">setCatalogStateTx :: CatalogStateType -&gt; Value -&gt; TxE QErr ()
</span><a href="Hasura.App.html#setCatalogStateTx"><span class="hs-identifier hs-var hs-var">setCatalogStateTx</span></a></span></span><span> </span><span id="local-6989586621691175208"><span class="annot"><span class="annottext">CatalogStateType
</span><a href="#local-6989586621691175208"><span class="hs-identifier hs-var">stateTy</span></a></span></span><span> </span><span id="local-6989586621691175207"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621691175207"><span class="hs-identifier hs-var">stateValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1373"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CatalogStateType
</span><a href="#local-6989586621691175208"><span class="hs-identifier hs-var">stateTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1374"></span><span>    </span><span class="annot"><span class="annottext">CatalogStateType
</span><a href="Hasura.RQL.Types.Metadata.Common.html#CSTCli"><span class="hs-identifier hs-var">CSTCli</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1375"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r e.
(MonadIO m, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m ()
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.unitQE</span></a></span><span>
</span><span id="line-1376"></span><span>        </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-1377"></span><span>        </span><span class="annot"><span class="">[PG.sql|
        UPDATE hdb_catalog.hdb_version
           SET cli_state = $1
      |]</span></span><span>
</span><span id="line-1381"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Identity a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Identity</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; ViaJSON a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.ViaJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621691175207"><span class="hs-identifier hs-var">stateValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1382"></span><span>        </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1383"></span><span>    </span><span class="annot"><span class="annottext">CatalogStateType
</span><a href="Hasura.RQL.Types.Metadata.Common.html#CSTConsole"><span class="hs-identifier hs-var">CSTConsole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1384"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r e.
(MonadIO m, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m ()
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.unitQE</span></a></span><span>
</span><span id="line-1385"></span><span>        </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-1386"></span><span>        </span><span class="annot"><span class="">[PG.sql|
        UPDATE hdb_catalog.hdb_version
           SET console_state = $1
      |]</span></span><span>
</span><span id="line-1390"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Identity a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Identity</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; ViaJSON a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.ViaJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621691175207"><span class="hs-identifier hs-var">stateValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1391"></span><span>        </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1392"></span><span>
</span><span id="line-1393"></span><span class="hs-comment">--- helper functions ---</span><span>
</span><span id="line-1394"></span><span>
</span><span id="line-1395"></span><span class="annot"><a href="Hasura.App.html#mkConsoleHTML"><span class="hs-identifier hs-type">mkConsoleHTML</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1396"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1397"></span><span>  </span><span class="annot"><a href="Hasura.Server.Auth.html#AuthMode"><span class="hs-identifier hs-type">AuthMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1398"></span><span>  </span><span class="annot"><a href="Hasura.Server.Init.Config.html#TelemetryStatus"><span class="hs-identifier hs-type">TelemetryStatus</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1399"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1400"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1401"></span><span>  </span><span class="annot"><a href="Hasura.Server.App.html#CEConsoleType"><span class="hs-identifier hs-type">CEConsoleType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1402"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-1403"></span><span id="mkConsoleHTML"><span class="annot"><span class="annottext">mkConsoleHTML :: Text
-&gt; AuthMode
-&gt; TelemetryStatus
-&gt; Maybe Text
-&gt; Maybe Text
-&gt; CEConsoleType
-&gt; Either String Text
</span><a href="Hasura.App.html#mkConsoleHTML"><span class="hs-identifier hs-var hs-var">mkConsoleHTML</span></a></span></span><span> </span><span id="local-6989586621691175202"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691175202"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621691175201"><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621691175201"><span class="hs-identifier hs-var">authMode</span></a></span></span><span> </span><span id="local-6989586621691175200"><span class="annot"><span class="annottext">TelemetryStatus
</span><a href="#local-6989586621691175200"><span class="hs-identifier hs-var">enableTelemetry</span></a></span></span><span> </span><span id="local-6989586621691175199"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621691175199"><span class="hs-identifier hs-var">consoleAssetsDir</span></a></span></span><span> </span><span id="local-6989586621691175198"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621691175198"><span class="hs-identifier hs-var">consoleSentryDsn</span></a></span></span><span> </span><span id="local-6989586621691175197"><span class="annot"><span class="annottext">CEConsoleType
</span><a href="#local-6989586621691175197"><span class="hs-identifier hs-var">ceConsoleType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1404"></span><span>  </span><span class="annot"><span class="annottext">Template -&gt; Value -&gt; Either String Text
</span><a href="Hasura.Server.App.html#renderHtmlTemplate"><span class="hs-identifier hs-var">renderHtmlTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">Template
</span><a href="#local-6989586621691175195"><span class="hs-identifier hs-var">consoleTmplt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1405"></span><span>    </span><span class="hs-comment">-- variables required to render the template</span><span>
</span><span id="line-1406"></span><span>    </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">J.object</span></span><span>
</span><span id="line-1407"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;isAdminSecretSet&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">J..=</span></span><span> </span><span class="annot"><span class="annottext">AuthMode -&gt; Text
</span><a href="Hasura.Server.App.html#isAdminSecretSet"><span class="hs-identifier hs-var">isAdminSecretSet</span></a></span><span> </span><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621691175201"><span class="hs-identifier hs-var">authMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1408"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;consolePath&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">J..=</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691175192"><span class="hs-identifier hs-var">consolePath</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1409"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;enableTelemetry&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">J..=</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Text
</span><a href="Hasura.Server.App.html#boolToText"><span class="hs-identifier hs-var">boolToText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TelemetryStatus -&gt; Bool
</span><a href="Hasura.Server.Init.Config.html#isTelemetryEnabled"><span class="hs-identifier hs-var">isTelemetryEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">TelemetryStatus
</span><a href="#local-6989586621691175200"><span class="hs-identifier hs-var">enableTelemetry</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1410"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;cdnAssets&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">J..=</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Text
</span><a href="Hasura.Server.App.html#boolToText"><span class="hs-identifier hs-var">boolToText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Maybe a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621691175199"><span class="hs-identifier hs-var">consoleAssetsDir</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1411"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;consoleSentryDsn&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">J..=</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621691175198"><span class="hs-identifier hs-var">consoleSentryDsn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1412"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;assetsVersion&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">J..=</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Hasura.Server.Version.html#consoleAssetsVersion"><span class="hs-identifier hs-var">consoleAssetsVersion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1413"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;serverVersion&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">J..=</span></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="Hasura.Server.Version.html#currentVersion"><span class="hs-identifier hs-var">currentVersion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1414"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;consoleType&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">J..=</span></span><span> </span><span class="annot"><span class="annottext">CEConsoleType -&gt; String
</span><a href="Hasura.Server.App.html#ceConsoleTypeIdentifier"><span class="hs-identifier hs-var">ceConsoleTypeIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">CEConsoleType
</span><a href="#local-6989586621691175197"><span class="hs-identifier hs-var">ceConsoleType</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- TODO(awjchen): This is a kludge that will be removed when the entitlement service is fully implemented.</span><span>
</span><span id="line-1415"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;consoleSentryDsn&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">J..=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-1416"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-1417"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1418"></span><span>    </span><span id="local-6989586621691175192"><span class="annot"><span class="annottext">consolePath :: Text
</span><a href="#local-6989586621691175192"><span class="hs-identifier hs-var hs-var">consolePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691175202"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1419"></span><span>      </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/console&quot;</span></span><span>
</span><span id="line-1420"></span><span>      </span><span id="local-6989586621691175185"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691175185"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/console/&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691175185"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1421"></span><span>
</span><span id="line-1422"></span><span>    </span><span id="local-6989586621691175195"><span class="annot"><span class="annottext">consoleTmplt :: Template
</span><a href="#local-6989586621691175195"><span class="hs-identifier hs-var hs-var">consoleTmplt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">makeRelativeToProject</span><span> </span><span class="hs-string">&quot;src-rsr/console.html&quot;</span><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-identifier">M.embedSingleTemplate</span><span class="hs-special">)</span><span>
</span><span id="line-1423"></span><span>
</span><span id="line-1424"></span><span class="annot"><a href="Hasura.App.html#telemetryNotice"><span class="hs-identifier hs-type">telemetryNotice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-1425"></span><span id="telemetryNotice"><span class="annot"><span class="annottext">telemetryNotice :: Text
</span><a href="Hasura.App.html#telemetryNotice"><span class="hs-identifier hs-var hs-var">telemetryNotice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1426"></span><span>  </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Help us improve Hasura! The graphql-engine server collects anonymized &quot;</span></span><span>
</span><span id="line-1427"></span><span>    </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;usage stats which allows us to keep improving Hasura at warp speed. &quot;</span></span><span>
</span><span id="line-1428"></span><span>    </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;To read more or opt-out, visit https://hasura.io/docs/latest/graphql/core/guides/telemetry.html&quot;</span></span><span>
</span><span id="line-1429"></span><span>
</span><span id="line-1430"></span><span class="annot"><a href="Hasura.App.html#mkPgSourceResolver"><span class="hs-identifier hs-type">mkPgSourceResolver</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.PGLogger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceResolver"><span class="hs-identifier hs-type">SourceResolver</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#Vanilla"><span class="hs-identifier hs-type">Vanilla</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1431"></span><span id="mkPgSourceResolver"><span class="annot"><span class="annottext">mkPgSourceResolver :: PGLogger -&gt; SourceResolver ('Postgres 'Vanilla)
</span><a href="Hasura.App.html#mkPgSourceResolver"><span class="hs-identifier hs-var hs-var">mkPgSourceResolver</span></a></span></span><span> </span><span id="local-6989586621691175179"><span class="annot"><span class="annottext">PGLogger
</span><a href="#local-6989586621691175179"><span class="hs-identifier hs-var">pgLogger</span></a></span></span><span> </span><span id="local-6989586621691175178"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691175178"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621691175177"><span class="annot"><span class="annottext">SourceConnConfiguration ('Postgres 'Vanilla)
</span><a href="#local-6989586621691175177"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1432"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.Settings.html#PostgresSourceConnInfo"><span class="hs-identifier hs-type">PostgresSourceConnInfo</span></a></span><span> </span><span id="local-6989586621691175176"><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621691175176"><span class="hs-identifier hs-var">urlConf</span></a></span></span><span> </span><span id="local-6989586621691175175"><span class="annot"><span class="annottext">Maybe PostgresPoolSettings
</span><a href="#local-6989586621691175175"><span class="hs-identifier hs-var">poolSettings</span></a></span></span><span> </span><span id="local-6989586621691175174"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621691175174"><span class="hs-identifier hs-var">allowPrepare</span></a></span></span><span> </span><span id="local-6989586621691175173"><span class="annot"><span class="annottext">TxIsolation
</span><a href="#local-6989586621691175173"><span class="hs-identifier hs-var">isoLevel</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (PGClientCerts CertVar CertVar)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PostgresConnConfiguration -&gt; PostgresSourceConnInfo
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_pccConnectionInfo"><span class="hs-identifier hs-var">_pccConnectionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConnConfiguration ('Postgres 'Vanilla)
</span><a href="#local-6989586621691175177"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-1433"></span><span>  </span><span class="hs-comment">-- If the user does not provide values for the pool settings, then use the default values</span><span>
</span><span id="line-1434"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621691175172"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621691175172"><span class="hs-identifier hs-var">maxConns</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621691175171"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621691175171"><span class="hs-identifier hs-var">idleTimeout</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621691175170"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621691175170"><span class="hs-identifier hs-var">retries</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe PostgresPoolSettings
-&gt; DefaultPostgresPoolSettings -&gt; (Int, Int, Int)
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#getDefaultPGPoolSettingIfNotExists"><span class="hs-identifier hs-var">getDefaultPGPoolSettingIfNotExists</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PostgresPoolSettings
</span><a href="#local-6989586621691175175"><span class="hs-identifier hs-var">poolSettings</span></a></span><span> </span><span class="annot"><span class="annottext">DefaultPostgresPoolSettings
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#defaultPostgresPoolSettings"><span class="hs-identifier hs-var">defaultPostgresPoolSettings</span></a></span><span>
</span><span id="line-1435"></span><span>  </span><span id="local-6989586621691175167"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691175167"><span class="hs-identifier hs-var">urlText</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadError QErr m =&gt;
Environment -&gt; UrlConf -&gt; m Text
</span><a href="Hasura.RQL.Types.Common.html#resolveUrlConf"><span class="hs-identifier hs-var">resolveUrlConf</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691175178"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621691175176"><span class="hs-identifier hs-var">urlConf</span></a></span><span>
</span><span id="line-1436"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621691175166"><span class="annot"><span class="annottext">connInfo :: ConnInfo
</span><a href="#local-6989586621691175166"><span class="hs-identifier hs-var hs-var">connInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ConnDetails -&gt; ConnInfo
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.ConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621691175170"><span class="hs-identifier hs-var">retries</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ConnDetails
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.CDDatabaseURI</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">txtToBs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621691175167"><span class="hs-identifier hs-var">urlText</span></a></span><span>
</span><span id="line-1437"></span><span>      </span><span id="local-6989586621691175165"><span class="annot"><span class="annottext">connParams :: ConnParams
</span><a href="#local-6989586621691175165"><span class="hs-identifier hs-var hs-var">connParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1438"></span><span>        </span><span class="annot"><span class="annottext">ConnParams
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.defaultConnParams</span></a></span><span>
</span><span id="line-1439"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cpIdleTime :: Int
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.cpIdleTime</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621691175171"><span class="hs-identifier hs-var">idleTimeout</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1440"></span><span>            </span><span class="annot"><span class="annottext">cpConns :: Int
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.cpConns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621691175172"><span class="hs-identifier hs-var">maxConns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1441"></span><span>            </span><span class="annot"><span class="annottext">cpAllowPrepare :: Bool
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.cpAllowPrepare</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621691175174"><span class="hs-identifier hs-var">allowPrepare</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1442"></span><span>            </span><span class="annot"><span class="annottext">cpMbLifetime :: Maybe NominalDiffTime
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.cpMbLifetime</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PostgresPoolSettings -&gt; Maybe NominalDiffTime
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_ppsConnectionLifetime"><span class="hs-identifier hs-var">_ppsConnectionLifetime</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PostgresPoolSettings
</span><a href="#local-6989586621691175175"><span class="hs-identifier hs-var">poolSettings</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1443"></span><span>            </span><span class="annot"><span class="annottext">cpTimeout :: Maybe NominalDiffTime
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.cpTimeout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PostgresPoolSettings -&gt; Maybe NominalDiffTime
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_ppsPoolTimeout"><span class="hs-identifier hs-var">_ppsPoolTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PostgresPoolSettings
</span><a href="#local-6989586621691175175"><span class="hs-identifier hs-var">poolSettings</span></a></span><span>
</span><span id="line-1444"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-1445"></span><span>  </span><span id="local-6989586621691175156"><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621691175156"><span class="hs-identifier hs-var">pgPool</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo -&gt; ConnParams -&gt; PGLogger -&gt; IO PGPool
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">Q.initPGPool</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621691175166"><span class="hs-identifier hs-var">connInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ConnParams
</span><a href="#local-6989586621691175165"><span class="hs-identifier hs-var">connParams</span></a></span><span> </span><span class="annot"><span class="annottext">PGLogger
</span><a href="#local-6989586621691175179"><span class="hs-identifier hs-var">pgLogger</span></a></span><span>
</span><span id="line-1446"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621691175155"><span class="annot"><span class="annottext">pgExecCtx :: PGExecCtx
</span><a href="#local-6989586621691175155"><span class="hs-identifier hs-var hs-var">pgExecCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIsolation -&gt; PGPool -&gt; ResizePoolStrategy -&gt; PGExecCtx
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#mkPGExecCtx"><span class="hs-identifier hs-var">mkPGExecCtx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIsolation
</span><a href="#local-6989586621691175173"><span class="hs-identifier hs-var">isoLevel</span></a></span><span> </span><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621691175156"><span class="hs-identifier hs-var">pgPool</span></a></span><span> </span><span class="annot"><span class="annottext">ResizePoolStrategy
</span><a href="Hasura.RQL.Types.ResizePool.html#NeverResizePool"><span class="hs-identifier hs-var">NeverResizePool</span></a></span><span>
</span><span id="line-1447"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PGExecCtx
-&gt; ConnInfo
-&gt; Maybe (NonEmpty ConnInfo)
-&gt; IO ()
-&gt; ExtensionsSchema
-&gt; HashMap PostgresConnectionSetMemberName ConnInfo
-&gt; ConnectionTemplateConfig
-&gt; PGSourceConfig
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#PGSourceConfig"><span class="hs-identifier hs-var">PGSourceConfig</span></a></span><span> </span><span class="annot"><span class="annottext">PGExecCtx
</span><a href="#local-6989586621691175155"><span class="hs-identifier hs-var">pgExecCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621691175166"><span class="hs-identifier hs-var">connInfo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PostgresConnConfiguration -&gt; ExtensionsSchema
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_pccExtensionsSchema"><span class="hs-identifier hs-var">_pccExtensionsSchema</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConnConfiguration ('Postgres 'Vanilla)
</span><a href="#local-6989586621691175177"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionTemplateConfig
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#ConnTemplate_NotApplicable"><span class="hs-identifier hs-var">ConnTemplate_NotApplicable</span></a></span><span>
</span><span id="line-1448"></span><span>
</span><span id="line-1449"></span><span class="annot"><a href="Hasura.App.html#mkMSSQLSourceResolver"><span class="hs-identifier hs-type">mkMSSQLSourceResolver</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceResolver"><span class="hs-identifier hs-type">SourceResolver</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#MSSQL"><span class="hs-identifier hs-type">MSSQL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1450"></span><span id="mkMSSQLSourceResolver"><span class="annot"><span class="annottext">mkMSSQLSourceResolver :: SourceResolver 'MSSQL
</span><a href="Hasura.App.html#mkMSSQLSourceResolver"><span class="hs-identifier hs-var hs-var">mkMSSQLSourceResolver</span></a></span></span><span> </span><span id="local-6989586621691175150"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691175150"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621691175149"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621691175149"><span class="hs-identifier hs-var">_name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.MSSQL.Connection.html#MSSQLConnConfiguration"><span class="hs-identifier hs-type">MSSQLConnConfiguration</span></a></span><span> </span><span id="local-6989586621691175147"><span class="annot"><span class="annottext">MSSQLConnectionInfo
</span><a href="#local-6989586621691175147"><span class="hs-identifier hs-var">connInfo</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty MSSQLConnectionInfo)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1451"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.Backends.MSSQL.Connection.html#MSSQLConnectionInfo"><span class="hs-identifier hs-type">MSSQLConnectionInfo</span></a></span><span> </span><span id="local-6989586621691175145"><span class="annot"><span class="annottext">InputConnectionString
</span><a href="#local-6989586621691175145"><span class="hs-identifier hs-var">iConnString</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Backends.MSSQL.Connection.html#MSSQLPoolSettings"><span class="hs-identifier hs-type">MSSQLPoolSettings</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621691175141"><span id="local-6989586621691175142"><span id="local-6989586621691175143"><span class="annot"><span class="annottext">Int
Maybe Int
_mpsIdleTimeout :: MSSQLPoolSettings -&gt; Int
_mpsTotalMaxConnections :: MSSQLPoolSettings -&gt; Maybe Int
_mpsMaxConnections :: MSSQLPoolSettings -&gt; Maybe Int
_mpsIdleTimeout :: Int
_mpsTotalMaxConnections :: Maybe Int
_mpsMaxConnections :: Maybe Int
</span><a href="Hasura.Backends.MSSQL.Connection.html#_mpsIdleTimeout"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MSSQLConnectionInfo
</span><a href="#local-6989586621691175147"><span class="hs-identifier hs-var">connInfo</span></a></span><span>
</span><span id="line-1452"></span><span>      </span><span id="local-6989586621691175137"><span class="annot"><span class="annottext">connOptions :: ConnectionOptions
</span><a href="#local-6989586621691175137"><span class="hs-identifier hs-var hs-var">connOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1453"></span><span>        </span><span class="annot"><a href="Database.MSSQL.Pool.html#ConnectionOptions"><span class="hs-identifier hs-type">MSPool.ConnectionOptions</span></a></span><span>
</span><span id="line-1454"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_coConnections :: Int
</span><a href="Database.MSSQL.Pool.html#_coConnections"><span class="hs-identifier hs-var">_coConnections</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Hasura.Backends.MSSQL.Connection.html#defaultMSSQLMaxConnections"><span class="hs-identifier hs-var">defaultMSSQLMaxConnections</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621691175143"><span class="hs-identifier hs-var">_mpsMaxConnections</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1455"></span><span>            </span><span class="annot"><span class="annottext">_coStripes :: Int
</span><a href="Database.MSSQL.Pool.html#_coStripes"><span class="hs-identifier hs-var">_coStripes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span>
</span><span id="line-1456"></span><span>            </span><span class="annot"><span class="annottext">_coIdleTime :: Int
</span><a href="Database.MSSQL.Pool.html#_coIdleTime"><span class="hs-identifier hs-var">_coIdleTime</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621691175141"><span class="hs-identifier hs-var">_mpsIdleTimeout</span></a></span><span>
</span><span id="line-1457"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-1458"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621691175131"><span class="annot"><span class="annottext">ConnectionString
</span><a href="#local-6989586621691175131"><span class="hs-identifier hs-var">connString</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621691175130"><span class="annot"><span class="annottext">MSSQLPool
</span><a href="#local-6989586621691175130"><span class="hs-identifier hs-var">mssqlPool</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(MonadIO m, QErrM m) =&gt;
InputConnectionString
-&gt; ConnectionOptions
-&gt; Environment
-&gt; m (ConnectionString, MSSQLPool)
</span><a href="Hasura.Backends.MSSQL.Connection.html#createMSSQLPool"><span class="hs-identifier hs-var">createMSSQLPool</span></a></span><span> </span><span class="annot"><span class="annottext">InputConnectionString
</span><a href="#local-6989586621691175145"><span class="hs-identifier hs-var">iConnString</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionOptions
</span><a href="#local-6989586621691175137"><span class="hs-identifier hs-var">connOptions</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621691175150"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1459"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621691175128"><span class="annot"><span class="annottext">mssqlExecCtx :: MSSQLExecCtx
</span><a href="#local-6989586621691175128"><span class="hs-identifier hs-var hs-var">mssqlExecCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MSSQLPool -&gt; ResizePoolStrategy -&gt; MSSQLExecCtx
</span><a href="Hasura.Backends.MSSQL.Connection.html#mkMSSQLExecCtx"><span class="hs-identifier hs-var">mkMSSQLExecCtx</span></a></span><span> </span><span class="annot"><span class="annottext">MSSQLPool
</span><a href="#local-6989586621691175130"><span class="hs-identifier hs-var">mssqlPool</span></a></span><span> </span><span class="annot"><span class="annottext">ResizePoolStrategy
</span><a href="Hasura.RQL.Types.ResizePool.html#NeverResizePool"><span class="hs-identifier hs-var">NeverResizePool</span></a></span><span>
</span><span id="line-1460"></span><span>      </span><span id="local-6989586621691175125"><span class="annot"><span class="annottext">numReadReplicas :: Int
</span><a href="#local-6989586621691175125"><span class="hs-identifier hs-var hs-var">numReadReplicas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1461"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionString -&gt; MSSQLExecCtx -&gt; Int -&gt; MSSQLSourceConfig
</span><a href="Hasura.Backends.MSSQL.Connection.html#MSSQLSourceConfig"><span class="hs-identifier hs-var">MSSQLSourceConfig</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionString
</span><a href="#local-6989586621691175131"><span class="hs-identifier hs-var">connString</span></a></span><span> </span><span class="annot"><span class="annottext">MSSQLExecCtx
</span><a href="#local-6989586621691175128"><span class="hs-identifier hs-var">mssqlExecCtx</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621691175125"><span class="hs-identifier hs-var">numReadReplicas</span></a></span><span>
</span><span id="line-1462"></span></pre></body></html>