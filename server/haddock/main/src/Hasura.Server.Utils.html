<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE TemplateHaskellQuotes #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.Server.Utils</span><span>
</span><span id="line-4"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Server.Utils.html#APIVersion"><span class="hs-identifier">APIVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-5"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#DeprecatedEnvVars"><span class="hs-identifier">DeprecatedEnvVars</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#EnvVarsMovedToMetadata"><span class="hs-identifier">EnvVarsMovedToMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#adminSecretHeader"><span class="hs-identifier">adminSecretHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#commonClientHeadersIgnored"><span class="hs-identifier">commonClientHeadersIgnored</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#cryptoHash"><span class="hs-identifier">cryptoHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#deprecatedAccessKeyHeader"><span class="hs-identifier">deprecatedAccessKeyHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#deprecatedEnvVars"><span class="hs-identifier">deprecatedEnvVars</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#englishList"><span class="hs-identifier">englishList</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#envVarsMovedToMetadata"><span class="hs-identifier">envVarsMovedToMetadata</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#executeJSONPath"><span class="hs-identifier">executeJSONPath</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#filterHeaders"><span class="hs-identifier">filterHeaders</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#fmapL"><span class="hs-identifier">fmapL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#generateFingerprint"><span class="hs-identifier">generateFingerprint</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#getRequestHeader"><span class="hs-identifier">getRequestHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#gzipHeader"><span class="hs-identifier">gzipHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#httpExceptToJSON"><span class="hs-identifier">httpExceptToJSON</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#isReqUserId"><span class="hs-identifier">isReqUserId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#isSessionVariable"><span class="hs-identifier">isSessionVariable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#jsonHeader"><span class="hs-identifier">jsonHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#makeReasonMessage"><span class="hs-identifier">makeReasonMessage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#mkClientHeadersForward"><span class="hs-identifier">mkClientHeadersForward</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#mkSetCookieHeaders"><span class="hs-identifier">mkSetCookieHeaders</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#parseConnLifeTime"><span class="hs-identifier">parseConnLifeTime</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#parseStringAsBool"><span class="hs-identifier">parseStringAsBool</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#quoteRegex"><span class="hs-identifier">quoteRegex</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#readIsoLevel"><span class="hs-identifier">readIsoLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#redactSensitiveHeader"><span class="hs-identifier">redactSensitiveHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#requestIdHeader"><span class="hs-identifier">requestIdHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#sqlHeader"><span class="hs-identifier">sqlHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#htmlHeader"><span class="hs-identifier">htmlHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#useBackendOnlyPermissionsHeader"><span class="hs-identifier">useBackendOnlyPermissionsHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#userIdHeader"><span class="hs-identifier">userIdHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#userRoleHeader"><span class="hs-identifier">userRoleHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><a href="Hasura.Server.Utils.html#sessionVariablePrefix"><span class="hs-identifier">sessionVariablePrefix</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">where</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(^..)</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Crypto.Hash</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Crypto</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">J</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.Internal</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteArray</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">convert</span></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Base16</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Base16</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.CaseInsensitive</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CI</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashSet</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Text.Extended.html"><span class="hs-identifier">Data.Text.Extended</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Time</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.UUID</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UUID</span></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.UUID.V4</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UUID</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Database.PG.Query</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Q</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Base.Instances.html"><span class="hs-identifier">Hasura.Base.Instances</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Prelude.html"><span class="hs-identifier">Hasura.Prelude</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Syntax</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Q</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TExp</span></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Client</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HC</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Types</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HTTP</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wreq</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Wreq</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Regex.TDFA</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TDFA</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Regex.TDFA.ReadRegex</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TDFA</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Regex.TDFA.TDFA</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TDFA</span></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="annot"><a href="Hasura.Server.Utils.html#jsonHeader"><span class="hs-identifier hs-type">jsonHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.Header</span></span><span>
</span><span id="line-73"></span><span id="jsonHeader"><span class="annot"><span class="annottext">jsonHeader :: Header
</span><a href="Hasura.Server.Utils.html#jsonHeader"><span class="hs-identifier hs-var hs-var">jsonHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Content-Type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;application/json; charset=utf-8&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="annot"><a href="Hasura.Server.Utils.html#sqlHeader"><span class="hs-identifier hs-type">sqlHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.Header</span></span><span>
</span><span id="line-76"></span><span id="sqlHeader"><span class="annot"><span class="annottext">sqlHeader :: Header
</span><a href="Hasura.Server.Utils.html#sqlHeader"><span class="hs-identifier hs-var hs-var">sqlHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Content-Type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;application/sql; charset=utf-8&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="annot"><a href="Hasura.Server.Utils.html#htmlHeader"><span class="hs-identifier hs-type">htmlHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.Header</span></span><span>
</span><span id="line-79"></span><span id="htmlHeader"><span class="annot"><span class="annottext">htmlHeader :: Header
</span><a href="Hasura.Server.Utils.html#htmlHeader"><span class="hs-identifier hs-var hs-var">htmlHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Content-Type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;text/html; charset=utf-8&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="annot"><a href="Hasura.Server.Utils.html#gzipHeader"><span class="hs-identifier hs-type">gzipHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.Header</span></span><span>
</span><span id="line-82"></span><span id="gzipHeader"><span class="annot"><span class="annottext">gzipHeader :: Header
</span><a href="Hasura.Server.Utils.html#gzipHeader"><span class="hs-identifier hs-var hs-var">gzipHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Content-Encoding&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;gzip&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span id="local-6989586621688923313"><span class="annot"><a href="Hasura.Server.Utils.html#userRoleHeader"><span class="hs-identifier hs-type">userRoleHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsString</span></span><span> </span><span class="annot"><a href="#local-6989586621688923313"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688923313"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-85"></span><span id="userRoleHeader"><span class="annot"><span class="annottext">userRoleHeader :: a
</span><a href="Hasura.Server.Utils.html#userRoleHeader"><span class="hs-identifier hs-var hs-var">userRoleHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;x-hasura-role&quot;</span></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span id="local-6989586621688923312"><span class="annot"><a href="Hasura.Server.Utils.html#deprecatedAccessKeyHeader"><span class="hs-identifier hs-type">deprecatedAccessKeyHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsString</span></span><span> </span><span class="annot"><a href="#local-6989586621688923312"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688923312"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-88"></span><span id="deprecatedAccessKeyHeader"><span class="annot"><span class="annottext">deprecatedAccessKeyHeader :: a
</span><a href="Hasura.Server.Utils.html#deprecatedAccessKeyHeader"><span class="hs-identifier hs-var hs-var">deprecatedAccessKeyHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;x-hasura-access-key&quot;</span></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span id="local-6989586621688923311"><span class="annot"><a href="Hasura.Server.Utils.html#adminSecretHeader"><span class="hs-identifier hs-type">adminSecretHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsString</span></span><span> </span><span class="annot"><a href="#local-6989586621688923311"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688923311"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-91"></span><span id="adminSecretHeader"><span class="annot"><span class="annottext">adminSecretHeader :: a
</span><a href="Hasura.Server.Utils.html#adminSecretHeader"><span class="hs-identifier hs-var hs-var">adminSecretHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;x-hasura-admin-secret&quot;</span></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span id="local-6989586621688923310"><span class="annot"><a href="Hasura.Server.Utils.html#userIdHeader"><span class="hs-identifier hs-type">userIdHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsString</span></span><span> </span><span class="annot"><a href="#local-6989586621688923310"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688923310"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-94"></span><span id="userIdHeader"><span class="annot"><span class="annottext">userIdHeader :: a
</span><a href="Hasura.Server.Utils.html#userIdHeader"><span class="hs-identifier hs-var hs-var">userIdHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;x-hasura-user-id&quot;</span></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span id="local-6989586621688923309"><span class="annot"><a href="Hasura.Server.Utils.html#requestIdHeader"><span class="hs-identifier hs-type">requestIdHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsString</span></span><span> </span><span class="annot"><a href="#local-6989586621688923309"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688923309"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-97"></span><span id="requestIdHeader"><span class="annot"><span class="annottext">requestIdHeader :: a
</span><a href="Hasura.Server.Utils.html#requestIdHeader"><span class="hs-identifier hs-var hs-var">requestIdHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;x-request-id&quot;</span></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span id="local-6989586621688923308"><span class="annot"><a href="Hasura.Server.Utils.html#useBackendOnlyPermissionsHeader"><span class="hs-identifier hs-type">useBackendOnlyPermissionsHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsString</span></span><span> </span><span class="annot"><a href="#local-6989586621688923308"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688923308"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-100"></span><span id="useBackendOnlyPermissionsHeader"><span class="annot"><span class="annottext">useBackendOnlyPermissionsHeader :: a
</span><a href="Hasura.Server.Utils.html#useBackendOnlyPermissionsHeader"><span class="hs-identifier hs-var hs-var">useBackendOnlyPermissionsHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;x-hasura-use-backend-only-permissions&quot;</span></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="annot"><a href="Hasura.Server.Utils.html#getRequestHeader"><span class="hs-identifier hs-type">getRequestHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.HeaderName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HTTP.Header</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-103"></span><span id="getRequestHeader"><span class="annot"><span class="annottext">getRequestHeader :: HeaderName -&gt; [Header] -&gt; Maybe ByteString
</span><a href="Hasura.Server.Utils.html#getRequestHeader"><span class="hs-identifier hs-var hs-var">getRequestHeader</span></a></span></span><span> </span><span id="local-6989586621688923307"><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621688923307"><span class="hs-identifier hs-var">hdrName</span></a></span></span><span> </span><span id="local-6989586621688923306"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621688923306"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Header -&gt; ByteString
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(Header -&gt; ByteString) -&gt; Maybe Header -&gt; Maybe ByteString
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Header
</span><a href="#local-6989586621688923304"><span class="hs-identifier hs-var">mHeader</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-105"></span><span>    </span><span id="local-6989586621688923304"><span class="annot"><span class="annottext">mHeader :: Maybe Header
</span><a href="#local-6989586621688923304"><span class="hs-identifier hs-var hs-var">mHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Header -&gt; Bool) -&gt; [Header] -&gt; Maybe Header
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621688923302"><span class="annot"><span class="annottext">Header
</span><a href="#local-6989586621688923302"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Header -&gt; HeaderName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">Header
</span><a href="#local-6989586621688923302"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderName -&gt; HeaderName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621688923307"><span class="hs-identifier hs-var">hdrName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621688923306"><span class="hs-identifier hs-var">hdrs</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="annot"><a href="Hasura.Server.Utils.html#parseStringAsBool"><span class="hs-identifier hs-type">parseStringAsBool</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-108"></span><span id="parseStringAsBool"><span class="annot"><span class="annottext">parseStringAsBool :: String -&gt; Either String Bool
</span><a href="Hasura.Server.Utils.html#parseStringAsBool"><span class="hs-identifier hs-var hs-var">parseStringAsBool</span></a></span></span><span> </span><span id="local-6989586621688923301"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621688923301"><span class="hs-identifier hs-var">t</span></a></span></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Char) -&gt; String -&gt; String
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char
</span><span class="hs-identifier hs-var">toLower</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621688923301"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621688923298"><span class="hs-identifier hs-var">truthVals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Either String Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Char) -&gt; String -&gt; String
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char
</span><span class="hs-identifier hs-var">toLower</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621688923301"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621688923297"><span class="hs-identifier hs-var">falseVals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Either String Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Either String Bool
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621688923296"><span class="hs-identifier hs-var">errMsg</span></a></span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-113"></span><span>    </span><span id="local-6989586621688923298"><span class="annot"><span class="annottext">truthVals :: [String]
</span><a href="#local-6989586621688923298"><span class="hs-identifier hs-var hs-var">truthVals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;true&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;yes&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;y&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-114"></span><span>    </span><span id="local-6989586621688923297"><span class="annot"><span class="annottext">falseVals :: [String]
</span><a href="#local-6989586621688923297"><span class="hs-identifier hs-var hs-var">falseVals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;false&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;f&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;no&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;n&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span>    </span><span id="local-6989586621688923296"><span class="annot"><span class="annottext">errMsg :: String
</span><a href="#local-6989586621688923296"><span class="hs-identifier hs-var hs-var">errMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-117"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; Not a valid boolean text. &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;True values are &quot;</span></span><span>
</span><span id="line-118"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621688923298"><span class="hs-identifier hs-var">truthVals</span></a></span><span>
</span><span id="line-119"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; and  False values are &quot;</span></span><span>
</span><span id="line-120"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621688923297"><span class="hs-identifier hs-var">falseVals</span></a></span><span>
</span><span id="line-121"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;. All values are case insensitive&quot;</span></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-comment">{- NOTE: Something like this is not safe in the presence of caching. The only
    way for metaprogramming to depend on some external data and recompile
    properly is via addDependentFile and to include that file in the
    extra-source-files in the cabal file (see: https://github.com/haskell/cabal/issues/4746).
    Leaving this here commented in order to document that fact and also in case
    there's a way forward in the future.

-- Run a shell script during compile time
runScript :: FilePath -&gt; Q (TExp String)
runScript file = do
  fp &lt;- makeRelativeToProject file
  TH.addDependentFile fp
  fileContent &lt;- TH.runIO $ TI.readFile fp
  (exitCode, stdOut, stdErr) &lt;-
    TH.runIO $
      readProcessWithExitCode &quot;/bin/sh&quot; [] $ T.unpack fileContent
  when (exitCode /= ExitSuccess) $
    fail $
      &quot;Running shell script &quot; ++ fp ++ &quot; failed with exit code : &quot;
        ++ show exitCode
        ++ &quot; and with error : &quot;
        ++ stdErr
  [||stdOut||]
-}</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-comment">-- | Quotes a regex using Template Haskell so syntax errors can be reported at compile-time.</span><span>
</span><span id="line-149"></span><span class="annot"><a href="Hasura.Server.Utils.html#quoteRegex"><span class="hs-identifier hs-type">quoteRegex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TDFA.CompOption</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TDFA.ExecOption</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TExp</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TDFA.Regex</span></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span id="quoteRegex"><span class="annot"><span class="annottext">quoteRegex :: CompOption -&gt; ExecOption -&gt; String -&gt; Q (TExp Regex)
</span><a href="Hasura.Server.Utils.html#quoteRegex"><span class="hs-identifier hs-var hs-var">quoteRegex</span></a></span></span><span> </span><span id="local-6989586621688923294"><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621688923294"><span class="hs-identifier hs-var">compOption</span></a></span></span><span> </span><span id="local-6989586621688923293"><span class="annot"><span class="annottext">ExecOption
</span><a href="#local-6989586621688923293"><span class="hs-identifier hs-var">execOption</span></a></span></span><span> </span><span id="local-6989586621688923292"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621688923292"><span class="hs-identifier hs-var">regexText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-151"></span><span>  </span><span id="local-6989586621688923291"><span class="annot"><span class="annottext">(Pattern, (GroupIndex, DoPa))
</span><a href="#local-6989586621688923291"><span class="hs-identifier hs-var">regex</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Either ParseError (Pattern, (GroupIndex, DoPa))
</span><span class="hs-identifier hs-var">TDFA.parseRegex</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621688923292"><span class="hs-identifier hs-var">regexText</span></a></span><span> </span><span class="annot"><span class="annottext">Either ParseError (Pattern, (GroupIndex, DoPa))
-&gt; (ParseError -&gt; Q (Pattern, (GroupIndex, DoPa)))
-&gt; Q (Pattern, (GroupIndex, DoPa))
forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="Hasura.Prelude.html#onLeft"><span class="hs-operator hs-var">`onLeft`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Q (Pattern, (GroupIndex, DoPa))
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Q (Pattern, (GroupIndex, DoPa)))
-&gt; (ParseError -&gt; String)
-&gt; ParseError
-&gt; Q (Pattern, (GroupIndex, DoPa))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ParseError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-special">[||</span><span class="hs-identifier">TDFA.patternToRegex</span><span> </span><span class="hs-identifier">regex</span><span> </span><span class="hs-identifier">compOption</span><span> </span><span class="hs-identifier">execOption</span><span class="hs-special">||]</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span id="local-6989586621688923285"><span id="local-6989586621688923286"><span id="local-6989586621688923287"><span class="annot"><a href="Hasura.Server.Utils.html#fmapL"><span class="hs-identifier hs-type">fmapL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621688923287"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688923286"><span class="hs-identifier hs-type">a'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621688923287"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688923285"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621688923286"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688923285"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-155"></span><span id="fmapL"><span class="annot"><span class="annottext">fmapL :: (a -&gt; a') -&gt; Either a b -&gt; Either a' b
</span><a href="Hasura.Server.Utils.html#fmapL"><span class="hs-identifier hs-var hs-var">fmapL</span></a></span></span><span> </span><span id="local-6989586621688923284"><span class="annot"><span class="annottext">a -&gt; a'
</span><a href="#local-6989586621688923284"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621688923283"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688923283"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a' -&gt; Either a' b
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a'
</span><a href="#local-6989586621688923284"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688923283"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span class="annot"><a href="Hasura.Server.Utils.html#fmapL"><span class="hs-identifier hs-var">fmapL</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a'
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621688923282"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621688923282"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b -&gt; Either a' b
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621688923282"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="annot"><a href="Hasura.Server.Utils.html#generateFingerprint"><span class="hs-identifier hs-type">generateFingerprint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-159"></span><span id="generateFingerprint"><span class="annot"><span class="annottext">generateFingerprint :: IO Text
</span><a href="Hasura.Server.Utils.html#generateFingerprint"><span class="hs-identifier hs-var hs-var">generateFingerprint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UUID -&gt; Text
</span><span class="hs-identifier hs-var">UUID.toText</span></span><span> </span><span class="annot"><span class="annottext">(UUID -&gt; Text) -&gt; IO UUID -&gt; IO Text
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO UUID
</span><span class="hs-identifier hs-var">UUID.nextRandom</span></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-comment">-- json representation of HTTP exception</span><span>
</span><span id="line-162"></span><span class="annot"><a href="Hasura.Server.Utils.html#httpExceptToJSON"><span class="hs-identifier hs-type">httpExceptToJSON</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HC.HttpException</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-163"></span><span id="httpExceptToJSON"><span class="annot"><span class="annottext">httpExceptToJSON :: HttpException -&gt; Value
</span><a href="Hasura.Server.Utils.html#httpExceptToJSON"><span class="hs-identifier hs-var hs-var">httpExceptToJSON</span></a></span></span><span> </span><span id="local-6989586621688923279"><span class="annot"><span class="annottext">HttpException
</span><a href="#local-6989586621688923279"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HttpException
</span><a href="#local-6989586621688923279"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HC.HttpExceptionRequest</span></span><span> </span><span id="local-6989586621688923277"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621688923277"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621688923276"><span class="annot"><span class="annottext">HttpExceptionContent
</span><a href="#local-6989586621688923276"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688923275"><span class="annot"><span class="annottext">reqObj :: Value
</span><a href="#local-6989586621688923275"><span class="hs-identifier hs-var hs-var">reqObj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-166"></span><span>          </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">object</span></span><span>
</span><span id="line-167"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;host&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="Hasura.Prelude.html#bsToTxt"><span class="hs-identifier hs-var">bsToTxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; ByteString
</span><span class="hs-identifier hs-var hs-var">HC.host</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621688923277"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-168"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;port&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; GroupIndex
</span><span class="hs-identifier hs-var hs-var">HC.port</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621688923277"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-169"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;secure&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; Bool
</span><span class="hs-identifier hs-var hs-var">HC.secure</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621688923277"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-170"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;path&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="Hasura.Prelude.html#bsToTxt"><span class="hs-identifier hs-var">bsToTxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; ByteString
</span><span class="hs-identifier hs-var hs-var">HC.path</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621688923277"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-171"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;method&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="Hasura.Prelude.html#bsToTxt"><span class="hs-identifier hs-var">bsToTxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; ByteString
</span><span class="hs-identifier hs-var hs-var">HC.method</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621688923277"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-172"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;proxy&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy -&gt; Text
</span><a href="#local-6989586621688923266"><span class="hs-identifier hs-var">showProxy</span></a></span><span> </span><span class="annot"><span class="annottext">(Proxy -&gt; Text) -&gt; Maybe Proxy -&gt; Maybe Text
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; Maybe Proxy
</span><span class="hs-identifier hs-var hs-var">HC.proxy</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621688923277"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-173"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;redirectCount&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; GroupIndex
</span><span class="hs-identifier hs-var hs-var">HC.redirectCount</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621688923277"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-174"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;responseTimeout&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">ResponseTimeout -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; ResponseTimeout
</span><span class="hs-identifier hs-var hs-var">HC.responseTimeout</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621688923277"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-175"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;requestVersion&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">HttpVersion -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; HttpVersion
</span><span class="hs-identifier hs-var hs-var">HC.requestVersion</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621688923277"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-177"></span><span>        </span><span id="local-6989586621688923261"><span class="annot"><span class="annottext">msg :: String
</span><a href="#local-6989586621688923261"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HttpExceptionContent -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">HttpExceptionContent
</span><a href="#local-6989586621688923276"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-178"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">object</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;request&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621688923275"><span class="hs-identifier hs-var">reqObj</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;message&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621688923261"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-179"></span><span>  </span><span class="annot"><span class="annottext">HttpException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Value) -&gt; String -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HttpException -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">HttpException
</span><a href="#local-6989586621688923279"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621688923266"><span class="annot"><span class="annottext">showProxy :: Proxy -&gt; Text
</span><a href="#local-6989586621688923266"><span class="hs-identifier hs-var hs-var">showProxy</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HC.Proxy</span></span><span> </span><span id="local-6989586621688923258"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621688923258"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621688923257"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621688923257"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-182"></span><span>      </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;host: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="Hasura.Prelude.html#bsToTxt"><span class="hs-identifier hs-var">bsToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621688923258"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; port: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><a href="Hasura.Prelude.html#tshow"><span class="hs-identifier hs-var">tshow</span></a></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621688923257"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="hs-comment">-- ignore the following request headers from the client</span><span>
</span><span id="line-185"></span><span id="local-6989586621688923395"><span class="annot"><a href="Hasura.Server.Utils.html#commonClientHeadersIgnored"><span class="hs-identifier hs-type">commonClientHeadersIgnored</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IsString</span></span><span> </span><span class="annot"><a href="#local-6989586621688923395"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621688923395"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-186"></span><span id="commonClientHeadersIgnored"><span class="annot"><span class="annottext">commonClientHeadersIgnored :: [a]
</span><a href="Hasura.Server.Utils.html#commonClientHeadersIgnored"><span class="hs-identifier hs-var hs-var">commonClientHeadersIgnored</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;Content-Length&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;Content-MD5&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;User-Agent&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;Host&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;Origin&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;Referer&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-193"></span><span>    </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;Accept&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;Accept-Encoding&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-195"></span><span>    </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;Accept-Language&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;Accept-Datetime&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;Cache-Control&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;Connection&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;DNT&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-200"></span><span>    </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;Content-Type&quot;</span></span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="annot"><a href="Hasura.Server.Utils.html#sessionVariablePrefix"><span class="hs-identifier hs-type">sessionVariablePrefix</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-204"></span><span id="sessionVariablePrefix"><span class="annot"><span class="annottext">sessionVariablePrefix :: Text
</span><a href="Hasura.Server.Utils.html#sessionVariablePrefix"><span class="hs-identifier hs-var hs-var">sessionVariablePrefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;x-hasura-&quot;</span></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="annot"><a href="Hasura.Server.Utils.html#isSessionVariable"><span class="hs-identifier hs-type">isSessionVariable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-207"></span><span id="isSessionVariable"><span class="annot"><span class="annottext">isSessionVariable :: Text -&gt; Bool
</span><a href="Hasura.Server.Utils.html#isSessionVariable"><span class="hs-identifier hs-var hs-var">isSessionVariable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><span class="hs-identifier hs-var">T.isPrefixOf</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Hasura.Server.Utils.html#sessionVariablePrefix"><span class="hs-identifier hs-var">sessionVariablePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Bool) -&gt; (Text -&gt; Text) -&gt; Text -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">T.toLower</span></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="annot"><a href="Hasura.Server.Utils.html#isReqUserId"><span class="hs-identifier hs-type">isReqUserId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-210"></span><span id="isReqUserId"><span class="annot"><span class="annottext">isReqUserId :: Text -&gt; Bool
</span><a href="Hasura.Server.Utils.html#isReqUserId"><span class="hs-identifier hs-var hs-var">isReqUserId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;req_user_id&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Bool) -&gt; (Text -&gt; Text) -&gt; Text -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">T.toLower</span></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="annot"><a href="Hasura.Server.Utils.html#mkClientHeadersForward"><span class="hs-identifier hs-type">mkClientHeadersForward</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HTTP.Header</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HTTP.Header</span></span><span class="hs-special">]</span><span>
</span><span id="line-213"></span><span id="mkClientHeadersForward"><span class="annot"><span class="annottext">mkClientHeadersForward :: [Header] -&gt; [Header]
</span><a href="Hasura.Server.Utils.html#mkClientHeadersForward"><span class="hs-identifier hs-var hs-var">mkClientHeadersForward</span></a></span></span><span> </span><span id="local-6989586621688923253"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621688923253"><span class="hs-identifier hs-var">reqHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-214"></span><span>  </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621688923252"><span class="hs-identifier hs-var">xForwardedHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; [Header] -&gt; [Header]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Header] -&gt; [Header]
forall b. [(HeaderName, b)] -&gt; [(HeaderName, b)]
</span><a href="#local-6989586621688923251"><span class="hs-identifier hs-var">filterSessionVariables</span></a></span><span> </span><span class="annot"><span class="annottext">([Header] -&gt; [Header])
-&gt; ([Header] -&gt; [Header]) -&gt; [Header] -&gt; [Header]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; [Header]
</span><a href="Hasura.Server.Utils.html#filterRequestHeaders"><span class="hs-identifier hs-var">filterRequestHeaders</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621688923253"><span class="hs-identifier hs-var">reqHeaders</span></a></span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-216"></span><span>    </span><span id="local-6989586621688923251"><span class="annot"><span class="annottext">filterSessionVariables :: [(HeaderName, b)] -&gt; [(HeaderName, b)]
</span><a href="#local-6989586621688923251"><span class="hs-identifier hs-var hs-var">filterSessionVariables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((HeaderName, b) -&gt; Bool) -&gt; [(HeaderName, b)] -&gt; [(HeaderName, b)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621688923249"><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621688923249"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><a href="Hasura.Server.Utils.html#isSessionVariable"><span class="hs-identifier hs-var">isSessionVariable</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Bool) -&gt; Text -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="Hasura.Prelude.html#bsToTxt"><span class="hs-identifier hs-var">bsToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Text) -&gt; ByteString -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HeaderName -&gt; ByteString
forall s. CI s -&gt; s
</span><span class="hs-identifier hs-var hs-var">CI.original</span></span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621688923249"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>    </span><span id="local-6989586621688923252"><span class="annot"><span class="annottext">xForwardedHeaders :: [Header]
</span><a href="#local-6989586621688923252"><span class="hs-identifier hs-var hs-var">xForwardedHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Header -&gt; Maybe Header) -&gt; [Header] -&gt; [Header])
-&gt; [Header] -&gt; (Header -&gt; Maybe Header) -&gt; [Header]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(Header -&gt; Maybe Header) -&gt; [Header] -&gt; [Header]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621688923253"><span class="hs-identifier hs-var">reqHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">((Header -&gt; Maybe Header) -&gt; [Header])
-&gt; (Header -&gt; Maybe Header) -&gt; [Header]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621688923244"><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621688923244"><span class="hs-identifier hs-var">hdrName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688923243"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621688923243"><span class="hs-identifier hs-var">hdrValue</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-218"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621688923244"><span class="hs-identifier hs-var">hdrName</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-219"></span><span>        </span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Host&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Header -&gt; Maybe Header
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;X-Forwarded-Host&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621688923243"><span class="hs-identifier hs-var">hdrValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>        </span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;User-Agent&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Header -&gt; Maybe Header
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;X-Forwarded-User-Agent&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621688923243"><span class="hs-identifier hs-var">hdrValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>        </span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Header
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span id="local-6989586621688923242"><span class="annot"><a href="Hasura.Server.Utils.html#mkSetCookieHeaders"><span class="hs-identifier hs-type">mkSetCookieHeaders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Wreq.Response</span></span><span> </span><span class="annot"><a href="#local-6989586621688923242"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.ResponseHeaders</span></span></span><span>
</span><span id="line-224"></span><span id="mkSetCookieHeaders"><span class="annot"><span class="annottext">mkSetCookieHeaders :: Response a -&gt; [Header]
</span><a href="Hasura.Server.Utils.html#mkSetCookieHeaders"><span class="hs-identifier hs-var hs-var">mkSetCookieHeaders</span></a></span></span><span> </span><span id="local-6989586621688923240"><span class="annot"><span class="annottext">Response a
</span><a href="#local-6989586621688923240"><span class="hs-identifier hs-var">resp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-225"></span><span>  </span><span class="annot"><span class="annottext">(ByteString -&gt; Header) -&gt; [ByteString] -&gt; [Header]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621688923239"><span class="hs-identifier hs-var">headerName</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; [Header]) -&gt; [ByteString] -&gt; [Header]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Response a
</span><a href="#local-6989586621688923240"><span class="hs-identifier hs-var">resp</span></a></span><span> </span><span class="annot"><span class="annottext">Response a
-&gt; Getting (Endo [ByteString]) (Response a) ByteString
-&gt; [ByteString]
forall s a. s -&gt; Getting (Endo [a]) s a -&gt; [a]
</span><span class="hs-operator hs-var">^..</span></span><span> </span><span class="annot"><span class="annottext">HeaderName -&gt; Traversal' (Response a) ByteString
forall body. HeaderName -&gt; Traversal' (Response body) ByteString
</span><span class="hs-identifier hs-var">Wreq.responseHeader</span></span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621688923239"><span class="hs-identifier hs-var">headerName</span></a></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-227"></span><span>    </span><span id="local-6989586621688923239"><span class="annot"><span class="annottext">headerName :: HeaderName
</span><a href="#local-6989586621688923239"><span class="hs-identifier hs-var hs-var">headerName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Set-Cookie&quot;</span></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="annot"><a href="Hasura.Server.Utils.html#filterRequestHeaders"><span class="hs-identifier hs-type">filterRequestHeaders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HTTP.Header</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HTTP.Header</span></span><span class="hs-special">]</span><span>
</span><span id="line-230"></span><span id="filterRequestHeaders"><span class="annot"><span class="annottext">filterRequestHeaders :: [Header] -&gt; [Header]
</span><a href="Hasura.Server.Utils.html#filterRequestHeaders"><span class="hs-identifier hs-var hs-var">filterRequestHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-231"></span><span>  </span><span class="annot"><span class="annottext">HashSet HeaderName -&gt; [Header] -&gt; [Header]
</span><a href="Hasura.Server.Utils.html#filterHeaders"><span class="hs-identifier hs-var">filterHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">(HashSet HeaderName -&gt; [Header] -&gt; [Header])
-&gt; HashSet HeaderName -&gt; [Header] -&gt; [Header]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[HeaderName] -&gt; HashSet HeaderName
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[HeaderName]
forall a. IsString a =&gt; [a]
</span><a href="Hasura.Server.Utils.html#commonClientHeadersIgnored"><span class="hs-identifier hs-var">commonClientHeadersIgnored</span></a></span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span class="annot"><a href="Hasura.Server.Utils.html#filterHeaders"><span class="hs-identifier hs-type">filterHeaders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.HashSet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.HeaderName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HTTP.Header</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HTTP.Header</span></span><span class="hs-special">]</span><span>
</span><span id="line-234"></span><span id="filterHeaders"><span class="annot"><span class="annottext">filterHeaders :: HashSet HeaderName -&gt; [Header] -&gt; [Header]
</span><a href="Hasura.Server.Utils.html#filterHeaders"><span class="hs-identifier hs-var hs-var">filterHeaders</span></a></span></span><span> </span><span id="local-6989586621688923236"><span class="annot"><span class="annottext">HashSet HeaderName
</span><a href="#local-6989586621688923236"><span class="hs-identifier hs-var">list</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Header -&gt; Bool) -&gt; [Header] -&gt; [Header]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621688923235"><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621688923235"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621688923235"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderName -&gt; HashSet HeaderName -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span> </span><span class="annot"><span class="annottext">HashSet HeaderName
</span><a href="#local-6989586621688923236"><span class="hs-identifier hs-var">list</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="hs-comment">-- | The version integer</span><span>
</span><span id="line-237"></span><span class="hs-keyword">data</span><span> </span><span id="APIVersion"><span class="annot"><a href="Hasura.Server.Utils.html#APIVersion"><span class="hs-identifier hs-var">APIVersion</span></a></span></span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="VIVersion1"><span class="annot"><a href="Hasura.Server.Utils.html#VIVersion1"><span class="hs-identifier hs-var">VIVersion1</span></a></span></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="VIVersion2"><span class="annot"><a href="Hasura.Server.Utils.html#VIVersion2"><span class="hs-identifier hs-var">VIVersion2</span></a></span></span><span>
</span><span id="line-240"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621688923226"><span id="local-6989586621688923228"><span id="local-6989586621688923230"><span class="annot"><span class="annottext">GroupIndex -&gt; APIVersion -&gt; String -&gt; String
[APIVersion] -&gt; String -&gt; String
APIVersion -&gt; String
(GroupIndex -&gt; APIVersion -&gt; String -&gt; String)
-&gt; (APIVersion -&gt; String)
-&gt; ([APIVersion] -&gt; String -&gt; String)
-&gt; Show APIVersion
forall a.
(GroupIndex -&gt; a -&gt; String -&gt; String)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; String -&gt; String) -&gt; Show a
showList :: [APIVersion] -&gt; String -&gt; String
$cshowList :: [APIVersion] -&gt; String -&gt; String
show :: APIVersion -&gt; String
$cshow :: APIVersion -&gt; String
showsPrec :: GroupIndex -&gt; APIVersion -&gt; String -&gt; String
$cshowsPrec :: GroupIndex -&gt; APIVersion -&gt; String -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688923221"><span id="local-6989586621688923223"><span class="annot"><span class="annottext">APIVersion -&gt; APIVersion -&gt; Bool
(APIVersion -&gt; APIVersion -&gt; Bool)
-&gt; (APIVersion -&gt; APIVersion -&gt; Bool) -&gt; Eq APIVersion
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: APIVersion -&gt; APIVersion -&gt; Bool
$c/= :: APIVersion -&gt; APIVersion -&gt; Bool
== :: APIVersion -&gt; APIVersion -&gt; Bool
$c== :: APIVersion -&gt; APIVersion -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621688923213"><span id="local-6989586621688923215"><span id="local-6989586621688923217"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="Hasura.Server.Utils.html#APIVersion"><span class="hs-identifier hs-type">APIVersion</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-243"></span><span>  </span><span id="local-6989586621688923211"><span class="annot"><span class="annottext">toJSON :: APIVersion -&gt; Value
</span><a href="#local-6989586621688923211"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="annot"><span class="annottext">APIVersion
</span><a href="Hasura.Server.Utils.html#VIVersion1"><span class="hs-identifier hs-var">VIVersion1</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GroupIndex -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">1</span></span><span>
</span><span id="line-244"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">APIVersion
</span><a href="Hasura.Server.Utils.html#VIVersion2"><span class="hs-identifier hs-var">VIVersion2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GroupIndex -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">2</span></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621688923208"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="Hasura.Server.Utils.html#APIVersion"><span class="hs-identifier hs-type">APIVersion</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-247"></span><span>  </span><span id="local-6989586621688923206"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser APIVersion
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></span></span><span> </span><span id="local-6989586621688923204"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621688923204"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-248"></span><span>    </span><span id="local-6989586621688923203"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621688923203"><span class="hs-identifier hs-var">verInt</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Parser GroupIndex
forall a. FromJSON a =&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">parseJSON</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621688923204"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621688923203"><span class="hs-identifier hs-var">verInt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-250"></span><span>      </span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">APIVersion -&gt; Parser APIVersion
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">APIVersion
</span><a href="Hasura.Server.Utils.html#VIVersion1"><span class="hs-identifier hs-var">VIVersion1</span></a></span><span>
</span><span id="line-251"></span><span>      </span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">APIVersion -&gt; Parser APIVersion
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">APIVersion
</span><a href="Hasura.Server.Utils.html#VIVersion2"><span class="hs-identifier hs-var">VIVersion2</span></a></span><span>
</span><span id="line-252"></span><span>      </span><span id="local-6989586621688923202"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621688923202"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser APIVersion
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Parser APIVersion) -&gt; String -&gt; Parser APIVersion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;expected 1 or 2, encountered &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621688923202"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="annot"><a href="Hasura.Server.Utils.html#englishList"><span class="hs-identifier hs-type">englishList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-255"></span><span id="englishList"><span class="annot"><span class="annottext">englishList :: Text -&gt; NonEmpty Text -&gt; Text
</span><a href="Hasura.Server.Utils.html#englishList"><span class="hs-identifier hs-var hs-var">englishList</span></a></span></span><span> </span><span id="local-6989586621688923201"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688923201"><span class="hs-identifier hs-var">joiner</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-256"></span><span>  </span><span id="local-6989586621688923200"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688923200"><span class="hs-identifier hs-var">one</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688923200"><span class="hs-identifier hs-var">one</span></a></span><span>
</span><span id="line-257"></span><span>  </span><span id="local-6989586621688923198"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688923198"><span class="hs-identifier hs-var">one</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621688923197"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688923197"><span class="hs-identifier hs-var">two</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688923198"><span class="hs-identifier hs-var">one</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688923201"><span class="hs-identifier hs-var">joiner</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688923197"><span class="hs-identifier hs-var">two</span></a></span><span>
</span><span id="line-258"></span><span>  </span><span id="local-6989586621688923196"><span class="annot"><span class="annottext">NonEmpty Text
</span><a href="#local-6989586621688923196"><span class="hs-identifier hs-var">several</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688923195"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688923195"><span class="hs-identifier hs-var">final</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span id="local-6989586621688923194"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621688923194"><span class="hs-identifier hs-var">initials</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty Text -&gt; NonEmpty Text
forall a. NonEmpty a -&gt; NonEmpty a
</span><span class="hs-identifier hs-var">NE.reverse</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty Text
</span><a href="#local-6989586621688923196"><span class="hs-identifier hs-var">several</span></a></span><span>
</span><span id="line-260"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall t (f :: * -&gt; *). (ToTxt t, Foldable f) =&gt; f t -&gt; Text
</span><a href="Data.Text.Extended.html#commaSeparated"><span class="hs-identifier hs-var">commaSeparated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; [Text]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621688923194"><span class="hs-identifier hs-var">initials</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688923201"><span class="hs-identifier hs-var">joiner</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688923195"><span class="hs-identifier hs-var">final</span></a></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span id="local-6989586621688923190"><span class="annot"><a href="Hasura.Server.Utils.html#makeReasonMessage"><span class="hs-identifier hs-type">makeReasonMessage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621688923190"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621688923190"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span></span><span>
</span><span id="line-263"></span><span id="makeReasonMessage"><span class="annot"><span class="annottext">makeReasonMessage :: [a] -&gt; (a -&gt; Text) -&gt; Text
</span><a href="Hasura.Server.Utils.html#makeReasonMessage"><span class="hs-identifier hs-var hs-var">makeReasonMessage</span></a></span></span><span> </span><span id="local-6989586621688923189"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621688923189"><span class="hs-identifier hs-var">errors</span></a></span></span><span> </span><span id="local-6989586621688923188"><span class="annot"><span class="annottext">a -&gt; Text
</span><a href="#local-6989586621688923188"><span class="hs-identifier hs-var">showError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621688923189"><span class="hs-identifier hs-var">errors</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621688923187"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688923187"><span class="hs-identifier hs-var">singleError</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;because &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Text
</span><a href="#local-6989586621688923188"><span class="hs-identifier hs-var">showError</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688923187"><span class="hs-identifier hs-var">singleError</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-267"></span><span>      </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;for the following reasons:\n&quot;</span></span><span>
</span><span id="line-268"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.unlines</span></span><span>
</span><span id="line-269"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; Text) -&gt; [a] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;  &#8226; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (a -&gt; Text) -&gt; a -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Text
</span><a href="#local-6989586621688923188"><span class="hs-identifier hs-var">showError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621688923189"><span class="hs-identifier hs-var">errors</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="annot"><a href="Hasura.Server.Utils.html#executeJSONPath"><span class="hs-identifier hs-type">executeJSONPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">JSONPath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IResult</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-272"></span><span id="executeJSONPath"><span class="annot"><span class="annottext">executeJSONPath :: JSONPath -&gt; Value -&gt; IResult Value
</span><a href="Hasura.Server.Utils.html#executeJSONPath"><span class="hs-identifier hs-var hs-var">executeJSONPath</span></a></span></span><span> </span><span id="local-6989586621688923185"><span class="annot"><span class="annottext">JSONPath
</span><a href="#local-6989586621688923185"><span class="hs-identifier hs-var">jsonPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Parser Value) -&gt; Value -&gt; IResult Value
forall a b. (a -&gt; Parser b) -&gt; a -&gt; IResult b
</span><span class="hs-identifier hs-var">iparse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JSONPath -&gt; Value -&gt; Parser Value
</span><a href="#local-6989586621688923183"><span class="hs-identifier hs-var">valueParser</span></a></span><span> </span><span class="annot"><span class="annottext">JSONPath
</span><a href="#local-6989586621688923185"><span class="hs-identifier hs-var">jsonPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-274"></span><span>    </span><span id="local-6989586621688923183"><span class="annot"><span class="annottext">valueParser :: JSONPath -&gt; Value -&gt; Parser Value
</span><a href="#local-6989586621688923183"><span class="hs-identifier hs-var hs-var">valueParser</span></a></span></span><span> </span><span id="local-6989586621688923182"><span class="annot"><span class="annottext">JSONPath
</span><a href="#local-6989586621688923182"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621688923181"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621688923181"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">JSONPath
</span><a href="#local-6989586621688923182"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-275"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Parser Value
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621688923181"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-276"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621688923180"><span class="annot"><span class="annottext">JSONPathElement
</span><a href="#local-6989586621688923180"><span class="hs-identifier hs-var">pathElement</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621688923179"><span class="annot"><span class="annottext">JSONPath
</span><a href="#local-6989586621688923179"><span class="hs-identifier hs-var">remaining</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-277"></span><span>        </span><span class="annot"><span class="annottext">JSONPathElement -&gt; Value -&gt; Parser Value
</span><a href="#local-6989586621688923178"><span class="hs-identifier hs-var">parseWithPathElement</span></a></span><span> </span><span class="annot"><span class="annottext">JSONPathElement
</span><a href="#local-6989586621688923180"><span class="hs-identifier hs-var">pathElement</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621688923181"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-278"></span><span>          </span><span class="annot"><span class="annottext">Parser Value -&gt; (Value -&gt; Parser Value) -&gt; Parser Value
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Parser Value -&gt; JSONPathElement -&gt; Parser Value
forall a. Parser a -&gt; JSONPathElement -&gt; Parser a
</span><span class="hs-operator hs-var">&lt;?&gt;</span></span><span> </span><span class="annot"><span class="annottext">JSONPathElement
</span><a href="#local-6989586621688923180"><span class="hs-identifier hs-var">pathElement</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Parser Value -&gt; Parser Value)
-&gt; (Value -&gt; Parser Value) -&gt; Value -&gt; Parser Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">JSONPath -&gt; Value -&gt; Parser Value
</span><a href="#local-6989586621688923183"><span class="hs-identifier hs-var">valueParser</span></a></span><span> </span><span class="annot"><span class="annottext">JSONPath
</span><a href="#local-6989586621688923179"><span class="hs-identifier hs-var">remaining</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-280"></span><span>        </span><span id="local-6989586621688923178"><span class="annot"><span class="annottext">parseWithPathElement :: JSONPathElement -&gt; Value -&gt; Parser Value
</span><a href="#local-6989586621688923178"><span class="hs-identifier hs-var hs-var">parseWithPathElement</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-281"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Key</span></span><span> </span><span id="local-6989586621688923175"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688923175"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; (Object -&gt; Parser Value) -&gt; Value -&gt; Parser Value
forall a. String -&gt; (Object -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">withObject</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Object&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Object -&gt; Text -&gt; Parser Value
forall a. FromJSON a =&gt; Object -&gt; Text -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688923175"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Index</span></span><span> </span><span id="local-6989586621688923171"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621688923171"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-283"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; (Array -&gt; Parser Value) -&gt; Value -&gt; Parser Value
forall a. String -&gt; (Array -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">withArray</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Array&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Array -&gt; Parser Value) -&gt; Value -&gt; Parser Value)
-&gt; (Array -&gt; Parser Value) -&gt; Value -&gt; Parser Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-284"></span><span>              </span><span class="annot"><span class="annottext">Parser Value
-&gt; (Value -&gt; Parser Value) -&gt; Maybe Value -&gt; Parser Value
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Parser Value
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Array index out of range&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Parser Value
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Value -&gt; Parser Value)
-&gt; (Array -&gt; Maybe Value) -&gt; Array -&gt; Parser Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array -&gt; GroupIndex -&gt; Maybe Value
forall a. Vector a -&gt; GroupIndex -&gt; Maybe a
</span><span class="hs-operator hs-var">V.!?</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621688923171"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="annot"><a href="Hasura.Server.Utils.html#sha1"><span class="hs-identifier hs-type">sha1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-287"></span><span id="sha1"><span class="annot"><span class="annottext">sha1 :: ByteString -&gt; ByteString
</span><a href="Hasura.Server.Utils.html#sha1"><span class="hs-identifier hs-var hs-var">sha1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ByteArrayAccess (Digest SHA1), ByteArray ByteString) =&gt;
Digest SHA1 -&gt; ByteString
forall bin bout.
(ByteArrayAccess bin, ByteArray bout) =&gt;
bin -&gt; bout
</span><span class="hs-identifier hs-var">convert</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="annot"><span class="annottext">(Digest SHA1 -&gt; ByteString)
-&gt; (ByteString -&gt; Digest SHA1) -&gt; ByteString -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HashAlgorithm SHA1 =&gt; ByteString -&gt; Digest SHA1
forall a. HashAlgorithm a =&gt; ByteString -&gt; Digest a
</span><span class="hs-identifier hs-var">Crypto.hashlazy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Crypto.SHA1</span></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span id="local-6989586621688923165"><span class="annot"><a href="Hasura.Server.Utils.html#cryptoHash"><span class="hs-identifier hs-type">cryptoHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">J.ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621688923165"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688923165"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span></span><span>
</span><span id="line-290"></span><span id="cryptoHash"><span class="annot"><span class="annottext">cryptoHash :: a -&gt; ByteString
</span><a href="Hasura.Server.Utils.html#cryptoHash"><span class="hs-identifier hs-var hs-var">cryptoHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">Base16.encode</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; (a -&gt; ByteString) -&gt; a -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="Hasura.Server.Utils.html#sha1"><span class="hs-identifier hs-var">sha1</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; (a -&gt; ByteString) -&gt; a -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">J.encode</span></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="annot"><a href="Hasura.Server.Utils.html#readIsoLevel"><span class="hs-identifier hs-type">readIsoLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q.TxIsolation</span></span><span>
</span><span id="line-293"></span><span id="readIsoLevel"><span class="annot"><span class="annottext">readIsoLevel :: String -&gt; Either String TxIsolation
</span><a href="Hasura.Server.Utils.html#readIsoLevel"><span class="hs-identifier hs-var hs-var">readIsoLevel</span></a></span></span><span> </span><span id="local-6989586621688923162"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621688923162"><span class="hs-identifier hs-var">isoS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621688923162"><span class="hs-identifier hs-var">isoS</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-295"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;read-committed&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxIsolation -&gt; Either String TxIsolation
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TxIsolation
</span><span class="hs-identifier hs-var">Q.ReadCommitted</span></span><span>
</span><span id="line-296"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;repeatable-read&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxIsolation -&gt; Either String TxIsolation
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TxIsolation
</span><span class="hs-identifier hs-var">Q.RepeatableRead</span></span><span>
</span><span id="line-297"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;serializable&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxIsolation -&gt; Either String TxIsolation
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TxIsolation
</span><span class="hs-identifier hs-var">Q.Serializable</span></span><span>
</span><span id="line-298"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Either String TxIsolation
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Only expecting read-committed / repeatable-read / serializable&quot;</span></span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="annot"><a href="Hasura.Server.Utils.html#parseConnLifeTime"><span class="hs-identifier hs-type">parseConnLifeTime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NominalDiffTime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NominalDiffTime</span></span><span>
</span><span id="line-301"></span><span id="parseConnLifeTime"><span class="annot"><span class="annottext">parseConnLifeTime :: Maybe NominalDiffTime -&gt; Maybe NominalDiffTime
</span><a href="Hasura.Server.Utils.html#parseConnLifeTime"><span class="hs-identifier hs-var hs-var">parseConnLifeTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-302"></span><span>  </span><span class="annot"><span class="annottext">Maybe NominalDiffTime
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; Maybe NominalDiffTime
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><span class="hs-number">600</span></span><span> </span><span class="hs-comment">-- Not set by user; use the default timeout</span><span>
</span><span id="line-303"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe NominalDiffTime
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-comment">-- user wants to disable PG_CONN_LIFETIME</span><span>
</span><span id="line-304"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621688923158"><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621688923158"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; Maybe NominalDiffTime
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621688923158"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-comment">-- user specified n seconds lifetime</span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="hs-comment">-- | The environment variables that were moved to metadata. These environment</span><span>
</span><span id="line-307"></span><span class="hs-comment">-- variables are available if a v1 hasura project is run an v2 hasura server.</span><span>
</span><span id="line-308"></span><span class="hs-comment">-- These environment variables are marked as deprecated only when the v1 hasura</span><span>
</span><span id="line-309"></span><span class="hs-comment">-- project is migrated to v2 project.</span><span>
</span><span id="line-310"></span><span class="hs-keyword">newtype</span><span> </span><span id="EnvVarsMovedToMetadata"><span class="annot"><a href="Hasura.Server.Utils.html#EnvVarsMovedToMetadata"><span class="hs-identifier hs-var">EnvVarsMovedToMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="EnvVarsMovedToMetadata"><span class="annot"><a href="Hasura.Server.Utils.html#EnvVarsMovedToMetadata"><span class="hs-identifier hs-var">EnvVarsMovedToMetadata</span></a></span></span><span> </span><span class="hs-special">{</span><span id="unEnvVarsMovedToMetadata"><span class="annot"><span class="annottext">EnvVarsMovedToMetadata -&gt; [String]
</span><a href="Hasura.Server.Utils.html#unEnvVarsMovedToMetadata"><span class="hs-identifier hs-var hs-var">unEnvVarsMovedToMetadata</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621688923150"><span id="local-6989586621688923152"><span id="local-6989586621688923154"><span class="annot"><span class="annottext">GroupIndex -&gt; EnvVarsMovedToMetadata -&gt; String -&gt; String
[EnvVarsMovedToMetadata] -&gt; String -&gt; String
EnvVarsMovedToMetadata -&gt; String
(GroupIndex -&gt; EnvVarsMovedToMetadata -&gt; String -&gt; String)
-&gt; (EnvVarsMovedToMetadata -&gt; String)
-&gt; ([EnvVarsMovedToMetadata] -&gt; String -&gt; String)
-&gt; Show EnvVarsMovedToMetadata
forall a.
(GroupIndex -&gt; a -&gt; String -&gt; String)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; String -&gt; String) -&gt; Show a
showList :: [EnvVarsMovedToMetadata] -&gt; String -&gt; String
$cshowList :: [EnvVarsMovedToMetadata] -&gt; String -&gt; String
show :: EnvVarsMovedToMetadata -&gt; String
$cshow :: EnvVarsMovedToMetadata -&gt; String
showsPrec :: GroupIndex -&gt; EnvVarsMovedToMetadata -&gt; String -&gt; String
$cshowsPrec :: GroupIndex -&gt; EnvVarsMovedToMetadata -&gt; String -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span class="hs-comment">-- | These env vars are completely deprecated</span><span>
</span><span id="line-314"></span><span class="hs-keyword">newtype</span><span> </span><span id="DeprecatedEnvVars"><span class="annot"><a href="Hasura.Server.Utils.html#DeprecatedEnvVars"><span class="hs-identifier hs-var">DeprecatedEnvVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DeprecatedEnvVars"><span class="annot"><a href="Hasura.Server.Utils.html#DeprecatedEnvVars"><span class="hs-identifier hs-var">DeprecatedEnvVars</span></a></span></span><span> </span><span class="hs-special">{</span><span id="unDeprecatedEnvVars"><span class="annot"><span class="annottext">DeprecatedEnvVars -&gt; [String]
</span><a href="Hasura.Server.Utils.html#unDeprecatedEnvVars"><span class="hs-identifier hs-var hs-var">unDeprecatedEnvVars</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621688923142"><span id="local-6989586621688923144"><span id="local-6989586621688923146"><span class="annot"><span class="annottext">GroupIndex -&gt; DeprecatedEnvVars -&gt; String -&gt; String
[DeprecatedEnvVars] -&gt; String -&gt; String
DeprecatedEnvVars -&gt; String
(GroupIndex -&gt; DeprecatedEnvVars -&gt; String -&gt; String)
-&gt; (DeprecatedEnvVars -&gt; String)
-&gt; ([DeprecatedEnvVars] -&gt; String -&gt; String)
-&gt; Show DeprecatedEnvVars
forall a.
(GroupIndex -&gt; a -&gt; String -&gt; String)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; String -&gt; String) -&gt; Show a
showList :: [DeprecatedEnvVars] -&gt; String -&gt; String
$cshowList :: [DeprecatedEnvVars] -&gt; String -&gt; String
show :: DeprecatedEnvVars -&gt; String
$cshow :: DeprecatedEnvVars -&gt; String
showsPrec :: GroupIndex -&gt; DeprecatedEnvVars -&gt; String -&gt; String
$cshowsPrec :: GroupIndex -&gt; DeprecatedEnvVars -&gt; String -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span class="annot"><a href="Hasura.Server.Utils.html#envVarsMovedToMetadata"><span class="hs-identifier hs-type">envVarsMovedToMetadata</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Server.Utils.html#EnvVarsMovedToMetadata"><span class="hs-identifier hs-type">EnvVarsMovedToMetadata</span></a></span><span>
</span><span id="line-318"></span><span id="envVarsMovedToMetadata"><span class="annot"><span class="annottext">envVarsMovedToMetadata :: EnvVarsMovedToMetadata
</span><a href="Hasura.Server.Utils.html#envVarsMovedToMetadata"><span class="hs-identifier hs-var hs-var">envVarsMovedToMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-319"></span><span>  </span><span class="annot"><span class="annottext">[String] -&gt; EnvVarsMovedToMetadata
</span><a href="Hasura.Server.Utils.html#EnvVarsMovedToMetadata"><span class="hs-identifier hs-var">EnvVarsMovedToMetadata</span></a></span><span>
</span><span id="line-320"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HASURA_GRAPHQL_NO_OF_RETRIES&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-321"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HASURA_GRAPHQL_PG_CONNECTIONS&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-322"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HASURA_GRAPHQL_PG_TIMEOUT&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-323"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HASURA_GRAPHQL_PG_CONN_LIFETIME&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-324"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HASURA_GRAPHQL_PG_POOL_TIMEOUT&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-325"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HASURA_GRAPHQL_USE_PREPARED_STATEMENTS&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-326"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HASURA_GRAPHQL_TX_ISOLATION&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-327"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HASURA_GRAPHQL_CONNECTIONS_PER_READ_REPLICA&quot;</span></span><span>
</span><span id="line-328"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span class="annot"><a href="Hasura.Server.Utils.html#deprecatedEnvVars"><span class="hs-identifier hs-type">deprecatedEnvVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Server.Utils.html#DeprecatedEnvVars"><span class="hs-identifier hs-type">DeprecatedEnvVars</span></a></span><span>
</span><span id="line-331"></span><span id="deprecatedEnvVars"><span class="annot"><span class="annottext">deprecatedEnvVars :: DeprecatedEnvVars
</span><a href="Hasura.Server.Utils.html#deprecatedEnvVars"><span class="hs-identifier hs-var hs-var">deprecatedEnvVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-332"></span><span>  </span><span class="annot"><span class="annottext">[String] -&gt; DeprecatedEnvVars
</span><a href="Hasura.Server.Utils.html#DeprecatedEnvVars"><span class="hs-identifier hs-var">DeprecatedEnvVars</span></a></span><span>
</span><span id="line-333"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HASURA_GRAPHQL_PG_STRIPES&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-334"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HASURA_GRAPHQL_QUERY_PLAN_CACHE_SIZE&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-335"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HASURA_GRAPHQL_STRIPES_PER_READ_REPLICA&quot;</span></span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span class="annot"><a href="Hasura.Server.Utils.html#sensitiveHeaders"><span class="hs-identifier hs-type">sensitiveHeaders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashSet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.HeaderName</span></span><span>
</span><span id="line-339"></span><span id="sensitiveHeaders"><span class="annot"><span class="annottext">sensitiveHeaders :: HashSet HeaderName
</span><a href="Hasura.Server.Utils.html#sensitiveHeaders"><span class="hs-identifier hs-var hs-var">sensitiveHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-340"></span><span>  </span><span class="annot"><span class="annottext">[HeaderName] -&gt; HashSet HeaderName
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Authorization&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-342"></span><span>      </span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Cookie&quot;</span></span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span class="annot"><a href="Hasura.Server.Utils.html#redactSensitiveHeader"><span class="hs-identifier hs-type">redactSensitiveHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.Header</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.Header</span></span><span>
</span><span id="line-346"></span><span id="redactSensitiveHeader"><span class="annot"><span class="annottext">redactSensitiveHeader :: Header -&gt; Header
</span><a href="Hasura.Server.Utils.html#redactSensitiveHeader"><span class="hs-identifier hs-var hs-var">redactSensitiveHeader</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621688923140"><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621688923140"><span class="hs-identifier hs-var">headerName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688923139"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621688923139"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621688923140"><span class="hs-identifier hs-var">headerName</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621688923140"><span class="hs-identifier hs-var">headerName</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderName -&gt; HashSet HeaderName -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">HashSet HeaderName
</span><a href="Hasura.Server.Utils.html#sensitiveHeaders"><span class="hs-identifier hs-var">sensitiveHeaders</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&lt;REDACTED&gt;&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621688923139"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-347"></span></pre></body></html>