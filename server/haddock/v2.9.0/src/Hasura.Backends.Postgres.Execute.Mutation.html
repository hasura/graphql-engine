<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Postgres Execute Mutation</span><span>
</span><span id="line-2"></span><span class="hs-comment">--</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- Generic combinators for translating and excecuting IR mutation statements.</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Used by the specific mutation modules, e.g. 'Hasura.Backends.Postgres.Execute.Insert'.</span><span>
</span><span id="line-5"></span><span class="hs-comment">--</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- See 'Hasura.Backends.Postgres.Instances.Execute'.</span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.Backends.Postgres.Execute.Mutation</span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#MutateResp"><span class="hs-identifier">MutateResp</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#execDeleteQuery"><span class="hs-identifier">execDeleteQuery</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#execInsertQuery"><span class="hs-identifier">execInsertQuery</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#execUpdateQuery"><span class="hs-identifier">execUpdateQuery</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#executeMutationOutputQuery"><span class="hs-identifier">executeMutationOutputQuery</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#mutateAndFetchCols"><span class="hs-identifier">mutateAndFetchCols</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">where</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DS</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Database.PG.Query</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Q</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.html"><span class="hs-identifier">Hasura.Backends.Postgres.Connection</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html"><span class="hs-identifier">Hasura.Backends.Postgres.SQL.DML</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html"><span class="hs-identifier">Hasura.Backends.Postgres.SQL.Types</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Value.html"><span class="hs-identifier">Hasura.Backends.Postgres.SQL.Value</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Delete.html"><span class="hs-identifier">Hasura.Backends.Postgres.Translate.Delete</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Insert.html"><span class="hs-identifier">Hasura.Backends.Postgres.Translate.Insert</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Mutation.html"><span class="hs-identifier">Hasura.Backends.Postgres.Translate.Mutation</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Returning.html"><span class="hs-identifier">Hasura.Backends.Postgres.Translate.Returning</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html"><span class="hs-identifier">Hasura.Backends.Postgres.Translate.Select</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Update.html"><span class="hs-identifier">Hasura.Backends.Postgres.Translate.Update</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Base.Error.html"><span class="hs-identifier">Hasura.Base.Error</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.EncJSON.html"><span class="hs-identifier">Hasura.EncJSON</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Prelude.html"><span class="hs-identifier">Hasura.Prelude</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.QueryTags.html"><span class="hs-identifier">Hasura.QueryTags</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.BoolExp.html"><span class="hs-identifier">Hasura.RQL.IR.BoolExp</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Delete.html"><span class="hs-identifier">Hasura.RQL.IR.Delete</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Insert.html"><span class="hs-identifier">Hasura.RQL.IR.Insert</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Returning.html"><span class="hs-identifier">Hasura.RQL.IR.Returning</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html"><span class="hs-identifier">Hasura.RQL.IR.Select</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Update.html"><span class="hs-identifier">Hasura.RQL.IR.Update</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html"><span class="hs-identifier">Hasura.RQL.Types.Backend</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Column.html"><span class="hs-identifier">Hasura.RQL.Types.Column</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html"><span class="hs-identifier">Hasura.RQL.Types.Common</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.Backend.html"><span class="hs-identifier">Hasura.SQL.Backend</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.Types.html"><span class="hs-identifier">Hasura.SQL.Types</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Session.html"><span class="hs-identifier">Hasura.Session</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span id="local-6989586621689232291"><span id="local-6989586621689232292"></span></span><span class="hs-keyword">data</span><span> </span><span id="MutateResp"><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#MutateResp"><span class="hs-identifier hs-var">MutateResp</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621689232290"><span class="annot"><a href="#local-6989586621689232290"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.SQL.Backend.html#BackendType"><span class="hs-identifier hs-type">BackendType</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621689232289"><span class="annot"><a href="#local-6989586621689232289"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MutateResp"><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#MutateResp"><span class="hs-identifier hs-var">MutateResp</span></a></span></span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_mrAffectedRows"><span class="annot"><span class="annottext">MutateResp b a -&gt; Int
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#_mrAffectedRows"><span class="hs-identifier hs-var hs-var">_mrAffectedRows</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span id="_mrReturningColumns"><span class="annot"><span class="annottext">MutateResp b a -&gt; [ColumnValues b a]
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#_mrReturningColumns"><span class="hs-identifier hs-var hs-var">_mrReturningColumns</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Column.html#ColumnValues"><span class="hs-identifier hs-type">ColumnValues</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232290"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232289"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. MutateResp b a -&gt; Rep (MutateResp b a) x)
-&gt; (forall x. Rep (MutateResp b a) x -&gt; MutateResp b a)
-&gt; Generic (MutateResp b a)
forall x. Rep (MutateResp b a) x -&gt; MutateResp b a
forall x. MutateResp b a -&gt; Rep (MutateResp b a) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall (b :: BackendType) a x.
Rep (MutateResp b a) x -&gt; MutateResp b a
forall (b :: BackendType) a x.
MutateResp b a -&gt; Rep (MutateResp b a) x
$cto :: forall (b :: BackendType) a x.
Rep (MutateResp b a) x -&gt; MutateResp b a
$cfrom :: forall (b :: BackendType) a x.
MutateResp b a -&gt; Rep (MutateResp b a) x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span id="local-6989586621689232275"><span id="local-6989586621689232277"><span id="local-6989586621689232279"><span id="local-6989586621689232281"><span id="local-6989586621689232282"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232282"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621689232281"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#MutateResp"><span class="hs-identifier hs-type">MutateResp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232282"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232281"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span id="local-6989586621689232268"><span id="local-6989586621689232270"><span id="local-6989586621689232272"><span id="local-6989586621689232273"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232273"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621689232272"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#MutateResp"><span class="hs-identifier hs-type">MutateResp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232273"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232272"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span id="local-6989586621689232265"><span id="local-6989586621689232266"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621689232258"><span id="local-6989586621689232260"><span id="local-6989586621689232262"><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232266"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621689232265"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#MutateResp"><span class="hs-identifier hs-type">MutateResp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232266"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232265"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-60"></span><span>  </span><span id="local-6989586621689232256"><span class="annot"><span class="annottext">toJSON :: MutateResp b a -&gt; Value
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Options -&gt; MutateResp b a -&gt; Value
forall a.
(Generic a, GToJSON' Value Zero (Rep a)) =&gt;
Options -&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">genericToJSON</span></span><span> </span><span class="annot"><span class="annottext">Options
</span><a href="Hasura.Prelude.html#hasuraJSON"><span class="hs-identifier hs-var">hasuraJSON</span></a></span></span></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span id="local-6989586621689232251"><span id="local-6989586621689232252"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621689232248"><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232252"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621689232251"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#MutateResp"><span class="hs-identifier hs-type">MutateResp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232252"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232251"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-63"></span><span>  </span><span id="local-6989586621689232246"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser (MutateResp b a)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Options -&gt; Value -&gt; Parser (MutateResp b a)
forall a.
(Generic a, GFromJSON Zero (Rep a)) =&gt;
Options -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">genericParseJSON</span></span><span> </span><span class="annot"><span class="annottext">Options
</span><a href="Hasura.Prelude.html#hasuraJSON"><span class="hs-identifier hs-var">hasuraJSON</span></a></span></span></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">data</span><span> </span><span id="Mutation"><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#Mutation"><span class="hs-identifier hs-var">Mutation</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621689232464"><span class="annot"><a href="#local-6989586621689232464"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.SQL.Backend.html#BackendType"><span class="hs-identifier hs-type">BackendType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Mutation"><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#Mutation"><span class="hs-identifier hs-var">Mutation</span></a></span></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_mTable"><span class="annot"><span class="annottext">Mutation b -&gt; QualifiedTable
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#_mTable"><span class="hs-identifier hs-var hs-var">_mTable</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedTable"><span class="hs-identifier hs-type">QualifiedTable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>    </span><span id="_mQuery"><span class="annot"><span class="annottext">Mutation b -&gt; (MutationCTE, Seq PrepArg)
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#_mQuery"><span class="hs-identifier hs-var hs-var">_mQuery</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Returning.html#MutationCTE"><span class="hs-identifier hs-type">MutationCTE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DS.Seq</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q.PrepArg</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>    </span><span id="_mOutput"><span class="annot"><span class="annottext">Mutation b -&gt; MutationOutput b
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#_mOutput"><span class="hs-identifier hs-var hs-var">_mOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Returning.html#MutationOutput"><span class="hs-identifier hs-type">MutationOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232464"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>    </span><span id="_mCols"><span class="annot"><span class="annottext">Mutation b -&gt; [ColumnInfo b]
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#_mCols"><span class="hs-identifier hs-var hs-var">_mCols</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Column.html#ColumnInfo"><span class="hs-identifier hs-type">ColumnInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232464"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>    </span><span id="_mStrfyNum"><span class="annot"><span class="annottext">Mutation b -&gt; StringifyNumbers
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#_mStrfyNum"><span class="hs-identifier hs-var hs-var">_mStrfyNum</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#StringifyNumbers"><span class="hs-identifier hs-type">StringifyNumbers</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span id="local-6989586621689232431"><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#mkMutation"><span class="hs-identifier hs-type">mkMutation</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><a href="Hasura.Session.html#UserInfo"><span class="hs-identifier hs-type">UserInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedTable"><span class="hs-identifier hs-type">QualifiedTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Returning.html#MutationCTE"><span class="hs-identifier hs-type">MutationCTE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DS.Seq</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q.PrepArg</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Returning.html#MutationOutput"><span class="hs-identifier hs-type">MutationOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232431"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Column.html#ColumnInfo"><span class="hs-identifier hs-type">ColumnInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232431"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#StringifyNumbers"><span class="hs-identifier hs-type">StringifyNumbers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#Mutation"><span class="hs-identifier hs-type">Mutation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232431"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-81"></span><span id="mkMutation"><span class="annot"><span class="annottext">mkMutation :: UserInfo
-&gt; QualifiedTable
-&gt; (MutationCTE, Seq PrepArg)
-&gt; MutationOutput ('Postgres pgKind)
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; StringifyNumbers
-&gt; Mutation ('Postgres pgKind)
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#mkMutation"><span class="hs-identifier hs-var hs-var">mkMutation</span></a></span></span><span> </span><span id="local-6989586621689232236"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689232236"><span class="hs-identifier hs-var">_userInfo</span></a></span></span><span> </span><span id="local-6989586621689232235"><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621689232235"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span id="local-6989586621689232234"><span class="annot"><span class="annottext">(MutationCTE, Seq PrepArg)
</span><a href="#local-6989586621689232234"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span id="local-6989586621689232233"><span class="annot"><span class="annottext">MutationOutput ('Postgres pgKind)
</span><a href="#local-6989586621689232233"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span id="local-6989586621689232232"><span class="annot"><span class="annottext">[ColumnInfo ('Postgres pgKind)]
</span><a href="#local-6989586621689232232"><span class="hs-identifier hs-var">allCols</span></a></span></span><span> </span><span id="local-6989586621689232231"><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689232231"><span class="hs-identifier hs-var">strfyNum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-82"></span><span>  </span><span class="annot"><span class="annottext">QualifiedTable
-&gt; (MutationCTE, Seq PrepArg)
-&gt; MutationOutput ('Postgres pgKind)
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; StringifyNumbers
-&gt; Mutation ('Postgres pgKind)
forall (b :: BackendType).
QualifiedTable
-&gt; (MutationCTE, Seq PrepArg)
-&gt; MutationOutput b
-&gt; [ColumnInfo b]
-&gt; StringifyNumbers
-&gt; Mutation b
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#Mutation"><span class="hs-identifier hs-var">Mutation</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621689232235"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">(MutationCTE, Seq PrepArg)
</span><a href="#local-6989586621689232234"><span class="hs-identifier hs-var">query</span></a></span><span> </span><span class="annot"><span class="annottext">MutationOutput ('Postgres pgKind)
</span><a href="#local-6989586621689232233"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="annottext">[ColumnInfo ('Postgres pgKind)]
</span><a href="#local-6989586621689232232"><span class="hs-identifier hs-var">allCols</span></a></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689232231"><span class="hs-identifier hs-var">strfyNum</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span id="local-6989586621689232229"><span id="local-6989586621689232230"><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#runMutation"><span class="hs-identifier hs-type">runMutation</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.MonadTx.html#MonadTx"><span class="hs-identifier hs-type">MonadTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232230"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232229"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.AnnotatedFieldJSON.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232229"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.QueryTags.html#QueryTagsComment"><span class="hs-identifier hs-type">QueryTagsComment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232230"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-90"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#Mutation"><span class="hs-identifier hs-type">Mutation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232229"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-91"></span><span>  </span><span class="annot"><a href="#local-6989586621689232230"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span></span></span><span>
</span><span id="line-92"></span><span id="runMutation"><span class="annot"><span class="annottext">runMutation :: Mutation ('Postgres pgKind) -&gt; m EncJSON
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#runMutation"><span class="hs-identifier hs-var hs-var">runMutation</span></a></span></span><span> </span><span id="local-6989586621689232227"><span class="annot"><span class="annottext">Mutation ('Postgres pgKind)
</span><a href="#local-6989586621689232227"><span class="hs-identifier hs-var">mut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><span class="annottext">m EncJSON -&gt; m EncJSON -&gt; Bool -&gt; m EncJSON
forall a. a -&gt; a -&gt; Bool -&gt; a
</span><span class="hs-identifier hs-var">bool</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mutation ('Postgres pgKind) -&gt; m EncJSON
forall (m :: * -&gt; *) (pgKind :: PostgresKind).
(MonadTx m, Backend ('Postgres pgKind),
 PostgresAnnotatedFieldJSON pgKind,
 MonadReader QueryTagsComment m) =&gt;
Mutation ('Postgres pgKind) -&gt; m EncJSON
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#mutateAndReturn"><span class="hs-identifier hs-var">mutateAndReturn</span></a></span><span> </span><span class="annot"><span class="annottext">Mutation ('Postgres pgKind)
</span><a href="#local-6989586621689232227"><span class="hs-identifier hs-var">mut</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mutation ('Postgres pgKind) -&gt; m EncJSON
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(MonadTx m, Backend ('Postgres pgKind),
 PostgresAnnotatedFieldJSON pgKind,
 MonadReader QueryTagsComment m) =&gt;
Mutation ('Postgres pgKind) -&gt; m EncJSON
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#mutateAndSel"><span class="hs-identifier hs-var">mutateAndSel</span></a></span><span> </span><span class="annot"><span class="annottext">Mutation ('Postgres pgKind)
</span><a href="#local-6989586621689232227"><span class="hs-identifier hs-var">mut</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; m EncJSON) -&gt; Bool -&gt; m EncJSON
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><span class="annottext">MutationOutputG ('Postgres pgKind) Void SQLExp -&gt; Bool
forall (backend :: BackendType) r a.
MutationOutputG backend r a -&gt; Bool
</span><a href="Hasura.RQL.IR.Returning.html#hasNestedFld"><span class="hs-identifier hs-var">hasNestedFld</span></a></span><span> </span><span class="annot"><span class="annottext">(MutationOutputG ('Postgres pgKind) Void SQLExp -&gt; Bool)
-&gt; MutationOutputG ('Postgres pgKind) Void SQLExp -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Mutation ('Postgres pgKind) -&gt; MutationOutput ('Postgres pgKind)
forall (b :: BackendType). Mutation b -&gt; MutationOutput b
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#_mOutput"><span class="hs-identifier hs-var hs-var">_mOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Mutation ('Postgres pgKind)
</span><a href="#local-6989586621689232227"><span class="hs-identifier hs-var">mut</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span id="local-6989586621689232456"><span id="local-6989586621689232458"><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#mutateAndReturn"><span class="hs-identifier hs-type">mutateAndReturn</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.MonadTx.html#MonadTx"><span class="hs-identifier hs-type">MonadTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232458"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232456"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.AnnotatedFieldJSON.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232456"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.QueryTags.html#QueryTagsComment"><span class="hs-identifier hs-type">QueryTagsComment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232458"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#Mutation"><span class="hs-identifier hs-type">Mutation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232456"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><a href="#local-6989586621689232458"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span></span></span><span>
</span><span id="line-104"></span><span id="mutateAndReturn"><span class="annot"><span class="annottext">mutateAndReturn :: Mutation ('Postgres pgKind) -&gt; m EncJSON
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#mutateAndReturn"><span class="hs-identifier hs-var hs-var">mutateAndReturn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#Mutation"><span class="hs-identifier hs-type">Mutation</span></a></span><span> </span><span id="local-6989586621689232222"><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621689232222"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621689232221"><span class="annot"><span class="annottext">MutationCTE
</span><a href="#local-6989586621689232221"><span class="hs-identifier hs-var">cte</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689232220"><span class="annot"><span class="annottext">Seq PrepArg
</span><a href="#local-6989586621689232220"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621689232219"><span class="annot"><span class="annottext">MutationOutput ('Postgres pgKind)
</span><a href="#local-6989586621689232219"><span class="hs-identifier hs-var">mutationOutput</span></a></span></span><span> </span><span id="local-6989586621689232218"><span class="annot"><span class="annottext">[ColumnInfo ('Postgres pgKind)]
</span><a href="#local-6989586621689232218"><span class="hs-identifier hs-var">allCols</span></a></span></span><span> </span><span id="local-6989586621689232217"><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689232217"><span class="hs-identifier hs-var">strfyNum</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-105"></span><span>  </span><span class="annot"><span class="annottext">QualifiedTable
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; Maybe Int
-&gt; MutationCTE
-&gt; MutationOutput ('Postgres pgKind)
-&gt; StringifyNumbers
-&gt; [PrepArg]
-&gt; m EncJSON
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(MonadTx m, Backend ('Postgres pgKind),
 PostgresAnnotatedFieldJSON pgKind,
 MonadReader QueryTagsComment m) =&gt;
QualifiedTable
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; Maybe Int
-&gt; MutationCTE
-&gt; MutationOutput ('Postgres pgKind)
-&gt; StringifyNumbers
-&gt; [PrepArg]
-&gt; m EncJSON
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#executeMutationOutputQuery"><span class="hs-identifier hs-var">executeMutationOutputQuery</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621689232222"><span class="hs-identifier hs-var">qt</span></a></span><span> </span><span class="annot"><span class="annottext">[ColumnInfo ('Postgres pgKind)]
</span><a href="#local-6989586621689232218"><span class="hs-identifier hs-var">allCols</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">MutationCTE
</span><a href="#local-6989586621689232221"><span class="hs-identifier hs-var">cte</span></a></span><span> </span><span class="annot"><span class="annottext">MutationOutput ('Postgres pgKind)
</span><a href="#local-6989586621689232219"><span class="hs-identifier hs-var">mutationOutput</span></a></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689232217"><span class="hs-identifier hs-var">strfyNum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq PrepArg -&gt; [PrepArg]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Seq PrepArg
</span><a href="#local-6989586621689232220"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#execUpdateQuery"><span class="hs-identifier hs-type">execUpdateQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689232215"><span class="annot"><a href="#local-6989586621689232215"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span> </span><span id="local-6989586621689232214"><span class="annot"><a href="#local-6989586621689232214"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.MonadTx.html#MonadTx"><span class="hs-identifier hs-type">MonadTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232214"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232215"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.AnnotatedFieldJSON.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232215"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.QueryTags.html#QueryTagsComment"><span class="hs-identifier hs-type">QueryTagsComment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232214"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-114"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#StringifyNumbers"><span class="hs-identifier hs-type">StringifyNumbers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-115"></span><span>  </span><span class="annot"><a href="Hasura.Session.html#UserInfo"><span class="hs-identifier hs-type">UserInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Update.html#AnnotatedUpdate"><span class="hs-identifier hs-type">AnnotatedUpdate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232215"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DS.Seq</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q.PrepArg</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-117"></span><span>  </span><span class="annot"><a href="#local-6989586621689232214"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span>
</span><span id="line-118"></span><span id="execUpdateQuery"><span class="annot"><span class="annottext">execUpdateQuery :: StringifyNumbers
-&gt; UserInfo
-&gt; (AnnotatedUpdate ('Postgres pgKind), Seq PrepArg)
-&gt; m EncJSON
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#execUpdateQuery"><span class="hs-identifier hs-var hs-var">execUpdateQuery</span></a></span></span><span> </span><span id="local-6989586621689232213"><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689232213"><span class="hs-identifier hs-var">strfyNum</span></a></span></span><span> </span><span id="local-6989586621689232212"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689232212"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621689232211"><span class="annot"><span class="annottext">AnnotatedUpdate ('Postgres pgKind)
</span><a href="#local-6989586621689232211"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689232210"><span class="annot"><span class="annottext">Seq PrepArg
</span><a href="#local-6989586621689232210"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-119"></span><span>  </span><span class="annot"><span class="annottext">Mutation ('Postgres pgKind) -&gt; m EncJSON
forall (m :: * -&gt; *) (pgKind :: PostgresKind).
(MonadTx m, Backend ('Postgres pgKind),
 PostgresAnnotatedFieldJSON pgKind,
 MonadReader QueryTagsComment m) =&gt;
Mutation ('Postgres pgKind) -&gt; m EncJSON
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#runMutation"><span class="hs-identifier hs-var">runMutation</span></a></span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserInfo
-&gt; QualifiedTable
-&gt; (MutationCTE, Seq PrepArg)
-&gt; MutationOutput ('Postgres pgKind)
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; StringifyNumbers
-&gt; Mutation ('Postgres pgKind)
forall (pgKind :: PostgresKind).
UserInfo
-&gt; QualifiedTable
-&gt; (MutationCTE, Seq PrepArg)
-&gt; MutationOutput ('Postgres pgKind)
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; StringifyNumbers
-&gt; Mutation ('Postgres pgKind)
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#mkMutation"><span class="hs-identifier hs-var">mkMutation</span></a></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689232212"><span class="hs-identifier hs-var">userInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnotatedUpdateG ('Postgres pgKind) Void SQLExp
-&gt; TableName ('Postgres pgKind)
forall (b :: BackendType) r v.
AnnotatedUpdateG b r v -&gt; TableName b
</span><a href="Hasura.RQL.IR.Update.html#_auTable"><span class="hs-identifier hs-var hs-var">_auTable</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedUpdate ('Postgres pgKind)
AnnotatedUpdateG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621689232211"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CTE -&gt; MutationCTE
</span><a href="Hasura.Backends.Postgres.Translate.Returning.html#MCCheckConstraint"><span class="hs-identifier hs-var">MCCheckConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">CTE
</span><a href="#local-6989586621689232207"><span class="hs-identifier hs-var">updateCTE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Seq PrepArg
</span><a href="#local-6989586621689232210"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnotatedUpdateG ('Postgres pgKind) Void SQLExp
-&gt; MutationOutputG ('Postgres pgKind) Void SQLExp
forall (b :: BackendType) r v.
AnnotatedUpdateG b r v -&gt; MutationOutputG b r v
</span><a href="Hasura.RQL.IR.Update.html#_auOutput"><span class="hs-identifier hs-var hs-var">_auOutput</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedUpdate ('Postgres pgKind)
AnnotatedUpdateG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621689232211"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnotatedUpdateG ('Postgres pgKind) Void SQLExp
-&gt; [ColumnInfo ('Postgres pgKind)]
forall (b :: BackendType) r v.
AnnotatedUpdateG b r v -&gt; [ColumnInfo b]
</span><a href="Hasura.RQL.IR.Update.html#_auAllCols"><span class="hs-identifier hs-var hs-var">_auAllCols</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedUpdate ('Postgres pgKind)
AnnotatedUpdateG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621689232211"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689232213"><span class="hs-identifier hs-var">strfyNum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-122"></span><span>    </span><span id="local-6989586621689232207"><span class="annot"><span class="annottext">updateCTE :: CTE
</span><a href="#local-6989586621689232207"><span class="hs-identifier hs-var hs-var">updateCTE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnotatedUpdate ('Postgres pgKind) -&gt; CTE
forall (pgKind :: PostgresKind).
Backend ('Postgres pgKind) =&gt;
AnnotatedUpdate ('Postgres pgKind) -&gt; CTE
</span><a href="Hasura.Backends.Postgres.Translate.Update.html#mkUpdateCTE"><span class="hs-identifier hs-var">mkUpdateCTE</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedUpdate ('Postgres pgKind)
</span><a href="#local-6989586621689232211"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#execDeleteQuery"><span class="hs-identifier hs-type">execDeleteQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689232203"><span class="annot"><a href="#local-6989586621689232203"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span> </span><span id="local-6989586621689232202"><span class="annot"><a href="#local-6989586621689232202"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.MonadTx.html#MonadTx"><span class="hs-identifier hs-type">MonadTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232202"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-127"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232203"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-128"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.AnnotatedFieldJSON.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232203"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.QueryTags.html#QueryTagsComment"><span class="hs-identifier hs-type">QueryTagsComment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232202"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#StringifyNumbers"><span class="hs-identifier hs-type">StringifyNumbers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><a href="Hasura.Session.html#UserInfo"><span class="hs-identifier hs-type">UserInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Delete.html#AnnDel"><span class="hs-identifier hs-type">AnnDel</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232203"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DS.Seq</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q.PrepArg</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-134"></span><span>  </span><span class="annot"><a href="#local-6989586621689232202"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span>
</span><span id="line-135"></span><span id="execDeleteQuery"><span class="annot"><span class="annottext">execDeleteQuery :: StringifyNumbers
-&gt; UserInfo
-&gt; (AnnDel ('Postgres pgKind), Seq PrepArg)
-&gt; m EncJSON
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#execDeleteQuery"><span class="hs-identifier hs-var hs-var">execDeleteQuery</span></a></span></span><span> </span><span id="local-6989586621689232201"><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689232201"><span class="hs-identifier hs-var">strfyNum</span></a></span></span><span> </span><span id="local-6989586621689232200"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689232200"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621689232199"><span class="annot"><span class="annottext">AnnDel ('Postgres pgKind)
</span><a href="#local-6989586621689232199"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689232198"><span class="annot"><span class="annottext">Seq PrepArg
</span><a href="#local-6989586621689232198"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-136"></span><span>  </span><span class="annot"><span class="annottext">Mutation ('Postgres pgKind) -&gt; m EncJSON
forall (m :: * -&gt; *) (pgKind :: PostgresKind).
(MonadTx m, Backend ('Postgres pgKind),
 PostgresAnnotatedFieldJSON pgKind,
 MonadReader QueryTagsComment m) =&gt;
Mutation ('Postgres pgKind) -&gt; m EncJSON
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#runMutation"><span class="hs-identifier hs-var">runMutation</span></a></span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserInfo
-&gt; QualifiedTable
-&gt; (MutationCTE, Seq PrepArg)
-&gt; MutationOutput ('Postgres pgKind)
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; StringifyNumbers
-&gt; Mutation ('Postgres pgKind)
forall (pgKind :: PostgresKind).
UserInfo
-&gt; QualifiedTable
-&gt; (MutationCTE, Seq PrepArg)
-&gt; MutationOutput ('Postgres pgKind)
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; StringifyNumbers
-&gt; Mutation ('Postgres pgKind)
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#mkMutation"><span class="hs-identifier hs-var">mkMutation</span></a></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689232200"><span class="hs-identifier hs-var">userInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnDelG ('Postgres pgKind) Void SQLExp
-&gt; TableName ('Postgres pgKind)
forall (b :: BackendType) r v. AnnDelG b r v -&gt; TableName b
</span><a href="Hasura.RQL.IR.Delete.html#_adTable"><span class="hs-identifier hs-var hs-var">_adTable</span></a></span><span> </span><span class="annot"><span class="annottext">AnnDel ('Postgres pgKind)
AnnDelG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621689232199"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SQLDelete -&gt; MutationCTE
</span><a href="Hasura.Backends.Postgres.Translate.Returning.html#MCDelete"><span class="hs-identifier hs-var">MCDelete</span></a></span><span> </span><span class="annot"><span class="annottext">SQLDelete
</span><a href="#local-6989586621689232195"><span class="hs-identifier hs-var">delete</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Seq PrepArg
</span><a href="#local-6989586621689232198"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnDelG ('Postgres pgKind) Void SQLExp
-&gt; MutationOutputG ('Postgres pgKind) Void SQLExp
forall (b :: BackendType) r v.
AnnDelG b r v -&gt; MutationOutputG b r v
</span><a href="Hasura.RQL.IR.Delete.html#_adOutput"><span class="hs-identifier hs-var hs-var">_adOutput</span></a></span><span> </span><span class="annot"><span class="annottext">AnnDel ('Postgres pgKind)
AnnDelG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621689232199"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnDelG ('Postgres pgKind) Void SQLExp
-&gt; [ColumnInfo ('Postgres pgKind)]
forall (b :: BackendType) r v. AnnDelG b r v -&gt; [ColumnInfo b]
</span><a href="Hasura.RQL.IR.Delete.html#_adAllCols"><span class="hs-identifier hs-var hs-var">_adAllCols</span></a></span><span> </span><span class="annot"><span class="annottext">AnnDel ('Postgres pgKind)
AnnDelG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621689232199"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689232201"><span class="hs-identifier hs-var">strfyNum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-139"></span><span>    </span><span id="local-6989586621689232195"><span class="annot"><span class="annottext">delete :: SQLDelete
</span><a href="#local-6989586621689232195"><span class="hs-identifier hs-var hs-var">delete</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnDel ('Postgres pgKind) -&gt; SQLDelete
forall (pgKind :: PostgresKind).
Backend ('Postgres pgKind) =&gt;
AnnDel ('Postgres pgKind) -&gt; SQLDelete
</span><a href="Hasura.Backends.Postgres.Translate.Delete.html#mkDelete"><span class="hs-identifier hs-var">mkDelete</span></a></span><span> </span><span class="annot"><span class="annottext">AnnDel ('Postgres pgKind)
</span><a href="#local-6989586621689232199"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span id="local-6989586621689232190"><span id="local-6989586621689232191"><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#execInsertQuery"><span class="hs-identifier hs-type">execInsertQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.MonadTx.html#MonadTx"><span class="hs-identifier hs-type">MonadTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232191"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232190"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.AnnotatedFieldJSON.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232190"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.QueryTags.html#QueryTagsComment"><span class="hs-identifier hs-type">QueryTagsComment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232191"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#StringifyNumbers"><span class="hs-identifier hs-type">StringifyNumbers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><a href="Hasura.Session.html#UserInfo"><span class="hs-identifier hs-type">UserInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Insert.html#InsertQueryP1"><span class="hs-identifier hs-type">InsertQueryP1</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232190"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DS.Seq</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q.PrepArg</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><a href="#local-6989586621689232191"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span></span></span><span>
</span><span id="line-151"></span><span id="execInsertQuery"><span class="annot"><span class="annottext">execInsertQuery :: StringifyNumbers
-&gt; UserInfo
-&gt; (InsertQueryP1 ('Postgres pgKind), Seq PrepArg)
-&gt; m EncJSON
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#execInsertQuery"><span class="hs-identifier hs-var hs-var">execInsertQuery</span></a></span></span><span> </span><span id="local-6989586621689232189"><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689232189"><span class="hs-identifier hs-var">strfyNum</span></a></span></span><span> </span><span id="local-6989586621689232188"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689232188"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621689232187"><span class="annot"><span class="annottext">InsertQueryP1 ('Postgres pgKind)
</span><a href="#local-6989586621689232187"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689232186"><span class="annot"><span class="annottext">Seq PrepArg
</span><a href="#local-6989586621689232186"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-152"></span><span>  </span><span class="annot"><span class="annottext">Mutation ('Postgres pgKind) -&gt; m EncJSON
forall (m :: * -&gt; *) (pgKind :: PostgresKind).
(MonadTx m, Backend ('Postgres pgKind),
 PostgresAnnotatedFieldJSON pgKind,
 MonadReader QueryTagsComment m) =&gt;
Mutation ('Postgres pgKind) -&gt; m EncJSON
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#runMutation"><span class="hs-identifier hs-var">runMutation</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserInfo
-&gt; QualifiedTable
-&gt; (MutationCTE, Seq PrepArg)
-&gt; MutationOutput ('Postgres pgKind)
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; StringifyNumbers
-&gt; Mutation ('Postgres pgKind)
forall (pgKind :: PostgresKind).
UserInfo
-&gt; QualifiedTable
-&gt; (MutationCTE, Seq PrepArg)
-&gt; MutationOutput ('Postgres pgKind)
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; StringifyNumbers
-&gt; Mutation ('Postgres pgKind)
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#mkMutation"><span class="hs-identifier hs-var">mkMutation</span></a></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689232188"><span class="hs-identifier hs-var">userInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InsertQueryP1 ('Postgres pgKind) -&gt; TableName ('Postgres pgKind)
forall (b :: BackendType). InsertQueryP1 b -&gt; TableName b
</span><a href="Hasura.RQL.IR.Insert.html#iqp1Table"><span class="hs-identifier hs-var hs-var">iqp1Table</span></a></span><span> </span><span class="annot"><span class="annottext">InsertQueryP1 ('Postgres pgKind)
</span><a href="#local-6989586621689232187"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CTE -&gt; MutationCTE
</span><a href="Hasura.Backends.Postgres.Translate.Returning.html#MCCheckConstraint"><span class="hs-identifier hs-var">MCCheckConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">CTE
</span><a href="#local-6989586621689232184"><span class="hs-identifier hs-var">insertCTE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Seq PrepArg
</span><a href="#local-6989586621689232186"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InsertQueryP1 ('Postgres pgKind)
-&gt; MutationOutput ('Postgres pgKind)
forall (b :: BackendType). InsertQueryP1 b -&gt; MutationOutput b
</span><a href="Hasura.RQL.IR.Insert.html#iqp1Output"><span class="hs-identifier hs-var hs-var">iqp1Output</span></a></span><span> </span><span class="annot"><span class="annottext">InsertQueryP1 ('Postgres pgKind)
</span><a href="#local-6989586621689232187"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InsertQueryP1 ('Postgres pgKind) -&gt; [ColumnInfo ('Postgres pgKind)]
forall (b :: BackendType). InsertQueryP1 b -&gt; [ColumnInfo b]
</span><a href="Hasura.RQL.IR.Insert.html#iqp1AllCols"><span class="hs-identifier hs-var hs-var">iqp1AllCols</span></a></span><span> </span><span class="annot"><span class="annottext">InsertQueryP1 ('Postgres pgKind)
</span><a href="#local-6989586621689232187"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689232189"><span class="hs-identifier hs-var">strfyNum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-155"></span><span>    </span><span id="local-6989586621689232184"><span class="annot"><span class="annottext">insertCTE :: CTE
</span><a href="#local-6989586621689232184"><span class="hs-identifier hs-var hs-var">insertCTE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InsertQueryP1 ('Postgres pgKind) -&gt; CTE
forall (pgKind :: PostgresKind).
Backend ('Postgres pgKind) =&gt;
InsertQueryP1 ('Postgres pgKind) -&gt; CTE
</span><a href="Hasura.Backends.Postgres.Translate.Insert.html#mkInsertCTE"><span class="hs-identifier hs-var">mkInsertCTE</span></a></span><span> </span><span class="annot"><span class="annottext">InsertQueryP1 ('Postgres pgKind)
</span><a href="#local-6989586621689232187"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-comment">{- Note: [Prepared statements in Mutations]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The SQL statements we generate for mutations seem to include the actual values
in the statements in some cases which pretty much makes them unfit for reuse
(Handling relationships in the returning clause is the source of this
complexity). Further, `PGConn` has an internal cache which maps a statement to
a 'prepared statement id' on Postgres. As we prepare more and more single-use
SQL statements we end up leaking memory both on graphql-engine and Postgres
till the connection is closed. So a simpler but very crude fix is to not use
prepared statements for mutations. The performance of insert mutations
shouldn't be affected but updates and delete mutations with complex boolean
conditions **might** see some degradation.
-}</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#mutateAndSel"><span class="hs-identifier hs-type">mutateAndSel</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689232451"><span class="annot"><a href="#local-6989586621689232451"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span> </span><span id="local-6989586621689232452"><span class="annot"><a href="#local-6989586621689232452"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.MonadTx.html#MonadTx"><span class="hs-identifier hs-type">MonadTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232452"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232451"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.AnnotatedFieldJSON.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232451"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-176"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.QueryTags.html#QueryTagsComment"><span class="hs-identifier hs-type">QueryTagsComment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232452"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-178"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#Mutation"><span class="hs-identifier hs-type">Mutation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232451"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-179"></span><span>  </span><span class="annot"><a href="#local-6989586621689232452"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span>
</span><span id="line-180"></span><span id="mutateAndSel"><span class="annot"><span class="annottext">mutateAndSel :: Mutation ('Postgres pgKind) -&gt; m EncJSON
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#mutateAndSel"><span class="hs-identifier hs-var hs-var">mutateAndSel</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#Mutation"><span class="hs-identifier hs-type">Mutation</span></a></span><span> </span><span id="local-6989586621689232180"><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621689232180"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span id="local-6989586621689232179"><span class="annot"><span class="annottext">(MutationCTE, Seq PrepArg)
</span><a href="#local-6989586621689232179"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621689232178"><span class="annot"><span class="annottext">MutationOutput ('Postgres pgKind)
</span><a href="#local-6989586621689232178"><span class="hs-identifier hs-var">mutationOutput</span></a></span></span><span> </span><span id="local-6989586621689232177"><span class="annot"><span class="annottext">[ColumnInfo ('Postgres pgKind)]
</span><a href="#local-6989586621689232177"><span class="hs-identifier hs-var">allCols</span></a></span></span><span> </span><span id="local-6989586621689232176"><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689232176"><span class="hs-identifier hs-var">strfyNum</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-comment">-- Perform mutation and fetch unique columns</span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#MutateResp"><span class="hs-identifier hs-type">MutateResp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621689232175"><span class="annot"><span class="annottext">[ColumnValues ('Postgres pgKind) TxtEncodedVal]
</span><a href="#local-6989586621689232175"><span class="hs-identifier hs-var">columnVals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxE QErr (MutateResp ('Postgres pgKind) TxtEncodedVal)
-&gt; m (MutateResp ('Postgres pgKind) TxtEncodedVal)
forall (m :: * -&gt; *) a. MonadTx m =&gt; TxE QErr a -&gt; m a
</span><a href="Hasura.Backends.Postgres.Connection.MonadTx.html#liftTx"><span class="hs-identifier hs-var">liftTx</span></a></span><span> </span><span class="annot"><span class="annottext">(TxE QErr (MutateResp ('Postgres pgKind) TxtEncodedVal)
 -&gt; m (MutateResp ('Postgres pgKind) TxtEncodedVal))
-&gt; TxE QErr (MutateResp ('Postgres pgKind) TxtEncodedVal)
-&gt; m (MutateResp ('Postgres pgKind) TxtEncodedVal)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; (MutationCTE, Seq PrepArg)
-&gt; StringifyNumbers
-&gt; TxE QErr (MutateResp ('Postgres pgKind) TxtEncodedVal)
forall (pgKind :: PostgresKind).
(Backend ('Postgres pgKind), PostgresAnnotatedFieldJSON pgKind) =&gt;
QualifiedTable
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; (MutationCTE, Seq PrepArg)
-&gt; StringifyNumbers
-&gt; TxE QErr (MutateResp ('Postgres pgKind) TxtEncodedVal)
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#mutateAndFetchCols"><span class="hs-identifier hs-var">mutateAndFetchCols</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621689232180"><span class="hs-identifier hs-var">qt</span></a></span><span> </span><span class="annot"><span class="annottext">[ColumnInfo ('Postgres pgKind)]
</span><a href="#local-6989586621689232177"><span class="hs-identifier hs-var">allCols</span></a></span><span> </span><span class="annot"><span class="annottext">(MutationCTE, Seq PrepArg)
</span><a href="#local-6989586621689232179"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689232176"><span class="hs-identifier hs-var">strfyNum</span></a></span><span>
</span><span id="line-183"></span><span>  </span><span id="local-6989586621689232173"><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621689232173"><span class="hs-identifier hs-var">select</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QualifiedTable
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; [ColumnValues ('Postgres pgKind) TxtEncodedVal]
-&gt; m Select
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
MonadError QErr m =&gt;
QualifiedTable
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; [ColumnValues ('Postgres pgKind) TxtEncodedVal]
-&gt; m Select
</span><a href="Hasura.Backends.Postgres.Translate.Mutation.html#mkSelectExpFromColumnValues"><span class="hs-identifier hs-var">mkSelectExpFromColumnValues</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621689232180"><span class="hs-identifier hs-var">qt</span></a></span><span> </span><span class="annot"><span class="annottext">[ColumnInfo ('Postgres pgKind)]
</span><a href="#local-6989586621689232177"><span class="hs-identifier hs-var">allCols</span></a></span><span> </span><span class="annot"><span class="annottext">[ColumnValues ('Postgres pgKind) TxtEncodedVal]
</span><a href="#local-6989586621689232175"><span class="hs-identifier hs-var">columnVals</span></a></span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-comment">-- Perform select query and fetch returning fields</span><span>
</span><span id="line-185"></span><span>  </span><span class="annot"><span class="annottext">QualifiedTable
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; Maybe Int
-&gt; MutationCTE
-&gt; MutationOutput ('Postgres pgKind)
-&gt; StringifyNumbers
-&gt; [PrepArg]
-&gt; m EncJSON
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(MonadTx m, Backend ('Postgres pgKind),
 PostgresAnnotatedFieldJSON pgKind,
 MonadReader QueryTagsComment m) =&gt;
QualifiedTable
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; Maybe Int
-&gt; MutationCTE
-&gt; MutationOutput ('Postgres pgKind)
-&gt; StringifyNumbers
-&gt; [PrepArg]
-&gt; m EncJSON
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#executeMutationOutputQuery"><span class="hs-identifier hs-var">executeMutationOutputQuery</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621689232180"><span class="hs-identifier hs-var">qt</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><span class="annottext">[ColumnInfo ('Postgres pgKind)]
</span><a href="#local-6989586621689232177"><span class="hs-identifier hs-var">allCols</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Select -&gt; MutationCTE
</span><a href="Hasura.Backends.Postgres.Translate.Returning.html#MCSelectValues"><span class="hs-identifier hs-var">MCSelectValues</span></a></span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621689232173"><span class="hs-identifier hs-var">select</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><span class="annottext">MutationOutput ('Postgres pgKind)
</span><a href="#local-6989586621689232178"><span class="hs-identifier hs-var">mutationOutput</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689232176"><span class="hs-identifier hs-var">strfyNum</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span id="local-6989586621689232367"><span id="local-6989586621689232368"><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#withCheckPermission"><span class="hs-identifier hs-type">withCheckPermission</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232368"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689232368"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689232367"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689232368"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232367"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-195"></span><span id="withCheckPermission"><span class="annot"><span class="annottext">withCheckPermission :: m (a, Bool) -&gt; m a
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#withCheckPermission"><span class="hs-identifier hs-var hs-var">withCheckPermission</span></a></span></span><span> </span><span id="local-6989586621689232169"><span class="annot"><span class="annottext">m (a, Bool)
</span><a href="#local-6989586621689232169"><span class="hs-identifier hs-var">sqlTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621689232168"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689232168"><span class="hs-identifier hs-var">rawResponse</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689232167"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689232167"><span class="hs-identifier hs-var">checkConstraint</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (a, Bool)
</span><a href="#local-6989586621689232169"><span class="hs-identifier hs-var">sqlTx</span></a></span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689232167"><span class="hs-identifier hs-var">checkConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#PermissionError"><span class="hs-identifier hs-var">PermissionError</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-199"></span><span>      </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;check constraint of an insert/update permission has failed&quot;</span></span><span>
</span><span id="line-200"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689232168"><span class="hs-identifier hs-var">rawResponse</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#executeMutationOutputQuery"><span class="hs-identifier hs-type">executeMutationOutputQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689232438"><span class="annot"><a href="#local-6989586621689232438"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span> </span><span id="local-6989586621689232439"><span class="annot"><a href="#local-6989586621689232439"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.MonadTx.html#MonadTx"><span class="hs-identifier hs-type">MonadTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232439"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232438"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-206"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.AnnotatedFieldJSON.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232438"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.QueryTags.html#QueryTagsComment"><span class="hs-identifier hs-type">QueryTagsComment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232439"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-209"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedTable"><span class="hs-identifier hs-type">QualifiedTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Column.html#ColumnInfo"><span class="hs-identifier hs-type">ColumnInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232438"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-211"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-212"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Returning.html#MutationCTE"><span class="hs-identifier hs-type">MutationCTE</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-213"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Returning.html#MutationOutput"><span class="hs-identifier hs-type">MutationOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232438"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-214"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#StringifyNumbers"><span class="hs-identifier hs-type">StringifyNumbers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-comment">-- | Prepared params</span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Q.PrepArg</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-217"></span><span>  </span><span class="annot"><a href="#local-6989586621689232439"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span>
</span><span id="line-218"></span><span id="executeMutationOutputQuery"><span class="annot"><span class="annottext">executeMutationOutputQuery :: QualifiedTable
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; Maybe Int
-&gt; MutationCTE
-&gt; MutationOutput ('Postgres pgKind)
-&gt; StringifyNumbers
-&gt; [PrepArg]
-&gt; m EncJSON
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#executeMutationOutputQuery"><span class="hs-identifier hs-var hs-var">executeMutationOutputQuery</span></a></span></span><span> </span><span id="local-6989586621689232163"><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621689232163"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span id="local-6989586621689232162"><span class="annot"><span class="annottext">[ColumnInfo ('Postgres pgKind)]
</span><a href="#local-6989586621689232162"><span class="hs-identifier hs-var">allCols</span></a></span></span><span> </span><span id="local-6989586621689232161"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621689232161"><span class="hs-identifier hs-var">preCalAffRows</span></a></span></span><span> </span><span id="local-6989586621689232160"><span class="annot"><span class="annottext">MutationCTE
</span><a href="#local-6989586621689232160"><span class="hs-identifier hs-var">cte</span></a></span></span><span> </span><span id="local-6989586621689232159"><span class="annot"><span class="annottext">MutationOutput ('Postgres pgKind)
</span><a href="#local-6989586621689232159"><span class="hs-identifier hs-var">mutOutput</span></a></span></span><span> </span><span id="local-6989586621689232158"><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689232158"><span class="hs-identifier hs-var">strfyNum</span></a></span></span><span> </span><span id="local-6989586621689232157"><span class="annot"><span class="annottext">[PrepArg]
</span><a href="#local-6989586621689232157"><span class="hs-identifier hs-var">prepArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-219"></span><span>  </span><span id="local-6989586621689232156"><span class="annot"><span class="annottext">QueryTagsComment
</span><a href="#local-6989586621689232156"><span class="hs-identifier hs-var">queryTags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m QueryTagsComment
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689232361"><span class="annot"><a href="#local-6989586621689232154"><span class="hs-identifier hs-type">queryTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q.FromRes</span></span><span> </span><span class="annot"><a href="#local-6989586621689232361"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689232439"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232361"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-221"></span><span>      </span><span id="local-6989586621689232154"><span class="annot"><span class="annottext">queryTx :: m a
</span><a href="#local-6989586621689232154"><span class="hs-identifier hs-var hs-var">queryTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-222"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689232153"><span class="annot"><span class="annottext">selectWith :: SelectWith
</span><a href="#local-6989586621689232153"><span class="hs-identifier hs-var hs-var">selectWith</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QualifiedTable
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; Maybe Int
-&gt; MutationCTE
-&gt; MutationOutput ('Postgres pgKind)
-&gt; StringifyNumbers
-&gt; SelectWith
forall (pgKind :: PostgresKind).
(Backend ('Postgres pgKind), PostgresAnnotatedFieldJSON pgKind) =&gt;
QualifiedTable
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; Maybe Int
-&gt; MutationCTE
-&gt; MutationOutput ('Postgres pgKind)
-&gt; StringifyNumbers
-&gt; SelectWith
</span><a href="Hasura.Backends.Postgres.Translate.Returning.html#mkMutationOutputExp"><span class="hs-identifier hs-var">mkMutationOutputExp</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621689232163"><span class="hs-identifier hs-var">qt</span></a></span><span> </span><span class="annot"><span class="annottext">[ColumnInfo ('Postgres pgKind)]
</span><a href="#local-6989586621689232162"><span class="hs-identifier hs-var">allCols</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621689232161"><span class="hs-identifier hs-var">preCalAffRows</span></a></span><span> </span><span class="annot"><span class="annottext">MutationCTE
</span><a href="#local-6989586621689232160"><span class="hs-identifier hs-var">cte</span></a></span><span> </span><span class="annot"><span class="annottext">MutationOutput ('Postgres pgKind)
</span><a href="#local-6989586621689232159"><span class="hs-identifier hs-var">mutOutput</span></a></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689232158"><span class="hs-identifier hs-var">strfyNum</span></a></span><span>
</span><span id="line-223"></span><span>            </span><span id="local-6989586621689232151"><span class="annot"><span class="annottext">query :: Query
</span><a href="#local-6989586621689232151"><span class="hs-identifier hs-var hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Query
</span><span class="hs-identifier hs-var">Q.fromBuilder</span></span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; Query) -&gt; Builder -&gt; Query
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SelectWith -&gt; Builder
forall a. ToSQL a =&gt; a -&gt; Builder
</span><a href="Hasura.SQL.Types.html#toSQL"><span class="hs-identifier hs-var">toSQL</span></a></span><span> </span><span class="annot"><span class="annottext">SelectWith
</span><a href="#local-6989586621689232153"><span class="hs-identifier hs-var">selectWith</span></a></span><span>
</span><span id="line-224"></span><span>            </span><span id="local-6989586621689232148"><span class="annot"><span class="annottext">queryWithQueryTags :: Query
</span><a href="#local-6989586621689232148"><span class="hs-identifier hs-var hs-var">queryWithQueryTags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621689232151"><span class="hs-identifier hs-var">query</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">getQueryText :: Text
</span><span class="hs-identifier hs-var">Q.getQueryText</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Query -&gt; Text
</span><span class="hs-identifier hs-var hs-var">Q.getQueryText</span></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621689232151"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QueryTagsComment -&gt; Text
</span><a href="Hasura.QueryTags.html#_unQueryTagsComment"><span class="hs-identifier hs-var hs-var">_unQueryTagsComment</span></a></span><span> </span><span class="annot"><span class="annottext">QueryTagsComment
</span><a href="#local-6989586621689232156"><span class="hs-identifier hs-var">queryTags</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-225"></span><span>        </span><span class="hs-comment">-- See Note [Prepared statements in Mutations]</span><span>
</span><span id="line-226"></span><span>        </span><span class="annot"><span class="annottext">TxE QErr a -&gt; m a
forall (m :: * -&gt; *) a. MonadTx m =&gt; TxE QErr a -&gt; m a
</span><a href="Hasura.Backends.Postgres.Connection.MonadTx.html#liftTx"><span class="hs-identifier hs-var">liftTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr) -&gt; Query -&gt; [PrepArg] -&gt; Bool -&gt; TxE QErr a
forall (m :: * -&gt; *) a e.
(MonadIO m, FromRes a) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; [PrepArg] -&gt; Bool -&gt; TxET e m a
</span><span class="hs-identifier hs-var">Q.rawQE</span></span><span> </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#dmlTxErrorHandler"><span class="hs-identifier hs-var">dmlTxErrorHandler</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621689232148"><span class="hs-identifier hs-var">queryWithQueryTags</span></a></span><span> </span><span class="annot"><span class="annottext">[PrepArg]
</span><a href="#local-6989586621689232157"><span class="hs-identifier hs-var">prepArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">MutationCTE -&gt; Bool
</span><a href="Hasura.Backends.Postgres.Translate.Returning.html#checkPermissionRequired"><span class="hs-identifier hs-var">checkPermissionRequired</span></a></span><span> </span><span class="annot"><span class="annottext">MutationCTE
</span><a href="#local-6989586621689232160"><span class="hs-identifier hs-var">cte</span></a></span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">m (EncJSON, Bool) -&gt; m EncJSON
forall (m :: * -&gt; *) a. MonadError QErr m =&gt; m (a, Bool) -&gt; m a
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#withCheckPermission"><span class="hs-identifier hs-var">withCheckPermission</span></a></span><span> </span><span class="annot"><span class="annottext">(m (EncJSON, Bool) -&gt; m EncJSON) -&gt; m (EncJSON, Bool) -&gt; m EncJSON
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SingleRow (EncJSON, Bool) -&gt; (EncJSON, Bool)
forall a. SingleRow a -&gt; a
</span><span class="hs-identifier hs-var hs-var">Q.getRow</span></span><span> </span><span class="annot"><span class="annottext">(SingleRow (EncJSON, Bool) -&gt; (EncJSON, Bool))
-&gt; m (SingleRow (EncJSON, Bool)) -&gt; m (EncJSON, Bool)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m (SingleRow (EncJSON, Bool))
forall a. FromRes a =&gt; m a
</span><a href="#local-6989586621689232154"><span class="hs-identifier hs-var">queryTx</span></a></span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identity EncJSON -&gt; EncJSON
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity EncJSON -&gt; EncJSON)
-&gt; (SingleRow (Identity EncJSON) -&gt; Identity EncJSON)
-&gt; SingleRow (Identity EncJSON)
-&gt; EncJSON
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SingleRow (Identity EncJSON) -&gt; Identity EncJSON
forall a. SingleRow a -&gt; a
</span><span class="hs-identifier hs-var hs-var">Q.getRow</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SingleRow (Identity EncJSON) -&gt; EncJSON)
-&gt; m (SingleRow (Identity EncJSON)) -&gt; m EncJSON
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m (SingleRow (Identity EncJSON))
forall a. FromRes a =&gt; m a
</span><a href="#local-6989586621689232154"><span class="hs-identifier hs-var">queryTx</span></a></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#mutateAndFetchCols"><span class="hs-identifier hs-type">mutateAndFetchCols</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689232402"><span class="annot"><a href="#local-6989586621689232402"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232402"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.AnnotatedFieldJSON.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232402"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-235"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedTable"><span class="hs-identifier hs-type">QualifiedTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Column.html#ColumnInfo"><span class="hs-identifier hs-type">ColumnInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232402"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Returning.html#MutationCTE"><span class="hs-identifier hs-type">MutationCTE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DS.Seq</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q.PrepArg</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#StringifyNumbers"><span class="hs-identifier hs-type">StringifyNumbers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-239"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Q.TxE</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Mutation.html#MutateResp"><span class="hs-identifier hs-type">MutateResp</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232402"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Hasura.SQL.Value.html#TxtEncodedVal"><span class="hs-identifier hs-type">TxtEncodedVal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span id="mutateAndFetchCols"><span class="annot"><span class="annottext">mutateAndFetchCols :: QualifiedTable
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; (MutationCTE, Seq PrepArg)
-&gt; StringifyNumbers
-&gt; TxE QErr (MutateResp ('Postgres pgKind) TxtEncodedVal)
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#mutateAndFetchCols"><span class="hs-identifier hs-var hs-var">mutateAndFetchCols</span></a></span></span><span> </span><span id="local-6989586621689232138"><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621689232138"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span id="local-6989586621689232137"><span class="annot"><span class="annottext">[ColumnInfo ('Postgres pgKind)]
</span><a href="#local-6989586621689232137"><span class="hs-identifier hs-var">cols</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621689232136"><span class="annot"><span class="annottext">MutationCTE
</span><a href="#local-6989586621689232136"><span class="hs-identifier hs-var">cte</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689232135"><span class="annot"><span class="annottext">Seq PrepArg
</span><a href="#local-6989586621689232135"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621689232134"><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689232134"><span class="hs-identifier hs-var">strfyNum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689232346"><span class="annot"><a href="#local-6989586621689232133"><span class="hs-identifier hs-type">mutationTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q.FromRes</span></span><span> </span><span class="annot"><a href="#local-6989586621689232346"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q.TxE</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232346"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-242"></span><span>      </span><span id="local-6989586621689232133"><span class="annot"><span class="annottext">mutationTx :: TxE QErr a
</span><a href="#local-6989586621689232133"><span class="hs-identifier hs-var hs-var">mutationTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-243"></span><span>        </span><span class="hs-comment">-- See Note [Prepared statements in Mutations]</span><span>
</span><span id="line-244"></span><span>        </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr) -&gt; Query -&gt; [PrepArg] -&gt; Bool -&gt; TxE QErr a
forall (m :: * -&gt; *) a e.
(MonadIO m, FromRes a) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; [PrepArg] -&gt; Bool -&gt; TxET e m a
</span><span class="hs-identifier hs-var">Q.rawQE</span></span><span> </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#dmlTxErrorHandler"><span class="hs-identifier hs-var">dmlTxErrorHandler</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621689232132"><span class="hs-identifier hs-var">sqlText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq PrepArg -&gt; [PrepArg]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Seq PrepArg
</span><a href="#local-6989586621689232135"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">MutationCTE -&gt; Bool
</span><a href="Hasura.Backends.Postgres.Translate.Returning.html#checkPermissionRequired"><span class="hs-identifier hs-var">checkPermissionRequired</span></a></span><span> </span><span class="annot"><span class="annottext">MutationCTE
</span><a href="#local-6989586621689232136"><span class="hs-identifier hs-var">cte</span></a></span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TxET QErr IO (MutateResp ('Postgres pgKind) TxtEncodedVal, Bool)
-&gt; TxE QErr (MutateResp ('Postgres pgKind) TxtEncodedVal)
forall (m :: * -&gt; *) a. MonadError QErr m =&gt; m (a, Bool) -&gt; m a
</span><a href="Hasura.Backends.Postgres.Execute.Mutation.html#withCheckPermission"><span class="hs-identifier hs-var">withCheckPermission</span></a></span><span> </span><span class="annot"><span class="annottext">(TxET QErr IO (MutateResp ('Postgres pgKind) TxtEncodedVal, Bool)
 -&gt; TxE QErr (MutateResp ('Postgres pgKind) TxtEncodedVal))
-&gt; TxET QErr IO (MutateResp ('Postgres pgKind) TxtEncodedVal, Bool)
-&gt; TxE QErr (MutateResp ('Postgres pgKind) TxtEncodedVal)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal)
 -&gt; MutateResp ('Postgres pgKind) TxtEncodedVal)
-&gt; (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal), Bool)
-&gt; (MutateResp ('Postgres pgKind) TxtEncodedVal, Bool)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal)
-&gt; MutateResp ('Postgres pgKind) TxtEncodedVal
forall a. AltJ a -&gt; a
</span><span class="hs-identifier hs-var hs-var">Q.getAltJ</span></span><span> </span><span class="annot"><span class="annottext">((AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal), Bool)
 -&gt; (MutateResp ('Postgres pgKind) TxtEncodedVal, Bool))
-&gt; (SingleRow
      (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal), Bool)
    -&gt; (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal), Bool))
-&gt; SingleRow
     (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal), Bool)
-&gt; (MutateResp ('Postgres pgKind) TxtEncodedVal, Bool)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SingleRow
  (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal), Bool)
-&gt; (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal), Bool)
forall a. SingleRow a -&gt; a
</span><span class="hs-identifier hs-var hs-var">Q.getRow</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SingleRow
   (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal), Bool)
 -&gt; (MutateResp ('Postgres pgKind) TxtEncodedVal, Bool))
-&gt; TxET
     QErr
     IO
     (SingleRow
        (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal), Bool))
-&gt; TxET QErr IO (MutateResp ('Postgres pgKind) TxtEncodedVal, Bool)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxET
  QErr
  IO
  (SingleRow
     (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal), Bool))
forall a. FromRes a =&gt; TxE QErr a
</span><a href="#local-6989586621689232133"><span class="hs-identifier hs-var">mutationTx</span></a></span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal)
-&gt; MutateResp ('Postgres pgKind) TxtEncodedVal
forall a. AltJ a -&gt; a
</span><span class="hs-identifier hs-var hs-var">Q.getAltJ</span></span><span> </span><span class="annot"><span class="annottext">(AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal)
 -&gt; MutateResp ('Postgres pgKind) TxtEncodedVal)
-&gt; (SingleRow
      (Identity (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal)))
    -&gt; AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal))
-&gt; SingleRow
     (Identity (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal)))
-&gt; MutateResp ('Postgres pgKind) TxtEncodedVal
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Identity (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal))
-&gt; AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal)
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal))
 -&gt; AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal))
-&gt; (SingleRow
      (Identity (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal)))
    -&gt; Identity (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal)))
-&gt; SingleRow
     (Identity (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal)))
-&gt; AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SingleRow
  (Identity (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal)))
-&gt; Identity (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal))
forall a. SingleRow a -&gt; a
</span><span class="hs-identifier hs-var hs-var">Q.getRow</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SingleRow
   (Identity (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal)))
 -&gt; MutateResp ('Postgres pgKind) TxtEncodedVal)
-&gt; TxET
     QErr
     IO
     (SingleRow
        (Identity (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal))))
-&gt; TxE QErr (MutateResp ('Postgres pgKind) TxtEncodedVal)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxET
  QErr
  IO
  (SingleRow
     (Identity (AltJ (MutateResp ('Postgres pgKind) TxtEncodedVal))))
forall a. FromRes a =&gt; TxE QErr a
</span><a href="#local-6989586621689232133"><span class="hs-identifier hs-var">mutationTx</span></a></span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-250"></span><span>    </span><span id="local-6989586621689232130"><span class="annot"><span class="annottext">rawAliasIdentifier :: Text
</span><a href="#local-6989586621689232130"><span class="hs-identifier hs-var hs-var">rawAliasIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; Text
forall a. ToTxt a =&gt; QualifiedObject a -&gt; Text
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#qualifiedObjectToText"><span class="hs-identifier hs-var">qualifiedObjectToText</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621689232138"><span class="hs-identifier hs-var">qt</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;__mutation_result&quot;</span></span><span>
</span><span id="line-251"></span><span>    </span><span id="local-6989586621689232128"><span class="annot"><span class="annottext">aliasIdentifier :: Identifier
</span><a href="#local-6989586621689232128"><span class="hs-identifier hs-var hs-var">aliasIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689232130"><span class="hs-identifier hs-var">rawAliasIdentifier</span></a></span><span>
</span><span id="line-252"></span><span>    </span><span id="local-6989586621689232126"><span class="annot"><span class="annottext">tabFrom :: SelectFromG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621689232126"><span class="hs-identifier hs-var hs-var">tabFrom</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FIIdentifier -&gt; SelectFromG ('Postgres pgKind) SQLExp
forall (b :: BackendType) v. FIIdentifier -&gt; SelectFromG b v
</span><a href="Hasura.RQL.IR.Select.html#FromIdentifier"><span class="hs-identifier hs-var">FromIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(FIIdentifier -&gt; SelectFromG ('Postgres pgKind) SQLExp)
-&gt; FIIdentifier -&gt; SelectFromG ('Postgres pgKind) SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FIIdentifier
</span><a href="Hasura.RQL.IR.Select.html#FIIdentifier"><span class="hs-identifier hs-var">FIIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689232130"><span class="hs-identifier hs-var">rawAliasIdentifier</span></a></span><span>
</span><span id="line-253"></span><span>    </span><span id="local-6989586621689232123"><span class="annot"><span class="annottext">tabPerm :: TablePermG b v
</span><a href="#local-6989586621689232123"><span class="hs-identifier hs-var hs-var">tabPerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnBoolExp b v -&gt; Maybe Int -&gt; TablePermG b v
forall (b :: BackendType) v.
AnnBoolExp b v -&gt; Maybe Int -&gt; TablePermG b v
</span><a href="Hasura.RQL.IR.Select.html#TablePerm"><span class="hs-identifier hs-var">TablePerm</span></a></span><span> </span><span class="annot"><span class="annottext">AnnBoolExp b v
forall (backend :: BackendType) a. AnnBoolExp backend a
</span><a href="Hasura.RQL.IR.BoolExp.html#annBoolExpTrue"><span class="hs-identifier hs-var">annBoolExpTrue</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-254"></span><span>    </span><span id="local-6989586621689232120"><span class="annot"><span class="annottext">selFlds :: [(FieldName, AnnFieldG ('Postgres pgKind) Void SQLExp)]
</span><a href="#local-6989586621689232120"><span class="hs-identifier hs-var hs-var">selFlds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ColumnInfo ('Postgres pgKind)
  -&gt; (FieldName, AnnFieldG ('Postgres pgKind) Void SQLExp))
 -&gt; [ColumnInfo ('Postgres pgKind)]
 -&gt; [(FieldName, AnnFieldG ('Postgres pgKind) Void SQLExp)])
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; (ColumnInfo ('Postgres pgKind)
    -&gt; (FieldName, AnnFieldG ('Postgres pgKind) Void SQLExp))
-&gt; [(FieldName, AnnFieldG ('Postgres pgKind) Void SQLExp)]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(ColumnInfo ('Postgres pgKind)
 -&gt; (FieldName, AnnFieldG ('Postgres pgKind) Void SQLExp))
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; [(FieldName, AnnFieldG ('Postgres pgKind) Void SQLExp)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[ColumnInfo ('Postgres pgKind)]
</span><a href="#local-6989586621689232137"><span class="hs-identifier hs-var">cols</span></a></span><span> </span><span class="annot"><span class="annottext">((ColumnInfo ('Postgres pgKind)
  -&gt; (FieldName, AnnFieldG ('Postgres pgKind) Void SQLExp))
 -&gt; [(FieldName, AnnFieldG ('Postgres pgKind) Void SQLExp)])
-&gt; (ColumnInfo ('Postgres pgKind)
    -&gt; (FieldName, AnnFieldG ('Postgres pgKind) Void SQLExp))
-&gt; [(FieldName, AnnFieldG ('Postgres pgKind) Void SQLExp)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-255"></span><span>      </span><span class="hs-glyph">\</span><span id="local-6989586621689232118"><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621689232118"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Backend ('Postgres pgKind) =&gt;
Column ('Postgres pgKind) -&gt; FieldName
forall (b :: BackendType). Backend b =&gt; Column b -&gt; FieldName
</span><a href="Hasura.RQL.Types.Column.html#fromCol"><span class="hs-identifier hs-var">fromCol</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689232402"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Column ('Postgres pgKind) -&gt; FieldName)
-&gt; Column ('Postgres pgKind) -&gt; FieldName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind) -&gt; Column ('Postgres pgKind)
forall (b :: BackendType). ColumnInfo b -&gt; Column b
</span><a href="Hasura.RQL.Types.Column.html#ciColumn"><span class="hs-identifier hs-var hs-var">ciColumn</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621689232118"><span class="hs-identifier hs-var">ci</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
-&gt; AnnFieldG ('Postgres pgKind) Void SQLExp
forall (backend :: BackendType) r v.
ColumnInfo backend -&gt; AnnFieldG backend r v
</span><a href="Hasura.RQL.IR.Select.html#mkAnnColumnFieldAsText"><span class="hs-identifier hs-var">mkAnnColumnFieldAsText</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621689232118"><span class="hs-identifier hs-var">ci</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span>    </span><span id="local-6989586621689232132"><span class="annot"><span class="annottext">sqlText :: Query
</span><a href="#local-6989586621689232132"><span class="hs-identifier hs-var hs-var">sqlText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Query
</span><span class="hs-identifier hs-var">Q.fromBuilder</span></span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; Query) -&gt; Builder -&gt; Query
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SelectWith -&gt; Builder
forall a. ToSQL a =&gt; a -&gt; Builder
</span><a href="Hasura.SQL.Types.html#toSQL"><span class="hs-identifier hs-var">toSQL</span></a></span><span> </span><span class="annot"><span class="annottext">SelectWith
</span><a href="#local-6989586621689232114"><span class="hs-identifier hs-var">selectWith</span></a></span><span>
</span><span id="line-258"></span><span>    </span><span id="local-6989586621689232114"><span class="annot"><span class="annottext">selectWith :: SelectWith
</span><a href="#local-6989586621689232114"><span class="hs-identifier hs-var hs-var">selectWith</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Alias, CTE)] -&gt; Select -&gt; SelectWith
forall v. [(Alias, v)] -&gt; Select -&gt; SelectWithG v
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SelectWith"><span class="hs-identifier hs-var">S.SelectWith</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689232128"><span class="hs-identifier hs-var">aliasIdentifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MutationCTE -&gt; CTE
</span><a href="Hasura.Backends.Postgres.Translate.Returning.html#getMutationCTE"><span class="hs-identifier hs-var">getMutationCTE</span></a></span><span> </span><span class="annot"><span class="annottext">MutationCTE
</span><a href="#local-6989586621689232136"><span class="hs-identifier hs-var">cte</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621689232110"><span class="hs-identifier hs-var">select</span></a></span><span>
</span><span id="line-259"></span><span>    </span><span id="local-6989586621689232110"><span class="annot"><span class="annottext">select :: Select
</span><a href="#local-6989586621689232110"><span class="hs-identifier hs-var hs-var">select</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-260"></span><span>      </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-261"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-262"></span><span>            </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621689232106"><span class="hs-identifier hs-var">extrExp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Alias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Extractor -&gt; [Extractor] -&gt; [Extractor]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-263"></span><span>            </span><span class="annot"><span class="annottext">[Extractor] -&gt; [Extractor] -&gt; Bool -&gt; [Extractor]
forall a. a -&gt; a -&gt; Bool -&gt; a
</span><span class="hs-identifier hs-var">bool</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621689232105"><span class="hs-identifier hs-var">checkErrExp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Alias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutationCTE -&gt; Bool
</span><a href="Hasura.Backends.Postgres.Translate.Returning.html#checkPermissionRequired"><span class="hs-identifier hs-var">checkPermissionRequired</span></a></span><span> </span><span class="annot"><span class="annottext">MutationCTE
</span><a href="#local-6989586621689232136"><span class="hs-identifier hs-var">cte</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-265"></span><span>    </span><span id="local-6989586621689232105"><span class="annot"><span class="annottext">checkErrExp :: SQLExp
</span><a href="#local-6989586621689232105"><span class="hs-identifier hs-var hs-var">checkErrExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
forall a. IsIdentifier a =&gt; a -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Returning.html#mkCheckErrorExp"><span class="hs-identifier hs-var">mkCheckErrorExp</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689232128"><span class="hs-identifier hs-var">aliasIdentifier</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span id="local-6989586621689232106"><span class="annot"><span class="annottext">extrExp :: SQLExp
</span><a href="#local-6989586621689232106"><span class="hs-identifier hs-var hs-var">extrExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-267"></span><span>      </span><span class="annot"><span class="annottext">[SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyJsonBuildObj"><span class="hs-identifier hs-var">S.applyJsonBuildObj</span></a></span><span>
</span><span id="line-268"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;affected_rows&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-269"></span><span>          </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621689232101"><span class="hs-identifier hs-var">affRowsSel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-270"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;returning_columns&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-271"></span><span>          </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621689232100"><span class="hs-identifier hs-var">colSel</span></a></span><span>
</span><span id="line-272"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span>    </span><span id="local-6989586621689232101"><span class="annot"><span class="annottext">affRowsSel :: SQLExp
</span><a href="#local-6989586621689232101"><span class="hs-identifier hs-var hs-var">affRowsSel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-275"></span><span>      </span><span class="annot"><span class="annottext">Select -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SESelect"><span class="hs-identifier hs-var">S.SESelect</span></a></span><span> </span><span class="annot"><span class="annottext">(Select -&gt; SQLExp) -&gt; Select -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-276"></span><span>        </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-277"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#countStar"><span class="hs-identifier hs-var">S.countStar</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Alias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-278"></span><span>            </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FromItem] -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FromExp"><span class="hs-identifier hs-var">S.FromExp</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Identifier -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FIIdentifier"><span class="hs-identifier hs-var">S.FIIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621689232128"><span class="hs-identifier hs-var">aliasIdentifier</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-279"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-280"></span><span>    </span><span id="local-6989586621689232100"><span class="annot"><span class="annottext">colSel :: SQLExp
</span><a href="#local-6989586621689232100"><span class="hs-identifier hs-var hs-var">colSel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-281"></span><span>      </span><span class="annot"><span class="annottext">Select -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SESelect"><span class="hs-identifier hs-var">S.SESelect</span></a></span><span> </span><span class="annot"><span class="annottext">(Select -&gt; SQLExp) -&gt; Select -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-282"></span><span>        </span><span class="annot"><span class="annottext">JsonAggSelect -&gt; AnnSimpleSelect ('Postgres pgKind) -&gt; Select
forall (pgKind :: PostgresKind).
(Backend ('Postgres pgKind), PostgresAnnotatedFieldJSON pgKind) =&gt;
JsonAggSelect -&gt; AnnSimpleSelect ('Postgres pgKind) -&gt; Select
</span><a href="Hasura.Backends.Postgres.Translate.Select.Simple.html#mkSQLSelect"><span class="hs-identifier hs-var">mkSQLSelect</span></a></span><span> </span><span class="annot"><span class="annottext">JsonAggSelect
</span><a href="Hasura.RQL.Types.Common.html#JASMultipleRows"><span class="hs-identifier hs-var">JASMultipleRows</span></a></span><span> </span><span class="annot"><span class="annottext">(AnnSimpleSelect ('Postgres pgKind) -&gt; Select)
-&gt; AnnSimpleSelect ('Postgres pgKind) -&gt; Select
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-283"></span><span>          </span><span class="annot"><span class="annottext">[(FieldName, AnnFieldG ('Postgres pgKind) Void SQLExp)]
-&gt; SelectFromG ('Postgres pgKind) SQLExp
-&gt; TablePermG ('Postgres pgKind) SQLExp
-&gt; SelectArgsG ('Postgres pgKind) SQLExp
-&gt; StringifyNumbers
-&gt; AnnSelectG
     ('Postgres pgKind) (AnnFieldG ('Postgres pgKind) Void) SQLExp
forall (b :: BackendType) (f :: * -&gt; *) v.
Fields (f v)
-&gt; SelectFromG b v
-&gt; TablePermG b v
-&gt; SelectArgsG b v
-&gt; StringifyNumbers
-&gt; AnnSelectG b f v
</span><a href="Hasura.RQL.IR.Select.html#AnnSelectG"><span class="hs-identifier hs-var">AnnSelectG</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldName, AnnFieldG ('Postgres pgKind) Void SQLExp)]
</span><a href="#local-6989586621689232120"><span class="hs-identifier hs-var">selFlds</span></a></span><span> </span><span class="annot"><span class="annottext">SelectFromG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621689232126"><span class="hs-identifier hs-var">tabFrom</span></a></span><span> </span><span class="annot"><span class="annottext">TablePermG ('Postgres pgKind) SQLExp
forall (b :: BackendType) v. TablePermG b v
</span><a href="#local-6989586621689232123"><span class="hs-identifier hs-var">tabPerm</span></a></span><span> </span><span class="annot"><span class="annottext">SelectArgsG ('Postgres pgKind) SQLExp
forall (backend :: BackendType) v. SelectArgsG backend v
</span><a href="Hasura.RQL.IR.Select.html#noSelectArgs"><span class="hs-identifier hs-var">noSelectArgs</span></a></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689232134"><span class="hs-identifier hs-var">strfyNum</span></a></span><span>
</span><span id="line-284"></span></pre></body></html>