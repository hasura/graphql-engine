<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE Arrows #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE OverloadedLabels #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">-- | Top-level functions concerned specifically with operations on the schema cache, such as</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- rebuilding it from the catalog and incorporating schema changes. See the module documentation for</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- &quot;Hasura.RQL.DDL.Schema&quot; for more details.</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- __Note__: this module is __mutually recursive__ with other @Hasura.RQL.DDL.Schema.*@ modules, which</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- both define pieces of the implementation of building the schema cache and define handlers that</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- trigger schema cache rebuilds.</span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.RQL.DDL.Schema.Cache</span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier">RebuildableSchemaCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#lastBuiltSchemaCache"><span class="hs-identifier">lastBuiltSchemaCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#buildRebuildableSchemaCache"><span class="hs-identifier">buildRebuildableSchemaCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier">CacheRWT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#runCacheRWT"><span class="hs-identifier">runCacheRWT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Permission.html#mkBooleanPermissionMap"><span class="hs-identifier">mkBooleanPermissionMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#saveSourcesIntrospection"><span class="hs-identifier">saveSourcesIntrospection</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">where</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html"><span class="hs-identifier">Control.Arrow.Extended</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Interpret.html"><span class="hs-identifier">Control.Arrow.Interpret</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-70a68698e02c1d9dc133c543e6497a7241e5514570afd4815da4baf2a001e00e/share/doc/html/src/Control.Lens.html"><span class="hs-identifier">Control.Lens</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-70a68698e02c1d9dc133c543e6497a7241e5514570afd4815da4baf2a001e00e/share/doc/html/src/Control.Lens.Setter.html#.%3D"><span class="hs-operator">(.=)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-92f8a47f193bc8ca499a8b94581fad6cb68b7a26370b271798ac2ec617c05064/share/doc/html/src/Control.Monad.Trans.Control.html"><span class="hs-identifier">Control.Monad.Trans.Control</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-92f8a47f193bc8ca499a8b94581fad6cb68b7a26370b271798ac2ec617c05064/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier">MonadBaseControl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/retry-0.9.3.0-406412e79c1f0d5bab239d04f2d7ebdcd3ce7260d36a0fa430724f47b107aa29/share/doc/html/src/Control.Retry.html"><span class="hs-identifier">Control.Retry</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Retry</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.html"><span class="hs-identifier">Data.Aeson</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LBS</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isLeft</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Environment.html"><span class="hs-identifier">Data.Environment</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Env</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/data-has-0.4.0.0-046b1b301c44f043005ecffcde95c748cd1a5249e8b9e9ea3eaa14bac0030231/share/doc/html/src/Data.Has.html"><span class="hs-identifier">Data.Has</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.HashMap.Strict.Extended.html"><span class="hs-identifier">Data.HashMap.Strict.Extended</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HashMap</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.HashMap.Strict.InsOrd.Extended.html"><span class="hs-identifier">Data.HashMap.Strict.InsOrd.Extended</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">InsOrdHashMap</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashSet.html"><span class="hs-identifier">Data.HashSet</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HS</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Seq</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-27d8e86ddce8dd754c06549efa10988301d41e208fc11cac9fe9ed6d99d6eb35/share/doc/html/src/Data.Text.html"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html"><span class="hs-identifier">Data.Text.Extended</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html"><span class="hs-identifier">Hasura.Base.Error</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html"><span class="hs-identifier">Hasura.EncJSON</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Eventing.Backend.html"><span class="hs-identifier">Hasura.Eventing.Backend</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Function.API.html"><span class="hs-identifier">Hasura.Function.API</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Function.Cache.html"><span class="hs-identifier">Hasura.Function.Cache</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Function.Metadata.html"><span class="hs-identifier">Hasura.Function.Metadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Function.Metadata.html#FunctionMetadata"><span class="hs-identifier">FunctionMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.html"><span class="hs-identifier">Hasura.GraphQL.Schema</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Schema.html#buildGQLContext"><span class="hs-identifier">buildGQLContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.html"><span class="hs-identifier">Hasura.Incremental</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Inc</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Logging.html"><span class="hs-identifier">Hasura.Logging</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.LogicalModel.Cache.html"><span class="hs-identifier">Hasura.LogicalModel.Cache</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.LogicalModel.Cache.html#LogicalModelCache"><span class="hs-identifier">LogicalModelCache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.LogicalModel.Cache.html#LogicalModelInfo"><span class="hs-identifier">LogicalModelInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.LogicalModel.Metadata.html"><span class="hs-identifier">Hasura.LogicalModel.Metadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.LogicalModel.Metadata.html#LogicalModelMetadata"><span class="hs-identifier">LogicalModelMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.LogicalModel.Types.html"><span class="hs-identifier">Hasura.LogicalModel.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.LogicalModel.Types.html#LogicalModelField"><span class="hs-identifier">LogicalModelField</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.LogicalModel.Types.html#LogicalModelType"><span class="hs-identifier">LogicalModelType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.LogicalModel.Types.html#LogicalModelTypeArray"><span class="hs-identifier">LogicalModelTypeArray</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.LogicalModel.Types.html#LogicalModelTypeReference"><span class="hs-identifier">LogicalModelTypeReference</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Metadata.Class.html"><span class="hs-identifier">Hasura.Metadata.Class</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.NativeQuery.Cache.html"><span class="hs-identifier">Hasura.NativeQuery.Cache</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.NativeQuery.Cache.html#NativeQueryCache"><span class="hs-identifier">NativeQueryCache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.NativeQuery.Cache.html#NativeQueryInfo"><span class="hs-identifier">NativeQueryInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.NativeQuery.Metadata.html"><span class="hs-identifier">Hasura.NativeQuery.Metadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.NativeQuery.Metadata.html#NativeQueryMetadata"><span class="hs-identifier">NativeQueryMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html"><span class="hs-identifier">Hasura.Prelude</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.QueryTags.html"><span class="hs-identifier">Hasura.QueryTags</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Action.html"><span class="hs-identifier">Hasura.RQL.DDL.Action</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.CustomTypes.html"><span class="hs-identifier">Hasura.RQL.DDL.CustomTypes</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html"><span class="hs-identifier">Hasura.RQL.DDL.EventTrigger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier">MonadEventLogCleanup</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#buildEventTriggerInfo"><span class="hs-identifier">buildEventTriggerInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.InheritedRoles.html"><span class="hs-identifier">Hasura.RQL.DDL.InheritedRoles</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.InheritedRoles.html#resolveInheritedRole"><span class="hs-identifier">resolveInheritedRole</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.OpenTelemetry.html"><span class="hs-identifier">Hasura.RQL.DDL.OpenTelemetry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.OpenTelemetry.html#parseOtelBatchSpanProcessorConfig"><span class="hs-identifier">parseOtelBatchSpanProcessorConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.OpenTelemetry.html#parseOtelExporterConfig"><span class="hs-identifier">parseOtelExporterConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Relationship.html"><span class="hs-identifier">Hasura.RQL.DDL.Relationship</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.RemoteRelationship.html"><span class="hs-identifier">Hasura.RQL.DDL.RemoteRelationship</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.RemoteRelationship.html#CreateRemoteSchemaRemoteRelationship"><span class="hs-identifier">CreateRemoteSchemaRemoteRelationship</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.RemoteRelationship.html#PartiallyResolvedSource"><span class="hs-identifier">PartiallyResolvedSource</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.RemoteRelationship.html#buildRemoteFieldInfo"><span class="hs-identifier">buildRemoteFieldInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.RemoteRelationship.html#getRemoteSchemaEntityJoinColumns"><span class="hs-identifier">getRemoteSchemaEntityJoinColumns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.ScheduledTrigger.html"><span class="hs-identifier">Hasura.RQL.DDL.ScheduledTrigger</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema.Cache.Common</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema.Cache.Config</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Dependencies.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema.Cache.Dependencies</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Fields.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema.Cache.Fields</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Permission.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema.Cache.Permission</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.SchemaRegistry.html"><span class="hs-identifier">Hasura.RQL.DDL.SchemaRegistry</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Action.html"><span class="hs-identifier">Hasura.RQL.Types.Action</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Allowlist.html"><span class="hs-identifier">Hasura.RQL.Types.Allowlist</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html"><span class="hs-identifier">Hasura.RQL.Types.Backend</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.BackendTag.html"><span class="hs-identifier">Hasura.RQL.Types.BackendTag</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html"><span class="hs-identifier">Hasura.RQL.Types.BackendType</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Column.html"><span class="hs-identifier">Hasura.RQL.Types.Column</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html"><span class="hs-identifier">Hasura.RQL.Types.Common</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.CustomTypes.html"><span class="hs-identifier">Hasura.RQL.Types.CustomTypes</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html"><span class="hs-identifier">Hasura.RQL.Types.Endpoint</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html"><span class="hs-identifier">Hasura.RQL.Types.EventTrigger</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html"><span class="hs-identifier">Hasura.RQL.Types.Metadata</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html"><span class="hs-identifier">Hasura.RQL.Types.Metadata.Backend</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html"><span class="hs-identifier">Hasura.RQL.Types.Metadata.Object</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.NamingCase.html"><span class="hs-identifier">Hasura.RQL.Types.NamingCase</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.OpenTelemetry.html"><span class="hs-identifier">Hasura.RQL.Types.OpenTelemetry</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html"><span class="hs-identifier">Hasura.RQL.Types.QueryCollection</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Relationships.Remote.html"><span class="hs-identifier">Hasura.RQL.Types.Relationships.Remote</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Roles.html"><span class="hs-identifier">Hasura.RQL.Types.Roles</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html"><span class="hs-identifier">Hasura.RQL.Types.ScheduledTrigger</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCache</span></a></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCache.Build</span></a></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Instances.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCache.Instances</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCacheTypes.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCacheTypes</span></a></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html"><span class="hs-identifier">Hasura.RQL.Types.Source</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SourceCustomization.html"><span class="hs-identifier">Hasura.RQL.Types.SourceCustomization</span></a></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RemoteSchema.Metadata.html"><span class="hs-identifier">Hasura.RemoteSchema.Metadata</span></a></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RemoteSchema.SchemaCache.html"><span class="hs-identifier">Hasura.RemoteSchema.SchemaCache</span></a></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.AnyBackend.html"><span class="hs-identifier">Hasura.SQL.AnyBackend</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AB</span></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.BackendMap.html"><span class="hs-identifier">Hasura.SQL.BackendMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.SQL.BackendMap.html#BackendMap"><span class="hs-identifier">BackendMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.BackendMap.html"><span class="hs-identifier">Hasura.SQL.BackendMap</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BackendMap</span></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.FeatureFlag.html"><span class="hs-identifier">Hasura.Server.Init.FeatureFlag</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FF</span></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Migrate.Version.html"><span class="hs-identifier">Hasura.Server.Migrate.Version</span></a></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html"><span class="hs-identifier">Hasura.Server.Types</span></a></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Services.html"><span class="hs-identifier">Hasura.Services</span></a></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Session.html"><span class="hs-identifier">Hasura.Session</span></a></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.StoredProcedure.Cache.html"><span class="hs-identifier">Hasura.StoredProcedure.Cache</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.StoredProcedure.Cache.html#StoredProcedureCache"><span class="hs-identifier">StoredProcedureCache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.StoredProcedure.Cache.html#StoredProcedureInfo"><span class="hs-identifier">StoredProcedureInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.StoredProcedure.Metadata.html"><span class="hs-identifier">Hasura.StoredProcedure.Metadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.StoredProcedure.Metadata.html#StoredProcedureMetadata"><span class="hs-identifier">StoredProcedureMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Table.API.html"><span class="hs-identifier">Hasura.Table.API</span></a></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Table.Cache.html"><span class="hs-identifier">Hasura.Table.Cache</span></a></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Table.Metadata.html"><span class="hs-identifier">Hasura.Table.Metadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Table.Metadata.html#TableMetadata"><span class="hs-identifier">TableMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Tracing.html"><span class="hs-identifier">Hasura.Tracing</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Tracing</span></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src/Language.GraphQL.Draft.Syntax.html"><span class="hs-identifier">Language.GraphQL.Draft.Syntax</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">G</span></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.Types.Extended.html"><span class="hs-identifier">Network.Types.Extended</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-comment">{- Note [Roles Inheritance]
~~~~~~~~~~~~~~~~~~~~~~~~~~~

Roles may have parent roles defined from which they can inherit permission and this is
called as roles inheritance. Roles which have parents can also be parents of other roles.
So, cycle in roles should be disallowed and this is done in the `orderRoles` function.

When the metadata contains a permission for a role for a entity, then it will override the
inherited permission, if any.

Roles inheritance work differently for different features:

1. Select permissions
~~~~~~~~~~~~~~~~~~~~~

See note [Inherited roles architecture for read queries]

2. Mutation permissions and remote schema permissions
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

For mutation and remote schema permissions, an inherited role can only inherit permission
from its parent roles when the relevant parts of the permissions are equal i.e. the non-relevant
parts are discarded for the equality, for example, in two remote schema permissions the order
of the fields in an Object type is discarded.

When an inherited role cannot inherit permission from its parents due to a conflict, then we mark
the inherited role and the entity (remote schema or table) combination as inconsistent in the metadata.

3. Actions and Custom function permissions
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Currently, actions and custom function permissions can be thought of as a boolean. Either a role has
permission to the entity or it doesn't, so in these cases there's no possiblity of a conflict. An inherited
role will have access to the action/function if any one of the parents have permission to access the
action/function.

-}</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#buildRebuildableSchemaCache"><span class="hs-identifier hs-type">buildRebuildableSchemaCache</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-156"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Environment.html#Environment"><span class="hs-identifier hs-type">Env.Environment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#MetadataWithResourceVersion"><span class="hs-identifier hs-type">MetadataWithResourceVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-159"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#CacheDynamicConfig"><span class="hs-identifier hs-type">CacheDynamicConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-160"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.SchemaRegistry.html#SchemaRegistryContext"><span class="hs-identifier hs-type">SchemaRegistryContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-161"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#CacheBuild"><span class="hs-identifier hs-type">CacheBuild</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span><span>
</span><span id="line-162"></span><span id="buildRebuildableSchemaCache"><span class="annot"><span class="annottext">buildRebuildableSchemaCache :: Logger Hasura
-&gt; Environment
-&gt; MetadataWithResourceVersion
-&gt; CacheDynamicConfig
-&gt; Maybe SchemaRegistryContext
-&gt; CacheBuild RebuildableSchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildRebuildableSchemaCache"><span class="hs-identifier hs-var hs-var">buildRebuildableSchemaCache</span></a></span></span><span> </span><span id="local-6989586621687410930"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687410930"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621687410931"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621687410931"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621687410932"><span class="annot"><span class="annottext">MetadataWithResourceVersion
</span><a href="#local-6989586621687410932"><span class="hs-identifier hs-var">metadataWithVersion</span></a></span></span><span> </span><span id="local-6989586621687410933"><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687410933"><span class="hs-identifier hs-var">dynamicConfig</span></a></span></span><span> </span><span id="local-6989586621687410934"><span class="annot"><span class="annottext">Maybe SchemaRegistryContext
</span><a href="#local-6989586621687410934"><span class="hs-identifier hs-var">mSchemaRegistryContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-163"></span><span>  </span><span id="local-6989586621687410935"><span class="annot"><span class="annottext">Result
  (ReaderT BuildReason CacheBuild)
  (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
   Maybe StoredIntrospection)
  (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
</span><a href="#local-6989586621687410935"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><span class="annottext">(ReaderT
   BuildReason
   CacheBuild
   (Result
      (ReaderT BuildReason CacheBuild)
      (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
       Maybe StoredIntrospection)
      (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
 -&gt; BuildReason
 -&gt; CacheBuild
      (Result
         (ReaderT BuildReason CacheBuild)
         (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
          Maybe StoredIntrospection)
         (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))))
-&gt; BuildReason
-&gt; ReaderT
     BuildReason
     CacheBuild
     (Result
        (ReaderT BuildReason CacheBuild)
        (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
         Maybe StoredIntrospection)
        (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
-&gt; CacheBuild
     (Result
        (ReaderT BuildReason CacheBuild)
        (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
         Maybe StoredIntrospection)
        (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ReaderT
  BuildReason
  CacheBuild
  (Result
     (ReaderT BuildReason CacheBuild)
     (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
      Maybe StoredIntrospection)
     (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
-&gt; BuildReason
-&gt; CacheBuild
     (Result
        (ReaderT BuildReason CacheBuild)
        (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
         Maybe StoredIntrospection)
        (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">BuildReason
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogSync"><span class="hs-identifier hs-var">CatalogSync</span></a></span><span>
</span><span id="line-165"></span><span>      </span><span class="annot"><span class="annottext">(ReaderT
   BuildReason
   CacheBuild
   (Result
      (ReaderT BuildReason CacheBuild)
      (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
       Maybe StoredIntrospection)
      (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
 -&gt; CacheBuild
      (Result
         (ReaderT BuildReason CacheBuild)
         (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
          Maybe StoredIntrospection)
         (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))))
-&gt; ReaderT
     BuildReason
     CacheBuild
     (Result
        (ReaderT BuildReason CacheBuild)
        (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
         Maybe StoredIntrospection)
        (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
-&gt; CacheBuild
     (Result
        (ReaderT BuildReason CacheBuild)
        (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
         Maybe StoredIntrospection)
        (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rule
  (ReaderT BuildReason CacheBuild)
  (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
   Maybe StoredIntrospection)
  (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
-&gt; (MetadataWithResourceVersion, CacheDynamicConfig,
    InvalidationKeys, Maybe StoredIntrospection)
-&gt; ReaderT
     BuildReason
     CacheBuild
     (Result
        (ReaderT BuildReason CacheBuild)
        (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
         Maybe StoredIntrospection)
        (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
Rule m a b -&gt; a -&gt; m (Result m a b)
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Rule.html#build"><span class="hs-identifier hs-var">Inc.build</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger Hasura
-&gt; Environment
-&gt; Maybe SchemaRegistryContext
-&gt; Rule
     (ReaderT BuildReason CacheBuild)
     (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
      Maybe StoredIntrospection)
     (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowDistribute arr, ArrowCache m arr, MonadIO m,
 MonadBaseControl IO m, MonadError QErr m,
 MonadReader BuildReason m, ProvidesNetwork m, MonadResolveSource m,
 HasCacheStaticConfig m) =&gt;
Logger Hasura
-&gt; Environment
-&gt; Maybe SchemaRegistryContext
-&gt; arr
     (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
      Maybe StoredIntrospection)
     (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildSchemaCacheRule"><span class="hs-identifier hs-var">buildSchemaCacheRule</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687410930"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621687410931"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SchemaRegistryContext
</span><a href="#local-6989586621687410934"><span class="hs-identifier hs-var">mSchemaRegistryContext</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetadataWithResourceVersion
</span><a href="#local-6989586621687410932"><span class="hs-identifier hs-var">metadataWithVersion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687410933"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InvalidationKeys
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#initialInvalidationKeys"><span class="hs-identifier hs-var">initialInvalidationKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe StoredIntrospection
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span>  </span><span class="annot"><span class="annottext">RebuildableSchemaCache -&gt; CacheBuild RebuildableSchemaCache
forall a. a -&gt; CacheBuild a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(RebuildableSchemaCache -&gt; CacheBuild RebuildableSchemaCache)
-&gt; RebuildableSchemaCache -&gt; CacheBuild RebuildableSchemaCache
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SchemaCache
-&gt; InvalidationKeys
-&gt; Rule
     (ReaderT BuildReason CacheBuild)
     (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
      Maybe StoredIntrospection)
     (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
-&gt; RebuildableSchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-var">RebuildableSchemaCache</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
-&gt; SchemaCache
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
 -&gt; SchemaCache)
-&gt; (SchemaCache,
    (SourcesIntrospectionStatus, SchemaRegistryAction))
-&gt; SchemaCache
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Result
  (ReaderT BuildReason CacheBuild)
  (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
   Maybe StoredIntrospection)
  (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
-&gt; (SchemaCache,
    (SourcesIntrospectionStatus, SchemaRegistryAction))
forall {k} (m :: k -&gt; *) a b. Result m a b -&gt; b
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Rule.html#result"><span class="hs-identifier hs-var">Inc.result</span></a></span><span> </span><span class="annot"><span class="annottext">Result
  (ReaderT BuildReason CacheBuild)
  (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
   Maybe StoredIntrospection)
  (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
</span><a href="#local-6989586621687410935"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InvalidationKeys
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#initialInvalidationKeys"><span class="hs-identifier hs-var">initialInvalidationKeys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Result
  (ReaderT BuildReason CacheBuild)
  (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
   Maybe StoredIntrospection)
  (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
-&gt; Rule
     (ReaderT BuildReason CacheBuild)
     (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
      Maybe StoredIntrospection)
     (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
forall {k} (m :: k -&gt; *) a b. Result m a b -&gt; Rule m a b
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Rule.html#rebuildRule"><span class="hs-identifier hs-var">Inc.rebuildRule</span></a></span><span> </span><span class="annot"><span class="annottext">Result
  (ReaderT BuildReason CacheBuild)
  (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
   Maybe StoredIntrospection)
  (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
</span><a href="#local-6989586621687410935"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-keyword">newtype</span><span> </span><span id="CacheRWT"><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-var">CacheRWT</span></a></span></span><span> </span><span id="local-6989586621687409738"><span class="annot"><a href="#local-6989586621687409738"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621687409739"><span class="annot"><a href="#local-6989586621687409739"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- The CacheInvalidations component of the state could actually be collected</span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-comment">-- using WriterT, but WriterT implementations prior to transformers-0.5.6.0</span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-comment">-- (which added Control.Monad.Trans.Writer.CPS) are leaky, and we don&#8217;t have</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-comment">-- that yet.</span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-comment">-- The use of 'ReaderT CacheDynamicConfig' is only here to avoid manually</span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-comment">-- passing the 'CacheDynamicConfig' to every function that builds the cache. It</span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-comment">-- should ultimately be reduced to 'AppContext', or even better a relevant</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-comment">-- subset thereof.</span><span>
</span><span id="line-179"></span><span>    </span><span id="CacheRWT"><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-var">CacheRWT</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#CacheDynamicConfig"><span class="hs-identifier hs-type">CacheDynamicConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-type">CacheInvalidations</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#SourcesIntrospectionStatus"><span class="hs-identifier hs-type">SourcesIntrospectionStatus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.SchemaRegistry.html#SchemaRegistryAction"><span class="hs-identifier hs-type">SchemaRegistryAction</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687409738"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687409739"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-special">(</span><span> </span><span id="local-6989586621687410949"><span id="local-6989586621687410955"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; CacheRWT m a -&gt; CacheRWT m b)
-&gt; (forall a b. a -&gt; CacheRWT m b -&gt; CacheRWT m a)
-&gt; Functor (CacheRWT m)
forall a b. a -&gt; CacheRWT m b -&gt; CacheRWT m a
forall a b. (a -&gt; b) -&gt; CacheRWT m a -&gt; CacheRWT m b
forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; CacheRWT m b -&gt; CacheRWT m a
forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; CacheRWT m a -&gt; CacheRWT m b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; CacheRWT m a -&gt; CacheRWT m b
fmap :: forall a b. (a -&gt; b) -&gt; CacheRWT m a -&gt; CacheRWT m b
$c&lt;$ :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; CacheRWT m b -&gt; CacheRWT m a
&lt;$ :: forall a b. a -&gt; CacheRWT m b -&gt; CacheRWT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-182"></span><span>      </span><span id="local-6989586621687410967"><span id="local-6989586621687410972"><span id="local-6989586621687410977"><span id="local-6989586621687410982"><span id="local-6989586621687410987"><span class="annot"><span class="annottext">Functor (CacheRWT m)
Functor (CacheRWT m)
-&gt; (forall a. a -&gt; CacheRWT m a)
-&gt; (forall a b.
    CacheRWT m (a -&gt; b) -&gt; CacheRWT m a -&gt; CacheRWT m b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c) -&gt; CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m c)
-&gt; (forall a b. CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m b)
-&gt; (forall a b. CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m a)
-&gt; Applicative (CacheRWT m)
forall a. a -&gt; CacheRWT m a
forall a b. CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m a
forall a b. CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m b
forall a b. CacheRWT m (a -&gt; b) -&gt; CacheRWT m a -&gt; CacheRWT m b
forall a b c.
(a -&gt; b -&gt; c) -&gt; CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m c
forall {m :: * -&gt; *}. Monad m =&gt; Functor (CacheRWT m)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; CacheRWT m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m b
forall (m :: * -&gt; *) a b.
Monad m =&gt;
CacheRWT m (a -&gt; b) -&gt; CacheRWT m a -&gt; CacheRWT m b
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; b -&gt; c) -&gt; CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
$cpure :: forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; CacheRWT m a
pure :: forall a. a -&gt; CacheRWT m a
$c&lt;*&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
CacheRWT m (a -&gt; b) -&gt; CacheRWT m a -&gt; CacheRWT m b
&lt;*&gt; :: forall a b. CacheRWT m (a -&gt; b) -&gt; CacheRWT m a -&gt; CacheRWT m b
$cliftA2 :: forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; b -&gt; c) -&gt; CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m c
liftA2 :: forall a b c.
(a -&gt; b -&gt; c) -&gt; CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m c
$c*&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m b
*&gt; :: forall a b. CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m b
$c&lt;* :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m a
&lt;* :: forall a b. CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-183"></span><span>      </span><span id="local-6989586621687411001"><span id="local-6989586621687411007"><span id="local-6989586621687411012"><span class="annot"><span class="annottext">Applicative (CacheRWT m)
Applicative (CacheRWT m)
-&gt; (forall a b.
    CacheRWT m a -&gt; (a -&gt; CacheRWT m b) -&gt; CacheRWT m b)
-&gt; (forall a b. CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m b)
-&gt; (forall a. a -&gt; CacheRWT m a)
-&gt; Monad (CacheRWT m)
forall a. a -&gt; CacheRWT m a
forall a b. CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m b
forall a b. CacheRWT m a -&gt; (a -&gt; CacheRWT m b) -&gt; CacheRWT m b
forall (m :: * -&gt; *). Monad m =&gt; Applicative (CacheRWT m)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; CacheRWT m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m b
forall (m :: * -&gt; *) a b.
Monad m =&gt;
CacheRWT m a -&gt; (a -&gt; CacheRWT m b) -&gt; CacheRWT m b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
$c&gt;&gt;= :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
CacheRWT m a -&gt; (a -&gt; CacheRWT m b) -&gt; CacheRWT m b
&gt;&gt;= :: forall a b. CacheRWT m a -&gt; (a -&gt; CacheRWT m b) -&gt; CacheRWT m b
$c&gt;&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m b
&gt;&gt; :: forall a b. CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m b
$creturn :: forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; CacheRWT m a
return :: forall a. a -&gt; CacheRWT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-184"></span><span>      </span><span id="local-6989586621687411024"><span class="annot"><span class="annottext">Monad (CacheRWT m)
Monad (CacheRWT m)
-&gt; (forall a. IO a -&gt; CacheRWT m a) -&gt; MonadIO (CacheRWT m)
forall a. IO a -&gt; CacheRWT m a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. IO a -&gt; m a) -&gt; MonadIO m
forall {m :: * -&gt; *}. MonadIO m =&gt; Monad (CacheRWT m)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; CacheRWT m a
$cliftIO :: forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; CacheRWT m a
liftIO :: forall a. IO a -&gt; CacheRWT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></span></span><span class="hs-special">,</span><span>
</span><span id="line-185"></span><span>      </span><span id="local-6989586621687411032"><span id="local-6989586621687411038"><span id="local-6989586621687411043"><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="#local-6989586621687411032"><span class="hs-identifier hs-type">e</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-186"></span><span>      </span><span id="local-6989586621687411056"><span class="annot"><span class="annottext">Monad (CacheRWT m)
CacheRWT m UserInfo
Monad (CacheRWT m) -&gt; CacheRWT m UserInfo -&gt; UserInfoM (CacheRWT m)
forall (m :: * -&gt; *). Monad m -&gt; m UserInfo -&gt; UserInfoM m
forall {m :: * -&gt; *}. UserInfoM m =&gt; Monad (CacheRWT m)
forall (m :: * -&gt; *). UserInfoM m =&gt; CacheRWT m UserInfo
$caskUserInfo :: forall (m :: * -&gt; *). UserInfoM m =&gt; CacheRWT m UserInfo
askUserInfo :: CacheRWT m UserInfo
</span><a href="Hasura.RQL.Types.Session.html#UserInfoM"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">UserInfoM</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-187"></span><span>      </span><span id="local-6989586621687411070"><span id="local-6989586621687411076"><span id="local-6989586621687411081"><span id="local-6989586621687411086"><span id="local-6989586621687411091"><span id="local-6989586621687411096"><span id="local-6989586621687411101"><span id="local-6989586621687411106"><span id="local-6989586621687411111"><span id="local-6989586621687411116"><span id="local-6989586621687411121"><span id="local-6989586621687411126"><span id="local-6989586621687411131"><span id="local-6989586621687411136"><span id="local-6989586621687411141"><span id="local-6989586621687411146"><span id="local-6989586621687411151"><span id="local-6989586621687411156"><span id="local-6989586621687411161"><span id="local-6989586621687411166"><span id="local-6989586621687411171"><span id="local-6989586621687411176"><span id="local-6989586621687411181"><span id="local-6989586621687411186"><span id="local-6989586621687411191"><span id="local-6989586621687411196"><span id="local-6989586621687411201"><span id="local-6989586621687411206"><span id="local-6989586621687411211"><span id="local-6989586621687411216"><span class="annot"><span class="annottext">Monad (CacheRWT m)
CacheRWT m (Either QErr [ActionLogItem])
CacheRWT m (Either QErr ())
CacheRWT m (Either QErr MetadataDbId)
CacheRWT m (Either QErr CatalogState)
CacheRWT m (Either QErr MetadataWithResourceVersion)
CacheRWT m (Either QErr MetadataResourceVersion)
Monad (CacheRWT m)
-&gt; CacheRWT m (Either QErr MetadataResourceVersion)
-&gt; CacheRWT m (Either QErr MetadataWithResourceVersion)
-&gt; (MetadataResourceVersion
    -&gt; InstanceId
    -&gt; CacheRWT
         m (Either QErr [(MetadataResourceVersion, CacheInvalidations)]))
-&gt; (MetadataResourceVersion
    -&gt; Metadata -&gt; CacheRWT m (Either QErr MetadataResourceVersion))
-&gt; (MetadataResourceVersion
    -&gt; InstanceId -&gt; CacheInvalidations -&gt; CacheRWT m (Either QErr ()))
-&gt; CacheRWT m (Either QErr CatalogState)
-&gt; (CatalogStateType -&gt; Value -&gt; CacheRWT m (Either QErr ()))
-&gt; (MetadataResourceVersion
    -&gt; CacheRWT m (Either QErr (Maybe StoredIntrospection)))
-&gt; (StoredIntrospection
    -&gt; MetadataResourceVersion -&gt; CacheRWT m (Either QErr ()))
-&gt; CacheRWT m (Either QErr MetadataDbId)
-&gt; CacheRWT m (Either QErr ())
-&gt; ([TriggerName] -&gt; CacheRWT m (Either QErr [CronTriggerStats]))
-&gt; ([TriggerName]
    -&gt; CacheRWT m (Either QErr ([CronEvent], [OneOffScheduledEvent])))
-&gt; ([CronEventSeed] -&gt; CacheRWT m (Either QErr ()))
-&gt; (OneOffEvent -&gt; CacheRWT m (Either QErr EventId))
-&gt; (Invocation 'ScheduledType
    -&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ()))
-&gt; (EventId
    -&gt; ScheduledEventOp
    -&gt; ScheduledEventType
    -&gt; CacheRWT m (Either QErr ()))
-&gt; (ScheduledEventType
    -&gt; [EventId] -&gt; CacheRWT m (Either QErr Int))
-&gt; CacheRWT m (Either QErr ())
-&gt; (ClearCronEvents -&gt; CacheRWT m (Either QErr ()))
-&gt; (ScheduledEventPagination
    -&gt; [ScheduledEventStatus]
    -&gt; RowsCountOption
    -&gt; CacheRWT
         m (Either QErr (WithOptionalTotalCount [OneOffScheduledEvent])))
-&gt; (TriggerName
    -&gt; ScheduledEventPagination
    -&gt; [ScheduledEventStatus]
    -&gt; RowsCountOption
    -&gt; CacheRWT m (Either QErr (WithOptionalTotalCount [CronEvent])))
-&gt; (GetScheduledEventInvocations
    -&gt; CacheRWT
         m
         (Either QErr (WithOptionalTotalCount [ScheduledEventInvocation])))
-&gt; (EventId -&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ()))
-&gt; (ActionName
    -&gt; SessionVariables
    -&gt; [Header]
    -&gt; Value
    -&gt; CacheRWT m (Either QErr ActionId))
-&gt; CacheRWT m (Either QErr [ActionLogItem])
-&gt; (ActionId -&gt; AsyncActionStatus -&gt; CacheRWT m (Either QErr ()))
-&gt; (ActionId -&gt; CacheRWT m (Either QErr ActionLogResponse))
-&gt; (ActionName -&gt; CacheRWT m (Either QErr ()))
-&gt; (LockedActionIdArray -&gt; CacheRWT m (Either QErr ()))
-&gt; MonadMetadataStorage (CacheRWT m)
[TriggerName] -&gt; CacheRWT m (Either QErr [CronTriggerStats])
[TriggerName]
-&gt; CacheRWT m (Either QErr ([CronEvent], [OneOffScheduledEvent]))
[CronEventSeed] -&gt; CacheRWT m (Either QErr ())
Invocation 'ScheduledType
-&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ())
EventId -&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ())
EventId
-&gt; ScheduledEventOp
-&gt; ScheduledEventType
-&gt; CacheRWT m (Either QErr ())
TriggerName
-&gt; ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; CacheRWT m (Either QErr (WithOptionalTotalCount [CronEvent]))
ClearCronEvents -&gt; CacheRWT m (Either QErr ())
GetScheduledEventInvocations
-&gt; CacheRWT
     m (Either QErr (WithOptionalTotalCount [ScheduledEventInvocation]))
ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; CacheRWT
     m (Either QErr (WithOptionalTotalCount [OneOffScheduledEvent]))
ScheduledEventType -&gt; [EventId] -&gt; CacheRWT m (Either QErr Int)
OneOffEvent -&gt; CacheRWT m (Either QErr EventId)
LockedActionIdArray -&gt; CacheRWT m (Either QErr ())
ActionId -&gt; CacheRWT m (Either QErr ActionLogResponse)
ActionId -&gt; AsyncActionStatus -&gt; CacheRWT m (Either QErr ())
ActionName -&gt; CacheRWT m (Either QErr ())
ActionName
-&gt; SessionVariables
-&gt; [Header]
-&gt; Value
-&gt; CacheRWT m (Either QErr ActionId)
CatalogStateType -&gt; Value -&gt; CacheRWT m (Either QErr ())
MetadataResourceVersion
-&gt; CacheRWT m (Either QErr (Maybe StoredIntrospection))
MetadataResourceVersion
-&gt; InstanceId
-&gt; CacheRWT
     m (Either QErr [(MetadataResourceVersion, CacheInvalidations)])
MetadataResourceVersion
-&gt; InstanceId -&gt; CacheInvalidations -&gt; CacheRWT m (Either QErr ())
MetadataResourceVersion
-&gt; Metadata -&gt; CacheRWT m (Either QErr MetadataResourceVersion)
StoredIntrospection
-&gt; MetadataResourceVersion -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
Monad m
-&gt; m (Either QErr MetadataResourceVersion)
-&gt; m (Either QErr MetadataWithResourceVersion)
-&gt; (MetadataResourceVersion
    -&gt; InstanceId
    -&gt; m (Either QErr [(MetadataResourceVersion, CacheInvalidations)]))
-&gt; (MetadataResourceVersion
    -&gt; Metadata -&gt; m (Either QErr MetadataResourceVersion))
-&gt; (MetadataResourceVersion
    -&gt; InstanceId -&gt; CacheInvalidations -&gt; m (Either QErr ()))
-&gt; m (Either QErr CatalogState)
-&gt; (CatalogStateType -&gt; Value -&gt; m (Either QErr ()))
-&gt; (MetadataResourceVersion
    -&gt; m (Either QErr (Maybe StoredIntrospection)))
-&gt; (StoredIntrospection
    -&gt; MetadataResourceVersion -&gt; m (Either QErr ()))
-&gt; m (Either QErr MetadataDbId)
-&gt; m (Either QErr ())
-&gt; ([TriggerName] -&gt; m (Either QErr [CronTriggerStats]))
-&gt; ([TriggerName]
    -&gt; m (Either QErr ([CronEvent], [OneOffScheduledEvent])))
-&gt; ([CronEventSeed] -&gt; m (Either QErr ()))
-&gt; (OneOffEvent -&gt; m (Either QErr EventId))
-&gt; (Invocation 'ScheduledType
    -&gt; ScheduledEventType -&gt; m (Either QErr ()))
-&gt; (EventId
    -&gt; ScheduledEventOp -&gt; ScheduledEventType -&gt; m (Either QErr ()))
-&gt; (ScheduledEventType -&gt; [EventId] -&gt; m (Either QErr Int))
-&gt; m (Either QErr ())
-&gt; (ClearCronEvents -&gt; m (Either QErr ()))
-&gt; (ScheduledEventPagination
    -&gt; [ScheduledEventStatus]
    -&gt; RowsCountOption
    -&gt; m (Either QErr (WithOptionalTotalCount [OneOffScheduledEvent])))
-&gt; (TriggerName
    -&gt; ScheduledEventPagination
    -&gt; [ScheduledEventStatus]
    -&gt; RowsCountOption
    -&gt; m (Either QErr (WithOptionalTotalCount [CronEvent])))
-&gt; (GetScheduledEventInvocations
    -&gt; m (Either
            QErr (WithOptionalTotalCount [ScheduledEventInvocation])))
-&gt; (EventId -&gt; ScheduledEventType -&gt; m (Either QErr ()))
-&gt; (ActionName
    -&gt; SessionVariables
    -&gt; [Header]
    -&gt; Value
    -&gt; m (Either QErr ActionId))
-&gt; m (Either QErr [ActionLogItem])
-&gt; (ActionId -&gt; AsyncActionStatus -&gt; m (Either QErr ()))
-&gt; (ActionId -&gt; m (Either QErr ActionLogResponse))
-&gt; (ActionName -&gt; m (Either QErr ()))
-&gt; (LockedActionIdArray -&gt; m (Either QErr ()))
-&gt; MonadMetadataStorage m
forall {m :: * -&gt; *}. MonadMetadataStorage m =&gt; Monad (CacheRWT m)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr [ActionLogItem])
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr MetadataDbId)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr CatalogState)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr MetadataWithResourceVersion)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr MetadataResourceVersion)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
[TriggerName] -&gt; CacheRWT m (Either QErr [CronTriggerStats])
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
[TriggerName]
-&gt; CacheRWT m (Either QErr ([CronEvent], [OneOffScheduledEvent]))
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
[CronEventSeed] -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Invocation 'ScheduledType
-&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
EventId -&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
EventId
-&gt; ScheduledEventOp
-&gt; ScheduledEventType
-&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
TriggerName
-&gt; ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; CacheRWT m (Either QErr (WithOptionalTotalCount [CronEvent]))
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ClearCronEvents -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
GetScheduledEventInvocations
-&gt; CacheRWT
     m (Either QErr (WithOptionalTotalCount [ScheduledEventInvocation]))
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; CacheRWT
     m (Either QErr (WithOptionalTotalCount [OneOffScheduledEvent]))
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventType -&gt; [EventId] -&gt; CacheRWT m (Either QErr Int)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
OneOffEvent -&gt; CacheRWT m (Either QErr EventId)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
LockedActionIdArray -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionId -&gt; CacheRWT m (Either QErr ActionLogResponse)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionId -&gt; AsyncActionStatus -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionName -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionName
-&gt; SessionVariables
-&gt; [Header]
-&gt; Value
-&gt; CacheRWT m (Either QErr ActionId)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CatalogStateType -&gt; Value -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; CacheRWT m (Either QErr (Maybe StoredIntrospection))
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; InstanceId
-&gt; CacheRWT
     m (Either QErr [(MetadataResourceVersion, CacheInvalidations)])
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; InstanceId -&gt; CacheInvalidations -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; Metadata -&gt; CacheRWT m (Either QErr MetadataResourceVersion)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
StoredIntrospection
-&gt; MetadataResourceVersion -&gt; CacheRWT m (Either QErr ())
$cfetchMetadataResourceVersion :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr MetadataResourceVersion)
fetchMetadataResourceVersion :: CacheRWT m (Either QErr MetadataResourceVersion)
$cfetchMetadata :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr MetadataWithResourceVersion)
fetchMetadata :: CacheRWT m (Either QErr MetadataWithResourceVersion)
$cfetchMetadataNotifications :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; InstanceId
-&gt; CacheRWT
     m (Either QErr [(MetadataResourceVersion, CacheInvalidations)])
fetchMetadataNotifications :: MetadataResourceVersion
-&gt; InstanceId
-&gt; CacheRWT
     m (Either QErr [(MetadataResourceVersion, CacheInvalidations)])
$csetMetadata :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; Metadata -&gt; CacheRWT m (Either QErr MetadataResourceVersion)
setMetadata :: MetadataResourceVersion
-&gt; Metadata -&gt; CacheRWT m (Either QErr MetadataResourceVersion)
$cnotifySchemaCacheSync :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; InstanceId -&gt; CacheInvalidations -&gt; CacheRWT m (Either QErr ())
notifySchemaCacheSync :: MetadataResourceVersion
-&gt; InstanceId -&gt; CacheInvalidations -&gt; CacheRWT m (Either QErr ())
$cgetCatalogState :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr CatalogState)
getCatalogState :: CacheRWT m (Either QErr CatalogState)
$csetCatalogState :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CatalogStateType -&gt; Value -&gt; CacheRWT m (Either QErr ())
setCatalogState :: CatalogStateType -&gt; Value -&gt; CacheRWT m (Either QErr ())
$cfetchSourceIntrospection :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; CacheRWT m (Either QErr (Maybe StoredIntrospection))
fetchSourceIntrospection :: MetadataResourceVersion
-&gt; CacheRWT m (Either QErr (Maybe StoredIntrospection))
$cstoreSourceIntrospection :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
StoredIntrospection
-&gt; MetadataResourceVersion -&gt; CacheRWT m (Either QErr ())
storeSourceIntrospection :: StoredIntrospection
-&gt; MetadataResourceVersion -&gt; CacheRWT m (Either QErr ())
$cgetMetadataDbUid :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr MetadataDbId)
getMetadataDbUid :: CacheRWT m (Either QErr MetadataDbId)
$ccheckMetadataStorageHealth :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr ())
checkMetadataStorageHealth :: CacheRWT m (Either QErr ())
$cgetDeprivedCronTriggerStats :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
[TriggerName] -&gt; CacheRWT m (Either QErr [CronTriggerStats])
getDeprivedCronTriggerStats :: [TriggerName] -&gt; CacheRWT m (Either QErr [CronTriggerStats])
$cgetScheduledEventsForDelivery :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
[TriggerName]
-&gt; CacheRWT m (Either QErr ([CronEvent], [OneOffScheduledEvent]))
getScheduledEventsForDelivery :: [TriggerName]
-&gt; CacheRWT m (Either QErr ([CronEvent], [OneOffScheduledEvent]))
$cinsertCronEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
[CronEventSeed] -&gt; CacheRWT m (Either QErr ())
insertCronEvents :: [CronEventSeed] -&gt; CacheRWT m (Either QErr ())
$cinsertOneOffScheduledEvent :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
OneOffEvent -&gt; CacheRWT m (Either QErr EventId)
insertOneOffScheduledEvent :: OneOffEvent -&gt; CacheRWT m (Either QErr EventId)
$cinsertScheduledEventInvocation :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Invocation 'ScheduledType
-&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ())
insertScheduledEventInvocation :: Invocation 'ScheduledType
-&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ())
$csetScheduledEventOp :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
EventId
-&gt; ScheduledEventOp
-&gt; ScheduledEventType
-&gt; CacheRWT m (Either QErr ())
setScheduledEventOp :: EventId
-&gt; ScheduledEventOp
-&gt; ScheduledEventType
-&gt; CacheRWT m (Either QErr ())
$cunlockScheduledEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventType -&gt; [EventId] -&gt; CacheRWT m (Either QErr Int)
unlockScheduledEvents :: ScheduledEventType -&gt; [EventId] -&gt; CacheRWT m (Either QErr Int)
$cunlockAllLockedScheduledEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr ())
unlockAllLockedScheduledEvents :: CacheRWT m (Either QErr ())
$cclearFutureCronEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ClearCronEvents -&gt; CacheRWT m (Either QErr ())
clearFutureCronEvents :: ClearCronEvents -&gt; CacheRWT m (Either QErr ())
$cgetOneOffScheduledEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; CacheRWT
     m (Either QErr (WithOptionalTotalCount [OneOffScheduledEvent]))
getOneOffScheduledEvents :: ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; CacheRWT
     m (Either QErr (WithOptionalTotalCount [OneOffScheduledEvent]))
$cgetCronEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
TriggerName
-&gt; ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; CacheRWT m (Either QErr (WithOptionalTotalCount [CronEvent]))
getCronEvents :: TriggerName
-&gt; ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; CacheRWT m (Either QErr (WithOptionalTotalCount [CronEvent]))
$cgetScheduledEventInvocations :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
GetScheduledEventInvocations
-&gt; CacheRWT
     m (Either QErr (WithOptionalTotalCount [ScheduledEventInvocation]))
getScheduledEventInvocations :: GetScheduledEventInvocations
-&gt; CacheRWT
     m (Either QErr (WithOptionalTotalCount [ScheduledEventInvocation]))
$cdeleteScheduledEvent :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
EventId -&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ())
deleteScheduledEvent :: EventId -&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ())
$cinsertAction :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionName
-&gt; SessionVariables
-&gt; [Header]
-&gt; Value
-&gt; CacheRWT m (Either QErr ActionId)
insertAction :: ActionName
-&gt; SessionVariables
-&gt; [Header]
-&gt; Value
-&gt; CacheRWT m (Either QErr ActionId)
$cfetchUndeliveredActionEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr [ActionLogItem])
fetchUndeliveredActionEvents :: CacheRWT m (Either QErr [ActionLogItem])
$csetActionStatus :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionId -&gt; AsyncActionStatus -&gt; CacheRWT m (Either QErr ())
setActionStatus :: ActionId -&gt; AsyncActionStatus -&gt; CacheRWT m (Either QErr ())
$cfetchActionResponse :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionId -&gt; CacheRWT m (Either QErr ActionLogResponse)
fetchActionResponse :: ActionId -&gt; CacheRWT m (Either QErr ActionLogResponse)
$cclearActionData :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionName -&gt; CacheRWT m (Either QErr ())
clearActionData :: ActionName -&gt; CacheRWT m (Either QErr ())
$csetProcessingActionLogsToPending :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
LockedActionIdArray -&gt; CacheRWT m (Either QErr ())
setProcessingActionLogsToPending :: LockedActionIdArray -&gt; CacheRWT m (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadMetadataStorage</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-188"></span><span>      </span><span id="local-6989586621687411229"><span id="local-6989586621687411235"><span id="local-6989586621687411240"><span id="local-6989586621687411245"><span class="annot"><span class="annottext">Monad (CacheRWT m)
CacheRWT m (Maybe TraceContext)
Monad (CacheRWT m)
-&gt; (forall a.
    TraceContext
    -&gt; SamplingPolicy -&gt; Text -&gt; CacheRWT m a -&gt; CacheRWT m a)
-&gt; (forall a. SpanId -&gt; Text -&gt; CacheRWT m a -&gt; CacheRWT m a)
-&gt; CacheRWT m (Maybe TraceContext)
-&gt; (TraceMetadata -&gt; CacheRWT m ())
-&gt; MonadTrace (CacheRWT m)
TraceMetadata -&gt; CacheRWT m ()
forall a. SpanId -&gt; Text -&gt; CacheRWT m a -&gt; CacheRWT m a
forall a.
TraceContext
-&gt; SamplingPolicy -&gt; Text -&gt; CacheRWT m a -&gt; CacheRWT m a
forall (m :: * -&gt; *).
Monad m
-&gt; (forall a. TraceContext -&gt; SamplingPolicy -&gt; Text -&gt; m a -&gt; m a)
-&gt; (forall a. SpanId -&gt; Text -&gt; m a -&gt; m a)
-&gt; m (Maybe TraceContext)
-&gt; (TraceMetadata -&gt; m ())
-&gt; MonadTrace m
forall {m :: * -&gt; *}. MonadTrace m =&gt; Monad (CacheRWT m)
forall (m :: * -&gt; *).
MonadTrace m =&gt;
CacheRWT m (Maybe TraceContext)
forall (m :: * -&gt; *).
MonadTrace m =&gt;
TraceMetadata -&gt; CacheRWT m ()
forall (m :: * -&gt; *) a.
MonadTrace m =&gt;
SpanId -&gt; Text -&gt; CacheRWT m a -&gt; CacheRWT m a
forall (m :: * -&gt; *) a.
MonadTrace m =&gt;
TraceContext
-&gt; SamplingPolicy -&gt; Text -&gt; CacheRWT m a -&gt; CacheRWT m a
$cnewTraceWith :: forall (m :: * -&gt; *) a.
MonadTrace m =&gt;
TraceContext
-&gt; SamplingPolicy -&gt; Text -&gt; CacheRWT m a -&gt; CacheRWT m a
newTraceWith :: forall a.
TraceContext
-&gt; SamplingPolicy -&gt; Text -&gt; CacheRWT m a -&gt; CacheRWT m a
$cnewSpanWith :: forall (m :: * -&gt; *) a.
MonadTrace m =&gt;
SpanId -&gt; Text -&gt; CacheRWT m a -&gt; CacheRWT m a
newSpanWith :: forall a. SpanId -&gt; Text -&gt; CacheRWT m a -&gt; CacheRWT m a
$ccurrentContext :: forall (m :: * -&gt; *).
MonadTrace m =&gt;
CacheRWT m (Maybe TraceContext)
currentContext :: CacheRWT m (Maybe TraceContext)
$cattachMetadata :: forall (m :: * -&gt; *).
MonadTrace m =&gt;
TraceMetadata -&gt; CacheRWT m ()
attachMetadata :: TraceMetadata -&gt; CacheRWT m ()
</span><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Tracing.MonadTrace</span></a></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-189"></span><span>      </span><span id="local-6989586621687411253"><span id="local-6989586621687411267"><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/transformers-base-0.4.6-f4846e7d2b070a71a3342491d113f0272be49ef45fc176d1834edeb0d2a8051a/share/doc/html/src/Control.Monad.Base.html#MonadBase"><span class="hs-identifier hs-type">MonadBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687411253"><span class="hs-identifier hs-type">b</span></a></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-190"></span><span>      </span><span id="local-6989586621687411278"><span id="local-6989586621687411284"><span id="local-6989586621687411290"><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-92f8a47f193bc8ca499a8b94581fad6cb68b7a26370b271798ac2ec617c05064/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687411278"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-191"></span><span>      </span><span id="local-6989586621687411304"><span class="annot"><span class="annottext">Monad (CacheRWT m)
CacheRWT m Manager
Monad (CacheRWT m)
-&gt; CacheRWT m Manager -&gt; ProvidesNetwork (CacheRWT m)
forall (m :: * -&gt; *). Monad m -&gt; m Manager -&gt; ProvidesNetwork m
forall {m :: * -&gt; *}. ProvidesNetwork m =&gt; Monad (CacheRWT m)
forall (m :: * -&gt; *). ProvidesNetwork m =&gt; CacheRWT m Manager
$caskHTTPManager :: forall (m :: * -&gt; *). ProvidesNetwork m =&gt; CacheRWT m Manager
askHTTPManager :: CacheRWT m Manager
</span><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">ProvidesNetwork</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-192"></span><span>      </span><span id="local-6989586621687411317"><span class="annot"><span class="annottext">Monad (CacheRWT m)
Monad (CacheRWT m)
-&gt; (FeatureFlag -&gt; CacheRWT m Bool)
-&gt; HasFeatureFlagChecker (CacheRWT m)
FeatureFlag -&gt; CacheRWT m Bool
forall (m :: * -&gt; *).
Monad m -&gt; (FeatureFlag -&gt; m Bool) -&gt; HasFeatureFlagChecker m
forall {m :: * -&gt; *}. HasFeatureFlagChecker m =&gt; Monad (CacheRWT m)
forall (m :: * -&gt; *).
HasFeatureFlagChecker m =&gt;
FeatureFlag -&gt; CacheRWT m Bool
$ccheckFlag :: forall (m :: * -&gt; *).
HasFeatureFlagChecker m =&gt;
FeatureFlag -&gt; CacheRWT m Bool
checkFlag :: FeatureFlag -&gt; CacheRWT m Bool
</span><a href="Hasura.Server.Init.FeatureFlag.html#HasFeatureFlagChecker"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">FF.HasFeatureFlagChecker</span></a></span></span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687411331"><span class="annot"><span class="annottext">Monad (CacheRWT m)
Monad (CacheRWT m)
-&gt; (QueryTagsAttributes
    -&gt; Maybe QueryTagsConfig -&gt; Tagged (CacheRWT m) QueryTagsComment)
-&gt; MonadQueryTags (CacheRWT m)
QueryTagsAttributes
-&gt; Maybe QueryTagsConfig -&gt; Tagged (CacheRWT m) QueryTagsComment
forall (m :: * -&gt; *).
Monad m
-&gt; (QueryTagsAttributes
    -&gt; Maybe QueryTagsConfig -&gt; Tagged m QueryTagsComment)
-&gt; MonadQueryTags m
forall {m :: * -&gt; *}. MonadQueryTags m =&gt; Monad (CacheRWT m)
forall (m :: * -&gt; *).
MonadQueryTags m =&gt;
QueryTagsAttributes
-&gt; Maybe QueryTagsConfig -&gt; Tagged (CacheRWT m) QueryTagsComment
$ccreateQueryTags :: forall (m :: * -&gt; *).
MonadQueryTags m =&gt;
QueryTagsAttributes
-&gt; Maybe QueryTagsConfig -&gt; Tagged (CacheRWT m) QueryTagsComment
createQueryTags :: QueryTagsAttributes
-&gt; Maybe QueryTagsConfig -&gt; Tagged (CacheRWT m) QueryTagsComment
</span><a href="Hasura.QueryTags.html#MonadQueryTags"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadQueryTags</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687409728"><span id="local-6989586621687409729"><span id="local-6989586621687411345"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621687409728"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409729"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621687409728"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-type">CacheRWT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409729"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-197"></span><span>  </span><span id="local-6989586621687411354"><span class="annot"><span class="annottext">ask :: CacheRWT m r
</span><a href="#local-6989586621687411354"><span class="hs-identifier hs-var hs-var hs-var hs-var">ask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m r -&gt; CacheRWT m r
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; CacheRWT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m r
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-198"></span><span>  </span><span id="local-6989586621687411359"><span class="annot"><span class="annottext">local :: forall a. (r -&gt; r) -&gt; CacheRWT m a -&gt; CacheRWT m a
</span><a href="#local-6989586621687411359"><span class="hs-identifier hs-var hs-var hs-var hs-var">local</span></a></span></span><span> </span><span id="local-6989586621687411361"><span class="annot"><span class="annottext">r -&gt; r
</span><a href="#local-6989586621687411361"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-type">CacheRWT</span></a></span><span> </span><span id="local-6989586621687411362"><span class="annot"><span class="annottext">ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  a
</span><a href="#local-6989586621687411362"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  a
-&gt; CacheRWT m a
forall (m :: * -&gt; *) a.
ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  a
-&gt; CacheRWT m a
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-var">CacheRWT</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT
   CacheDynamicConfig
   (StateT
      (RebuildableSchemaCache, CacheInvalidations,
       SourcesIntrospectionStatus, SchemaRegistryAction)
      m)
   a
 -&gt; CacheRWT m a)
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     a
-&gt; CacheRWT m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(StateT
   (RebuildableSchemaCache, CacheInvalidations,
    SourcesIntrospectionStatus, SchemaRegistryAction)
   m
   a
 -&gt; StateT
      (RebuildableSchemaCache, CacheInvalidations,
       SourcesIntrospectionStatus, SchemaRegistryAction)
      m
      a)
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     a
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     a
forall (m :: * -&gt; *) a (n :: * -&gt; *) b r.
(m a -&gt; n b) -&gt; ReaderT r m a -&gt; ReaderT r n b
</span><span class="hs-identifier hs-var">mapReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(r -&gt; r)
-&gt; StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m
     a
-&gt; StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m
     a
forall a.
(r -&gt; r)
-&gt; StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m
     a
-&gt; StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m
     a
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="annot"><span class="annottext">r -&gt; r
</span><a href="#local-6989586621687411361"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  a
</span><a href="#local-6989586621687411362"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687409756"><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier hs-type">MonadEventLogCleanup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409756"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier hs-type">MonadEventLogCleanup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-type">CacheRWT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409756"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-201"></span><span>  </span><span id="local-6989586621687411377"><span class="annot"><span class="annottext">runLogCleaner :: SourceCache
-&gt; TriggerLogCleanupConfig -&gt; CacheRWT m (Either QErr EncJSON)
</span><a href="#local-6989586621687411377"><span class="hs-identifier hs-var hs-var hs-var hs-var">runLogCleaner</span></a></span></span><span> </span><span id="local-6989586621687411379"><span class="annot"><span class="annottext">SourceCache
</span><a href="#local-6989586621687411379"><span class="hs-identifier hs-var">sourceCache</span></a></span></span><span> </span><span id="local-6989586621687411380"><span class="annot"><span class="annottext">TriggerLogCleanupConfig
</span><a href="#local-6989586621687411380"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr EncJSON) -&gt; CacheRWT m (Either QErr EncJSON)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; CacheRWT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr EncJSON) -&gt; CacheRWT m (Either QErr EncJSON))
-&gt; m (Either QErr EncJSON) -&gt; CacheRWT m (Either QErr EncJSON)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceCache -&gt; TriggerLogCleanupConfig -&gt; m (Either QErr EncJSON)
forall (m :: * -&gt; *).
MonadEventLogCleanup m =&gt;
SourceCache -&gt; TriggerLogCleanupConfig -&gt; m (Either QErr EncJSON)
</span><a href="Hasura.RQL.DDL.EventTrigger.html#runLogCleaner"><span class="hs-identifier hs-var">runLogCleaner</span></a></span><span> </span><span class="annot"><span class="annottext">SourceCache
</span><a href="#local-6989586621687411379"><span class="hs-identifier hs-var">sourceCache</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerLogCleanupConfig
</span><a href="#local-6989586621687411380"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-202"></span><span>  </span><span id="local-6989586621687411384"><span class="annot"><span class="annottext">generateCleanupSchedules :: AnyBackend SourceInfo
-&gt; TriggerName
-&gt; AutoTriggerLogCleanupConfig
-&gt; CacheRWT m (Either QErr ())
</span><a href="#local-6989586621687411384"><span class="hs-identifier hs-var hs-var hs-var hs-var">generateCleanupSchedules</span></a></span></span><span> </span><span id="local-6989586621687411386"><span class="annot"><span class="annottext">AnyBackend SourceInfo
</span><a href="#local-6989586621687411386"><span class="hs-identifier hs-var">sourceInfo</span></a></span></span><span> </span><span id="local-6989586621687411387"><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687411387"><span class="hs-identifier hs-var">triggerName</span></a></span></span><span> </span><span id="local-6989586621687411388"><span class="annot"><span class="annottext">AutoTriggerLogCleanupConfig
</span><a href="#local-6989586621687411388"><span class="hs-identifier hs-var">cleanupConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; CacheRWT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; CacheRWT m (Either QErr ()))
-&gt; m (Either QErr ()) -&gt; CacheRWT m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AnyBackend SourceInfo
-&gt; TriggerName -&gt; AutoTriggerLogCleanupConfig -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadEventLogCleanup m =&gt;
AnyBackend SourceInfo
-&gt; TriggerName -&gt; AutoTriggerLogCleanupConfig -&gt; m (Either QErr ())
</span><a href="Hasura.RQL.DDL.EventTrigger.html#generateCleanupSchedules"><span class="hs-identifier hs-var">generateCleanupSchedules</span></a></span><span> </span><span class="annot"><span class="annottext">AnyBackend SourceInfo
</span><a href="#local-6989586621687411386"><span class="hs-identifier hs-var">sourceInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687411387"><span class="hs-identifier hs-var">triggerName</span></a></span><span> </span><span class="annot"><span class="annottext">AutoTriggerLogCleanupConfig
</span><a href="#local-6989586621687411388"><span class="hs-identifier hs-var">cleanupConfig</span></a></span><span>
</span><span id="line-203"></span><span>  </span><span id="local-6989586621687411392"><span class="annot"><span class="annottext">updateTriggerCleanupSchedules :: Logger Hasura
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; SchemaCache
-&gt; CacheRWT m (Either QErr ())
</span><a href="#local-6989586621687411392"><span class="hs-identifier hs-var hs-var hs-var hs-var">updateTriggerCleanupSchedules</span></a></span></span><span> </span><span id="local-6989586621687411394"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687411394"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621687411395"><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621687411395"><span class="hs-identifier hs-var">oldSources</span></a></span></span><span> </span><span id="local-6989586621687411396"><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621687411396"><span class="hs-identifier hs-var">newSources</span></a></span></span><span> </span><span id="local-6989586621687411397"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687411397"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; CacheRWT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; CacheRWT m (Either QErr ()))
-&gt; m (Either QErr ()) -&gt; CacheRWT m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; SchemaCache
-&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadEventLogCleanup m =&gt;
Logger Hasura
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; SchemaCache
-&gt; m (Either QErr ())
</span><a href="Hasura.RQL.DDL.EventTrigger.html#updateTriggerCleanupSchedules"><span class="hs-identifier hs-var">updateTriggerCleanupSchedules</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687411394"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621687411395"><span class="hs-identifier hs-var">oldSources</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621687411396"><span class="hs-identifier hs-var">newSources</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687411397"><span class="hs-identifier hs-var">schemaCache</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687409762"><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier hs-type">MonadGetPolicies</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409762"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier hs-type">MonadGetPolicies</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-type">CacheRWT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409762"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-206"></span><span>  </span><span id="local-6989586621687411410"><span class="annot"><span class="annottext">runGetApiTimeLimit :: CacheRWT m (Maybe MaxTime)
</span><a href="#local-6989586621687411410"><span class="hs-identifier hs-var hs-var hs-var hs-var">runGetApiTimeLimit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Maybe MaxTime) -&gt; CacheRWT m (Maybe MaxTime)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; CacheRWT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe MaxTime) -&gt; CacheRWT m (Maybe MaxTime))
-&gt; m (Maybe MaxTime) -&gt; CacheRWT m (Maybe MaxTime)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">m (Maybe MaxTime)
forall (m :: * -&gt; *). MonadGetPolicies m =&gt; m (Maybe MaxTime)
</span><a href="Hasura.Server.Types.html#runGetApiTimeLimit"><span class="hs-identifier hs-var">runGetApiTimeLimit</span></a></span><span>
</span><span id="line-207"></span><span>  </span><span id="local-6989586621687411415"><span class="annot"><span class="annottext">runGetPrometheusMetricsGranularity :: CacheRWT m (IO GranularPrometheusMetricsState)
</span><a href="#local-6989586621687411415"><span class="hs-identifier hs-var hs-var hs-var hs-var">runGetPrometheusMetricsGranularity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (IO GranularPrometheusMetricsState)
-&gt; CacheRWT m (IO GranularPrometheusMetricsState)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; CacheRWT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (IO GranularPrometheusMetricsState)
 -&gt; CacheRWT m (IO GranularPrometheusMetricsState))
-&gt; m (IO GranularPrometheusMetricsState)
-&gt; CacheRWT m (IO GranularPrometheusMetricsState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">m (IO GranularPrometheusMetricsState)
forall (m :: * -&gt; *).
MonadGetPolicies m =&gt;
m (IO GranularPrometheusMetricsState)
</span><a href="Hasura.Server.Types.html#runGetPrometheusMetricsGranularity"><span class="hs-identifier hs-var">runGetPrometheusMetricsGranularity</span></a></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span id="local-6989586621687409763"><span id="local-6989586621687409764"><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#runCacheRWT"><span class="hs-identifier hs-type">runCacheRWT</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621687409763"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-211"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#CacheDynamicConfig"><span class="hs-identifier hs-type">CacheDynamicConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-212"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-213"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-type">CacheRWT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409763"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409764"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-214"></span><span>  </span><span class="annot"><a href="#local-6989586621687409763"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687409764"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-type">CacheInvalidations</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#SourcesIntrospectionStatus"><span class="hs-identifier hs-type">SourcesIntrospectionStatus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.SchemaRegistry.html#SchemaRegistryAction"><span class="hs-identifier hs-type">SchemaRegistryAction</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-215"></span><span id="runCacheRWT"><span class="annot"><span class="annottext">runCacheRWT :: forall (m :: * -&gt; *) a.
Monad m =&gt;
CacheDynamicConfig
-&gt; RebuildableSchemaCache
-&gt; CacheRWT m a
-&gt; m (a, RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#runCacheRWT"><span class="hs-identifier hs-var hs-var">runCacheRWT</span></a></span></span><span> </span><span id="local-6989586621687411423"><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687411423"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621687411424"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687411424"><span class="hs-identifier hs-var">cache</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-type">CacheRWT</span></a></span><span> </span><span id="local-6989586621687411425"><span class="annot"><span class="annottext">ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  a
</span><a href="#local-6989586621687411425"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621687411426"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621687411426"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687411427"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687411427"><span class="hs-identifier hs-var">newCache</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411428"><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687411428"><span class="hs-identifier hs-var">invalidations</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411429"><span class="annot"><span class="annottext">SourcesIntrospectionStatus
</span><a href="#local-6989586621687411429"><span class="hs-identifier hs-var">introspection</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411430"><span class="annot"><span class="annottext">SchemaRegistryAction
</span><a href="#local-6989586621687411430"><span class="hs-identifier hs-var">schemaRegistryAction</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-217"></span><span>    </span><span class="annot"><span class="annottext">StateT
  (RebuildableSchemaCache, CacheInvalidations,
   SourcesIntrospectionStatus, SchemaRegistryAction)
  m
  a
-&gt; (RebuildableSchemaCache, CacheInvalidations,
    SourcesIntrospectionStatus, SchemaRegistryAction)
-&gt; m (a,
      (RebuildableSchemaCache, CacheInvalidations,
       SourcesIntrospectionStatus, SchemaRegistryAction))
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var">runStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  a
-&gt; CacheDynamicConfig
-&gt; StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m
     a
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  a
</span><a href="#local-6989586621687411425"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687411423"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687411424"><span class="hs-identifier hs-var">cache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourcesIntrospectionStatus
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#SourcesIntrospectionUnchanged"><span class="hs-identifier hs-var">SourcesIntrospectionUnchanged</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SchemaRegistryAction
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>  </span><span class="annot"><span class="annottext">(a, RebuildableSchemaCache, CacheInvalidations,
 SourcesIntrospectionStatus, SchemaRegistryAction)
-&gt; m (a, RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621687411426"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687411427"><span class="hs-identifier hs-var">newCache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687411428"><span class="hs-identifier hs-var">invalidations</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourcesIntrospectionStatus
</span><a href="#local-6989586621687411429"><span class="hs-identifier hs-var">introspection</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SchemaRegistryAction
</span><a href="#local-6989586621687411430"><span class="hs-identifier hs-var">schemaRegistryAction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTrans</span></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-type">CacheRWT</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-221"></span><span>  </span><span id="local-6989586621687411442"><span class="annot"><span class="annottext">lift :: forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; CacheRWT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">lift</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  a
-&gt; CacheRWT m a
forall (m :: * -&gt; *) a.
ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  a
-&gt; CacheRWT m a
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-var">CacheRWT</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT
   CacheDynamicConfig
   (StateT
      (RebuildableSchemaCache, CacheInvalidations,
       SourcesIntrospectionStatus, SchemaRegistryAction)
      m)
   a
 -&gt; CacheRWT m a)
-&gt; (m a
    -&gt; ReaderT
         CacheDynamicConfig
         (StateT
            (RebuildableSchemaCache, CacheInvalidations,
             SourcesIntrospectionStatus, SchemaRegistryAction)
            m)
         a)
-&gt; m a
-&gt; CacheRWT m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">StateT
  (RebuildableSchemaCache, CacheInvalidations,
   SourcesIntrospectionStatus, SchemaRegistryAction)
  m
  a
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     a
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a -&gt; ReaderT CacheDynamicConfig m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(StateT
   (RebuildableSchemaCache, CacheInvalidations,
    SourcesIntrospectionStatus, SchemaRegistryAction)
   m
   a
 -&gt; ReaderT
      CacheDynamicConfig
      (StateT
         (RebuildableSchemaCache, CacheInvalidations,
          SourcesIntrospectionStatus, SchemaRegistryAction)
         m)
      a)
-&gt; (m a
    -&gt; StateT
         (RebuildableSchemaCache, CacheInvalidations,
          SourcesIntrospectionStatus, SchemaRegistryAction)
         m
         a)
-&gt; m a
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">m a
-&gt; StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m
     a
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a
-&gt; StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m
     a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687409781"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621687409781"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#CacheRM"><span class="hs-identifier hs-type">CacheRM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-type">CacheRWT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409781"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-224"></span><span>  </span><span id="local-6989586621687411458"><span class="annot"><span class="annottext">askSchemaCache :: CacheRWT m SchemaCache
</span><a href="#local-6989586621687411458"><span class="hs-identifier hs-var hs-var hs-var hs-var">askSchemaCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  SchemaCache
-&gt; CacheRWT m SchemaCache
forall (m :: * -&gt; *) a.
ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  a
-&gt; CacheRWT m a
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-var">CacheRWT</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT
   CacheDynamicConfig
   (StateT
      (RebuildableSchemaCache, CacheInvalidations,
       SourcesIntrospectionStatus, SchemaRegistryAction)
      m)
   SchemaCache
 -&gt; CacheRWT m SchemaCache)
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     SchemaCache
-&gt; CacheRWT m SchemaCache
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((RebuildableSchemaCache, CacheInvalidations,
  SourcesIntrospectionStatus, SchemaRegistryAction)
 -&gt; SchemaCache)
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     SchemaCache
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RebuildableSchemaCache -&gt; SchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#lastBuiltSchemaCache"><span class="hs-identifier hs-var">lastBuiltSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">(RebuildableSchemaCache -&gt; SchemaCache)
-&gt; ((RebuildableSchemaCache, CacheInvalidations,
     SourcesIntrospectionStatus, SchemaRegistryAction)
    -&gt; RebuildableSchemaCache)
-&gt; (RebuildableSchemaCache, CacheInvalidations,
    SourcesIntrospectionStatus, SchemaRegistryAction)
-&gt; SchemaCache
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(RebuildableSchemaCache, CacheInvalidations,
 SourcesIntrospectionStatus, SchemaRegistryAction)
-&gt; Getting
     RebuildableSchemaCache
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     RebuildableSchemaCache
-&gt; RebuildableSchemaCache
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-70a68698e02c1d9dc133c543e6497a7241e5514570afd4815da4baf2a001e00e/share/doc/html/src/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  RebuildableSchemaCache
  (RebuildableSchemaCache, CacheInvalidations,
   SourcesIntrospectionStatus, SchemaRegistryAction)
  RebuildableSchemaCache
forall s t a b. Field1 s t a b =&gt; Lens s t a b
Lens
  (RebuildableSchemaCache, CacheInvalidations,
   SourcesIntrospectionStatus, SchemaRegistryAction)
  (RebuildableSchemaCache, CacheInvalidations,
   SourcesIntrospectionStatus, SchemaRegistryAction)
  RebuildableSchemaCache
  RebuildableSchemaCache
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-70a68698e02c1d9dc133c543e6497a7241e5514570afd4815da4baf2a001e00e/share/doc/html/src/Control.Lens.Tuple.html#_1"><span class="hs-identifier hs-var">_1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="hs-comment">-- | Note: Use these functions over 'fetchSourceIntrospection' and</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- 'storeSourceIntrospection' from 'MonadMetadataStorage' class.</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- These are wrapper function over 'MonadMetadataStorage' methods. These functions</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- handles errors, if any, logs them and returns empty stored introspection.</span><span>
</span><span id="line-230"></span><span class="hs-comment">-- This is to ensure we do not accidentally throw errors (related to</span><span>
</span><span id="line-231"></span><span class="hs-comment">-- fetching/storing stored introspection) in the critical code path of building</span><span>
</span><span id="line-232"></span><span class="hs-comment">-- the 'SchemaCache'.</span><span>
</span><span id="line-233"></span><span id="local-6989586621687409806"><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#loadStoredIntrospection"><span class="hs-identifier hs-type">loadStoredIntrospection</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409806"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687409806"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-235"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-236"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#MetadataResourceVersion"><span class="hs-identifier hs-type">MetadataResourceVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-237"></span><span>  </span><span class="annot"><a href="#local-6989586621687409806"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#StoredIntrospection"><span class="hs-identifier hs-type">StoredIntrospection</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-238"></span><span id="loadStoredIntrospection"><span class="annot"><span class="annottext">loadStoredIntrospection :: forall (m :: * -&gt; *).
(MonadMetadataStorage m, MonadIO m) =&gt;
Logger Hasura
-&gt; MetadataResourceVersion -&gt; m (Maybe StoredIntrospection)
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#loadStoredIntrospection"><span class="hs-identifier hs-var hs-var">loadStoredIntrospection</span></a></span></span><span> </span><span id="local-6989586621687411480"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687411480"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621687411481"><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621687411481"><span class="hs-identifier hs-var">metadataVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-239"></span><span>  </span><span class="annot"><span class="annottext">MetadataResourceVersion
-&gt; m (Either QErr (Maybe StoredIntrospection))
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; m (Either QErr (Maybe StoredIntrospection))
</span><a href="Hasura.Metadata.Class.html#fetchSourceIntrospection"><span class="hs-identifier hs-var">fetchSourceIntrospection</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621687411481"><span class="hs-identifier hs-var">metadataVersion</span></a></span><span> </span><span class="annot"><span class="annottext">m (Either QErr (Maybe StoredIntrospection))
-&gt; (QErr -&gt; m (Maybe StoredIntrospection))
-&gt; m (Maybe StoredIntrospection)
forall (m :: * -&gt; *) e a.
Monad m =&gt;
m (Either e a) -&gt; (e -&gt; m a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#onLeftM"><span class="hs-operator hs-var">`onLeftM`</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687411483"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687411483"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-240"></span><span>    </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a Hasura, MonadIO m) =&gt;
   a -&gt; m ()
forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687411480"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-241"></span><span>      </span><span class="annot"><span class="annottext">(StoredIntrospectionStorageLog -&gt; m ())
-&gt; StoredIntrospectionStorageLog -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; QErr -&gt; StoredIntrospectionStorageLog
</span><a href="Hasura.Logging.html#StoredIntrospectionStorageLog"><span class="hs-identifier hs-var">StoredIntrospectionStorageLog</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Could not load stored-introspection. Continuing without it&quot;</span></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687411483"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><span class="annottext">Maybe StoredIntrospection -&gt; m (Maybe StoredIntrospection)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe StoredIntrospection
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span id="local-6989586621687409816"><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#saveSourcesIntrospection"><span class="hs-identifier hs-type">saveSourcesIntrospection</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687409816"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409816"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-246"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-247"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#SourcesIntrospectionStatus"><span class="hs-identifier hs-type">SourcesIntrospectionStatus</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-248"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#MetadataResourceVersion"><span class="hs-identifier hs-type">MetadataResourceVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-249"></span><span>  </span><span class="annot"><a href="#local-6989586621687409816"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-250"></span><span id="saveSourcesIntrospection"><span class="annot"><span class="annottext">saveSourcesIntrospection :: forall (m :: * -&gt; *).
(MonadIO m, MonadMetadataStorage m) =&gt;
Logger Hasura
-&gt; SourcesIntrospectionStatus -&gt; MetadataResourceVersion -&gt; m ()
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#saveSourcesIntrospection"><span class="hs-identifier hs-var hs-var">saveSourcesIntrospection</span></a></span></span><span> </span><span id="local-6989586621687411497"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687411497"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621687411498"><span class="annot"><span class="annottext">SourcesIntrospectionStatus
</span><a href="#local-6989586621687411498"><span class="hs-identifier hs-var">sourcesIntrospection</span></a></span></span><span> </span><span id="local-6989586621687411499"><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621687411499"><span class="hs-identifier hs-var">metadataVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-comment">-- store the collected source introspection result only if we were able</span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-comment">-- to introspect all sources successfully</span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SourcesIntrospectionStatus
</span><a href="#local-6989586621687411498"><span class="hs-identifier hs-var">sourcesIntrospection</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-254"></span><span>    </span><span class="annot"><span class="annottext">SourcesIntrospectionStatus
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#SourcesIntrospectionUnchanged"><span class="hs-identifier hs-var">SourcesIntrospectionUnchanged</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#SourcesIntrospectionChangedPartial"><span class="hs-identifier hs-type">SourcesIntrospectionChangedPartial</span></a></span><span> </span><span class="annot"><span class="annottext">StoredIntrospection
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#SourcesIntrospectionChangedFull"><span class="hs-identifier hs-type">SourcesIntrospectionChangedFull</span></a></span><span> </span><span id="local-6989586621687411502"><span class="annot"><span class="annottext">StoredIntrospection
</span><a href="#local-6989586621687411502"><span class="hs-identifier hs-var">introspection</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-257"></span><span>      </span><span class="annot"><span class="annottext">StoredIntrospection
-&gt; MetadataResourceVersion -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
StoredIntrospection
-&gt; MetadataResourceVersion -&gt; m (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#storeSourceIntrospection"><span class="hs-identifier hs-var">storeSourceIntrospection</span></a></span><span> </span><span class="annot"><span class="annottext">StoredIntrospection
</span><a href="#local-6989586621687411502"><span class="hs-identifier hs-var">introspection</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621687411499"><span class="hs-identifier hs-var">metadataVersion</span></a></span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; (QErr -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) e a.
Monad m =&gt;
m (Either e a) -&gt; (e -&gt; m a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#onLeftM"><span class="hs-operator hs-var">`onLeftM`</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687411503"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687411503"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-258"></span><span>        </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a Hasura, MonadIO m) =&gt;
   a -&gt; m ()
forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687411497"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(StoredIntrospectionStorageLog -&gt; m ())
-&gt; StoredIntrospectionStorageLog -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; QErr -&gt; StoredIntrospectionStorageLog
</span><a href="Hasura.Logging.html#StoredIntrospectionStorageLog"><span class="hs-identifier hs-var">StoredIntrospectionStorageLog</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Could not save source introspection&quot;</span></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687411503"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-261"></span><span>  </span><span id="local-6989586621687409823"><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687409823"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409823"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-263"></span><span>    </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409823"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409823"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-265"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#HasCacheStaticConfig"><span class="hs-identifier hs-type">HasCacheStaticConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409823"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409823"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-268"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-type">CacheRWT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409823"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-269"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-270"></span><span>  </span><span id="local-6989586621687411555"><span class="annot"><span class="annottext">tryBuildSchemaCacheWithOptions :: forall a.
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; ValidateNewSchemaCache a
-&gt; CacheRWT m a
</span><a href="#local-6989586621687411555"><span class="hs-identifier hs-var hs-var hs-var hs-var">tryBuildSchemaCacheWithOptions</span></a></span></span><span> </span><span id="local-6989586621687411557"><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621687411557"><span class="hs-identifier hs-var">buildReason</span></a></span></span><span> </span><span id="local-6989586621687411558"><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687411558"><span class="hs-identifier hs-var">invalidations</span></a></span></span><span> </span><span id="local-6989586621687411559"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687411559"><span class="hs-identifier hs-var">newMetadata</span></a></span></span><span> </span><span id="local-6989586621687411560"><span class="annot"><span class="annottext">ValidateNewSchemaCache a
</span><a href="#local-6989586621687411560"><span class="hs-identifier hs-var">validateNewSchemaCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  a
-&gt; CacheRWT m a
forall (m :: * -&gt; *) a.
ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  a
-&gt; CacheRWT m a
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-var">CacheRWT</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-271"></span><span>    </span><span id="local-6989586621687411561"><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687411561"><span class="hs-identifier hs-var">dynamicConfig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  CacheDynamicConfig
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-272"></span><span>    </span><span id="local-6989586621687411562"><span class="annot"><span class="annottext">CacheStaticConfig
</span><a href="#local-6989586621687411562"><span class="hs-identifier hs-var">staticConfig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  CacheStaticConfig
forall (m :: * -&gt; *). HasCacheStaticConfig m =&gt; m CacheStaticConfig
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#askCacheStaticConfig"><span class="hs-identifier hs-var">askCacheStaticConfig</span></a></span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span><span> </span><span id="local-6989586621687411564"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687411564"><span class="hs-identifier hs-var">lastBuiltSC</span></a></span></span><span> </span><span id="local-6989586621687411565"><span class="annot"><span class="annottext">InvalidationKeys
</span><a href="#local-6989586621687411565"><span class="hs-identifier hs-var">invalidationKeys</span></a></span></span><span> </span><span id="local-6989586621687411566"><span class="annot"><span class="annottext">Rule
  (ReaderT BuildReason CacheBuild)
  (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
   Maybe StoredIntrospection)
  (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
</span><a href="#local-6989586621687411566"><span class="hs-identifier hs-var">rule</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411567"><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687411567"><span class="hs-identifier hs-var">oldInvalidations</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourcesIntrospectionStatus
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SchemaRegistryAction
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  (RebuildableSchemaCache, CacheInvalidations,
   SourcesIntrospectionStatus, SchemaRegistryAction)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687411569"><span class="annot"><span class="annottext">oldMetadataVersion :: MetadataResourceVersion
</span><a href="#local-6989586621687411569"><span class="hs-identifier hs-var hs-var">oldMetadataVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; MetadataResourceVersion
</span><a href="Hasura.RQL.Types.SchemaCache.html#scMetadataResourceVersion"><span class="hs-identifier hs-var">scMetadataResourceVersion</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687411564"><span class="hs-identifier hs-var">lastBuiltSC</span></a></span><span>
</span><span id="line-275"></span><span>        </span><span class="hs-comment">-- We are purposely putting (-1) as the metadata resource version here. This is because we want to</span><span>
</span><span id="line-276"></span><span>        </span><span class="hs-comment">-- catch error cases in `withSchemaCache(Read)Update`</span><span>
</span><span id="line-277"></span><span>        </span><span id="local-6989586621687411571"><span class="annot"><span class="annottext">metadataWithVersion :: MetadataWithResourceVersion
</span><a href="#local-6989586621687411571"><span class="hs-identifier hs-var hs-var">metadataWithVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; MetadataResourceVersion -&gt; MetadataWithResourceVersion
</span><a href="Hasura.RQL.Types.SchemaCache.html#MetadataWithResourceVersion"><span class="hs-identifier hs-var">MetadataWithResourceVersion</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687411559"><span class="hs-identifier hs-var">newMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataResourceVersion -&gt; MetadataWithResourceVersion)
-&gt; MetadataResourceVersion -&gt; MetadataWithResourceVersion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; MetadataResourceVersion
</span><a href="Hasura.RQL.Types.SchemaCache.html#MetadataResourceVersion"><span class="hs-identifier hs-var">MetadataResourceVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>        </span><span id="local-6989586621687411574"><span class="annot"><span class="annottext">newInvalidationKeys :: InvalidationKeys
</span><a href="#local-6989586621687411574"><span class="hs-identifier hs-var hs-var">newInvalidationKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CacheInvalidations -&gt; InvalidationKeys -&gt; InvalidationKeys
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#invalidateKeys"><span class="hs-identifier hs-var">invalidateKeys</span></a></span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687411558"><span class="hs-identifier hs-var">invalidations</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidationKeys
</span><a href="#local-6989586621687411565"><span class="hs-identifier hs-var">invalidationKeys</span></a></span><span>
</span><span id="line-279"></span><span>    </span><span id="local-6989586621687411576"><span class="annot"><span class="annottext">Maybe StoredIntrospection
</span><a href="#local-6989586621687411576"><span class="hs-identifier hs-var">storedIntrospection</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; MetadataResourceVersion
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     (Maybe StoredIntrospection)
forall (m :: * -&gt; *).
(MonadMetadataStorage m, MonadIO m) =&gt;
Logger Hasura
-&gt; MetadataResourceVersion -&gt; m (Maybe StoredIntrospection)
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#loadStoredIntrospection"><span class="hs-identifier hs-var">loadStoredIntrospection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CacheStaticConfig -&gt; Logger Hasura
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cscLogger"><span class="hs-identifier hs-var">_cscLogger</span></a></span><span> </span><span class="annot"><span class="annottext">CacheStaticConfig
</span><a href="#local-6989586621687411562"><span class="hs-identifier hs-var">staticConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621687411569"><span class="hs-identifier hs-var">oldMetadataVersion</span></a></span><span>
</span><span id="line-280"></span><span>    </span><span id="local-6989586621687411578"><span class="annot"><span class="annottext">Result
  (ReaderT BuildReason CacheBuild)
  (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
   Maybe StoredIntrospection)
  (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
</span><a href="#local-6989586621687411578"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-281"></span><span>      </span><span class="annot"><span class="annottext">CacheBuild
  (Result
     (ReaderT BuildReason CacheBuild)
     (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
      Maybe StoredIntrospection)
     (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     (Result
        (ReaderT BuildReason CacheBuild)
        (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
         Maybe StoredIntrospection)
        (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
forall (m :: * -&gt; *) a.
(MonadIO m, MonadError QErr m, MonadResolveSource m,
 ProvidesNetwork m, HasCacheStaticConfig m) =&gt;
CacheBuild a -&gt; m a
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#runCacheBuildM"><span class="hs-identifier hs-var">runCacheBuildM</span></a></span><span>
</span><span id="line-282"></span><span>        </span><span class="annot"><span class="annottext">(CacheBuild
   (Result
      (ReaderT BuildReason CacheBuild)
      (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
       Maybe StoredIntrospection)
      (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
 -&gt; ReaderT
      CacheDynamicConfig
      (StateT
         (RebuildableSchemaCache, CacheInvalidations,
          SourcesIntrospectionStatus, SchemaRegistryAction)
         m)
      (Result
         (ReaderT BuildReason CacheBuild)
         (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
          Maybe StoredIntrospection)
         (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))))
-&gt; CacheBuild
     (Result
        (ReaderT BuildReason CacheBuild)
        (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
         Maybe StoredIntrospection)
        (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     (Result
        (ReaderT BuildReason CacheBuild)
        (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
         Maybe StoredIntrospection)
        (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ReaderT
   BuildReason
   CacheBuild
   (Result
      (ReaderT BuildReason CacheBuild)
      (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
       Maybe StoredIntrospection)
      (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
 -&gt; BuildReason
 -&gt; CacheBuild
      (Result
         (ReaderT BuildReason CacheBuild)
         (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
          Maybe StoredIntrospection)
         (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))))
-&gt; BuildReason
-&gt; ReaderT
     BuildReason
     CacheBuild
     (Result
        (ReaderT BuildReason CacheBuild)
        (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
         Maybe StoredIntrospection)
        (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
-&gt; CacheBuild
     (Result
        (ReaderT BuildReason CacheBuild)
        (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
         Maybe StoredIntrospection)
        (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ReaderT
  BuildReason
  CacheBuild
  (Result
     (ReaderT BuildReason CacheBuild)
     (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
      Maybe StoredIntrospection)
     (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
-&gt; BuildReason
-&gt; CacheBuild
     (Result
        (ReaderT BuildReason CacheBuild)
        (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
         Maybe StoredIntrospection)
        (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621687411557"><span class="hs-identifier hs-var">buildReason</span></a></span><span>
</span><span id="line-283"></span><span>        </span><span class="annot"><span class="annottext">(ReaderT
   BuildReason
   CacheBuild
   (Result
      (ReaderT BuildReason CacheBuild)
      (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
       Maybe StoredIntrospection)
      (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
 -&gt; CacheBuild
      (Result
         (ReaderT BuildReason CacheBuild)
         (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
          Maybe StoredIntrospection)
         (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))))
-&gt; ReaderT
     BuildReason
     CacheBuild
     (Result
        (ReaderT BuildReason CacheBuild)
        (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
         Maybe StoredIntrospection)
        (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
-&gt; CacheBuild
     (Result
        (ReaderT BuildReason CacheBuild)
        (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
         Maybe StoredIntrospection)
        (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rule
  (ReaderT BuildReason CacheBuild)
  (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
   Maybe StoredIntrospection)
  (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
-&gt; (MetadataWithResourceVersion, CacheDynamicConfig,
    InvalidationKeys, Maybe StoredIntrospection)
-&gt; ReaderT
     BuildReason
     CacheBuild
     (Result
        (ReaderT BuildReason CacheBuild)
        (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
         Maybe StoredIntrospection)
        (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction)))
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
Rule m a b -&gt; a -&gt; m (Result m a b)
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Rule.html#build"><span class="hs-identifier hs-var">Inc.build</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
  (ReaderT BuildReason CacheBuild)
  (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
   Maybe StoredIntrospection)
  (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
</span><a href="#local-6989586621687411566"><span class="hs-identifier hs-var">rule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetadataWithResourceVersion
</span><a href="#local-6989586621687411571"><span class="hs-identifier hs-var">metadataWithVersion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687411561"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InvalidationKeys
</span><a href="#local-6989586621687411574"><span class="hs-identifier hs-var">newInvalidationKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe StoredIntrospection
</span><a href="#local-6989586621687411576"><span class="hs-identifier hs-var">storedIntrospection</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687411580"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687411580"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687411581"><span class="annot"><span class="annottext">SourcesIntrospectionStatus
</span><a href="#local-6989586621687411581"><span class="hs-identifier hs-var">storedIntrospectionStatus</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411582"><span class="annot"><span class="annottext">SchemaRegistryAction
</span><a href="#local-6989586621687411582"><span class="hs-identifier hs-var">schemaRegistryAction</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Result
  (ReaderT BuildReason CacheBuild)
  (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
   Maybe StoredIntrospection)
  (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
-&gt; (SchemaCache,
    (SourcesIntrospectionStatus, SchemaRegistryAction))
forall {k} (m :: k -&gt; *) a b. Result m a b -&gt; b
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Rule.html#result"><span class="hs-identifier hs-var">Inc.result</span></a></span><span> </span><span class="annot"><span class="annottext">Result
  (ReaderT BuildReason CacheBuild)
  (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
   Maybe StoredIntrospection)
  (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
</span><a href="#local-6989586621687411578"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-286"></span><span>        </span><span id="local-6989586621687411583"><span class="annot"><span class="annottext">prunedInvalidationKeys :: InvalidationKeys
</span><a href="#local-6989586621687411583"><span class="hs-identifier hs-var hs-var">prunedInvalidationKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; InvalidationKeys -&gt; InvalidationKeys
</span><a href="#local-6989586621687411584"><span class="hs-identifier hs-var">pruneInvalidationKeys</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687411580"><span class="hs-identifier hs-var">schemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidationKeys
</span><a href="#local-6989586621687411574"><span class="hs-identifier hs-var">newInvalidationKeys</span></a></span><span>
</span><span id="line-287"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621687411585"><span class="annot"><span class="annottext">newCache :: RebuildableSchemaCache
</span><a href="#local-6989586621687411585"><span class="hs-identifier hs-var hs-var">newCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaCache
-&gt; InvalidationKeys
-&gt; Rule
     (ReaderT BuildReason CacheBuild)
     (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
      Maybe StoredIntrospection)
     (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
-&gt; RebuildableSchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-var">RebuildableSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687411580"><span class="hs-identifier hs-var">schemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidationKeys
</span><a href="#local-6989586621687411583"><span class="hs-identifier hs-var">prunedInvalidationKeys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Result
  (ReaderT BuildReason CacheBuild)
  (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
   Maybe StoredIntrospection)
  (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
-&gt; Rule
     (ReaderT BuildReason CacheBuild)
     (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
      Maybe StoredIntrospection)
     (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
forall {k} (m :: k -&gt; *) a b. Result m a b -&gt; Rule m a b
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Rule.html#rebuildRule"><span class="hs-identifier hs-var">Inc.rebuildRule</span></a></span><span> </span><span class="annot"><span class="annottext">Result
  (ReaderT BuildReason CacheBuild)
  (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
   Maybe StoredIntrospection)
  (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
</span><a href="#local-6989586621687411578"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621687411586"><span class="annot"><span class="annottext">newInvalidations :: CacheInvalidations
</span><a href="#local-6989586621687411586"><span class="hs-identifier hs-var hs-var">newInvalidations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687411567"><span class="hs-identifier hs-var">oldInvalidations</span></a></span><span> </span><span class="annot"><span class="annottext">CacheInvalidations -&gt; CacheInvalidations -&gt; CacheInvalidations
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687411558"><span class="hs-identifier hs-var">invalidations</span></a></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ValidateNewSchemaCache a
</span><a href="#local-6989586621687411560"><span class="hs-identifier hs-var">validateNewSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687411564"><span class="hs-identifier hs-var">lastBuiltSC</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687411580"><span class="hs-identifier hs-var">schemaCache</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-291"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidateNewSchemaCacheResult
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#KeepNewSchemaCache"><span class="hs-identifier hs-var">KeepNewSchemaCache</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411588"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621687411588"><span class="hs-identifier hs-var">valueToReturn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(RebuildableSchemaCache, CacheInvalidations,
 SourcesIntrospectionStatus, SchemaRegistryAction)
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687411585"><span class="hs-identifier hs-var">newCache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687411586"><span class="hs-identifier hs-var">newInvalidations</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourcesIntrospectionStatus
</span><a href="#local-6989586621687411581"><span class="hs-identifier hs-var">storedIntrospectionStatus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SchemaRegistryAction
</span><a href="#local-6989586621687411582"><span class="hs-identifier hs-var">schemaRegistryAction</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  ()
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     a
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     a
forall a b.
ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  a
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     b
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     a
forall a.
a
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621687411588"><span class="hs-identifier hs-var">valueToReturn</span></a></span><span>
</span><span id="line-292"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidateNewSchemaCacheResult
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#DiscardNewSchemaCache"><span class="hs-identifier hs-var">DiscardNewSchemaCache</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411591"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621687411591"><span class="hs-identifier hs-var">valueToReturn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     a
forall a.
a
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621687411591"><span class="hs-identifier hs-var">valueToReturn</span></a></span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-294"></span><span>      </span><span class="hs-comment">-- Prunes invalidation keys that no longer exist in the schema to avoid leaking memory by</span><span>
</span><span id="line-295"></span><span>      </span><span class="hs-comment">-- hanging onto unnecessary keys.</span><span>
</span><span id="line-296"></span><span>      </span><span id="local-6989586621687411584"><span class="annot"><span class="annottext">pruneInvalidationKeys :: SchemaCache -&gt; InvalidationKeys -&gt; InvalidationKeys
</span><a href="#local-6989586621687411584"><span class="hs-identifier hs-var hs-var">pruneInvalidationKeys</span></a></span></span><span> </span><span id="local-6989586621687411596"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687411596"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ASetter
  InvalidationKeys
  InvalidationKeys
  (HashMap RemoteSchemaName InvalidationKey)
  (HashMap RemoteSchemaName InvalidationKey)
-&gt; (HashMap RemoteSchemaName InvalidationKey
    -&gt; HashMap RemoteSchemaName InvalidationKey)
-&gt; InvalidationKeys
-&gt; InvalidationKeys
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-70a68698e02c1d9dc133c543e6497a7241e5514570afd4815da4baf2a001e00e/share/doc/html/src/Control.Lens.Setter.html#over"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  InvalidationKeys
  InvalidationKeys
  (HashMap RemoteSchemaName InvalidationKey)
  (HashMap RemoteSchemaName InvalidationKey)
Lens' InvalidationKeys (HashMap RemoteSchemaName InvalidationKey)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#ikRemoteSchemas"><span class="hs-identifier hs-var">ikRemoteSchemas</span></a></span><span> </span><span class="annot"><span class="annottext">((HashMap RemoteSchemaName InvalidationKey
  -&gt; HashMap RemoteSchemaName InvalidationKey)
 -&gt; InvalidationKeys -&gt; InvalidationKeys)
-&gt; (HashMap RemoteSchemaName InvalidationKey
    -&gt; HashMap RemoteSchemaName InvalidationKey)
-&gt; InvalidationKeys
-&gt; InvalidationKeys
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(RemoteSchemaName -&gt; InvalidationKey -&gt; Bool)
-&gt; HashMap RemoteSchemaName InvalidationKey
-&gt; HashMap RemoteSchemaName InvalidationKey
forall k v. (k -&gt; v -&gt; Bool) -&gt; HashMap k v -&gt; HashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#filterWithKey"><span class="hs-identifier hs-var">HashMap.filterWithKey</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687411600"><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621687411600"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">InvalidationKey
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-297"></span><span>        </span><span class="hs-comment">-- see Note [Keep invalidation keys for inconsistent objects]</span><span>
</span><span id="line-298"></span><span>        </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621687411600"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName -&gt; [RemoteSchemaName] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; [RemoteSchemaName]
</span><a href="Hasura.RQL.Types.SchemaCache.html#getAllRemoteSchemas"><span class="hs-identifier hs-var">getAllRemoteSchemas</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687411596"><span class="hs-identifier hs-var">schemaCache</span></a></span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span>  </span><span id="local-6989586621687411608"><span class="annot"><span class="annottext">setMetadataResourceVersionInSchemaCache :: MetadataResourceVersion -&gt; CacheRWT m ()
</span><a href="#local-6989586621687411608"><span class="hs-identifier hs-var hs-var hs-var hs-var">setMetadataResourceVersionInSchemaCache</span></a></span></span><span> </span><span id="local-6989586621687411610"><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621687411610"><span class="hs-identifier hs-var">resourceVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  ()
-&gt; CacheRWT m ()
forall (m :: * -&gt; *) a.
ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  a
-&gt; CacheRWT m a
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-var">CacheRWT</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT
   CacheDynamicConfig
   (StateT
      (RebuildableSchemaCache, CacheInvalidations,
       SourcesIntrospectionStatus, SchemaRegistryAction)
      m)
   ()
 -&gt; CacheRWT m ())
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     ()
-&gt; CacheRWT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621687411611"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687411611"><span class="hs-identifier hs-var">rebuildableSchemaCache</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411612"><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687411612"><span class="hs-identifier hs-var">invalidations</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411613"><span class="annot"><span class="annottext">SourcesIntrospectionStatus
</span><a href="#local-6989586621687411613"><span class="hs-identifier hs-var">introspection</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411614"><span class="annot"><span class="annottext">SchemaRegistryAction
</span><a href="#local-6989586621687411614"><span class="hs-identifier hs-var">schemaRegistryAction</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT
  CacheDynamicConfig
  (StateT
     (RebuildableSchemaCache, CacheInvalidations,
      SourcesIntrospectionStatus, SchemaRegistryAction)
     m)
  (RebuildableSchemaCache, CacheInvalidations,
   SourcesIntrospectionStatus, SchemaRegistryAction)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-302"></span><span>    </span><span class="annot"><span class="annottext">(RebuildableSchemaCache, CacheInvalidations,
 SourcesIntrospectionStatus, SchemaRegistryAction)
-&gt; ReaderT
     CacheDynamicConfig
     (StateT
        (RebuildableSchemaCache, CacheInvalidations,
         SourcesIntrospectionStatus, SchemaRegistryAction)
        m)
     ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span>
</span><span id="line-303"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687411611"><span class="hs-identifier hs-var">rebuildableSchemaCache</span></a></span><span>
</span><span id="line-304"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lastBuiltSchemaCache :: SchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#lastBuiltSchemaCache"><span class="hs-identifier hs-var">lastBuiltSchemaCache</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-305"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RebuildableSchemaCache -&gt; SchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#lastBuiltSchemaCache"><span class="hs-identifier hs-var">lastBuiltSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687411611"><span class="hs-identifier hs-var">rebuildableSchemaCache</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scMetadataResourceVersion :: MetadataResourceVersion
</span><a href="Hasura.RQL.Types.SchemaCache.html#scMetadataResourceVersion"><span class="hs-identifier hs-var">scMetadataResourceVersion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621687411610"><span class="hs-identifier hs-var">resourceVersion</span></a></span><span>
</span><span id="line-307"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-308"></span><span>          </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-309"></span><span>        </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687411612"><span class="hs-identifier hs-var">invalidations</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-310"></span><span>        </span><span class="annot"><span class="annottext">SourcesIntrospectionStatus
</span><a href="#local-6989586621687411613"><span class="hs-identifier hs-var">introspection</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-311"></span><span>        </span><span class="annot"><span class="annottext">SchemaRegistryAction
</span><a href="#local-6989586621687411614"><span class="hs-identifier hs-var">schemaRegistryAction</span></a></span><span>
</span><span id="line-312"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="annot"><span class="hs-comment">-- | Generate health checks related cache from sources metadata</span></span><span>
</span><span id="line-315"></span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#buildHealthCheckCache"><span class="hs-identifier hs-type">buildHealthCheckCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#Sources"><span class="hs-identifier hs-type">Sources</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceHealthCheckCache"><span class="hs-identifier hs-type">SourceHealthCheckCache</span></a></span><span>
</span><span id="line-316"></span><span id="buildHealthCheckCache"><span class="annot"><span class="annottext">buildHealthCheckCache :: InsOrdHashMap SourceName BackendSourceMetadata
-&gt; SourceHealthCheckCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildHealthCheckCache"><span class="hs-identifier hs-var hs-var">buildHealthCheckCache</span></a></span></span><span> </span><span id="local-6989586621687411617"><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621687411617"><span class="hs-identifier hs-var">sources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-317"></span><span>  </span><span class="annot"><span class="annottext">HashMap SourceName (Maybe BackendSourceHealthCheckInfo)
-&gt; SourceHealthCheckCache
forall a. HashMap SourceName (Maybe a) -&gt; HashMap SourceName a
forall (f :: * -&gt; *) a. Filterable f =&gt; f (Maybe a) -&gt; f a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/witherable-0.4.2-a40f3f0a2ed7f25145b5b00589bf4ea2486662b1e96b7d29d5e6041625ee4a09/share/doc/html/src/Witherable.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap SourceName (Maybe BackendSourceHealthCheckInfo)
 -&gt; SourceHealthCheckCache)
-&gt; HashMap SourceName (Maybe BackendSourceHealthCheckInfo)
-&gt; SourceHealthCheckCache
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(SourceName, Maybe BackendSourceHealthCheckInfo)]
-&gt; HashMap SourceName (Maybe BackendSourceHealthCheckInfo)
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.Strict.html#fromList"><span class="hs-identifier hs-var">HashMap.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(SourceName, Maybe BackendSourceHealthCheckInfo)]
 -&gt; HashMap SourceName (Maybe BackendSourceHealthCheckInfo))
-&gt; [(SourceName, Maybe BackendSourceHealthCheckInfo)]
-&gt; HashMap SourceName (Maybe BackendSourceHealthCheckInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((SourceName, BackendSourceMetadata)
 -&gt; (SourceName, Maybe BackendSourceHealthCheckInfo))
-&gt; [(SourceName, BackendSourceMetadata)]
-&gt; [(SourceName, Maybe BackendSourceHealthCheckInfo)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BackendSourceMetadata -&gt; Maybe BackendSourceHealthCheckInfo)
-&gt; (SourceName, BackendSourceMetadata)
-&gt; (SourceName, Maybe BackendSourceHealthCheckInfo)
forall b c d. (b -&gt; c) -&gt; (d, b) -&gt; (d, c)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="annot"><span class="annottext">BackendSourceMetadata -&gt; Maybe BackendSourceHealthCheckInfo
</span><a href="#local-6989586621687411621"><span class="hs-identifier hs-var">mkSourceHealthCheck</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
-&gt; [(SourceName, BackendSourceMetadata)]
forall k v. InsOrdHashMap k v -&gt; [(k, v)]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#toList"><span class="hs-identifier hs-var">InsOrdHashMap.toList</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621687411617"><span class="hs-identifier hs-var">sources</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-319"></span><span>    </span><span class="annot"><a href="#local-6989586621687411621"><span class="hs-identifier hs-type">mkSourceHealthCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#BackendSourceMetadata"><span class="hs-identifier hs-type">BackendSourceMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#BackendSourceHealthCheckInfo"><span class="hs-identifier hs-type">BackendSourceHealthCheckInfo</span></a></span><span>
</span><span id="line-320"></span><span>    </span><span id="local-6989586621687411621"><span class="annot"><span class="annottext">mkSourceHealthCheck :: BackendSourceMetadata -&gt; Maybe BackendSourceHealthCheckInfo
</span><a href="#local-6989586621687411621"><span class="hs-identifier hs-var hs-var">mkSourceHealthCheck</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#BackendSourceMetadata"><span class="hs-identifier hs-type">BackendSourceMetadata</span></a></span><span> </span><span id="local-6989586621687411624"><span class="annot"><span class="annottext">AnyBackend SourceMetadata
</span><a href="#local-6989586621687411624"><span class="hs-identifier hs-var">sourceMetadata</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-321"></span><span>      </span><span class="annot"><span class="annottext">forall (c :: BackendType -&gt; Constraint) (i :: BackendType -&gt; *)
       (j :: BackendType -&gt; *) (f :: * -&gt; *).
(AllBackendsSatisfy c, Functor f) =&gt;
AnyBackend i
-&gt; (forall (b :: BackendType). c b =&gt; i b -&gt; f (j b))
-&gt; f (AnyBackend j)
</span><a href="Hasura.SQL.AnyBackend.html#traverseBackend"><span class="hs-identifier hs-var">AB.traverseBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="annottext">AnyBackend SourceMetadata
</span><a href="#local-6989586621687411624"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b -&gt; Maybe (SourceHealthCheckInfo b)
forall (b :: BackendType).
Backend b =&gt;
SourceMetadata b -&gt; Maybe (SourceHealthCheckInfo b)
forall (b :: BackendType).
SourceMetadata b -&gt; Maybe (SourceHealthCheckInfo b)
</span><a href="#local-6989586621687411626"><span class="hs-identifier hs-var">mkSourceHealthCheckBackend</span></a></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>    </span><span class="hs-comment">-- 'Nothing' when no health check is defined. See:</span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-comment">-- https://hasura.io/docs/latest/deployment/health-checks/source-health-check/</span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-comment">-- We likely choose not to install a default `SELECT 1` health check here,</span><span>
</span><span id="line-326"></span><span>    </span><span class="hs-comment">-- since we don't want to spam serverless databases.</span><span>
</span><span id="line-327"></span><span>    </span><span id="local-6989586621687409872"><span class="annot"><a href="#local-6989586621687411626"><span class="hs-identifier hs-type">mkSourceHealthCheckBackend</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SourceMetadata"><span class="hs-identifier hs-type">SourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409872"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceHealthCheckInfo"><span class="hs-identifier hs-type">SourceHealthCheckInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409872"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-328"></span><span>    </span><span id="local-6989586621687411626"><span class="annot"><span class="annottext">mkSourceHealthCheckBackend :: forall (b :: BackendType).
SourceMetadata b -&gt; Maybe (SourceHealthCheckInfo b)
</span><a href="#local-6989586621687411626"><span class="hs-identifier hs-var hs-var">mkSourceHealthCheckBackend</span></a></span></span><span> </span><span id="local-6989586621687411629"><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687411629"><span class="hs-identifier hs-var">sourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-329"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687411630"><span class="annot"><span class="annottext">sourceName :: SourceName
</span><a href="#local-6989586621687411630"><span class="hs-identifier hs-var hs-var">sourceName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceMetadata b -&gt; SourceName
forall (b :: BackendType). SourceMetadata b -&gt; SourceName
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smName"><span class="hs-identifier hs-var">_smName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687411629"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-330"></span><span>          </span><span id="local-6989586621687411632"><span class="annot"><span class="annottext">connection :: SourceConnConfiguration b
</span><a href="#local-6989586621687411632"><span class="hs-identifier hs-var hs-var">connection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceMetadata b -&gt; SourceConnConfiguration b
forall (b :: BackendType).
SourceMetadata b -&gt; SourceConnConfiguration b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smConfiguration"><span class="hs-identifier hs-var">_smConfiguration</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687411629"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-331"></span><span>          </span><span id="local-6989586621687411634"><span class="annot"><span class="annottext">healthCheck :: Maybe (HealthCheckConfig b)
</span><a href="#local-6989586621687411634"><span class="hs-identifier hs-var hs-var">healthCheck</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceMetadata b -&gt; Maybe (HealthCheckConfig b)
forall (b :: BackendType).
SourceMetadata b -&gt; Maybe (HealthCheckConfig b)
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smHealthCheckConfig"><span class="hs-identifier hs-var">_smHealthCheckConfig</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687411629"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-332"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SourceName
-&gt; SourceConnConfiguration b
-&gt; HealthCheckConfig b
-&gt; SourceHealthCheckInfo b
forall (b :: BackendType).
SourceName
-&gt; SourceConnConfiguration b
-&gt; HealthCheckConfig b
-&gt; SourceHealthCheckInfo b
</span><a href="Hasura.RQL.Types.Source.html#SourceHealthCheckInfo"><span class="hs-identifier hs-var">SourceHealthCheckInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687411630"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConnConfiguration b
</span><a href="#local-6989586621687411632"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">(HealthCheckConfig b -&gt; SourceHealthCheckInfo b)
-&gt; Maybe (HealthCheckConfig b) -&gt; Maybe (SourceHealthCheckInfo b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (HealthCheckConfig b)
</span><a href="#local-6989586621687411634"><span class="hs-identifier hs-var">healthCheck</span></a></span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span class="hs-comment">-- | Generate cache of source connection details so that we can ping sources for</span><span>
</span><span id="line-335"></span><span class="hs-comment">-- attribution</span><span>
</span><span id="line-336"></span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#buildSourcePingCache"><span class="hs-identifier hs-type">buildSourcePingCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#Sources"><span class="hs-identifier hs-type">Sources</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourcePingCache"><span class="hs-identifier hs-type">SourcePingCache</span></a></span><span>
</span><span id="line-337"></span><span id="buildSourcePingCache"><span class="annot"><span class="annottext">buildSourcePingCache :: InsOrdHashMap SourceName BackendSourceMetadata -&gt; SourcePingCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildSourcePingCache"><span class="hs-identifier hs-var hs-var">buildSourcePingCache</span></a></span></span><span> </span><span id="local-6989586621687411639"><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621687411639"><span class="hs-identifier hs-var">sources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-338"></span><span>  </span><span class="annot"><span class="annottext">[(SourceName, BackendSourcePingInfo)] -&gt; SourcePingCache
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.Strict.html#fromList"><span class="hs-identifier hs-var">HashMap.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(SourceName, BackendSourcePingInfo)] -&gt; SourcePingCache)
-&gt; [(SourceName, BackendSourcePingInfo)] -&gt; SourcePingCache
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((SourceName, BackendSourceMetadata)
 -&gt; (SourceName, BackendSourcePingInfo))
-&gt; [(SourceName, BackendSourceMetadata)]
-&gt; [(SourceName, BackendSourcePingInfo)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BackendSourceMetadata -&gt; BackendSourcePingInfo)
-&gt; (SourceName, BackendSourceMetadata)
-&gt; (SourceName, BackendSourcePingInfo)
forall b c d. (b -&gt; c) -&gt; (d, b) -&gt; (d, c)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="annot"><span class="annottext">BackendSourceMetadata -&gt; BackendSourcePingInfo
</span><a href="#local-6989586621687411640"><span class="hs-identifier hs-var">mkSourcePing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
-&gt; [(SourceName, BackendSourceMetadata)]
forall k v. InsOrdHashMap k v -&gt; [(k, v)]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#toList"><span class="hs-identifier hs-var">InsOrdHashMap.toList</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621687411639"><span class="hs-identifier hs-var">sources</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-340"></span><span>    </span><span class="annot"><a href="#local-6989586621687411640"><span class="hs-identifier hs-type">mkSourcePing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#BackendSourceMetadata"><span class="hs-identifier hs-type">BackendSourceMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#BackendSourcePingInfo"><span class="hs-identifier hs-type">BackendSourcePingInfo</span></a></span><span>
</span><span id="line-341"></span><span>    </span><span id="local-6989586621687411640"><span class="annot"><span class="annottext">mkSourcePing :: BackendSourceMetadata -&gt; BackendSourcePingInfo
</span><a href="#local-6989586621687411640"><span class="hs-identifier hs-var hs-var">mkSourcePing</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#BackendSourceMetadata"><span class="hs-identifier hs-type">BackendSourceMetadata</span></a></span><span> </span><span id="local-6989586621687411641"><span class="annot"><span class="annottext">AnyBackend SourceMetadata
</span><a href="#local-6989586621687411641"><span class="hs-identifier hs-var">sourceMetadata</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-342"></span><span>      </span><span class="annot"><span class="annottext">AnyBackend SourceMetadata
-&gt; (forall (b :: BackendType).
    SourceMetadata b -&gt; SourcePingInfo b)
-&gt; BackendSourcePingInfo
forall (i :: BackendType -&gt; *) (j :: BackendType -&gt; *).
AnyBackend i
-&gt; (forall (b :: BackendType). i b -&gt; j b) -&gt; AnyBackend j
</span><a href="Hasura.SQL.AnyBackend.html#mapBackend"><span class="hs-identifier hs-var">AB.mapBackend</span></a></span><span> </span><span class="annot"><span class="annottext">AnyBackend SourceMetadata
</span><a href="#local-6989586621687411641"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b -&gt; SourcePingInfo b
forall (b :: BackendType). SourceMetadata b -&gt; SourcePingInfo b
</span><a href="#local-6989586621687411643"><span class="hs-identifier hs-var">mkSourcePingBackend</span></a></span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span>    </span><span id="local-6989586621687411644"><span class="annot"><a href="#local-6989586621687411643"><span class="hs-identifier hs-type">mkSourcePingBackend</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SourceMetadata"><span class="hs-identifier hs-type">SourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687411644"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourcePingInfo"><span class="hs-identifier hs-type">SourcePingInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687411644"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-345"></span><span>    </span><span id="local-6989586621687411643"><span class="annot"><span class="annottext">mkSourcePingBackend :: forall (b :: BackendType). SourceMetadata b -&gt; SourcePingInfo b
</span><a href="#local-6989586621687411643"><span class="hs-identifier hs-var hs-var">mkSourcePingBackend</span></a></span></span><span> </span><span id="local-6989586621687411645"><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687411645"><span class="hs-identifier hs-var">sourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-346"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687411646"><span class="annot"><span class="annottext">sourceName :: SourceName
</span><a href="#local-6989586621687411646"><span class="hs-identifier hs-var hs-var">sourceName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceMetadata b -&gt; SourceName
forall (b :: BackendType). SourceMetadata b -&gt; SourceName
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smName"><span class="hs-identifier hs-var">_smName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687411645"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-347"></span><span>          </span><span id="local-6989586621687411647"><span class="annot"><span class="annottext">connection :: SourceConnConfiguration b
</span><a href="#local-6989586621687411647"><span class="hs-identifier hs-var hs-var">connection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceMetadata b -&gt; SourceConnConfiguration b
forall (b :: BackendType).
SourceMetadata b -&gt; SourceConnConfiguration b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smConfiguration"><span class="hs-identifier hs-var">_smConfiguration</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687411645"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-348"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; SourceConnConfiguration b -&gt; SourcePingInfo b
forall (b :: BackendType).
SourceName -&gt; SourceConnConfiguration b -&gt; SourcePingInfo b
</span><a href="Hasura.RQL.Types.Source.html#SourcePingInfo"><span class="hs-identifier hs-var">SourcePingInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687411646"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConnConfiguration b
</span><a href="#local-6989586621687411647"><span class="hs-identifier hs-var">connection</span></a></span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#partitionCollectedInfo"><span class="hs-identifier hs-type">partitionCollectedInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-351"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataDependency"><span class="hs-identifier hs-type">MetadataDependency</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#StoredIntrospectionItem"><span class="hs-identifier hs-type">StoredIntrospectionItem</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span id="partitionCollectedInfo"><span class="annot"><span class="annottext">partitionCollectedInfo :: Seq CollectItem
-&gt; ([InconsistentMetadata], [MetadataDependency],
    [StoredIntrospectionItem])
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#partitionCollectedInfo"><span class="hs-identifier hs-var hs-var">partitionCollectedInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-353"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687411663"><span class="annot"><span class="annottext">go :: CollectItem -&gt; s -&gt; t
</span><a href="#local-6989586621687411663"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621687411664"><span class="annot"><span class="annottext">CollectItem
</span><a href="#local-6989586621687411664"><span class="hs-identifier hs-var">item</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CollectItem
</span><a href="#local-6989586621687411664"><span class="hs-identifier hs-var">item</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-354"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectInconsistentMetadata"><span class="hs-identifier hs-type">CollectInconsistentMetadata</span></a></span><span> </span><span id="local-6989586621687411666"><span class="annot"><span class="annottext">InconsistentMetadata
</span><a href="#local-6989586621687411666"><span class="hs-identifier hs-var">inconsistentMetadata</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-355"></span><span>          </span><span class="annot"><span class="annottext">([InconsistentMetadata] -&gt; Identity [InconsistentMetadata])
-&gt; s -&gt; Identity t
forall s t a b. Field1 s t a b =&gt; Lens s t a b
Lens s t [InconsistentMetadata] [InconsistentMetadata]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-70a68698e02c1d9dc133c543e6497a7241e5514570afd4815da4baf2a001e00e/share/doc/html/src/Control.Lens.Tuple.html#_1"><span class="hs-identifier hs-var">_1</span></a></span><span> </span><span class="annot"><span class="annottext">(([InconsistentMetadata] -&gt; Identity [InconsistentMetadata])
 -&gt; s -&gt; Identity t)
-&gt; ([InconsistentMetadata] -&gt; [InconsistentMetadata]) -&gt; s -&gt; t
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-70a68698e02c1d9dc133c543e6497a7241e5514570afd4815da4baf2a001e00e/share/doc/html/src/Control.Lens.Setter.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">InconsistentMetadata
</span><a href="#local-6989586621687411666"><span class="hs-identifier hs-var">inconsistentMetadata</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
-&gt; [InconsistentMetadata] -&gt; [InconsistentMetadata]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectMetadataDependency"><span class="hs-identifier hs-type">CollectMetadataDependency</span></a></span><span> </span><span id="local-6989586621687411669"><span class="annot"><span class="annottext">MetadataDependency
</span><a href="#local-6989586621687411669"><span class="hs-keyword hs-var">dependency</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-357"></span><span>          </span><span class="annot"><span class="annottext">([MetadataDependency] -&gt; Identity [MetadataDependency])
-&gt; s -&gt; Identity t
forall s t a b. Field2 s t a b =&gt; Lens s t a b
Lens s t [MetadataDependency] [MetadataDependency]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-70a68698e02c1d9dc133c543e6497a7241e5514570afd4815da4baf2a001e00e/share/doc/html/src/Control.Lens.Tuple.html#_2"><span class="hs-identifier hs-var">_2</span></a></span><span> </span><span class="annot"><span class="annottext">(([MetadataDependency] -&gt; Identity [MetadataDependency])
 -&gt; s -&gt; Identity t)
-&gt; ([MetadataDependency] -&gt; [MetadataDependency]) -&gt; s -&gt; t
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-70a68698e02c1d9dc133c543e6497a7241e5514570afd4815da4baf2a001e00e/share/doc/html/src/Control.Lens.Setter.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">MetadataDependency
</span><a href="#local-6989586621687411669"><span class="hs-keyword hs-var">dependency</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[MetadataDependency]
-&gt; [MetadataDependency] -&gt; [MetadataDependency]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectStoredIntrospection"><span class="hs-identifier hs-type">CollectStoredIntrospection</span></a></span><span> </span><span id="local-6989586621687411672"><span class="annot"><span class="annottext">StoredIntrospectionItem
</span><a href="#local-6989586621687411672"><span class="hs-identifier hs-var">storedIntrospection</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-359"></span><span>          </span><span class="annot"><span class="annottext">([StoredIntrospectionItem] -&gt; Identity [StoredIntrospectionItem])
-&gt; s -&gt; Identity t
forall s t a b. Field3 s t a b =&gt; Lens s t a b
Lens s t [StoredIntrospectionItem] [StoredIntrospectionItem]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-70a68698e02c1d9dc133c543e6497a7241e5514570afd4815da4baf2a001e00e/share/doc/html/src/Control.Lens.Tuple.html#_3"><span class="hs-identifier hs-var">_3</span></a></span><span> </span><span class="annot"><span class="annottext">(([StoredIntrospectionItem] -&gt; Identity [StoredIntrospectionItem])
 -&gt; s -&gt; Identity t)
-&gt; ([StoredIntrospectionItem] -&gt; [StoredIntrospectionItem])
-&gt; s
-&gt; t
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-70a68698e02c1d9dc133c543e6497a7241e5514570afd4815da4baf2a001e00e/share/doc/html/src/Control.Lens.Setter.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">StoredIntrospectionItem
</span><a href="#local-6989586621687411672"><span class="hs-identifier hs-var">storedIntrospection</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[StoredIntrospectionItem]
-&gt; [StoredIntrospectionItem] -&gt; [StoredIntrospectionItem]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(CollectItem
 -&gt; ([InconsistentMetadata], [MetadataDependency],
     [StoredIntrospectionItem])
 -&gt; ([InconsistentMetadata], [MetadataDependency],
     [StoredIntrospectionItem]))
-&gt; ([InconsistentMetadata], [MetadataDependency],
    [StoredIntrospectionItem])
-&gt; [CollectItem]
-&gt; ([InconsistentMetadata], [MetadataDependency],
    [StoredIntrospectionItem])
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">CollectItem
-&gt; ([InconsistentMetadata], [MetadataDependency],
    [StoredIntrospectionItem])
-&gt; ([InconsistentMetadata], [MetadataDependency],
    [StoredIntrospectionItem])
forall {s} {t}.
(Field1 s t [InconsistentMetadata] [InconsistentMetadata],
 Field2 s t [MetadataDependency] [MetadataDependency],
 Field3 s t [StoredIntrospectionItem] [StoredIntrospectionItem]) =&gt;
CollectItem -&gt; s -&gt; t
</span><a href="#local-6989586621687411663"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([CollectItem]
 -&gt; ([InconsistentMetadata], [MetadataDependency],
     [StoredIntrospectionItem]))
-&gt; (Seq CollectItem -&gt; [CollectItem])
-&gt; Seq CollectItem
-&gt; ([InconsistentMetadata], [MetadataDependency],
    [StoredIntrospectionItem])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Seq CollectItem -&gt; [CollectItem]
forall a. Seq a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#buildSourcesIntrospectionStatus"><span class="hs-identifier hs-type">buildSourcesIntrospectionStatus</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-363"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#Sources"><span class="hs-identifier hs-type">Sources</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#RemoteSchemas"><span class="hs-identifier hs-type">RemoteSchemas</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#StoredIntrospectionItem"><span class="hs-identifier hs-type">StoredIntrospectionItem</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#SourcesIntrospectionStatus"><span class="hs-identifier hs-type">SourcesIntrospectionStatus</span></a></span><span>
</span><span id="line-364"></span><span id="buildSourcesIntrospectionStatus"><span class="annot"><span class="annottext">buildSourcesIntrospectionStatus :: InsOrdHashMap SourceName BackendSourceMetadata
-&gt; RemoteSchemas
-&gt; [StoredIntrospectionItem]
-&gt; SourcesIntrospectionStatus
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildSourcesIntrospectionStatus"><span class="hs-identifier hs-var hs-var">buildSourcesIntrospectionStatus</span></a></span></span><span> </span><span id="local-6989586621687411677"><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621687411677"><span class="hs-identifier hs-var">sourcesMetadata</span></a></span></span><span> </span><span id="local-6989586621687411678"><span class="annot"><span class="annottext">RemoteSchemas
</span><a href="#local-6989586621687411678"><span class="hs-identifier hs-var">remoteSchemasMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-365"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SourcesIntrospectionStatus
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#SourcesIntrospectionUnchanged"><span class="hs-identifier hs-var">SourcesIntrospectionUnchanged</span></a></span><span>
</span><span id="line-366"></span><span>  </span><span id="local-6989586621687411679"><span class="annot"><span class="annottext">[StoredIntrospectionItem]
</span><a href="#local-6989586621687411679"><span class="hs-identifier hs-var">items</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687411682"><span class="annot"><span class="annottext">go :: StoredIntrospectionItem
-&gt; ([(SourceName, EncJSON)], [(RemoteSchemaName, EncJSON)])
-&gt; ([(SourceName, EncJSON)], [(RemoteSchemaName, EncJSON)])
</span><a href="#local-6989586621687411682"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621687411683"><span class="annot"><span class="annottext">StoredIntrospectionItem
</span><a href="#local-6989586621687411683"><span class="hs-identifier hs-var">item</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687411684"><span class="annot"><span class="annottext">[(SourceName, EncJSON)]
</span><a href="#local-6989586621687411684"><span class="hs-identifier hs-var">sources</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411685"><span class="annot"><span class="annottext">[(RemoteSchemaName, EncJSON)]
</span><a href="#local-6989586621687411685"><span class="hs-identifier hs-var">remoteSchemas</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StoredIntrospectionItem
</span><a href="#local-6989586621687411683"><span class="hs-identifier hs-var">item</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-368"></span><span>          </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#SourceIntrospectionItem"><span class="hs-identifier hs-type">SourceIntrospectionItem</span></a></span><span> </span><span id="local-6989586621687411687"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687411687"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621687411688"><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687411688"><span class="hs-identifier hs-var">introspection</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-369"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(SourceName, EncJSON)]
</span><a href="#local-6989586621687411684"><span class="hs-identifier hs-var">sources</span></a></span><span> </span><span class="annot"><span class="annottext">[(SourceName, EncJSON)]
-&gt; [(SourceName, EncJSON)] -&gt; [(SourceName, EncJSON)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687411687"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687411688"><span class="hs-identifier hs-var">introspection</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(RemoteSchemaName, EncJSON)]
</span><a href="#local-6989586621687411685"><span class="hs-identifier hs-var">remoteSchemas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>          </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#RemoteSchemaIntrospectionItem"><span class="hs-identifier hs-type">RemoteSchemaIntrospectionItem</span></a></span><span> </span><span id="local-6989586621687411690"><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621687411690"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621687411691"><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687411691"><span class="hs-identifier hs-var">introspection</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-371"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(SourceName, EncJSON)]
</span><a href="#local-6989586621687411684"><span class="hs-identifier hs-var">sources</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(RemoteSchemaName, EncJSON)]
</span><a href="#local-6989586621687411685"><span class="hs-identifier hs-var">remoteSchemas</span></a></span><span> </span><span class="annot"><span class="annottext">[(RemoteSchemaName, EncJSON)]
-&gt; [(RemoteSchemaName, EncJSON)] -&gt; [(RemoteSchemaName, EncJSON)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621687411690"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687411691"><span class="hs-identifier hs-var">introspection</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621687411692"><span class="annot"><span class="annottext">[(SourceName, EncJSON)]
</span><a href="#local-6989586621687411692"><span class="hs-identifier hs-var">allSources</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411693"><span class="annot"><span class="annottext">[(RemoteSchemaName, EncJSON)]
</span><a href="#local-6989586621687411693"><span class="hs-identifier hs-var">allRemoteSchemas</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StoredIntrospectionItem
 -&gt; ([(SourceName, EncJSON)], [(RemoteSchemaName, EncJSON)])
 -&gt; ([(SourceName, EncJSON)], [(RemoteSchemaName, EncJSON)]))
-&gt; ([(SourceName, EncJSON)], [(RemoteSchemaName, EncJSON)])
-&gt; [StoredIntrospectionItem]
-&gt; ([(SourceName, EncJSON)], [(RemoteSchemaName, EncJSON)])
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">StoredIntrospectionItem
-&gt; ([(SourceName, EncJSON)], [(RemoteSchemaName, EncJSON)])
-&gt; ([(SourceName, EncJSON)], [(RemoteSchemaName, EncJSON)])
</span><a href="#local-6989586621687411682"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[StoredIntrospectionItem]
</span><a href="#local-6989586621687411679"><span class="hs-identifier hs-var">items</span></a></span><span>
</span><span id="line-373"></span><span>        </span><span id="local-6989586621687411694"><span class="annot"><span class="annottext">storedIntrospection :: StoredIntrospection
</span><a href="#local-6989586621687411694"><span class="hs-identifier hs-var hs-var">storedIntrospection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap SourceName EncJSON
-&gt; HashMap RemoteSchemaName EncJSON -&gt; StoredIntrospection
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#StoredIntrospection"><span class="hs-identifier hs-var">StoredIntrospection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(SourceName, EncJSON)] -&gt; HashMap SourceName EncJSON
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.Strict.html#fromList"><span class="hs-identifier hs-var">HashMap.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[(SourceName, EncJSON)]
</span><a href="#local-6989586621687411692"><span class="hs-identifier hs-var">allSources</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(RemoteSchemaName, EncJSON)] -&gt; HashMap RemoteSchemaName EncJSON
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.Strict.html#fromList"><span class="hs-identifier hs-var">HashMap.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[(RemoteSchemaName, EncJSON)]
</span><a href="#local-6989586621687411693"><span class="hs-identifier hs-var">allRemoteSchemas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[(SourceName, EncJSON)] -&gt; [(RemoteSchemaName, EncJSON)] -&gt; Bool
forall sourceIntrospection remoteSchemaIntrospection.
[(SourceName, sourceIntrospection)]
-&gt; [(RemoteSchemaName, remoteSchemaIntrospection)] -&gt; Bool
</span><a href="#local-6989586621687411696"><span class="hs-identifier hs-var">allSourcesAndRemoteSchemasCollected</span></a></span><span> </span><span class="annot"><span class="annottext">[(SourceName, EncJSON)]
</span><a href="#local-6989586621687411692"><span class="hs-identifier hs-var">allSources</span></a></span><span> </span><span class="annot"><span class="annottext">[(RemoteSchemaName, EncJSON)]
</span><a href="#local-6989586621687411693"><span class="hs-identifier hs-var">allRemoteSchemas</span></a></span><span>
</span><span id="line-375"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">StoredIntrospection -&gt; SourcesIntrospectionStatus
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#SourcesIntrospectionChangedFull"><span class="hs-identifier hs-var">SourcesIntrospectionChangedFull</span></a></span><span> </span><span class="annot"><span class="annottext">StoredIntrospection
</span><a href="#local-6989586621687411694"><span class="hs-identifier hs-var">storedIntrospection</span></a></span><span>
</span><span id="line-376"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">StoredIntrospection -&gt; SourcesIntrospectionStatus
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#SourcesIntrospectionChangedPartial"><span class="hs-identifier hs-var">SourcesIntrospectionChangedPartial</span></a></span><span> </span><span class="annot"><span class="annottext">StoredIntrospection
</span><a href="#local-6989586621687411694"><span class="hs-identifier hs-var">storedIntrospection</span></a></span><span>
</span><span id="line-377"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-378"></span><span>    </span><span id="local-6989586621687409908"><span id="local-6989586621687409909"><span class="annot"><a href="#local-6989586621687411696"><span class="hs-identifier hs-type">allSourcesAndRemoteSchemasCollected</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-379"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621687409908"><span class="hs-identifier hs-type">sourceIntrospection</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-380"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RemoteSchema.Metadata.Base.html#RemoteSchemaName"><span class="hs-identifier hs-type">RemoteSchemaName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621687409909"><span class="hs-identifier hs-type">remoteSchemaIntrospection</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-381"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-382"></span><span>    </span><span id="local-6989586621687411696"><span class="annot"><span class="annottext">allSourcesAndRemoteSchemasCollected :: forall sourceIntrospection remoteSchemaIntrospection.
[(SourceName, sourceIntrospection)]
-&gt; [(RemoteSchemaName, remoteSchemaIntrospection)] -&gt; Bool
</span><a href="#local-6989586621687411696"><span class="hs-identifier hs-var hs-var">allSourcesAndRemoteSchemasCollected</span></a></span></span><span> </span><span id="local-6989586621687411699"><span class="annot"><span class="annottext">[(SourceName, sourceIntrospection)]
</span><a href="#local-6989586621687411699"><span class="hs-identifier hs-var">sources</span></a></span></span><span> </span><span id="local-6989586621687411700"><span class="annot"><span class="annottext">[(RemoteSchemaName, remoteSchemaIntrospection)]
</span><a href="#local-6989586621687411700"><span class="hs-identifier hs-var">remoteSchemas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-383"></span><span>      </span><span class="annot"><span class="annottext">[SourceName]
-&gt; InsOrdHashMap SourceName BackendSourceMetadata -&gt; Bool
forall a b. Hashable a =&gt; [a] -&gt; InsOrdHashMap a b -&gt; Bool
</span><a href="#local-6989586621687411701"><span class="hs-identifier hs-var">allPresent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((SourceName, sourceIntrospection) -&gt; SourceName)
-&gt; [(SourceName, sourceIntrospection)] -&gt; [SourceName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(SourceName, sourceIntrospection) -&gt; SourceName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(SourceName, sourceIntrospection)]
</span><a href="#local-6989586621687411699"><span class="hs-identifier hs-var">sources</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621687411677"><span class="hs-identifier hs-var">sourcesMetadata</span></a></span><span>
</span><span id="line-384"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[RemoteSchemaName] -&gt; RemoteSchemas -&gt; Bool
forall a b. Hashable a =&gt; [a] -&gt; InsOrdHashMap a b -&gt; Bool
</span><a href="#local-6989586621687411701"><span class="hs-identifier hs-var">allPresent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((RemoteSchemaName, remoteSchemaIntrospection) -&gt; RemoteSchemaName)
-&gt; [(RemoteSchemaName, remoteSchemaIntrospection)]
-&gt; [RemoteSchemaName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(RemoteSchemaName, remoteSchemaIntrospection) -&gt; RemoteSchemaName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(RemoteSchemaName, remoteSchemaIntrospection)]
</span><a href="#local-6989586621687411700"><span class="hs-identifier hs-var">remoteSchemas</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RemoteSchemas
</span><a href="#local-6989586621687411678"><span class="hs-identifier hs-var">remoteSchemasMetadata</span></a></span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span>    </span><span id="local-6989586621687409912"><span id="local-6989586621687409913"><span class="annot"><a href="#local-6989586621687411701"><span class="hs-identifier hs-type">allPresent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/hashable-1.4.1.0-3c50bd0e18b247d18178d5211bea77b63bf7c268f9213ac135510791fe4312ad/share/doc/html/src/Data.Hashable.Class.html#Hashable"><span class="hs-identifier hs-type">Hashable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409912"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621687409912"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#InsOrdHashMap"><span class="hs-identifier hs-type">InsOrdHashMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409912"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409913"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-387"></span><span>    </span><span id="local-6989586621687411701"><span class="annot"><span class="annottext">allPresent :: forall a b. Hashable a =&gt; [a] -&gt; InsOrdHashMap a b -&gt; Bool
</span><a href="#local-6989586621687411701"><span class="hs-identifier hs-var hs-var">allPresent</span></a></span></span><span> </span><span id="local-6989586621687411709"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621687411709"><span class="hs-identifier hs-var">list</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Bool) -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621687411709"><span class="hs-identifier hs-var">list</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([a] -&gt; Bool)
-&gt; (InsOrdHashMap a b -&gt; [a]) -&gt; InsOrdHashMap a b -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap a b -&gt; [a]
forall k v. InsOrdHashMap k v -&gt; [k]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#keys"><span class="hs-identifier hs-var">InsOrdHashMap.keys</span></a></span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span class="hs-comment">{- Note [Avoiding GraphQL schema rebuilds when changing irrelevant Metadata]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
There are many Metadata operations that don't influence the GraphQL schema.  So
we should be caching its construction.

The `Hasura.Incremental` framework allows us to cache such constructions:
whenever we have an arrow `Rule m a b`, where `a` is the input to the arrow and
`b` the output, we can use the `Inc.cache` combinator to obtain a new arrow
which is only re-executed when the input `a` changes in a material way.  To test
this, `a` needs an `Eq` instance.

We can't simply apply `Inc.cache` to the GraphQL schema cache building phase
(`buildGQLContext`), because the inputs (components of `BuildOutputs` such as
`SourceCache`) don't have an `Eq` instance.

So the purpose of `buildOutputsAndSchema` is that we cach already at an earlier
point, encompassing more computation.  The Metadata and invalidation keys (which
have `Eq` instances) are used as a caching key, and `Inc.cache` can be applied
to the whole sequence of steps.

But because of the all-or-nothing nature of caching, it's important that
`buildOutputsAndSchema` is re-run as little as possible.  So the exercise
becomes to minimize the amount of stuff stored in `BuildOutputs`, so that as
many Metadata operations as possible can be handled outside of this codepath
that produces a GraphQL schema.
-}</span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span id="local-6989586621687409508"><span id="local-6989586621687409509"><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#buildSchemaCacheRule"><span class="hs-identifier hs-type">buildSchemaCacheRule</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-comment">-- Note: by supplying BuildReason via MonadReader, it does not participate in caching, which is</span><span>
</span><span id="line-418"></span><span>  </span><span class="hs-comment">-- what we want!</span><span>
</span><span id="line-419"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ArrowChoice</span></span><span> </span><span class="annot"><a href="#local-6989586621687409508"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-420"></span><span>    </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Rule.html#ArrowDistribute"><span class="hs-identifier hs-type">Inc.ArrowDistribute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409508"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-421"></span><span>    </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#ArrowCache"><span class="hs-identifier hs-type">Inc.ArrowCache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409509"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409508"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-422"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687409509"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-423"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-92f8a47f193bc8ca499a8b94581fad6cb68b7a26370b271798ac2ec617c05064/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687409509"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-424"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409509"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-425"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#BuildReason"><span class="hs-identifier hs-type">BuildReason</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409509"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-426"></span><span>    </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409509"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-427"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409509"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-428"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#HasCacheStaticConfig"><span class="hs-identifier hs-type">HasCacheStaticConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409509"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-429"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-430"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-431"></span><span>  </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Environment.html#Environment"><span class="hs-identifier hs-type">Env.Environment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-432"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.SchemaRegistry.html#SchemaRegistryContext"><span class="hs-identifier hs-type">SchemaRegistryContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-433"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#MetadataWithResourceVersion"><span class="hs-identifier hs-type">MetadataWithResourceVersion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#CacheDynamicConfig"><span class="hs-identifier hs-type">CacheDynamicConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#InvalidationKeys"><span class="hs-identifier hs-type">InvalidationKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#StoredIntrospection"><span class="hs-identifier hs-type">StoredIntrospection</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687409508"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#SchemaCache"><span class="hs-identifier hs-type">SchemaCache</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#SourcesIntrospectionStatus"><span class="hs-identifier hs-type">SourcesIntrospectionStatus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.SchemaRegistry.html#SchemaRegistryAction"><span class="hs-identifier hs-type">SchemaRegistryAction</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-434"></span><span id="buildSchemaCacheRule"><span class="annot"><span class="annottext">buildSchemaCacheRule :: forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowDistribute arr, ArrowCache m arr, MonadIO m,
 MonadBaseControl IO m, MonadError QErr m,
 MonadReader BuildReason m, ProvidesNetwork m, MonadResolveSource m,
 HasCacheStaticConfig m) =&gt;
Logger Hasura
-&gt; Environment
-&gt; Maybe SchemaRegistryContext
-&gt; arr
     (MetadataWithResourceVersion, CacheDynamicConfig, InvalidationKeys,
      Maybe StoredIntrospection)
     (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildSchemaCacheRule"><span class="hs-identifier hs-var hs-var">buildSchemaCacheRule</span></a></span></span><span> </span><span id="local-6989586621687411808"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687411808"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621687411809"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621687411809"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621687411810"><span class="annot"><span class="annottext">Maybe SchemaRegistryContext
</span><a href="#local-6989586621687411810"><span class="hs-identifier hs-var">mSchemaRegistryContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#MetadataWithResourceVersion"><span class="hs-identifier hs-type">MetadataWithResourceVersion</span></a></span><span> </span><span id="local-6989586621687411811"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687411811"><span class="hs-identifier hs-var">metadataNoDefaults</span></a></span></span><span> </span><span id="local-6989586621687411812"><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621687411812"><span class="hs-identifier hs-var">interimMetadataResourceVersion</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411813"><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687411813"><span class="hs-identifier hs-var">dynamicConfig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411814"><span class="annot"><span class="annottext">InvalidationKeys
</span><a href="#local-6989586621687411814"><span class="hs-identifier hs-var">invalidationKeys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411815"><span class="annot"><span class="annottext">Maybe StoredIntrospection
</span><a href="#local-6989586621687411815"><span class="hs-identifier hs-var">storedIntrospection</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-435"></span><span>  </span><span id="local-6989586621687411816"><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621687411816"><span class="hs-identifier hs-var">invalidationKeysDep</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr InvalidationKeys (Dependency InvalidationKeys)
forall a. arr a (Dependency a)
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowCache m arr =&gt;
arr a (Dependency a)
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#newDependency"><span class="hs-identifier hs-var">Inc.newDependency</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">InvalidationKeys
</span><a href="#local-6989586621687411814"><span class="hs-identifier hs-var">invalidationKeys</span></a></span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687411818"><span class="annot"><span class="annottext">metadataDefaults :: MetadataDefaults
</span><a href="#local-6989586621687411818"><span class="hs-identifier hs-var hs-var">metadataDefaults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig -&gt; MetadataDefaults
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cdcMetadataDefaults"><span class="hs-identifier hs-var">_cdcMetadataDefaults</span></a></span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687411813"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span>
</span><span id="line-437"></span><span>      </span><span id="local-6989586621687411820"><span class="annot"><span class="annottext">metadata :: Metadata
</span><a href="#local-6989586621687411820"><span class="hs-identifier hs-var">metadata</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#Metadata"><span class="hs-identifier hs-type">Metadata</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687411822"><span id="local-6989586621687411823"><span id="local-6989586621687411824"><span id="local-6989586621687411825"><span id="local-6989586621687411826"><span id="local-6989586621687411827"><span id="local-6989586621687411828"><span id="local-6989586621687411829"><span id="local-6989586621687411830"><span id="local-6989586621687411831"><span id="local-6989586621687411832"><span id="local-6989586621687411833"><span id="local-6989586621687411834"><span id="local-6989586621687411835"><span id="local-6989586621687411836"><span class="annot"><span class="annottext">Network
QueryCollections
MetadataAllowlist
Endpoints
InheritedRoles
InsOrdHashMap SourceName BackendSourceMetadata
RemoteSchemas
CronTriggers
Actions
OpenTelemetryConfig
SetGraphqlIntrospectionOptions
MetricsConfig
ApiLimit
BackendMap BackendConfigWrapper
CustomTypes
_metaSources :: InsOrdHashMap SourceName BackendSourceMetadata
_metaRemoteSchemas :: RemoteSchemas
_metaQueryCollections :: QueryCollections
_metaAllowlist :: MetadataAllowlist
_metaCustomTypes :: CustomTypes
_metaActions :: Actions
_metaCronTriggers :: CronTriggers
_metaRestEndpoints :: Endpoints
_metaApiLimits :: ApiLimit
_metaMetricsConfig :: MetricsConfig
_metaInheritedRoles :: InheritedRoles
_metaSetGraphqlIntrospectionOptions :: SetGraphqlIntrospectionOptions
_metaNetwork :: Network
_metaBackendConfigs :: BackendMap BackendConfigWrapper
_metaOpenTelemetryConfig :: OpenTelemetryConfig
_metaSources :: Metadata -&gt; InsOrdHashMap SourceName BackendSourceMetadata
_metaRemoteSchemas :: Metadata -&gt; RemoteSchemas
_metaQueryCollections :: Metadata -&gt; QueryCollections
_metaAllowlist :: Metadata -&gt; MetadataAllowlist
_metaCustomTypes :: Metadata -&gt; CustomTypes
_metaActions :: Metadata -&gt; Actions
_metaCronTriggers :: Metadata -&gt; CronTriggers
_metaRestEndpoints :: Metadata -&gt; Endpoints
_metaApiLimits :: Metadata -&gt; ApiLimit
_metaMetricsConfig :: Metadata -&gt; MetricsConfig
_metaInheritedRoles :: Metadata -&gt; InheritedRoles
_metaSetGraphqlIntrospectionOptions :: Metadata -&gt; SetGraphqlIntrospectionOptions
_metaNetwork :: Metadata -&gt; Network
_metaBackendConfigs :: Metadata -&gt; BackendMap BackendConfigWrapper
_metaOpenTelemetryConfig :: Metadata -&gt; OpenTelemetryConfig
</span><a href="#local-6989586621687411822"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; MetadataDefaults -&gt; Metadata
</span><a href="Hasura.RQL.Types.Metadata.html#overrideMetadataDefaults"><span class="hs-identifier hs-var">overrideMetadataDefaults</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687411811"><span class="hs-identifier hs-var">metadataNoDefaults</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataDefaults
</span><a href="#local-6989586621687411818"><span class="hs-identifier hs-var">metadataDefaults</span></a></span><span>
</span><span id="line-438"></span><span>  </span><span id="local-6989586621687411853"><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621687411853"><span class="hs-identifier hs-var">metadataDep</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr Metadata (Dependency Metadata)
forall a. arr a (Dependency a)
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowCache m arr =&gt;
arr a (Dependency a)
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#newDependency"><span class="hs-identifier hs-var">Inc.newDependency</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687411820"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621687411854"><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687411854"><span class="hs-identifier hs-var">inconsistentObjects</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411855"><span class="annot"><span class="annottext">[StoredIntrospectionItem]
</span><a href="#local-6989586621687411855"><span class="hs-identifier hs-var">storedIntrospections</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687411856"><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621687411856"><span class="hs-identifier hs-var">resolvedOutputs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411857"><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687411857"><span class="hs-identifier hs-var">dependencyInconsistentObjects</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411858"><span class="annot"><span class="annottext">DepMap
</span><a href="#local-6989586621687411858"><span class="hs-identifier hs-var">resolvedDependencies</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621687411859"><span class="annot"><span class="annottext">SchemaIntrospection
</span><a href="#local-6989586621687411859"><span class="hs-identifier hs-var">adminIntrospection</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411860"><span class="annot"><span class="annottext">HashMap RoleName (RoleContext GQLContext)
</span><a href="#local-6989586621687411860"><span class="hs-identifier hs-var">gqlContext</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411861"><span class="annot"><span class="annottext">GQLContext
</span><a href="#local-6989586621687411861"><span class="hs-identifier hs-var">gqlContextUnauth</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411862"><span class="annot"><span class="annottext">HashSet InconsistentMetadata
</span><a href="#local-6989586621687411862"><span class="hs-identifier hs-var">inconsistentRemoteSchemas</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687411863"><span class="annot"><span class="annottext">HashMap RoleName (RoleContext GQLContext)
</span><a href="#local-6989586621687411863"><span class="hs-identifier hs-var">relayContext</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411864"><span class="annot"><span class="annottext">GQLContext
</span><a href="#local-6989586621687411864"><span class="hs-identifier hs-var">relayContextUnauth</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411865"><span class="annot"><span class="annottext">SchemaRegistryAction
</span><a href="#local-6989586621687411865"><span class="hs-identifier hs-var">schemaRegistryAction</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-441"></span><span>    </span><span class="annot"><span class="annottext">arr
  (Dependency Metadata, CacheDynamicConfig,
   Dependency InvalidationKeys, Maybe StoredIntrospection)
  ([InconsistentMetadata], [StoredIntrospectionItem],
   (BuildOutputs, [InconsistentMetadata], DepMap),
   ((SchemaIntrospection, HashMap RoleName (RoleContext GQLContext),
     GQLContext, HashSet InconsistentMetadata),
    (HashMap RoleName (RoleContext GQLContext), GQLContext),
    SchemaRegistryAction))
-&gt; arr
     (Dependency Metadata, CacheDynamicConfig,
      Dependency InvalidationKeys, Maybe StoredIntrospection)
     ([InconsistentMetadata], [StoredIntrospectionItem],
      (BuildOutputs, [InconsistentMetadata], DepMap),
      ((SchemaIntrospection, HashMap RoleName (RoleContext GQLContext),
        GQLContext, HashSet InconsistentMetadata),
       (HashMap RoleName (RoleContext GQLContext), GQLContext),
       SchemaRegistryAction))
forall a b. (Given Accesses =&gt; Eq a) =&gt; arr a b -&gt; arr a b
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a b.
(ArrowCache m arr, Given Accesses =&gt; Eq a) =&gt;
arr a b -&gt; arr a b
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#cache"><span class="hs-identifier hs-var">Inc.cache</span></a></span><span> </span><span class="annot"><span class="annottext">arr
  (Dependency Metadata, CacheDynamicConfig,
   Dependency InvalidationKeys, Maybe StoredIntrospection)
  ([InconsistentMetadata], [StoredIntrospectionItem],
   (BuildOutputs, [InconsistentMetadata], DepMap),
   ((SchemaIntrospection, HashMap RoleName (RoleContext GQLContext),
     GQLContext, HashSet InconsistentMetadata),
    (HashMap RoleName (RoleContext GQLContext), GQLContext),
    SchemaRegistryAction))
</span><a href="#local-6989586621687411867"><span class="hs-identifier hs-var">buildOutputsAndSchema</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621687411853"><span class="hs-identifier hs-var">metadataDep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687411813"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621687411816"><span class="hs-identifier hs-var">invalidationKeysDep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe StoredIntrospection
</span><a href="#local-6989586621687411815"><span class="hs-identifier hs-var">storedIntrospection</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687411868"><span class="annot"><span class="annottext">storedIntrospectionStatus :: SourcesIntrospectionStatus
</span><a href="#local-6989586621687411868"><span class="hs-identifier hs-var hs-var">storedIntrospectionStatus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
-&gt; RemoteSchemas
-&gt; [StoredIntrospectionItem]
-&gt; SourcesIntrospectionStatus
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildSourcesIntrospectionStatus"><span class="hs-identifier hs-var">buildSourcesIntrospectionStatus</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621687411822"><span class="hs-identifier hs-var">_metaSources</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemas
</span><a href="#local-6989586621687411823"><span class="hs-identifier hs-var">_metaRemoteSchemas</span></a></span><span> </span><span class="annot"><span class="annottext">[StoredIntrospectionItem]
</span><a href="#local-6989586621687411855"><span class="hs-identifier hs-var">storedIntrospections</span></a></span><span>
</span><span id="line-444"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621687411869"><span class="annot"><span class="annottext">HashMap EndpointName (EndpointMetadata GQLQueryWithText)
</span><a href="#local-6989586621687411869"><span class="hs-identifier hs-var">resolvedEndpoints</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411870"><span class="annot"><span class="annottext">Seq CollectItem
</span><a href="#local-6989586621687411870"><span class="hs-identifier hs-var">endpointCollectedInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identity
  (HashMap EndpointName (EndpointMetadata GQLQueryWithText),
   Seq CollectItem)
-&gt; (HashMap EndpointName (EndpointMetadata GQLQueryWithText),
    Seq CollectItem)
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity
   (HashMap EndpointName (EndpointMetadata GQLQueryWithText),
    Seq CollectItem)
 -&gt; (HashMap EndpointName (EndpointMetadata GQLQueryWithText),
     Seq CollectItem))
-&gt; Identity
     (HashMap EndpointName (EndpointMetadata GQLQueryWithText),
      Seq CollectItem)
-&gt; (HashMap EndpointName (EndpointMetadata GQLQueryWithText),
    Seq CollectItem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WriterT
  (Seq CollectItem)
  Identity
  (HashMap EndpointName (EndpointMetadata GQLQueryWithText))
-&gt; Identity
     (HashMap EndpointName (EndpointMetadata GQLQueryWithText),
      Seq CollectItem)
forall w (m :: * -&gt; *) a. WriterT w m a -&gt; m (a, w)
</span><span class="hs-identifier hs-var">runWriterT</span></span><span> </span><span class="annot"><span class="annottext">(WriterT
   (Seq CollectItem)
   Identity
   (HashMap EndpointName (EndpointMetadata GQLQueryWithText))
 -&gt; Identity
      (HashMap EndpointName (EndpointMetadata GQLQueryWithText),
       Seq CollectItem))
-&gt; WriterT
     (Seq CollectItem)
     Identity
     (HashMap EndpointName (EndpointMetadata GQLQueryWithText))
-&gt; Identity
     (HashMap EndpointName (EndpointMetadata GQLQueryWithText),
      Seq CollectItem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QueryCollections
-&gt; [CreateEndpoint]
-&gt; WriterT
     (Seq CollectItem)
     Identity
     (HashMap EndpointName (EndpointMetadata GQLQueryWithText))
forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
QueryCollections
-&gt; [CreateEndpoint]
-&gt; m (HashMap EndpointName (EndpointMetadata GQLQueryWithText))
</span><a href="#local-6989586621687411873"><span class="hs-identifier hs-var">buildRESTEndpoints</span></a></span><span> </span><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621687411824"><span class="hs-identifier hs-var">_metaQueryCollections</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Endpoints -&gt; [CreateEndpoint]
forall k v. InsOrdHashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#elems"><span class="hs-identifier hs-var">InsOrdHashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">Endpoints
</span><a href="#local-6989586621687411829"><span class="hs-identifier hs-var">_metaRestEndpoints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621687411875"><span class="annot"><span class="annottext">HashMap TriggerName CronTriggerInfo
</span><a href="#local-6989586621687411875"><span class="hs-identifier hs-var">cronTriggersMap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411876"><span class="annot"><span class="annottext">Seq CollectItem
</span><a href="#local-6989586621687411876"><span class="hs-identifier hs-var">cronTriggersCollectedInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identity (HashMap TriggerName CronTriggerInfo, Seq CollectItem)
-&gt; (HashMap TriggerName CronTriggerInfo, Seq CollectItem)
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity (HashMap TriggerName CronTriggerInfo, Seq CollectItem)
 -&gt; (HashMap TriggerName CronTriggerInfo, Seq CollectItem))
-&gt; Identity (HashMap TriggerName CronTriggerInfo, Seq CollectItem)
-&gt; (HashMap TriggerName CronTriggerInfo, Seq CollectItem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WriterT
  (Seq CollectItem) Identity (HashMap TriggerName CronTriggerInfo)
-&gt; Identity (HashMap TriggerName CronTriggerInfo, Seq CollectItem)
forall w (m :: * -&gt; *) a. WriterT w m a -&gt; m (a, w)
</span><span class="hs-identifier hs-var">runWriterT</span></span><span> </span><span class="annot"><span class="annottext">(WriterT
   (Seq CollectItem) Identity (HashMap TriggerName CronTriggerInfo)
 -&gt; Identity (HashMap TriggerName CronTriggerInfo, Seq CollectItem))
-&gt; WriterT
     (Seq CollectItem) Identity (HashMap TriggerName CronTriggerInfo)
-&gt; Identity (HashMap TriggerName CronTriggerInfo, Seq CollectItem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[CronTriggerMetadata]
-&gt; WriterT
     (Seq CollectItem) Identity (HashMap TriggerName CronTriggerInfo)
forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
[CronTriggerMetadata] -&gt; m (HashMap TriggerName CronTriggerInfo)
</span><a href="#local-6989586621687411877"><span class="hs-identifier hs-var">buildCronTriggers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CronTriggers -&gt; [CronTriggerMetadata]
forall k v. InsOrdHashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#elems"><span class="hs-identifier hs-var">InsOrdHashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggers
</span><a href="#local-6989586621687411828"><span class="hs-identifier hs-var">_metaCronTriggers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621687411878"><span class="annot"><span class="annottext">OpenTelemetryInfo
</span><a href="#local-6989586621687411878"><span class="hs-identifier hs-var">openTelemetryInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411879"><span class="annot"><span class="annottext">Seq CollectItem
</span><a href="#local-6989586621687411879"><span class="hs-identifier hs-var">openTelemetryCollectedInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identity (OpenTelemetryInfo, Seq CollectItem)
-&gt; (OpenTelemetryInfo, Seq CollectItem)
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity (OpenTelemetryInfo, Seq CollectItem)
 -&gt; (OpenTelemetryInfo, Seq CollectItem))
-&gt; Identity (OpenTelemetryInfo, Seq CollectItem)
-&gt; (OpenTelemetryInfo, Seq CollectItem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WriterT (Seq CollectItem) Identity OpenTelemetryInfo
-&gt; Identity (OpenTelemetryInfo, Seq CollectItem)
forall w (m :: * -&gt; *) a. WriterT w m a -&gt; m (a, w)
</span><span class="hs-identifier hs-var">runWriterT</span></span><span> </span><span class="annot"><span class="annottext">(WriterT (Seq CollectItem) Identity OpenTelemetryInfo
 -&gt; Identity (OpenTelemetryInfo, Seq CollectItem))
-&gt; WriterT (Seq CollectItem) Identity OpenTelemetryInfo
-&gt; Identity (OpenTelemetryInfo, Seq CollectItem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OpenTelemetryConfig
-&gt; WriterT (Seq CollectItem) Identity OpenTelemetryInfo
forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
OpenTelemetryConfig -&gt; m OpenTelemetryInfo
</span><a href="#local-6989586621687411880"><span class="hs-identifier hs-var">buildOpenTelemetry</span></a></span><span> </span><span class="annot"><span class="annottext">OpenTelemetryConfig
</span><a href="#local-6989586621687411836"><span class="hs-identifier hs-var">_metaOpenTelemetryConfig</span></a></span><span>
</span><span id="line-447"></span><span>
</span><span id="line-448"></span><span>      </span><span id="local-6989586621687409992"><span class="annot"><a href="#local-6989586621687411881"><span class="hs-identifier hs-type">duplicateVariables</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointMetadata"><span class="hs-identifier hs-type">EndpointMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687409992"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-449"></span><span>      </span><span id="local-6989586621687411881"><span class="annot"><span class="annottext">duplicateVariables :: forall a. EndpointMetadata a -&gt; Bool
</span><a href="#local-6989586621687411881"><span class="hs-identifier hs-var hs-var">duplicateVariables</span></a></span></span><span> </span><span id="local-6989586621687411893"><span class="annot"><span class="annottext">EndpointMetadata a
</span><a href="#local-6989586621687411893"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Bool) -&gt; [[Text]] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Bool) -&gt; ([Text] -&gt; Int) -&gt; [Text] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([[Text]] -&gt; Bool) -&gt; [[Text]] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [[Text]]
forall a. Eq a =&gt; [a] -&gt; [[a]]
</span><span class="hs-identifier hs-var">group</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; [[Text]]) -&gt; [Text] -&gt; [[Text]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sort</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; [Text]) -&gt; [Text] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Text] -&gt; [Text]
forall a. [Maybe a] -&gt; [a]
forall (f :: * -&gt; *) a. Filterable f =&gt; f (Maybe a) -&gt; f a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/witherable-0.4.2-a40f3f0a2ed7f25145b5b00589bf4ea2486662b1e96b7d29d5e6041625ee4a09/share/doc/html/src/Witherable.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">([Maybe Text] -&gt; [Text]) -&gt; [Maybe Text] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe Text)
-&gt; (Text -&gt; Maybe Text) -&gt; EndpointUrl -&gt; [Maybe Text]
forall a. (Text -&gt; a) -&gt; (Text -&gt; a) -&gt; EndpointUrl -&gt; [a]
</span><a href="Hasura.RQL.Types.Endpoint.html#splitPath"><span class="hs-identifier hs-var">splitPath</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Text -&gt; Text -&gt; Maybe Text
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EndpointMetadata a -&gt; EndpointUrl
forall query. EndpointMetadata query -&gt; EndpointUrl
</span><a href="Hasura.RQL.Types.Endpoint.html#_ceUrl"><span class="hs-identifier hs-var">_ceUrl</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata a
</span><a href="#local-6989586621687411893"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span>
</span><span id="line-451"></span><span>      </span><span id="local-6989586621687410003"><span class="annot"><a href="#local-6989586621687411902"><span class="hs-identifier hs-type">endpointObjId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointMetadata"><span class="hs-identifier hs-type">EndpointMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410003"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObjId"><span class="hs-identifier hs-type">MetadataObjId</span></a></span></span><span>
</span><span id="line-452"></span><span>      </span><span id="local-6989586621687411902"><span class="annot"><span class="annottext">endpointObjId :: forall q. EndpointMetadata q -&gt; MetadataObjId
</span><a href="#local-6989586621687411902"><span class="hs-identifier hs-var hs-var">endpointObjId</span></a></span></span><span> </span><span id="local-6989586621687411903"><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621687411903"><span class="hs-identifier hs-var">md</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EndpointName -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOEndpoint"><span class="hs-identifier hs-var">MOEndpoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EndpointMetadata q -&gt; EndpointName
forall query. EndpointMetadata query -&gt; EndpointName
</span><a href="Hasura.RQL.Types.Endpoint.html#_ceName"><span class="hs-identifier hs-var">_ceName</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621687411903"><span class="hs-identifier hs-var">md</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span>      </span><span id="local-6989586621687410007"><span class="annot"><a href="#local-6989586621687411906"><span class="hs-identifier hs-type">endpointObject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointMetadata"><span class="hs-identifier hs-type">EndpointMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410007"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span></span><span>
</span><span id="line-455"></span><span>      </span><span id="local-6989586621687411906"><span class="annot"><span class="annottext">endpointObject :: forall q. EndpointMetadata q -&gt; MetadataObject
</span><a href="#local-6989586621687411906"><span class="hs-identifier hs-var hs-var">endpointObject</span></a></span></span><span> </span><span id="local-6989586621687411917"><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621687411917"><span class="hs-identifier hs-var">md</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EndpointMetadata q -&gt; MetadataObjId
forall q. EndpointMetadata q -&gt; MetadataObjId
</span><a href="#local-6989586621687411902"><span class="hs-identifier hs-var">endpointObjId</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621687411917"><span class="hs-identifier hs-var">md</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe CreateEndpoint -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe CreateEndpoint -&gt; Value) -&gt; Maybe CreateEndpoint -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EndpointName -&gt; Endpoints -&gt; Maybe CreateEndpoint
forall k v. (Eq k, Hashable k) =&gt; k -&gt; InsOrdHashMap k v -&gt; Maybe v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#lookup"><span class="hs-identifier hs-var">InsOrdHashMap.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EndpointMetadata q -&gt; EndpointName
forall query. EndpointMetadata query -&gt; EndpointName
</span><a href="Hasura.RQL.Types.Endpoint.html#_ceName"><span class="hs-identifier hs-var">_ceName</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621687411917"><span class="hs-identifier hs-var">md</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Endpoints
</span><a href="#local-6989586621687411829"><span class="hs-identifier hs-var">_metaRestEndpoints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span>      </span><span class="annot"><a href="#local-6989586621687411921"><span class="hs-identifier hs-type">listedQueryObjects</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#CollectionName"><span class="hs-identifier hs-type">CollectionName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#ListedQuery"><span class="hs-identifier hs-type">ListedQuery</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span><span>
</span><span id="line-458"></span><span>      </span><span id="local-6989586621687411921"><span class="annot"><span class="annottext">listedQueryObjects :: (CollectionName, ListedQuery) -&gt; MetadataObject
</span><a href="#local-6989586621687411921"><span class="hs-identifier hs-var hs-var">listedQueryObjects</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687411922"><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621687411922"><span class="hs-identifier hs-var">cName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687411923"><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621687411923"><span class="hs-identifier hs-var">lq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectionName -&gt; ListedQuery -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOQueryCollectionsQuery"><span class="hs-identifier hs-var">MOQueryCollectionsQuery</span></a></span><span> </span><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621687411922"><span class="hs-identifier hs-var">cName</span></a></span><span> </span><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621687411923"><span class="hs-identifier hs-var">lq</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ListedQuery -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621687411923"><span class="hs-identifier hs-var">lq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span>      </span><span class="hs-comment">--  Cases of urls that generate invalid segments:</span><span>
</span><span id="line-461"></span><span>
</span><span id="line-462"></span><span>      </span><span id="local-6989586621687411925"><span class="annot"><a href="#local-6989586621687411926"><span class="hs-identifier hs-type">hasInvalidSegments</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointMetadata"><span class="hs-identifier hs-type">EndpointMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687411925"><span class="hs-identifier hs-type">query</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-463"></span><span>      </span><span id="local-6989586621687411926"><span class="annot"><span class="annottext">hasInvalidSegments :: forall a. EndpointMetadata a -&gt; Bool
</span><a href="#local-6989586621687411926"><span class="hs-identifier hs-var hs-var">hasInvalidSegments</span></a></span></span><span> </span><span id="local-6989586621687411932"><span class="annot"><span class="annottext">EndpointMetadata query
</span><a href="#local-6989586621687411932"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Bool) -&gt; [Text] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;:&quot;</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (Text -&gt; Text) -&gt; EndpointUrl -&gt; [Text]
forall a. (Text -&gt; a) -&gt; (Text -&gt; a) -&gt; EndpointUrl -&gt; [a]
</span><a href="Hasura.RQL.Types.Endpoint.html#splitPath"><span class="hs-identifier hs-var">splitPath</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EndpointMetadata query -&gt; EndpointUrl
forall query. EndpointMetadata query -&gt; EndpointUrl
</span><a href="Hasura.RQL.Types.Endpoint.html#_ceUrl"><span class="hs-identifier hs-var">_ceUrl</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata query
</span><a href="#local-6989586621687411932"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span>
</span><span id="line-465"></span><span>      </span><span id="local-6989586621687411936"><span class="annot"><span class="annottext">ceUrlTxt :: EndpointMetadata query -&gt; Text
</span><a href="#local-6989586621687411936"><span class="hs-identifier hs-var hs-var">ceUrlTxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EndpointUrl -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">(EndpointUrl -&gt; Text)
-&gt; (EndpointMetadata query -&gt; EndpointUrl)
-&gt; EndpointMetadata query
-&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata query -&gt; EndpointUrl
forall query. EndpointMetadata query -&gt; EndpointUrl
</span><a href="Hasura.RQL.Types.Endpoint.html#_ceUrl"><span class="hs-identifier hs-var">_ceUrl</span></a></span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span>      </span><span id="local-6989586621687411938"><span class="annot"><span class="annottext">endpoints :: EndpointTrie GQLQueryWithText
</span><a href="#local-6989586621687411938"><span class="hs-identifier hs-var hs-var">endpoints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EndpointMetadata GQLQueryWithText]
-&gt; EndpointTrie GQLQueryWithText
forall query.
Ord query =&gt;
[EndpointMetadata query] -&gt; EndpointTrie query
</span><a href="Hasura.RQL.Types.Endpoint.html#buildEndpointsTrie"><span class="hs-identifier hs-var">buildEndpointsTrie</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap EndpointName (EndpointMetadata GQLQueryWithText)
-&gt; [EndpointMetadata GQLQueryWithText]
forall k v. HashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#elems"><span class="hs-identifier hs-var">HashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap EndpointName (EndpointMetadata GQLQueryWithText)
</span><a href="#local-6989586621687411869"><span class="hs-identifier hs-var">resolvedEndpoints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span>      </span><span id="local-6989586621687411941"><span class="annot"><span class="annottext">duplicateF :: EndpointMetadata q -&gt; InconsistentMetadata
</span><a href="#local-6989586621687411941"><span class="hs-identifier hs-var hs-var">duplicateF</span></a></span></span><span> </span><span id="local-6989586621687411942"><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621687411942"><span class="hs-identifier hs-var">md</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MetadataObject -&gt; InconsistentMetadata
</span><a href="Hasura.RQL.Types.Metadata.Object.html#DuplicateRestVariables"><span class="hs-identifier hs-var">DuplicateRestVariables</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EndpointMetadata q -&gt; Text
forall {query}. EndpointMetadata query -&gt; Text
</span><a href="#local-6989586621687411936"><span class="hs-identifier hs-var">ceUrlTxt</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621687411942"><span class="hs-identifier hs-var">md</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EndpointMetadata q -&gt; MetadataObject
forall q. EndpointMetadata q -&gt; MetadataObject
</span><a href="#local-6989586621687411906"><span class="hs-identifier hs-var">endpointObject</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621687411942"><span class="hs-identifier hs-var">md</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-470"></span><span>      </span><span id="local-6989586621687411944"><span class="annot"><span class="annottext">duplicateRestVariables :: [InconsistentMetadata]
</span><a href="#local-6989586621687411944"><span class="hs-identifier hs-var hs-var">duplicateRestVariables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EndpointMetadata GQLQueryWithText -&gt; InconsistentMetadata)
-&gt; [EndpointMetadata GQLQueryWithText] -&gt; [InconsistentMetadata]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata GQLQueryWithText -&gt; InconsistentMetadata
forall {q}. EndpointMetadata q -&gt; InconsistentMetadata
</span><a href="#local-6989586621687411941"><span class="hs-identifier hs-var">duplicateF</span></a></span><span> </span><span class="annot"><span class="annottext">([EndpointMetadata GQLQueryWithText] -&gt; [InconsistentMetadata])
-&gt; [EndpointMetadata GQLQueryWithText] -&gt; [InconsistentMetadata]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EndpointMetadata GQLQueryWithText -&gt; Bool)
-&gt; [EndpointMetadata GQLQueryWithText]
-&gt; [EndpointMetadata GQLQueryWithText]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata GQLQueryWithText -&gt; Bool
forall a. EndpointMetadata a -&gt; Bool
</span><a href="#local-6989586621687411881"><span class="hs-identifier hs-var">duplicateVariables</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap EndpointName (EndpointMetadata GQLQueryWithText)
-&gt; [EndpointMetadata GQLQueryWithText]
forall k v. HashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#elems"><span class="hs-identifier hs-var">HashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap EndpointName (EndpointMetadata GQLQueryWithText)
</span><a href="#local-6989586621687411869"><span class="hs-identifier hs-var">resolvedEndpoints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span>      </span><span id="local-6989586621687411945"><span class="annot"><span class="annottext">invalidF :: EndpointMetadata q -&gt; InconsistentMetadata
</span><a href="#local-6989586621687411945"><span class="hs-identifier hs-var hs-var">invalidF</span></a></span></span><span> </span><span id="local-6989586621687411946"><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621687411946"><span class="hs-identifier hs-var">md</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MetadataObject -&gt; InconsistentMetadata
</span><a href="Hasura.RQL.Types.Metadata.Object.html#InvalidRestSegments"><span class="hs-identifier hs-var">InvalidRestSegments</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EndpointMetadata q -&gt; Text
forall {query}. EndpointMetadata query -&gt; Text
</span><a href="#local-6989586621687411936"><span class="hs-identifier hs-var">ceUrlTxt</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621687411946"><span class="hs-identifier hs-var">md</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EndpointMetadata q -&gt; MetadataObject
forall q. EndpointMetadata q -&gt; MetadataObject
</span><a href="#local-6989586621687411906"><span class="hs-identifier hs-var">endpointObject</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621687411946"><span class="hs-identifier hs-var">md</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-473"></span><span>      </span><span id="local-6989586621687411948"><span class="annot"><span class="annottext">invalidRestSegments :: [InconsistentMetadata]
</span><a href="#local-6989586621687411948"><span class="hs-identifier hs-var hs-var">invalidRestSegments</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EndpointMetadata GQLQueryWithText -&gt; InconsistentMetadata)
-&gt; [EndpointMetadata GQLQueryWithText] -&gt; [InconsistentMetadata]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata GQLQueryWithText -&gt; InconsistentMetadata
forall {q}. EndpointMetadata q -&gt; InconsistentMetadata
</span><a href="#local-6989586621687411945"><span class="hs-identifier hs-var">invalidF</span></a></span><span> </span><span class="annot"><span class="annottext">([EndpointMetadata GQLQueryWithText] -&gt; [InconsistentMetadata])
-&gt; [EndpointMetadata GQLQueryWithText] -&gt; [InconsistentMetadata]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EndpointMetadata GQLQueryWithText -&gt; Bool)
-&gt; [EndpointMetadata GQLQueryWithText]
-&gt; [EndpointMetadata GQLQueryWithText]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata GQLQueryWithText -&gt; Bool
forall a. EndpointMetadata a -&gt; Bool
</span><a href="#local-6989586621687411926"><span class="hs-identifier hs-var">hasInvalidSegments</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap EndpointName (EndpointMetadata GQLQueryWithText)
-&gt; [EndpointMetadata GQLQueryWithText]
forall k v. HashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#elems"><span class="hs-identifier hs-var">HashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap EndpointName (EndpointMetadata GQLQueryWithText)
</span><a href="#local-6989586621687411869"><span class="hs-identifier hs-var">resolvedEndpoints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span>      </span><span id="local-6989586621687411952"><span class="annot"><span class="annottext">ambiguousF' :: EndpointMetadata q -&gt; MetadataObject
</span><a href="#local-6989586621687411952"><span class="hs-identifier hs-var hs-var">ambiguousF'</span></a></span></span><span> </span><span id="local-6989586621687411953"><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621687411953"><span class="hs-identifier hs-var">ep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EndpointMetadata q -&gt; MetadataObjId
forall q. EndpointMetadata q -&gt; MetadataObjId
</span><a href="#local-6989586621687411902"><span class="hs-identifier hs-var">endpointObjId</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621687411953"><span class="hs-identifier hs-var">ep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EndpointMetadata q -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621687411953"><span class="hs-identifier hs-var">ep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>      </span><span id="local-6989586621687411958"><span class="annot"><span class="annottext">ambiguousF :: [EndpointMetadata q] -&gt; InconsistentMetadata
</span><a href="#local-6989586621687411958"><span class="hs-identifier hs-var hs-var">ambiguousF</span></a></span></span><span> </span><span id="local-6989586621687411959"><span class="annot"><span class="annottext">[EndpointMetadata q]
</span><a href="#local-6989586621687411959"><span class="hs-identifier hs-var">mds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [MetadataObject] -&gt; InconsistentMetadata
</span><a href="Hasura.RQL.Types.Metadata.Object.html#AmbiguousRestEndpoints"><span class="hs-identifier hs-var">AmbiguousRestEndpoints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EndpointUrl] -&gt; Text
forall t (f :: * -&gt; *). (ToTxt t, Foldable f) =&gt; f t -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#commaSeparated"><span class="hs-identifier hs-var">commaSeparated</span></a></span><span> </span><span class="annot"><span class="annottext">([EndpointUrl] -&gt; Text) -&gt; [EndpointUrl] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EndpointMetadata q -&gt; EndpointUrl)
-&gt; [EndpointMetadata q] -&gt; [EndpointUrl]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata q -&gt; EndpointUrl
forall query. EndpointMetadata query -&gt; EndpointUrl
</span><a href="Hasura.RQL.Types.Endpoint.html#_ceUrl"><span class="hs-identifier hs-var">_ceUrl</span></a></span><span> </span><span class="annot"><span class="annottext">[EndpointMetadata q]
</span><a href="#local-6989586621687411959"><span class="hs-identifier hs-var">mds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EndpointMetadata q -&gt; MetadataObject)
-&gt; [EndpointMetadata q] -&gt; [MetadataObject]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata q -&gt; MetadataObject
forall {q}. ToJSON q =&gt; EndpointMetadata q -&gt; MetadataObject
</span><a href="#local-6989586621687411952"><span class="hs-identifier hs-var">ambiguousF'</span></a></span><span> </span><span class="annot"><span class="annottext">[EndpointMetadata q]
</span><a href="#local-6989586621687411959"><span class="hs-identifier hs-var">mds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>      </span><span id="local-6989586621687411962"><span class="annot"><span class="annottext">ambiguousRestEndpoints :: [InconsistentMetadata]
</span><a href="#local-6989586621687411962"><span class="hs-identifier hs-var hs-var">ambiguousRestEndpoints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Set [PathComponent Text],
  Set (EndpointMetadata GQLQueryWithText))
 -&gt; InconsistentMetadata)
-&gt; [(Set [PathComponent Text],
     Set (EndpointMetadata GQLQueryWithText))]
-&gt; [InconsistentMetadata]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EndpointMetadata GQLQueryWithText] -&gt; InconsistentMetadata
forall {q}.
ToJSON q =&gt;
[EndpointMetadata q] -&gt; InconsistentMetadata
</span><a href="#local-6989586621687411958"><span class="hs-identifier hs-var">ambiguousF</span></a></span><span> </span><span class="annot"><span class="annottext">([EndpointMetadata GQLQueryWithText] -&gt; InconsistentMetadata)
-&gt; ((Set [PathComponent Text],
     Set (EndpointMetadata GQLQueryWithText))
    -&gt; [EndpointMetadata GQLQueryWithText])
-&gt; (Set [PathComponent Text],
    Set (EndpointMetadata GQLQueryWithText))
-&gt; InconsistentMetadata
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set (EndpointMetadata GQLQueryWithText)
-&gt; [EndpointMetadata GQLQueryWithText]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.elems</span></span><span> </span><span class="annot"><span class="annottext">(Set (EndpointMetadata GQLQueryWithText)
 -&gt; [EndpointMetadata GQLQueryWithText])
-&gt; ((Set [PathComponent Text],
     Set (EndpointMetadata GQLQueryWithText))
    -&gt; Set (EndpointMetadata GQLQueryWithText))
-&gt; (Set [PathComponent Text],
    Set (EndpointMetadata GQLQueryWithText))
-&gt; [EndpointMetadata GQLQueryWithText]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Set [PathComponent Text], Set (EndpointMetadata GQLQueryWithText))
-&gt; Set (EndpointMetadata GQLQueryWithText)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Set [PathComponent Text],
   Set (EndpointMetadata GQLQueryWithText))]
 -&gt; [InconsistentMetadata])
-&gt; [(Set [PathComponent Text],
     Set (EndpointMetadata GQLQueryWithText))]
-&gt; [InconsistentMetadata]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EndpointTrie GQLQueryWithText
-&gt; [(Set [PathComponent Text],
     Set (EndpointMetadata GQLQueryWithText))]
forall a k v.
(Hashable a, Hashable k, Ord v, Ord a) =&gt;
MultiMapPathTrie a k v -&gt; [(Set [PathComponent a], Set v)]
</span><a href="Hasura.RQL.Types.Endpoint.Trie.html#ambiguousPathsGrouped"><span class="hs-identifier hs-var">ambiguousPathsGrouped</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointTrie GQLQueryWithText
</span><a href="#local-6989586621687411938"><span class="hs-identifier hs-var">endpoints</span></a></span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span>      </span><span id="local-6989586621687411966"><span class="annot"><span class="annottext">inlinedAllowlist :: InlinedAllowlist
</span><a href="#local-6989586621687411966"><span class="hs-identifier hs-var hs-var">inlinedAllowlist</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QueryCollections -&gt; MetadataAllowlist -&gt; InlinedAllowlist
</span><a href="Hasura.RQL.Types.Allowlist.html#inlineAllowlist"><span class="hs-identifier hs-var">inlineAllowlist</span></a></span><span> </span><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621687411824"><span class="hs-identifier hs-var">_metaQueryCollections</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataAllowlist
</span><a href="#local-6989586621687411825"><span class="hs-identifier hs-var">_metaAllowlist</span></a></span><span>
</span><span id="line-480"></span><span>      </span><span id="local-6989586621687411968"><span class="annot"><span class="annottext">globalAllowLists :: [NormalizedQuery]
</span><a href="#local-6989586621687411968"><span class="hs-identifier hs-var hs-var">globalAllowLists</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet NormalizedQuery -&gt; [NormalizedQuery]
forall a. HashSet a -&gt; [a]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashSet.Internal.html#toList"><span class="hs-identifier hs-var">HS.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(HashSet NormalizedQuery -&gt; [NormalizedQuery])
-&gt; (InlinedAllowlist -&gt; HashSet NormalizedQuery)
-&gt; InlinedAllowlist
-&gt; [NormalizedQuery]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">InlinedAllowlist -&gt; HashSet NormalizedQuery
</span><a href="Hasura.RQL.Types.Allowlist.html#iaGlobal"><span class="hs-identifier hs-var">iaGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">(InlinedAllowlist -&gt; [NormalizedQuery])
-&gt; InlinedAllowlist -&gt; [NormalizedQuery]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InlinedAllowlist
</span><a href="#local-6989586621687411966"><span class="hs-identifier hs-var">inlinedAllowlist</span></a></span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span>      </span><span class="hs-comment">-- Endpoints don't generate any dependencies</span><span>
</span><span id="line-483"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621687411971"><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687411971"><span class="hs-identifier hs-var">endpointInconsistencies</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[MetadataDependency]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[StoredIntrospectionItem]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Seq CollectItem
-&gt; ([InconsistentMetadata], [MetadataDependency],
    [StoredIntrospectionItem])
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#partitionCollectedInfo"><span class="hs-identifier hs-var">partitionCollectedInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Seq CollectItem
</span><a href="#local-6989586621687411870"><span class="hs-identifier hs-var">endpointCollectedInfo</span></a></span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span>      </span><span class="hs-comment">-- Cron triggers don't generate any dependencies</span><span>
</span><span id="line-486"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621687411972"><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687411972"><span class="hs-identifier hs-var">cronTriggersInconsistencies</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[MetadataDependency]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[StoredIntrospectionItem]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Seq CollectItem
-&gt; ([InconsistentMetadata], [MetadataDependency],
    [StoredIntrospectionItem])
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#partitionCollectedInfo"><span class="hs-identifier hs-var">partitionCollectedInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Seq CollectItem
</span><a href="#local-6989586621687411876"><span class="hs-identifier hs-var">cronTriggersCollectedInfo</span></a></span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span>      </span><span class="hs-comment">-- OpenTelemerty doesn't generate any dependencies</span><span>
</span><span id="line-489"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621687411973"><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687411973"><span class="hs-identifier hs-var">openTelemetryInconsistencies</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[MetadataDependency]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[StoredIntrospectionItem]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Seq CollectItem
-&gt; ([InconsistentMetadata], [MetadataDependency],
    [StoredIntrospectionItem])
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#partitionCollectedInfo"><span class="hs-identifier hs-var">partitionCollectedInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Seq CollectItem
</span><a href="#local-6989586621687411879"><span class="hs-identifier hs-var">openTelemetryCollectedInfo</span></a></span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span>      </span><span id="local-6989586621687411974"><span class="annot"><span class="annottext">inconsistentQueryCollections :: [InconsistentMetadata]
</span><a href="#local-6989586621687411974"><span class="hs-identifier hs-var hs-var">inconsistentQueryCollections</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaIntrospection
-&gt; QueryCollections
-&gt; ((CollectionName, ListedQuery) -&gt; MetadataObject)
-&gt; EndpointTrie GQLQueryWithText
-&gt; [NormalizedQuery]
-&gt; [InconsistentMetadata]
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#getInconsistentQueryCollections"><span class="hs-identifier hs-var">getInconsistentQueryCollections</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaIntrospection
</span><a href="#local-6989586621687411859"><span class="hs-identifier hs-var">adminIntrospection</span></a></span><span> </span><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621687411824"><span class="hs-identifier hs-var">_metaQueryCollections</span></a></span><span> </span><span class="annot"><span class="annottext">(CollectionName, ListedQuery) -&gt; MetadataObject
</span><a href="#local-6989586621687411921"><span class="hs-identifier hs-var">listedQueryObjects</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointTrie GQLQueryWithText
</span><a href="#local-6989586621687411938"><span class="hs-identifier hs-var">endpoints</span></a></span><span> </span><span class="annot"><span class="annottext">[NormalizedQuery]
</span><a href="#local-6989586621687411968"><span class="hs-identifier hs-var">globalAllowLists</span></a></span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687411976"><span class="annot"><span class="annottext">schemaCache :: SchemaCache
</span><a href="#local-6989586621687411976"><span class="hs-identifier hs-var hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-494"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#SchemaCache"><span class="hs-identifier hs-type">SchemaCache</span></a></span><span>
</span><span id="line-495"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scSources :: SourceCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#scSources"><span class="hs-identifier hs-var">scSources</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuildOutputs -&gt; SourceCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boSources"><span class="hs-identifier hs-var">_boSources</span></a></span><span> </span><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621687411856"><span class="hs-identifier hs-var">resolvedOutputs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-496"></span><span>            </span><span class="annot"><span class="annottext">scActions :: ActionCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#scActions"><span class="hs-identifier hs-var">scActions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuildOutputs -&gt; ActionCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boActions"><span class="hs-identifier hs-var">_boActions</span></a></span><span> </span><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621687411856"><span class="hs-identifier hs-var">resolvedOutputs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-497"></span><span>            </span><span class="hs-comment">-- TODO this is not the right value: we should track what part of the schema</span><span>
</span><span id="line-498"></span><span>            </span><span class="hs-comment">-- we can stitch without consistencies, I think.</span><span>
</span><span id="line-499"></span><span>            </span><span class="annot"><span class="annottext">scRemoteSchemas :: RemoteSchemaMap
</span><a href="Hasura.RQL.Types.SchemaCache.html#scRemoteSchemas"><span class="hs-identifier hs-var">scRemoteSchemas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((RemoteSchemaCtx, MetadataObject) -&gt; RemoteSchemaCtx)
-&gt; HashMap RemoteSchemaName (RemoteSchemaCtx, MetadataObject)
-&gt; RemoteSchemaMap
forall a b.
(a -&gt; b)
-&gt; HashMap RemoteSchemaName a -&gt; HashMap RemoteSchemaName b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(RemoteSchemaCtx, MetadataObject) -&gt; RemoteSchemaCtx
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildOutputs
-&gt; HashMap RemoteSchemaName (RemoteSchemaCtx, MetadataObject)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boRemoteSchemas"><span class="hs-identifier hs-var">_boRemoteSchemas</span></a></span><span> </span><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621687411856"><span class="hs-identifier hs-var">resolvedOutputs</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- remoteSchemaMap</span><span>
</span><span id="line-500"></span><span>            </span><span class="annot"><span class="annottext">scAllowlist :: InlinedAllowlist
</span><a href="Hasura.RQL.Types.SchemaCache.html#scAllowlist"><span class="hs-identifier hs-var">scAllowlist</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InlinedAllowlist
</span><a href="#local-6989586621687411966"><span class="hs-identifier hs-var">inlinedAllowlist</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-501"></span><span>            </span><span class="hs-comment">-- , scCustomTypes = _boCustomTypes resolvedOutputs</span><span>
</span><span id="line-502"></span><span>            </span><span class="annot"><span class="annottext">scAdminIntrospection :: SchemaIntrospection
</span><a href="Hasura.RQL.Types.SchemaCache.html#scAdminIntrospection"><span class="hs-identifier hs-var">scAdminIntrospection</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaIntrospection
</span><a href="#local-6989586621687411859"><span class="hs-identifier hs-var">adminIntrospection</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-503"></span><span>            </span><span class="annot"><span class="annottext">scGQLContext :: HashMap RoleName (RoleContext GQLContext)
</span><a href="Hasura.RQL.Types.SchemaCache.html#scGQLContext"><span class="hs-identifier hs-var">scGQLContext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap RoleName (RoleContext GQLContext)
</span><a href="#local-6989586621687411860"><span class="hs-identifier hs-var">gqlContext</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-504"></span><span>            </span><span class="annot"><span class="annottext">scUnauthenticatedGQLContext :: GQLContext
</span><a href="Hasura.RQL.Types.SchemaCache.html#scUnauthenticatedGQLContext"><span class="hs-identifier hs-var">scUnauthenticatedGQLContext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GQLContext
</span><a href="#local-6989586621687411861"><span class="hs-identifier hs-var">gqlContextUnauth</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-505"></span><span>            </span><span class="annot"><span class="annottext">scRelayContext :: HashMap RoleName (RoleContext GQLContext)
</span><a href="Hasura.RQL.Types.SchemaCache.html#scRelayContext"><span class="hs-identifier hs-var">scRelayContext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap RoleName (RoleContext GQLContext)
</span><a href="#local-6989586621687411863"><span class="hs-identifier hs-var">relayContext</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-506"></span><span>            </span><span class="annot"><span class="annottext">scUnauthenticatedRelayContext :: GQLContext
</span><a href="Hasura.RQL.Types.SchemaCache.html#scUnauthenticatedRelayContext"><span class="hs-identifier hs-var">scUnauthenticatedRelayContext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GQLContext
</span><a href="#local-6989586621687411864"><span class="hs-identifier hs-var">relayContextUnauth</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-507"></span><span>            </span><span class="hs-comment">-- , scGCtxMap = gqlSchema</span><span>
</span><span id="line-508"></span><span>            </span><span class="hs-comment">-- , scDefaultRemoteGCtx = remoteGQLSchema</span><span>
</span><span id="line-509"></span><span>            </span><span class="annot"><span class="annottext">scDepMap :: DepMap
</span><a href="Hasura.RQL.Types.SchemaCache.html#scDepMap"><span class="hs-identifier hs-var">scDepMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DepMap
</span><a href="#local-6989586621687411858"><span class="hs-identifier hs-var">resolvedDependencies</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-510"></span><span>            </span><span class="annot"><span class="annottext">scCronTriggers :: HashMap TriggerName CronTriggerInfo
</span><a href="Hasura.RQL.Types.SchemaCache.html#scCronTriggers"><span class="hs-identifier hs-var">scCronTriggers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap TriggerName CronTriggerInfo
</span><a href="#local-6989586621687411875"><span class="hs-identifier hs-var">cronTriggersMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-511"></span><span>            </span><span class="annot"><span class="annottext">scEndpoints :: EndpointTrie GQLQueryWithText
</span><a href="Hasura.RQL.Types.SchemaCache.html#scEndpoints"><span class="hs-identifier hs-var">scEndpoints</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EndpointTrie GQLQueryWithText
</span><a href="#local-6989586621687411938"><span class="hs-identifier hs-var">endpoints</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-512"></span><span>            </span><span class="annot"><span class="annottext">scInconsistentObjs :: [InconsistentMetadata]
</span><a href="Hasura.RQL.Types.SchemaCache.html#scInconsistentObjs"><span class="hs-identifier hs-var">scInconsistentObjs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-513"></span><span>              </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687411854"><span class="hs-identifier hs-var">inconsistentObjects</span></a></span><span>
</span><span id="line-514"></span><span>                </span><span class="annot"><span class="annottext">[InconsistentMetadata]
-&gt; [InconsistentMetadata] -&gt; [InconsistentMetadata]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687411857"><span class="hs-identifier hs-var">dependencyInconsistentObjects</span></a></span><span>
</span><span id="line-515"></span><span>                </span><span class="annot"><span class="annottext">[InconsistentMetadata]
-&gt; [InconsistentMetadata] -&gt; [InconsistentMetadata]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashSet InconsistentMetadata -&gt; [InconsistentMetadata]
forall a. HashSet a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">HashSet InconsistentMetadata
</span><a href="#local-6989586621687411862"><span class="hs-identifier hs-var">inconsistentRemoteSchemas</span></a></span><span>
</span><span id="line-516"></span><span>                </span><span class="annot"><span class="annottext">[InconsistentMetadata]
-&gt; [InconsistentMetadata] -&gt; [InconsistentMetadata]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687411944"><span class="hs-identifier hs-var">duplicateRestVariables</span></a></span><span>
</span><span id="line-517"></span><span>                </span><span class="annot"><span class="annottext">[InconsistentMetadata]
-&gt; [InconsistentMetadata] -&gt; [InconsistentMetadata]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687411948"><span class="hs-identifier hs-var">invalidRestSegments</span></a></span><span>
</span><span id="line-518"></span><span>                </span><span class="annot"><span class="annottext">[InconsistentMetadata]
-&gt; [InconsistentMetadata] -&gt; [InconsistentMetadata]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687411962"><span class="hs-identifier hs-var">ambiguousRestEndpoints</span></a></span><span>
</span><span id="line-519"></span><span>                </span><span class="annot"><span class="annottext">[InconsistentMetadata]
-&gt; [InconsistentMetadata] -&gt; [InconsistentMetadata]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687411971"><span class="hs-identifier hs-var">endpointInconsistencies</span></a></span><span>
</span><span id="line-520"></span><span>                </span><span class="annot"><span class="annottext">[InconsistentMetadata]
-&gt; [InconsistentMetadata] -&gt; [InconsistentMetadata]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687411972"><span class="hs-identifier hs-var">cronTriggersInconsistencies</span></a></span><span>
</span><span id="line-521"></span><span>                </span><span class="annot"><span class="annottext">[InconsistentMetadata]
-&gt; [InconsistentMetadata] -&gt; [InconsistentMetadata]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687411973"><span class="hs-identifier hs-var">openTelemetryInconsistencies</span></a></span><span>
</span><span id="line-522"></span><span>                </span><span class="annot"><span class="annottext">[InconsistentMetadata]
-&gt; [InconsistentMetadata] -&gt; [InconsistentMetadata]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687411974"><span class="hs-identifier hs-var">inconsistentQueryCollections</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-523"></span><span>            </span><span class="annot"><span class="annottext">scApiLimits :: ApiLimit
</span><a href="Hasura.RQL.Types.SchemaCache.html#scApiLimits"><span class="hs-identifier hs-var">scApiLimits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiLimit
</span><a href="#local-6989586621687411830"><span class="hs-identifier hs-var">_metaApiLimits</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-524"></span><span>            </span><span class="annot"><span class="annottext">scMetricsConfig :: MetricsConfig
</span><a href="Hasura.RQL.Types.SchemaCache.html#scMetricsConfig"><span class="hs-identifier hs-var">scMetricsConfig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetricsConfig
</span><a href="#local-6989586621687411831"><span class="hs-identifier hs-var">_metaMetricsConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-525"></span><span>            </span><span class="hs-comment">-- Please note that we are setting the metadata resource version to the last known metadata resource version</span><span>
</span><span id="line-526"></span><span>            </span><span class="hs-comment">-- for `CatalogSync` or to an invalid metadata resource version (-1) for `CatalogUpdate`.</span><span>
</span><span id="line-527"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-528"></span><span>            </span><span class="hs-comment">-- For, CatalogUpdate, we update the metadata resource version to the latest value after the metadata</span><span>
</span><span id="line-529"></span><span>            </span><span class="hs-comment">-- operation is complete (see the usage of `setMetadataResourceVersionInSchemaCache`).</span><span>
</span><span id="line-530"></span><span>            </span><span class="annot"><span class="annottext">scMetadataResourceVersion :: MetadataResourceVersion
</span><a href="Hasura.RQL.Types.SchemaCache.html#scMetadataResourceVersion"><span class="hs-identifier hs-var">scMetadataResourceVersion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621687411812"><span class="hs-identifier hs-var">interimMetadataResourceVersion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-531"></span><span>            </span><span class="annot"><span class="annottext">scSetGraphqlIntrospectionOptions :: SetGraphqlIntrospectionOptions
</span><a href="Hasura.RQL.Types.SchemaCache.html#scSetGraphqlIntrospectionOptions"><span class="hs-identifier hs-var">scSetGraphqlIntrospectionOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SetGraphqlIntrospectionOptions
</span><a href="#local-6989586621687411833"><span class="hs-identifier hs-var">_metaSetGraphqlIntrospectionOptions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-532"></span><span>            </span><span class="annot"><span class="annottext">scTlsAllowlist :: [TlsAllow]
</span><a href="Hasura.RQL.Types.SchemaCache.html#scTlsAllowlist"><span class="hs-identifier hs-var">scTlsAllowlist</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Network -&gt; [TlsAllow]
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.Types.Extended.html#networkTlsAllowlist"><span class="hs-identifier hs-var">networkTlsAllowlist</span></a></span><span> </span><span class="annot"><span class="annottext">Network
</span><a href="#local-6989586621687411834"><span class="hs-identifier hs-var">_metaNetwork</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-533"></span><span>            </span><span class="annot"><span class="annottext">scQueryCollections :: QueryCollections
</span><a href="Hasura.RQL.Types.SchemaCache.html#scQueryCollections"><span class="hs-identifier hs-var">scQueryCollections</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621687411824"><span class="hs-identifier hs-var">_metaQueryCollections</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-534"></span><span>            </span><span class="annot"><span class="annottext">scBackendCache :: BackendCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#scBackendCache"><span class="hs-identifier hs-var">scBackendCache</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuildOutputs -&gt; BackendCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boBackendCache"><span class="hs-identifier hs-var">_boBackendCache</span></a></span><span> </span><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621687411856"><span class="hs-identifier hs-var">resolvedOutputs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-535"></span><span>            </span><span class="annot"><span class="annottext">scSourceHealthChecks :: SourceHealthCheckCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#scSourceHealthChecks"><span class="hs-identifier hs-var">scSourceHealthChecks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
-&gt; SourceHealthCheckCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildHealthCheckCache"><span class="hs-identifier hs-var">buildHealthCheckCache</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621687411822"><span class="hs-identifier hs-var">_metaSources</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-536"></span><span>            </span><span class="annot"><span class="annottext">scSourcePingConfig :: SourcePingCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#scSourcePingConfig"><span class="hs-identifier hs-var">scSourcePingConfig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata -&gt; SourcePingCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildSourcePingCache"><span class="hs-identifier hs-var">buildSourcePingCache</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621687411822"><span class="hs-identifier hs-var">_metaSources</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-537"></span><span>            </span><span class="annot"><span class="annottext">scOpenTelemetryConfig :: OpenTelemetryInfo
</span><a href="Hasura.RQL.Types.SchemaCache.html#scOpenTelemetryConfig"><span class="hs-identifier hs-var">scOpenTelemetryConfig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpenTelemetryInfo
</span><a href="#local-6989586621687411878"><span class="hs-identifier hs-var">openTelemetryInfo</span></a></span><span>
</span><span id="line-538"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-539"></span><span>
</span><span id="line-540"></span><span>  </span><span class="hs-comment">-- Write the Project Schema information to schema registry service</span><span>
</span><span id="line-541"></span><span>  </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-542"></span><span>    </span><span class="annot"><span class="annottext">arr (m ()) ()
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html#bindA"><span class="hs-identifier hs-var">bindA</span></a></span><span>
</span><span id="line-543"></span><span>      </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-544"></span><span>        </span><span id="local-6989586621687412005"><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621687412005"><span class="hs-identifier hs-var">buildReason</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m BuildReason
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-545"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621687412005"><span class="hs-identifier hs-var">buildReason</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-546"></span><span>          </span><span class="hs-comment">-- If this is a catalog sync then we know for sure that the schema has more chances of being committed as some</span><span>
</span><span id="line-547"></span><span>          </span><span class="hs-comment">-- other instance of Hasura has already committed the schema. So we can safely write the schema to the registry</span><span>
</span><span id="line-548"></span><span>          </span><span class="hs-comment">-- service.</span><span>
</span><span id="line-549"></span><span>          </span><span class="annot"><span class="annottext">BuildReason
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogSync"><span class="hs-identifier hs-var">CatalogSync</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-550"></span><span>            </span><span class="annot"><span class="annottext">SchemaRegistryAction
-&gt; ((MetadataResourceVersion -&gt; [InconsistentMetadata] -&gt; IO ())
    -&gt; m ())
-&gt; m ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">SchemaRegistryAction
</span><a href="#local-6989586621687411865"><span class="hs-identifier hs-var">schemaRegistryAction</span></a></span><span> </span><span class="annot"><span class="annottext">(((MetadataResourceVersion -&gt; [InconsistentMetadata] -&gt; IO ())
  -&gt; m ())
 -&gt; m ())
-&gt; ((MetadataResourceVersion -&gt; [InconsistentMetadata] -&gt; IO ())
    -&gt; m ())
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687412007"><span class="annot"><span class="annottext">MetadataResourceVersion -&gt; [InconsistentMetadata] -&gt; IO ()
</span><a href="#local-6989586621687412007"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-551"></span><span>              </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion -&gt; [InconsistentMetadata] -&gt; IO ()
</span><a href="#local-6989586621687412007"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621687411812"><span class="hs-identifier hs-var">interimMetadataResourceVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaCache -&gt; [InconsistentMetadata]
</span><a href="Hasura.RQL.Types.SchemaCache.html#scInconsistentObjs"><span class="hs-identifier hs-var">scInconsistentObjs</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687411976"><span class="hs-identifier hs-var">schemaCache</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span>          </span><span class="hs-comment">-- If this is a metadata event then we cannot be sure that the schema will be committed. So we write the schema</span><span>
</span><span id="line-553"></span><span>          </span><span class="hs-comment">-- to the registry service only after the schema is committed.</span><span>
</span><span id="line-554"></span><span>          </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogUpdate"><span class="hs-identifier hs-type">CatalogUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (HashSet SourceName)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span>  </span><span class="annot"><span class="annottext">arr
  (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
  (SchemaCache, (SourcesIntrospectionStatus, SchemaRegistryAction))
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687411976"><span class="hs-identifier hs-var">schemaCache</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourcesIntrospectionStatus
</span><a href="#local-6989586621687411868"><span class="hs-identifier hs-var">storedIntrospectionStatus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SchemaRegistryAction
</span><a href="#local-6989586621687411865"><span class="hs-identifier hs-var">schemaRegistryAction</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-558"></span><span>    </span><span class="hs-comment">-- See Note [Avoiding GraphQL schema rebuilds when changing irrelevant Metadata]</span><span>
</span><span id="line-559"></span><span>    </span><span id="local-6989586621687411867"><span class="annot"><span class="annottext">buildOutputsAndSchema :: arr
  (Dependency Metadata, CacheDynamicConfig,
   Dependency InvalidationKeys, Maybe StoredIntrospection)
  ([InconsistentMetadata], [StoredIntrospectionItem],
   (BuildOutputs, [InconsistentMetadata], DepMap),
   ((SchemaIntrospection, HashMap RoleName (RoleContext GQLContext),
     GQLContext, HashSet InconsistentMetadata),
    (HashMap RoleName (RoleContext GQLContext), GQLContext),
    SchemaRegistryAction))
</span><a href="#local-6989586621687411867"><span class="hs-identifier hs-var hs-var">buildOutputsAndSchema</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687412011"><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621687412011"><span class="hs-identifier hs-var">metadataDep</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412012"><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687412012"><span class="hs-identifier hs-var">dynamicConfig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412013"><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621687412013"><span class="hs-identifier hs-var">invalidationKeysDep</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412014"><span class="annot"><span class="annottext">Maybe StoredIntrospection
</span><a href="#local-6989586621687412014"><span class="hs-identifier hs-var">storedIntrospection</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-560"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621687412015"><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621687412015"><span class="hs-identifier hs-var">outputs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412016"><span class="annot"><span class="annottext">Seq CollectItem
</span><a href="#local-6989586621687412016"><span class="hs-identifier hs-var">collectedInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WriterA
  (Seq CollectItem)
  arr
  (CacheDynamicConfig, Dependency Metadata,
   Dependency InvalidationKeys, Maybe StoredIntrospection)
  BuildOutputs
-&gt; arr
     (CacheDynamicConfig, Dependency Metadata,
      Dependency InvalidationKeys, Maybe StoredIntrospection)
     (BuildOutputs, Seq CollectItem)
forall w (arr :: * -&gt; * -&gt; *) a b.
(Monoid w, Arrow arr) =&gt;
WriterA w arr a b -&gt; arr a (b, w)
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#runWriterA"><span class="hs-identifier hs-var">runWriterA</span></a></span><span> </span><span class="annot"><span class="annottext">WriterA
  (Seq CollectItem)
  arr
  (CacheDynamicConfig, Dependency Metadata,
   Dependency InvalidationKeys, Maybe StoredIntrospection)
  BuildOutputs
forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowDistribute arr, ArrowCache m arr,
 ArrowWriter (Seq CollectItem) arr, MonadIO m, MonadError QErr m,
 MonadReader BuildReason m, MonadBaseControl IO m,
 ProvidesNetwork m, MonadResolveSource m, HasCacheStaticConfig m) =&gt;
arr
  (CacheDynamicConfig, Dependency Metadata,
   Dependency InvalidationKeys, Maybe StoredIntrospection)
  BuildOutputs
</span><a href="#local-6989586621687412018"><span class="hs-identifier hs-var">buildAndCollectInfo</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687412012"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621687412011"><span class="hs-identifier hs-var">metadataDep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621687412013"><span class="hs-identifier hs-var">invalidationKeysDep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe StoredIntrospection
</span><a href="#local-6989586621687412014"><span class="hs-identifier hs-var">storedIntrospection</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687412019"><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687412019"><span class="hs-identifier hs-var">inconsistentObjects</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412020"><span class="annot"><span class="annottext">[MetadataDependency]
</span><a href="#local-6989586621687412020"><span class="hs-identifier hs-var">unresolvedDependencies</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412021"><span class="annot"><span class="annottext">[StoredIntrospectionItem]
</span><a href="#local-6989586621687412021"><span class="hs-identifier hs-var">storedIntrospections</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Seq CollectItem
-&gt; ([InconsistentMetadata], [MetadataDependency],
    [StoredIntrospectionItem])
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#partitionCollectedInfo"><span class="hs-identifier hs-var">partitionCollectedInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Seq CollectItem
</span><a href="#local-6989586621687412016"><span class="hs-identifier hs-var">collectedInfo</span></a></span><span>
</span><span id="line-562"></span><span>      </span><span id="local-6989586621687412022"><span class="annot"><span class="annottext">out2 :: (BuildOutputs, [InconsistentMetadata], DepMap)
</span><a href="#local-6989586621687412022"><span class="hs-identifier hs-var">out2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621687412023"><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621687412023"><span class="hs-identifier hs-var">resolvedOutputs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412024"><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687412024"><span class="hs-identifier hs-var">_dependencyInconsistentObjects</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412025"><span class="annot"><span class="annottext">DepMap
</span><a href="#local-6989586621687412025"><span class="hs-identifier hs-var">_resolvedDependencies</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr
  (BuildOutputs, [MetadataDependency])
  (BuildOutputs, [InconsistentMetadata], DepMap)
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *).
(ArrowKleisli m arr, QErrM m) =&gt;
arr
  (BuildOutputs, [MetadataDependency])
  (BuildOutputs, [InconsistentMetadata], DepMap)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Dependencies.html#resolveDependencies"><span class="hs-identifier hs-var">resolveDependencies</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621687412015"><span class="hs-identifier hs-var">outputs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[MetadataDependency]
</span><a href="#local-6989586621687412020"><span class="hs-identifier hs-var">unresolvedDependencies</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>      </span><span id="local-6989586621687412027"><span class="annot"><span class="annottext">((SchemaIntrospection, HashMap RoleName (RoleContext GQLContext),
  GQLContext, HashSet InconsistentMetadata),
 (HashMap RoleName (RoleContext GQLContext), GQLContext),
 SchemaRegistryAction)
</span><a href="#local-6989586621687412027"><span class="hs-identifier hs-var">out3</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-564"></span><span>        </span><span class="annot"><span class="annottext">arr
  (m ((SchemaIntrospection,
       HashMap RoleName (RoleContext GQLContext), GQLContext,
       HashSet InconsistentMetadata),
      (HashMap RoleName (RoleContext GQLContext), GQLContext),
      SchemaRegistryAction))
  ((SchemaIntrospection, HashMap RoleName (RoleContext GQLContext),
    GQLContext, HashSet InconsistentMetadata),
   (HashMap RoleName (RoleContext GQLContext), GQLContext),
   SchemaRegistryAction)
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html#bindA"><span class="hs-identifier hs-var">bindA</span></a></span><span>
</span><span id="line-565"></span><span>          </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-566"></span><span>            </span><span class="annot"><span class="annottext">InferFunctionPermissions
-&gt; RemoteSchemaPermissions
-&gt; HashSet ExperimentalFeature
-&gt; SQLGenCtx
-&gt; ApolloFederationStatus
-&gt; SourceCache
-&gt; HashMap RemoteSchemaName (RemoteSchemaCtx, MetadataObject)
-&gt; ActionCache
-&gt; AnnotatedCustomTypes
-&gt; Maybe SchemaRegistryContext
-&gt; Logger Hasura
-&gt; m ((SchemaIntrospection,
       HashMap RoleName (RoleContext GQLContext), GQLContext,
       HashSet InconsistentMetadata),
      (HashMap RoleName (RoleContext GQLContext), GQLContext),
      SchemaRegistryAction)
forall (m :: * -&gt; *).
(MonadError QErr m, MonadIO m) =&gt;
InferFunctionPermissions
-&gt; RemoteSchemaPermissions
-&gt; HashSet ExperimentalFeature
-&gt; SQLGenCtx
-&gt; ApolloFederationStatus
-&gt; SourceCache
-&gt; HashMap RemoteSchemaName (RemoteSchemaCtx, MetadataObject)
-&gt; ActionCache
-&gt; AnnotatedCustomTypes
-&gt; Maybe SchemaRegistryContext
-&gt; Logger Hasura
-&gt; m ((SchemaIntrospection,
       HashMap RoleName (RoleContext GQLContext), GQLContext,
       HashSet InconsistentMetadata),
      (HashMap RoleName (RoleContext GQLContext), GQLContext),
      SchemaRegistryAction)
</span><a href="Hasura.GraphQL.Schema.html#buildGQLContext"><span class="hs-identifier hs-var">buildGQLContext</span></a></span><span>
</span><span id="line-567"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CacheDynamicConfig -&gt; InferFunctionPermissions
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cdcFunctionPermsCtx"><span class="hs-identifier hs-var">_cdcFunctionPermsCtx</span></a></span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687412012"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-568"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CacheDynamicConfig -&gt; RemoteSchemaPermissions
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cdcRemoteSchemaPermsCtx"><span class="hs-identifier hs-var">_cdcRemoteSchemaPermsCtx</span></a></span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687412012"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CacheDynamicConfig -&gt; HashSet ExperimentalFeature
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cdcExperimentalFeatures"><span class="hs-identifier hs-var">_cdcExperimentalFeatures</span></a></span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687412012"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CacheDynamicConfig -&gt; SQLGenCtx
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cdcSQLGenCtx"><span class="hs-identifier hs-var">_cdcSQLGenCtx</span></a></span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687412012"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CacheDynamicConfig -&gt; ApolloFederationStatus
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cdcApolloFederationStatus"><span class="hs-identifier hs-var">_cdcApolloFederationStatus</span></a></span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687412012"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildOutputs -&gt; SourceCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boSources"><span class="hs-identifier hs-var">_boSources</span></a></span><span> </span><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621687412023"><span class="hs-identifier hs-var">resolvedOutputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-573"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildOutputs
-&gt; HashMap RemoteSchemaName (RemoteSchemaCtx, MetadataObject)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boRemoteSchemas"><span class="hs-identifier hs-var">_boRemoteSchemas</span></a></span><span> </span><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621687412023"><span class="hs-identifier hs-var">resolvedOutputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildOutputs -&gt; ActionCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boActions"><span class="hs-identifier hs-var">_boActions</span></a></span><span> </span><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621687412023"><span class="hs-identifier hs-var">resolvedOutputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildOutputs -&gt; AnnotatedCustomTypes
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boCustomTypes"><span class="hs-identifier hs-var">_boCustomTypes</span></a></span><span> </span><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621687412023"><span class="hs-identifier hs-var">resolvedOutputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span>              </span><span class="annot"><span class="annottext">Maybe SchemaRegistryContext
</span><a href="#local-6989586621687411810"><span class="hs-identifier hs-var">mSchemaRegistryContext</span></a></span><span>
</span><span id="line-577"></span><span>              </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687411808"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-578"></span><span>      </span><span class="annot"><span class="annottext">arr
  ([InconsistentMetadata], [StoredIntrospectionItem],
   (BuildOutputs, [InconsistentMetadata], DepMap),
   ((SchemaIntrospection, HashMap RoleName (RoleContext GQLContext),
     GQLContext, HashSet InconsistentMetadata),
    (HashMap RoleName (RoleContext GQLContext), GQLContext),
    SchemaRegistryAction))
  ([InconsistentMetadata], [StoredIntrospectionItem],
   (BuildOutputs, [InconsistentMetadata], DepMap),
   ((SchemaIntrospection, HashMap RoleName (RoleContext GQLContext),
     GQLContext, HashSet InconsistentMetadata),
    (HashMap RoleName (RoleContext GQLContext), GQLContext),
    SchemaRegistryAction))
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687412019"><span class="hs-identifier hs-var">inconsistentObjects</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[StoredIntrospectionItem]
</span><a href="#local-6989586621687412021"><span class="hs-identifier hs-var">storedIntrospections</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(BuildOutputs, [InconsistentMetadata], DepMap)
</span><a href="#local-6989586621687412022"><span class="hs-identifier hs-var">out2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">((SchemaIntrospection, HashMap RoleName (RoleContext GQLContext),
  GQLContext, HashSet InconsistentMetadata),
 (HashMap RoleName (RoleContext GQLContext), GQLContext),
 SchemaRegistryAction)
</span><a href="#local-6989586621687412027"><span class="hs-identifier hs-var">out3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span>
</span><span id="line-580"></span><span>    </span><span class="annot"><a href="#local-6989586621687412034"><span class="hs-identifier hs-type">resolveBackendInfo'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-581"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687410077"><span class="annot"><a href="#local-6989586621687410077"><span class="hs-identifier hs-type">arr</span></a></span></span><span> </span><span id="local-6989586621687410078"><span class="annot"><a href="#local-6989586621687410078"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621687410075"><span class="annot"><a href="#local-6989586621687410075"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-582"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410075"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-583"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ArrowChoice</span></span><span> </span><span class="annot"><a href="#local-6989586621687410077"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-584"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#ArrowCache"><span class="hs-identifier hs-type">Inc.ArrowCache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410078"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410077"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-585"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Rule.html#ArrowDistribute"><span class="hs-identifier hs-type">Inc.ArrowDistribute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410077"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-586"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#ArrowWriter"><span class="hs-identifier hs-type">ArrowWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687410077"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-587"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687410078"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-588"></span><span>        </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-92f8a47f193bc8ca499a8b94581fad6cb68b7a26370b271798ac2ec617c05064/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687410078"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-589"></span><span>        </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410078"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-590"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-591"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#BackendConfigWrapper"><span class="hs-identifier hs-type">BackendConfigWrapper</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410075"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Dependency.html#Dependency"><span class="hs-identifier hs-type">Inc.Dependency</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.SQL.BackendMap.html#BackendMap"><span class="hs-identifier hs-type">BackendMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#BackendInvalidationKeysWrapper"><span class="hs-identifier hs-type">BackendInvalidationKeysWrapper</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687410077"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#BackendCache"><span class="hs-identifier hs-type">BackendCache</span></a></span><span>
</span><span id="line-592"></span><span>    </span><span id="local-6989586621687412034"><span class="annot"><span class="annottext">resolveBackendInfo' :: forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *) (b :: BackendType).
(BackendMetadata b, ArrowChoice arr, ArrowCache m arr,
 ArrowDistribute arr, ArrowWriter (Seq CollectItem) arr, MonadIO m,
 MonadBaseControl IO m, ProvidesNetwork m) =&gt;
arr
  (BackendConfigWrapper b,
   Dependency (BackendMap BackendInvalidationKeysWrapper))
  BackendCache
</span><a href="#local-6989586621687412034"><span class="hs-identifier hs-var hs-var">resolveBackendInfo'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687412068"><span class="annot"><span class="annottext">BackendConfigWrapper b
</span><a href="#local-6989586621687412068"><span class="hs-identifier hs-var">backendConfigWrapper</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412069"><span class="annot"><span class="annottext">Dependency (BackendMap BackendInvalidationKeysWrapper)
</span><a href="#local-6989586621687412069"><span class="hs-identifier hs-var">backendInvalidationMap</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-593"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687412070"><span class="annot"><span class="annottext">backendInvalidationKeys :: Dependency (Maybe (BackendInvalidationKeys b))
</span><a href="#local-6989586621687412070"><span class="hs-identifier hs-var hs-var">backendInvalidationKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-594"></span><span>            </span><span class="annot"><span class="annottext">Selector
  (BackendInvalidationKeysWrapper b) (BackendInvalidationKeys b)
-&gt; Dependency (Maybe (BackendInvalidationKeysWrapper b))
-&gt; Dependency (Maybe (BackendInvalidationKeys b))
forall a b.
Select a =&gt;
Selector a b -&gt; Dependency (Maybe a) -&gt; Dependency (Maybe b)
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Dependency.html#selectMaybeD"><span class="hs-identifier hs-var">Inc.selectMaybeD</span></a></span><span> </span><span class="annot"><span class="annottext">FieldS
  (BackendInvalidationKeysWrapper b) (BackendInvalidationKeys b)
Selector
  (BackendInvalidationKeysWrapper b) (BackendInvalidationKeys b)
</span><span class="">#unBackendInvalidationKeysWrapper</span></span><span>
</span><span id="line-595"></span><span>              </span><span class="annot"><span class="annottext">(Dependency (Maybe (BackendInvalidationKeysWrapper b))
 -&gt; Dependency (Maybe (BackendInvalidationKeys b)))
-&gt; Dependency (Maybe (BackendInvalidationKeysWrapper b))
-&gt; Dependency (Maybe (BackendInvalidationKeys b))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
Dependency (BackendMap i) -&gt; Dependency (Maybe (i b))
</span><a href="Hasura.SQL.BackendMap.html#lookupD"><span class="hs-identifier hs-var">BackendMap.lookupD</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410075"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">Dependency (BackendMap BackendInvalidationKeysWrapper)
</span><a href="#local-6989586621687412069"><span class="hs-identifier hs-var">backendInvalidationMap</span></a></span><span>
</span><span id="line-596"></span><span>      </span><span id="local-6989586621687412073"><span class="annot"><span class="annottext">BackendInfo b
</span><a href="#local-6989586621687412073"><span class="hs-identifier hs-var">backendInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(BackendMetadata b, ArrowChoice arr, ArrowCache m arr,
 ArrowDistribute arr, ArrowWriter (Seq CollectItem) arr, MonadIO m,
 MonadBaseControl IO m, ProvidesNetwork m) =&gt;
Logger Hasura
-&gt; arr
     (Dependency (Maybe (BackendInvalidationKeys b)), BackendConfig b)
     (BackendInfo b)
</span><a href="Hasura.RQL.Types.Metadata.Backend.html#resolveBackendInfo"><span class="hs-identifier hs-var">resolveBackendInfo</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410075"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687411808"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependency (Maybe (BackendInvalidationKeys b))
</span><a href="#local-6989586621687412070"><span class="hs-identifier hs-var">backendInvalidationKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BackendConfigWrapper b -&gt; BackendConfig b
forall (b :: BackendType).
BackendConfigWrapper b -&gt; BackendConfig b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#unBackendConfigWrapper"><span class="hs-identifier hs-var">unBackendConfigWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">BackendConfigWrapper b
</span><a href="#local-6989586621687412068"><span class="hs-identifier hs-var">backendConfigWrapper</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span>      </span><span class="annot"><span class="annottext">arr BackendCache BackendCache
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">BackendInfoWrapper b -&gt; BackendCache
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; BackendMap i
</span><a href="Hasura.SQL.BackendMap.html#singleton"><span class="hs-identifier hs-var">BackendMap.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType). BackendInfo b -&gt; BackendInfoWrapper b
</span><a href="Hasura.RQL.Types.SchemaCache.html#BackendInfoWrapper"><span class="hs-identifier hs-var">BackendInfoWrapper</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410075"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">BackendInfo b
</span><a href="#local-6989586621687412073"><span class="hs-identifier hs-var">backendInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>
</span><span id="line-599"></span><span>    </span><span class="annot"><a href="#local-6989586621687412078"><span class="hs-identifier hs-type">resolveBackendCache</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-600"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687410107"><span class="annot"><a href="#local-6989586621687410107"><span class="hs-identifier hs-type">arr</span></a></span></span><span> </span><span id="local-6989586621687410108"><span class="annot"><a href="#local-6989586621687410108"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-601"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ArrowChoice</span></span><span> </span><span class="annot"><a href="#local-6989586621687410107"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-602"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#ArrowCache"><span class="hs-identifier hs-type">Inc.ArrowCache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410108"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410107"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-603"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Rule.html#ArrowDistribute"><span class="hs-identifier hs-type">Inc.ArrowDistribute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410107"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-604"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#ArrowWriter"><span class="hs-identifier hs-type">ArrowWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687410107"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-605"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687410108"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-606"></span><span>        </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-92f8a47f193bc8ca499a8b94581fad6cb68b7a26370b271798ac2ec617c05064/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687410108"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-607"></span><span>        </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410108"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-608"></span><span>        </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#HasCacheStaticConfig"><span class="hs-identifier hs-type">HasCacheStaticConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410108"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-609"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-610"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Dependency.html#Dependency"><span class="hs-identifier hs-type">Inc.Dependency</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.SQL.BackendMap.html#BackendMap"><span class="hs-identifier hs-type">BackendMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#BackendInvalidationKeysWrapper"><span class="hs-identifier hs-type">BackendInvalidationKeysWrapper</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.SQL.AnyBackend.html#AnyBackend"><span class="hs-identifier hs-type">AB.AnyBackend</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#BackendConfigWrapper"><span class="hs-identifier hs-type">BackendConfigWrapper</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687410107"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#BackendCache"><span class="hs-identifier hs-type">BackendCache</span></a></span><span>
</span><span id="line-611"></span><span>    </span><span id="local-6989586621687412078"><span class="annot"><span class="annottext">resolveBackendCache :: forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowCache m arr, ArrowDistribute arr,
 ArrowWriter (Seq CollectItem) arr, MonadIO m,
 MonadBaseControl IO m, ProvidesNetwork m,
 HasCacheStaticConfig m) =&gt;
arr
  (Dependency (BackendMap BackendInvalidationKeysWrapper),
   [AnyBackend BackendConfigWrapper])
  BackendCache
</span><a href="#local-6989586621687412078"><span class="hs-identifier hs-var hs-var">resolveBackendCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687412149"><span class="annot"><span class="annottext">Dependency (BackendMap BackendInvalidationKeysWrapper)
</span><a href="#local-6989586621687412149"><span class="hs-identifier hs-var">backendInvalidationMap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412150"><span class="annot"><span class="annottext">[AnyBackend BackendConfigWrapper]
</span><a href="#local-6989586621687412150"><span class="hs-identifier hs-var">backendConfigs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-612"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[AnyBackend BackendConfigWrapper]
</span><a href="#local-6989586621687412150"><span class="hs-identifier hs-var">backendConfigs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-613"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">arr BackendCache BackendCache
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">BackendCache
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-614"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621687412151"><span class="annot"><span class="annottext">AnyBackend BackendConfigWrapper
</span><a href="#local-6989586621687412151"><span class="hs-identifier hs-var">anyBackendConfig</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621687412152"><span class="annot"><span class="annottext">[AnyBackend BackendConfigWrapper]
</span><a href="#local-6989586621687412152"><span class="hs-identifier hs-var">backendConfigs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-615"></span><span>          </span><span id="local-6989586621687412153"><span class="annot"><span class="annottext">BackendCache
</span><a href="#local-6989586621687412153"><span class="hs-identifier hs-var">backendInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-616"></span><span>            </span><span class="annot"><span class="annottext">forall (c1 :: BackendType -&gt; Constraint)
       (c2 :: BackendType -&gt; Constraint) (i :: BackendType -&gt; *) r
       (arr :: * -&gt; * -&gt; *) x.
(ArrowChoice arr, AllBackendsSatisfy c1, AllBackendsSatisfy c2) =&gt;
(forall (b :: BackendType). (c1 b, c2 b) =&gt; arr (i b, x) r)
-&gt; arr (AnyBackend i, x) r
</span><a href="Hasura.SQL.AnyBackend.html#dispatchAnyBackendArrow"><span class="hs-identifier hs-var">AB.dispatchAnyBackendArrow</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.BackendTag.html#HasTag"><span class="hs-identifier hs-type">HasTag</span></a></span><span> </span><span class="annot"><span class="annottext">arr
  (BackendConfigWrapper b,
   Dependency (BackendMap BackendInvalidationKeysWrapper))
  BackendCache
forall (b :: BackendType).
(BackendMetadata b, HasTag b) =&gt;
arr
  (BackendConfigWrapper b,
   Dependency (BackendMap BackendInvalidationKeysWrapper))
  BackendCache
forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *) (b :: BackendType).
(BackendMetadata b, ArrowChoice arr, ArrowCache m arr,
 ArrowDistribute arr, ArrowWriter (Seq CollectItem) arr, MonadIO m,
 MonadBaseControl IO m, ProvidesNetwork m) =&gt;
arr
  (BackendConfigWrapper b,
   Dependency (BackendMap BackendInvalidationKeysWrapper))
  BackendCache
</span><a href="#local-6989586621687412034"><span class="hs-identifier hs-var">resolveBackendInfo'</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnyBackend BackendConfigWrapper
</span><a href="#local-6989586621687412151"><span class="hs-identifier hs-var">anyBackendConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dependency (BackendMap BackendInvalidationKeysWrapper)
</span><a href="#local-6989586621687412149"><span class="hs-identifier hs-var">backendInvalidationMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span>          </span><span id="local-6989586621687412165"><span class="annot"><span class="annottext">BackendCache
</span><a href="#local-6989586621687412165"><span class="hs-identifier hs-var">backendInfos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr
  (Dependency (BackendMap BackendInvalidationKeysWrapper),
   [AnyBackend BackendConfigWrapper])
  BackendCache
forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowCache m arr, ArrowDistribute arr,
 ArrowWriter (Seq CollectItem) arr, MonadIO m,
 MonadBaseControl IO m, ProvidesNetwork m,
 HasCacheStaticConfig m) =&gt;
arr
  (Dependency (BackendMap BackendInvalidationKeysWrapper),
   [AnyBackend BackendConfigWrapper])
  BackendCache
</span><a href="#local-6989586621687412078"><span class="hs-identifier hs-var">resolveBackendCache</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependency (BackendMap BackendInvalidationKeysWrapper)
</span><a href="#local-6989586621687412149"><span class="hs-identifier hs-var">backendInvalidationMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AnyBackend BackendConfigWrapper]
</span><a href="#local-6989586621687412152"><span class="hs-identifier hs-var">backendConfigs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>          </span><span class="annot"><span class="annottext">arr BackendCache BackendCache
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">BackendCache
</span><a href="#local-6989586621687412153"><span class="hs-identifier hs-var">backendInfo</span></a></span><span> </span><span class="annot"><span class="annottext">BackendCache -&gt; BackendCache -&gt; BackendCache
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">BackendCache
</span><a href="#local-6989586621687412165"><span class="hs-identifier hs-var">backendInfos</span></a></span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span>    </span><span class="annot"><a href="#local-6989586621687412166"><span class="hs-identifier hs-type">tryGetSourceConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-621"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687410128"><span class="annot"><a href="#local-6989586621687410128"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621687410126"><span class="annot"><a href="#local-6989586621687410126"><span class="hs-identifier hs-type">arr</span></a></span></span><span> </span><span id="local-6989586621687410127"><span class="annot"><a href="#local-6989586621687410127"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-622"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ArrowChoice</span></span><span> </span><span class="annot"><a href="#local-6989586621687410126"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-623"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#ArrowCache"><span class="hs-identifier hs-type">Inc.ArrowCache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410127"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410126"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-624"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#ArrowWriter"><span class="hs-identifier hs-type">ArrowWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687410126"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-625"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687410127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-626"></span><span>        </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-92f8a47f193bc8ca499a8b94581fad6cb68b7a26370b271798ac2ec617c05064/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687410127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-627"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-628"></span><span>        </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-629"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410128"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-630"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-631"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Dependency.html#Dependency"><span class="hs-identifier hs-type">Inc.Dependency</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.html#InvalidationKey"><span class="hs-identifier hs-type">Inc.InvalidationKey</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-632"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-633"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.SourceConfiguration.html#SourceConnConfiguration"><span class="hs-identifier hs-type">SourceConnConfiguration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410128"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-634"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#BackendSourceKind"><span class="hs-identifier hs-type">BackendSourceKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410128"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-635"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#BackendInfo"><span class="hs-identifier hs-type">BackendInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410128"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-636"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-637"></span><span>        </span><span class="annot"><a href="#local-6989586621687410126"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SourceConfiguration.html#SourceConfig"><span class="hs-identifier hs-type">SourceConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410128"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-638"></span><span>    </span><span id="local-6989586621687412166"><span class="annot"><span class="annottext">tryGetSourceConfig :: forall (b :: BackendType) (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowCache m arr,
 ArrowWriter (Seq CollectItem) arr, MonadIO m,
 MonadBaseControl IO m, MonadResolveSource m, ProvidesNetwork m,
 BackendMetadata b) =&gt;
arr
  (Dependency (HashMap SourceName InvalidationKey), SourceName,
   SourceConnConfiguration b, BackendSourceKind b, BackendInfo b)
  (Maybe (SourceConfig b))
</span><a href="#local-6989586621687412166"><span class="hs-identifier hs-var hs-var">tryGetSourceConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">arr
  (Dependency (HashMap SourceName InvalidationKey), SourceName,
   SourceConnConfiguration b, BackendSourceKind b, BackendInfo b)
  (Maybe (SourceConfig b))
-&gt; arr
     (Dependency (HashMap SourceName InvalidationKey), SourceName,
      SourceConnConfiguration b, BackendSourceKind b, BackendInfo b)
     (Maybe (SourceConfig b))
forall a b. (Given Accesses =&gt; Eq a) =&gt; arr a b -&gt; arr a b
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a b.
(ArrowCache m arr, Given Accesses =&gt; Eq a) =&gt;
arr a b -&gt; arr a b
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#cache"><span class="hs-identifier hs-var">Inc.cache</span></a></span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687412220"><span class="annot"><span class="annottext">Dependency (HashMap SourceName InvalidationKey)
</span><a href="#local-6989586621687412220"><span class="hs-identifier hs-var">invalidationKeys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412221"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412221"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412222"><span class="annot"><span class="annottext">SourceConnConfiguration b
</span><a href="#local-6989586621687412222"><span class="hs-identifier hs-var">sourceConfig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412223"><span class="annot"><span class="annottext">BackendSourceKind b
</span><a href="#local-6989586621687412223"><span class="hs-identifier hs-var">backendKind</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412224"><span class="annot"><span class="annottext">BackendInfo b
</span><a href="#local-6989586621687412224"><span class="hs-identifier hs-var">backendInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-639"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687412225"><span class="annot"><span class="annottext">metadataObj :: MetadataObject
</span><a href="#local-6989586621687412225"><span class="hs-identifier hs-var hs-var">metadataObj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceName -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOSource"><span class="hs-identifier hs-var">MOSource</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412221"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Value -&gt; MetadataObject) -&gt; Value -&gt; MetadataObject
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412221"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-640"></span><span>      </span><span class="hs-comment">-- TODO: if we make all of 'resolveSourceConfig' a Service, we could</span><span>
</span><span id="line-641"></span><span>      </span><span class="hs-comment">-- delegate to it the responsibility of extracting the HTTP manager, and</span><span>
</span><span id="line-642"></span><span>      </span><span class="hs-comment">-- avoid having to thread 'ProvidesNetwork' throughout the cache building</span><span>
</span><span id="line-643"></span><span>      </span><span class="hs-comment">-- code.</span><span>
</span><span id="line-644"></span><span>      </span><span id="local-6989586621687412227"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621687412227"><span class="hs-identifier hs-var">httpMgr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr (m Manager) Manager
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html#bindA"><span class="hs-identifier hs-var">bindA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">m Manager
forall (m :: * -&gt; *). ProvidesNetwork m =&gt; m Manager
</span><a href="Hasura.Services.Network.html#askHTTPManager"><span class="hs-identifier hs-var">askHTTPManager</span></a></span><span>
</span><span id="line-645"></span><span>      </span><span class="annot"><span class="annottext">arr (Dependency (Maybe InvalidationKey)) (Maybe InvalidationKey)
forall a. Eq a =&gt; arr (Dependency a) a
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
(ArrowCache m arr, Eq a) =&gt;
arr (Dependency a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#dependOn"><span class="hs-identifier hs-var">Inc.dependOn</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">SourceName
-&gt; Dependency (HashMap SourceName InvalidationKey)
-&gt; Dependency (Maybe InvalidationKey)
forall a k v.
(Select a, Selector a ~ ConstS k v) =&gt;
k -&gt; Dependency a -&gt; Dependency v
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Dependency.html#selectKeyD"><span class="hs-identifier hs-var">Inc.selectKeyD</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412221"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">Dependency (HashMap SourceName InvalidationKey)
</span><a href="#local-6989586621687412220"><span class="hs-identifier hs-var">invalidationKeys</span></a></span><span>
</span><span id="line-646"></span><span>      </span><span class="hs-glyph">(|</span><span>
</span><span id="line-647"></span><span>        </span><span class="annot"><span class="annottext">ErrorA QErr arr (a, ()) (SourceConfig b)
-&gt; arr (a, (MetadataObject, ())) (Maybe (SourceConfig b))
forall {a}.
ErrorA QErr arr (a, ()) (SourceConfig b)
-&gt; arr (a, (MetadataObject, ())) (Maybe (SourceConfig b))
forall (arr :: * -&gt; * -&gt; *) e s a.
(ArrowChoice arr, ArrowWriter (Seq CollectItem) arr) =&gt;
ErrorA QErr arr (e, s) a -&gt; arr (e, (MetadataObject, s)) (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistency"><span class="hs-identifier hs-var">withRecordInconsistency</span></a></span><span>
</span><span id="line-648"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ErrorA QErr arr (ExceptT QErr m (SourceConfig b)) (SourceConfig b)
forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *) e a.
(ArrowChoice arr, ArrowKleisli m arr, ArrowError e arr) =&gt;
arr (ExceptT e m a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html#bindErrorA"><span class="hs-identifier hs-var">bindErrorA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">m (Either QErr (SourceConfig b)) -&gt; ExceptT QErr m (SourceConfig b)
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><span class="hs-identifier hs-var">ExceptT</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr (SourceConfig b))
 -&gt; ExceptT QErr m (SourceConfig b))
-&gt; m (Either QErr (SourceConfig b))
-&gt; ExceptT QErr m (SourceConfig b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(BackendMetadata b, MonadIO m, MonadBaseControl IO m,
 MonadResolveSource m) =&gt;
SourceName
-&gt; SourceConnConfiguration b
-&gt; BackendSourceKind b
-&gt; BackendInfo b
-&gt; Environment
-&gt; Manager
-&gt; m (Either QErr (SourceConfig b))
</span><a href="Hasura.RQL.Types.Metadata.Backend.html#resolveSourceConfig"><span class="hs-identifier hs-var">resolveSourceConfig</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410128"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412221"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConnConfiguration b
</span><a href="#local-6989586621687412222"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span> </span><span class="annot"><span class="annottext">BackendSourceKind b
</span><a href="#local-6989586621687412223"><span class="hs-identifier hs-var">backendKind</span></a></span><span> </span><span class="annot"><span class="annottext">BackendInfo b
</span><a href="#local-6989586621687412224"><span class="hs-identifier hs-var">backendInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621687411809"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621687412227"><span class="hs-identifier hs-var">httpMgr</span></a></span><span>
</span><span id="line-649"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-650"></span><span>        </span><span class="hs-glyph">|)</span><span>
</span><span id="line-651"></span><span>        </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687412225"><span class="hs-identifier hs-var">metadataObj</span></a></span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span>    </span><span class="annot"><a href="#local-6989586621687412237"><span class="hs-identifier hs-type">tryResolveSource</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-654"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687410174"><span class="annot"><a href="#local-6989586621687410174"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621687410172"><span class="annot"><a href="#local-6989586621687410172"><span class="hs-identifier hs-type">arr</span></a></span></span><span> </span><span id="local-6989586621687410173"><span class="annot"><a href="#local-6989586621687410173"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-655"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ArrowChoice</span></span><span> </span><span class="annot"><a href="#local-6989586621687410172"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-656"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#ArrowCache"><span class="hs-identifier hs-type">Inc.ArrowCache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410173"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410172"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-657"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#ArrowWriter"><span class="hs-identifier hs-type">ArrowWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687410172"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-658"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687410173"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-659"></span><span>        </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-92f8a47f193bc8ca499a8b94581fad6cb68b7a26370b271798ac2ec617c05064/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687410173"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-660"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410173"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-661"></span><span>        </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410173"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-662"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410174"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-663"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-664"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Dependency.html#Dependency"><span class="hs-identifier hs-type">Inc.Dependency</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.html#InvalidationKey"><span class="hs-identifier hs-type">Inc.InvalidationKey</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-665"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LBS.ByteString</span></span><span class="hs-special">,</span><span>
</span><span id="line-666"></span><span>        </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#BackendInfoAndSourceMetadata"><span class="hs-identifier hs-type">BackendInfoAndSourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410174"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-667"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-668"></span><span>        </span><span class="annot"><a href="#local-6989586621687410172"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SourceConfiguration.html#SourceConfig"><span class="hs-identifier hs-type">SourceConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410174"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#DBObjectsIntrospection"><span class="hs-identifier hs-type">DBObjectsIntrospection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410174"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>    </span><span id="local-6989586621687412237"><span class="annot"><span class="annottext">tryResolveSource :: forall (b :: BackendType) (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowCache m arr,
 ArrowWriter (Seq CollectItem) arr, MonadIO m,
 MonadBaseControl IO m, MonadResolveSource m, ProvidesNetwork m,
 BackendMetadata b) =&gt;
arr
  (Dependency (HashMap SourceName InvalidationKey), Maybe ByteString,
   BackendInfoAndSourceMetadata b)
  (Maybe (SourceConfig b, DBObjectsIntrospection b))
</span><a href="#local-6989586621687412237"><span class="hs-identifier hs-var hs-var">tryResolveSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">arr
  (Dependency (HashMap SourceName InvalidationKey), Maybe ByteString,
   BackendInfoAndSourceMetadata b)
  (Maybe (SourceConfig b, DBObjectsIntrospection b))
-&gt; arr
     (Dependency (HashMap SourceName InvalidationKey), Maybe ByteString,
      BackendInfoAndSourceMetadata b)
     (Maybe (SourceConfig b, DBObjectsIntrospection b))
forall a b. (Given Accesses =&gt; Eq a) =&gt; arr a b -&gt; arr a b
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a b.
(ArrowCache m arr, Given Accesses =&gt; Eq a) =&gt;
arr a b -&gt; arr a b
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#cache"><span class="hs-identifier hs-var">Inc.cache</span></a></span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687412306"><span class="annot"><span class="annottext">Dependency (HashMap SourceName InvalidationKey)
</span><a href="#local-6989586621687412306"><span class="hs-identifier hs-var">invalidationKeys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412307"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621687412307"><span class="hs-identifier hs-var">sourceIntrospection</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#BackendInfoAndSourceMetadata"><span class="hs-identifier hs-type">BackendInfoAndSourceMetadata</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687412309"><span id="local-6989586621687412310"><span class="annot"><span class="annottext">BackendInfo b
SourceMetadata b
_bcasmBackendInfo :: BackendInfo b
_bcasmSourceMetadata :: SourceMetadata b
_bcasmBackendInfo :: forall (b :: BackendType).
BackendInfoAndSourceMetadata b -&gt; BackendInfo b
_bcasmSourceMetadata :: forall (b :: BackendType).
BackendInfoAndSourceMetadata b -&gt; SourceMetadata b
</span><a href="#local-6989586621687412309"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-670"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687412313"><span class="annot"><span class="annottext">sourceName :: SourceName
</span><a href="#local-6989586621687412313"><span class="hs-identifier hs-var hs-var">sourceName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceMetadata b -&gt; SourceName
forall (b :: BackendType). SourceMetadata b -&gt; SourceName
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smName"><span class="hs-identifier hs-var">_smName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687412310"><span class="hs-identifier hs-var">_bcasmSourceMetadata</span></a></span><span>
</span><span id="line-671"></span><span>          </span><span id="local-6989586621687412314"><span class="annot"><span class="annottext">metadataObj :: MetadataObject
</span><a href="#local-6989586621687412314"><span class="hs-identifier hs-var hs-var">metadataObj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceName -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOSource"><span class="hs-identifier hs-var">MOSource</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412313"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Value -&gt; MetadataObject) -&gt; Value -&gt; MetadataObject
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412313"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-672"></span><span>
</span><span id="line-673"></span><span>      </span><span id="local-6989586621687412315"><span class="annot"><span class="annottext">Maybe (SourceConfig b)
</span><a href="#local-6989586621687412315"><span class="hs-identifier hs-var">maybeSourceConfig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowCache m arr,
 ArrowWriter (Seq CollectItem) arr, MonadIO m,
 MonadBaseControl IO m, MonadResolveSource m, ProvidesNetwork m,
 BackendMetadata b) =&gt;
arr
  (Dependency (HashMap SourceName InvalidationKey), SourceName,
   SourceConnConfiguration b, BackendSourceKind b, BackendInfo b)
  (Maybe (SourceConfig b))
</span><a href="#local-6989586621687412166"><span class="hs-identifier hs-var">tryGetSourceConfig</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410174"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependency (HashMap SourceName InvalidationKey)
</span><a href="#local-6989586621687412306"><span class="hs-identifier hs-var">invalidationKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412313"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourceMetadata b -&gt; SourceConnConfiguration b
forall (b :: BackendType).
SourceMetadata b -&gt; SourceConnConfiguration b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smConfiguration"><span class="hs-identifier hs-var">_smConfiguration</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687412310"><span class="hs-identifier hs-var">_bcasmSourceMetadata</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourceMetadata b -&gt; BackendSourceKind b
forall (b :: BackendType). SourceMetadata b -&gt; BackendSourceKind b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smKind"><span class="hs-identifier hs-var">_smKind</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687412310"><span class="hs-identifier hs-var">_bcasmSourceMetadata</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BackendInfo b
</span><a href="#local-6989586621687412309"><span class="hs-identifier hs-var">_bcasmBackendInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (SourceConfig b)
</span><a href="#local-6989586621687412315"><span class="hs-identifier hs-var">maybeSourceConfig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-675"></span><span>        </span><span class="annot"><span class="annottext">Maybe (SourceConfig b)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">arr
  (Maybe (SourceConfig b, DBObjectsIntrospection b))
  (Maybe (SourceConfig b, DBObjectsIntrospection b))
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Maybe (SourceConfig b, DBObjectsIntrospection b)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-676"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621687412317"><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687412317"><span class="hs-identifier hs-var">sourceConfig</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-677"></span><span>          </span><span id="local-6989586621687412318"><span class="annot"><span class="annottext">Either QErr (DBObjectsIntrospection b)
</span><a href="#local-6989586621687412318"><span class="hs-identifier hs-var">databaseResponse</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr
  (m (Either QErr (DBObjectsIntrospection b)))
  (Either QErr (DBObjectsIntrospection b))
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html#bindA"><span class="hs-identifier hs-var">bindA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; SourceMetadata b
-&gt; SourceConfig b
-&gt; m (Either QErr (DBObjectsIntrospection b))
forall (b :: BackendType) (m :: * -&gt; *).
(BackendMetadata b, MonadIO m, MonadBaseControl IO m,
 MonadResolveSource m) =&gt;
Logger Hasura
-&gt; SourceMetadata b
-&gt; SourceConfig b
-&gt; m (Either QErr (DBObjectsIntrospection b))
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadResolveSource m) =&gt;
Logger Hasura
-&gt; SourceMetadata b
-&gt; SourceConfig b
-&gt; m (Either QErr (DBObjectsIntrospection b))
</span><a href="Hasura.RQL.Types.Metadata.Backend.html#resolveDatabaseMetadata"><span class="hs-identifier hs-var">resolveDatabaseMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687411808"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687412310"><span class="hs-identifier hs-var">_bcasmSourceMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687412317"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span>
</span><span id="line-678"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either QErr (DBObjectsIntrospection b)
</span><a href="#local-6989586621687412318"><span class="hs-identifier hs-var">databaseResponse</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-679"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621687412320"><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621687412320"><span class="hs-identifier hs-var">databaseMetadata</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-680"></span><span>              </span><span class="hs-comment">-- Collect database introspection to persist in the storage</span><span>
</span><span id="line-681"></span><span>              </span><span class="annot"><span class="annottext">arr (Seq CollectItem) ()
forall w (arr :: * -&gt; * -&gt; *). ArrowWriter w arr =&gt; arr w ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#tellA"><span class="hs-identifier hs-var">tellA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">CollectItem -&gt; Seq CollectItem
forall a. a -&gt; Seq a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StoredIntrospectionItem -&gt; CollectItem
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectStoredIntrospection"><span class="hs-identifier hs-var">CollectStoredIntrospection</span></a></span><span> </span><span class="annot"><span class="annottext">(StoredIntrospectionItem -&gt; CollectItem)
-&gt; StoredIntrospectionItem -&gt; CollectItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; EncJSON -&gt; StoredIntrospectionItem
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#SourceIntrospectionItem"><span class="hs-identifier hs-var">SourceIntrospectionItem</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412313"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">(EncJSON -&gt; StoredIntrospectionItem)
-&gt; EncJSON -&gt; StoredIntrospectionItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DBObjectsIntrospection b -&gt; EncJSON
forall a. ToJSON a =&gt; a -&gt; EncJSON
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-var">encJFromJValue</span></a></span><span> </span><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621687412320"><span class="hs-identifier hs-var">databaseMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-682"></span><span>              </span><span class="annot"><span class="annottext">arr
  (Maybe (SourceConfig b, DBObjectsIntrospection b))
  (Maybe (SourceConfig b, DBObjectsIntrospection b))
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">(SourceConfig b, DBObjectsIntrospection b)
-&gt; Maybe (SourceConfig b, DBObjectsIntrospection b)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687412317"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621687412320"><span class="hs-identifier hs-var">databaseMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-683"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621687412323"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687412323"><span class="hs-identifier hs-var">databaseError</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-684"></span><span>              </span><span class="hs-comment">-- If database exception occurs, try to lookup from stored introspection</span><span>
</span><span id="line-685"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621687412307"><span class="hs-identifier hs-var">sourceIntrospection</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
-&gt; (ByteString -&gt; Maybe (DBObjectsIntrospection b))
-&gt; Maybe (DBObjectsIntrospection b)
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (DBObjectsIntrospection b)
forall a. FromJSON a =&gt; ByteString -&gt; Maybe a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.html#decode%27"><span class="hs-identifier hs-var">decode'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-686"></span><span>                </span><span class="annot"><span class="annottext">Maybe (DBObjectsIntrospection b)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-687"></span><span>                  </span><span class="hs-comment">-- If no stored introspection exist, re-throw the database exception</span><span>
</span><span id="line-688"></span><span>                  </span><span class="hs-glyph">(|</span><span> </span><span class="annot"><span class="annottext">ErrorA QErr arr (a, ()) (SourceConfig b, DBObjectsIntrospection b)
-&gt; arr
     (a, (MetadataObject, ()))
     (Maybe (SourceConfig b, DBObjectsIntrospection b))
forall {a}.
ErrorA QErr arr (a, ()) (SourceConfig b, DBObjectsIntrospection b)
-&gt; arr
     (a, (MetadataObject, ()))
     (Maybe (SourceConfig b, DBObjectsIntrospection b))
forall (arr :: * -&gt; * -&gt; *) e s a.
(ArrowChoice arr, ArrowWriter (Seq CollectItem) arr) =&gt;
ErrorA QErr arr (e, s) a -&gt; arr (e, (MetadataObject, s)) (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistency"><span class="hs-identifier hs-var">withRecordInconsistency</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorA QErr arr QErr (SourceConfig b, DBObjectsIntrospection b)
forall a. ErrorA QErr arr QErr a
forall e (arr :: * -&gt; * -&gt; *) a. ArrowError e arr =&gt; arr e a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#throwA"><span class="hs-identifier hs-var">throwA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687412323"><span class="hs-identifier hs-var">databaseError</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|)</span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687412314"><span class="hs-identifier hs-var">metadataObj</span></a></span><span>
</span><span id="line-689"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621687412328"><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621687412328"><span class="hs-identifier hs-var">storedMetadata</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-690"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687412329"><span class="annot"><span class="annottext">inconsistencyMessage :: Text
</span><a href="#local-6989586621687412329"><span class="hs-identifier hs-var hs-var">inconsistencyMessage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-691"></span><span>                        </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-27d8e86ddce8dd754c06549efa10988301d41e208fc11cac9fe9ed6d99d6eb35/share/doc/html/src/Data.Text.html#unwords"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-692"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;source &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SourceName -&gt; Text
forall t. ToTxt t =&gt; Text -&gt; t -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#%3C%3E%3E"><span class="hs-operator hs-var">&lt;&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412313"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-693"></span><span>                            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; is inconsistent because of stale database introspection is used.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-694"></span><span>                            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The source couldn't be reached for a fresh introspection&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-695"></span><span>                            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;because we got error: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#qeError"><span class="hs-identifier hs-var">qeError</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687412323"><span class="hs-identifier hs-var">databaseError</span></a></span><span>
</span><span id="line-696"></span><span>                          </span><span class="hs-special">]</span><span>
</span><span id="line-697"></span><span>                  </span><span class="hs-comment">-- Still record inconsistency to notify the user obout the usage of stored stale data</span><span>
</span><span id="line-698"></span><span>                  </span><span class="annot"><span class="annottext">arr ((Maybe Value, [MetadataObject]), Text) ()
forall (arr :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(ArrowWriter (Seq CollectItem) arr, Functor f, Foldable f) =&gt;
arr ((Maybe Value, f MetadataObject), Text) ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistencies"><span class="hs-identifier hs-var">recordInconsistencies</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Maybe Value
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Maybe Value) -&gt; Value -&gt; Maybe Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe QErrExtra -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QErr -&gt; Maybe QErrExtra
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#qeInternal"><span class="hs-identifier hs-var">qeInternal</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687412323"><span class="hs-identifier hs-var">databaseError</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687412314"><span class="hs-identifier hs-var">metadataObj</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687412329"><span class="hs-identifier hs-var">inconsistencyMessage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span>                  </span><span class="annot"><span class="annottext">arr (m ()) ()
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html#bindA"><span class="hs-identifier hs-var">bindA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a Hasura, MonadIO m) =&gt;
   a -&gt; m ()
forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687411808"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(StoredIntrospectionLog -&gt; m ()) -&gt; StoredIntrospectionLog -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; QErr -&gt; StoredIntrospectionLog
</span><a href="Hasura.Logging.html#StoredIntrospectionLog"><span class="hs-identifier hs-var">StoredIntrospectionLog</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Using stored introspection for database source &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SourceName -&gt; Text
forall t. ToTxt t =&gt; Text -&gt; t -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#%3C%3E%3E"><span class="hs-operator hs-var">&lt;&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412313"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687412323"><span class="hs-identifier hs-var">databaseError</span></a></span><span>
</span><span id="line-700"></span><span>                  </span><span class="annot"><span class="annottext">arr
  (Maybe (SourceConfig b, DBObjectsIntrospection b))
  (Maybe (SourceConfig b, DBObjectsIntrospection b))
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">(SourceConfig b, DBObjectsIntrospection b)
-&gt; Maybe (SourceConfig b, DBObjectsIntrospection b)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687412317"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621687412328"><span class="hs-identifier hs-var">storedMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>
</span><span id="line-702"></span><span>    </span><span class="hs-comment">-- impl notes (swann):</span><span>
</span><span id="line-703"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-704"></span><span>    </span><span class="hs-comment">-- as our cache invalidation key, we use the fact of the availability of event triggers</span><span>
</span><span id="line-705"></span><span>    </span><span class="hs-comment">-- present, rerunning catalog init when this changes. i.e we invalidate the cache and</span><span>
</span><span id="line-706"></span><span>    </span><span class="hs-comment">-- rebuild it with the catalog only when there is at least one event trigger present.</span><span>
</span><span id="line-707"></span><span>    </span><span class="hs-comment">-- This is correct, because we only care about the transition from zero event triggers</span><span>
</span><span id="line-708"></span><span>    </span><span class="hs-comment">-- to nonzero (not necessarily one, as Anon has observed, because replace_metadata can</span><span>
</span><span id="line-709"></span><span>    </span><span class="hs-comment">-- add multiple event triggers in one go)</span><span>
</span><span id="line-710"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-711"></span><span>    </span><span class="hs-comment">-- a future optimisation would be to cache, on a per-source basis, whether or not</span><span>
</span><span id="line-712"></span><span>    </span><span class="hs-comment">-- the event catalog itself exists, and to then trigger catalog init when an event</span><span>
</span><span id="line-713"></span><span>    </span><span class="hs-comment">-- trigger is created _but only if_ this cached information says the event catalog</span><span>
</span><span id="line-714"></span><span>    </span><span class="hs-comment">-- doesn't already exist.</span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span>    </span><span class="annot"><a href="#local-6989586621687412336"><span class="hs-identifier hs-type">initCatalogIfNeeded</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-717"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687410201"><span class="annot"><a href="#local-6989586621687410201"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621687410199"><span class="annot"><a href="#local-6989586621687410199"><span class="hs-identifier hs-type">arr</span></a></span></span><span> </span><span id="local-6989586621687410200"><span class="annot"><a href="#local-6989586621687410200"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-718"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ArrowChoice</span></span><span> </span><span class="annot"><a href="#local-6989586621687410199"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-719"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#ArrowCache"><span class="hs-identifier hs-type">Inc.ArrowCache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410200"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410199"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-720"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#ArrowWriter"><span class="hs-identifier hs-type">ArrowWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687410199"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-721"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687410200"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-722"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410201"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-723"></span><span>        </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-92f8a47f193bc8ca499a8b94581fad6cb68b7a26370b271798ac2ec617c05064/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687410200"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-724"></span><span>        </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#HasCacheStaticConfig"><span class="hs-identifier hs-type">HasCacheStaticConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410200"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-725"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-726"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621687410201"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410201"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#EventTriggerConf"><span class="hs-identifier hs-type">EventTriggerConf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410201"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SourceConfiguration.html#SourceConfig"><span class="hs-identifier hs-type">SourceConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410201"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687410199"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#RecreateEventTriggers"><span class="hs-identifier hs-type">RecreateEventTriggers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Migrate.Version.html#SourceCatalogMigrationState"><span class="hs-identifier hs-type">SourceCatalogMigrationState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-727"></span><span>    </span><span id="local-6989586621687412336"><span class="annot"><span class="annottext">initCatalogIfNeeded :: forall (b :: BackendType) (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowCache m arr,
 ArrowWriter (Seq CollectItem) arr, MonadIO m, BackendMetadata b,
 MonadBaseControl IO m, HasCacheStaticConfig m) =&gt;
arr
  (Proxy b, [(TableName b, [EventTriggerConf b])], SourceConfig b,
   SourceName)
  (RecreateEventTriggers, SourceCatalogMigrationState)
</span><a href="#local-6989586621687412336"><span class="hs-identifier hs-var hs-var">initCatalogIfNeeded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">arr
  (Proxy b, [(TableName b, [EventTriggerConf b])], SourceConfig b,
   SourceName)
  (RecreateEventTriggers, SourceCatalogMigrationState)
-&gt; arr
     (Proxy b, [(TableName b, [EventTriggerConf b])], SourceConfig b,
      SourceName)
     (RecreateEventTriggers, SourceCatalogMigrationState)
forall a b. (Given Accesses =&gt; Eq a) =&gt; arr a b -&gt; arr a b
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a b.
(ArrowCache m arr, Given Accesses =&gt; Eq a) =&gt;
arr a b -&gt; arr a b
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#cache"><span class="hs-identifier hs-var">Inc.cache</span></a></span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy b
</span><span class="hs-identifier hs-var">Proxy</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412424"><span class="annot"><span class="annottext">[(TableName b, [EventTriggerConf b])]
</span><a href="#local-6989586621687412424"><span class="hs-identifier hs-var">eventTriggers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412425"><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687412425"><span class="hs-identifier hs-var">sourceConfig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412426"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412426"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-728"></span><span>      </span><span id="local-6989586621687412427"><span class="annot"><span class="annottext">Maybe (RecreateEventTriggers, SourceCatalogMigrationState)
</span><a href="#local-6989586621687412427"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-729"></span><span>        </span><span class="hs-glyph">(|</span><span>
</span><span id="line-730"></span><span>          </span><span class="annot"><span class="annottext">ErrorA
  QErr
  arr
  (a, ())
  (RecreateEventTriggers, SourceCatalogMigrationState)
-&gt; arr
     (a, ([MetadataObject], ()))
     (Maybe (RecreateEventTriggers, SourceCatalogMigrationState))
forall {a}.
ErrorA
  QErr
  arr
  (a, ())
  (RecreateEventTriggers, SourceCatalogMigrationState)
-&gt; arr
     (a, ([MetadataObject], ()))
     (Maybe (RecreateEventTriggers, SourceCatalogMigrationState))
forall (arr :: * -&gt; * -&gt; *) e s a.
(ArrowChoice arr, ArrowWriter (Seq CollectItem) arr) =&gt;
ErrorA QErr arr (e, s) a
-&gt; arr (e, ([MetadataObject], s)) (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencies"><span class="hs-identifier hs-var">withRecordInconsistencies</span></a></span><span>
</span><span id="line-731"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ErrorA
  QErr
  arr
  (ExceptT
     QErr m (RecreateEventTriggers, SourceCatalogMigrationState))
  (RecreateEventTriggers, SourceCatalogMigrationState)
forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *) e a.
(ArrowChoice arr, ArrowKleisli m arr, ArrowError e arr) =&gt;
arr (ExceptT e m a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html#bindErrorA"><span class="hs-identifier hs-var">bindErrorA</span></a></span><span>
</span><span id="line-732"></span><span>                </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-733"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TableName b, [EventTriggerConf b]) -&gt; Int)
-&gt; [(TableName b, [EventTriggerConf b])] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EventTriggerConf b] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([EventTriggerConf b] -&gt; Int)
-&gt; ((TableName b, [EventTriggerConf b]) -&gt; [EventTriggerConf b])
-&gt; (TableName b, [EventTriggerConf b])
-&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TableName b, [EventTriggerConf b]) -&gt; [EventTriggerConf b]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(TableName b, [EventTriggerConf b])]
</span><a href="#local-6989586621687412424"><span class="hs-identifier hs-var">eventTriggers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-734"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-735"></span><span>                      </span><span id="local-6989586621687412432"><span class="annot"><span class="annottext">CacheStaticConfig
</span><a href="#local-6989586621687412432"><span class="hs-identifier hs-var">cacheStaticConfig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT QErr m CacheStaticConfig
forall (m :: * -&gt; *). HasCacheStaticConfig m =&gt; m CacheStaticConfig
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#askCacheStaticConfig"><span class="hs-identifier hs-var">askCacheStaticConfig</span></a></span><span>
</span><span id="line-736"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687412433"><span class="annot"><span class="annottext">maintenanceMode :: MaintenanceMode ()
</span><a href="#local-6989586621687412433"><span class="hs-identifier hs-var hs-var">maintenanceMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CacheStaticConfig -&gt; MaintenanceMode ()
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cscMaintenanceMode"><span class="hs-identifier hs-var">_cscMaintenanceMode</span></a></span><span> </span><span class="annot"><span class="annottext">CacheStaticConfig
</span><a href="#local-6989586621687412432"><span class="hs-identifier hs-var">cacheStaticConfig</span></a></span><span>
</span><span id="line-737"></span><span>                          </span><span id="local-6989586621687412435"><span class="annot"><span class="annottext">eventingMode :: EventingMode
</span><a href="#local-6989586621687412435"><span class="hs-identifier hs-var hs-var">eventingMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CacheStaticConfig -&gt; EventingMode
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cscEventingMode"><span class="hs-identifier hs-var">_cscEventingMode</span></a></span><span> </span><span class="annot"><span class="annottext">CacheStaticConfig
</span><a href="#local-6989586621687412432"><span class="hs-identifier hs-var">cacheStaticConfig</span></a></span><span>
</span><span id="line-738"></span><span>                          </span><span id="local-6989586621687412437"><span class="annot"><span class="annottext">readOnlyMode :: ReadOnlyMode
</span><a href="#local-6989586621687412437"><span class="hs-identifier hs-var hs-var">readOnlyMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CacheStaticConfig -&gt; ReadOnlyMode
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cscReadOnlyMode"><span class="hs-identifier hs-var">_cscReadOnlyMode</span></a></span><span> </span><span class="annot"><span class="annottext">CacheStaticConfig
</span><a href="#local-6989586621687412432"><span class="hs-identifier hs-var">cacheStaticConfig</span></a></span><span>
</span><span id="line-739"></span><span>
</span><span id="line-740"></span><span>                      </span><span class="hs-keyword">if</span><span>
</span><span id="line-741"></span><span>                        </span><span class="hs-comment">-- when safe mode is enabled, don't perform any migrations</span><span>
</span><span id="line-742"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="#local-6989586621687412437"><span class="hs-identifier hs-var">readOnlyMode</span></a></span><span> </span><span class="annot"><span class="annottext">ReadOnlyMode -&gt; ReadOnlyMode -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="Hasura.Server.Types.html#ReadOnlyModeEnabled"><span class="hs-identifier hs-var">ReadOnlyModeEnabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(RecreateEventTriggers, SourceCatalogMigrationState)
-&gt; ExceptT
     QErr m (RecreateEventTriggers, SourceCatalogMigrationState)
forall a. a -&gt; ExceptT QErr m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETDoNothing"><span class="hs-identifier hs-var">RETDoNothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SourceCatalogMigrationState
</span><a href="Hasura.Server.Migrate.Version.html#SCMSMigrationOnHold"><span class="hs-identifier hs-var">SCMSMigrationOnHold</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;read-only mode enabled&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>                        </span><span class="hs-comment">-- when eventing mode is disabled, don't perform any migrations</span><span>
</span><span id="line-744"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EventingMode
</span><a href="#local-6989586621687412435"><span class="hs-identifier hs-var">eventingMode</span></a></span><span> </span><span class="annot"><span class="annottext">EventingMode -&gt; EventingMode -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">EventingMode
</span><a href="Hasura.Server.Types.html#EventingDisabled"><span class="hs-identifier hs-var">EventingDisabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(RecreateEventTriggers, SourceCatalogMigrationState)
-&gt; ExceptT
     QErr m (RecreateEventTriggers, SourceCatalogMigrationState)
forall a. a -&gt; ExceptT QErr m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETDoNothing"><span class="hs-identifier hs-var">RETDoNothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SourceCatalogMigrationState
</span><a href="Hasura.Server.Migrate.Version.html#SCMSMigrationOnHold"><span class="hs-identifier hs-var">SCMSMigrationOnHold</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;eventing mode disabled&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-745"></span><span>                        </span><span class="hs-comment">-- when maintenance mode is enabled, don't perform any migrations</span><span>
</span><span id="line-746"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621687412433"><span class="hs-identifier hs-var">maintenanceMode</span></a></span><span> </span><span class="annot"><span class="annottext">MaintenanceMode () -&gt; MaintenanceMode () -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; MaintenanceMode ()
forall a. a -&gt; MaintenanceMode a
</span><a href="Hasura.Server.Types.html#MaintenanceModeEnabled"><span class="hs-identifier hs-var">MaintenanceModeEnabled</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(RecreateEventTriggers, SourceCatalogMigrationState)
-&gt; ExceptT
     QErr m (RecreateEventTriggers, SourceCatalogMigrationState)
forall a. a -&gt; ExceptT QErr m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETDoNothing"><span class="hs-identifier hs-var">RETDoNothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SourceCatalogMigrationState
</span><a href="Hasura.Server.Migrate.Version.html#SCMSMigrationOnHold"><span class="hs-identifier hs-var">SCMSMigrationOnHold</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;maintenance mode enabled&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-747"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-748"></span><span>                            </span><span class="hs-comment">-- The `initCatalogForSource` action is retried here because</span><span>
</span><span id="line-749"></span><span>                            </span><span class="hs-comment">-- in cloud there will be multiple workers (graphql-engine instances)</span><span>
</span><span id="line-750"></span><span>                            </span><span class="hs-comment">-- trying to migrate the source catalog, when needed. This introduces</span><span>
</span><span id="line-751"></span><span>                            </span><span class="hs-comment">-- a race condition as both the workers try to migrate the source catalog</span><span>
</span><span id="line-752"></span><span>                            </span><span class="hs-comment">-- concurrently and when one of them succeeds the other ones will fail</span><span>
</span><span id="line-753"></span><span>                            </span><span class="hs-comment">-- and be in an inconsistent state. To avoid the inconsistency, we retry</span><span>
</span><span id="line-754"></span><span>                            </span><span class="hs-comment">-- migrating the catalog on error and in the retry `initCatalogForSource`</span><span>
</span><span id="line-755"></span><span>                            </span><span class="hs-comment">-- will see that the catalog is already migrated, so it won't attempt the</span><span>
</span><span id="line-756"></span><span>                            </span><span class="hs-comment">-- migration again</span><span>
</span><span id="line-757"></span><span>                            </span><span class="annot"><span class="annottext">Either QErr (RecreateEventTriggers, SourceCatalogMigrationState)
-&gt; ExceptT
     QErr m (RecreateEventTriggers, SourceCatalogMigrationState)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; Either e a -&gt; m a
</span><span class="hs-identifier hs-var">liftEither</span></span><span>
</span><span id="line-758"></span><span>                              </span><span class="annot"><span class="annottext">(Either QErr (RecreateEventTriggers, SourceCatalogMigrationState)
 -&gt; ExceptT
      QErr m (RecreateEventTriggers, SourceCatalogMigrationState))
-&gt; ExceptT
     QErr
     m
     (Either QErr (RecreateEventTriggers, SourceCatalogMigrationState))
-&gt; ExceptT
     QErr m (RecreateEventTriggers, SourceCatalogMigrationState)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">RetryPolicyM (ExceptT QErr m)
-&gt; (RetryStatus
    -&gt; Either QErr (RecreateEventTriggers, SourceCatalogMigrationState)
    -&gt; ExceptT QErr m Bool)
-&gt; (RetryStatus
    -&gt; ExceptT
         QErr
         m
         (Either QErr (RecreateEventTriggers, SourceCatalogMigrationState)))
-&gt; ExceptT
     QErr
     m
     (Either QErr (RecreateEventTriggers, SourceCatalogMigrationState))
forall (m :: * -&gt; *) b.
MonadIO m =&gt;
RetryPolicyM m
-&gt; (RetryStatus -&gt; b -&gt; m Bool) -&gt; (RetryStatus -&gt; m b) -&gt; m b
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/retry-0.9.3.0-406412e79c1f0d5bab239d04f2d7ebdcd3ce7260d36a0fa430724f47b107aa29/share/doc/html/src/Control.Retry.html#retrying"><span class="hs-identifier hs-var">Retry.retrying</span></a></span><span>
</span><span id="line-759"></span><span>                                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int -&gt; RetryPolicyM (ExceptT QErr m)
forall (m :: * -&gt; *). Monad m =&gt; Int -&gt; RetryPolicyM m
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/retry-0.9.3.0-406412e79c1f0d5bab239d04f2d7ebdcd3ce7260d36a0fa430724f47b107aa29/share/doc/html/src/Control.Retry.html#constantDelay"><span class="hs-identifier hs-var">Retry.constantDelay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Int) -&gt; Integer -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; Integer
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Data.Time.Clock.Units.html#diffTimeToMicroSeconds"><span class="hs-identifier hs-var">diffTimeToMicroSeconds</span></a></span><span> </span><span class="annot"><span class="annottext">(DiffTime -&gt; Integer) -&gt; DiffTime -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Seconds -&gt; DiffTime
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Data.Time.Clock.Units.html#seconds"><span class="hs-identifier hs-var">seconds</span></a></span><span> </span><span class="annot"><span class="annottext">(Seconds -&gt; DiffTime) -&gt; Seconds -&gt; DiffTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; Seconds
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Data.Time.Clock.Units.html#Seconds"><span class="hs-identifier hs-var">Seconds</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">10</span></span><span class="hs-special">)</span><span>
</span><span id="line-760"></span><span>                                    </span><span class="annot"><span class="annottext">RetryPolicyM (ExceptT QErr m)
-&gt; RetryPolicyM (ExceptT QErr m) -&gt; RetryPolicyM (ExceptT QErr m)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; RetryPolicy
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/retry-0.9.3.0-406412e79c1f0d5bab239d04f2d7ebdcd3ce7260d36a0fa430724f47b107aa29/share/doc/html/src/Control.Retry.html#limitRetries"><span class="hs-identifier hs-var">Retry.limitRetries</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span>
</span><span id="line-761"></span><span>                                </span><span class="hs-special">)</span><span>
</span><span id="line-762"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either QErr (RecreateEventTriggers, SourceCatalogMigrationState)
 -&gt; ExceptT QErr m Bool)
-&gt; RetryStatus
-&gt; Either QErr (RecreateEventTriggers, SourceCatalogMigrationState)
-&gt; ExceptT QErr m Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">((Either QErr (RecreateEventTriggers, SourceCatalogMigrationState)
  -&gt; ExceptT QErr m Bool)
 -&gt; RetryStatus
 -&gt; Either QErr (RecreateEventTriggers, SourceCatalogMigrationState)
 -&gt; ExceptT QErr m Bool)
-&gt; (Either
      QErr (RecreateEventTriggers, SourceCatalogMigrationState)
    -&gt; ExceptT QErr m Bool)
-&gt; RetryStatus
-&gt; Either QErr (RecreateEventTriggers, SourceCatalogMigrationState)
-&gt; ExceptT QErr m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT QErr m Bool
forall a. a -&gt; ExceptT QErr m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; ExceptT QErr m Bool)
-&gt; (Either
      QErr (RecreateEventTriggers, SourceCatalogMigrationState)
    -&gt; Bool)
-&gt; Either QErr (RecreateEventTriggers, SourceCatalogMigrationState)
-&gt; ExceptT QErr m Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Either QErr (RecreateEventTriggers, SourceCatalogMigrationState)
-&gt; Bool
forall a b. Either a b -&gt; Bool
</span><span class="hs-identifier hs-var">isLeft</span></span><span class="hs-special">)</span><span>
</span><span id="line-763"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExceptT
  QErr
  m
  (Either QErr (RecreateEventTriggers, SourceCatalogMigrationState))
-&gt; RetryStatus
-&gt; ExceptT
     QErr
     m
     (Either QErr (RecreateEventTriggers, SourceCatalogMigrationState))
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   QErr
   m
   (Either QErr (RecreateEventTriggers, SourceCatalogMigrationState))
 -&gt; RetryStatus
 -&gt; ExceptT
      QErr
      m
      (Either QErr (RecreateEventTriggers, SourceCatalogMigrationState)))
-&gt; ExceptT
     QErr
     m
     (Either QErr (RecreateEventTriggers, SourceCatalogMigrationState))
-&gt; RetryStatus
-&gt; ExceptT
     QErr
     m
     (Either QErr (RecreateEventTriggers, SourceCatalogMigrationState))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExceptT
  QErr
  (ExceptT QErr m)
  (RecreateEventTriggers, SourceCatalogMigrationState)
-&gt; ExceptT
     QErr
     m
     (Either QErr (RecreateEventTriggers, SourceCatalogMigrationState))
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   QErr
   (ExceptT QErr m)
   (RecreateEventTriggers, SourceCatalogMigrationState)
 -&gt; ExceptT
      QErr
      m
      (Either QErr (RecreateEventTriggers, SourceCatalogMigrationState)))
-&gt; ExceptT
     QErr
     (ExceptT QErr m)
     (RecreateEventTriggers, SourceCatalogMigrationState)
-&gt; ExceptT
     QErr
     m
     (Either QErr (RecreateEventTriggers, SourceCatalogMigrationState))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(BackendMetadata b, MonadIO m, MonadBaseControl IO m) =&gt;
SourceConfig b
-&gt; ExceptT
     QErr m (RecreateEventTriggers, SourceCatalogMigrationState)
</span><a href="Hasura.RQL.Types.Metadata.Backend.html#prepareCatalog"><span class="hs-identifier hs-var">prepareCatalog</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410201"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687412425"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-764"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(RecreateEventTriggers, SourceCatalogMigrationState)
-&gt; ExceptT
     QErr m (RecreateEventTriggers, SourceCatalogMigrationState)
forall a. a -&gt; ExceptT QErr m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETDoNothing"><span class="hs-identifier hs-var">RETDoNothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourceCatalogMigrationState
</span><a href="Hasura.Server.Migrate.Version.html#SCMSUninitializedSource"><span class="hs-identifier hs-var">SCMSUninitializedSource</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-765"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-766"></span><span>          </span><span class="hs-glyph">|)</span><span>
</span><span id="line-767"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TableName b, [EventTriggerConf b]) -&gt; [MetadataObject])
-&gt; [(TableName b, [EventTriggerConf b])] -&gt; [MetadataObject]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621687412456"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621687412456"><span class="hs-identifier hs-var">tableName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412457"><span class="annot"><span class="annottext">[EventTriggerConf b]
</span><a href="#local-6989586621687412457"><span class="hs-identifier hs-var">events</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(EventTriggerConf b -&gt; MetadataObject)
-&gt; [EventTriggerConf b] -&gt; [MetadataObject]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceName -&gt; TableName b -&gt; EventTriggerConf b -&gt; MetadataObject
forall (b :: BackendType).
Backend b =&gt;
SourceName -&gt; TableName b -&gt; EventTriggerConf b -&gt; MetadataObject
</span><a href="#local-6989586621687412458"><span class="hs-identifier hs-var">mkEventTriggerMetadataObject'</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412426"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621687412456"><span class="hs-identifier hs-var">tableName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[EventTriggerConf b]
</span><a href="#local-6989586621687412457"><span class="hs-identifier hs-var">events</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(TableName b, [EventTriggerConf b])]
</span><a href="#local-6989586621687412424"><span class="hs-identifier hs-var">eventTriggers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-768"></span><span>
</span><span id="line-769"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (RecreateEventTriggers, SourceCatalogMigrationState)
</span><a href="#local-6989586621687412427"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-770"></span><span>        </span><span class="annot"><span class="annottext">Maybe (RecreateEventTriggers, SourceCatalogMigrationState)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-771"></span><span>          </span><span class="annot"><span class="annottext">arr
  (RecreateEventTriggers, SourceCatalogMigrationState)
  (RecreateEventTriggers, SourceCatalogMigrationState)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETDoNothing"><span class="hs-identifier hs-var">RETDoNothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourceCatalogMigrationState
</span><a href="Hasura.Server.Migrate.Version.html#SCMSUninitializedSource"><span class="hs-identifier hs-var">SCMSUninitializedSource</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-772"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687412459"><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="#local-6989586621687412459"><span class="hs-identifier hs-var">recreateEventTriggers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412460"><span class="annot"><span class="annottext">SourceCatalogMigrationState
</span><a href="#local-6989586621687412460"><span class="hs-identifier hs-var">catalogMigrationState</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">arr
  (RecreateEventTriggers, SourceCatalogMigrationState)
  (RecreateEventTriggers, SourceCatalogMigrationState)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="#local-6989586621687412459"><span class="hs-identifier hs-var">recreateEventTriggers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourceCatalogMigrationState
</span><a href="#local-6989586621687412460"><span class="hs-identifier hs-var">catalogMigrationState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-773"></span><span>
</span><span id="line-774"></span><span>    </span><span class="annot"><a href="#local-6989586621687412461"><span class="hs-identifier hs-type">buildSource</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-775"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687410264"><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621687410262"><span class="annot"><a href="#local-6989586621687410262"><span class="hs-identifier hs-type">arr</span></a></span></span><span> </span><span id="local-6989586621687410263"><span class="annot"><a href="#local-6989586621687410263"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-776"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ArrowChoice</span></span><span> </span><span class="annot"><a href="#local-6989586621687410262"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-777"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html#ArrowKleisli"><span class="hs-identifier hs-type">ArrowKleisli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410263"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410262"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-778"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#ArrowWriter"><span class="hs-identifier hs-type">ArrowWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687410262"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-779"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410263"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-780"></span><span>        </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#HasCacheStaticConfig"><span class="hs-identifier hs-type">HasCacheStaticConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410263"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-781"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687410263"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-782"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-783"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCacheTypes.html#GetAggregationPredicatesDeps"><span class="hs-identifier hs-type">GetAggregationPredicatesDeps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-784"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-785"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#CacheDynamicConfig"><span class="hs-identifier hs-type">CacheDynamicConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-786"></span><span>        </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.SQL.AnyBackend.html#AnyBackend"><span class="hs-identifier hs-type">AB.AnyBackend</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.RemoteRelationship.html#PartiallyResolvedSource"><span class="hs-identifier hs-type">PartiallyResolvedSource</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-787"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SourceMetadata"><span class="hs-identifier hs-type">SourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-788"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.SourceConfiguration.html#SourceConfig"><span class="hs-identifier hs-type">SourceConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-789"></span><span>        </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Table.Cache.html#TableCoreInfoG"><span class="hs-identifier hs-type">TableCoreInfoG</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Column.html#StructuredColumnInfo"><span class="hs-identifier hs-type">StructuredColumnInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Column.html#ColumnInfo"><span class="hs-identifier hs-type">ColumnInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-790"></span><span>        </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#EventTriggerInfoMap"><span class="hs-identifier hs-type">EventTriggerInfoMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-791"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#DBObjectsIntrospection"><span class="hs-identifier hs-type">DBObjectsIntrospection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-792"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#PartiallyResolvedRemoteSchemaMap"><span class="hs-identifier hs-type">PartiallyResolvedRemoteSchemaMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-793"></span><span>        </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Permission.html#OrderedRoles"><span class="hs-identifier hs-type">OrderedRoles</span></a></span><span>
</span><span id="line-794"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-795"></span><span>        </span><span class="annot"><a href="#local-6989586621687410262"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceInfo"><span class="hs-identifier hs-type">SourceInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-796"></span><span>    </span><span id="local-6989586621687412461"><span class="annot"><span class="annottext">buildSource :: forall (b :: BackendType) (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowKleisli m arr,
 ArrowWriter (Seq CollectItem) arr, MonadError QErr m,
 HasCacheStaticConfig m, MonadIO m, BackendMetadata b,
 GetAggregationPredicatesDeps b) =&gt;
arr
  (CacheDynamicConfig,
   HashMap SourceName (AnyBackend PartiallyResolvedSource),
   SourceMetadata b, SourceConfig b,
   HashMap
     (TableName b)
     (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b)),
   HashMap (TableName b) (EventTriggerInfoMap b),
   DBObjectsIntrospection b, PartiallyResolvedRemoteSchemaMap,
   OrderedRoles)
  (SourceInfo b)
</span><a href="#local-6989586621687412461"><span class="hs-identifier hs-var hs-var">buildSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687412727"><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687412727"><span class="hs-identifier hs-var">dynamicConfig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412728"><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend PartiallyResolvedSource)
</span><a href="#local-6989586621687412728"><span class="hs-identifier hs-var">allSources</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412729"><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687412729"><span class="hs-identifier hs-var">sourceMetadata</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412730"><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687412730"><span class="hs-identifier hs-var">sourceConfig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412731"><span class="annot"><span class="annottext">HashMap
  (TableName b)
  (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b))
</span><a href="#local-6989586621687412731"><span class="hs-identifier hs-var">tablesRawInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412732"><span class="annot"><span class="annottext">HashMap (TableName b) (EventTriggerInfoMap b)
</span><a href="#local-6989586621687412732"><span class="hs-identifier hs-var">eventTriggerInfoMaps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412733"><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621687412733"><span class="hs-identifier hs-var">dbObjectsIntrospection</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412734"><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaMap
</span><a href="#local-6989586621687412734"><span class="hs-identifier hs-var">remoteSchemaMap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412735"><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621687412735"><span class="hs-identifier hs-var">orderedRoles</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-797"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#DBObjectsIntrospection"><span class="hs-identifier hs-type">DBObjectsIntrospection</span></a></span><span> </span><span id="local-6989586621687412737"><span class="annot"><span class="annottext">DBTablesMetadata b
</span><a href="#local-6989586621687412737"><span class="hs-identifier hs-var">_dbTables</span></a></span></span><span> </span><span id="local-6989586621687412738"><span class="annot"><span class="annottext">DBFunctionsMetadata b
</span><a href="#local-6989586621687412738"><span class="hs-identifier hs-var">dbFunctions</span></a></span></span><span> </span><span id="local-6989586621687412739"><span class="annot"><span class="annottext">ScalarMap b
</span><a href="#local-6989586621687412739"><span class="hs-identifier hs-var">_scalars</span></a></span></span><span> </span><span id="local-6989586621687412740"><span class="annot"><span class="annottext">LogicalModels b
</span><a href="#local-6989586621687412740"><span class="hs-identifier hs-var">introspectedLogicalModels</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621687412733"><span class="hs-identifier hs-var">dbObjectsIntrospection</span></a></span><span>
</span><span id="line-798"></span><span>          </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SourceMetadata"><span class="hs-identifier hs-type">SourceMetadata</span></a></span><span> </span><span id="local-6989586621687412742"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412742"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span> </span><span id="local-6989586621687412743"><span class="annot"><span class="annottext">BackendSourceKind b
</span><a href="#local-6989586621687412743"><span class="hs-identifier hs-var">backendSourceKind</span></a></span></span><span> </span><span id="local-6989586621687412744"><span class="annot"><span class="annottext">Tables b
</span><a href="#local-6989586621687412744"><span class="hs-identifier hs-var">tables</span></a></span></span><span> </span><span id="local-6989586621687412745"><span class="annot"><span class="annottext">Functions b
</span><a href="#local-6989586621687412745"><span class="hs-identifier hs-var">functions</span></a></span></span><span> </span><span id="local-6989586621687412746"><span class="annot"><span class="annottext">NativeQueries b
</span><a href="#local-6989586621687412746"><span class="hs-identifier hs-var">nativeQueries</span></a></span></span><span> </span><span id="local-6989586621687412747"><span class="annot"><span class="annottext">StoredProcedures b
</span><a href="#local-6989586621687412747"><span class="hs-identifier hs-var">storedProcedures</span></a></span></span><span> </span><span id="local-6989586621687412748"><span class="annot"><span class="annottext">LogicalModels b
</span><a href="#local-6989586621687412748"><span class="hs-identifier hs-var">logicalModels</span></a></span></span><span> </span><span class="annot"><span class="annottext">SourceConnConfiguration b
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621687412749"><span class="annot"><span class="annottext">Maybe QueryTagsConfig
</span><a href="#local-6989586621687412749"><span class="hs-identifier hs-var">queryTagsConfig</span></a></span></span><span> </span><span id="local-6989586621687412750"><span class="annot"><span class="annottext">SourceCustomization
</span><a href="#local-6989586621687412750"><span class="hs-identifier hs-var">sourceCustomization</span></a></span></span><span> </span><span id="local-6989586621687412751"><span class="annot"><span class="annottext">Maybe (HealthCheckConfig b)
</span><a href="#local-6989586621687412751"><span class="hs-identifier hs-var">_healthCheckConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687412729"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-799"></span><span>          </span><span id="local-6989586621687412752"><span class="annot"><span class="annottext">tablesMetadata :: [TableMetadata b]
</span><a href="#local-6989586621687412752"><span class="hs-identifier hs-var hs-var">tablesMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tables b -&gt; [TableMetadata b]
forall k v. InsOrdHashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#elems"><span class="hs-identifier hs-var">InsOrdHashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">Tables b
</span><a href="#local-6989586621687412744"><span class="hs-identifier hs-var">tables</span></a></span><span>
</span><span id="line-800"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TableBuildInput b]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412753"><span class="annot"><span class="annottext">[NonColumnTableInputs b]
</span><a href="#local-6989586621687412753"><span class="hs-identifier hs-var">nonColumnInputs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412754"><span class="annot"><span class="annottext">[TablePermissionInputs b]
</span><a href="#local-6989586621687412754"><span class="hs-identifier hs-var">permissions</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TableBuildInput b, NonColumnTableInputs b,
  TablePermissionInputs b)]
-&gt; ([TableBuildInput b], [NonColumnTableInputs b],
    [TablePermissionInputs b])
forall a b c. [(a, b, c)] -&gt; ([a], [b], [c])
</span><span class="hs-identifier hs-var">unzip3</span></span><span> </span><span class="annot"><span class="annottext">([(TableBuildInput b, NonColumnTableInputs b,
   TablePermissionInputs b)]
 -&gt; ([TableBuildInput b], [NonColumnTableInputs b],
     [TablePermissionInputs b]))
-&gt; [(TableBuildInput b, NonColumnTableInputs b,
     TablePermissionInputs b)]
-&gt; ([TableBuildInput b], [NonColumnTableInputs b],
    [TablePermissionInputs b])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TableMetadata b
 -&gt; (TableBuildInput b, NonColumnTableInputs b,
     TablePermissionInputs b))
-&gt; [TableMetadata b]
-&gt; [(TableBuildInput b, NonColumnTableInputs b,
     TablePermissionInputs b)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TableMetadata b
-&gt; (TableBuildInput b, NonColumnTableInputs b,
    TablePermissionInputs b)
forall (b :: BackendType).
TableMetadata b
-&gt; (TableBuildInput b, NonColumnTableInputs b,
    TablePermissionInputs b)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#mkTableInputs"><span class="hs-identifier hs-var">mkTableInputs</span></a></span><span> </span><span class="annot"><span class="annottext">[TableMetadata b]
</span><a href="#local-6989586621687412752"><span class="hs-identifier hs-var">tablesMetadata</span></a></span><span>
</span><span id="line-801"></span><span>          </span><span id="local-6989586621687410336"><span id="local-6989586621687410337"><span class="annot"><a href="#local-6989586621687412757"><span class="hs-identifier hs-type">alignTableMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687410336"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687410337"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687410336"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621687410337"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-802"></span><span>          </span><span id="local-6989586621687412757"><span class="annot"><span class="annottext">alignTableMap :: forall a c.
HashMap (TableName b) a
-&gt; HashMap (TableName b) c -&gt; HashMap (TableName b) (a, c)
</span><a href="#local-6989586621687412757"><span class="hs-identifier hs-var hs-var">alignTableMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; c -&gt; (a, c))
-&gt; HashMap (TableName b) a
-&gt; HashMap (TableName b) c
-&gt; HashMap (TableName b) (a, c)
forall k v1 v2 v3.
(Eq k, Hashable k) =&gt;
(v1 -&gt; v2 -&gt; v3) -&gt; HashMap k v1 -&gt; HashMap k v2 -&gt; HashMap k v3
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.Strict.html#intersectionWith"><span class="hs-identifier hs-var">HashMap.intersectionWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-803"></span><span>
</span><span id="line-804"></span><span>      </span><span class="hs-comment">-- relationships and computed fields</span><span>
</span><span id="line-805"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687412761"><span class="annot"><span class="annottext">nonColumnsByTable :: HashMap (TableName b) (NonColumnTableInputs b)
</span><a href="#local-6989586621687412761"><span class="hs-identifier hs-var hs-var">nonColumnsByTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NonColumnTableInputs b -&gt; TableName b)
-&gt; [NonColumnTableInputs b]
-&gt; HashMap (TableName b) (NonColumnTableInputs b)
forall k a. Hashable k =&gt; (a -&gt; k) -&gt; [a] -&gt; HashMap k a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#mapFromL"><span class="hs-identifier hs-var">mapFromL</span></a></span><span> </span><span class="annot"><span class="annottext">NonColumnTableInputs b -&gt; TableName b
forall (b :: BackendType). NonColumnTableInputs b -&gt; TableName b
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_nctiTable"><span class="hs-identifier hs-var">_nctiTable</span></a></span><span> </span><span class="annot"><span class="annottext">[NonColumnTableInputs b]
</span><a href="#local-6989586621687412753"><span class="hs-identifier hs-var">nonColumnInputs</span></a></span><span>
</span><span id="line-806"></span><span>      </span><span id="local-6989586621687412764"><span class="annot"><span class="annottext">HashMap (TableName b) (TableCoreInfo b)
</span><a href="#local-6989586621687412764"><span class="hs-identifier hs-var">tableCoreInfos</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Table.Cache.html#TableCoreInfo"><span class="hs-identifier hs-type">TableCoreInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-807"></span><span>        </span><span class="annot"><span class="annottext">arr
  (Writer
     (Seq CollectItem) (HashMap (TableName b) (TableCoreInfo b)))
  (HashMap (TableName b) (TableCoreInfo b))
forall w (arr :: * -&gt; * -&gt; *) a.
ArrowWriter w arr =&gt;
arr (Writer w a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Interpret.html#interpretWriter"><span class="hs-identifier hs-var">interpretWriter</span></a></span><span>
</span><span id="line-808"></span><span>          </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">HashMap
  (TableName b)
  (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b),
   NonColumnTableInputs b)
-&gt; ((TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b),
     NonColumnTableInputs b)
    -&gt; WriterT (Seq CollectItem) Identity (TableCoreInfo b))
-&gt; Writer
     (Seq CollectItem) (HashMap (TableName b) (TableCoreInfo b))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap
  (TableName b)
  (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b))
</span><a href="#local-6989586621687412731"><span class="hs-identifier hs-var">tablesRawInfo</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap
  (TableName b)
  (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b))
-&gt; HashMap (TableName b) (NonColumnTableInputs b)
-&gt; HashMap
     (TableName b)
     (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b),
      NonColumnTableInputs b)
forall a c.
HashMap (TableName b) a
-&gt; HashMap (TableName b) c -&gt; HashMap (TableName b) (a, c)
</span><a href="#local-6989586621687412757"><span class="hs-operator hs-var">`alignTableMap`</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (TableName b) (NonColumnTableInputs b)
</span><a href="#local-6989586621687412761"><span class="hs-identifier hs-var">nonColumnsByTable</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621687412767"><span class="annot"><span class="annottext">TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621687412767"><span class="hs-identifier hs-var">tableRawInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412768"><span class="annot"><span class="annottext">NonColumnTableInputs b
</span><a href="#local-6989586621687412768"><span class="hs-identifier hs-var">nonColumnInput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-809"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687412769"><span class="annot"><span class="annottext">columns :: FieldInfoMap (StructuredColumnInfo b)
</span><a href="#local-6989586621687412769"><span class="hs-identifier hs-var hs-var">columns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b)
-&gt; FieldInfoMap (StructuredColumnInfo b)
forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn -&gt; FieldInfoMap field
</span><a href="Hasura.Table.Cache.html#_tciFieldInfoMap"><span class="hs-identifier hs-var">_tciFieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621687412767"><span class="hs-identifier hs-var">tableRawInfo</span></a></span><span>
</span><span id="line-810"></span><span>            </span><span id="local-6989586621687412771"><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621687412771"><span class="hs-identifier hs-var">allFields</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Table.Cache.html#FieldInfoMap"><span class="hs-identifier hs-type">FieldInfoMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Table.Cache.html#FieldInfo"><span class="hs-identifier hs-type">FieldInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend PartiallyResolvedSource)
-&gt; SourceName
-&gt; SourceConfig b
-&gt; HashMap
     (TableName b)
     (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b))
-&gt; FieldInfoMap (StructuredColumnInfo b)
-&gt; PartiallyResolvedRemoteSchemaMap
-&gt; DBFunctionsMetadata b
-&gt; NonColumnTableInputs b
-&gt; WriterT (Seq CollectItem) Identity (FieldInfoMap (FieldInfo b))
forall (b :: BackendType) (m :: * -&gt; *).
(MonadWriter (Seq CollectItem) m, BackendMetadata b) =&gt;
HashMap SourceName (AnyBackend PartiallyResolvedSource)
-&gt; SourceName
-&gt; SourceConfig b
-&gt; HashMap
     (TableName b)
     (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b))
-&gt; FieldInfoMap (StructuredColumnInfo b)
-&gt; PartiallyResolvedRemoteSchemaMap
-&gt; DBFunctionsMetadata b
-&gt; NonColumnTableInputs b
-&gt; m (FieldInfoMap (FieldInfo b))
</span><a href="Hasura.RQL.DDL.Schema.Cache.Fields.html#addNonColumnFields"><span class="hs-identifier hs-var">addNonColumnFields</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend PartiallyResolvedSource)
</span><a href="#local-6989586621687412728"><span class="hs-identifier hs-var">allSources</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412742"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687412730"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap
  (TableName b)
  (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b))
</span><a href="#local-6989586621687412731"><span class="hs-identifier hs-var">tablesRawInfo</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (StructuredColumnInfo b)
</span><a href="#local-6989586621687412769"><span class="hs-identifier hs-var">columns</span></a></span><span> </span><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaMap
</span><a href="#local-6989586621687412734"><span class="hs-identifier hs-var">remoteSchemaMap</span></a></span><span> </span><span class="annot"><span class="annottext">DBFunctionsMetadata b
</span><a href="#local-6989586621687412738"><span class="hs-identifier hs-var">dbFunctions</span></a></span><span> </span><span class="annot"><span class="annottext">NonColumnTableInputs b
</span><a href="#local-6989586621687412768"><span class="hs-identifier hs-var">nonColumnInput</span></a></span><span>
</span><span id="line-811"></span><span>            </span><span class="annot"><span class="annottext">TableCoreInfo b
-&gt; WriterT (Seq CollectItem) Identity (TableCoreInfo b)
forall a. a -&gt; WriterT (Seq CollectItem) Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TableCoreInfo b
 -&gt; WriterT (Seq CollectItem) Identity (TableCoreInfo b))
-&gt; TableCoreInfo b
-&gt; WriterT (Seq CollectItem) Identity (TableCoreInfo b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621687412767"><span class="hs-identifier hs-var">tableRawInfo</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">_tciFieldInfoMap :: FieldInfoMap (FieldInfo b)
</span><a href="Hasura.Table.Cache.html#_tciFieldInfoMap"><span class="hs-identifier hs-var">_tciFieldInfoMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621687412771"><span class="hs-identifier hs-var">allFields</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-812"></span><span>
</span><span id="line-813"></span><span>      </span><span class="hs-comment">-- permissions</span><span>
</span><span id="line-814"></span><span>      </span><span id="local-6989586621687412773"><span class="annot"><span class="annottext">Either QErr (HashMap (TableName b) (TableInfo b))
</span><a href="#local-6989586621687412773"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-815"></span><span>        </span><span class="annot"><span class="annottext">arr
  (Writer
     (Seq CollectItem)
     (Either QErr (HashMap (TableName b) (TableInfo b))))
  (Either QErr (HashMap (TableName b) (TableInfo b)))
forall w (arr :: * -&gt; * -&gt; *) a.
ArrowWriter w arr =&gt;
arr (Writer w a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Interpret.html#interpretWriter"><span class="hs-identifier hs-var">interpretWriter</span></a></span><span>
</span><span id="line-816"></span><span>          </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">ExceptT
  QErr
  (WriterT (Seq CollectItem) Identity)
  (HashMap (TableName b) (TableInfo b))
-&gt; Writer
     (Seq CollectItem)
     (Either QErr (HashMap (TableName b) (TableInfo b)))
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span>
</span><span id="line-817"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT
   QErr
   (WriterT (Seq CollectItem) Identity)
   (HashMap (TableName b) (TableInfo b))
 -&gt; Writer
      (Seq CollectItem)
      (Either QErr (HashMap (TableName b) (TableInfo b))))
-&gt; ExceptT
     QErr
     (WriterT (Seq CollectItem) Identity)
     (HashMap (TableName b) (TableInfo b))
-&gt; Writer
     (Seq CollectItem)
     (Either QErr (HashMap (TableName b) (TableInfo b)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap
  (TableName b)
  ((TableCoreInfo b, TablePermissionInputs b), EventTriggerInfoMap b)
-&gt; (((TableCoreInfo b, TablePermissionInputs b),
     EventTriggerInfoMap b)
    -&gt; ExceptT QErr (WriterT (Seq CollectItem) Identity) (TableInfo b))
-&gt; ExceptT
     QErr
     (WriterT (Seq CollectItem) Identity)
     (HashMap (TableName b) (TableInfo b))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span>
</span><span id="line-818"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap (TableName b) (TableCoreInfo b)
</span><a href="#local-6989586621687412764"><span class="hs-identifier hs-var">tableCoreInfos</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (TableName b) (TableCoreInfo b)
-&gt; HashMap (TableName b) (TablePermissionInputs b)
-&gt; HashMap (TableName b) (TableCoreInfo b, TablePermissionInputs b)
forall a c.
HashMap (TableName b) a
-&gt; HashMap (TableName b) c -&gt; HashMap (TableName b) (a, c)
</span><a href="#local-6989586621687412757"><span class="hs-operator hs-var">`alignTableMap`</span></a></span><span> </span><span class="annot"><span class="annottext">(TablePermissionInputs b -&gt; TableName b)
-&gt; [TablePermissionInputs b]
-&gt; HashMap (TableName b) (TablePermissionInputs b)
forall k a. Hashable k =&gt; (a -&gt; k) -&gt; [a] -&gt; HashMap k a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#mapFromL"><span class="hs-identifier hs-var">mapFromL</span></a></span><span> </span><span class="annot"><span class="annottext">TablePermissionInputs b -&gt; TableName b
forall (b :: BackendType). TablePermissionInputs b -&gt; TableName b
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_tpiTable"><span class="hs-identifier hs-var">_tpiTable</span></a></span><span> </span><span class="annot"><span class="annottext">[TablePermissionInputs b]
</span><a href="#local-6989586621687412754"><span class="hs-identifier hs-var">permissions</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (TableName b) (TableCoreInfo b, TablePermissionInputs b)
-&gt; HashMap (TableName b) (EventTriggerInfoMap b)
-&gt; HashMap
     (TableName b)
     ((TableCoreInfo b, TablePermissionInputs b), EventTriggerInfoMap b)
forall a c.
HashMap (TableName b) a
-&gt; HashMap (TableName b) c -&gt; HashMap (TableName b) (a, c)
</span><a href="#local-6989586621687412757"><span class="hs-operator hs-var">`alignTableMap`</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (TableName b) (EventTriggerInfoMap b)
</span><a href="#local-6989586621687412732"><span class="hs-identifier hs-var">eventTriggerInfoMaps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-819"></span><span>              </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621687412775"><span class="annot"><span class="annottext">TableCoreInfo b
</span><a href="#local-6989586621687412775"><span class="hs-identifier hs-var">tableCoreInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412776"><span class="annot"><span class="annottext">TablePermissionInputs b
</span><a href="#local-6989586621687412776"><span class="hs-identifier hs-var">permissionInputs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412777"><span class="annot"><span class="annottext">EventTriggerInfoMap b
</span><a href="#local-6989586621687412777"><span class="hs-identifier hs-var">eventTriggerInfos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-820"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687412778"><span class="annot"><span class="annottext">tableFields :: FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621687412778"><span class="hs-identifier hs-var hs-var">tableFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TableCoreInfo b -&gt; FieldInfoMap (FieldInfo b)
forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn -&gt; FieldInfoMap field
</span><a href="Hasura.Table.Cache.html#_tciFieldInfoMap"><span class="hs-identifier hs-var">_tciFieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfo b
</span><a href="#local-6989586621687412775"><span class="hs-identifier hs-var">tableCoreInfo</span></a></span><span>
</span><span id="line-821"></span><span>                </span><span id="local-6989586621687412779"><span class="annot"><span class="annottext">RolePermInfoMap b
</span><a href="#local-6989586621687412779"><span class="hs-identifier hs-var">permissionInfos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-822"></span><span>                  </span><span class="annot"><span class="annottext">(ReaderT
   (SourceConfig b)
   (ExceptT QErr (WriterT (Seq CollectItem) Identity))
   (RolePermInfoMap b)
 -&gt; SourceConfig b
 -&gt; ExceptT
      QErr (WriterT (Seq CollectItem) Identity) (RolePermInfoMap b))
-&gt; SourceConfig b
-&gt; ReaderT
     (SourceConfig b)
     (ExceptT QErr (WriterT (Seq CollectItem) Identity))
     (RolePermInfoMap b)
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) (RolePermInfoMap b)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ReaderT
  (SourceConfig b)
  (ExceptT QErr (WriterT (Seq CollectItem) Identity))
  (RolePermInfoMap b)
-&gt; SourceConfig b
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) (RolePermInfoMap b)
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687412730"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span>
</span><span id="line-823"></span><span>                    </span><span class="annot"><span class="annottext">(ReaderT
   (SourceConfig b)
   (ExceptT QErr (WriterT (Seq CollectItem) Identity))
   (RolePermInfoMap b)
 -&gt; ExceptT
      QErr (WriterT (Seq CollectItem) Identity) (RolePermInfoMap b))
-&gt; ReaderT
     (SourceConfig b)
     (ExceptT QErr (WriterT (Seq CollectItem) Identity))
     (RolePermInfoMap b)
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) (RolePermInfoMap b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Environment
-&gt; SourceName
-&gt; HashMap (TableName b) (TableCoreInfo b)
-&gt; FieldInfoMap (FieldInfo b)
-&gt; TablePermissionInputs b
-&gt; OrderedRoles
-&gt; ReaderT
     (SourceConfig b)
     (ExceptT QErr (WriterT (Seq CollectItem) Identity))
     (RolePermInfoMap b)
forall (b :: BackendType) (m :: * -&gt; *) r.
(MonadError QErr m, MonadWriter (Seq CollectItem) m,
 BackendMetadata b, GetAggregationPredicatesDeps b, MonadReader r m,
 Has (ScalarTypeParsingContext b) r) =&gt;
Environment
-&gt; SourceName
-&gt; TableCoreCache b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; TablePermissionInputs b
-&gt; OrderedRoles
-&gt; m (RolePermInfoMap b)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Permission.html#buildTablePermissions"><span class="hs-identifier hs-var">buildTablePermissions</span></a></span><span>
</span><span id="line-824"></span><span>                      </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621687411809"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-825"></span><span>                      </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412742"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-826"></span><span>                      </span><span class="annot"><span class="annottext">HashMap (TableName b) (TableCoreInfo b)
</span><a href="#local-6989586621687412764"><span class="hs-identifier hs-var">tableCoreInfos</span></a></span><span>
</span><span id="line-827"></span><span>                      </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621687412778"><span class="hs-identifier hs-var">tableFields</span></a></span><span>
</span><span id="line-828"></span><span>                      </span><span class="annot"><span class="annottext">TablePermissionInputs b
</span><a href="#local-6989586621687412776"><span class="hs-identifier hs-var">permissionInputs</span></a></span><span>
</span><span id="line-829"></span><span>                      </span><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621687412735"><span class="hs-identifier hs-var">orderedRoles</span></a></span><span>
</span><span id="line-830"></span><span>                </span><span class="annot"><span class="annottext">TableInfo b
-&gt; ExceptT QErr (WriterT (Seq CollectItem) Identity) (TableInfo b)
forall a. a -&gt; ExceptT QErr (WriterT (Seq CollectItem) Identity) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TableInfo b
 -&gt; ExceptT QErr (WriterT (Seq CollectItem) Identity) (TableInfo b))
-&gt; TableInfo b
-&gt; ExceptT QErr (WriterT (Seq CollectItem) Identity) (TableInfo b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TableCoreInfo b
-&gt; RolePermInfoMap b
-&gt; EventTriggerInfoMap b
-&gt; RolePermInfo b
-&gt; TableInfo b
forall (b :: BackendType).
TableCoreInfo b
-&gt; RolePermInfoMap b
-&gt; EventTriggerInfoMap b
-&gt; RolePermInfo b
-&gt; TableInfo b
</span><a href="Hasura.Table.Cache.html#TableInfo"><span class="hs-identifier hs-var">TableInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfo b
</span><a href="#local-6989586621687412775"><span class="hs-identifier hs-var">tableCoreInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RolePermInfoMap b
</span><a href="#local-6989586621687412779"><span class="hs-identifier hs-var">permissionInfos</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerInfoMap b
</span><a href="#local-6989586621687412777"><span class="hs-identifier hs-var">eventTriggerInfos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableCoreInfo b -&gt; RolePermInfo b
forall (b :: BackendType).
Backend b =&gt;
TableCoreInfo b -&gt; RolePermInfo b
</span><a href="Hasura.Table.Cache.html#mkAdminRolePermInfo"><span class="hs-identifier hs-var">mkAdminRolePermInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfo b
</span><a href="#local-6989586621687412775"><span class="hs-identifier hs-var">tableCoreInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-831"></span><span>      </span><span class="hs-comment">-- Generate a non-recoverable error when inherited roles were not ordered in a way that allows for building permissions to succeed</span><span>
</span><span id="line-832"></span><span>      </span><span id="local-6989586621687412783"><span class="annot"><span class="annottext">HashMap (TableName b) (TableInfo b)
</span><a href="#local-6989586621687412783"><span class="hs-identifier hs-var">tableCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr
  (m (HashMap (TableName b) (TableInfo b)))
  (HashMap (TableName b) (TableInfo b))
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html#bindA"><span class="hs-identifier hs-var">bindA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Either QErr (HashMap (TableName b) (TableInfo b))
-&gt; m (HashMap (TableName b) (TableInfo b))
forall e (m :: * -&gt; *) a. MonadError e m =&gt; Either e a -&gt; m a
</span><span class="hs-identifier hs-var">liftEither</span></span><span> </span><span class="annot"><span class="annottext">Either QErr (HashMap (TableName b) (TableInfo b))
</span><a href="#local-6989586621687412773"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-833"></span><span>
</span><span id="line-834"></span><span>      </span><span class="hs-comment">-- not forcing the evaluation here results in a measurable negative impact</span><span>
</span><span id="line-835"></span><span>      </span><span class="hs-comment">-- on memory residency as measured by our benchmark</span><span>
</span><span id="line-836"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621687412784"><span class="annot"><span class="annottext">defaultNC :: NamingCase
</span><a href="#local-6989586621687412784"><span class="hs-identifier hs-var hs-var">defaultNC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig -&gt; NamingCase
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cdcDefaultNamingConvention"><span class="hs-identifier hs-var">_cdcDefaultNamingConvention</span></a></span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687412727"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span>
</span><span id="line-837"></span><span>          </span><span class="hs-glyph">!</span><span id="local-6989586621687412786"><span class="annot"><span class="annottext">isNamingConventionEnabled :: Bool
</span><a href="#local-6989586621687412786"><span class="hs-identifier hs-var hs-var">isNamingConventionEnabled</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExperimentalFeature
</span><a href="Hasura.Server.Types.html#EFNamingConventions"><span class="hs-identifier hs-var">EFNamingConventions</span></a></span><span> </span><span class="annot"><span class="annottext">ExperimentalFeature -&gt; HashSet ExperimentalFeature -&gt; Bool
forall a. Eq a =&gt; a -&gt; HashSet a -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CacheDynamicConfig -&gt; HashSet ExperimentalFeature
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cdcExperimentalFeatures"><span class="hs-identifier hs-var">_cdcExperimentalFeatures</span></a></span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687412727"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-838"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621687412788"><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621687412788"><span class="hs-identifier hs-var">namingConv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-839"></span><span>        </span><span class="annot"><span class="annottext">arr (m NamingCase) NamingCase
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html#bindA"><span class="hs-identifier hs-var">bindA</span></a></span><span>
</span><span id="line-840"></span><span>          </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-841"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687412786"><span class="hs-identifier hs-var">isNamingConventionEnabled</span></a></span><span>
</span><span id="line-842"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SourceCustomization
-&gt; SupportedNamingCase -&gt; NamingCase -&gt; m NamingCase
forall (m :: * -&gt; *).
MonadError QErr m =&gt;
SourceCustomization
-&gt; SupportedNamingCase -&gt; NamingCase -&gt; m NamingCase
</span><a href="Hasura.RQL.Types.SourceCustomization.html#getNamingCase"><span class="hs-identifier hs-var">getNamingCase</span></a></span><span> </span><span class="annot"><span class="annottext">SourceCustomization
</span><a href="#local-6989586621687412750"><span class="hs-identifier hs-var">sourceCustomization</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType). Backend b =&gt; SupportedNamingCase
</span><a href="Hasura.RQL.Types.Backend.html#namingConventionSupport"><span class="hs-identifier hs-var">namingConventionSupport</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621687412784"><span class="hs-identifier hs-var">defaultNC</span></a></span><span>
</span><span id="line-843"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">NamingCase -&gt; m NamingCase
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">NamingCase
</span><a href="Hasura.RQL.Types.NamingCase.html#HasuraCase"><span class="hs-identifier hs-var">HasuraCase</span></a></span><span>
</span><span id="line-844"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687412792"><span class="annot"><span class="annottext">resolvedCustomization :: ResolvedSourceCustomization
</span><a href="#local-6989586621687412792"><span class="hs-identifier hs-var hs-var">resolvedCustomization</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceCustomization -&gt; NamingCase -&gt; ResolvedSourceCustomization
</span><a href="Hasura.RQL.Types.SourceCustomization.html#mkResolvedSourceCustomization"><span class="hs-identifier hs-var">mkResolvedSourceCustomization</span></a></span><span> </span><span class="annot"><span class="annottext">SourceCustomization
</span><a href="#local-6989586621687412750"><span class="hs-identifier hs-var">sourceCustomization</span></a></span><span> </span><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621687412788"><span class="hs-identifier hs-var">namingConv</span></a></span><span>
</span><span id="line-845"></span><span>
</span><span id="line-846"></span><span>      </span><span class="hs-comment">-- sql functions</span><span>
</span><span id="line-847"></span><span>      </span><span id="local-6989586621687412794"><span class="annot"><span class="annottext">[Maybe (FunctionInfo b)]
</span><a href="#local-6989586621687412794"><span class="hs-identifier hs-var">functionCacheMaybes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-848"></span><span>        </span><span class="annot"><span class="annottext">arr
  (Writer (Seq CollectItem) [Maybe (FunctionInfo b)])
  [Maybe (FunctionInfo b)]
forall w (arr :: * -&gt; * -&gt; *) a.
ArrowWriter w arr =&gt;
arr (Writer w a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Interpret.html#interpretWriter"><span class="hs-identifier hs-var">interpretWriter</span></a></span><span>
</span><span id="line-849"></span><span>          </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">[FunctionMetadata b]
-&gt; (FunctionMetadata b
    -&gt; WriterT (Seq CollectItem) Identity (Maybe (FunctionInfo b)))
-&gt; Writer (Seq CollectItem) [Maybe (FunctionInfo b)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span>
</span><span id="line-850"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Functions b -&gt; [FunctionMetadata b]
forall k v. InsOrdHashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#elems"><span class="hs-identifier hs-var">InsOrdHashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">Functions b
</span><a href="#local-6989586621687412745"><span class="hs-identifier hs-var">functions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-851"></span><span>            </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-852"></span><span>              </span><span class="annot"><a href="Hasura.Function.Metadata.html#FunctionMetadata"><span class="hs-identifier hs-type">FunctionMetadata</span></a></span><span> </span><span id="local-6989586621687412796"><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621687412796"><span class="hs-identifier hs-var">qf</span></a></span></span><span> </span><span id="local-6989586621687412797"><span class="annot"><span class="annottext">FunctionConfig b
</span><a href="#local-6989586621687412797"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621687412798"><span class="annot"><span class="annottext">[FunctionPermissionInfo]
</span><a href="#local-6989586621687412798"><span class="hs-identifier hs-var">functionPermissions</span></a></span></span><span> </span><span id="local-6989586621687412799"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687412799"><span class="hs-identifier hs-var">comment</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-853"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687412800"><span class="annot"><span class="annottext">systemDefined :: SystemDefined
</span><a href="#local-6989586621687412800"><span class="hs-identifier hs-var hs-var">systemDefined</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SystemDefined
</span><a href="Hasura.RQL.Types.Common.html#SystemDefined"><span class="hs-identifier hs-var">SystemDefined</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-854"></span><span>                    </span><span id="local-6989586621687412802"><span class="annot"><span class="annottext">definition :: TrackFunction b
</span><a href="#local-6989586621687412802"><span class="hs-identifier hs-var hs-var">definition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). FunctionName b -&gt; TrackFunction b
</span><a href="Hasura.Function.API.html#TrackFunction"><span class="hs-identifier hs-var">TrackFunction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621687412796"><span class="hs-identifier hs-var">qf</span></a></span><span>
</span><span id="line-855"></span><span>                    </span><span id="local-6989586621687412804"><span class="annot"><span class="annottext">metadataObject :: MetadataObject
</span><a href="#local-6989586621687412804"><span class="hs-identifier hs-var hs-var">metadataObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-856"></span><span>                      </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span>
</span><span id="line-857"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceMetadataObjId -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOSourceObjId"><span class="hs-identifier hs-var">MOSourceObjId</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412742"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-858"></span><span>                            </span><span class="annot"><span class="annottext">(AnyBackend SourceMetadataObjId -&gt; MetadataObjId)
-&gt; AnyBackend SourceMetadataObjId -&gt; MetadataObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span>
</span><span id="line-859"></span><span>                            </span><span class="annot"><span class="annottext">(SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId)
-&gt; SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). FunctionName b -&gt; SourceMetadataObjId b
</span><a href="Hasura.RQL.Types.Metadata.Object.html#SMOFunction"><span class="hs-identifier hs-var">SMOFunction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621687412796"><span class="hs-identifier hs-var">qf</span></a></span><span>
</span><span id="line-860"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-861"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TrackFunction b -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">TrackFunction b
</span><a href="#local-6989586621687412802"><span class="hs-identifier hs-var">definition</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-862"></span><span>                    </span><span id="local-6989586621687412808"><span class="annot"><span class="annottext">schemaObject :: SchemaObjId
</span><a href="#local-6989586621687412808"><span class="hs-identifier hs-var hs-var">schemaObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-863"></span><span>                      </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceObjId -&gt; SchemaObjId
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SOSourceObj"><span class="hs-identifier hs-var">SOSourceObj</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412742"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-864"></span><span>                        </span><span class="annot"><span class="annottext">(AnyBackend SourceObjId -&gt; SchemaObjId)
-&gt; AnyBackend SourceObjId -&gt; SchemaObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceObjId b -&gt; AnyBackend SourceObjId
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span>
</span><span id="line-865"></span><span>                        </span><span class="annot"><span class="annottext">(SourceObjId b -&gt; AnyBackend SourceObjId)
-&gt; SourceObjId b -&gt; AnyBackend SourceObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). FunctionName b -&gt; SourceObjId b
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SOIFunction"><span class="hs-identifier hs-var">SOIFunction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621687412796"><span class="hs-identifier hs-var">qf</span></a></span><span>
</span><span id="line-866"></span><span>                    </span><span id="local-6989586621687412811"><span class="annot"><span class="annottext">addFunctionContext :: Text -&gt; Text
</span><a href="#local-6989586621687412811"><span class="hs-identifier hs-var hs-var">addFunctionContext</span></a></span></span><span> </span><span id="local-6989586621687412812"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687412812"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;in function &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621687412796"><span class="hs-identifier hs-var">qf</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687412812"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-867"></span><span>                    </span><span id="local-6989586621687412814"><span class="annot"><span class="annottext">metadataPermissions :: HashMap RoleName FunctionPermissionInfo
</span><a href="#local-6989586621687412814"><span class="hs-identifier hs-var hs-var">metadataPermissions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FunctionPermissionInfo -&gt; RoleName)
-&gt; [FunctionPermissionInfo]
-&gt; HashMap RoleName FunctionPermissionInfo
forall k a. Hashable k =&gt; (a -&gt; k) -&gt; [a] -&gt; HashMap k a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#mapFromL"><span class="hs-identifier hs-var">mapFromL</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionPermissionInfo -&gt; RoleName
</span><a href="Hasura.Function.Cache.html#_fpmRole"><span class="hs-identifier hs-var">_fpmRole</span></a></span><span> </span><span class="annot"><span class="annottext">[FunctionPermissionInfo]
</span><a href="#local-6989586621687412798"><span class="hs-identifier hs-var">functionPermissions</span></a></span><span>
</span><span id="line-868"></span><span>                    </span><span id="local-6989586621687412816"><span class="annot"><span class="annottext">permissionsMap :: HashMap RoleName FunctionPermissionInfo
</span><a href="#local-6989586621687412816"><span class="hs-identifier hs-var hs-var">permissionsMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RoleName -&gt; FunctionPermissionInfo)
-&gt; HashMap RoleName FunctionPermissionInfo
-&gt; OrderedRoles
-&gt; HashMap RoleName FunctionPermissionInfo
forall a.
(RoleName -&gt; a)
-&gt; HashMap RoleName a -&gt; OrderedRoles -&gt; HashMap RoleName a
</span><a href="Hasura.RQL.DDL.Schema.Cache.Permission.html#mkBooleanPermissionMap"><span class="hs-identifier hs-var">mkBooleanPermissionMap</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName -&gt; FunctionPermissionInfo
</span><a href="Hasura.Function.Cache.html#FunctionPermissionInfo"><span class="hs-identifier hs-var">FunctionPermissionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap RoleName FunctionPermissionInfo
</span><a href="#local-6989586621687412814"><span class="hs-identifier hs-var">metadataPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621687412735"><span class="hs-identifier hs-var">orderedRoles</span></a></span><span>
</span><span id="line-869"></span><span>                </span><span class="annot"><span class="annottext">MetadataObject
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) (FunctionInfo b)
-&gt; WriterT (Seq CollectItem) Identity (Maybe (FunctionInfo b))
forall (m :: * -&gt; *) a.
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687412804"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT QErr (WriterT (Seq CollectItem) Identity) (FunctionInfo b)
 -&gt; WriterT (Seq CollectItem) Identity (Maybe (FunctionInfo b)))
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) (FunctionInfo b)
-&gt; WriterT (Seq CollectItem) Identity (Maybe (FunctionInfo b))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text)
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) (FunctionInfo b)
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) (FunctionInfo b)
forall (m :: * -&gt; *) a. QErrM m =&gt; (Text -&gt; Text) -&gt; m a -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#modifyErr"><span class="hs-identifier hs-var">modifyErr</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621687412811"><span class="hs-identifier hs-var">addFunctionContext</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-870"></span><span>                  </span><span id="local-6989586621687412820"><span class="annot"><span class="annottext">FunctionOverloads b
</span><a href="#local-6989586621687412820"><span class="hs-identifier hs-var">funcDefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-871"></span><span>                    </span><span class="annot"><span class="annottext">Maybe (FunctionOverloads b)
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) (FunctionOverloads b)
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) (FunctionOverloads b)
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#onNothing"><span class="hs-identifier hs-var">onNothing</span></a></span><span>
</span><span id="line-872"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunctionName b
-&gt; DBFunctionsMetadata b -&gt; Maybe (FunctionOverloads b)
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#lookup"><span class="hs-identifier hs-var">HashMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621687412796"><span class="hs-identifier hs-var">qf</span></a></span><span> </span><span class="annot"><span class="annottext">DBFunctionsMetadata b
</span><a href="#local-6989586621687412738"><span class="hs-identifier hs-var">dbFunctions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-873"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Code
-&gt; Text
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) (FunctionOverloads b)
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#NotExists"><span class="hs-identifier hs-var">NotExists</span></a></span><span> </span><span class="annot"><span class="annottext">(Text
 -&gt; ExceptT
      QErr (WriterT (Seq CollectItem) Identity) (FunctionOverloads b))
-&gt; Text
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) (FunctionOverloads b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;no such function exists: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FunctionName b -&gt; Text
forall t. ToTxt t =&gt; Text -&gt; t -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#%3C%3E%3E"><span class="hs-operator hs-var">&lt;&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621687412796"><span class="hs-identifier hs-var">qf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-874"></span><span>
</span><span id="line-875"></span><span>                  </span><span id="local-6989586621687412825"><span class="annot"><span class="annottext">RawFunctionInfo b
</span><a href="#local-6989586621687412825"><span class="hs-identifier hs-var">rawfunctionInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(QErrM m, Backend b) =&gt;
FunctionName b -&gt; FunctionOverloads b -&gt; m (RawFunctionInfo b)
</span><a href="Hasura.Function.API.html#getSingleUniqueFunctionOverload"><span class="hs-identifier hs-var">getSingleUniqueFunctionOverload</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621687412796"><span class="hs-identifier hs-var">qf</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionOverloads b
</span><a href="#local-6989586621687412820"><span class="hs-identifier hs-var">funcDefs</span></a></span><span>
</span><span id="line-876"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621687412827"><span class="annot"><span class="annottext">FunctionInfo b
</span><a href="#local-6989586621687412827"><span class="hs-identifier hs-var">functionInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412828"><span class="annot"><span class="annottext">SchemaDependency
</span><a href="#local-6989586621687412828"><span class="hs-identifier hs-var">dep</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SourceName
-&gt; FunctionName b
-&gt; SystemDefined
-&gt; FunctionConfig b
-&gt; HashMap RoleName FunctionPermissionInfo
-&gt; RawFunctionInfo b
-&gt; Maybe Text
-&gt; NamingCase
-&gt; ExceptT
     QErr
     (WriterT (Seq CollectItem) Identity)
     (FunctionInfo b, SchemaDependency)
forall (b :: BackendType) (m :: * -&gt; *).
(BackendMetadata b, MonadError QErr m) =&gt;
SourceName
-&gt; FunctionName b
-&gt; SystemDefined
-&gt; FunctionConfig b
-&gt; HashMap RoleName FunctionPermissionInfo
-&gt; RawFunctionInfo b
-&gt; Maybe Text
-&gt; NamingCase
-&gt; m (FunctionInfo b, SchemaDependency)
forall (m :: * -&gt; *).
MonadError QErr m =&gt;
SourceName
-&gt; FunctionName b
-&gt; SystemDefined
-&gt; FunctionConfig b
-&gt; HashMap RoleName FunctionPermissionInfo
-&gt; RawFunctionInfo b
-&gt; Maybe Text
-&gt; NamingCase
-&gt; m (FunctionInfo b, SchemaDependency)
</span><a href="Hasura.RQL.Types.Metadata.Backend.html#buildFunctionInfo"><span class="hs-identifier hs-var">buildFunctionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412742"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621687412796"><span class="hs-identifier hs-var">qf</span></a></span><span> </span><span class="annot"><span class="annottext">SystemDefined
</span><a href="#local-6989586621687412800"><span class="hs-identifier hs-var">systemDefined</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionConfig b
</span><a href="#local-6989586621687412797"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap RoleName FunctionPermissionInfo
</span><a href="#local-6989586621687412816"><span class="hs-identifier hs-var">permissionsMap</span></a></span><span> </span><span class="annot"><span class="annottext">RawFunctionInfo b
</span><a href="#local-6989586621687412825"><span class="hs-identifier hs-var">rawfunctionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687412799"><span class="hs-identifier hs-var">comment</span></a></span><span> </span><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621687412788"><span class="hs-identifier hs-var">namingConv</span></a></span><span>
</span><span id="line-877"></span><span>                  </span><span class="annot"><span class="annottext">MetadataObject
-&gt; SchemaObjId
-&gt; Seq SchemaDependency
-&gt; ExceptT QErr (WriterT (Seq CollectItem) Identity) ()
forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; SchemaObjId -&gt; Seq SchemaDependency -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordDependenciesM"><span class="hs-identifier hs-var">recordDependenciesM</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687412804"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaObjId
</span><a href="#local-6989586621687412808"><span class="hs-identifier hs-var">schemaObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaDependency -&gt; Seq SchemaDependency
forall a. a -&gt; Seq a
</span><span class="hs-identifier hs-var">Seq.singleton</span></span><span> </span><span class="annot"><span class="annottext">SchemaDependency
</span><a href="#local-6989586621687412828"><span class="hs-identifier hs-var">dep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-878"></span><span>                  </span><span class="annot"><span class="annottext">FunctionInfo b
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) (FunctionInfo b)
forall a. a -&gt; ExceptT QErr (WriterT (Seq CollectItem) Identity) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">FunctionInfo b
</span><a href="#local-6989586621687412827"><span class="hs-identifier hs-var">functionInfo</span></a></span><span>
</span><span id="line-879"></span><span>
</span><span id="line-880"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687412832"><span class="annot"><span class="annottext">functionCache :: HashMap (FunctionName b) (FunctionInfo b)
</span><a href="#local-6989586621687412832"><span class="hs-identifier hs-var hs-var">functionCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FunctionInfo b -&gt; FunctionName b)
-&gt; [FunctionInfo b] -&gt; HashMap (FunctionName b) (FunctionInfo b)
forall k a. Hashable k =&gt; (a -&gt; k) -&gt; [a] -&gt; HashMap k a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#mapFromL"><span class="hs-identifier hs-var">mapFromL</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionInfo b -&gt; FunctionName b
forall (b :: BackendType). FunctionInfo b -&gt; FunctionName b
</span><a href="Hasura.Function.Cache.html#_fiSQLName"><span class="hs-identifier hs-var">_fiSQLName</span></a></span><span> </span><span class="annot"><span class="annottext">([FunctionInfo b] -&gt; HashMap (FunctionName b) (FunctionInfo b))
-&gt; [FunctionInfo b] -&gt; HashMap (FunctionName b) (FunctionInfo b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Maybe (FunctionInfo b)] -&gt; [FunctionInfo b]
forall a. [Maybe a] -&gt; [a]
forall (f :: * -&gt; *) a. Filterable f =&gt; f (Maybe a) -&gt; f a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/witherable-0.4.2-a40f3f0a2ed7f25145b5b00589bf4ea2486662b1e96b7d29d5e6041625ee4a09/share/doc/html/src/Witherable.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe (FunctionInfo b)]
</span><a href="#local-6989586621687412794"><span class="hs-identifier hs-var">functionCacheMaybes</span></a></span><span>
</span><span id="line-881"></span><span>
</span><span id="line-882"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621687412834"><span class="hs-identifier hs-type">mkLogicalModelMetadataObject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.LogicalModel.Metadata.html#LogicalModelMetadata"><span class="hs-identifier hs-type">LogicalModelMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span><span>
</span><span id="line-883"></span><span>          </span><span id="local-6989586621687412834"><span class="annot"><span class="annottext">mkLogicalModelMetadataObject :: LogicalModelMetadata b -&gt; MetadataObject
</span><a href="#local-6989586621687412834"><span class="hs-identifier hs-var hs-var">mkLogicalModelMetadataObject</span></a></span></span><span> </span><span id="local-6989586621687412835"><span class="annot"><span class="annottext">LogicalModelMetadata b
</span><a href="#local-6989586621687412835"><span class="hs-identifier hs-var">lmm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-884"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span>
</span><span id="line-885"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceMetadataObjId -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOSourceObjId"><span class="hs-identifier hs-var">MOSourceObjId</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412742"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-886"></span><span>                    </span><span class="annot"><span class="annottext">(AnyBackend SourceMetadataObjId -&gt; MetadataObjId)
-&gt; AnyBackend SourceMetadataObjId -&gt; MetadataObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span>
</span><span id="line-887"></span><span>                    </span><span class="annot"><span class="annottext">(SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId)
-&gt; SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
LogicalModelName -&gt; SourceMetadataObjId b
</span><a href="Hasura.RQL.Types.Metadata.Object.html#SMOLogicalModel"><span class="hs-identifier hs-var">SMOLogicalModel</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LogicalModelMetadata b -&gt; LogicalModelName
forall (b :: BackendType).
LogicalModelMetadata b -&gt; LogicalModelName
</span><a href="Hasura.LogicalModel.Metadata.html#_lmmName"><span class="hs-identifier hs-var">_lmmName</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelMetadata b
</span><a href="#local-6989586621687412835"><span class="hs-identifier hs-var">lmm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-888"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-889"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LogicalModelMetadata b -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelMetadata b
</span><a href="#local-6989586621687412835"><span class="hs-identifier hs-var">lmm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-890"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-891"></span><span>
</span><span id="line-892"></span><span>      </span><span class="hs-comment">-- fetch static config</span><span>
</span><span id="line-893"></span><span>      </span><span id="local-6989586621687412838"><span class="annot"><span class="annottext">CacheStaticConfig
</span><a href="#local-6989586621687412838"><span class="hs-identifier hs-var">cacheStaticConfig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr (m CacheStaticConfig) CacheStaticConfig
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html#bindA"><span class="hs-identifier hs-var">bindA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">m CacheStaticConfig
forall (m :: * -&gt; *). HasCacheStaticConfig m =&gt; m CacheStaticConfig
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#askCacheStaticConfig"><span class="hs-identifier hs-var">askCacheStaticConfig</span></a></span><span>
</span><span id="line-894"></span><span>
</span><span id="line-895"></span><span>      </span><span class="hs-comment">-- Combine logical models that come from DB schema introspection with logical models</span><span>
</span><span id="line-896"></span><span>      </span><span class="hs-comment">-- provided via metadata. If two logical models have the same name the one from metadata is preferred.</span><span>
</span><span id="line-897"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687412839"><span class="annot"><span class="annottext">unifiedLogicalModels :: LogicalModels b
</span><a href="#local-6989586621687412839"><span class="hs-identifier hs-var hs-var">unifiedLogicalModels</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogicalModels b
</span><a href="#local-6989586621687412748"><span class="hs-identifier hs-var">logicalModels</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModels b -&gt; LogicalModels b -&gt; LogicalModels b
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">LogicalModels b
</span><a href="#local-6989586621687412740"><span class="hs-identifier hs-var">introspectedLogicalModels</span></a></span><span>
</span><span id="line-898"></span><span>
</span><span id="line-899"></span><span>      </span><span id="local-6989586621687412840"><span class="annot"><span class="annottext">[Maybe (LogicalModelInfo b)]
</span><a href="#local-6989586621687412840"><span class="hs-identifier hs-var">logicalModelCacheMaybes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-900"></span><span>        </span><span class="annot"><span class="annottext">arr
  (Writer (Seq CollectItem) [Maybe (LogicalModelInfo b)])
  [Maybe (LogicalModelInfo b)]
forall w (arr :: * -&gt; * -&gt; *) a.
ArrowWriter w arr =&gt;
arr (Writer w a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Interpret.html#interpretWriter"><span class="hs-identifier hs-var">interpretWriter</span></a></span><span>
</span><span id="line-901"></span><span>          </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">[LogicalModelMetadata b]
-&gt; (LogicalModelMetadata b
    -&gt; WriterT (Seq CollectItem) Identity (Maybe (LogicalModelInfo b)))
-&gt; Writer (Seq CollectItem) [Maybe (LogicalModelInfo b)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span>
</span><span id="line-902"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LogicalModels b -&gt; [LogicalModelMetadata b]
forall k v. InsOrdHashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#elems"><span class="hs-identifier hs-var">InsOrdHashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModels b
</span><a href="#local-6989586621687412839"><span class="hs-identifier hs-var">unifiedLogicalModels</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-903"></span><span>            </span><span class="hs-glyph">\</span><span id="local-6989586621687412841"><span class="annot"><span class="annottext">lmm :: LogicalModelMetadata b
</span><a href="#local-6989586621687412841"><span class="hs-identifier hs-var">lmm</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.LogicalModel.Metadata.html#LogicalModelMetadata"><span class="hs-identifier hs-type">LogicalModelMetadata</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687412843"><span id="local-6989586621687412844"><span id="local-6989586621687412845"><span id="local-6989586621687412846"><span class="annot"><span class="annottext">Maybe Text
InsOrdHashMap RoleName (SelPermDef b)
InsOrdHashMap (Column b) (LogicalModelField b)
LogicalModelName
_lmmName :: forall (b :: BackendType).
LogicalModelMetadata b -&gt; LogicalModelName
_lmmName :: LogicalModelName
_lmmFields :: InsOrdHashMap (Column b) (LogicalModelField b)
_lmmDescription :: Maybe Text
_lmmSelectPermissions :: InsOrdHashMap RoleName (SelPermDef b)
_lmmFields :: forall (b :: BackendType).
LogicalModelMetadata b
-&gt; InsOrdHashMap (Column b) (LogicalModelField b)
_lmmDescription :: forall (b :: BackendType). LogicalModelMetadata b -&gt; Maybe Text
_lmmSelectPermissions :: forall (b :: BackendType).
LogicalModelMetadata b -&gt; InsOrdHashMap RoleName (SelPermDef b)
</span><a href="Hasura.LogicalModel.Metadata.html#_lmmName"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-904"></span><span>              </span><span class="annot"><span class="annottext">MetadataObject
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) (LogicalModelInfo b)
-&gt; WriterT (Seq CollectItem) Identity (Maybe (LogicalModelInfo b))
forall (m :: * -&gt; *) a.
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LogicalModelMetadata b -&gt; MetadataObject
</span><a href="#local-6989586621687412834"><span class="hs-identifier hs-var">mkLogicalModelMetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelMetadata b
</span><a href="#local-6989586621687412841"><span class="hs-identifier hs-var">lmm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT
   QErr (WriterT (Seq CollectItem) Identity) (LogicalModelInfo b)
 -&gt; WriterT (Seq CollectItem) Identity (Maybe (LogicalModelInfo b)))
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) (LogicalModelInfo b)
-&gt; WriterT (Seq CollectItem) Identity (Maybe (LogicalModelInfo b))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-905"></span><span>                </span><span id="local-6989586621687412850"><span class="annot"><span class="annottext">RolePermInfoMap b
</span><a href="#local-6989586621687412850"><span class="hs-identifier hs-var">logicalModelPermissions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-906"></span><span>                  </span><span class="annot"><span class="annottext">(ReaderT
   (SourceConfig b)
   (ExceptT QErr (WriterT (Seq CollectItem) Identity))
   (RolePermInfoMap b)
 -&gt; SourceConfig b
 -&gt; ExceptT
      QErr (WriterT (Seq CollectItem) Identity) (RolePermInfoMap b))
-&gt; SourceConfig b
-&gt; ReaderT
     (SourceConfig b)
     (ExceptT QErr (WriterT (Seq CollectItem) Identity))
     (RolePermInfoMap b)
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) (RolePermInfoMap b)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ReaderT
  (SourceConfig b)
  (ExceptT QErr (WriterT (Seq CollectItem) Identity))
  (RolePermInfoMap b)
-&gt; SourceConfig b
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) (RolePermInfoMap b)
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687412730"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT
   (SourceConfig b)
   (ExceptT QErr (WriterT (Seq CollectItem) Identity))
   (RolePermInfoMap b)
 -&gt; ExceptT
      QErr (WriterT (Seq CollectItem) Identity) (RolePermInfoMap b))
-&gt; ReaderT
     (SourceConfig b)
     (ExceptT QErr (WriterT (Seq CollectItem) Identity))
     (RolePermInfoMap b)
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) (RolePermInfoMap b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceName
-&gt; HashMap (TableName b) (TableCoreInfo b)
-&gt; LogicalModelName
-&gt; InsOrdHashMap (Column b) (LogicalModelField b)
-&gt; InsOrdHashMap RoleName (SelPermDef b)
-&gt; OrderedRoles
-&gt; ReaderT
     (SourceConfig b)
     (ExceptT QErr (WriterT (Seq CollectItem) Identity))
     (RolePermInfoMap b)
forall (b :: BackendType) (m :: * -&gt; *) r.
(MonadError QErr m, MonadWriter (Seq CollectItem) m,
 BackendMetadata b, GetAggregationPredicatesDeps b, MonadReader r m,
 Has (ScalarTypeParsingContext b) r) =&gt;
SourceName
-&gt; TableCoreCache b
-&gt; LogicalModelName
-&gt; InsOrdHashMap (Column b) (LogicalModelField b)
-&gt; InsOrdHashMap RoleName (SelPermDef b)
-&gt; OrderedRoles
-&gt; m (RolePermInfoMap b)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Permission.html#buildLogicalModelPermissions"><span class="hs-identifier hs-var">buildLogicalModelPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412742"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (TableName b) (TableCoreInfo b)
</span><a href="#local-6989586621687412764"><span class="hs-identifier hs-var">tableCoreInfos</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelName
</span><a href="#local-6989586621687412843"><span class="hs-identifier hs-var">_lmmName</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap (Column b) (LogicalModelField b)
</span><a href="#local-6989586621687412844"><span class="hs-identifier hs-var">_lmmFields</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap RoleName (SelPermDef b)
</span><a href="#local-6989586621687412846"><span class="hs-identifier hs-var">_lmmSelectPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621687412735"><span class="hs-identifier hs-var">orderedRoles</span></a></span><span>
</span><span id="line-907"></span><span>
</span><span id="line-908"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687412852"><span class="annot"><span class="annottext">recurseLogicalModelDependencies :: LogicalModelType b
-&gt; ExceptT QErr (WriterT (Seq CollectItem) Identity) ()
</span><a href="#local-6989586621687412852"><span class="hs-identifier hs-var hs-var">recurseLogicalModelDependencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-909"></span><span>                      </span><span class="annot"><a href="Hasura.LogicalModel.Types.html#LogicalModelTypeScalar"><span class="hs-identifier hs-type">LogicalModelTypeScalar</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelTypeScalar b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT QErr (WriterT (Seq CollectItem) Identity) ()
forall a. a -&gt; ExceptT QErr (WriterT (Seq CollectItem) Identity) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-910"></span><span>                      </span><span class="annot"><a href="Hasura.LogicalModel.Types.html#LogicalModelTypeArray"><span class="hs-identifier hs-type">LogicalModelTypeArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.LogicalModel.Types.html#LogicalModelTypeArrayC"><span class="hs-identifier hs-type">LogicalModelTypeArrayC</span></a></span><span> </span><span id="local-6989586621687412856"><span class="annot"><span class="annottext">LogicalModelType b
</span><a href="#local-6989586621687412856"><span class="hs-identifier hs-var">ltmaArray</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-911"></span><span>                        </span><span class="annot"><span class="annottext">LogicalModelType b
-&gt; ExceptT QErr (WriterT (Seq CollectItem) Identity) ()
</span><a href="#local-6989586621687412852"><span class="hs-identifier hs-var">recurseLogicalModelDependencies</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelType b
</span><a href="#local-6989586621687412856"><span class="hs-identifier hs-var">ltmaArray</span></a></span><span>
</span><span id="line-912"></span><span>                      </span><span class="annot"><a href="Hasura.LogicalModel.Types.html#LogicalModelTypeReference"><span class="hs-identifier hs-type">LogicalModelTypeReference</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.LogicalModel.Types.html#LogicalModelTypeReferenceC"><span class="hs-identifier hs-type">LogicalModelTypeReferenceC</span></a></span><span> </span><span id="local-6989586621687412859"><span class="annot"><span class="annottext">LogicalModelName
</span><a href="#local-6989586621687412859"><span class="hs-identifier hs-var">lmtrr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-913"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687412860"><span class="annot"><span class="annottext">metadataObject :: MetadataObject
</span><a href="#local-6989586621687412860"><span class="hs-identifier hs-var hs-var">metadataObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-914"></span><span>                              </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span>
</span><span id="line-915"></span><span>                                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceMetadataObjId -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOSourceObjId"><span class="hs-identifier hs-var">MOSourceObjId</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412742"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-916"></span><span>                                    </span><span class="annot"><span class="annottext">(AnyBackend SourceMetadataObjId -&gt; MetadataObjId)
-&gt; AnyBackend SourceMetadataObjId -&gt; MetadataObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span>
</span><span id="line-917"></span><span>                                    </span><span class="annot"><span class="annottext">(SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId)
-&gt; SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
LogicalModelName
-&gt; LogicalModelMetadataObjId -&gt; SourceMetadataObjId b
</span><a href="Hasura.RQL.Types.Metadata.Object.html#SMOLogicalModelObj"><span class="hs-identifier hs-var">SMOLogicalModelObj</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelName
</span><a href="#local-6989586621687412843"><span class="hs-identifier hs-var">_lmmName</span></a></span><span>
</span><span id="line-918"></span><span>                                    </span><span class="annot"><span class="annottext">(LogicalModelMetadataObjId -&gt; SourceMetadataObjId b)
-&gt; LogicalModelMetadataObjId -&gt; SourceMetadataObjId b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LogicalModelName -&gt; LogicalModelMetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#LMMOInnerLogicalModel"><span class="hs-identifier hs-var">LMMOInnerLogicalModel</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelName
</span><a href="#local-6989586621687412859"><span class="hs-identifier hs-var">lmtrr</span></a></span><span>
</span><span id="line-919"></span><span>                                </span><span class="hs-special">)</span><span>
</span><span id="line-920"></span><span>                                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">LogicalModelMetadata b -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelMetadata b
</span><a href="#local-6989586621687412841"><span class="hs-identifier hs-var">lmm</span></a></span><span>
</span><span id="line-921"></span><span>                                </span><span class="hs-special">)</span><span>
</span><span id="line-922"></span><span>
</span><span id="line-923"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621687412863"><span class="hs-identifier hs-type">sourceObject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SchemaObjId"><span class="hs-identifier hs-type">SchemaObjId</span></a></span><span>
</span><span id="line-924"></span><span>                            </span><span id="local-6989586621687412863"><span class="annot"><span class="annottext">sourceObject :: SchemaObjId
</span><a href="#local-6989586621687412863"><span class="hs-identifier hs-var hs-var">sourceObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-925"></span><span>                              </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceObjId -&gt; SchemaObjId
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SOSourceObj"><span class="hs-identifier hs-var">SOSourceObj</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412742"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-926"></span><span>                                </span><span class="annot"><span class="annottext">(AnyBackend SourceObjId -&gt; SchemaObjId)
-&gt; AnyBackend SourceObjId -&gt; SchemaObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceObjId b -&gt; AnyBackend SourceObjId
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span>
</span><span id="line-927"></span><span>                                </span><span class="annot"><span class="annottext">(SourceObjId b -&gt; AnyBackend SourceObjId)
-&gt; SourceObjId b -&gt; AnyBackend SourceObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
LogicalModelName -&gt; LogicalModelObjId b -&gt; SourceObjId b
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SOILogicalModelObj"><span class="hs-identifier hs-var">SOILogicalModelObj</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelName
</span><a href="#local-6989586621687412843"><span class="hs-identifier hs-var">_lmmName</span></a></span><span>
</span><span id="line-928"></span><span>                                </span><span class="annot"><span class="annottext">(LogicalModelObjId b -&gt; SourceObjId b)
-&gt; LogicalModelObjId b -&gt; SourceObjId b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LogicalModelName -&gt; LogicalModelObjId b
forall (b :: BackendType). LogicalModelName -&gt; LogicalModelObjId b
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#LMOInnerLogicalModel"><span class="hs-identifier hs-var">LMOInnerLogicalModel</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelName
</span><a href="#local-6989586621687412859"><span class="hs-identifier hs-var">lmtrr</span></a></span><span>
</span><span id="line-929"></span><span>
</span><span id="line-930"></span><span>                        </span><span class="annot"><span class="annottext">MetadataObject
-&gt; SchemaObjId
-&gt; Seq SchemaDependency
-&gt; ExceptT QErr (WriterT (Seq CollectItem) Identity) ()
forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; SchemaObjId -&gt; Seq SchemaDependency -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordDependenciesM"><span class="hs-identifier hs-var">recordDependenciesM</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687412860"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaObjId
</span><a href="#local-6989586621687412863"><span class="hs-identifier hs-var">sourceObject</span></a></span><span>
</span><span id="line-931"></span><span>                          </span><span class="annot"><span class="annottext">(Seq SchemaDependency
 -&gt; ExceptT QErr (WriterT (Seq CollectItem) Identity) ())
-&gt; Seq SchemaDependency
-&gt; ExceptT QErr (WriterT (Seq CollectItem) Identity) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SchemaDependency -&gt; Seq SchemaDependency
forall a. a -&gt; Seq a
</span><span class="hs-identifier hs-var">Seq.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaObjId -&gt; DependencyReason -&gt; SchemaDependency
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SchemaDependency"><span class="hs-identifier hs-var">SchemaDependency</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaObjId
</span><a href="#local-6989586621687412863"><span class="hs-identifier hs-var">sourceObject</span></a></span><span> </span><span class="annot"><span class="annottext">DependencyReason
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#DRInnerLogicalModel"><span class="hs-identifier hs-var">DRInnerLogicalModel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-932"></span><span>
</span><span id="line-933"></span><span>                </span><span class="annot"><span class="annottext">(LogicalModelField b
 -&gt; ExceptT QErr (WriterT (Seq CollectItem) Identity) ())
-&gt; InsOrdHashMap (Column b) (LogicalModelField b)
-&gt; ExceptT QErr (WriterT (Seq CollectItem) Identity) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LogicalModelType b
-&gt; ExceptT QErr (WriterT (Seq CollectItem) Identity) ()
</span><a href="#local-6989586621687412852"><span class="hs-identifier hs-var">recurseLogicalModelDependencies</span></a></span><span> </span><span class="annot"><span class="annottext">(LogicalModelType b
 -&gt; ExceptT QErr (WriterT (Seq CollectItem) Identity) ())
-&gt; (LogicalModelField b -&gt; LogicalModelType b)
-&gt; LogicalModelField b
-&gt; ExceptT QErr (WriterT (Seq CollectItem) Identity) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LogicalModelField b -&gt; LogicalModelType b
forall (b :: BackendType).
LogicalModelField b -&gt; LogicalModelType b
</span><a href="Hasura.LogicalModel.Types.html#lmfType"><span class="hs-identifier hs-var">lmfType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap (Column b) (LogicalModelField b)
</span><a href="#local-6989586621687412844"><span class="hs-identifier hs-var">_lmmFields</span></a></span><span>
</span><span id="line-934"></span><span>
</span><span id="line-935"></span><span>                </span><span class="annot"><span class="annottext">LogicalModelInfo b
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) (LogicalModelInfo b)
forall a. a -&gt; ExceptT QErr (WriterT (Seq CollectItem) Identity) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-936"></span><span>                  </span><span class="annot"><a href="Hasura.LogicalModel.Cache.html#LogicalModelInfo"><span class="hs-identifier hs-type">LogicalModelInfo</span></a></span><span>
</span><span id="line-937"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_lmiName :: LogicalModelName
</span><a href="Hasura.LogicalModel.Cache.html#_lmiName"><span class="hs-identifier hs-var">_lmiName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogicalModelName
</span><a href="#local-6989586621687412843"><span class="hs-identifier hs-var">_lmmName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-938"></span><span>                      </span><span class="annot"><span class="annottext">_lmiFields :: InsOrdHashMap (Column b) (LogicalModelField b)
</span><a href="Hasura.LogicalModel.Cache.html#_lmiFields"><span class="hs-identifier hs-var">_lmiFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap (Column b) (LogicalModelField b)
</span><a href="#local-6989586621687412844"><span class="hs-identifier hs-var">_lmmFields</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-939"></span><span>                      </span><span class="annot"><span class="annottext">_lmiPermissions :: RolePermInfoMap b
</span><a href="Hasura.LogicalModel.Cache.html#_lmiPermissions"><span class="hs-identifier hs-var">_lmiPermissions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RolePermInfoMap b
</span><a href="#local-6989586621687412850"><span class="hs-identifier hs-var">logicalModelPermissions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-940"></span><span>                      </span><span class="annot"><span class="annottext">_lmiDescription :: Maybe Text
</span><a href="Hasura.LogicalModel.Cache.html#_lmiDescription"><span class="hs-identifier hs-var">_lmiDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687412845"><span class="hs-identifier hs-var">_lmmDescription</span></a></span><span>
</span><span id="line-941"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-942"></span><span>
</span><span id="line-943"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621687412875"><span class="hs-identifier hs-type">logicalModelsCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.LogicalModel.Cache.html#LogicalModelCache"><span class="hs-identifier hs-type">LogicalModelCache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-944"></span><span>          </span><span id="local-6989586621687412875"><span class="annot"><span class="annottext">logicalModelsCache :: LogicalModelCache b
</span><a href="#local-6989586621687412875"><span class="hs-identifier hs-var hs-var">logicalModelsCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LogicalModelInfo b -&gt; LogicalModelName)
-&gt; [LogicalModelInfo b] -&gt; LogicalModelCache b
forall k a. Hashable k =&gt; (a -&gt; k) -&gt; [a] -&gt; HashMap k a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#mapFromL"><span class="hs-identifier hs-var">mapFromL</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelInfo b -&gt; LogicalModelName
forall (b :: BackendType). LogicalModelInfo b -&gt; LogicalModelName
</span><a href="Hasura.LogicalModel.Cache.html#_lmiName"><span class="hs-identifier hs-var">_lmiName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe (LogicalModelInfo b)] -&gt; [LogicalModelInfo b]
forall a. [Maybe a] -&gt; [a]
forall (f :: * -&gt; *) a. Filterable f =&gt; f (Maybe a) -&gt; f a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/witherable-0.4.2-a40f3f0a2ed7f25145b5b00589bf4ea2486662b1e96b7d29d5e6041625ee4a09/share/doc/html/src/Witherable.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe (LogicalModelInfo b)]
</span><a href="#local-6989586621687412840"><span class="hs-identifier hs-var">logicalModelCacheMaybes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-945"></span><span>
</span><span id="line-946"></span><span>      </span><span id="local-6989586621687412876"><span class="annot"><span class="annottext">[Maybe (NativeQueryInfo b)]
</span><a href="#local-6989586621687412876"><span class="hs-identifier hs-var">nativeQueryCacheMaybes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-947"></span><span>        </span><span class="annot"><span class="annottext">arr
  (WriterT (Seq CollectItem) m [Maybe (NativeQueryInfo b)])
  [Maybe (NativeQueryInfo b)]
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) w a.
(ArrowKleisli m arr, ArrowWriter w arr) =&gt;
arr (WriterT w m a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Interpret.html#interpretWriterT"><span class="hs-identifier hs-var">interpretWriterT</span></a></span><span>
</span><span id="line-948"></span><span>          </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">[NativeQueryMetadata b]
-&gt; (NativeQueryMetadata b
    -&gt; WriterT (Seq CollectItem) m (Maybe (NativeQueryInfo b)))
-&gt; WriterT (Seq CollectItem) m [Maybe (NativeQueryInfo b)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span>
</span><span id="line-949"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NativeQueries b -&gt; [NativeQueryMetadata b]
forall k v. InsOrdHashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#elems"><span class="hs-identifier hs-var">InsOrdHashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">NativeQueries b
</span><a href="#local-6989586621687412746"><span class="hs-identifier hs-var">nativeQueries</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-950"></span><span>            </span><span class="hs-glyph">\</span><span id="local-6989586621687412878"><span class="annot"><span class="annottext">preValidationNativeQuery :: NativeQueryMetadata b
</span><a href="#local-6989586621687412878"><span class="hs-identifier hs-var">preValidationNativeQuery</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.NativeQuery.Metadata.html#NativeQueryMetadata"><span class="hs-identifier hs-type">NativeQueryMetadata</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687412880"><span class="annot"><span class="annottext">NativeQueryName
_nqmRootFieldName :: NativeQueryName
_nqmRootFieldName :: forall (b :: BackendType). NativeQueryMetadata b -&gt; NativeQueryName
</span><a href="#local-6989586621687412880"><span class="hs-identifier hs-var hs-var">_nqmRootFieldName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412882"><span class="annot"><span class="annottext">LogicalModelName
_nqmReturns :: LogicalModelName
_nqmReturns :: forall (b :: BackendType).
NativeQueryMetadata b -&gt; LogicalModelName
</span><a href="#local-6989586621687412882"><span class="hs-identifier hs-var hs-var">_nqmReturns</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412884"><span class="annot"><span class="annottext">HashMap ArgumentName (NullableScalarType b)
_nqmArguments :: HashMap ArgumentName (NullableScalarType b)
_nqmArguments :: forall (b :: BackendType).
NativeQueryMetadata b
-&gt; HashMap ArgumentName (NullableScalarType b)
</span><a href="#local-6989586621687412884"><span class="hs-identifier hs-var hs-var">_nqmArguments</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687412886"><span class="annot"><span class="annottext">Maybe Text
_nqmDescription :: Maybe Text
_nqmDescription :: forall (b :: BackendType). NativeQueryMetadata b -&gt; Maybe Text
</span><a href="#local-6989586621687412886"><span class="hs-identifier hs-var hs-var">_nqmDescription</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-951"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621687412888"><span class="hs-identifier hs-type">metadataObject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span><span>
</span><span id="line-952"></span><span>                  </span><span id="local-6989586621687412888"><span class="annot"><span class="annottext">metadataObject :: MetadataObject
</span><a href="#local-6989586621687412888"><span class="hs-identifier hs-var hs-var">metadataObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-953"></span><span>                    </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span>
</span><span id="line-954"></span><span>                      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceMetadataObjId -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOSourceObjId"><span class="hs-identifier hs-var">MOSourceObjId</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412742"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-955"></span><span>                          </span><span class="annot"><span class="annottext">(AnyBackend SourceMetadataObjId -&gt; MetadataObjId)
-&gt; AnyBackend SourceMetadataObjId -&gt; MetadataObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span>
</span><span id="line-956"></span><span>                          </span><span class="annot"><span class="annottext">(SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId)
-&gt; SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). NativeQueryName -&gt; SourceMetadataObjId b
</span><a href="Hasura.RQL.Types.Metadata.Object.html#SMONativeQuery"><span class="hs-identifier hs-var">SMONativeQuery</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">NativeQueryName
</span><a href="#local-6989586621687412880"><span class="hs-identifier hs-var">_nqmRootFieldName</span></a></span><span>
</span><span id="line-957"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-958"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NativeQueryMetadata b -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">NativeQueryMetadata b
</span><a href="#local-6989586621687412878"><span class="hs-identifier hs-var">preValidationNativeQuery</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-959"></span><span>
</span><span id="line-960"></span><span>                  </span><span class="annot"><a href="#local-6989586621687412890"><span class="hs-identifier hs-type">schemaObjId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SchemaObjId"><span class="hs-identifier hs-type">SchemaObjId</span></a></span><span>
</span><span id="line-961"></span><span>                  </span><span id="local-6989586621687412890"><span class="annot"><span class="annottext">schemaObjId :: SchemaObjId
</span><a href="#local-6989586621687412890"><span class="hs-identifier hs-var hs-var">schemaObjId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-962"></span><span>                    </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceObjId -&gt; SchemaObjId
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SOSourceObj"><span class="hs-identifier hs-var">SOSourceObj</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412742"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-963"></span><span>                      </span><span class="annot"><span class="annottext">(AnyBackend SourceObjId -&gt; SchemaObjId)
-&gt; AnyBackend SourceObjId -&gt; SchemaObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceObjId b -&gt; AnyBackend SourceObjId
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span>
</span><span id="line-964"></span><span>                      </span><span class="annot"><span class="annottext">(SourceObjId b -&gt; AnyBackend SourceObjId)
-&gt; SourceObjId b -&gt; AnyBackend SourceObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). NativeQueryName -&gt; SourceObjId b
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SOINativeQuery"><span class="hs-identifier hs-var">SOINativeQuery</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">NativeQueryName
</span><a href="#local-6989586621687412880"><span class="hs-identifier hs-var">_nqmRootFieldName</span></a></span><span>
</span><span id="line-965"></span><span>
</span><span id="line-966"></span><span>                  </span><span class="annot"><a href="#local-6989586621687412892"><span class="hs-keyword hs-type">dependency</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SchemaDependency"><span class="hs-identifier hs-type">SchemaDependency</span></a></span><span>
</span><span id="line-967"></span><span>                  </span><span id="local-6989586621687412892"><span class="annot"><span class="annottext">dependency :: SchemaDependency
</span><a href="#local-6989586621687412892"><span class="hs-keyword hs-var hs-var">dependency</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-968"></span><span>                    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SchemaDependency"><span class="hs-identifier hs-type">SchemaDependency</span></a></span><span>
</span><span id="line-969"></span><span>                      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sdObjId :: SchemaObjId
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#sdObjId"><span class="hs-identifier hs-var">sdObjId</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-970"></span><span>                          </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceObjId -&gt; SchemaObjId
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SOSourceObj"><span class="hs-identifier hs-var">SOSourceObj</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412742"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-971"></span><span>                            </span><span class="annot"><span class="annottext">(AnyBackend SourceObjId -&gt; SchemaObjId)
-&gt; AnyBackend SourceObjId -&gt; SchemaObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceObjId b -&gt; AnyBackend SourceObjId
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span>
</span><span id="line-972"></span><span>                            </span><span class="annot"><span class="annottext">(SourceObjId b -&gt; AnyBackend SourceObjId)
-&gt; SourceObjId b -&gt; AnyBackend SourceObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). LogicalModelName -&gt; SourceObjId b
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SOILogicalModel"><span class="hs-identifier hs-var">SOILogicalModel</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelName
</span><a href="#local-6989586621687412882"><span class="hs-identifier hs-var">_nqmReturns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-973"></span><span>                        </span><span class="annot"><span class="annottext">sdReason :: DependencyReason
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#sdReason"><span class="hs-identifier hs-var">sdReason</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DependencyReason
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#DRLogicalModel"><span class="hs-identifier hs-var">DRLogicalModel</span></a></span><span>
</span><span id="line-974"></span><span>                      </span><span class="hs-special">}</span><span>
</span><span id="line-975"></span><span>
</span><span id="line-976"></span><span>              </span><span class="annot"><span class="annottext">MetadataObject
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) (NativeQueryInfo b)
-&gt; WriterT (Seq CollectItem) m (Maybe (NativeQueryInfo b))
forall (m :: * -&gt; *) a.
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687412888"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT QErr (WriterT (Seq CollectItem) m) (NativeQueryInfo b)
 -&gt; WriterT (Seq CollectItem) m (Maybe (NativeQueryInfo b)))
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) (NativeQueryInfo b)
-&gt; WriterT (Seq CollectItem) m (Maybe (NativeQueryInfo b))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-977"></span><span>                </span><span class="annot"><span class="annottext">Bool
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CacheStaticConfig -&gt; BackendType -&gt; Bool
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cscAreNativeQueriesEnabled"><span class="hs-identifier hs-var">_cscAreNativeQueriesEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">CacheStaticConfig
</span><a href="#local-6989586621687412838"><span class="hs-identifier hs-var">cacheStaticConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackendTag b -&gt; BackendType
forall (b :: BackendType). BackendTag b -&gt; BackendType
</span><a href="Hasura.RQL.Types.BackendTag.html#reify"><span class="hs-identifier hs-var">reify</span></a></span><span> </span><span class="annot"><span class="annottext">(BackendTag b -&gt; BackendType) -&gt; BackendTag b -&gt; BackendType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). HasTag b =&gt; BackendTag b
</span><a href="Hasura.RQL.Types.BackendTag.html#backendTag"><span class="hs-identifier hs-var">backendTag</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-978"></span><span>                  </span><span class="annot"><span class="annottext">(ExceptT QErr (WriterT (Seq CollectItem) m) ()
 -&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ())
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#InvalidConfiguration"><span class="hs-identifier hs-var">InvalidConfiguration</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The Native Queries feature is disabled&quot;</span></span><span>
</span><span id="line-979"></span><span>
</span><span id="line-980"></span><span>                </span><span id="local-6989586621687412902"><span class="annot"><span class="annottext">LogicalModelInfo b
</span><a href="#local-6989586621687412902"><span class="hs-identifier hs-var">logicalModel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-981"></span><span>                  </span><span class="annot"><span class="annottext">Maybe (LogicalModelInfo b)
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) (LogicalModelInfo b)
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) (LogicalModelInfo b)
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#onNothing"><span class="hs-identifier hs-var">onNothing</span></a></span><span>
</span><span id="line-982"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LogicalModelName
-&gt; LogicalModelCache b -&gt; Maybe (LogicalModelInfo b)
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#lookup"><span class="hs-identifier hs-var">HashMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelName
</span><a href="#local-6989586621687412882"><span class="hs-identifier hs-var">_nqmReturns</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelCache b
</span><a href="#local-6989586621687412875"><span class="hs-identifier hs-var">logicalModelsCache</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-983"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Code
-&gt; Text
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) (LogicalModelInfo b)
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#InvalidConfiguration"><span class="hs-identifier hs-var">InvalidConfiguration</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The logical model &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">LogicalModelName -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelName
</span><a href="#local-6989586621687412882"><span class="hs-identifier hs-var">_nqmReturns</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; could not be found&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-984"></span><span>
</span><span id="line-985"></span><span>                </span><span id="local-6989586621687412903"><span class="annot"><span class="annottext">InterpolatedQuery ArgumentName
</span><a href="#local-6989586621687412903"><span class="hs-identifier hs-var">nqmCode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(BackendMetadata b, MonadIO m, MonadError QErr m) =&gt;
Environment
-&gt; SourceConnConfiguration b
-&gt; LogicalModelInfo b
-&gt; NativeQueryMetadata b
-&gt; m (InterpolatedQuery ArgumentName)
</span><a href="Hasura.RQL.Types.Metadata.Backend.html#validateNativeQuery"><span class="hs-identifier hs-var">validateNativeQuery</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621687411809"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceMetadata b -&gt; SourceConnConfiguration b
forall (b :: BackendType).
SourceMetadata b -&gt; SourceConnConfiguration b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smConfiguration"><span class="hs-identifier hs-var">_smConfiguration</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687412729"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LogicalModelInfo b
</span><a href="#local-6989586621687412902"><span class="hs-identifier hs-var">logicalModel</span></a></span><span> </span><span class="annot"><span class="annottext">NativeQueryMetadata b
</span><a href="#local-6989586621687412878"><span class="hs-identifier hs-var">preValidationNativeQuery</span></a></span><span>
</span><span id="line-986"></span><span>
</span><span id="line-987"></span><span>                </span><span class="annot"><span class="annottext">MetadataObject
-&gt; SchemaObjId
-&gt; Seq SchemaDependency
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; SchemaObjId -&gt; Seq SchemaDependency -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordDependenciesM"><span class="hs-identifier hs-var">recordDependenciesM</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687412888"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaObjId
</span><a href="#local-6989586621687412890"><span class="hs-identifier hs-var">schemaObjId</span></a></span><span>
</span><span id="line-988"></span><span>                  </span><span class="annot"><span class="annottext">(Seq SchemaDependency
 -&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ())
-&gt; Seq SchemaDependency
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SchemaDependency -&gt; Seq SchemaDependency
forall a. a -&gt; Seq a
</span><span class="hs-identifier hs-var">Seq.singleton</span></span><span> </span><span class="annot"><span class="annottext">SchemaDependency
</span><a href="#local-6989586621687412892"><span class="hs-keyword hs-var">dependency</span></a></span><span>
</span><span id="line-989"></span><span>
</span><span id="line-990"></span><span>                </span><span id="local-6989586621687412905"><span class="annot"><span class="annottext">InsOrdHashMap RelName (RelInfo b, Seq SchemaDependency)
</span><a href="#local-6989586621687412905"><span class="hs-identifier hs-var">arrayRelationships</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-991"></span><span>                  </span><span class="annot"><span class="annottext">(RelDef (RelManualNativeQueryConfig b)
 -&gt; ExceptT
      QErr
      (WriterT (Seq CollectItem) m)
      (RelInfo b, Seq SchemaDependency))
-&gt; InsOrdHashMap RelName (RelDef (RelManualNativeQueryConfig b))
-&gt; ExceptT
     QErr
     (WriterT (Seq CollectItem) m)
     (InsOrdHashMap RelName (RelInfo b, Seq SchemaDependency))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b)
-&gt; InsOrdHashMap RelName a -&gt; f (InsOrdHashMap RelName b)
</span><span class="hs-identifier hs-var">traverse</span></span><span>
</span><span id="line-992"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceName
-&gt; NativeQueryName
-&gt; RelType
-&gt; RelDef (RelManualNativeQueryConfig b)
-&gt; ExceptT
     QErr
     (WriterT (Seq CollectItem) m)
     (RelInfo b, Seq SchemaDependency)
forall (b :: BackendType) (m :: * -&gt; *).
(QErrM m, Backend b) =&gt;
SourceName
-&gt; NativeQueryName
-&gt; RelType
-&gt; RelDef (RelManualNativeQueryConfig b)
-&gt; m (RelInfo b, Seq SchemaDependency)
</span><a href="Hasura.RQL.DDL.Relationship.html#nativeQueryRelationshipSetup"><span class="hs-identifier hs-var">nativeQueryRelationshipSetup</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412742"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">NativeQueryName
</span><a href="#local-6989586621687412880"><span class="hs-identifier hs-var">_nqmRootFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">RelType
</span><a href="Hasura.RQL.Types.Common.html#ArrRel"><span class="hs-identifier hs-var">ArrRel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-993"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NativeQueryMetadata b
-&gt; InsOrdHashMap RelName (RelDef (RelManualNativeQueryConfig b))
forall (b :: BackendType).
NativeQueryMetadata b
-&gt; Relationships (RelDef (RelManualNativeQueryConfig b))
</span><a href="Hasura.NativeQuery.Metadata.html#_nqmArrayRelationships"><span class="hs-identifier hs-var">_nqmArrayRelationships</span></a></span><span> </span><span class="annot"><span class="annottext">NativeQueryMetadata b
</span><a href="#local-6989586621687412878"><span class="hs-identifier hs-var">preValidationNativeQuery</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-994"></span><span>
</span><span id="line-995"></span><span>                </span><span id="local-6989586621687412910"><span class="annot"><span class="annottext">InsOrdHashMap RelName (RelInfo b, Seq SchemaDependency)
</span><a href="#local-6989586621687412910"><span class="hs-identifier hs-var">objectRelationships</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-996"></span><span>                  </span><span class="annot"><span class="annottext">(RelDef (RelManualNativeQueryConfig b)
 -&gt; ExceptT
      QErr
      (WriterT (Seq CollectItem) m)
      (RelInfo b, Seq SchemaDependency))
-&gt; InsOrdHashMap RelName (RelDef (RelManualNativeQueryConfig b))
-&gt; ExceptT
     QErr
     (WriterT (Seq CollectItem) m)
     (InsOrdHashMap RelName (RelInfo b, Seq SchemaDependency))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b)
-&gt; InsOrdHashMap RelName a -&gt; f (InsOrdHashMap RelName b)
</span><span class="hs-identifier hs-var">traverse</span></span><span>
</span><span id="line-997"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceName
-&gt; NativeQueryName
-&gt; RelType
-&gt; RelDef (RelManualNativeQueryConfig b)
-&gt; ExceptT
     QErr
     (WriterT (Seq CollectItem) m)
     (RelInfo b, Seq SchemaDependency)
forall (b :: BackendType) (m :: * -&gt; *).
(QErrM m, Backend b) =&gt;
SourceName
-&gt; NativeQueryName
-&gt; RelType
-&gt; RelDef (RelManualNativeQueryConfig b)
-&gt; m (RelInfo b, Seq SchemaDependency)
</span><a href="Hasura.RQL.DDL.Relationship.html#nativeQueryRelationshipSetup"><span class="hs-identifier hs-var">nativeQueryRelationshipSetup</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412742"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">NativeQueryName
</span><a href="#local-6989586621687412880"><span class="hs-identifier hs-var">_nqmRootFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">RelType
</span><a href="Hasura.RQL.Types.Common.html#ObjRel"><span class="hs-identifier hs-var">ObjRel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-998"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NativeQueryMetadata b
-&gt; InsOrdHashMap RelName (RelDef (RelManualNativeQueryConfig b))
forall (b :: BackendType).
NativeQueryMetadata b
-&gt; Relationships (RelDef (RelManualNativeQueryConfig b))
</span><a href="Hasura.NativeQuery.Metadata.html#_nqmObjectRelationships"><span class="hs-identifier hs-var">_nqmObjectRelationships</span></a></span><span> </span><span class="annot"><span class="annottext">NativeQueryMetadata b
</span><a href="#local-6989586621687412878"><span class="hs-identifier hs-var">preValidationNativeQuery</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-999"></span><span>
</span><span id="line-1000"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687412913"><span class="annot"><span class="annottext">duplicates :: Set RelName
</span><a href="#local-6989586621687412913"><span class="hs-identifier hs-var hs-var">duplicates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1001"></span><span>                      </span><span class="annot"><span class="annottext">Set RelName -&gt; Set RelName -&gt; Set RelName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.intersection</span></span><span>
</span><span id="line-1002"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[RelName] -&gt; Set RelName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">([RelName] -&gt; Set RelName) -&gt; [RelName] -&gt; Set RelName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap RelName (RelInfo b, Seq SchemaDependency)
-&gt; [RelName]
forall k v. InsOrdHashMap k v -&gt; [k]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#keys"><span class="hs-identifier hs-var">InsOrdHashMap.keys</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap RelName (RelInfo b, Seq SchemaDependency)
</span><a href="#local-6989586621687412905"><span class="hs-identifier hs-var">arrayRelationships</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1003"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[RelName] -&gt; Set RelName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">([RelName] -&gt; Set RelName) -&gt; [RelName] -&gt; Set RelName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap RelName (RelInfo b, Seq SchemaDependency)
-&gt; [RelName]
forall k v. InsOrdHashMap k v -&gt; [k]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#keys"><span class="hs-identifier hs-var">InsOrdHashMap.keys</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap RelName (RelInfo b, Seq SchemaDependency)
</span><a href="#local-6989586621687412910"><span class="hs-identifier hs-var">objectRelationships</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1004"></span><span>
</span><span id="line-1005"></span><span>                </span><span class="hs-comment">-- it is possible to have the same field name in both `array`</span><span>
</span><span id="line-1006"></span><span>                </span><span class="hs-comment">-- and `object`, let's stop that</span><span>
</span><span id="line-1007"></span><span>                </span><span class="annot"><span class="annottext">Bool
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set RelName -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">S.null</span></span><span> </span><span class="annot"><span class="annottext">Set RelName
</span><a href="#local-6989586621687412913"><span class="hs-identifier hs-var">duplicates</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1008"></span><span>                  </span><span class="annot"><span class="annottext">(ExceptT QErr (WriterT (Seq CollectItem) m) ()
 -&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ())
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#InvalidConfiguration"><span class="hs-identifier hs-var">InvalidConfiguration</span></a></span><span>
</span><span id="line-1009"></span><span>                  </span><span class="annot"><span class="annottext">(Text -&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ())
-&gt; Text -&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The native query '&quot;</span></span><span>
</span><span id="line-1010"></span><span>                  </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">NativeQueryName -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">NativeQueryName
</span><a href="#local-6989586621687412880"><span class="hs-identifier hs-var">_nqmRootFieldName</span></a></span><span>
</span><span id="line-1011"></span><span>                  </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;' has duplicate relationships: &quot;</span></span><span>
</span><span id="line-1012"></span><span>                  </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-27d8e86ddce8dd754c06549efa10988301d41e208fc11cac9fe9ed6d99d6eb35/share/doc/html/src/Data.Text.html#intercalate"><span class="hs-identifier hs-var">T.intercalate</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RelName -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">(RelName -&gt; Text) -&gt; [RelName] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set RelName -&gt; [RelName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">Set RelName
</span><a href="#local-6989586621687412913"><span class="hs-identifier hs-var">duplicates</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1013"></span><span>
</span><span id="line-1014"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687412919"><span class="annot"><span class="annottext">sourceObject :: SchemaObjId
</span><a href="#local-6989586621687412919"><span class="hs-identifier hs-var hs-var">sourceObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1015"></span><span>                      </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceObjId -&gt; SchemaObjId
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SOSourceObj"><span class="hs-identifier hs-var">SOSourceObj</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412742"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-1016"></span><span>                        </span><span class="annot"><span class="annottext">(AnyBackend SourceObjId -&gt; SchemaObjId)
-&gt; AnyBackend SourceObjId -&gt; SchemaObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceObjId b -&gt; AnyBackend SourceObjId
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span>
</span><span id="line-1017"></span><span>                        </span><span class="annot"><span class="annottext">(SourceObjId b -&gt; AnyBackend SourceObjId)
-&gt; SourceObjId b -&gt; AnyBackend SourceObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). NativeQueryName -&gt; SourceObjId b
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SOINativeQuery"><span class="hs-identifier hs-var">SOINativeQuery</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">NativeQueryName
</span><a href="#local-6989586621687412880"><span class="hs-identifier hs-var">_nqmRootFieldName</span></a></span><span>
</span><span id="line-1018"></span><span>
</span><span id="line-1019"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687412920"><span class="annot"><span class="annottext">dependencies :: Seq SchemaDependency
</span><a href="#local-6989586621687412920"><span class="hs-identifier hs-var hs-var">dependencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1020"></span><span>                      </span><span class="annot"><span class="annottext">[Seq SchemaDependency] -&gt; Seq SchemaDependency
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(RelInfo b, Seq SchemaDependency) -&gt; Seq SchemaDependency
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((RelInfo b, Seq SchemaDependency) -&gt; Seq SchemaDependency)
-&gt; [(RelInfo b, Seq SchemaDependency)] -&gt; [Seq SchemaDependency]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap RelName (RelInfo b, Seq SchemaDependency)
-&gt; [(RelInfo b, Seq SchemaDependency)]
forall k v. InsOrdHashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#elems"><span class="hs-identifier hs-var">InsOrdHashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap RelName (RelInfo b, Seq SchemaDependency)
</span><a href="#local-6989586621687412905"><span class="hs-identifier hs-var">arrayRelationships</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1021"></span><span>                        </span><span class="annot"><span class="annottext">Seq SchemaDependency
-&gt; Seq SchemaDependency -&gt; Seq SchemaDependency
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Seq SchemaDependency] -&gt; Seq SchemaDependency
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(RelInfo b, Seq SchemaDependency) -&gt; Seq SchemaDependency
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((RelInfo b, Seq SchemaDependency) -&gt; Seq SchemaDependency)
-&gt; [(RelInfo b, Seq SchemaDependency)] -&gt; [Seq SchemaDependency]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap RelName (RelInfo b, Seq SchemaDependency)
-&gt; [(RelInfo b, Seq SchemaDependency)]
forall k v. InsOrdHashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#elems"><span class="hs-identifier hs-var">InsOrdHashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap RelName (RelInfo b, Seq SchemaDependency)
</span><a href="#local-6989586621687412910"><span class="hs-identifier hs-var">objectRelationships</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1022"></span><span>
</span><span id="line-1023"></span><span>                </span><span class="annot"><span class="annottext">MetadataObject
-&gt; SchemaObjId
-&gt; Seq SchemaDependency
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; SchemaObjId -&gt; Seq SchemaDependency -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordDependenciesM"><span class="hs-identifier hs-var">recordDependenciesM</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687412888"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaObjId
</span><a href="#local-6989586621687412919"><span class="hs-identifier hs-var">sourceObject</span></a></span><span> </span><span class="annot"><span class="annottext">Seq SchemaDependency
</span><a href="#local-6989586621687412920"><span class="hs-identifier hs-var">dependencies</span></a></span><span>
</span><span id="line-1024"></span><span>
</span><span id="line-1025"></span><span>                </span><span class="annot"><span class="annottext">NativeQueryInfo b
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) (NativeQueryInfo b)
forall a. a -&gt; ExceptT QErr (WriterT (Seq CollectItem) m) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-1026"></span><span>                  </span><span class="annot"><a href="Hasura.NativeQuery.Cache.html#NativeQueryInfo"><span class="hs-identifier hs-type">NativeQueryInfo</span></a></span><span>
</span><span id="line-1027"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_nqiRootFieldName :: NativeQueryName
</span><a href="Hasura.NativeQuery.Cache.html#_nqiRootFieldName"><span class="hs-identifier hs-var">_nqiRootFieldName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NativeQueryName
</span><a href="#local-6989586621687412880"><span class="hs-identifier hs-var">_nqmRootFieldName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1028"></span><span>                      </span><span class="annot"><span class="annottext">_nqiCode :: InterpolatedQuery ArgumentName
</span><a href="Hasura.NativeQuery.Cache.html#_nqiCode"><span class="hs-identifier hs-var">_nqiCode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InterpolatedQuery ArgumentName
</span><a href="#local-6989586621687412903"><span class="hs-identifier hs-var">nqmCode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1029"></span><span>                      </span><span class="annot"><span class="annottext">_nqiReturns :: LogicalModelInfo b
</span><a href="Hasura.NativeQuery.Cache.html#_nqiReturns"><span class="hs-identifier hs-var">_nqiReturns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogicalModelInfo b
</span><a href="#local-6989586621687412902"><span class="hs-identifier hs-var">logicalModel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1030"></span><span>                      </span><span class="annot"><span class="annottext">_nqiArguments :: HashMap ArgumentName (NullableScalarType b)
</span><a href="Hasura.NativeQuery.Cache.html#_nqiArguments"><span class="hs-identifier hs-var">_nqiArguments</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap ArgumentName (NullableScalarType b)
</span><a href="#local-6989586621687412884"><span class="hs-identifier hs-var">_nqmArguments</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1031"></span><span>                      </span><span class="annot"><span class="annottext">_nqiRelationships :: InsOrdHashMap RelName (RelInfo b)
</span><a href="Hasura.NativeQuery.Cache.html#_nqiRelationships"><span class="hs-identifier hs-var">_nqiRelationships</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RelInfo b, Seq SchemaDependency) -&gt; RelInfo b
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((RelInfo b, Seq SchemaDependency) -&gt; RelInfo b)
-&gt; InsOrdHashMap RelName (RelInfo b, Seq SchemaDependency)
-&gt; InsOrdHashMap RelName (RelInfo b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InsOrdHashMap RelName (RelInfo b, Seq SchemaDependency)
</span><a href="#local-6989586621687412905"><span class="hs-identifier hs-var">arrayRelationships</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap RelName (RelInfo b, Seq SchemaDependency)
-&gt; InsOrdHashMap RelName (RelInfo b, Seq SchemaDependency)
-&gt; InsOrdHashMap RelName (RelInfo b, Seq SchemaDependency)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap RelName (RelInfo b, Seq SchemaDependency)
</span><a href="#local-6989586621687412910"><span class="hs-identifier hs-var">objectRelationships</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1032"></span><span>                      </span><span class="annot"><span class="annottext">_nqiDescription :: Maybe Text
</span><a href="Hasura.NativeQuery.Cache.html#_nqiDescription"><span class="hs-identifier hs-var">_nqiDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687412886"><span class="hs-identifier hs-var">_nqmDescription</span></a></span><span>
</span><span id="line-1033"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-1034"></span><span>
</span><span id="line-1035"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621687412928"><span class="hs-identifier hs-type">nativeQueryCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.NativeQuery.Cache.html#NativeQueryCache"><span class="hs-identifier hs-type">NativeQueryCache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-1036"></span><span>          </span><span id="local-6989586621687412928"><span class="annot"><span class="annottext">nativeQueryCache :: NativeQueryCache b
</span><a href="#local-6989586621687412928"><span class="hs-identifier hs-var hs-var">nativeQueryCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NativeQueryInfo b -&gt; NativeQueryName)
-&gt; [NativeQueryInfo b] -&gt; NativeQueryCache b
forall k a. Hashable k =&gt; (a -&gt; k) -&gt; [a] -&gt; HashMap k a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#mapFromL"><span class="hs-identifier hs-var">mapFromL</span></a></span><span> </span><span class="annot"><span class="annottext">NativeQueryInfo b -&gt; NativeQueryName
forall (b :: BackendType). NativeQueryInfo b -&gt; NativeQueryName
</span><a href="Hasura.NativeQuery.Cache.html#_nqiRootFieldName"><span class="hs-identifier hs-var">_nqiRootFieldName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe (NativeQueryInfo b)] -&gt; [NativeQueryInfo b]
forall a. [Maybe a] -&gt; [a]
forall (f :: * -&gt; *) a. Filterable f =&gt; f (Maybe a) -&gt; f a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/witherable-0.4.2-a40f3f0a2ed7f25145b5b00589bf4ea2486662b1e96b7d29d5e6041625ee4a09/share/doc/html/src/Witherable.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe (NativeQueryInfo b)]
</span><a href="#local-6989586621687412876"><span class="hs-identifier hs-var">nativeQueryCacheMaybes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1037"></span><span>
</span><span id="line-1038"></span><span>      </span><span id="local-6989586621687412929"><span class="annot"><span class="annottext">[Maybe (StoredProcedureInfo b)]
</span><a href="#local-6989586621687412929"><span class="hs-identifier hs-var">storedProcedureCacheMaybes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1039"></span><span>        </span><span class="annot"><span class="annottext">arr
  (WriterT (Seq CollectItem) m [Maybe (StoredProcedureInfo b)])
  [Maybe (StoredProcedureInfo b)]
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) w a.
(ArrowKleisli m arr, ArrowWriter w arr) =&gt;
arr (WriterT w m a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Interpret.html#interpretWriterT"><span class="hs-identifier hs-var">interpretWriterT</span></a></span><span>
</span><span id="line-1040"></span><span>          </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">[StoredProcedureMetadata b]
-&gt; (StoredProcedureMetadata b
    -&gt; WriterT (Seq CollectItem) m (Maybe (StoredProcedureInfo b)))
-&gt; WriterT (Seq CollectItem) m [Maybe (StoredProcedureInfo b)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span>
</span><span id="line-1041"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StoredProcedures b -&gt; [StoredProcedureMetadata b]
forall k v. InsOrdHashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#elems"><span class="hs-identifier hs-var">InsOrdHashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">StoredProcedures b
</span><a href="#local-6989586621687412747"><span class="hs-identifier hs-var">storedProcedures</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1042"></span><span>            </span><span class="hs-glyph">\</span><span id="local-6989586621687412930"><span class="annot"><span class="annottext">spm :: StoredProcedureMetadata b
</span><a href="#local-6989586621687412930"><span class="hs-identifier hs-var">spm</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.StoredProcedure.Metadata.html#StoredProcedureMetadata"><span class="hs-identifier hs-type">StoredProcedureMetadata</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687412932"><span id="local-6989586621687412933"><span id="local-6989586621687412934"><span id="local-6989586621687412935"><span id="local-6989586621687412936"><span class="annot"><span class="annottext">Maybe Text
HashMap ArgumentName (NullableScalarType b)
FunctionName b
LogicalModelName
StoredProcedureConfig
_spmStoredProcedure :: FunctionName b
_spmConfig :: StoredProcedureConfig
_spmReturns :: LogicalModelName
_spmArguments :: HashMap ArgumentName (NullableScalarType b)
_spmDescription :: Maybe Text
_spmStoredProcedure :: forall (b :: BackendType).
StoredProcedureMetadata b -&gt; FunctionName b
_spmConfig :: forall (b :: BackendType).
StoredProcedureMetadata b -&gt; StoredProcedureConfig
_spmReturns :: forall (b :: BackendType).
StoredProcedureMetadata b -&gt; LogicalModelName
_spmArguments :: forall (b :: BackendType).
StoredProcedureMetadata b
-&gt; HashMap ArgumentName (NullableScalarType b)
_spmDescription :: forall (b :: BackendType). StoredProcedureMetadata b -&gt; Maybe Text
</span><a href="#local-6989586621687412932"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1043"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621687412942"><span class="hs-identifier hs-type">metadataObject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span><span>
</span><span id="line-1044"></span><span>                  </span><span id="local-6989586621687412942"><span class="annot"><span class="annottext">metadataObject :: MetadataObject
</span><a href="#local-6989586621687412942"><span class="hs-identifier hs-var hs-var">metadataObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1045"></span><span>                    </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span>
</span><span id="line-1046"></span><span>                      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceMetadataObjId -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOSourceObjId"><span class="hs-identifier hs-var">MOSourceObjId</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412742"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-1047"></span><span>                          </span><span class="annot"><span class="annottext">(AnyBackend SourceMetadataObjId -&gt; MetadataObjId)
-&gt; AnyBackend SourceMetadataObjId -&gt; MetadataObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span>
</span><span id="line-1048"></span><span>                          </span><span class="annot"><span class="annottext">(SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId)
-&gt; SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). FunctionName b -&gt; SourceMetadataObjId b
</span><a href="Hasura.RQL.Types.Metadata.Object.html#SMOStoredProcedure"><span class="hs-identifier hs-var">SMOStoredProcedure</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621687412932"><span class="hs-identifier hs-var">_spmStoredProcedure</span></a></span><span>
</span><span id="line-1049"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-1050"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StoredProcedureMetadata b -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">StoredProcedureMetadata b
</span><a href="#local-6989586621687412930"><span class="hs-identifier hs-var">spm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1051"></span><span>
</span><span id="line-1052"></span><span>                  </span><span class="annot"><a href="#local-6989586621687412944"><span class="hs-identifier hs-type">schemaObjId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SchemaObjId"><span class="hs-identifier hs-type">SchemaObjId</span></a></span><span>
</span><span id="line-1053"></span><span>                  </span><span id="local-6989586621687412944"><span class="annot"><span class="annottext">schemaObjId :: SchemaObjId
</span><a href="#local-6989586621687412944"><span class="hs-identifier hs-var hs-var">schemaObjId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1054"></span><span>                    </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceObjId -&gt; SchemaObjId
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SOSourceObj"><span class="hs-identifier hs-var">SOSourceObj</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412742"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-1055"></span><span>                      </span><span class="annot"><span class="annottext">(AnyBackend SourceObjId -&gt; SchemaObjId)
-&gt; AnyBackend SourceObjId -&gt; SchemaObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceObjId b -&gt; AnyBackend SourceObjId
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span>
</span><span id="line-1056"></span><span>                      </span><span class="annot"><span class="annottext">(SourceObjId b -&gt; AnyBackend SourceObjId)
-&gt; SourceObjId b -&gt; AnyBackend SourceObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). FunctionName b -&gt; SourceObjId b
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SOIStoredProcedure"><span class="hs-identifier hs-var">SOIStoredProcedure</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621687412932"><span class="hs-identifier hs-var">_spmStoredProcedure</span></a></span><span>
</span><span id="line-1057"></span><span>
</span><span id="line-1058"></span><span>                  </span><span class="annot"><a href="#local-6989586621687412946"><span class="hs-keyword hs-type">dependency</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SchemaDependency"><span class="hs-identifier hs-type">SchemaDependency</span></a></span><span>
</span><span id="line-1059"></span><span>                  </span><span id="local-6989586621687412946"><span class="annot"><span class="annottext">dependency :: SchemaDependency
</span><a href="#local-6989586621687412946"><span class="hs-keyword hs-var hs-var">dependency</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1060"></span><span>                    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SchemaDependency"><span class="hs-identifier hs-type">SchemaDependency</span></a></span><span>
</span><span id="line-1061"></span><span>                      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sdObjId :: SchemaObjId
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#sdObjId"><span class="hs-identifier hs-var">sdObjId</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1062"></span><span>                          </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceObjId -&gt; SchemaObjId
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SOSourceObj"><span class="hs-identifier hs-var">SOSourceObj</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412742"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-1063"></span><span>                            </span><span class="annot"><span class="annottext">(AnyBackend SourceObjId -&gt; SchemaObjId)
-&gt; AnyBackend SourceObjId -&gt; SchemaObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceObjId b -&gt; AnyBackend SourceObjId
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span>
</span><span id="line-1064"></span><span>                            </span><span class="annot"><span class="annottext">(SourceObjId b -&gt; AnyBackend SourceObjId)
-&gt; SourceObjId b -&gt; AnyBackend SourceObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). LogicalModelName -&gt; SourceObjId b
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SOILogicalModel"><span class="hs-identifier hs-var">SOILogicalModel</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelName
</span><a href="#local-6989586621687412934"><span class="hs-identifier hs-var">_spmReturns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1065"></span><span>                        </span><span class="annot"><span class="annottext">sdReason :: DependencyReason
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#sdReason"><span class="hs-identifier hs-var">sdReason</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DependencyReason
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#DRLogicalModel"><span class="hs-identifier hs-var">DRLogicalModel</span></a></span><span>
</span><span id="line-1066"></span><span>                      </span><span class="hs-special">}</span><span>
</span><span id="line-1067"></span><span>
</span><span id="line-1068"></span><span>              </span><span class="annot"><span class="annottext">MetadataObject
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) m) (StoredProcedureInfo b)
-&gt; WriterT (Seq CollectItem) m (Maybe (StoredProcedureInfo b))
forall (m :: * -&gt; *) a.
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687412942"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT QErr (WriterT (Seq CollectItem) m) (StoredProcedureInfo b)
 -&gt; WriterT (Seq CollectItem) m (Maybe (StoredProcedureInfo b)))
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) m) (StoredProcedureInfo b)
-&gt; WriterT (Seq CollectItem) m (Maybe (StoredProcedureInfo b))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1069"></span><span>                </span><span class="annot"><span class="annottext">Bool
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CacheStaticConfig -&gt; Bool
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cscAreStoredProceduresEnabled"><span class="hs-identifier hs-var">_cscAreStoredProceduresEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">CacheStaticConfig
</span><a href="#local-6989586621687412838"><span class="hs-identifier hs-var">cacheStaticConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1070"></span><span>                  </span><span class="annot"><span class="annottext">(ExceptT QErr (WriterT (Seq CollectItem) m) ()
 -&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ())
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#InvalidConfiguration"><span class="hs-identifier hs-var">InvalidConfiguration</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The Stored Procedure feature is disabled&quot;</span></span><span>
</span><span id="line-1071"></span><span>
</span><span id="line-1072"></span><span>                </span><span id="local-6989586621687412948"><span class="annot"><span class="annottext">LogicalModelInfo b
</span><a href="#local-6989586621687412948"><span class="hs-identifier hs-var">logicalModel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1073"></span><span>                  </span><span class="annot"><span class="annottext">Maybe (LogicalModelInfo b)
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) (LogicalModelInfo b)
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) (LogicalModelInfo b)
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#onNothing"><span class="hs-identifier hs-var">onNothing</span></a></span><span>
</span><span id="line-1074"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LogicalModelName
-&gt; LogicalModelCache b -&gt; Maybe (LogicalModelInfo b)
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#lookup"><span class="hs-identifier hs-var">HashMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelName
</span><a href="#local-6989586621687412934"><span class="hs-identifier hs-var">_spmReturns</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelCache b
</span><a href="#local-6989586621687412875"><span class="hs-identifier hs-var">logicalModelsCache</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1075"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Code
-&gt; Text
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) (LogicalModelInfo b)
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#InvalidConfiguration"><span class="hs-identifier hs-var">InvalidConfiguration</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The logical model &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">LogicalModelName -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelName
</span><a href="#local-6989586621687412934"><span class="hs-identifier hs-var">_spmReturns</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; could not be found&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1076"></span><span>
</span><span id="line-1077"></span><span>                </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(BackendMetadata b, MonadIO m, MonadError QErr m) =&gt;
Environment
-&gt; SourceConnConfiguration b
-&gt; LogicalModelInfo b
-&gt; StoredProcedureMetadata b
-&gt; m ()
</span><a href="Hasura.RQL.Types.Metadata.Backend.html#validateStoredProcedure"><span class="hs-identifier hs-var">validateStoredProcedure</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621687411809"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceMetadata b -&gt; SourceConnConfiguration b
forall (b :: BackendType).
SourceMetadata b -&gt; SourceConnConfiguration b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smConfiguration"><span class="hs-identifier hs-var">_smConfiguration</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687412729"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LogicalModelInfo b
</span><a href="#local-6989586621687412948"><span class="hs-identifier hs-var">logicalModel</span></a></span><span> </span><span class="annot"><span class="annottext">StoredProcedureMetadata b
</span><a href="#local-6989586621687412930"><span class="hs-identifier hs-var">spm</span></a></span><span>
</span><span id="line-1078"></span><span>
</span><span id="line-1079"></span><span>                </span><span class="annot"><span class="annottext">MetadataObject
-&gt; SchemaObjId
-&gt; Seq SchemaDependency
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; SchemaObjId -&gt; Seq SchemaDependency -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordDependenciesM"><span class="hs-identifier hs-var">recordDependenciesM</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687412942"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaObjId
</span><a href="#local-6989586621687412944"><span class="hs-identifier hs-var">schemaObjId</span></a></span><span>
</span><span id="line-1080"></span><span>                  </span><span class="annot"><span class="annottext">(Seq SchemaDependency
 -&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ())
-&gt; Seq SchemaDependency
-&gt; ExceptT QErr (WriterT (Seq CollectItem) m) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SchemaDependency -&gt; Seq SchemaDependency
forall a. a -&gt; Seq a
</span><span class="hs-identifier hs-var">Seq.singleton</span></span><span> </span><span class="annot"><span class="annottext">SchemaDependency
</span><a href="#local-6989586621687412946"><span class="hs-keyword hs-var">dependency</span></a></span><span>
</span><span id="line-1081"></span><span>
</span><span id="line-1082"></span><span>                </span><span id="local-6989586621687412950"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621687412950"><span class="hs-identifier hs-var">graphqlName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(BackendMetadata b, MonadError QErr m) =&gt;
FunctionName b -&gt; StoredProcedureConfig -&gt; m Name
</span><a href="Hasura.RQL.Types.Metadata.Backend.html#getStoredProcedureGraphqlName"><span class="hs-identifier hs-var">getStoredProcedureGraphqlName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621687412932"><span class="hs-identifier hs-var">_spmStoredProcedure</span></a></span><span> </span><span class="annot"><span class="annottext">StoredProcedureConfig
</span><a href="#local-6989586621687412933"><span class="hs-identifier hs-var">_spmConfig</span></a></span><span>
</span><span id="line-1083"></span><span>
</span><span id="line-1084"></span><span>                </span><span class="annot"><span class="annottext">StoredProcedureInfo b
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) m) (StoredProcedureInfo b)
forall a. a -&gt; ExceptT QErr (WriterT (Seq CollectItem) m) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-1085"></span><span>                  </span><span class="annot"><a href="Hasura.StoredProcedure.Cache.html#StoredProcedureInfo"><span class="hs-identifier hs-type">StoredProcedureInfo</span></a></span><span>
</span><span id="line-1086"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_spiStoredProcedure :: FunctionName b
</span><a href="Hasura.StoredProcedure.Cache.html#_spiStoredProcedure"><span class="hs-identifier hs-var">_spiStoredProcedure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621687412932"><span class="hs-identifier hs-var">_spmStoredProcedure</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1087"></span><span>                      </span><span class="annot"><span class="annottext">_spiGraphqlName :: Name
</span><a href="Hasura.StoredProcedure.Cache.html#_spiGraphqlName"><span class="hs-identifier hs-var">_spiGraphqlName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621687412950"><span class="hs-identifier hs-var">graphqlName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1088"></span><span>                      </span><span class="annot"><span class="annottext">_spiConfig :: StoredProcedureConfig
</span><a href="Hasura.StoredProcedure.Cache.html#_spiConfig"><span class="hs-identifier hs-var">_spiConfig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StoredProcedureConfig
</span><a href="#local-6989586621687412933"><span class="hs-identifier hs-var">_spmConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1089"></span><span>                      </span><span class="annot"><span class="annottext">_spiReturns :: LogicalModelInfo b
</span><a href="Hasura.StoredProcedure.Cache.html#_spiReturns"><span class="hs-identifier hs-var">_spiReturns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogicalModelInfo b
</span><a href="#local-6989586621687412948"><span class="hs-identifier hs-var">logicalModel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1090"></span><span>                      </span><span class="annot"><span class="annottext">_spiArguments :: HashMap ArgumentName (NullableScalarType b)
</span><a href="Hasura.StoredProcedure.Cache.html#_spiArguments"><span class="hs-identifier hs-var">_spiArguments</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap ArgumentName (NullableScalarType b)
</span><a href="#local-6989586621687412935"><span class="hs-identifier hs-var">_spmArguments</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1091"></span><span>                      </span><span class="annot"><span class="annottext">_spiDescription :: Maybe Text
</span><a href="Hasura.StoredProcedure.Cache.html#_spiDescription"><span class="hs-identifier hs-var">_spiDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687412936"><span class="hs-identifier hs-var">_spmDescription</span></a></span><span>
</span><span id="line-1092"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-1093"></span><span>
</span><span id="line-1094"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621687412959"><span class="hs-identifier hs-type">storedProcedureCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.StoredProcedure.Cache.html#StoredProcedureCache"><span class="hs-identifier hs-type">StoredProcedureCache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410264"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-1095"></span><span>          </span><span id="local-6989586621687412959"><span class="annot"><span class="annottext">storedProcedureCache :: StoredProcedureCache b
</span><a href="#local-6989586621687412959"><span class="hs-identifier hs-var hs-var">storedProcedureCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StoredProcedureInfo b -&gt; FunctionName b)
-&gt; [StoredProcedureInfo b] -&gt; StoredProcedureCache b
forall k a. Hashable k =&gt; (a -&gt; k) -&gt; [a] -&gt; HashMap k a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#mapFromL"><span class="hs-identifier hs-var">mapFromL</span></a></span><span> </span><span class="annot"><span class="annottext">StoredProcedureInfo b -&gt; FunctionName b
forall (b :: BackendType). StoredProcedureInfo b -&gt; FunctionName b
</span><a href="Hasura.StoredProcedure.Cache.html#_spiStoredProcedure"><span class="hs-identifier hs-var">_spiStoredProcedure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe (StoredProcedureInfo b)] -&gt; [StoredProcedureInfo b]
forall a. [Maybe a] -&gt; [a]
forall (f :: * -&gt; *) a. Filterable f =&gt; f (Maybe a) -&gt; f a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/witherable-0.4.2-a40f3f0a2ed7f25145b5b00589bf4ea2486662b1e96b7d29d5e6041625ee4a09/share/doc/html/src/Witherable.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe (StoredProcedureInfo b)]
</span><a href="#local-6989586621687412929"><span class="hs-identifier hs-var">storedProcedureCacheMaybes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1096"></span><span>
</span><span id="line-1097"></span><span>      </span><span class="annot"><span class="annottext">arr (SourceInfo b) (SourceInfo b)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">SourceName
-&gt; BackendSourceKind b
-&gt; HashMap (TableName b) (TableInfo b)
-&gt; HashMap (FunctionName b) (FunctionInfo b)
-&gt; NativeQueryCache b
-&gt; StoredProcedureCache b
-&gt; LogicalModelCache b
-&gt; SourceConfig b
-&gt; Maybe QueryTagsConfig
-&gt; ResolvedSourceCustomization
-&gt; DBObjectsIntrospection b
-&gt; SourceInfo b
forall (b :: BackendType).
SourceName
-&gt; BackendSourceKind b
-&gt; TableCache b
-&gt; FunctionCache b
-&gt; NativeQueryCache b
-&gt; StoredProcedureCache b
-&gt; LogicalModelCache b
-&gt; SourceConfig b
-&gt; Maybe QueryTagsConfig
-&gt; ResolvedSourceCustomization
-&gt; DBObjectsIntrospection b
-&gt; SourceInfo b
</span><a href="Hasura.RQL.Types.Source.html#SourceInfo"><span class="hs-identifier hs-var">SourceInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687412742"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">BackendSourceKind b
</span><a href="#local-6989586621687412743"><span class="hs-identifier hs-var">backendSourceKind</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (TableName b) (TableInfo b)
</span><a href="#local-6989586621687412783"><span class="hs-identifier hs-var">tableCache</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (FunctionName b) (FunctionInfo b)
</span><a href="#local-6989586621687412832"><span class="hs-identifier hs-var">functionCache</span></a></span><span> </span><span class="annot"><span class="annottext">NativeQueryCache b
</span><a href="#local-6989586621687412928"><span class="hs-identifier hs-var">nativeQueryCache</span></a></span><span> </span><span class="annot"><span class="annottext">StoredProcedureCache b
</span><a href="#local-6989586621687412959"><span class="hs-identifier hs-var">storedProcedureCache</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelCache b
</span><a href="#local-6989586621687412875"><span class="hs-identifier hs-var">logicalModelsCache</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687412730"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe QueryTagsConfig
</span><a href="#local-6989586621687412749"><span class="hs-identifier hs-var">queryTagsConfig</span></a></span><span> </span><span class="annot"><span class="annottext">ResolvedSourceCustomization
</span><a href="#local-6989586621687412792"><span class="hs-identifier hs-var">resolvedCustomization</span></a></span><span> </span><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621687412733"><span class="hs-identifier hs-var">dbObjectsIntrospection</span></a></span><span>
</span><span id="line-1098"></span><span>
</span><span id="line-1099"></span><span>    </span><span class="annot"><a href="#local-6989586621687412018"><span class="hs-identifier hs-type">buildAndCollectInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1100"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687410063"><span class="annot"><a href="#local-6989586621687410063"><span class="hs-identifier hs-type">arr</span></a></span></span><span> </span><span id="local-6989586621687410064"><span class="annot"><a href="#local-6989586621687410064"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1101"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ArrowChoice</span></span><span> </span><span class="annot"><a href="#local-6989586621687410063"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1102"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Rule.html#ArrowDistribute"><span class="hs-identifier hs-type">Inc.ArrowDistribute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410063"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1103"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#ArrowCache"><span class="hs-identifier hs-type">Inc.ArrowCache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410064"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410063"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1104"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#ArrowWriter"><span class="hs-identifier hs-type">ArrowWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687410063"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1105"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687410064"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1106"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410064"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1107"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#BuildReason"><span class="hs-identifier hs-type">BuildReason</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410064"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1108"></span><span>        </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-92f8a47f193bc8ca499a8b94581fad6cb68b7a26370b271798ac2ec617c05064/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687410064"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1109"></span><span>        </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410064"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1110"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410064"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1111"></span><span>        </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#HasCacheStaticConfig"><span class="hs-identifier hs-type">HasCacheStaticConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410064"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-1112"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1113"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#CacheDynamicConfig"><span class="hs-identifier hs-type">CacheDynamicConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Dependency.html#Dependency"><span class="hs-identifier hs-type">Inc.Dependency</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#Metadata"><span class="hs-identifier hs-type">Metadata</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Dependency.html#Dependency"><span class="hs-identifier hs-type">Inc.Dependency</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#InvalidationKeys"><span class="hs-identifier hs-type">InvalidationKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#StoredIntrospection"><span class="hs-identifier hs-type">StoredIntrospection</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687410063"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#BuildOutputs"><span class="hs-identifier hs-type">BuildOutputs</span></a></span><span>
</span><span id="line-1114"></span><span>    </span><span id="local-6989586621687412018"><span class="annot"><span class="annottext">buildAndCollectInfo :: forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowDistribute arr, ArrowCache m arr,
 ArrowWriter (Seq CollectItem) arr, MonadIO m, MonadError QErr m,
 MonadReader BuildReason m, MonadBaseControl IO m,
 ProvidesNetwork m, MonadResolveSource m, HasCacheStaticConfig m) =&gt;
arr
  (CacheDynamicConfig, Dependency Metadata,
   Dependency InvalidationKeys, Maybe StoredIntrospection)
  BuildOutputs
</span><a href="#local-6989586621687412018"><span class="hs-identifier hs-var hs-var">buildAndCollectInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687413194"><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687413194"><span class="hs-identifier hs-var">dynamicConfig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687413195"><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621687413195"><span class="hs-identifier hs-var">metadataDep</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687413196"><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621687413196"><span class="hs-identifier hs-var">invalidationKeys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687413197"><span class="annot"><span class="annottext">Maybe StoredIntrospection
</span><a href="#local-6989586621687413197"><span class="hs-identifier hs-var">storedIntrospection</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1115"></span><span>      </span><span id="local-6989586621687413198"><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621687413198"><span class="hs-identifier hs-var">sources</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr
  (Dependency (InsOrdHashMap SourceName BackendSourceMetadata))
  (InsOrdHashMap SourceName BackendSourceMetadata)
forall a. Eq a =&gt; arr (Dependency a) a
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
(ArrowCache m arr, Eq a) =&gt;
arr (Dependency a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#dependOn"><span class="hs-identifier hs-var">Inc.dependOn</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Selector Metadata (InsOrdHashMap SourceName BackendSourceMetadata)
-&gt; Dependency Metadata
-&gt; Dependency (InsOrdHashMap SourceName BackendSourceMetadata)
forall a b.
Select a =&gt;
Selector a b -&gt; Dependency a -&gt; Dependency b
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Dependency.html#selectD"><span class="hs-identifier hs-var">Inc.selectD</span></a></span><span> </span><span class="annot"><span class="annottext">FieldS Metadata (InsOrdHashMap SourceName BackendSourceMetadata)
Selector Metadata (InsOrdHashMap SourceName BackendSourceMetadata)
</span><span class="">#_metaSources</span></span><span> </span><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621687413195"><span class="hs-identifier hs-var">metadataDep</span></a></span><span>
</span><span id="line-1116"></span><span>      </span><span id="local-6989586621687413200"><span class="annot"><span class="annottext">RemoteSchemas
</span><a href="#local-6989586621687413200"><span class="hs-identifier hs-var">remoteSchemas</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr (Dependency RemoteSchemas) RemoteSchemas
forall a. Eq a =&gt; arr (Dependency a) a
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
(ArrowCache m arr, Eq a) =&gt;
arr (Dependency a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#dependOn"><span class="hs-identifier hs-var">Inc.dependOn</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Selector Metadata RemoteSchemas
-&gt; Dependency Metadata -&gt; Dependency RemoteSchemas
forall a b.
Select a =&gt;
Selector a b -&gt; Dependency a -&gt; Dependency b
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Dependency.html#selectD"><span class="hs-identifier hs-var">Inc.selectD</span></a></span><span> </span><span class="annot"><span class="annottext">FieldS Metadata RemoteSchemas
Selector Metadata RemoteSchemas
</span><span class="">#_metaRemoteSchemas</span></span><span> </span><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621687413195"><span class="hs-identifier hs-var">metadataDep</span></a></span><span>
</span><span id="line-1117"></span><span>      </span><span id="local-6989586621687413201"><span class="annot"><span class="annottext">CustomTypes
</span><a href="#local-6989586621687413201"><span class="hs-identifier hs-var">customTypes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr (Dependency CustomTypes) CustomTypes
forall a. Eq a =&gt; arr (Dependency a) a
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
(ArrowCache m arr, Eq a) =&gt;
arr (Dependency a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#dependOn"><span class="hs-identifier hs-var">Inc.dependOn</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Selector Metadata CustomTypes
-&gt; Dependency Metadata -&gt; Dependency CustomTypes
forall a b.
Select a =&gt;
Selector a b -&gt; Dependency a -&gt; Dependency b
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Dependency.html#selectD"><span class="hs-identifier hs-var">Inc.selectD</span></a></span><span> </span><span class="annot"><span class="annottext">FieldS Metadata CustomTypes
Selector Metadata CustomTypes
</span><span class="">#_metaCustomTypes</span></span><span> </span><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621687413195"><span class="hs-identifier hs-var">metadataDep</span></a></span><span>
</span><span id="line-1118"></span><span>      </span><span id="local-6989586621687413202"><span class="annot"><span class="annottext">Actions
</span><a href="#local-6989586621687413202"><span class="hs-identifier hs-var">actions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr (Dependency Actions) Actions
forall a. Eq a =&gt; arr (Dependency a) a
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
(ArrowCache m arr, Eq a) =&gt;
arr (Dependency a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#dependOn"><span class="hs-identifier hs-var">Inc.dependOn</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Selector Metadata Actions
-&gt; Dependency Metadata -&gt; Dependency Actions
forall a b.
Select a =&gt;
Selector a b -&gt; Dependency a -&gt; Dependency b
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Dependency.html#selectD"><span class="hs-identifier hs-var">Inc.selectD</span></a></span><span> </span><span class="annot"><span class="annottext">FieldS Metadata Actions
Selector Metadata Actions
</span><span class="">#_metaActions</span></span><span> </span><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621687413195"><span class="hs-identifier hs-var">metadataDep</span></a></span><span>
</span><span id="line-1119"></span><span>      </span><span id="local-6989586621687413203"><span class="annot"><span class="annottext">InheritedRoles
</span><a href="#local-6989586621687413203"><span class="hs-identifier hs-var">inheritedRoles</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr (Dependency InheritedRoles) InheritedRoles
forall a. Eq a =&gt; arr (Dependency a) a
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
(ArrowCache m arr, Eq a) =&gt;
arr (Dependency a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#dependOn"><span class="hs-identifier hs-var">Inc.dependOn</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Selector Metadata InheritedRoles
-&gt; Dependency Metadata -&gt; Dependency InheritedRoles
forall a b.
Select a =&gt;
Selector a b -&gt; Dependency a -&gt; Dependency b
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Dependency.html#selectD"><span class="hs-identifier hs-var">Inc.selectD</span></a></span><span> </span><span class="annot"><span class="annottext">FieldS Metadata InheritedRoles
Selector Metadata InheritedRoles
</span><span class="">#_metaInheritedRoles</span></span><span> </span><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621687413195"><span class="hs-identifier hs-var">metadataDep</span></a></span><span>
</span><span id="line-1120"></span><span>      </span><span id="local-6989586621687413204"><span class="annot"><span class="annottext">BackendMap BackendConfigWrapper
</span><a href="#local-6989586621687413204"><span class="hs-identifier hs-var">backendConfigs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr
  (Dependency (BackendMap BackendConfigWrapper))
  (BackendMap BackendConfigWrapper)
forall a. Eq a =&gt; arr (Dependency a) a
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
(ArrowCache m arr, Eq a) =&gt;
arr (Dependency a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#dependOn"><span class="hs-identifier hs-var">Inc.dependOn</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Selector Metadata (BackendMap BackendConfigWrapper)
-&gt; Dependency Metadata
-&gt; Dependency (BackendMap BackendConfigWrapper)
forall a b.
Select a =&gt;
Selector a b -&gt; Dependency a -&gt; Dependency b
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Dependency.html#selectD"><span class="hs-identifier hs-var">Inc.selectD</span></a></span><span> </span><span class="annot"><span class="annottext">FieldS Metadata (BackendMap BackendConfigWrapper)
Selector Metadata (BackendMap BackendConfigWrapper)
</span><span class="">#_metaBackendConfigs</span></span><span> </span><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621687413195"><span class="hs-identifier hs-var">metadataDep</span></a></span><span>
</span><span id="line-1121"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687413205"><span class="annot"><span class="annottext">actionRoles :: [RoleName]
</span><a href="#local-6989586621687413205"><span class="hs-identifier hs-var hs-var">actionRoles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ActionPermissionMetadata -&gt; RoleName)
-&gt; [ActionPermissionMetadata] -&gt; [RoleName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ActionPermissionMetadata -&gt; RoleName
</span><a href="Hasura.RQL.Types.Action.html#_apmRole"><span class="hs-identifier hs-var">_apmRole</span></a></span><span> </span><span class="annot"><span class="annottext">([ActionPermissionMetadata] -&gt; [RoleName])
-&gt; (ActionMetadata -&gt; [ActionPermissionMetadata])
-&gt; ActionMetadata
-&gt; [RoleName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ActionMetadata -&gt; [ActionPermissionMetadata]
</span><a href="Hasura.RQL.Types.Action.html#_amPermissions"><span class="hs-identifier hs-var">_amPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">(ActionMetadata -&gt; [RoleName]) -&gt; [ActionMetadata] -&gt; [RoleName]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Actions -&gt; [ActionMetadata]
forall k v. InsOrdHashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#elems"><span class="hs-identifier hs-var">InsOrdHashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">Actions
</span><a href="#local-6989586621687413202"><span class="hs-identifier hs-var">actions</span></a></span><span>
</span><span id="line-1122"></span><span>          </span><span id="local-6989586621687413208"><span class="annot"><span class="annottext">remoteSchemaRoles :: [RoleName]
</span><a href="#local-6989586621687413208"><span class="hs-identifier hs-var hs-var">remoteSchemaRoles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RemoteSchemaPermissionMetadata -&gt; RoleName)
-&gt; [RemoteSchemaPermissionMetadata] -&gt; [RoleName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaPermissionMetadata -&gt; RoleName
</span><a href="Hasura.RemoteSchema.Metadata.Permission.html#_rspmRole"><span class="hs-identifier hs-var">_rspmRole</span></a></span><span> </span><span class="annot"><span class="annottext">([RemoteSchemaPermissionMetadata] -&gt; [RoleName])
-&gt; (RemoteSchemaMetadataG RemoteRelationshipDefinition
    -&gt; [RemoteSchemaPermissionMetadata])
-&gt; RemoteSchemaMetadataG RemoteRelationshipDefinition
-&gt; [RoleName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaMetadataG RemoteRelationshipDefinition
-&gt; [RemoteSchemaPermissionMetadata]
forall r.
RemoteSchemaMetadataG r -&gt; [RemoteSchemaPermissionMetadata]
</span><a href="Hasura.RemoteSchema.Metadata.Core.html#_rsmPermissions"><span class="hs-identifier hs-var">_rsmPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">(RemoteSchemaMetadataG RemoteRelationshipDefinition -&gt; [RoleName])
-&gt; [RemoteSchemaMetadataG RemoteRelationshipDefinition]
-&gt; [RoleName]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">RemoteSchemas
-&gt; [RemoteSchemaMetadataG RemoteRelationshipDefinition]
forall k v. InsOrdHashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#elems"><span class="hs-identifier hs-var">InsOrdHashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemas
</span><a href="#local-6989586621687413200"><span class="hs-identifier hs-var">remoteSchemas</span></a></span><span>
</span><span id="line-1123"></span><span>          </span><span id="local-6989586621687413211"><span class="annot"><span class="annottext">sourceRoles :: HashSet RoleName
</span><a href="#local-6989586621687413211"><span class="hs-identifier hs-var hs-var">sourceRoles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1124"></span><span>            </span><span class="annot"><span class="annottext">[RoleName] -&gt; HashSet RoleName
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashSet.Internal.html#fromList"><span class="hs-identifier hs-var">HS.fromList</span></a></span><span>
</span><span id="line-1125"></span><span>              </span><span class="annot"><span class="annottext">([RoleName] -&gt; HashSet RoleName) -&gt; [RoleName] -&gt; HashSet RoleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[RoleName]] -&gt; [RoleName]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-1126"></span><span>              </span><span class="annot"><span class="annottext">([[RoleName]] -&gt; [RoleName]) -&gt; [[RoleName]] -&gt; [RoleName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
-&gt; [BackendSourceMetadata]
forall k v. InsOrdHashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#elems"><span class="hs-identifier hs-var">InsOrdHashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621687413198"><span class="hs-identifier hs-var">sources</span></a></span><span>
</span><span id="line-1127"></span><span>              </span><span class="annot"><span class="annottext">[BackendSourceMetadata]
-&gt; (BackendSourceMetadata -&gt; [[RoleName]]) -&gt; [[RoleName]]
forall a b. [a] -&gt; (a -&gt; [b]) -&gt; [b]
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#BackendSourceMetadata"><span class="hs-identifier hs-type">BackendSourceMetadata</span></a></span><span> </span><span id="local-6989586621687413214"><span class="annot"><span class="annottext">AnyBackend SourceMetadata
</span><a href="#local-6989586621687413214"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1128"></span><span>                </span><span class="annot"><span class="annottext">forall (c :: BackendType -&gt; Constraint) (i :: BackendType -&gt; *) r.
AllBackendsSatisfy c =&gt;
AnyBackend i -&gt; (forall (b :: BackendType). c b =&gt; i b -&gt; r) -&gt; r
</span><a href="Hasura.SQL.AnyBackend.html#dispatchAnyBackend"><span class="hs-identifier hs-var">AB.dispatchAnyBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="annottext">AnyBackend SourceMetadata
</span><a href="#local-6989586621687413214"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SourceMetadata"><span class="hs-identifier hs-type">SourceMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BackendSourceKind b
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621687413223"><span class="annot"><span class="annottext">Tables b
</span><a href="#local-6989586621687413223"><span class="hs-identifier hs-var">tables</span></a></span></span><span> </span><span id="local-6989586621687413224"><span class="annot"><span class="annottext">Functions b
</span><a href="#local-6989586621687413224"><span class="hs-identifier hs-var">_functions</span></a></span></span><span> </span><span id="local-6989586621687413225"><span class="annot"><span class="annottext">NativeQueries b
</span><a href="#local-6989586621687413225"><span class="hs-identifier hs-var">_nativeQueries</span></a></span></span><span> </span><span id="local-6989586621687413226"><span class="annot"><span class="annottext">StoredProcedures b
</span><a href="#local-6989586621687413226"><span class="hs-identifier hs-var">_storedProcedures</span></a></span></span><span> </span><span id="local-6989586621687413227"><span class="annot"><span class="annottext">LogicalModels b
</span><a href="#local-6989586621687413227"><span class="hs-identifier hs-var">_logicalModels</span></a></span></span><span> </span><span class="annot"><span class="annottext">SourceConnConfiguration b
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe QueryTagsConfig
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SourceCustomization
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (HealthCheckConfig b)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1129"></span><span>                  </span><span id="local-6989586621687413228"><span class="annot"><span class="annottext">TableMetadata b
</span><a href="#local-6989586621687413228"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tables b -&gt; [TableMetadata b]
forall k v. InsOrdHashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#elems"><span class="hs-identifier hs-var">InsOrdHashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">Tables b
</span><a href="#local-6989586621687413223"><span class="hs-identifier hs-var">tables</span></a></span><span>
</span><span id="line-1130"></span><span>                  </span><span class="annot"><span class="annottext">[RoleName] -&gt; [[RoleName]]
forall a. a -&gt; [a]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-1131"></span><span>                    </span><span class="annot"><span class="annottext">([RoleName] -&gt; [[RoleName]]) -&gt; [RoleName] -&gt; [[RoleName]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap RoleName (InsPermDef b) -&gt; [RoleName]
forall k v. InsOrdHashMap k v -&gt; [k]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#keys"><span class="hs-identifier hs-var">InsOrdHashMap.keys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableMetadata b -&gt; InsOrdHashMap RoleName (InsPermDef b)
forall (b :: BackendType).
TableMetadata b -&gt; Permissions (InsPermDef b)
</span><a href="Hasura.Table.Metadata.html#_tmInsertPermissions"><span class="hs-identifier hs-var">_tmInsertPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">TableMetadata b
</span><a href="#local-6989586621687413228"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1132"></span><span>                    </span><span class="annot"><span class="annottext">[RoleName] -&gt; [RoleName] -&gt; [RoleName]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap RoleName (SelPermDef b) -&gt; [RoleName]
forall k v. InsOrdHashMap k v -&gt; [k]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#keys"><span class="hs-identifier hs-var">InsOrdHashMap.keys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableMetadata b -&gt; InsOrdHashMap RoleName (SelPermDef b)
forall (b :: BackendType).
TableMetadata b -&gt; Permissions (SelPermDef b)
</span><a href="Hasura.Table.Metadata.html#_tmSelectPermissions"><span class="hs-identifier hs-var">_tmSelectPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">TableMetadata b
</span><a href="#local-6989586621687413228"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1133"></span><span>                    </span><span class="annot"><span class="annottext">[RoleName] -&gt; [RoleName] -&gt; [RoleName]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap RoleName (UpdPermDef b) -&gt; [RoleName]
forall k v. InsOrdHashMap k v -&gt; [k]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#keys"><span class="hs-identifier hs-var">InsOrdHashMap.keys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableMetadata b -&gt; InsOrdHashMap RoleName (UpdPermDef b)
forall (b :: BackendType).
TableMetadata b -&gt; Permissions (UpdPermDef b)
</span><a href="Hasura.Table.Metadata.html#_tmUpdatePermissions"><span class="hs-identifier hs-var">_tmUpdatePermissions</span></a></span><span> </span><span class="annot"><span class="annottext">TableMetadata b
</span><a href="#local-6989586621687413228"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1134"></span><span>                    </span><span class="annot"><span class="annottext">[RoleName] -&gt; [RoleName] -&gt; [RoleName]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap RoleName (DelPermDef b) -&gt; [RoleName]
forall k v. InsOrdHashMap k v -&gt; [k]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#keys"><span class="hs-identifier hs-var">InsOrdHashMap.keys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableMetadata b -&gt; InsOrdHashMap RoleName (DelPermDef b)
forall (b :: BackendType).
TableMetadata b -&gt; Permissions (DelPermDef b)
</span><a href="Hasura.Table.Metadata.html#_tmDeletePermissions"><span class="hs-identifier hs-var">_tmDeletePermissions</span></a></span><span> </span><span class="annot"><span class="annottext">TableMetadata b
</span><a href="#local-6989586621687413228"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1135"></span><span>          </span><span id="local-6989586621687413233"><span class="annot"><span class="annottext">inheritedRoleNames :: [RoleName]
</span><a href="#local-6989586621687413233"><span class="hs-identifier hs-var hs-var">inheritedRoleNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InheritedRoles -&gt; [RoleName]
forall k v. InsOrdHashMap k v -&gt; [k]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#keys"><span class="hs-identifier hs-var">InsOrdHashMap.keys</span></a></span><span> </span><span class="annot"><span class="annottext">InheritedRoles
</span><a href="#local-6989586621687413203"><span class="hs-identifier hs-var">inheritedRoles</span></a></span><span>
</span><span id="line-1136"></span><span>          </span><span id="local-6989586621687413234"><span class="annot"><span class="annottext">allRoleNames :: HashSet RoleName
</span><a href="#local-6989586621687413234"><span class="hs-identifier hs-var hs-var">allRoleNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet RoleName
</span><a href="#local-6989586621687413211"><span class="hs-identifier hs-var">sourceRoles</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet RoleName -&gt; HashSet RoleName -&gt; HashSet RoleName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[RoleName] -&gt; HashSet RoleName
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashSet.Internal.html#fromList"><span class="hs-identifier hs-var">HS.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[RoleName]
</span><a href="#local-6989586621687413208"><span class="hs-identifier hs-var">remoteSchemaRoles</span></a></span><span> </span><span class="annot"><span class="annottext">[RoleName] -&gt; [RoleName] -&gt; [RoleName]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[RoleName]
</span><a href="#local-6989586621687413205"><span class="hs-identifier hs-var">actionRoles</span></a></span><span> </span><span class="annot"><span class="annottext">[RoleName] -&gt; [RoleName] -&gt; [RoleName]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[RoleName]
</span><a href="#local-6989586621687413233"><span class="hs-identifier hs-var">inheritedRoleNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1137"></span><span>
</span><span id="line-1138"></span><span>      </span><span class="hs-comment">-- roles which have some kind of permission (action/remote schema/table/function) set in the metadata</span><span>
</span><span id="line-1139"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687413235"><span class="annot"><span class="annottext">metadataRoles :: HashMap RoleName Role
</span><a href="#local-6989586621687413235"><span class="hs-identifier hs-var hs-var">metadataRoles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Role -&gt; RoleName) -&gt; [Role] -&gt; HashMap RoleName Role
forall k a. Hashable k =&gt; (a -&gt; k) -&gt; [a] -&gt; HashMap k a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#mapFromL"><span class="hs-identifier hs-var">mapFromL</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; RoleName
</span><a href="Hasura.RQL.Types.Roles.html#_rRoleName"><span class="hs-identifier hs-var">_rRoleName</span></a></span><span> </span><span class="annot"><span class="annottext">([Role] -&gt; HashMap RoleName Role)
-&gt; [Role] -&gt; HashMap RoleName Role
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RoleName -&gt; ParentRoles -&gt; Role
</span><a href="Hasura.RQL.Types.Roles.html#Role"><span class="hs-operator hs-var">`Role`</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet RoleName -&gt; ParentRoles
</span><a href="Hasura.RQL.Types.Roles.html#ParentRoles"><span class="hs-identifier hs-var">ParentRoles</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet RoleName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(RoleName -&gt; Role) -&gt; [RoleName] -&gt; [Role]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashSet RoleName -&gt; [RoleName]
forall a. HashSet a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">HashSet RoleName
</span><a href="#local-6989586621687413234"><span class="hs-identifier hs-var">allRoleNames</span></a></span><span>
</span><span id="line-1140"></span><span>
</span><span id="line-1141"></span><span>      </span><span id="local-6989586621687413239"><span class="annot"><span class="annottext">HashMap RoleName Role
</span><a href="#local-6989586621687413239"><span class="hs-identifier hs-var">resolvedInheritedRoles</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr
  (Writer (Seq CollectItem) (HashMap RoleName Role))
  (HashMap RoleName Role)
forall w (arr :: * -&gt; * -&gt; *) a.
ArrowWriter w arr =&gt;
arr (Writer w a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Interpret.html#interpretWriter"><span class="hs-identifier hs-var">interpretWriter</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">HashSet RoleName
-&gt; [Role] -&gt; Writer (Seq CollectItem) (HashMap RoleName Role)
forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
HashSet RoleName -&gt; [Role] -&gt; m (HashMap RoleName Role)
</span><a href="#local-6989586621687413240"><span class="hs-identifier hs-var">buildInheritedRoles</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet RoleName
</span><a href="#local-6989586621687413234"><span class="hs-identifier hs-var">allRoleNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InheritedRoles -&gt; [Role]
forall k v. InsOrdHashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#elems"><span class="hs-identifier hs-var">InsOrdHashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">InheritedRoles
</span><a href="#local-6989586621687413203"><span class="hs-identifier hs-var">inheritedRoles</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1142"></span><span>
</span><span id="line-1143"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687413241"><span class="annot"><span class="annottext">allRoles :: HashMap RoleName Role
</span><a href="#local-6989586621687413241"><span class="hs-identifier hs-var hs-var">allRoles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap RoleName Role
</span><a href="#local-6989586621687413239"><span class="hs-identifier hs-var">resolvedInheritedRoles</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap RoleName Role
-&gt; HashMap RoleName Role -&gt; HashMap RoleName Role
forall k v.
(Eq k, Hashable k) =&gt;
HashMap k v -&gt; HashMap k v -&gt; HashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#union"><span class="hs-operator hs-var">`HashMap.union`</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap RoleName Role
</span><a href="#local-6989586621687413235"><span class="hs-identifier hs-var">metadataRoles</span></a></span><span>
</span><span id="line-1144"></span><span>
</span><span id="line-1145"></span><span>      </span><span id="local-6989586621687413243"><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621687413243"><span class="hs-identifier hs-var">orderedRoles</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr (m OrderedRoles) OrderedRoles
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html#bindA"><span class="hs-identifier hs-var">bindA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">[Role] -&gt; m OrderedRoles
forall (m :: * -&gt; *). MonadError QErr m =&gt; [Role] -&gt; m OrderedRoles
</span><a href="Hasura.RQL.DDL.Schema.Cache.Permission.html#orderRoles"><span class="hs-identifier hs-var">orderRoles</span></a></span><span> </span><span class="annot"><span class="annottext">([Role] -&gt; m OrderedRoles) -&gt; [Role] -&gt; m OrderedRoles
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap RoleName Role -&gt; [Role]
forall k v. HashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#elems"><span class="hs-identifier hs-var">HashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap RoleName Role
</span><a href="#local-6989586621687413241"><span class="hs-identifier hs-var">allRoles</span></a></span><span>
</span><span id="line-1146"></span><span>
</span><span id="line-1147"></span><span>      </span><span class="hs-comment">-- remote schemas</span><span>
</span><span id="line-1148"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687413245"><span class="annot"><span class="annottext">remoteSchemaInvalidationKeys :: Dependency (HashMap RemoteSchemaName InvalidationKey)
</span><a href="#local-6989586621687413245"><span class="hs-identifier hs-var hs-var">remoteSchemaInvalidationKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Selector
  InvalidationKeys (HashMap RemoteSchemaName InvalidationKey)
-&gt; Dependency InvalidationKeys
-&gt; Dependency (HashMap RemoteSchemaName InvalidationKey)
forall a b.
Select a =&gt;
Selector a b -&gt; Dependency a -&gt; Dependency b
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Dependency.html#selectD"><span class="hs-identifier hs-var">Inc.selectD</span></a></span><span> </span><span class="annot"><span class="annottext">FieldS InvalidationKeys (HashMap RemoteSchemaName InvalidationKey)
Selector
  InvalidationKeys (HashMap RemoteSchemaName InvalidationKey)
</span><span class="">#_ikRemoteSchemas</span></span><span> </span><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621687413196"><span class="hs-identifier hs-var">invalidationKeys</span></a></span><span>
</span><span id="line-1149"></span><span>      </span><span id="local-6989586621687413246"><span class="annot"><span class="annottext">HashMap
  RemoteSchemaName
  (PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition,
   MetadataObject)
</span><a href="#local-6989586621687413246"><span class="hs-identifier hs-var">remoteSchemaMap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; Environment
-&gt; arr
     ((Dependency (HashMap RemoteSchemaName InvalidationKey),
       OrderedRoles, Maybe (HashMap RemoteSchemaName ByteString)),
      [RemoteSchemaMetadataG RemoteRelationshipDefinition])
     (HashMap
        RemoteSchemaName
        (PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition,
         MetadataObject))
forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *)
       remoteRelationshipDefinition.
(ArrowChoice arr, ArrowDistribute arr,
 ArrowWriter (Seq CollectItem) arr, ArrowCache m arr, MonadIO m,
 MonadBaseControl IO m, Eq remoteRelationshipDefinition,
 ToJSON remoteRelationshipDefinition, MonadError QErr m,
 ProvidesNetwork m) =&gt;
Logger Hasura
-&gt; Environment
-&gt; arr
     ((Dependency (HashMap RemoteSchemaName InvalidationKey),
       OrderedRoles, Maybe (HashMap RemoteSchemaName ByteString)),
      [RemoteSchemaMetadataG remoteRelationshipDefinition])
     (HashMap
        RemoteSchemaName
        (PartiallyResolvedRemoteSchemaCtxG remoteRelationshipDefinition,
         MetadataObject))
</span><a href="Hasura.RemoteSchema.SchemaCache.Build.html#buildRemoteSchemas"><span class="hs-identifier hs-var">buildRemoteSchemas</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687411808"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621687411809"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependency (HashMap RemoteSchemaName InvalidationKey)
</span><a href="#local-6989586621687413245"><span class="hs-identifier hs-var">remoteSchemaInvalidationKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621687413243"><span class="hs-identifier hs-var">orderedRoles</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(EncJSON -&gt; ByteString)
-&gt; HashMap RemoteSchemaName EncJSON
-&gt; HashMap RemoteSchemaName ByteString
forall a b.
(a -&gt; b)
-&gt; HashMap RemoteSchemaName a -&gt; HashMap RemoteSchemaName b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; ByteString
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#encJToLBS"><span class="hs-identifier hs-var">encJToLBS</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap RemoteSchemaName EncJSON
 -&gt; HashMap RemoteSchemaName ByteString)
-&gt; (StoredIntrospection -&gt; HashMap RemoteSchemaName EncJSON)
-&gt; StoredIntrospection
-&gt; HashMap RemoteSchemaName ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">StoredIntrospection -&gt; HashMap RemoteSchemaName EncJSON
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#siRemotes"><span class="hs-identifier hs-var">siRemotes</span></a></span><span> </span><span class="annot"><span class="annottext">(StoredIntrospection -&gt; HashMap RemoteSchemaName ByteString)
-&gt; Maybe StoredIntrospection
-&gt; Maybe (HashMap RemoteSchemaName ByteString)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe StoredIntrospection
</span><a href="#local-6989586621687413197"><span class="hs-identifier hs-var">storedIntrospection</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RemoteSchemas
-&gt; [RemoteSchemaMetadataG RemoteRelationshipDefinition]
forall k v. InsOrdHashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#elems"><span class="hs-identifier hs-var">InsOrdHashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemas
</span><a href="#local-6989586621687413200"><span class="hs-identifier hs-var">remoteSchemas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1150"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687413250"><span class="annot"><span class="annottext">remoteSchemaCtxMap :: PartiallyResolvedRemoteSchemaMap
</span><a href="#local-6989586621687413250"><span class="hs-identifier hs-var hs-var">remoteSchemaCtxMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition,
  MetadataObject)
 -&gt; PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition)
-&gt; HashMap
     RemoteSchemaName
     (PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition,
      MetadataObject)
-&gt; PartiallyResolvedRemoteSchemaMap
forall v1 v2 k. (v1 -&gt; v2) -&gt; HashMap k v1 -&gt; HashMap k v2
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.Strict.html#map"><span class="hs-identifier hs-var">HashMap.map</span></a></span><span> </span><span class="annot"><span class="annottext">(PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition,
 MetadataObject)
-&gt; PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">HashMap
  RemoteSchemaName
  (PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition,
   MetadataObject)
</span><a href="#local-6989586621687413246"><span class="hs-identifier hs-var">remoteSchemaMap</span></a></span><span>
</span><span id="line-1151"></span><span>          </span><span class="hs-glyph">!</span><span id="local-6989586621687413252"><span class="annot"><span class="annottext">defaultNC :: NamingCase
</span><a href="#local-6989586621687413252"><span class="hs-identifier hs-var hs-var">defaultNC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig -&gt; NamingCase
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cdcDefaultNamingConvention"><span class="hs-identifier hs-var">_cdcDefaultNamingConvention</span></a></span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687413194"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span>
</span><span id="line-1152"></span><span>          </span><span class="hs-glyph">!</span><span id="local-6989586621687413253"><span class="annot"><span class="annottext">isNamingConventionEnabled :: Bool
</span><a href="#local-6989586621687413253"><span class="hs-identifier hs-var hs-var">isNamingConventionEnabled</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExperimentalFeature
</span><a href="Hasura.Server.Types.html#EFNamingConventions"><span class="hs-identifier hs-var">EFNamingConventions</span></a></span><span> </span><span class="annot"><span class="annottext">ExperimentalFeature -&gt; HashSet ExperimentalFeature -&gt; Bool
forall a. Eq a =&gt; a -&gt; HashSet a -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CacheDynamicConfig -&gt; HashSet ExperimentalFeature
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cdcExperimentalFeatures"><span class="hs-identifier hs-var">_cdcExperimentalFeatures</span></a></span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687413194"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1153"></span><span>
</span><span id="line-1154"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687413254"><span class="annot"><span class="annottext">backendInvalidationKeys :: Dependency (BackendMap BackendInvalidationKeysWrapper)
</span><a href="#local-6989586621687413254"><span class="hs-identifier hs-var hs-var">backendInvalidationKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Selector
  InvalidationKeys (BackendMap BackendInvalidationKeysWrapper)
-&gt; Dependency InvalidationKeys
-&gt; Dependency (BackendMap BackendInvalidationKeysWrapper)
forall a b.
Select a =&gt;
Selector a b -&gt; Dependency a -&gt; Dependency b
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Dependency.html#selectD"><span class="hs-identifier hs-var">Inc.selectD</span></a></span><span> </span><span class="annot"><span class="annottext">FieldS InvalidationKeys (BackendMap BackendInvalidationKeysWrapper)
Selector
  InvalidationKeys (BackendMap BackendInvalidationKeysWrapper)
</span><span class="">#_ikBackends</span></span><span> </span><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621687413196"><span class="hs-identifier hs-var">invalidationKeys</span></a></span><span>
</span><span id="line-1155"></span><span>      </span><span id="local-6989586621687413255"><span class="annot"><span class="annottext">BackendCache
</span><a href="#local-6989586621687413255"><span class="hs-identifier hs-var">backendCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr
  (Dependency (BackendMap BackendInvalidationKeysWrapper),
   [AnyBackend BackendConfigWrapper])
  BackendCache
forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowCache m arr, ArrowDistribute arr,
 ArrowWriter (Seq CollectItem) arr, MonadIO m,
 MonadBaseControl IO m, ProvidesNetwork m,
 HasCacheStaticConfig m) =&gt;
arr
  (Dependency (BackendMap BackendInvalidationKeysWrapper),
   [AnyBackend BackendConfigWrapper])
  BackendCache
</span><a href="#local-6989586621687412078"><span class="hs-identifier hs-var">resolveBackendCache</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependency (BackendMap BackendInvalidationKeysWrapper)
</span><a href="#local-6989586621687413254"><span class="hs-identifier hs-var">backendInvalidationKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BackendMap BackendConfigWrapper
-&gt; [AnyBackend BackendConfigWrapper]
forall (i :: BackendType -&gt; *). BackendMap i -&gt; [AnyBackend i]
</span><a href="Hasura.SQL.BackendMap.html#elems"><span class="hs-identifier hs-var">BackendMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">BackendMap BackendConfigWrapper
</span><a href="#local-6989586621687413204"><span class="hs-identifier hs-var">backendConfigs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1156"></span><span>
</span><span id="line-1157"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687413257"><span class="annot"><span class="annottext">backendInfoAndSourceMetadata :: InsOrdHashMap SourceName (AnyBackend BackendInfoAndSourceMetadata)
</span><a href="#local-6989586621687413257"><span class="hs-identifier hs-var hs-var">backendInfoAndSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BackendCache
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; InsOrdHashMap
     SourceName (AnyBackend BackendInfoAndSourceMetadata)
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#joinBackendInfosToSources"><span class="hs-identifier hs-var">joinBackendInfosToSources</span></a></span><span> </span><span class="annot"><span class="annottext">BackendCache
</span><a href="#local-6989586621687413255"><span class="hs-identifier hs-var">backendCache</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621687413198"><span class="hs-identifier hs-var">sources</span></a></span><span>
</span><span id="line-1158"></span><span>
</span><span id="line-1159"></span><span>      </span><span class="hs-comment">-- sources are build in two steps</span><span>
</span><span id="line-1160"></span><span>      </span><span class="hs-comment">-- first we resolve them, and build the table cache</span><span>
</span><span id="line-1161"></span><span>      </span><span id="local-6989586621687413259"><span class="annot"><span class="annottext">HashMap SourceName (Maybe (AnyBackend PartiallyResolvedSource))
</span><a href="#local-6989586621687413259"><span class="hs-identifier hs-var">partiallyResolvedSourcesMaybes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1162"></span><span>        </span><span class="hs-glyph">(|</span><span>
</span><span id="line-1163"></span><span>          </span><span class="annot"><span class="annottext">arr
  (a, (SourceName, (AnyBackend BackendInfoAndSourceMetadata, ())))
  (Maybe (AnyBackend PartiallyResolvedSource))
-&gt; arr
     (a,
      (HashMap SourceName (AnyBackend BackendInfoAndSourceMetadata), ()))
     (HashMap SourceName (Maybe (AnyBackend PartiallyResolvedSource)))
forall {a}.
arr
  (a, (SourceName, (AnyBackend BackendInfoAndSourceMetadata, ())))
  (Maybe (AnyBackend PartiallyResolvedSource))
-&gt; arr
     (a,
      (HashMap SourceName (AnyBackend BackendInfoAndSourceMetadata), ()))
     (HashMap SourceName (Maybe (AnyBackend PartiallyResolvedSource)))
forall k e a s b.
Hashable k =&gt;
arr (e, (k, (a, s))) b -&gt; arr (e, (HashMap k a, s)) (HashMap k b)
forall (arr :: * -&gt; * -&gt; *) k e a s b.
(ArrowDistribute arr, Hashable k) =&gt;
arr (e, (k, (a, s))) b -&gt; arr (e, (HashMap k a, s)) (HashMap k b)
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Rule.html#keyed"><span class="hs-identifier hs-var">Inc.keyed</span></a></span><span>
</span><span id="line-1164"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621687413263"><span class="annot"><span class="annottext">AnyBackend BackendInfoAndSourceMetadata
</span><a href="#local-6989586621687413263"><span class="hs-identifier hs-var">exists</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1165"></span><span>                </span><span class="annot"><span class="annottext">forall (c1 :: BackendType -&gt; Constraint)
       (c2 :: BackendType -&gt; Constraint) (i :: BackendType -&gt; *) r
       (arr :: * -&gt; * -&gt; *) x.
(ArrowChoice arr, AllBackendsSatisfy c1, AllBackendsSatisfy c2) =&gt;
(forall (b :: BackendType). (c1 b, c2 b) =&gt; arr (i b, x) r)
-&gt; arr (AnyBackend i, x) r
</span><a href="Hasura.SQL.AnyBackend.html#dispatchAnyBackendArrow"><span class="hs-identifier hs-var">AB.dispatchAnyBackendArrow</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.Eventing.Backend.html#BackendEventTrigger"><span class="hs-identifier hs-type">BackendEventTrigger</span></a></span><span>
</span><span id="line-1166"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687414256"><span id="local-6989586621687414257"><span class="annot"><span class="annottext">BackendInfoAndSourceMetadata b
</span><a href="#local-6989586621687414257"><span class="hs-identifier hs-var">backendInfoAndSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#BackendInfoAndSourceMetadata"><span class="hs-identifier hs-type">BackendInfoAndSourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687414256"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687414258"><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687414258"><span class="hs-identifier hs-var">dynamicConfig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414259"><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621687414259"><span class="hs-identifier hs-var">invalidationKeys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414260"><span class="annot"><span class="annottext">Maybe StoredIntrospection
</span><a href="#local-6989586621687414260"><span class="hs-identifier hs-var">storedIntrospection</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414261"><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621687414261"><span class="hs-identifier hs-var">defaultNC</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414262"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687414262"><span class="hs-identifier hs-var">isNamingConventionEnabled</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1167"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687414263"><span class="annot"><span class="annottext">sourceMetadata :: SourceMetadata b
</span><a href="#local-6989586621687414263"><span class="hs-identifier hs-var hs-var">sourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BackendInfoAndSourceMetadata b -&gt; SourceMetadata b
forall (b :: BackendType).
BackendInfoAndSourceMetadata b -&gt; SourceMetadata b
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#_bcasmSourceMetadata"><span class="hs-identifier hs-var">_bcasmSourceMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">BackendInfoAndSourceMetadata b
</span><a href="#local-6989586621687414257"><span class="hs-identifier hs-var">backendInfoAndSourceMetadata</span></a></span><span>
</span><span id="line-1168"></span><span>                          </span><span id="local-6989586621687414264"><span class="annot"><span class="annottext">sourceName :: SourceName
</span><a href="#local-6989586621687414264"><span class="hs-identifier hs-var hs-var">sourceName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceMetadata b -&gt; SourceName
forall (b :: BackendType). SourceMetadata b -&gt; SourceName
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smName"><span class="hs-identifier hs-var">_smName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687414263"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-1169"></span><span>                          </span><span id="local-6989586621687414265"><span class="annot"><span class="annottext">sourceInvalidationsKeys :: Dependency (HashMap SourceName InvalidationKey)
</span><a href="#local-6989586621687414265"><span class="hs-identifier hs-var hs-var">sourceInvalidationsKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Selector InvalidationKeys (HashMap SourceName InvalidationKey)
-&gt; Dependency InvalidationKeys
-&gt; Dependency (HashMap SourceName InvalidationKey)
forall a b.
Select a =&gt;
Selector a b -&gt; Dependency a -&gt; Dependency b
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Dependency.html#selectD"><span class="hs-identifier hs-var">Inc.selectD</span></a></span><span> </span><span class="annot"><span class="annottext">FieldS InvalidationKeys (HashMap SourceName InvalidationKey)
Selector InvalidationKeys (HashMap SourceName InvalidationKey)
</span><span class="">#_ikSources</span></span><span> </span><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621687414259"><span class="hs-identifier hs-var">invalidationKeys</span></a></span><span>
</span><span id="line-1170"></span><span>                          </span><span id="local-6989586621687414266"><span class="annot"><span class="annottext">sourceIntrospection :: Maybe EncJSON
</span><a href="#local-6989586621687414266"><span class="hs-identifier hs-var hs-var">sourceIntrospection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; HashMap SourceName EncJSON -&gt; Maybe EncJSON
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#lookup"><span class="hs-identifier hs-var">HashMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687414264"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap SourceName EncJSON -&gt; Maybe EncJSON)
-&gt; Maybe (HashMap SourceName EncJSON) -&gt; Maybe EncJSON
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">StoredIntrospection -&gt; HashMap SourceName EncJSON
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#siBackendIntrospection"><span class="hs-identifier hs-var">siBackendIntrospection</span></a></span><span> </span><span class="annot"><span class="annottext">(StoredIntrospection -&gt; HashMap SourceName EncJSON)
-&gt; Maybe StoredIntrospection -&gt; Maybe (HashMap SourceName EncJSON)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe StoredIntrospection
</span><a href="#local-6989586621687414260"><span class="hs-identifier hs-var">storedIntrospection</span></a></span><span>
</span><span id="line-1171"></span><span>                      </span><span id="local-6989586621687414268"><span class="annot"><span class="annottext">Maybe (SourceConfig b, DBObjectsIntrospection b)
</span><a href="#local-6989586621687414268"><span class="hs-identifier hs-var">maybeResolvedSource</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr
  (Dependency (HashMap SourceName InvalidationKey), Maybe ByteString,
   BackendInfoAndSourceMetadata b)
  (Maybe (SourceConfig b, DBObjectsIntrospection b))
forall (b :: BackendType) (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowCache m arr,
 ArrowWriter (Seq CollectItem) arr, MonadIO m,
 MonadBaseControl IO m, MonadResolveSource m, ProvidesNetwork m,
 BackendMetadata b) =&gt;
arr
  (Dependency (HashMap SourceName InvalidationKey), Maybe ByteString,
   BackendInfoAndSourceMetadata b)
  (Maybe (SourceConfig b, DBObjectsIntrospection b))
</span><a href="#local-6989586621687412237"><span class="hs-identifier hs-var">tryResolveSource</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependency (HashMap SourceName InvalidationKey)
</span><a href="#local-6989586621687414265"><span class="hs-identifier hs-var">sourceInvalidationsKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; ByteString
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#encJToLBS"><span class="hs-identifier hs-var">encJToLBS</span></a></span><span> </span><span class="annot"><span class="annottext">(EncJSON -&gt; ByteString) -&gt; Maybe EncJSON -&gt; Maybe ByteString
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe EncJSON
</span><a href="#local-6989586621687414266"><span class="hs-identifier hs-var">sourceIntrospection</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BackendInfoAndSourceMetadata b
</span><a href="#local-6989586621687414257"><span class="hs-identifier hs-var">backendInfoAndSourceMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1172"></span><span>                      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (SourceConfig b, DBObjectsIntrospection b)
</span><a href="#local-6989586621687414268"><span class="hs-identifier hs-var">maybeResolvedSource</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1173"></span><span>                        </span><span class="annot"><span class="annottext">Maybe (SourceConfig b, DBObjectsIntrospection b)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">arr
  (Maybe (AnyBackend PartiallyResolvedSource))
  (Maybe (AnyBackend PartiallyResolvedSource))
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Maybe (AnyBackend PartiallyResolvedSource)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1174"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687414269"><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687414269"><span class="hs-identifier hs-var">sourceConfig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414270"><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621687414270"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1175"></span><span>                          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687414271"><span class="annot"><span class="annottext">metadataInvalidationKey :: Dependency InvalidationKey
</span><a href="#local-6989586621687414271"><span class="hs-identifier hs-var hs-var">metadataInvalidationKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Selector InvalidationKeys InvalidationKey
-&gt; Dependency InvalidationKeys -&gt; Dependency InvalidationKey
forall a b.
Select a =&gt;
Selector a b -&gt; Dependency a -&gt; Dependency b
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Dependency.html#selectD"><span class="hs-identifier hs-var">Inc.selectD</span></a></span><span> </span><span class="annot"><span class="annottext">FieldS InvalidationKeys InvalidationKey
Selector InvalidationKeys InvalidationKey
</span><span class="">#_ikMetadata</span></span><span> </span><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621687414259"><span class="hs-identifier hs-var">invalidationKeys</span></a></span><span>
</span><span id="line-1176"></span><span>                              </span><span class="hs-special">(</span><span id="local-6989586621687414272"><span class="annot"><span class="annottext">[TableBuildInput b]
</span><a href="#local-6989586621687414272"><span class="hs-identifier hs-var">tableInputs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[NonColumnTableInputs b]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TablePermissionInputs b]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TableBuildInput b, NonColumnTableInputs b,
  TablePermissionInputs b)]
-&gt; ([TableBuildInput b], [NonColumnTableInputs b],
    [TablePermissionInputs b])
forall a b c. [(a, b, c)] -&gt; ([a], [b], [c])
</span><span class="hs-identifier hs-var">unzip3</span></span><span> </span><span class="annot"><span class="annottext">([(TableBuildInput b, NonColumnTableInputs b,
   TablePermissionInputs b)]
 -&gt; ([TableBuildInput b], [NonColumnTableInputs b],
     [TablePermissionInputs b]))
-&gt; [(TableBuildInput b, NonColumnTableInputs b,
     TablePermissionInputs b)]
-&gt; ([TableBuildInput b], [NonColumnTableInputs b],
    [TablePermissionInputs b])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TableMetadata b
 -&gt; (TableBuildInput b, NonColumnTableInputs b,
     TablePermissionInputs b))
-&gt; [TableMetadata b]
-&gt; [(TableBuildInput b, NonColumnTableInputs b,
     TablePermissionInputs b)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TableMetadata b
-&gt; (TableBuildInput b, NonColumnTableInputs b,
    TablePermissionInputs b)
forall (b :: BackendType).
TableMetadata b
-&gt; (TableBuildInput b, NonColumnTableInputs b,
    TablePermissionInputs b)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#mkTableInputs"><span class="hs-identifier hs-var">mkTableInputs</span></a></span><span> </span><span class="annot"><span class="annottext">([TableMetadata b]
 -&gt; [(TableBuildInput b, NonColumnTableInputs b,
      TablePermissionInputs b)])
-&gt; [TableMetadata b]
-&gt; [(TableBuildInput b, NonColumnTableInputs b,
     TablePermissionInputs b)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap (TableName b) (TableMetadata b) -&gt; [TableMetadata b]
forall k v. InsOrdHashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#elems"><span class="hs-identifier hs-var">InsOrdHashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">(InsOrdHashMap (TableName b) (TableMetadata b)
 -&gt; [TableMetadata b])
-&gt; InsOrdHashMap (TableName b) (TableMetadata b)
-&gt; [TableMetadata b]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b -&gt; InsOrdHashMap (TableName b) (TableMetadata b)
forall (b :: BackendType). SourceMetadata b -&gt; Tables b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smTables"><span class="hs-identifier hs-var">_smTables</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687414263"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-1177"></span><span>                              </span><span id="local-6989586621687414274"><span class="annot"><span class="annottext">scNamingConvention :: Maybe NamingCase
</span><a href="#local-6989586621687414274"><span class="hs-identifier hs-var hs-var">scNamingConvention</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceCustomization -&gt; Maybe NamingCase
</span><a href="Hasura.RQL.Types.SourceCustomization.html#_scNamingConvention"><span class="hs-identifier hs-var">_scNamingConvention</span></a></span><span> </span><span class="annot"><span class="annottext">(SourceCustomization -&gt; Maybe NamingCase)
-&gt; SourceCustomization -&gt; Maybe NamingCase
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b -&gt; SourceCustomization
forall (b :: BackendType). SourceMetadata b -&gt; SourceCustomization
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smCustomization"><span class="hs-identifier hs-var">_smCustomization</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687414263"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-1178"></span><span>                              </span><span class="hs-glyph">!</span><span id="local-6989586621687414277"><span class="annot"><span class="annottext">namingConv :: NamingCase
</span><a href="#local-6989586621687414277"><span class="hs-identifier hs-var hs-var">namingConv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687414262"><span class="hs-identifier hs-var">isNamingConventionEnabled</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">NamingCase -&gt; Maybe NamingCase -&gt; NamingCase
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621687414261"><span class="hs-identifier hs-var">defaultNC</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NamingCase
</span><a href="#local-6989586621687414274"><span class="hs-identifier hs-var">scNamingConvention</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">NamingCase
</span><a href="Hasura.RQL.Types.NamingCase.html#HasuraCase"><span class="hs-identifier hs-var">HasuraCase</span></a></span><span>
</span><span id="line-1179"></span><span>                          </span><span id="local-6989586621687414279"><span class="annot"><span class="annottext">HashMap
  (TableName b)
  (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b))
</span><a href="#local-6989586621687414279"><span class="hs-identifier hs-var">tablesCoreInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1180"></span><span>                            </span><span class="annot"><span class="annottext">arr
  (SourceName, SourceConfig b, DBTablesMetadata b,
   [TableBuildInput b], Dependency InvalidationKey, NamingCase,
   LogicalModels b)
  (HashMap
     (TableName b)
     (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b)))
forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *) (b :: BackendType).
(ArrowChoice arr, ArrowDistribute arr,
 ArrowWriter (Seq CollectItem) arr, ArrowCache m arr, MonadIO m,
 MonadBaseControl IO m, BackendMetadata b) =&gt;
arr
  (SourceName, SourceConfig b, DBTablesMetadata b,
   [TableBuildInput b], Dependency InvalidationKey, NamingCase,
   LogicalModels b)
  (HashMap
     (TableName b)
     (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b)))
</span><a href="Hasura.Table.API.html#buildTableCache"><span class="hs-identifier hs-var">buildTableCache</span></a></span><span>
</span><span id="line-1181"></span><span>                              </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-1182"></span><span>                                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687414264"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1183"></span><span>                                  </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687414269"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1184"></span><span>                                  </span><span class="annot"><span class="annottext">DBObjectsIntrospection b -&gt; DBTablesMetadata b
forall (b :: BackendType).
DBObjectsIntrospection b -&gt; DBTablesMetadata b
</span><a href="Hasura.RQL.Types.Source.html#_rsTables"><span class="hs-identifier hs-var">_rsTables</span></a></span><span> </span><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621687414270"><span class="hs-identifier hs-var">source</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1185"></span><span>                                  </span><span class="annot"><span class="annottext">[TableBuildInput b]
</span><a href="#local-6989586621687414272"><span class="hs-identifier hs-var">tableInputs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1186"></span><span>                                  </span><span class="annot"><span class="annottext">Dependency InvalidationKey
</span><a href="#local-6989586621687414271"><span class="hs-identifier hs-var">metadataInvalidationKey</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1187"></span><span>                                  </span><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621687414277"><span class="hs-identifier hs-var">namingConv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1188"></span><span>                                  </span><span class="annot"><span class="annottext">SourceMetadata b -&gt; LogicalModels b
forall (b :: BackendType). SourceMetadata b -&gt; LogicalModels b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smLogicalModels"><span class="hs-identifier hs-var">_smLogicalModels</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687414263"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-1189"></span><span>                                </span><span class="hs-special">)</span><span>
</span><span id="line-1190"></span><span>
</span><span id="line-1191"></span><span>                          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687414283"><span class="annot"><span class="annottext">tablesMetadata :: [TableMetadata b]
</span><a href="#local-6989586621687414283"><span class="hs-identifier hs-var hs-var">tablesMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap (TableName b) (TableMetadata b) -&gt; [TableMetadata b]
forall k v. InsOrdHashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#elems"><span class="hs-identifier hs-var">InsOrdHashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">(InsOrdHashMap (TableName b) (TableMetadata b)
 -&gt; [TableMetadata b])
-&gt; InsOrdHashMap (TableName b) (TableMetadata b)
-&gt; [TableMetadata b]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b -&gt; InsOrdHashMap (TableName b) (TableMetadata b)
forall (b :: BackendType). SourceMetadata b -&gt; Tables b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smTables"><span class="hs-identifier hs-var">_smTables</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687414263"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-1192"></span><span>                              </span><span id="local-6989586621687414284"><span class="annot"><span class="annottext">eventTriggers :: [(TableName b, [EventTriggerConf b])]
</span><a href="#local-6989586621687414284"><span class="hs-identifier hs-var hs-var">eventTriggers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TableMetadata b -&gt; (TableName b, [EventTriggerConf b]))
-&gt; [TableMetadata b] -&gt; [(TableName b, [EventTriggerConf b])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableMetadata b -&gt; TableName b
forall (b :: BackendType). TableMetadata b -&gt; TableName b
</span><a href="Hasura.Table.Metadata.html#_tmTable"><span class="hs-identifier hs-var">_tmTable</span></a></span><span> </span><span class="annot"><span class="annottext">(TableMetadata b -&gt; TableName b)
-&gt; (TableMetadata b -&gt; [EventTriggerConf b])
-&gt; TableMetadata b
-&gt; (TableName b, [EventTriggerConf b])
forall b c c'. (b -&gt; c) -&gt; (b -&gt; c') -&gt; b -&gt; (c, c')
forall (a :: * -&gt; * -&gt; *) b c c'.
Arrow a =&gt;
a b c -&gt; a b c' -&gt; a b (c, c')
</span><span class="hs-operator hs-var">&amp;&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap TriggerName (EventTriggerConf b)
-&gt; [EventTriggerConf b]
forall k v. InsOrdHashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#elems"><span class="hs-identifier hs-var">InsOrdHashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">(InsOrdHashMap TriggerName (EventTriggerConf b)
 -&gt; [EventTriggerConf b])
-&gt; (TableMetadata b
    -&gt; InsOrdHashMap TriggerName (EventTriggerConf b))
-&gt; TableMetadata b
-&gt; [EventTriggerConf b]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TableMetadata b -&gt; InsOrdHashMap TriggerName (EventTriggerConf b)
forall (b :: BackendType). TableMetadata b -&gt; EventTriggers b
</span><a href="Hasura.Table.Metadata.html#_tmEventTriggers"><span class="hs-identifier hs-var">_tmEventTriggers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TableMetadata b]
</span><a href="#local-6989586621687414283"><span class="hs-identifier hs-var">tablesMetadata</span></a></span><span>
</span><span id="line-1193"></span><span>
</span><span id="line-1194"></span><span>                          </span><span class="hs-special">(</span><span id="local-6989586621687414288"><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="#local-6989586621687414288"><span class="hs-identifier hs-var">recreateEventTriggers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414289"><span class="annot"><span class="annottext">SourceCatalogMigrationState
</span><a href="#local-6989586621687414289"><span class="hs-identifier hs-var">sourceCatalogMigrationState</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr
  (Proxy b, [(TableName b, [EventTriggerConf b])], SourceConfig b,
   SourceName)
  (RecreateEventTriggers, SourceCatalogMigrationState)
forall (b :: BackendType) (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowCache m arr,
 ArrowWriter (Seq CollectItem) arr, MonadIO m, BackendMetadata b,
 MonadBaseControl IO m, HasCacheStaticConfig m) =&gt;
arr
  (Proxy b, [(TableName b, [EventTriggerConf b])], SourceConfig b,
   SourceName)
  (RecreateEventTriggers, SourceCatalogMigrationState)
</span><a href="#local-6989586621687412336"><span class="hs-identifier hs-var">initCatalogIfNeeded</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy b
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621687414256"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(TableName b, [EventTriggerConf b])]
</span><a href="#local-6989586621687414284"><span class="hs-identifier hs-var">eventTriggers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687414269"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687414264"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1195"></span><span>
</span><span id="line-1196"></span><span>                          </span><span class="annot"><span class="annottext">arr (m ()) ()
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html#bindA"><span class="hs-identifier hs-var">bindA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a Hasura, MonadIO m) =&gt;
   a -&gt; m ()
forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687411808"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687414264"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourceCatalogMigrationState
</span><a href="#local-6989586621687414289"><span class="hs-identifier hs-var">sourceCatalogMigrationState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1197"></span><span>
</span><span id="line-1198"></span><span>                          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687410597"><span id="local-6989586621687410598"><span class="annot"><a href="#local-6989586621687414290"><span class="hs-identifier hs-type">alignTableMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687414256"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687410597"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687414256"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687410598"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687414256"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687410597"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621687410598"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1199"></span><span>                              </span><span id="local-6989586621687414290"><span class="annot"><span class="annottext">alignTableMap :: forall a c.
HashMap (TableName b) a
-&gt; HashMap (TableName b) c -&gt; HashMap (TableName b) (a, c)
</span><a href="#local-6989586621687414290"><span class="hs-identifier hs-var hs-var">alignTableMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; c -&gt; (a, c))
-&gt; HashMap (TableName b) a
-&gt; HashMap (TableName b) c
-&gt; HashMap (TableName b) (a, c)
forall k v1 v2 v3.
(Eq k, Hashable k) =&gt;
(v1 -&gt; v2 -&gt; v3) -&gt; HashMap k v1 -&gt; HashMap k v2 -&gt; HashMap k v3
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.Strict.html#intersectionWith"><span class="hs-identifier hs-var">HashMap.intersectionWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-1200"></span><span>
</span><span id="line-1201"></span><span>                          </span><span id="local-6989586621687414293"><span class="annot"><span class="annottext">HashMap (TableName b) (EventTriggerInfoMap b)
</span><a href="#local-6989586621687414293"><span class="hs-identifier hs-var">eventTriggerInfoMaps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1202"></span><span>                            </span><span class="hs-glyph">(|</span><span>
</span><span id="line-1203"></span><span>                              </span><span class="annot"><span class="annottext">arr
  (a,
   (TableName b,
    ((TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b),
      (TableName b, [EventTriggerConf b])),
     ())))
  (EventTriggerInfoMap b)
-&gt; arr
     (a,
      (HashMap
         (TableName b)
         (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b),
          (TableName b, [EventTriggerConf b])),
       ()))
     (HashMap (TableName b) (EventTriggerInfoMap b))
forall {a}.
arr
  (a,
   (TableName b,
    ((TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b),
      (TableName b, [EventTriggerConf b])),
     ())))
  (EventTriggerInfoMap b)
-&gt; arr
     (a,
      (HashMap
         (TableName b)
         (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b),
          (TableName b, [EventTriggerConf b])),
       ()))
     (HashMap (TableName b) (EventTriggerInfoMap b))
forall k e a s b.
Hashable k =&gt;
arr (e, (k, (a, s))) b -&gt; arr (e, (HashMap k a, s)) (HashMap k b)
forall (arr :: * -&gt; * -&gt; *) k e a s b.
(ArrowDistribute arr, Hashable k) =&gt;
arr (e, (k, (a, s))) b -&gt; arr (e, (HashMap k a, s)) (HashMap k b)
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Rule.html#keyed"><span class="hs-identifier hs-var">Inc.keyed</span></a></span><span>
</span><span id="line-1204"></span><span>                                </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">TableName b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687414298"><span class="annot"><span class="annottext">TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621687414298"><span class="hs-identifier hs-var">tableCoreInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableName b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414299"><span class="annot"><span class="annottext">[EventTriggerConf b]
</span><a href="#local-6989586621687414299"><span class="hs-identifier hs-var">eventTriggerConfs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1205"></span><span>                                    </span><span class="annot"><span class="annottext">arr
  (CacheDynamicConfig, SourceName, SourceConfig b,
   TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b),
   [EventTriggerConf b], Dependency InvalidationKey,
   RecreateEventTriggers)
  (EventTriggerInfoMap b)
forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *) (b :: BackendType).
(ArrowChoice arr, ArrowDistribute arr,
 ArrowWriter (Seq CollectItem) arr, ArrowCache m arr, MonadIO m,
 MonadBaseControl IO m, MonadReader BuildReason m,
 BackendMetadata b, BackendEventTrigger b,
 HasCacheStaticConfig m) =&gt;
arr
  (CacheDynamicConfig, SourceName, SourceConfig b,
   TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b),
   [EventTriggerConf b], Dependency InvalidationKey,
   RecreateEventTriggers)
  (EventTriggerInfoMap b)
</span><a href="#local-6989586621687414300"><span class="hs-identifier hs-var">buildTableEventTriggers</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687414258"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687414264"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687414269"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621687414298"><span class="hs-identifier hs-var">tableCoreInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EventTriggerConf b]
</span><a href="#local-6989586621687414299"><span class="hs-identifier hs-var">eventTriggerConfs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dependency InvalidationKey
</span><a href="#local-6989586621687414271"><span class="hs-identifier hs-var">metadataInvalidationKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="#local-6989586621687414288"><span class="hs-identifier hs-var">recreateEventTriggers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1206"></span><span>                                </span><span class="hs-special">)</span><span>
</span><span id="line-1207"></span><span>                              </span><span class="hs-glyph">|)</span><span>
</span><span id="line-1208"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap
  (TableName b)
  (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b))
</span><a href="#local-6989586621687414279"><span class="hs-identifier hs-var">tablesCoreInfo</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap
  (TableName b)
  (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b))
-&gt; HashMap (TableName b) (TableName b, [EventTriggerConf b])
-&gt; HashMap
     (TableName b)
     (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b),
      (TableName b, [EventTriggerConf b]))
forall a c.
HashMap (TableName b) a
-&gt; HashMap (TableName b) c -&gt; HashMap (TableName b) (a, c)
</span><a href="#local-6989586621687414290"><span class="hs-operator hs-var">`alignTableMap`</span></a></span><span> </span><span class="annot"><span class="annottext">((TableName b, [EventTriggerConf b]) -&gt; TableName b)
-&gt; [(TableName b, [EventTriggerConf b])]
-&gt; HashMap (TableName b) (TableName b, [EventTriggerConf b])
forall k a. Hashable k =&gt; (a -&gt; k) -&gt; [a] -&gt; HashMap k a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#mapFromL"><span class="hs-identifier hs-var">mapFromL</span></a></span><span> </span><span class="annot"><span class="annottext">(TableName b, [EventTriggerConf b]) -&gt; TableName b
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(TableName b, [EventTriggerConf b])]
</span><a href="#local-6989586621687414284"><span class="hs-identifier hs-var">eventTriggers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1209"></span><span>
</span><span id="line-1210"></span><span>                          </span><span class="annot"><span class="annottext">arr
  (Maybe (AnyBackend PartiallyResolvedSource))
  (Maybe (AnyBackend PartiallyResolvedSource))
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span>
</span><span id="line-1211"></span><span>                            </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-1212"></span><span>                              </span><span class="annot"><span class="annottext">AnyBackend PartiallyResolvedSource
-&gt; Maybe (AnyBackend PartiallyResolvedSource)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-1213"></span><span>                                </span><span class="annot"><span class="annottext">(AnyBackend PartiallyResolvedSource
 -&gt; Maybe (AnyBackend PartiallyResolvedSource))
-&gt; AnyBackend PartiallyResolvedSource
-&gt; Maybe (AnyBackend PartiallyResolvedSource)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687414256"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-1214"></span><span>                                </span><span class="annot"><span class="annottext">(PartiallyResolvedSource b -&gt; AnyBackend PartiallyResolvedSource)
-&gt; PartiallyResolvedSource b -&gt; AnyBackend PartiallyResolvedSource
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
-&gt; SourceConfig b
-&gt; DBObjectsIntrospection b
-&gt; HashMap
     (TableName b)
     (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b))
-&gt; HashMap (TableName b) (EventTriggerInfoMap b)
-&gt; PartiallyResolvedSource b
forall (b :: BackendType).
SourceMetadata b
-&gt; SourceConfig b
-&gt; DBObjectsIntrospection b
-&gt; HashMap
     (TableName b)
     (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b))
-&gt; HashMap (TableName b) (EventTriggerInfoMap b)
-&gt; PartiallyResolvedSource b
</span><a href="Hasura.RQL.DDL.RemoteRelationship.html#PartiallyResolvedSource"><span class="hs-identifier hs-var">PartiallyResolvedSource</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687414263"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687414269"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621687414270"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap
  (TableName b)
  (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b))
</span><a href="#local-6989586621687414279"><span class="hs-identifier hs-var">tablesCoreInfo</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (TableName b) (EventTriggerInfoMap b)
</span><a href="#local-6989586621687414293"><span class="hs-identifier hs-var">eventTriggerInfoMaps</span></a></span><span>
</span><span id="line-1215"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-1216"></span><span>                  </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-1217"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnyBackend BackendInfoAndSourceMetadata
</span><a href="#local-6989586621687413263"><span class="hs-identifier hs-var">exists</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687413194"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621687413196"><span class="hs-identifier hs-var">invalidationKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe StoredIntrospection
</span><a href="#local-6989586621687413197"><span class="hs-identifier hs-var">storedIntrospection</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621687413252"><span class="hs-identifier hs-var">defaultNC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687413253"><span class="hs-identifier hs-var">isNamingConventionEnabled</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1218"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-1219"></span><span>          </span><span class="hs-glyph">|)</span><span>
</span><span id="line-1220"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(SourceName, AnyBackend BackendInfoAndSourceMetadata)]
-&gt; HashMap SourceName (AnyBackend BackendInfoAndSourceMetadata)
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.Strict.html#fromList"><span class="hs-identifier hs-var">HashMap.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(SourceName, AnyBackend BackendInfoAndSourceMetadata)]
 -&gt; HashMap SourceName (AnyBackend BackendInfoAndSourceMetadata))
-&gt; [(SourceName, AnyBackend BackendInfoAndSourceMetadata)]
-&gt; HashMap SourceName (AnyBackend BackendInfoAndSourceMetadata)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName (AnyBackend BackendInfoAndSourceMetadata)
-&gt; [(SourceName, AnyBackend BackendInfoAndSourceMetadata)]
forall k v. InsOrdHashMap k v -&gt; [(k, v)]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#toList"><span class="hs-identifier hs-var">InsOrdHashMap.toList</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName (AnyBackend BackendInfoAndSourceMetadata)
</span><a href="#local-6989586621687413257"><span class="hs-identifier hs-var">backendInfoAndSourceMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1221"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687414302"><span class="annot"><span class="annottext">partiallyResolvedSources :: HashMap SourceName (AnyBackend PartiallyResolvedSource)
</span><a href="#local-6989586621687414302"><span class="hs-identifier hs-var hs-var">partiallyResolvedSources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap SourceName (Maybe (AnyBackend PartiallyResolvedSource))
-&gt; HashMap SourceName (AnyBackend PartiallyResolvedSource)
forall a. HashMap SourceName (Maybe a) -&gt; HashMap SourceName a
forall (f :: * -&gt; *) a. Filterable f =&gt; f (Maybe a) -&gt; f a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/witherable-0.4.2-a40f3f0a2ed7f25145b5b00589bf4ea2486662b1e96b7d29d5e6041625ee4a09/share/doc/html/src/Witherable.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap SourceName (Maybe (AnyBackend PartiallyResolvedSource))
</span><a href="#local-6989586621687413259"><span class="hs-identifier hs-var">partiallyResolvedSourcesMaybes</span></a></span><span>
</span><span id="line-1222"></span><span>
</span><span id="line-1223"></span><span>      </span><span class="hs-comment">-- then we can build the entire source output</span><span>
</span><span id="line-1224"></span><span>      </span><span class="hs-comment">-- we need to have the table cache of all sources to build cross-sources relationships</span><span>
</span><span id="line-1225"></span><span>      </span><span id="local-6989586621687414303"><span class="annot"><span class="annottext">HashMap
  SourceName (AnyBackend SourceInfo, BackendMap ScalarParsingMap)
</span><a href="#local-6989586621687414303"><span class="hs-identifier hs-var">sourcesOutput</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1226"></span><span>        </span><span class="hs-glyph">(|</span><span>
</span><span id="line-1227"></span><span>          </span><span class="annot"><span class="annottext">arr
  (a, (SourceName, (AnyBackend PartiallyResolvedSource, ())))
  (AnyBackend SourceInfo, BackendMap ScalarParsingMap)
-&gt; arr
     (a, (HashMap SourceName (AnyBackend PartiallyResolvedSource), ()))
     (HashMap
        SourceName (AnyBackend SourceInfo, BackendMap ScalarParsingMap))
forall {a}.
arr
  (a, (SourceName, (AnyBackend PartiallyResolvedSource, ())))
  (AnyBackend SourceInfo, BackendMap ScalarParsingMap)
-&gt; arr
     (a, (HashMap SourceName (AnyBackend PartiallyResolvedSource), ()))
     (HashMap
        SourceName (AnyBackend SourceInfo, BackendMap ScalarParsingMap))
forall k e a s b.
Hashable k =&gt;
arr (e, (k, (a, s))) b -&gt; arr (e, (HashMap k a, s)) (HashMap k b)
forall (arr :: * -&gt; * -&gt; *) k e a s b.
(ArrowDistribute arr, Hashable k) =&gt;
arr (e, (k, (a, s))) b -&gt; arr (e, (HashMap k a, s)) (HashMap k b)
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Rule.html#keyed"><span class="hs-identifier hs-var">Inc.keyed</span></a></span><span>
</span><span id="line-1228"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621687414306"><span class="annot"><span class="annottext">AnyBackend PartiallyResolvedSource
</span><a href="#local-6989586621687414306"><span class="hs-identifier hs-var">exists</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1229"></span><span>                </span><span class="hs-comment">-- Note that it's a bit of a coincidence that</span><span>
</span><span id="line-1230"></span><span>                </span><span class="hs-comment">-- 'AB.dispatchAnyBackendArrow' accepts exactly two constraints,</span><span>
</span><span id="line-1231"></span><span>                </span><span class="hs-comment">-- and that we happen to want to apply to exactly two</span><span>
</span><span id="line-1232"></span><span>                </span><span class="hs-comment">-- constraints.</span><span>
</span><span id="line-1233"></span><span>                </span><span class="hs-comment">-- Ideally the function should be able to take an arbitrary</span><span>
</span><span id="line-1234"></span><span>                </span><span class="hs-comment">-- number of constraints.</span><span>
</span><span id="line-1235"></span><span>                </span><span class="annot"><span class="annottext">forall (c1 :: BackendType -&gt; Constraint)
       (c2 :: BackendType -&gt; Constraint) (i :: BackendType -&gt; *) r
       (arr :: * -&gt; * -&gt; *) x.
(ArrowChoice arr, AllBackendsSatisfy c1, AllBackendsSatisfy c2) =&gt;
(forall (b :: BackendType). (c1 b, c2 b) =&gt; arr (i b, x) r)
-&gt; arr (AnyBackend i, x) r
</span><a href="Hasura.SQL.AnyBackend.html#dispatchAnyBackendArrow"><span class="hs-identifier hs-var">AB.dispatchAnyBackendArrow</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCacheTypes.html#GetAggregationPredicatesDeps"><span class="hs-identifier hs-type">GetAggregationPredicatesDeps</span></a></span><span>
</span><span id="line-1236"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">proc</span><span>
</span><span id="line-1237"></span><span>                      </span><span class="hs-special">(</span><span> </span><span id="local-6989586621687414349"><span id="local-6989586621687414350"><span class="annot"><span class="annottext">PartiallyResolvedSource b
</span><a href="#local-6989586621687414350"><span class="hs-identifier hs-var">partiallyResolvedSource</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.RemoteRelationship.html#PartiallyResolvedSource"><span class="hs-identifier hs-type">PartiallyResolvedSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687414349"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1238"></span><span>                        </span><span class="hs-special">(</span><span id="local-6989586621687414351"><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687414351"><span class="hs-identifier hs-var">dynamicConfig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414352"><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend PartiallyResolvedSource)
</span><a href="#local-6989586621687414352"><span class="hs-identifier hs-var">allResolvedSources</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414353"><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaMap
</span><a href="#local-6989586621687414353"><span class="hs-identifier hs-var">remoteSchemaCtxMap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414354"><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621687414354"><span class="hs-identifier hs-var">orderedRoles</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1239"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-1240"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1241"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.RemoteRelationship.html#PartiallyResolvedSource"><span class="hs-identifier hs-type">PartiallyResolvedSource</span></a></span><span> </span><span id="local-6989586621687414355"><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687414355"><span class="hs-identifier hs-var">sourceMetadata</span></a></span></span><span> </span><span id="local-6989586621687414356"><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687414356"><span class="hs-identifier hs-var">sourceConfig</span></a></span></span><span> </span><span id="local-6989586621687414357"><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621687414357"><span class="hs-identifier hs-var">introspection</span></a></span></span><span> </span><span id="local-6989586621687414358"><span class="annot"><span class="annottext">HashMap
  (TableName b)
  (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b))
</span><a href="#local-6989586621687414358"><span class="hs-identifier hs-var">tablesInfo</span></a></span></span><span> </span><span id="local-6989586621687414359"><span class="annot"><span class="annottext">HashMap (TableName b) (EventTriggerInfoMap b)
</span><a href="#local-6989586621687414359"><span class="hs-identifier hs-var">eventTriggers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PartiallyResolvedSource b
</span><a href="#local-6989586621687414350"><span class="hs-identifier hs-var">partiallyResolvedSource</span></a></span><span>
</span><span id="line-1242"></span><span>                      </span><span id="local-6989586621687414360"><span class="annot"><span class="annottext">SourceInfo b
</span><a href="#local-6989586621687414360"><span class="hs-identifier hs-var">so</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1243"></span><span>                        </span><span class="annot"><span class="annottext">arr
  (CacheDynamicConfig,
   HashMap SourceName (AnyBackend PartiallyResolvedSource),
   SourceMetadata b, SourceConfig b,
   HashMap
     (TableName b)
     (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b)),
   HashMap (TableName b) (EventTriggerInfoMap b),
   DBObjectsIntrospection b, PartiallyResolvedRemoteSchemaMap,
   OrderedRoles)
  (SourceInfo b)
forall (b :: BackendType) (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowKleisli m arr,
 ArrowWriter (Seq CollectItem) arr, MonadError QErr m,
 HasCacheStaticConfig m, MonadIO m, BackendMetadata b,
 GetAggregationPredicatesDeps b) =&gt;
arr
  (CacheDynamicConfig,
   HashMap SourceName (AnyBackend PartiallyResolvedSource),
   SourceMetadata b, SourceConfig b,
   HashMap
     (TableName b)
     (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b)),
   HashMap (TableName b) (EventTriggerInfoMap b),
   DBObjectsIntrospection b, PartiallyResolvedRemoteSchemaMap,
   OrderedRoles)
  (SourceInfo b)
</span><a href="#local-6989586621687412461"><span class="hs-identifier hs-var">buildSource</span></a></span><span>
</span><span id="line-1244"></span><span>                          </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-1245"></span><span>                            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687414351"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1246"></span><span>                              </span><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend PartiallyResolvedSource)
</span><a href="#local-6989586621687414352"><span class="hs-identifier hs-var">allResolvedSources</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1247"></span><span>                              </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687414355"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1248"></span><span>                              </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687414356"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1249"></span><span>                              </span><span class="annot"><span class="annottext">HashMap
  (TableName b)
  (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b))
</span><a href="#local-6989586621687414358"><span class="hs-identifier hs-var">tablesInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1250"></span><span>                              </span><span class="annot"><span class="annottext">HashMap (TableName b) (EventTriggerInfoMap b)
</span><a href="#local-6989586621687414359"><span class="hs-identifier hs-var">eventTriggers</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1251"></span><span>                              </span><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621687414357"><span class="hs-identifier hs-var">introspection</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1252"></span><span>                              </span><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaMap
</span><a href="#local-6989586621687414353"><span class="hs-identifier hs-var">remoteSchemaCtxMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1253"></span><span>                              </span><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621687414354"><span class="hs-identifier hs-var">orderedRoles</span></a></span><span>
</span><span id="line-1254"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-1255"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687414361"><span class="annot"><span class="annottext">scalarParsingContext :: ScalarTypeParsingContext b
</span><a href="#local-6989586621687414361"><span class="hs-identifier hs-var hs-var">scalarParsingContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceConfig b -&gt; ScalarTypeParsingContext b
forall a t. Has a t =&gt; t -&gt; a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/data-has-0.4.0.0-046b1b301c44f043005ecffcde95c748cd1a5249e8b9e9ea3eaa14bac0030231/share/doc/html/src/Data.Has.html#getter"><span class="hs-identifier hs-var">getter</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687414356"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span>
</span><span id="line-1256"></span><span>                          </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#ScalarMap"><span class="hs-identifier hs-type">ScalarMap</span></a></span><span> </span><span id="local-6989586621687414364"><span class="annot"><span class="annottext">HashMap Name (ScalarType b)
</span><a href="#local-6989586621687414364"><span class="hs-identifier hs-var">scalarMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBObjectsIntrospection b -&gt; ScalarMap b
forall (b :: BackendType). DBObjectsIntrospection b -&gt; ScalarMap b
</span><a href="Hasura.RQL.Types.Source.html#_rsScalars"><span class="hs-identifier hs-var">_rsScalars</span></a></span><span> </span><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621687414357"><span class="hs-identifier hs-var">introspection</span></a></span><span>
</span><span id="line-1257"></span><span>                          </span><span id="local-6989586621687414366"><span class="annot"><span class="annottext">scalarParsingMap :: ScalarParsingMap b
</span><a href="#local-6989586621687414366"><span class="hs-identifier hs-var hs-var">scalarParsingMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap Name (ScalarWrapper b) -&gt; ScalarParsingMap b
forall (b :: BackendType).
HashMap Name (ScalarWrapper b) -&gt; ScalarParsingMap b
</span><a href="Hasura.RQL.DDL.CustomTypes.html#ScalarParsingMap"><span class="hs-identifier hs-var">ScalarParsingMap</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap Name (ScalarWrapper b) -&gt; ScalarParsingMap b)
-&gt; HashMap Name (ScalarWrapper b) -&gt; ScalarParsingMap b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ScalarType b -&gt; ScalarTypeParsingContext b -&gt; ScalarWrapper b)
-&gt; ScalarTypeParsingContext b -&gt; ScalarType b -&gt; ScalarWrapper b
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType).
ScalarType b -&gt; ScalarTypeParsingContext b -&gt; ScalarWrapper b
</span><a href="Hasura.RQL.Types.CustomTypes.html#ScalarWrapper"><span class="hs-identifier hs-var">ScalarWrapper</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687414349"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScalarTypeParsingContext b
</span><a href="#local-6989586621687414361"><span class="hs-identifier hs-var">scalarParsingContext</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScalarType b -&gt; ScalarWrapper b)
-&gt; HashMap Name (ScalarType b) -&gt; HashMap Name (ScalarWrapper b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashMap Name (ScalarType b)
</span><a href="#local-6989586621687414364"><span class="hs-identifier hs-var">scalarMap</span></a></span><span>
</span><span id="line-1258"></span><span>                      </span><span class="annot"><span class="annottext">arr
  (AnyBackend SourceInfo, BackendMap ScalarParsingMap)
  (AnyBackend SourceInfo, BackendMap ScalarParsingMap)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceInfo b -&gt; AnyBackend SourceInfo
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span> </span><span class="annot"><span class="annottext">SourceInfo b
</span><a href="#local-6989586621687414360"><span class="hs-identifier hs-var">so</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScalarParsingMap b -&gt; BackendMap ScalarParsingMap
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; BackendMap i
</span><a href="Hasura.SQL.BackendMap.html#singleton"><span class="hs-identifier hs-var">BackendMap.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">ScalarParsingMap b
</span><a href="#local-6989586621687414366"><span class="hs-identifier hs-var">scalarParsingMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1259"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-1260"></span><span>                  </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-1261"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">AnyBackend PartiallyResolvedSource
</span><a href="#local-6989586621687414306"><span class="hs-identifier hs-var">exists</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1262"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687413194"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend PartiallyResolvedSource)
</span><a href="#local-6989586621687414302"><span class="hs-identifier hs-var">partiallyResolvedSources</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaMap
</span><a href="#local-6989586621687413250"><span class="hs-identifier hs-var">remoteSchemaCtxMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621687413243"><span class="hs-identifier hs-var">orderedRoles</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1263"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-1264"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-1265"></span><span>          </span><span class="hs-glyph">|)</span><span>
</span><span id="line-1266"></span><span>          </span><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend PartiallyResolvedSource)
</span><a href="#local-6989586621687414302"><span class="hs-identifier hs-var">partiallyResolvedSources</span></a></span><span>
</span><span id="line-1267"></span><span>
</span><span id="line-1268"></span><span>      </span><span id="local-6989586621687414369"><span class="annot"><span class="annottext">HashMap RemoteSchemaName (RemoteSchemaCtx, MetadataObject)
</span><a href="#local-6989586621687414369"><span class="hs-identifier hs-var">remoteSchemaCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1269"></span><span>        </span><span class="annot"><span class="annottext">arr
  (Writer
     (Seq CollectItem)
     (HashMap RemoteSchemaName (RemoteSchemaCtx, MetadataObject)))
  (HashMap RemoteSchemaName (RemoteSchemaCtx, MetadataObject))
forall w (arr :: * -&gt; * -&gt; *) a.
ArrowWriter w arr =&gt;
arr (Writer w a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Interpret.html#interpretWriter"><span class="hs-identifier hs-var">interpretWriter</span></a></span><span>
</span><span id="line-1270"></span><span>          </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">HashMap
  RemoteSchemaName
  (PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition,
   MetadataObject)
-&gt; ((PartiallyResolvedRemoteSchemaCtxG
       RemoteRelationshipDefinition,
     MetadataObject)
    -&gt; WriterT
         (Seq CollectItem) Identity (RemoteSchemaCtx, MetadataObject))
-&gt; Writer
     (Seq CollectItem)
     (HashMap RemoteSchemaName (RemoteSchemaCtx, MetadataObject))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">HashMap
  RemoteSchemaName
  (PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition,
   MetadataObject)
</span><a href="#local-6989586621687413246"><span class="hs-identifier hs-var">remoteSchemaMap</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621687414370"><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition
</span><a href="#local-6989586621687414370"><span class="hs-identifier hs-var">partiallyResolvedRemoteSchemaCtx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414371"><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687414371"><span class="hs-identifier hs-var">metadataObj</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1271"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687414372"><span class="annot"><span class="annottext">remoteSchemaIntrospection :: RemoteSchemaIntrospection
</span><a href="#local-6989586621687414372"><span class="hs-identifier hs-var hs-var">remoteSchemaIntrospection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntrospectionResult -&gt; RemoteSchemaIntrospection
</span><a href="Hasura.RemoteSchema.SchemaCache.Types.html#irDoc"><span class="hs-identifier hs-var">irDoc</span></a></span><span> </span><span class="annot"><span class="annottext">(IntrospectionResult -&gt; RemoteSchemaIntrospection)
-&gt; IntrospectionResult -&gt; RemoteSchemaIntrospection
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition
-&gt; IntrospectionResult
forall remoteFieldInfo.
RemoteSchemaCtxG remoteFieldInfo -&gt; IntrospectionResult
</span><a href="Hasura.RemoteSchema.SchemaCache.Types.html#_rscIntroOriginal"><span class="hs-identifier hs-var">_rscIntroOriginal</span></a></span><span> </span><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition
</span><a href="#local-6989586621687414370"><span class="hs-identifier hs-var">partiallyResolvedRemoteSchemaCtx</span></a></span><span>
</span><span id="line-1272"></span><span>            </span><span id="local-6989586621687414375"><span class="annot"><span class="annottext">RemoteSchemaCtxG (Maybe (RemoteFieldInfo Name))
</span><a href="#local-6989586621687414375"><span class="hs-identifier hs-var">resolvedSchemaCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition
-&gt; (PartiallyResolvedRemoteRelationship
      RemoteRelationshipDefinition
    -&gt; WriterT
         (Seq CollectItem) Identity (Maybe (RemoteFieldInfo Name)))
-&gt; WriterT
     (Seq CollectItem)
     Identity
     (RemoteSchemaCtxG (Maybe (RemoteFieldInfo Name)))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition
</span><a href="#local-6989586621687414370"><span class="hs-identifier hs-var">partiallyResolvedRemoteSchemaCtx</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Hasura.RemoteSchema.SchemaCache.Types.html#PartiallyResolvedRemoteRelationship"><span class="hs-identifier hs-type">PartiallyResolvedRemoteRelationship</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687414377"><span id="local-6989586621687414378"><span class="annot"><span class="annottext">Name
RemoteRelationshipG RemoteRelationshipDefinition
_prrrTypeName :: Name
_prrrDefinition :: RemoteRelationshipG RemoteRelationshipDefinition
_prrrTypeName :: forall remoteRelationshipDefinition.
PartiallyResolvedRemoteRelationship remoteRelationshipDefinition
-&gt; Name
_prrrDefinition :: forall remoteRelationshipDefinition.
PartiallyResolvedRemoteRelationship remoteRelationshipDefinition
-&gt; RemoteRelationshipG remoteRelationshipDefinition
</span><a href="#local-6989586621687414377"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1273"></span><span>              </span><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend PartiallyResolvedSource)
-&gt; PartiallyResolvedRemoteSchemaMap
-&gt; RemoteSchemaName
-&gt; RemoteSchemaIntrospection
-&gt; Name
-&gt; RemoteRelationshipG RemoteRelationshipDefinition
-&gt; WriterT
     (Seq CollectItem) Identity (Maybe (RemoteFieldInfo Name))
forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
HashMap SourceName (AnyBackend PartiallyResolvedSource)
-&gt; PartiallyResolvedRemoteSchemaMap
-&gt; RemoteSchemaName
-&gt; RemoteSchemaIntrospection
-&gt; Name
-&gt; RemoteRelationshipG RemoteRelationshipDefinition
-&gt; m (Maybe (RemoteFieldInfo Name))
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildRemoteSchemaRemoteRelationship"><span class="hs-identifier hs-var">buildRemoteSchemaRemoteRelationship</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend PartiallyResolvedSource)
</span><a href="#local-6989586621687414302"><span class="hs-identifier hs-var">partiallyResolvedSources</span></a></span><span> </span><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaMap
</span><a href="#local-6989586621687413250"><span class="hs-identifier hs-var">remoteSchemaCtxMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition
-&gt; RemoteSchemaName
forall remoteFieldInfo.
RemoteSchemaCtxG remoteFieldInfo -&gt; RemoteSchemaName
</span><a href="Hasura.RemoteSchema.SchemaCache.Types.html#_rscName"><span class="hs-identifier hs-var">_rscName</span></a></span><span> </span><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition
</span><a href="#local-6989586621687414370"><span class="hs-identifier hs-var">partiallyResolvedRemoteSchemaCtx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RemoteSchemaIntrospection
</span><a href="#local-6989586621687414372"><span class="hs-identifier hs-var">remoteSchemaIntrospection</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621687414377"><span class="hs-identifier hs-var">_prrrTypeName</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRelationshipG RemoteRelationshipDefinition
</span><a href="#local-6989586621687414378"><span class="hs-identifier hs-var">_prrrDefinition</span></a></span><span>
</span><span id="line-1274"></span><span>            </span><span class="annot"><span class="annottext">(RemoteSchemaCtx, MetadataObject)
-&gt; WriterT
     (Seq CollectItem) Identity (RemoteSchemaCtx, MetadataObject)
forall a. a -&gt; WriterT (Seq CollectItem) Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((RemoteSchemaCtx, MetadataObject)
 -&gt; WriterT
      (Seq CollectItem) Identity (RemoteSchemaCtx, MetadataObject))
-&gt; (RemoteSchemaCtx, MetadataObject)
-&gt; WriterT
     (Seq CollectItem) Identity (RemoteSchemaCtx, MetadataObject)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteSchemaCtxG (Maybe (RemoteFieldInfo Name)) -&gt; RemoteSchemaCtx
forall a. RemoteSchemaCtxG (Maybe a) -&gt; RemoteSchemaCtxG a
forall (f :: * -&gt; *) a. Filterable f =&gt; f (Maybe a) -&gt; f a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/witherable-0.4.2-a40f3f0a2ed7f25145b5b00589bf4ea2486662b1e96b7d29d5e6041625ee4a09/share/doc/html/src/Witherable.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaCtxG (Maybe (RemoteFieldInfo Name))
</span><a href="#local-6989586621687414375"><span class="hs-identifier hs-var">resolvedSchemaCtx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687414371"><span class="hs-identifier hs-var">metadataObj</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1275"></span><span>
</span><span id="line-1276"></span><span>      </span><span class="hs-comment">-- actions</span><span>
</span><span id="line-1277"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621687414383"><span class="annot"><span class="annottext">ActionCache
</span><a href="#local-6989586621687414383"><span class="hs-identifier hs-var">actionCache</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414384"><span class="annot"><span class="annottext">AnnotatedCustomTypes
</span><a href="#local-6989586621687414384"><span class="hs-identifier hs-var">annotatedCustomTypes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1278"></span><span>        </span><span class="annot"><span class="annottext">arr
  (Writer (Seq CollectItem) (ActionCache, AnnotatedCustomTypes))
  (ActionCache, AnnotatedCustomTypes)
forall w (arr :: * -&gt; * -&gt; *) a.
ArrowWriter w arr =&gt;
arr (Writer w a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Interpret.html#interpretWriter"><span class="hs-identifier hs-var">interpretWriter</span></a></span><span>
</span><span id="line-1279"></span><span>          </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1280"></span><span>            </span><span class="hs-comment">-- custom types</span><span>
</span><span id="line-1281"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687414385"><span class="annot"><span class="annottext">scalarsMap :: BackendMap ScalarParsingMap
</span><a href="#local-6989586621687414385"><span class="hs-identifier hs-var hs-var">scalarsMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BackendMap ScalarParsingMap] -&gt; BackendMap ScalarParsingMap
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([BackendMap ScalarParsingMap] -&gt; BackendMap ScalarParsingMap)
-&gt; [BackendMap ScalarParsingMap] -&gt; BackendMap ScalarParsingMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((AnyBackend SourceInfo, BackendMap ScalarParsingMap)
 -&gt; BackendMap ScalarParsingMap)
-&gt; [(AnyBackend SourceInfo, BackendMap ScalarParsingMap)]
-&gt; [BackendMap ScalarParsingMap]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(AnyBackend SourceInfo, BackendMap ScalarParsingMap)
-&gt; BackendMap ScalarParsingMap
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(AnyBackend SourceInfo, BackendMap ScalarParsingMap)]
 -&gt; [BackendMap ScalarParsingMap])
-&gt; [(AnyBackend SourceInfo, BackendMap ScalarParsingMap)]
-&gt; [BackendMap ScalarParsingMap]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap
  SourceName (AnyBackend SourceInfo, BackendMap ScalarParsingMap)
-&gt; [(AnyBackend SourceInfo, BackendMap ScalarParsingMap)]
forall k v. HashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#elems"><span class="hs-identifier hs-var">HashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap
  SourceName (AnyBackend SourceInfo, BackendMap ScalarParsingMap)
</span><a href="#local-6989586621687414303"><span class="hs-identifier hs-var">sourcesOutput</span></a></span><span>
</span><span id="line-1282"></span><span>                </span><span id="local-6989586621687414386"><span class="annot"><span class="annottext">sourcesCache :: SourceCache
</span><a href="#local-6989586621687414386"><span class="hs-identifier hs-var hs-var">sourcesCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((AnyBackend SourceInfo, BackendMap ScalarParsingMap)
 -&gt; AnyBackend SourceInfo)
-&gt; HashMap
     SourceName (AnyBackend SourceInfo, BackendMap ScalarParsingMap)
-&gt; SourceCache
forall v1 v2 k. (v1 -&gt; v2) -&gt; HashMap k v1 -&gt; HashMap k v2
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.Strict.html#map"><span class="hs-identifier hs-var">HashMap.map</span></a></span><span> </span><span class="annot"><span class="annottext">(AnyBackend SourceInfo, BackendMap ScalarParsingMap)
-&gt; AnyBackend SourceInfo
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">HashMap
  SourceName (AnyBackend SourceInfo, BackendMap ScalarParsingMap)
</span><a href="#local-6989586621687414303"><span class="hs-identifier hs-var">sourcesOutput</span></a></span><span>
</span><span id="line-1283"></span><span>                </span><span id="local-6989586621687414387"><span class="annot"><span class="annottext">actionList :: [ActionMetadata]
</span><a href="#local-6989586621687414387"><span class="hs-identifier hs-var hs-var">actionList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Actions -&gt; [ActionMetadata]
forall k v. InsOrdHashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#elems"><span class="hs-identifier hs-var">InsOrdHashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">Actions
</span><a href="#local-6989586621687413202"><span class="hs-identifier hs-var">actions</span></a></span><span>
</span><span id="line-1284"></span><span>            </span><span id="local-6989586621687414388"><span class="annot"><span class="annottext">Maybe AnnotatedCustomTypes
</span><a href="#local-6989586621687414388"><span class="hs-identifier hs-var">maybeResolvedCustomTypes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1285"></span><span>              </span><span class="annot"><span class="annottext">MetadataObject
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) AnnotatedCustomTypes
-&gt; WriterT (Seq CollectItem) Identity (Maybe AnnotatedCustomTypes)
forall (m :: * -&gt; *) a.
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOCustomTypes"><span class="hs-identifier hs-var">MOCustomTypes</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; MetadataObject) -&gt; Value -&gt; MetadataObject
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CustomTypes -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">CustomTypes
</span><a href="#local-6989586621687413201"><span class="hs-identifier hs-var">customTypes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1286"></span><span>                </span><span class="annot"><span class="annottext">(ExceptT
   QErr (WriterT (Seq CollectItem) Identity) AnnotatedCustomTypes
 -&gt; WriterT (Seq CollectItem) Identity (Maybe AnnotatedCustomTypes))
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) AnnotatedCustomTypes
-&gt; WriterT (Seq CollectItem) Identity (Maybe AnnotatedCustomTypes)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceCache
-&gt; CustomTypes
-&gt; BackendMap ScalarParsingMap
-&gt; ExceptT
     QErr (WriterT (Seq CollectItem) Identity) AnnotatedCustomTypes
forall (m :: * -&gt; *).
MonadError QErr m =&gt;
SourceCache
-&gt; CustomTypes
-&gt; BackendMap ScalarParsingMap
-&gt; m AnnotatedCustomTypes
</span><a href="Hasura.RQL.DDL.CustomTypes.html#resolveCustomTypes"><span class="hs-identifier hs-var">resolveCustomTypes</span></a></span><span> </span><span class="annot"><span class="annottext">SourceCache
</span><a href="#local-6989586621687414386"><span class="hs-identifier hs-var">sourcesCache</span></a></span><span> </span><span class="annot"><span class="annottext">CustomTypes
</span><a href="#local-6989586621687413201"><span class="hs-identifier hs-var">customTypes</span></a></span><span> </span><span class="annot"><span class="annottext">BackendMap ScalarParsingMap
</span><a href="#local-6989586621687414385"><span class="hs-identifier hs-var">scalarsMap</span></a></span><span>
</span><span id="line-1287"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe AnnotatedCustomTypes
</span><a href="#local-6989586621687414388"><span class="hs-identifier hs-var">maybeResolvedCustomTypes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1288"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621687414391"><span class="annot"><span class="annottext">AnnotatedCustomTypes
</span><a href="#local-6989586621687414391"><span class="hs-identifier hs-var">resolvedCustomTypes</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1289"></span><span>                </span><span id="local-6989586621687414392"><span class="annot"><span class="annottext">ActionCache
</span><a href="#local-6989586621687414392"><span class="hs-identifier hs-var">actionCache'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AnnotatedCustomTypes
-&gt; BackendMap ScalarParsingMap
-&gt; OrderedRoles
-&gt; [ActionMetadata]
-&gt; WriterT (Seq CollectItem) Identity ActionCache
forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
AnnotatedCustomTypes
-&gt; BackendMap ScalarParsingMap
-&gt; OrderedRoles
-&gt; [ActionMetadata]
-&gt; m ActionCache
</span><a href="#local-6989586621687414393"><span class="hs-identifier hs-var">buildActions</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedCustomTypes
</span><a href="#local-6989586621687414391"><span class="hs-identifier hs-var">resolvedCustomTypes</span></a></span><span> </span><span class="annot"><span class="annottext">BackendMap ScalarParsingMap
</span><a href="#local-6989586621687414385"><span class="hs-identifier hs-var">scalarsMap</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621687413243"><span class="hs-identifier hs-var">orderedRoles</span></a></span><span> </span><span class="annot"><span class="annottext">[ActionMetadata]
</span><a href="#local-6989586621687414387"><span class="hs-identifier hs-var">actionList</span></a></span><span>
</span><span id="line-1290"></span><span>                </span><span class="annot"><span class="annottext">(ActionCache, AnnotatedCustomTypes)
-&gt; Writer (Seq CollectItem) (ActionCache, AnnotatedCustomTypes)
forall a. a -&gt; WriterT (Seq CollectItem) Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActionCache
</span><a href="#local-6989586621687414392"><span class="hs-identifier hs-var">actionCache'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnotatedCustomTypes
</span><a href="#local-6989586621687414391"><span class="hs-identifier hs-var">resolvedCustomTypes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1291"></span><span>              </span><span class="hs-comment">-- If the custom types themselves are inconsistent, we can&#8217;t really do</span><span>
</span><span id="line-1292"></span><span>              </span><span class="hs-comment">-- anything with actions, so just mark them all inconsistent.</span><span>
</span><span id="line-1293"></span><span>              </span><span class="annot"><span class="annottext">Maybe AnnotatedCustomTypes
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1294"></span><span>                </span><span class="annot"><span class="annottext">[MetadataObject] -&gt; Text -&gt; WriterT (Seq CollectItem) Identity ()
forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
[MetadataObject] -&gt; Text -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistenciesM"><span class="hs-identifier hs-var">recordInconsistenciesM</span></a></span><span>
</span><span id="line-1295"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ActionMetadata -&gt; MetadataObject)
-&gt; [ActionMetadata] -&gt; [MetadataObject]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ActionMetadata -&gt; MetadataObject
</span><a href="#local-6989586621687414395"><span class="hs-identifier hs-var">mkActionMetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">[ActionMetadata]
</span><a href="#local-6989586621687414387"><span class="hs-identifier hs-var">actionList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1296"></span><span>                  </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;custom types are inconsistent&quot;</span></span><span>
</span><span id="line-1297"></span><span>                </span><span class="annot"><span class="annottext">(ActionCache, AnnotatedCustomTypes)
-&gt; Writer (Seq CollectItem) (ActionCache, AnnotatedCustomTypes)
forall a. a -&gt; WriterT (Seq CollectItem) Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActionCache
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnotatedCustomTypes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-1298"></span><span>
</span><span id="line-1299"></span><span>      </span><span class="annot"><span class="annottext">arr BuildOutputs BuildOutputs
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span>
</span><span id="line-1300"></span><span>        </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-1301"></span><span>          </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#BuildOutputs"><span class="hs-identifier hs-type">BuildOutputs</span></a></span><span>
</span><span id="line-1302"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_boSources :: SourceCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boSources"><span class="hs-identifier hs-var">_boSources</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((AnyBackend SourceInfo, BackendMap ScalarParsingMap)
 -&gt; AnyBackend SourceInfo)
-&gt; HashMap
     SourceName (AnyBackend SourceInfo, BackendMap ScalarParsingMap)
-&gt; SourceCache
forall v1 v2 k. (v1 -&gt; v2) -&gt; HashMap k v1 -&gt; HashMap k v2
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.Strict.html#map"><span class="hs-identifier hs-var">HashMap.map</span></a></span><span> </span><span class="annot"><span class="annottext">(AnyBackend SourceInfo, BackendMap ScalarParsingMap)
-&gt; AnyBackend SourceInfo
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">HashMap
  SourceName (AnyBackend SourceInfo, BackendMap ScalarParsingMap)
</span><a href="#local-6989586621687414303"><span class="hs-identifier hs-var">sourcesOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1303"></span><span>              </span><span class="annot"><span class="annottext">_boActions :: ActionCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boActions"><span class="hs-identifier hs-var">_boActions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ActionCache
</span><a href="#local-6989586621687414383"><span class="hs-identifier hs-var">actionCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1304"></span><span>              </span><span class="annot"><span class="annottext">_boRemoteSchemas :: HashMap RemoteSchemaName (RemoteSchemaCtx, MetadataObject)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boRemoteSchemas"><span class="hs-identifier hs-var">_boRemoteSchemas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap RemoteSchemaName (RemoteSchemaCtx, MetadataObject)
</span><a href="#local-6989586621687414369"><span class="hs-identifier hs-var">remoteSchemaCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1305"></span><span>              </span><span class="annot"><span class="annottext">_boCustomTypes :: AnnotatedCustomTypes
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boCustomTypes"><span class="hs-identifier hs-var">_boCustomTypes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnotatedCustomTypes
</span><a href="#local-6989586621687414384"><span class="hs-identifier hs-var">annotatedCustomTypes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1306"></span><span>              </span><span class="annot"><span class="annottext">_boRoles :: HashMap RoleName Role
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boRoles"><span class="hs-identifier hs-var">_boRoles</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Role -&gt; RoleName) -&gt; [Role] -&gt; HashMap RoleName Role
forall k a. Hashable k =&gt; (a -&gt; k) -&gt; [a] -&gt; HashMap k a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#mapFromL"><span class="hs-identifier hs-var">mapFromL</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; RoleName
</span><a href="Hasura.RQL.Types.Roles.html#_rRoleName"><span class="hs-identifier hs-var">_rRoleName</span></a></span><span> </span><span class="annot"><span class="annottext">([Role] -&gt; HashMap RoleName Role)
-&gt; [Role] -&gt; HashMap RoleName Role
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OrderedRoles -&gt; [Role]
</span><a href="Hasura.RQL.DDL.Schema.Cache.Permission.html#_unOrderedRoles"><span class="hs-identifier hs-var">_unOrderedRoles</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621687413243"><span class="hs-identifier hs-var">orderedRoles</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1307"></span><span>              </span><span class="annot"><span class="annottext">_boBackendCache :: BackendCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boBackendCache"><span class="hs-identifier hs-var">_boBackendCache</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BackendCache
</span><a href="#local-6989586621687413255"><span class="hs-identifier hs-var">backendCache</span></a></span><span>
</span><span id="line-1308"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-1309"></span><span>
</span><span id="line-1310"></span><span>    </span><span id="local-6989586621687409991"><span class="annot"><a href="#local-6989586621687411880"><span class="hs-identifier hs-type">buildOpenTelemetry</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1311"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687409991"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1312"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.OpenTelemetry.html#OpenTelemetryConfig"><span class="hs-identifier hs-type">OpenTelemetryConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1313"></span><span>      </span><span class="annot"><a href="#local-6989586621687409991"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.OpenTelemetry.html#OpenTelemetryInfo"><span class="hs-identifier hs-type">OpenTelemetryInfo</span></a></span></span><span>
</span><span id="line-1314"></span><span>    </span><span id="local-6989586621687411880"><span class="annot"><span class="annottext">buildOpenTelemetry :: forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
OpenTelemetryConfig -&gt; m OpenTelemetryInfo
</span><a href="#local-6989586621687411880"><span class="hs-identifier hs-var hs-var">buildOpenTelemetry</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.OpenTelemetry.html#OpenTelemetryConfig"><span class="hs-identifier hs-type">OpenTelemetryConfig</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687414420"><span id="local-6989586621687414421"><span id="local-6989586621687414422"><span id="local-6989586621687414423"><span class="annot"><span class="annottext">Set OtelDataType
OtelBatchSpanProcessorConfig
OtelExporterConfig
OtelStatus
_ocStatus :: OtelStatus
_ocEnabledDataTypes :: Set OtelDataType
_ocExporterOtlp :: OtelExporterConfig
_ocBatchSpanProcessor :: OtelBatchSpanProcessorConfig
_ocStatus :: OpenTelemetryConfig -&gt; OtelStatus
_ocEnabledDataTypes :: OpenTelemetryConfig -&gt; Set OtelDataType
_ocExporterOtlp :: OpenTelemetryConfig -&gt; OtelExporterConfig
_ocBatchSpanProcessor :: OpenTelemetryConfig -&gt; OtelBatchSpanProcessorConfig
</span><a href="#local-6989586621687414420"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1315"></span><span>      </span><span class="hs-comment">-- Always perform validation, even if OpenTelemetry is disabled</span><span>
</span><span id="line-1316"></span><span>      </span><span id="local-6989586621687414428"><span class="annot"><span class="annottext">Maybe OtelExporterInfo
</span><a href="#local-6989586621687414428"><span class="hs-identifier hs-var">mOtelExporterInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1317"></span><span>        </span><span class="annot"><span class="annottext">(Maybe (Maybe OtelExporterInfo) -&gt; Maybe OtelExporterInfo)
-&gt; m (Maybe (Maybe OtelExporterInfo)) -&gt; m (Maybe OtelExporterInfo)
forall a b. (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Maybe OtelExporterInfo) -&gt; Maybe OtelExporterInfo
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span>
</span><span id="line-1318"></span><span>          </span><span class="annot"><span class="annottext">(m (Maybe (Maybe OtelExporterInfo)) -&gt; m (Maybe OtelExporterInfo))
-&gt; m (Maybe (Maybe OtelExporterInfo)) -&gt; m (Maybe OtelExporterInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetadataObject
-&gt; ExceptT QErr m (Maybe OtelExporterInfo)
-&gt; m (Maybe (Maybe OtelExporterInfo))
forall (m :: * -&gt; *) a.
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OpenTelemetryConfigSubobject -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOOpenTelemetry"><span class="hs-identifier hs-var">MOOpenTelemetry</span></a></span><span> </span><span class="annot"><span class="annottext">OpenTelemetryConfigSubobject
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#OtelSubobjectExporterOtlp"><span class="hs-identifier hs-var">OtelSubobjectExporterOtlp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OtelExporterConfig -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">OtelExporterConfig
</span><a href="#local-6989586621687414422"><span class="hs-identifier hs-var">_ocExporterOtlp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1319"></span><span>          </span><span class="annot"><span class="annottext">(ExceptT QErr m (Maybe OtelExporterInfo)
 -&gt; m (Maybe (Maybe OtelExporterInfo)))
-&gt; ExceptT QErr m (Maybe OtelExporterInfo)
-&gt; m (Maybe (Maybe OtelExporterInfo))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Either QErr (Maybe OtelExporterInfo)
-&gt; ExceptT QErr m (Maybe OtelExporterInfo)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; Either e a -&gt; m a
</span><span class="hs-identifier hs-var">liftEither</span></span><span>
</span><span id="line-1320"></span><span>          </span><span class="annot"><span class="annottext">(Either QErr (Maybe OtelExporterInfo)
 -&gt; ExceptT QErr m (Maybe OtelExporterInfo))
-&gt; Either QErr (Maybe OtelExporterInfo)
-&gt; ExceptT QErr m (Maybe OtelExporterInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OtelStatus
-&gt; Environment
-&gt; OtelExporterConfig
-&gt; Either QErr (Maybe OtelExporterInfo)
</span><a href="Hasura.RQL.DDL.OpenTelemetry.html#parseOtelExporterConfig"><span class="hs-identifier hs-var">parseOtelExporterConfig</span></a></span><span> </span><span class="annot"><span class="annottext">OtelStatus
</span><a href="#local-6989586621687414420"><span class="hs-identifier hs-var">_ocStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621687411809"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">OtelExporterConfig
</span><a href="#local-6989586621687414422"><span class="hs-identifier hs-var">_ocExporterOtlp</span></a></span><span>
</span><span id="line-1321"></span><span>      </span><span id="local-6989586621687414431"><span class="annot"><span class="annottext">Maybe OtelBatchSpanProcessorInfo
</span><a href="#local-6989586621687414431"><span class="hs-identifier hs-var">mOtelBatchSpanProcessorInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1322"></span><span>        </span><span class="annot"><span class="annottext">MetadataObject
-&gt; ExceptT QErr m OtelBatchSpanProcessorInfo
-&gt; m (Maybe OtelBatchSpanProcessorInfo)
forall (m :: * -&gt; *) a.
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OpenTelemetryConfigSubobject -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOOpenTelemetry"><span class="hs-identifier hs-var">MOOpenTelemetry</span></a></span><span> </span><span class="annot"><span class="annottext">OpenTelemetryConfigSubobject
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#OtelSubobjectBatchSpanProcessor"><span class="hs-identifier hs-var">OtelSubobjectBatchSpanProcessor</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OtelBatchSpanProcessorConfig -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">OtelBatchSpanProcessorConfig
</span><a href="#local-6989586621687414423"><span class="hs-identifier hs-var">_ocBatchSpanProcessor</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1323"></span><span>          </span><span class="annot"><span class="annottext">(ExceptT QErr m OtelBatchSpanProcessorInfo
 -&gt; m (Maybe OtelBatchSpanProcessorInfo))
-&gt; ExceptT QErr m OtelBatchSpanProcessorInfo
-&gt; m (Maybe OtelBatchSpanProcessorInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Either QErr OtelBatchSpanProcessorInfo
-&gt; ExceptT QErr m OtelBatchSpanProcessorInfo
forall e (m :: * -&gt; *) a. MonadError e m =&gt; Either e a -&gt; m a
</span><span class="hs-identifier hs-var">liftEither</span></span><span>
</span><span id="line-1324"></span><span>          </span><span class="annot"><span class="annottext">(Either QErr OtelBatchSpanProcessorInfo
 -&gt; ExceptT QErr m OtelBatchSpanProcessorInfo)
-&gt; Either QErr OtelBatchSpanProcessorInfo
-&gt; ExceptT QErr m OtelBatchSpanProcessorInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OtelBatchSpanProcessorConfig
-&gt; Either QErr OtelBatchSpanProcessorInfo
</span><a href="Hasura.RQL.DDL.OpenTelemetry.html#parseOtelBatchSpanProcessorConfig"><span class="hs-identifier hs-var">parseOtelBatchSpanProcessorConfig</span></a></span><span> </span><span class="annot"><span class="annottext">OtelBatchSpanProcessorConfig
</span><a href="#local-6989586621687414423"><span class="hs-identifier hs-var">_ocBatchSpanProcessor</span></a></span><span>
</span><span id="line-1325"></span><span>      </span><span class="annot"><span class="annottext">OpenTelemetryInfo -&gt; m OpenTelemetryInfo
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-1326"></span><span>        </span><span class="annot"><span class="annottext">(OpenTelemetryInfo -&gt; m OpenTelemetryInfo)
-&gt; OpenTelemetryInfo -&gt; m OpenTelemetryInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OtelStatus
</span><a href="#local-6989586621687414420"><span class="hs-identifier hs-var">_ocStatus</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1327"></span><span>          </span><span class="annot"><span class="annottext">OtelStatus
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#OtelDisabled"><span class="hs-identifier hs-var">OtelDisabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1328"></span><span>            </span><span class="hs-comment">-- Disable all components if OpenTelemetry export not enabled</span><span>
</span><span id="line-1329"></span><span>            </span><span class="annot"><span class="annottext">Maybe OtelExporterInfo
-&gt; Maybe OtelBatchSpanProcessorInfo -&gt; OpenTelemetryInfo
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#OpenTelemetryInfo"><span class="hs-identifier hs-var">OpenTelemetryInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe OtelExporterInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe OtelBatchSpanProcessorInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1330"></span><span>          </span><span class="annot"><span class="annottext">OtelStatus
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#OtelEnabled"><span class="hs-identifier hs-var">OtelEnabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1331"></span><span>            </span><span class="annot"><span class="annottext">Maybe OtelExporterInfo
-&gt; Maybe OtelBatchSpanProcessorInfo -&gt; OpenTelemetryInfo
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#OpenTelemetryInfo"><span class="hs-identifier hs-var">OpenTelemetryInfo</span></a></span><span>
</span><span id="line-1332"></span><span>              </span><span class="annot"><span class="annottext">Maybe OtelExporterInfo
</span><a href="#local-6989586621687414428"><span class="hs-identifier hs-var">mOtelExporterInfo</span></a></span><span>
</span><span id="line-1333"></span><span>              </span><span class="hs-comment">-- Disable data types if they are not in the enabled set</span><span>
</span><span id="line-1334"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">OtelDataType
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#OtelTraces"><span class="hs-identifier hs-var">OtelTraces</span></a></span><span> </span><span class="annot"><span class="annottext">OtelDataType -&gt; Set OtelDataType -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set OtelDataType
</span><a href="#local-6989586621687414421"><span class="hs-identifier hs-var">_ocEnabledDataTypes</span></a></span><span>
</span><span id="line-1335"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe OtelBatchSpanProcessorInfo
</span><a href="#local-6989586621687414431"><span class="hs-identifier hs-var">mOtelBatchSpanProcessorInfo</span></a></span><span>
</span><span id="line-1336"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe OtelBatchSpanProcessorInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1337"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-1338"></span><span>
</span><span id="line-1339"></span><span>    </span><span id="local-6989586621687409984"><span class="annot"><a href="#local-6989586621687411873"><span class="hs-identifier hs-type">buildRESTEndpoints</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1340"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687409984"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1341"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#QueryCollections"><span class="hs-identifier hs-type">QueryCollections</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1342"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#CreateEndpoint"><span class="hs-identifier hs-type">CreateEndpoint</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1343"></span><span>      </span><span class="annot"><a href="#local-6989586621687409984"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointName"><span class="hs-identifier hs-type">EndpointName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointMetadata"><span class="hs-identifier hs-type">EndpointMetadata</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#GQLQueryWithText"><span class="hs-identifier hs-type">GQLQueryWithText</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-1344"></span><span>    </span><span id="local-6989586621687411873"><span class="annot"><span class="annottext">buildRESTEndpoints :: forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
QueryCollections
-&gt; [CreateEndpoint]
-&gt; m (HashMap EndpointName (EndpointMetadata GQLQueryWithText))
</span><a href="#local-6989586621687411873"><span class="hs-identifier hs-var hs-var">buildRESTEndpoints</span></a></span></span><span> </span><span id="local-6989586621687414454"><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621687414454"><span class="hs-identifier hs-var">collections</span></a></span></span><span> </span><span id="local-6989586621687414455"><span class="annot"><span class="annottext">[CreateEndpoint]
</span><a href="#local-6989586621687414455"><span class="hs-identifier hs-var">endpoints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CreateEndpoint -&gt; EndpointName)
-&gt; (CreateEndpoint -&gt; MetadataObject)
-&gt; (CreateEndpoint
    -&gt; m (Maybe (EndpointMetadata GQLQueryWithText)))
-&gt; [CreateEndpoint]
-&gt; m (HashMap EndpointName (EndpointMetadata GQLQueryWithText))
forall (m :: * -&gt; *) k a b.
(MonadWriter (Seq CollectItem) m, Hashable k) =&gt;
(a -&gt; k)
-&gt; (a -&gt; MetadataObject)
-&gt; (a -&gt; m (Maybe b))
-&gt; [a]
-&gt; m (HashMap k b)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#buildInfoMapM"><span class="hs-identifier hs-var">buildInfoMapM</span></a></span><span> </span><span class="annot"><span class="annottext">CreateEndpoint -&gt; EndpointName
forall query. EndpointMetadata query -&gt; EndpointName
</span><a href="Hasura.RQL.Types.Endpoint.html#_ceName"><span class="hs-identifier hs-var">_ceName</span></a></span><span> </span><span class="annot"><span class="annottext">CreateEndpoint -&gt; MetadataObject
forall {q}. ToJSON q =&gt; EndpointMetadata q -&gt; MetadataObject
</span><a href="#local-6989586621687414457"><span class="hs-identifier hs-var">mkEndpointMetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">CreateEndpoint -&gt; m (Maybe (EndpointMetadata GQLQueryWithText))
</span><a href="#local-6989586621687414458"><span class="hs-identifier hs-var">buildEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">[CreateEndpoint]
</span><a href="#local-6989586621687414455"><span class="hs-identifier hs-var">endpoints</span></a></span><span>
</span><span id="line-1345"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1346"></span><span>        </span><span id="local-6989586621687414457"><span class="annot"><span class="annottext">mkEndpointMetadataObject :: EndpointMetadata query -&gt; MetadataObject
</span><a href="#local-6989586621687414457"><span class="hs-identifier hs-var hs-var">mkEndpointMetadataObject</span></a></span></span><span> </span><span id="local-6989586621687414462"><span class="annot"><span class="annottext">createEndpoint :: EndpointMetadata query
</span><a href="#local-6989586621687414462"><span class="hs-identifier hs-var">createEndpoint</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointMetadata"><span class="hs-identifier hs-type">EndpointMetadata</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687414464"><span id="local-6989586621687414465"><span id="local-6989586621687414466"><span id="local-6989586621687414467"><span id="local-6989586621687414468"><span class="annot"><span class="annottext">Maybe Text
NonEmpty EndpointMethod
EndpointUrl
EndpointName
EndpointDef query
_ceUrl :: forall query. EndpointMetadata query -&gt; EndpointUrl
_ceName :: forall query. EndpointMetadata query -&gt; EndpointName
_ceName :: EndpointName
_ceUrl :: EndpointUrl
_ceMethods :: NonEmpty EndpointMethod
_ceDefinition :: EndpointDef query
_ceComment :: Maybe Text
_ceMethods :: forall query. EndpointMetadata query -&gt; NonEmpty EndpointMethod
_ceDefinition :: forall query. EndpointMetadata query -&gt; EndpointDef query
_ceComment :: forall query. EndpointMetadata query -&gt; Maybe Text
</span><a href="Hasura.RQL.Types.Endpoint.html#_ceUrl"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1347"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687414472"><span class="annot"><span class="annottext">objectId :: MetadataObjId
</span><a href="#local-6989586621687414472"><span class="hs-identifier hs-var hs-var">objectId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EndpointName -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOEndpoint"><span class="hs-identifier hs-var">MOEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointName
</span><a href="#local-6989586621687414464"><span class="hs-identifier hs-var">_ceName</span></a></span><span>
</span><span id="line-1348"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObjId
</span><a href="#local-6989586621687414472"><span class="hs-identifier hs-var">objectId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EndpointMetadata query -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata query
</span><a href="#local-6989586621687414462"><span class="hs-identifier hs-var">createEndpoint</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1349"></span><span>
</span><span id="line-1350"></span><span>        </span><span id="local-6989586621687414458"><span class="annot"><span class="annottext">buildEndpoint :: CreateEndpoint -&gt; m (Maybe (EndpointMetadata GQLQueryWithText))
</span><a href="#local-6989586621687414458"><span class="hs-identifier hs-var hs-var">buildEndpoint</span></a></span></span><span> </span><span id="local-6989586621687414473"><span class="annot"><span class="annottext">createEndpoint :: CreateEndpoint
</span><a href="#local-6989586621687414473"><span class="hs-identifier hs-var">createEndpoint</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointMetadata"><span class="hs-identifier hs-type">EndpointMetadata</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687414474"><span id="local-6989586621687414475"><span id="local-6989586621687414476"><span id="local-6989586621687414477"><span id="local-6989586621687414478"><span class="annot"><span class="annottext">Maybe Text
NonEmpty EndpointMethod
EndpointUrl
EndpointName
EndpointDef QueryReference
_ceUrl :: forall query. EndpointMetadata query -&gt; EndpointUrl
_ceName :: forall query. EndpointMetadata query -&gt; EndpointName
_ceMethods :: forall query. EndpointMetadata query -&gt; NonEmpty EndpointMethod
_ceDefinition :: forall query. EndpointMetadata query -&gt; EndpointDef query
_ceComment :: forall query. EndpointMetadata query -&gt; Maybe Text
_ceName :: EndpointName
_ceUrl :: EndpointUrl
_ceMethods :: NonEmpty EndpointMethod
_ceDefinition :: EndpointDef QueryReference
_ceComment :: Maybe Text
</span><a href="Hasura.RQL.Types.Endpoint.html#_ceUrl"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1351"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- QueryReference collName queryName = _edQuery endpoint</span><span>
</span><span id="line-1352"></span><span>              </span><span id="local-6989586621687414479"><span class="annot"><span class="annottext">addContext :: Text -&gt; Text
</span><a href="#local-6989586621687414479"><span class="hs-identifier hs-var hs-var">addContext</span></a></span></span><span> </span><span id="local-6989586621687414480"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687414480"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;in endpoint &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">EndpointName -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointName
</span><a href="#local-6989586621687414474"><span class="hs-identifier hs-var">_ceName</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687414480"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1353"></span><span>          </span><span class="annot"><span class="annottext">MetadataObject
-&gt; ExceptT QErr m (EndpointMetadata GQLQueryWithText)
-&gt; m (Maybe (EndpointMetadata GQLQueryWithText))
forall (m :: * -&gt; *) a.
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CreateEndpoint -&gt; MetadataObject
forall {q}. ToJSON q =&gt; EndpointMetadata q -&gt; MetadataObject
</span><a href="#local-6989586621687414457"><span class="hs-identifier hs-var">mkEndpointMetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">CreateEndpoint
</span><a href="#local-6989586621687414473"><span class="hs-identifier hs-var">createEndpoint</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT QErr m (EndpointMetadata GQLQueryWithText)
 -&gt; m (Maybe (EndpointMetadata GQLQueryWithText)))
-&gt; ExceptT QErr m (EndpointMetadata GQLQueryWithText)
-&gt; m (Maybe (EndpointMetadata GQLQueryWithText))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text)
-&gt; ExceptT QErr m (EndpointMetadata GQLQueryWithText)
-&gt; ExceptT QErr m (EndpointMetadata GQLQueryWithText)
forall (m :: * -&gt; *) a. QErrM m =&gt; (Text -&gt; Text) -&gt; m a -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#modifyErr"><span class="hs-identifier hs-var">modifyErr</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621687414479"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT QErr m (EndpointMetadata GQLQueryWithText)
 -&gt; ExceptT QErr m (EndpointMetadata GQLQueryWithText))
-&gt; ExceptT QErr m (EndpointMetadata GQLQueryWithText)
-&gt; ExceptT QErr m (EndpointMetadata GQLQueryWithText)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QueryCollections
-&gt; CreateEndpoint
-&gt; ExceptT QErr m (EndpointMetadata GQLQueryWithText)
forall (m :: * -&gt; *).
QErrM m =&gt;
QueryCollections
-&gt; CreateEndpoint -&gt; m (EndpointMetadata GQLQueryWithText)
</span><a href="#local-6989586621687414481"><span class="hs-identifier hs-var">resolveEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621687414454"><span class="hs-identifier hs-var">collections</span></a></span><span> </span><span class="annot"><span class="annottext">CreateEndpoint
</span><a href="#local-6989586621687414473"><span class="hs-identifier hs-var">createEndpoint</span></a></span><span>
</span><span id="line-1354"></span><span>
</span><span id="line-1355"></span><span>    </span><span id="local-6989586621687410650"><span class="annot"><a href="#local-6989586621687414481"><span class="hs-identifier hs-type">resolveEndpoint</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1356"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410650"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1357"></span><span>      </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#InsOrdHashMap"><span class="hs-identifier hs-type">InsOrdHashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#CollectionName"><span class="hs-identifier hs-type">CollectionName</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#CreateCollection"><span class="hs-identifier hs-type">CreateCollection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1358"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointMetadata"><span class="hs-identifier hs-type">EndpointMetadata</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#QueryReference"><span class="hs-identifier hs-type">QueryReference</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1359"></span><span>      </span><span class="annot"><a href="#local-6989586621687410650"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointMetadata"><span class="hs-identifier hs-type">EndpointMetadata</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#GQLQueryWithText"><span class="hs-identifier hs-type">GQLQueryWithText</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1360"></span><span>    </span><span id="local-6989586621687414481"><span class="annot"><span class="annottext">resolveEndpoint :: forall (m :: * -&gt; *).
QErrM m =&gt;
QueryCollections
-&gt; CreateEndpoint -&gt; m (EndpointMetadata GQLQueryWithText)
</span><a href="#local-6989586621687414481"><span class="hs-identifier hs-var hs-var">resolveEndpoint</span></a></span></span><span> </span><span id="local-6989586621687414538"><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621687414538"><span class="hs-identifier hs-var">collections</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(QueryReference -&gt; m GQLQueryWithText)
-&gt; CreateEndpoint -&gt; m (EndpointMetadata GQLQueryWithText)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; EndpointMetadata a -&gt; f (EndpointMetadata b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">((QueryReference -&gt; m GQLQueryWithText)
 -&gt; CreateEndpoint -&gt; m (EndpointMetadata GQLQueryWithText))
-&gt; (QueryReference -&gt; m GQLQueryWithText)
-&gt; CreateEndpoint
-&gt; m (EndpointMetadata GQLQueryWithText)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#QueryReference"><span class="hs-identifier hs-type">QueryReference</span></a></span><span> </span><span id="local-6989586621687414540"><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621687414540"><span class="hs-identifier hs-var">collName</span></a></span></span><span> </span><span id="local-6989586621687414541"><span class="annot"><span class="annottext">QueryName
</span><a href="#local-6989586621687414541"><span class="hs-identifier hs-var">queryName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1361"></span><span>      </span><span id="local-6989586621687414542"><span class="annot"><span class="annottext">CreateCollection
</span><a href="#local-6989586621687414542"><span class="hs-identifier hs-var">collection</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1362"></span><span>        </span><span class="annot"><span class="annottext">Maybe CreateCollection -&gt; m CreateCollection -&gt; m CreateCollection
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#onNothing"><span class="hs-identifier hs-var">onNothing</span></a></span><span>
</span><span id="line-1363"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectionName -&gt; QueryCollections -&gt; Maybe CreateCollection
forall k v. (Eq k, Hashable k) =&gt; k -&gt; InsOrdHashMap k v -&gt; Maybe v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#lookup"><span class="hs-identifier hs-var">InsOrdHashMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621687414540"><span class="hs-identifier hs-var">collName</span></a></span><span> </span><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621687414538"><span class="hs-identifier hs-var">collections</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1364"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m CreateCollection
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#NotExists"><span class="hs-identifier hs-var">NotExists</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m CreateCollection) -&gt; Text -&gt; m CreateCollection
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;collection with name &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">CollectionName -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621687414540"><span class="hs-identifier hs-var">collName</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; does not exist&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1365"></span><span>      </span><span id="local-6989586621687414543"><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621687414543"><span class="hs-identifier hs-var">listedQuery</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1366"></span><span>        </span><span class="annot"><span class="annottext">(Maybe ListedQuery -&gt; m ListedQuery -&gt; m ListedQuery)
-&gt; m ListedQuery -&gt; Maybe ListedQuery -&gt; m ListedQuery
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span>
</span><span id="line-1367"></span><span>          </span><span class="annot"><span class="annottext">Maybe ListedQuery -&gt; m ListedQuery -&gt; m ListedQuery
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#onNothing"><span class="hs-identifier hs-var">onNothing</span></a></span><span>
</span><span id="line-1368"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m ListedQuery
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#NotExists"><span class="hs-identifier hs-var">NotExists</span></a></span><span>
</span><span id="line-1369"></span><span>              </span><span class="annot"><span class="annottext">(Text -&gt; m ListedQuery) -&gt; Text -&gt; m ListedQuery
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;query with name &quot;</span></span><span>
</span><span id="line-1370"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">QueryName -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">QueryName
</span><a href="#local-6989586621687414541"><span class="hs-identifier hs-var">queryName</span></a></span><span>
</span><span id="line-1371"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; does not exist in collection &quot;</span></span><span>
</span><span id="line-1372"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">CollectionName -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621687414540"><span class="hs-identifier hs-var">collName</span></a></span><span>
</span><span id="line-1373"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-1374"></span><span>          </span><span class="annot"><span class="annottext">(Maybe ListedQuery -&gt; m ListedQuery)
-&gt; Maybe ListedQuery -&gt; m ListedQuery
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ListedQuery -&gt; Bool) -&gt; [ListedQuery] -&gt; Maybe ListedQuery
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">QueryName -&gt; QueryName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">QueryName
</span><a href="#local-6989586621687414541"><span class="hs-identifier hs-var">queryName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QueryName -&gt; Bool)
-&gt; (ListedQuery -&gt; QueryName) -&gt; ListedQuery -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ListedQuery -&gt; QueryName
</span><a href="Hasura.RQL.Types.QueryCollection.html#_lqName"><span class="hs-identifier hs-var">_lqName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectionDef -&gt; [ListedQuery]
</span><a href="Hasura.RQL.Types.QueryCollection.html#_cdQueries"><span class="hs-identifier hs-var">_cdQueries</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CreateCollection -&gt; CollectionDef
</span><a href="Hasura.RQL.Types.QueryCollection.html#_ccDefinition"><span class="hs-identifier hs-var">_ccDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">CreateCollection
</span><a href="#local-6989586621687414542"><span class="hs-identifier hs-var">collection</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1375"></span><span>
</span><span id="line-1376"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687414548"><span class="annot"><span class="annottext">lq :: GQLQueryWithText
</span><a href="#local-6989586621687414548"><span class="hs-identifier hs-var">lq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#GQLQueryWithText"><span class="hs-identifier hs-type">GQLQueryWithText</span></a></span><span> </span><span id="local-6989586621687414550"><span class="annot"><span class="annottext">(Text, GQLQuery)
</span><a href="#local-6989586621687414550"><span class="hs-identifier hs-var">lqq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ListedQuery -&gt; GQLQueryWithText
</span><a href="Hasura.RQL.Types.QueryCollection.html#_lqQuery"><span class="hs-identifier hs-var">_lqQuery</span></a></span><span> </span><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621687414543"><span class="hs-identifier hs-var">listedQuery</span></a></span><span>
</span><span id="line-1377"></span><span>          </span><span id="local-6989586621687414552"><span class="annot"><span class="annottext">ds :: [ExecutableDefinition Name]
</span><a href="#local-6989586621687414552"><span class="hs-identifier hs-var hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExecutableDocument Name -&gt; [ExecutableDefinition Name]
forall var. ExecutableDocument var -&gt; [ExecutableDefinition var]
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src/Language.GraphQL.Draft.Syntax.html#getExecutableDefinitions"><span class="hs-identifier hs-var">G.getExecutableDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">(ExecutableDocument Name -&gt; [ExecutableDefinition Name])
-&gt; ExecutableDocument Name -&gt; [ExecutableDefinition Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GQLQuery -&gt; ExecutableDocument Name
</span><a href="Hasura.RQL.Types.QueryCollection.html#unGQLQuery"><span class="hs-identifier hs-var">unGQLQuery</span></a></span><span> </span><span class="annot"><span class="annottext">(GQLQuery -&gt; ExecutableDocument Name)
-&gt; GQLQuery -&gt; ExecutableDocument Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Text, GQLQuery) -&gt; GQLQuery
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(Text, GQLQuery)
</span><a href="#local-6989586621687414550"><span class="hs-identifier hs-var">lqq</span></a></span><span>
</span><span id="line-1378"></span><span>
</span><span id="line-1379"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[ExecutableDefinition Name]
</span><a href="#local-6989586621687414552"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1380"></span><span>        </span><span class="hs-special">[</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src/Language.GraphQL.Draft.Syntax.html#ExecutableDefinitionOperation"><span class="hs-identifier hs-type">G.ExecutableDefinitionOperation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src/Language.GraphQL.Draft.Syntax.html#OperationDefinitionTyped"><span class="hs-identifier hs-type">G.OperationDefinitionTyped</span></a></span><span> </span><span id="local-6989586621687414557"><span class="annot"><span class="annottext">TypedOperationDefinition FragmentSpread Name
</span><a href="#local-6989586621687414557"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1381"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TypedOperationDefinition FragmentSpread Name -&gt; OperationType
forall (frag :: * -&gt; *) var.
TypedOperationDefinition frag var -&gt; OperationType
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src/Language.GraphQL.Draft.Syntax.html#_todType"><span class="hs-identifier hs-var">G._todType</span></a></span><span> </span><span class="annot"><span class="annottext">TypedOperationDefinition FragmentSpread Name
</span><a href="#local-6989586621687414557"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">OperationType -&gt; OperationType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OperationType
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src/Language.GraphQL.Draft.Syntax.html#OperationTypeSubscription"><span class="hs-identifier hs-var">G.OperationTypeSubscription</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1382"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#throw405"><span class="hs-identifier hs-var">throw405</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;query with name &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">QueryName -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">QueryName
</span><a href="#local-6989586621687414541"><span class="hs-identifier hs-var">queryName</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; is a subscription&quot;</span></span><span>
</span><span id="line-1383"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1384"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#BadRequest"><span class="hs-identifier hs-var">BadRequest</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;query with name &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">QueryName -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">QueryName
</span><a href="#local-6989586621687414541"><span class="hs-identifier hs-var">queryName</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; has no definitions.&quot;</span></span><span>
</span><span id="line-1385"></span><span>        </span><span class="annot"><span class="annottext">[ExecutableDefinition Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#BadRequest"><span class="hs-identifier hs-var">BadRequest</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;query with name &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">QueryName -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">QueryName
</span><a href="#local-6989586621687414541"><span class="hs-identifier hs-var">queryName</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; has multiple definitions.&quot;</span></span><span>
</span><span id="line-1386"></span><span>
</span><span id="line-1387"></span><span>      </span><span class="annot"><span class="annottext">GQLQueryWithText -&gt; m GQLQueryWithText
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">GQLQueryWithText
</span><a href="#local-6989586621687414548"><span class="hs-identifier hs-var">lq</span></a></span><span>
</span><span id="line-1388"></span><span>
</span><span id="line-1389"></span><span>    </span><span class="annot"><a href="#local-6989586621687414562"><span class="hs-identifier hs-type">mkEventTriggerMetadataObject</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1390"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687410669"><span class="annot"><a href="#local-6989586621687410669"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621687410670"><span class="annot"><a href="#local-6989586621687410670"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621687410671"><span class="annot"><a href="#local-6989586621687410671"><span class="hs-identifier hs-type">c</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1391"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410669"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1392"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#CacheDynamicConfig"><span class="hs-identifier hs-type">CacheDynamicConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621687410670"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621687410671"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410669"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#RecreateEventTriggers"><span class="hs-identifier hs-type">RecreateEventTriggers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#EventTriggerConf"><span class="hs-identifier hs-type">EventTriggerConf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410669"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1393"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span><span>
</span><span id="line-1394"></span><span>    </span><span id="local-6989586621687414562"><span class="annot"><span class="annottext">mkEventTriggerMetadataObject :: forall (b :: BackendType) a c.
Backend b =&gt;
(CacheDynamicConfig, a, SourceName, c, TableName b,
 RecreateEventTriggers, EventTriggerConf b)
-&gt; MetadataObject
</span><a href="#local-6989586621687414562"><span class="hs-identifier hs-var hs-var">mkEventTriggerMetadataObject</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414565"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687414565"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414566"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621687414566"><span class="hs-identifier hs-var">table</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414567"><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621687414567"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1395"></span><span>      </span><span class="annot"><span class="annottext">SourceName -&gt; TableName b -&gt; EventTriggerConf b -&gt; MetadataObject
forall (b :: BackendType).
Backend b =&gt;
SourceName -&gt; TableName b -&gt; EventTriggerConf b -&gt; MetadataObject
</span><a href="#local-6989586621687412458"><span class="hs-identifier hs-var">mkEventTriggerMetadataObject'</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687414565"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621687414566"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621687414567"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span><span>
</span><span id="line-1396"></span><span>
</span><span id="line-1397"></span><span>    </span><span class="annot"><a href="#local-6989586621687412458"><span class="hs-identifier hs-type">mkEventTriggerMetadataObject'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1398"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687410261"><span class="annot"><a href="#local-6989586621687410261"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1399"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410261"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1400"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1401"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410261"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1402"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#EventTriggerConf"><span class="hs-identifier hs-type">EventTriggerConf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410261"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1403"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span><span>
</span><span id="line-1404"></span><span>    </span><span id="local-6989586621687412458"><span class="annot"><span class="annottext">mkEventTriggerMetadataObject' :: forall (b :: BackendType).
Backend b =&gt;
SourceName -&gt; TableName b -&gt; EventTriggerConf b -&gt; MetadataObject
</span><a href="#local-6989586621687412458"><span class="hs-identifier hs-var hs-var">mkEventTriggerMetadataObject'</span></a></span></span><span> </span><span id="local-6989586621687414583"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687414583"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621687414584"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621687414584"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span id="local-6989586621687414585"><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621687414585"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1405"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687414586"><span class="annot"><span class="annottext">objectId :: MetadataObjId
</span><a href="#local-6989586621687414586"><span class="hs-identifier hs-var hs-var">objectId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1406"></span><span>            </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceMetadataObjId -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOSourceObjId"><span class="hs-identifier hs-var">MOSourceObjId</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687414583"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-1407"></span><span>              </span><span class="annot"><span class="annottext">(AnyBackend SourceMetadataObjId -&gt; MetadataObjId)
-&gt; AnyBackend SourceMetadataObjId -&gt; MetadataObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span>
</span><span id="line-1408"></span><span>              </span><span class="annot"><span class="annottext">(SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId)
-&gt; SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
TableName b -&gt; TableMetadataObjId -&gt; SourceMetadataObjId b
</span><a href="Hasura.RQL.Types.Metadata.Object.html#SMOTableObj"><span class="hs-identifier hs-var">SMOTableObj</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410261"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621687414584"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-1409"></span><span>              </span><span class="annot"><span class="annottext">(TableMetadataObjId -&gt; SourceMetadataObjId b)
-&gt; TableMetadataObjId -&gt; SourceMetadataObjId b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; TableMetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MTOTrigger"><span class="hs-identifier hs-var">MTOTrigger</span></a></span><span>
</span><span id="line-1410"></span><span>              </span><span class="annot"><span class="annottext">(TriggerName -&gt; TableMetadataObjId)
-&gt; TriggerName -&gt; TableMetadataObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b -&gt; TriggerName
forall (b :: BackendType). EventTriggerConf b -&gt; TriggerName
</span><a href="Hasura.RQL.Types.EventTrigger.html#etcName"><span class="hs-identifier hs-var">etcName</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621687414585"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span><span>
</span><span id="line-1411"></span><span>          </span><span id="local-6989586621687414590"><span class="annot"><span class="annottext">definition :: Value
</span><a href="#local-6989586621687414590"><span class="hs-identifier hs-var hs-var">definition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.Internal.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;table&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; TableName b -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621687414584"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;configuration&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; EventTriggerConf b -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621687414585"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1412"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObjId
</span><a href="#local-6989586621687414586"><span class="hs-identifier hs-var">objectId</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687414590"><span class="hs-identifier hs-var">definition</span></a></span><span>
</span><span id="line-1413"></span><span>
</span><span id="line-1414"></span><span>    </span><span id="local-6989586621687414595"><span class="annot"><span class="annottext">mkCronTriggerMetadataObject :: CronTriggerMetadata -&gt; MetadataObject
</span><a href="#local-6989586621687414595"><span class="hs-identifier hs-var hs-var">mkCronTriggerMetadataObject</span></a></span></span><span> </span><span id="local-6989586621687414596"><span class="annot"><span class="annottext">CronTriggerMetadata
</span><a href="#local-6989586621687414596"><span class="hs-identifier hs-var">catalogCronTrigger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1415"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687414597"><span class="annot"><span class="annottext">definition :: Value
</span><a href="#local-6989586621687414597"><span class="hs-identifier hs-var hs-var">definition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata
</span><a href="#local-6989586621687414596"><span class="hs-identifier hs-var">catalogCronTrigger</span></a></span><span>
</span><span id="line-1416"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span>
</span><span id="line-1417"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TriggerName -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOCronTrigger"><span class="hs-identifier hs-var">MOCronTrigger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CronTriggerMetadata -&gt; TriggerName
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#ctName"><span class="hs-identifier hs-var">ctName</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata
</span><a href="#local-6989586621687414596"><span class="hs-identifier hs-var">catalogCronTrigger</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1418"></span><span>            </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687414597"><span class="hs-identifier hs-var">definition</span></a></span><span>
</span><span id="line-1419"></span><span>
</span><span id="line-1420"></span><span>    </span><span id="local-6989586621687414395"><span class="annot"><span class="annottext">mkActionMetadataObject :: ActionMetadata -&gt; MetadataObject
</span><a href="#local-6989586621687414395"><span class="hs-identifier hs-var hs-var">mkActionMetadataObject</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Action.html#ActionMetadata"><span class="hs-identifier hs-type">ActionMetadata</span></a></span><span> </span><span id="local-6989586621687414603"><span class="annot"><span class="annottext">ActionName
</span><a href="#local-6989586621687414603"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621687414604"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687414604"><span class="hs-identifier hs-var">comment</span></a></span></span><span> </span><span id="local-6989586621687414605"><span class="annot"><span class="annottext">ActionDefinitionInput
</span><a href="#local-6989586621687414605"><span class="hs-identifier hs-var">defn</span></a></span></span><span> </span><span class="annot"><span class="annottext">[ActionPermissionMetadata]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1421"></span><span>      </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActionName -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOAction"><span class="hs-identifier hs-var">MOAction</span></a></span><span> </span><span class="annot"><span class="annottext">ActionName
</span><a href="#local-6989586621687414603"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CreateAction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(CreateAction -&gt; Value) -&gt; CreateAction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ActionName -&gt; ActionDefinitionInput -&gt; Maybe Text -&gt; CreateAction
</span><a href="Hasura.RQL.DDL.Action.html#CreateAction"><span class="hs-identifier hs-var">CreateAction</span></a></span><span> </span><span class="annot"><span class="annottext">ActionName
</span><a href="#local-6989586621687414603"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">ActionDefinitionInput
</span><a href="#local-6989586621687414605"><span class="hs-identifier hs-var">defn</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687414604"><span class="hs-identifier hs-var">comment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1422"></span><span>
</span><span id="line-1423"></span><span>    </span><span id="local-6989586621687414610"><span class="annot"><span class="annottext">mkInheritedRoleMetadataObject :: Role -&gt; MetadataObject
</span><a href="#local-6989586621687414610"><span class="hs-identifier hs-var hs-var">mkInheritedRoleMetadataObject</span></a></span></span><span> </span><span id="local-6989586621687414611"><span class="annot"><span class="annottext">inheritedRole :: Role
</span><a href="#local-6989586621687414611"><span class="hs-identifier hs-var">inheritedRole</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Roles.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span id="local-6989586621687414612"><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621687414612"><span class="hs-identifier hs-var">roleName</span></a></span></span><span> </span><span class="annot"><span class="annottext">ParentRoles
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1424"></span><span>      </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RoleName -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOInheritedRole"><span class="hs-identifier hs-var">MOInheritedRole</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621687414612"><span class="hs-identifier hs-var">roleName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621687414611"><span class="hs-identifier hs-var">inheritedRole</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1425"></span><span>
</span><span id="line-1426"></span><span>    </span><span class="annot"><a href="#local-6989586621687414300"><span class="hs-identifier hs-type">buildTableEventTriggers</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1427"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687410602"><span class="annot"><a href="#local-6989586621687410602"><span class="hs-identifier hs-type">arr</span></a></span></span><span> </span><span id="local-6989586621687410603"><span class="annot"><a href="#local-6989586621687410603"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621687410604"><span class="annot"><a href="#local-6989586621687410604"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1428"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ArrowChoice</span></span><span> </span><span class="annot"><a href="#local-6989586621687410602"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1429"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Rule.html#ArrowDistribute"><span class="hs-identifier hs-type">Inc.ArrowDistribute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410602"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1430"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#ArrowWriter"><span class="hs-identifier hs-type">ArrowWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687410602"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1431"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#ArrowCache"><span class="hs-identifier hs-type">Inc.ArrowCache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410603"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410602"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1432"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687410603"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1433"></span><span>        </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-92f8a47f193bc8ca499a8b94581fad6cb68b7a26370b271798ac2ec617c05064/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687410603"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1434"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#BuildReason"><span class="hs-identifier hs-type">BuildReason</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410603"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1435"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410604"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1436"></span><span>        </span><span class="annot"><a href="Hasura.Eventing.Backend.html#BackendEventTrigger"><span class="hs-identifier hs-type">BackendEventTrigger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410604"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1437"></span><span>        </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#HasCacheStaticConfig"><span class="hs-identifier hs-type">HasCacheStaticConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410603"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-1438"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1439"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#CacheDynamicConfig"><span class="hs-identifier hs-type">CacheDynamicConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1440"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1441"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.SourceConfiguration.html#SourceConfig"><span class="hs-identifier hs-type">SourceConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410604"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1442"></span><span>        </span><span class="annot"><a href="Hasura.Table.Cache.html#TableCoreInfoG"><span class="hs-identifier hs-type">TableCoreInfoG</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410604"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Column.html#StructuredColumnInfo"><span class="hs-identifier hs-type">StructuredColumnInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410604"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Column.html#ColumnInfo"><span class="hs-identifier hs-type">ColumnInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410604"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1443"></span><span>        </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#EventTriggerConf"><span class="hs-identifier hs-type">EventTriggerConf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410604"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1444"></span><span>        </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Dependency.html#Dependency"><span class="hs-identifier hs-type">Inc.Dependency</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.html#InvalidationKey"><span class="hs-identifier hs-type">Inc.InvalidationKey</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1445"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#RecreateEventTriggers"><span class="hs-identifier hs-type">RecreateEventTriggers</span></a></span><span>
</span><span id="line-1446"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-1447"></span><span>        </span><span class="annot"><a href="#local-6989586621687410602"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#EventTriggerInfoMap"><span class="hs-identifier hs-type">EventTriggerInfoMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410604"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1448"></span><span>    </span><span id="local-6989586621687414300"><span class="annot"><span class="annottext">buildTableEventTriggers :: forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *) (b :: BackendType).
(ArrowChoice arr, ArrowDistribute arr,
 ArrowWriter (Seq CollectItem) arr, ArrowCache m arr, MonadIO m,
 MonadBaseControl IO m, MonadReader BuildReason m,
 BackendMetadata b, BackendEventTrigger b,
 HasCacheStaticConfig m) =&gt;
arr
  (CacheDynamicConfig, SourceName, SourceConfig b,
   TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b),
   [EventTriggerConf b], Dependency InvalidationKey,
   RecreateEventTriggers)
  (EventTriggerInfoMap b)
</span><a href="#local-6989586621687414300"><span class="hs-identifier hs-var hs-var">buildTableEventTriggers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687414724"><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687414724"><span class="hs-identifier hs-var">dynamicConfig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414725"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687414725"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414726"><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687414726"><span class="hs-identifier hs-var">sourceConfig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414727"><span class="annot"><span class="annottext">TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621687414727"><span class="hs-identifier hs-var">tableInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414728"><span class="annot"><span class="annottext">[EventTriggerConf b]
</span><a href="#local-6989586621687414728"><span class="hs-identifier hs-var">eventTriggerConfs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414729"><span class="annot"><span class="annottext">Dependency InvalidationKey
</span><a href="#local-6989586621687414729"><span class="hs-identifier hs-var">metadataInvalidationKey</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414730"><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="#local-6989586621687414730"><span class="hs-identifier hs-var">migrationRecreateEventTriggers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1449"></span><span>      </span><span class="annot"><span class="annottext">((CacheDynamicConfig, Dependency InvalidationKey, SourceName,
  SourceConfig b, TableName b, RecreateEventTriggers,
  EventTriggerConf b)
 -&gt; TriggerName)
-&gt; ((CacheDynamicConfig, Dependency InvalidationKey, SourceName,
     SourceConfig b, TableName b, RecreateEventTriggers,
     EventTriggerConf b)
    -&gt; MetadataObject)
-&gt; arr
     (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b),
      (CacheDynamicConfig, Dependency InvalidationKey, SourceName,
       SourceConfig b, TableName b, RecreateEventTriggers,
       EventTriggerConf b))
     (Maybe (EventTriggerInfo b))
-&gt; arr
     (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b),
      [(CacheDynamicConfig, Dependency InvalidationKey, SourceName,
        SourceConfig b, TableName b, RecreateEventTriggers,
        EventTriggerConf b)])
     (EventTriggerInfoMap b)
forall (arr :: * -&gt; * -&gt; *) k a e b.
(ArrowChoice arr, ArrowDistribute arr,
 ArrowWriter (Seq CollectItem) arr, Hashable k) =&gt;
(a -&gt; k)
-&gt; (a -&gt; MetadataObject)
-&gt; arr (e, a) (Maybe b)
-&gt; arr (e, [a]) (HashMap k b)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#buildInfoMap"><span class="hs-identifier hs-var">buildInfoMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EventTriggerConf b -&gt; TriggerName
forall (b :: BackendType). EventTriggerConf b -&gt; TriggerName
</span><a href="Hasura.RQL.Types.EventTrigger.html#etcName"><span class="hs-identifier hs-var">etcName</span></a></span><span> </span><span class="annot"><span class="annottext">(EventTriggerConf b -&gt; TriggerName)
-&gt; ((CacheDynamicConfig, Dependency InvalidationKey, SourceName,
     SourceConfig b, TableName b, RecreateEventTriggers,
     EventTriggerConf b)
    -&gt; EventTriggerConf b)
-&gt; (CacheDynamicConfig, Dependency InvalidationKey, SourceName,
    SourceConfig b, TableName b, RecreateEventTriggers,
    EventTriggerConf b)
-&gt; TriggerName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CacheDynamicConfig, Dependency InvalidationKey, SourceName,
 SourceConfig b, TableName b, RecreateEventTriggers,
 EventTriggerConf b)
-&gt; Getting
     (EventTriggerConf b)
     (CacheDynamicConfig, Dependency InvalidationKey, SourceName,
      SourceConfig b, TableName b, RecreateEventTriggers,
      EventTriggerConf b)
     (EventTriggerConf b)
-&gt; EventTriggerConf b
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-70a68698e02c1d9dc133c543e6497a7241e5514570afd4815da4baf2a001e00e/share/doc/html/src/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (EventTriggerConf b)
  (CacheDynamicConfig, Dependency InvalidationKey, SourceName,
   SourceConfig b, TableName b, RecreateEventTriggers,
   EventTriggerConf b)
  (EventTriggerConf b)
forall s t a b. Field7 s t a b =&gt; Lens s t a b
Lens
  (CacheDynamicConfig, Dependency InvalidationKey, SourceName,
   SourceConfig b, TableName b, RecreateEventTriggers,
   EventTriggerConf b)
  (CacheDynamicConfig, Dependency InvalidationKey, SourceName,
   SourceConfig b, TableName b, RecreateEventTriggers,
   EventTriggerConf b)
  (EventTriggerConf b)
  (EventTriggerConf b)
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-70a68698e02c1d9dc133c543e6497a7241e5514570afd4815da4baf2a001e00e/share/doc/html/src/Control.Lens.Tuple.html#_7"><span class="hs-identifier hs-var">_7</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType) a c.
Backend b =&gt;
(CacheDynamicConfig, a, SourceName, c, TableName b,
 RecreateEventTriggers, EventTriggerConf b)
-&gt; MetadataObject
</span><a href="#local-6989586621687414562"><span class="hs-identifier hs-var">mkEventTriggerMetadataObject</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410604"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">arr
  (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b),
   (CacheDynamicConfig, Dependency InvalidationKey, SourceName,
    SourceConfig b, TableName b, RecreateEventTriggers,
    EventTriggerConf b))
  (Maybe (EventTriggerInfo b))
</span><a href="#local-6989586621687414733"><span class="hs-identifier hs-var">buildEventTrigger</span></a></span><span>
</span><span id="line-1450"></span><span>        </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-1451"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621687414727"><span class="hs-identifier hs-var">tableInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b)
-&gt; (TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b)
    -&gt; TableCoreInfoG b (ColumnInfo b) (ColumnInfo b))
-&gt; TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(FieldInfoMap (StructuredColumnInfo b)
 -&gt; Identity (FieldInfoMap (ColumnInfo b)))
-&gt; TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b)
-&gt; Identity (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b))
forall (b :: BackendType) field1 primaryKeyColumn field2
       (f :: * -&gt; *).
Functor f =&gt;
(FieldInfoMap field1 -&gt; f (FieldInfoMap field2))
-&gt; TableCoreInfoG b field1 primaryKeyColumn
-&gt; f (TableCoreInfoG b field2 primaryKeyColumn)
</span><a href="Hasura.Table.Cache.html#tciFieldInfoMap"><span class="hs-identifier hs-var">tciFieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">((FieldInfoMap (StructuredColumnInfo b)
  -&gt; Identity (FieldInfoMap (ColumnInfo b)))
 -&gt; TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b)
 -&gt; Identity (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)))
-&gt; (FieldInfoMap (StructuredColumnInfo b)
    -&gt; FieldInfoMap (ColumnInfo b))
-&gt; TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b)
-&gt; TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-70a68698e02c1d9dc133c543e6497a7241e5514570afd4815da4baf2a001e00e/share/doc/html/src/Control.Lens.Setter.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">(StructuredColumnInfo b -&gt; Maybe (ColumnInfo b))
-&gt; FieldInfoMap (StructuredColumnInfo b)
-&gt; FieldInfoMap (ColumnInfo b)
forall v1 v2 k. (v1 -&gt; Maybe v2) -&gt; HashMap k v1 -&gt; HashMap k v2
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.Strict.html#mapMaybe"><span class="hs-identifier hs-var">HashMap.mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">StructuredColumnInfo b -&gt; Maybe (ColumnInfo b)
forall (b :: BackendType).
StructuredColumnInfo b -&gt; Maybe (ColumnInfo b)
</span><a href="Hasura.RQL.Types.Column.html#toScalarColumnInfo"><span class="hs-identifier hs-var">toScalarColumnInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(EventTriggerConf b
 -&gt; (CacheDynamicConfig, Dependency InvalidationKey, SourceName,
     SourceConfig b, TableName b, RecreateEventTriggers,
     EventTriggerConf b))
-&gt; [EventTriggerConf b]
-&gt; [(CacheDynamicConfig, Dependency InvalidationKey, SourceName,
     SourceConfig b, TableName b, RecreateEventTriggers,
     EventTriggerConf b)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687414724"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Dependency InvalidationKey
</span><a href="#local-6989586621687414729"><span class="hs-identifier hs-var">metadataInvalidationKey</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687414725"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687414726"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b)
-&gt; TableName b
forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn -&gt; TableName b
</span><a href="Hasura.Table.Cache.html#_tciName"><span class="hs-identifier hs-var">_tciName</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (StructuredColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621687414727"><span class="hs-identifier hs-var">tableInfo</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="#local-6989586621687414730"><span class="hs-identifier hs-var">migrationRecreateEventTriggers</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[EventTriggerConf b]
</span><a href="#local-6989586621687414728"><span class="hs-identifier hs-var">eventTriggerConfs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1452"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1453"></span><span>        </span><span id="local-6989586621687414733"><span class="annot"><span class="annottext">buildEventTrigger :: arr
  (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b),
   (CacheDynamicConfig, Dependency InvalidationKey, SourceName,
    SourceConfig b, TableName b, RecreateEventTriggers,
    EventTriggerConf b))
  (Maybe (EventTriggerInfo b))
</span><a href="#local-6989586621687414733"><span class="hs-identifier hs-var hs-var">buildEventTrigger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687414739"><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621687414739"><span class="hs-identifier hs-var">tableInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687414740"><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687414740"><span class="hs-identifier hs-var">dynamicConfig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414741"><span class="annot"><span class="annottext">Dependency InvalidationKey
</span><a href="#local-6989586621687414741"><span class="hs-identifier hs-var">_metadataInvalidationKey</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414742"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687414742"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414743"><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687414743"><span class="hs-identifier hs-var">sourceConfig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414744"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621687414744"><span class="hs-identifier hs-var">table</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414745"><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="#local-6989586621687414745"><span class="hs-identifier hs-var">migrationRecreateEventTriggers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414746"><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621687414746"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1454"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687414747"><span class="annot"><span class="annottext">triggerName :: TriggerName
</span><a href="#local-6989586621687414747"><span class="hs-identifier hs-var hs-var">triggerName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b -&gt; TriggerName
forall (b :: BackendType). EventTriggerConf b -&gt; TriggerName
</span><a href="Hasura.RQL.Types.EventTrigger.html#etcName"><span class="hs-identifier hs-var">etcName</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621687414746"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span><span>
</span><span id="line-1455"></span><span>              </span><span id="local-6989586621687414748"><span class="annot"><span class="annottext">triggerOnReplication :: TriggerOnReplication
</span><a href="#local-6989586621687414748"><span class="hs-identifier hs-var hs-var">triggerOnReplication</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b -&gt; TriggerOnReplication
forall (b :: BackendType).
EventTriggerConf b -&gt; TriggerOnReplication
</span><a href="Hasura.RQL.Types.EventTrigger.html#etcTriggerOnReplication"><span class="hs-identifier hs-var">etcTriggerOnReplication</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621687414746"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span><span>
</span><span id="line-1456"></span><span>              </span><span id="local-6989586621687414750"><span class="annot"><span class="annottext">metadataObject :: MetadataObject
</span><a href="#local-6989586621687414750"><span class="hs-identifier hs-var hs-var">metadataObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
Backend b =&gt;
SourceName -&gt; TableName b -&gt; EventTriggerConf b -&gt; MetadataObject
</span><a href="#local-6989586621687412458"><span class="hs-identifier hs-var">mkEventTriggerMetadataObject'</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410604"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687414742"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621687414744"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621687414746"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span><span>
</span><span id="line-1457"></span><span>              </span><span id="local-6989586621687414751"><span class="annot"><span class="annottext">schemaObjectId :: SchemaObjId
</span><a href="#local-6989586621687414751"><span class="hs-identifier hs-var hs-var">schemaObjectId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1458"></span><span>                </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceObjId -&gt; SchemaObjId
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SOSourceObj"><span class="hs-identifier hs-var">SOSourceObj</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687414742"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-1459"></span><span>                  </span><span class="annot"><span class="annottext">(AnyBackend SourceObjId -&gt; SchemaObjId)
-&gt; AnyBackend SourceObjId -&gt; SchemaObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceObjId b -&gt; AnyBackend SourceObjId
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span>
</span><span id="line-1460"></span><span>                  </span><span class="annot"><span class="annottext">(SourceObjId b -&gt; AnyBackend SourceObjId)
-&gt; SourceObjId b -&gt; AnyBackend SourceObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
TableName b -&gt; TableObjId b -&gt; SourceObjId b
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SOITableObj"><span class="hs-identifier hs-var">SOITableObj</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410604"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621687414744"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-1461"></span><span>                  </span><span class="annot"><span class="annottext">(TableObjId b -&gt; SourceObjId b) -&gt; TableObjId b -&gt; SourceObjId b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; TableObjId b
forall (b :: BackendType). TriggerName -&gt; TableObjId b
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#TOTrigger"><span class="hs-identifier hs-var">TOTrigger</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687414747"><span class="hs-identifier hs-var">triggerName</span></a></span><span>
</span><span id="line-1462"></span><span>              </span><span id="local-6989586621687414754"><span class="annot"><span class="annottext">addTriggerContext :: Text -&gt; Text
</span><a href="#local-6989586621687414754"><span class="hs-identifier hs-var hs-var">addTriggerContext</span></a></span></span><span> </span><span id="local-6989586621687414755"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687414755"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;in event trigger &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687414747"><span class="hs-identifier hs-var">triggerName</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687414755"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1463"></span><span>          </span><span id="local-6989586621687414756"><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621687414756"><span class="hs-identifier hs-var">buildReason</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr (m BuildReason) BuildReason
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html#bindA"><span class="hs-identifier hs-var">bindA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">m BuildReason
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1464"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687414757"><span class="annot"><span class="annottext">reloadMetadataRecreateEventTrigger :: RecreateEventTriggers
</span><a href="#local-6989586621687414757"><span class="hs-identifier hs-var hs-var">reloadMetadataRecreateEventTrigger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1465"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621687414756"><span class="hs-identifier hs-var">buildReason</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1466"></span><span>                  </span><span class="annot"><span class="annottext">BuildReason
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogSync"><span class="hs-identifier hs-var">CatalogSync</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETDoNothing"><span class="hs-identifier hs-var">RETDoNothing</span></a></span><span>
</span><span id="line-1467"></span><span>                  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogUpdate"><span class="hs-identifier hs-type">CatalogUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (HashSet SourceName)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETDoNothing"><span class="hs-identifier hs-var">RETDoNothing</span></a></span><span>
</span><span id="line-1468"></span><span>                  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogUpdate"><span class="hs-identifier hs-type">CatalogUpdate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621687414758"><span class="annot"><span class="annottext">HashSet SourceName
</span><a href="#local-6989586621687414758"><span class="hs-identifier hs-var">sources</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687414742"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; HashSet SourceName -&gt; Bool
forall a. Eq a =&gt; a -&gt; HashSet a -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">HashSet SourceName
</span><a href="#local-6989586621687414758"><span class="hs-identifier hs-var">sources</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETRecreate"><span class="hs-identifier hs-var">RETRecreate</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETDoNothing"><span class="hs-identifier hs-var">RETDoNothing</span></a></span><span>
</span><span id="line-1469"></span><span>          </span><span class="hs-glyph">(|</span><span>
</span><span id="line-1470"></span><span>            </span><span class="annot"><span class="annottext">ErrorA QErr arr (a, ()) (EventTriggerInfo b)
-&gt; arr (a, (MetadataObject, ())) (Maybe (EventTriggerInfo b))
forall {a}.
ErrorA QErr arr (a, ()) (EventTriggerInfo b)
-&gt; arr (a, (MetadataObject, ())) (Maybe (EventTriggerInfo b))
forall (arr :: * -&gt; * -&gt; *) e s a.
(ArrowChoice arr, ArrowWriter (Seq CollectItem) arr) =&gt;
ErrorA QErr arr (e, s) a -&gt; arr (e, (MetadataObject, s)) (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistency"><span class="hs-identifier hs-var">withRecordInconsistency</span></a></span><span>
</span><span id="line-1471"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1472"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621687414762"><span class="annot"><span class="annottext">EventTriggerInfo b
</span><a href="#local-6989586621687414762"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414763"><span class="annot"><span class="annottext">Seq SchemaDependency
</span><a href="#local-6989586621687414763"><span class="hs-identifier hs-var">dependencies</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ErrorA
  QErr
  arr
  (ExceptT QErr m (EventTriggerInfo b, Seq SchemaDependency))
  (EventTriggerInfo b, Seq SchemaDependency)
forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *) e a.
(ArrowChoice arr, ArrowKleisli m arr, ArrowError e arr) =&gt;
arr (ExceptT e m a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html#bindErrorA"><span class="hs-identifier hs-var">bindErrorA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text)
-&gt; ExceptT QErr m (EventTriggerInfo b, Seq SchemaDependency)
-&gt; ExceptT QErr m (EventTriggerInfo b, Seq SchemaDependency)
forall (m :: * -&gt; *) a. QErrM m =&gt; (Text -&gt; Text) -&gt; m a -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#modifyErr"><span class="hs-identifier hs-var">modifyErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType). Backend b =&gt; TableName b -&gt; Text -&gt; Text
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#addTableContext"><span class="hs-identifier hs-var">addTableContext</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410604"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621687414744"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (Text -&gt; Text) -&gt; Text -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621687414754"><span class="hs-identifier hs-var">addTriggerContext</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT QErr m (EventTriggerInfo b, Seq SchemaDependency)
 -&gt; ExceptT QErr m (EventTriggerInfo b, Seq SchemaDependency))
-&gt; ExceptT QErr m (EventTriggerInfo b, Seq SchemaDependency)
-&gt; ExceptT QErr m (EventTriggerInfo b, Seq SchemaDependency)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(Backend b, QErrM m) =&gt;
Environment
-&gt; SourceName
-&gt; TableName b
-&gt; EventTriggerConf b
-&gt; m (EventTriggerInfo b, Seq SchemaDependency)
</span><a href="Hasura.RQL.DDL.EventTrigger.html#buildEventTriggerInfo"><span class="hs-identifier hs-var">buildEventTriggerInfo</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410604"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621687411809"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687414742"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621687414744"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621687414746"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span><span>
</span><span id="line-1473"></span><span>                  </span><span id="local-6989586621687414765"><span class="annot"><span class="annottext">CacheStaticConfig
</span><a href="#local-6989586621687414765"><span class="hs-identifier hs-var">staticConfig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ErrorA QErr arr (m CacheStaticConfig) CacheStaticConfig
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html#bindA"><span class="hs-identifier hs-var">bindA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">m CacheStaticConfig
forall (m :: * -&gt; *). HasCacheStaticConfig m =&gt; m CacheStaticConfig
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#askCacheStaticConfig"><span class="hs-identifier hs-var">askCacheStaticConfig</span></a></span><span>
</span><span id="line-1474"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687414766"><span class="annot"><span class="annottext">isCatalogUpdate :: Bool
</span><a href="#local-6989586621687414766"><span class="hs-identifier hs-var hs-var">isCatalogUpdate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1475"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621687414756"><span class="hs-identifier hs-var">buildReason</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1476"></span><span>                          </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogUpdate"><span class="hs-identifier hs-type">CatalogUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (HashSet SourceName)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1477"></span><span>                          </span><span class="annot"><span class="annottext">BuildReason
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogSync"><span class="hs-identifier hs-var">CatalogSync</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1478"></span><span>                      </span><span id="local-6989586621687414767"><span class="annot"><span class="annottext">tableColumns :: [ColumnInfo b]
</span><a href="#local-6989586621687414767"><span class="hs-identifier hs-var hs-var">tableColumns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (ColumnInfo b) -&gt; [ColumnInfo b]
forall k v. HashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#elems"><span class="hs-identifier hs-var">HashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldInfoMap (ColumnInfo b) -&gt; [ColumnInfo b])
-&gt; FieldInfoMap (ColumnInfo b) -&gt; [ColumnInfo b]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
-&gt; FieldInfoMap (ColumnInfo b)
forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn -&gt; FieldInfoMap field
</span><a href="Hasura.Table.Cache.html#_tciFieldInfoMap"><span class="hs-identifier hs-var">_tciFieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621687414739"><span class="hs-identifier hs-var">tableInfo</span></a></span><span>
</span><span id="line-1479"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">CacheStaticConfig -&gt; MaintenanceMode ()
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cscMaintenanceMode"><span class="hs-identifier hs-var">_cscMaintenanceMode</span></a></span><span> </span><span class="annot"><span class="annottext">CacheStaticConfig
</span><a href="#local-6989586621687414765"><span class="hs-identifier hs-var">staticConfig</span></a></span><span>
</span><span id="line-1480"></span><span>                         </span><span class="annot"><span class="annottext">MaintenanceMode () -&gt; MaintenanceMode () -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">MaintenanceMode ()
forall a. MaintenanceMode a
</span><a href="Hasura.Server.Types.html#MaintenanceModeDisabled"><span class="hs-identifier hs-var">MaintenanceModeDisabled</span></a></span><span>
</span><span id="line-1481"></span><span>                         </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">CacheStaticConfig -&gt; ReadOnlyMode
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cscReadOnlyMode"><span class="hs-identifier hs-var">_cscReadOnlyMode</span></a></span><span> </span><span class="annot"><span class="annottext">CacheStaticConfig
</span><a href="#local-6989586621687414765"><span class="hs-identifier hs-var">staticConfig</span></a></span><span>
</span><span id="line-1482"></span><span>                         </span><span class="annot"><span class="annottext">ReadOnlyMode -&gt; ReadOnlyMode -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="Hasura.Server.Types.html#ReadOnlyModeDisabled"><span class="hs-identifier hs-var">ReadOnlyModeDisabled</span></a></span><span>
</span><span id="line-1483"></span><span>                     </span><span class="hs-special">)</span><span>
</span><span id="line-1484"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1485"></span><span>                      </span><span class="annot"><span class="annottext">ErrorA QErr arr (ExceptT QErr m ()) ()
forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *) e a.
(ArrowChoice arr, ArrowKleisli m arr, ArrowError e arr) =&gt;
arr (ExceptT e m a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html#bindErrorA"><span class="hs-identifier hs-var">bindErrorA</span></a></span><span>
</span><span id="line-1486"></span><span>                        </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-1487"></span><span>                          </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT QErr m () -&gt; ExceptT QErr m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="#local-6989586621687414757"><span class="hs-identifier hs-var">reloadMetadataRecreateEventTrigger</span></a></span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers -&gt; RecreateEventTriggers -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETRecreate"><span class="hs-identifier hs-var">RETRecreate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1488"></span><span>                            </span><span class="annot"><span class="annottext">(ExceptT QErr m () -&gt; ExceptT QErr m ())
-&gt; ExceptT QErr m () -&gt; ExceptT QErr m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1489"></span><span>                            </span><span class="hs-comment">-- This is the case when the user sets `recreate_event_triggers`</span><span>
</span><span id="line-1490"></span><span>                            </span><span class="hs-comment">-- to `true` in `reload_metadata`, in this case, we recreate</span><span>
</span><span id="line-1491"></span><span>                            </span><span class="hs-comment">-- the SQL trigger by force, even if it may not be necessary</span><span>
</span><span id="line-1492"></span><span>                            </span><span class="hs-comment">-- TODO: Should we also mark the event trigger as inconsistent here?</span><span>
</span><span id="line-1493"></span><span>                            </span><span class="annot"><span class="annottext">ExceptT QErr m (Either QErr ()) -&gt; ExceptT QErr m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#liftEitherM"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span>
</span><span id="line-1494"></span><span>                            </span><span class="annot"><span class="annottext">(ExceptT QErr m (Either QErr ()) -&gt; ExceptT QErr m ())
-&gt; ExceptT QErr m (Either QErr ()) -&gt; ExceptT QErr m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(BackendEventTrigger b, MonadBaseControl IO m, MonadIO m,
 MonadError QErr m) =&gt;
SQLGenCtx
-&gt; SourceConfig b
-&gt; TableName b
-&gt; [ColumnInfo b]
-&gt; TriggerName
-&gt; TriggerOnReplication
-&gt; TriggerOpsDef b
-&gt; Maybe (PrimaryKey b (ColumnInfo b))
-&gt; m (Either QErr ())
</span><a href="Hasura.Eventing.Backend.html#createTableEventTrigger"><span class="hs-identifier hs-var">createTableEventTrigger</span></a></span><span>
</span><span id="line-1495"></span><span>                              </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410604"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-1496"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CacheDynamicConfig -&gt; SQLGenCtx
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cdcSQLGenCtx"><span class="hs-identifier hs-var">_cdcSQLGenCtx</span></a></span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687414740"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1497"></span><span>                              </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687414743"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span>
</span><span id="line-1498"></span><span>                              </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621687414744"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-1499"></span><span>                              </span><span class="annot"><span class="annottext">[ColumnInfo b]
</span><a href="#local-6989586621687414767"><span class="hs-identifier hs-var">tableColumns</span></a></span><span>
</span><span id="line-1500"></span><span>                              </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687414747"><span class="hs-identifier hs-var">triggerName</span></a></span><span>
</span><span id="line-1501"></span><span>                              </span><span class="annot"><span class="annottext">TriggerOnReplication
</span><a href="#local-6989586621687414748"><span class="hs-identifier hs-var">triggerOnReplication</span></a></span><span>
</span><span id="line-1502"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EventTriggerConf b -&gt; TriggerOpsDef b
forall (b :: BackendType). EventTriggerConf b -&gt; TriggerOpsDef b
</span><a href="Hasura.RQL.Types.EventTrigger.html#etcDefinition"><span class="hs-identifier hs-var">etcDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621687414746"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1503"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
-&gt; Maybe (PrimaryKey b (ColumnInfo b))
forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn
-&gt; Maybe (PrimaryKey b primaryKeyColumn)
</span><a href="Hasura.Table.Cache.html#_tciPrimaryKey"><span class="hs-identifier hs-var">_tciPrimaryKey</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621687414739"><span class="hs-identifier hs-var">tableInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1504"></span><span>                      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687414766"><span class="hs-identifier hs-var">isCatalogUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="#local-6989586621687414745"><span class="hs-identifier hs-var">migrationRecreateEventTriggers</span></a></span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers -&gt; RecreateEventTriggers -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETRecreate"><span class="hs-identifier hs-var">RETRecreate</span></a></span><span>
</span><span id="line-1505"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1506"></span><span>                          </span><span class="annot"><span class="annottext">ErrorA
  QErr
  arr
  (CacheDynamicConfig, TableName b, [ColumnInfo b], TriggerName,
   TriggerOnReplication, TriggerOpsDef b, SourceConfig b,
   Maybe (PrimaryKey b (ColumnInfo b)))
  ()
</span><a href="#local-6989586621687414776"><span class="hs-identifier hs-var">recreateTriggerIfNeeded</span></a></span><span>
</span><span id="line-1507"></span><span>                            </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-1508"></span><span>                              </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687414740"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1509"></span><span>                                </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621687414744"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1510"></span><span>                                </span><span class="annot"><span class="annottext">[ColumnInfo b]
</span><a href="#local-6989586621687414767"><span class="hs-identifier hs-var">tableColumns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1511"></span><span>                                </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687414747"><span class="hs-identifier hs-var">triggerName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1512"></span><span>                                </span><span class="annot"><span class="annottext">TriggerOnReplication
</span><a href="#local-6989586621687414748"><span class="hs-identifier hs-var">triggerOnReplication</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1513"></span><span>                                </span><span class="annot"><span class="annottext">EventTriggerConf b -&gt; TriggerOpsDef b
forall (b :: BackendType). EventTriggerConf b -&gt; TriggerOpsDef b
</span><a href="Hasura.RQL.Types.EventTrigger.html#etcDefinition"><span class="hs-identifier hs-var">etcDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621687414746"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1514"></span><span>                                </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687414743"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1515"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
-&gt; Maybe (PrimaryKey b (ColumnInfo b))
forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn
-&gt; Maybe (PrimaryKey b primaryKeyColumn)
</span><a href="Hasura.Table.Cache.html#_tciPrimaryKey"><span class="hs-identifier hs-var">_tciPrimaryKey</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621687414739"><span class="hs-identifier hs-var">tableInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1516"></span><span>                              </span><span class="hs-special">)</span><span>
</span><span id="line-1517"></span><span>                          </span><span class="hs-comment">-- We check if the SQL triggers for the event triggers</span><span>
</span><span id="line-1518"></span><span>                          </span><span class="hs-comment">-- are present. If any SQL triggers are missing, those are</span><span>
</span><span id="line-1519"></span><span>                          </span><span class="hs-comment">-- created.</span><span>
</span><span id="line-1520"></span><span>                          </span><span class="annot"><span class="annottext">ErrorA QErr arr (ExceptT QErr m ()) ()
forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *) e a.
(ArrowChoice arr, ArrowKleisli m arr, ArrowError e arr) =&gt;
arr (ExceptT e m a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html#bindErrorA"><span class="hs-identifier hs-var">bindErrorA</span></a></span><span>
</span><span id="line-1521"></span><span>                            </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-1522"></span><span>                              </span><span class="annot"><span class="annottext">SQLGenCtx
-&gt; SourceConfig b
-&gt; TableName b
-&gt; ([ColumnInfo b], Maybe (PrimaryKey b (ColumnInfo b)))
-&gt; TriggerName
-&gt; TriggerOnReplication
-&gt; TriggerOpsDef b
-&gt; ExceptT QErr m ()
forall (b :: BackendType) (m :: * -&gt; *).
(BackendEventTrigger b, MonadIO m, MonadError QErr m,
 MonadBaseControl IO m, Backend b) =&gt;
SQLGenCtx
-&gt; SourceConfig b
-&gt; TableName b
-&gt; ([ColumnInfo b], Maybe (PrimaryKey b (ColumnInfo b)))
-&gt; TriggerName
-&gt; TriggerOnReplication
-&gt; TriggerOpsDef b
-&gt; m ()
forall (m :: * -&gt; *).
(MonadIO m, MonadError QErr m, MonadBaseControl IO m, Backend b) =&gt;
SQLGenCtx
-&gt; SourceConfig b
-&gt; TableName b
-&gt; ([ColumnInfo b], Maybe (PrimaryKey b (ColumnInfo b)))
-&gt; TriggerName
-&gt; TriggerOnReplication
-&gt; TriggerOpsDef b
-&gt; m ()
</span><a href="Hasura.Eventing.Backend.html#createMissingSQLTriggers"><span class="hs-identifier hs-var">createMissingSQLTriggers</span></a></span><span>
</span><span id="line-1523"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CacheDynamicConfig -&gt; SQLGenCtx
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cdcSQLGenCtx"><span class="hs-identifier hs-var">_cdcSQLGenCtx</span></a></span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687414740"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1524"></span><span>                                </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687414743"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span>
</span><span id="line-1525"></span><span>                                </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621687414744"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-1526"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ColumnInfo b]
</span><a href="#local-6989586621687414767"><span class="hs-identifier hs-var">tableColumns</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
-&gt; Maybe (PrimaryKey b (ColumnInfo b))
forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn
-&gt; Maybe (PrimaryKey b primaryKeyColumn)
</span><a href="Hasura.Table.Cache.html#_tciPrimaryKey"><span class="hs-identifier hs-var">_tciPrimaryKey</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621687414739"><span class="hs-identifier hs-var">tableInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1527"></span><span>                                </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687414747"><span class="hs-identifier hs-var">triggerName</span></a></span><span>
</span><span id="line-1528"></span><span>                                </span><span class="annot"><span class="annottext">TriggerOnReplication
</span><a href="#local-6989586621687414748"><span class="hs-identifier hs-var">triggerOnReplication</span></a></span><span>
</span><span id="line-1529"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EventTriggerConf b -&gt; TriggerOpsDef b
forall (b :: BackendType). EventTriggerConf b -&gt; TriggerOpsDef b
</span><a href="Hasura.RQL.Types.EventTrigger.html#etcDefinition"><span class="hs-identifier hs-var">etcDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621687414746"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1530"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ErrorA QErr arr () ()
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1531"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ErrorA QErr arr () ()
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1532"></span><span>                  </span><span class="annot"><span class="annottext">ErrorA
  QErr arr (MetadataObject, SchemaObjId, Seq SchemaDependency) ()
forall (arr :: * -&gt; * -&gt; *).
ArrowWriter (Seq CollectItem) arr =&gt;
arr (MetadataObject, SchemaObjId, Seq SchemaDependency) ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordDependencies"><span class="hs-identifier hs-var">recordDependencies</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687414750"><span class="hs-identifier hs-var">metadataObject</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SchemaObjId
</span><a href="#local-6989586621687414751"><span class="hs-identifier hs-var">schemaObjectId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Seq SchemaDependency
</span><a href="#local-6989586621687414763"><span class="hs-identifier hs-var">dependencies</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1533"></span><span>                  </span><span class="annot"><span class="annottext">ErrorA QErr arr (EventTriggerInfo b) (EventTriggerInfo b)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">EventTriggerInfo b
</span><a href="#local-6989586621687414762"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-1534"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-1535"></span><span>            </span><span class="hs-glyph">|)</span><span>
</span><span id="line-1536"></span><span>            </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687414750"><span class="hs-identifier hs-var">metadataObject</span></a></span><span>
</span><span id="line-1537"></span><span>
</span><span id="line-1538"></span><span>        </span><span id="local-6989586621687414776"><span class="annot"><span class="annottext">recreateTriggerIfNeeded :: ErrorA
  QErr
  arr
  (CacheDynamicConfig, TableName b, [ColumnInfo b], TriggerName,
   TriggerOnReplication, TriggerOpsDef b, SourceConfig b,
   Maybe (PrimaryKey b (ColumnInfo b)))
  ()
</span><a href="#local-6989586621687414776"><span class="hs-identifier hs-var hs-var">recreateTriggerIfNeeded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1539"></span><span>          </span><span class="hs-comment">-- using `Inc.cache` here means that the response will be cached for the given output and the</span><span>
</span><span id="line-1540"></span><span>          </span><span class="hs-comment">-- next time this arrow recieves the same input, the cached response will be returned and the</span><span>
</span><span id="line-1541"></span><span>          </span><span class="hs-comment">-- computation will not be done again.</span><span>
</span><span id="line-1542"></span><span>          </span><span class="annot"><span class="annottext">ErrorA
  QErr
  arr
  (CacheDynamicConfig, TableName b, [ColumnInfo b], TriggerName,
   TriggerOnReplication, TriggerOpsDef b, SourceConfig b,
   Maybe (PrimaryKey b (ColumnInfo b)))
  ()
-&gt; ErrorA
     QErr
     arr
     (CacheDynamicConfig, TableName b, [ColumnInfo b], TriggerName,
      TriggerOnReplication, TriggerOpsDef b, SourceConfig b,
      Maybe (PrimaryKey b (ColumnInfo b)))
     ()
forall a b.
(Given Accesses =&gt; Eq a) =&gt;
ErrorA QErr arr a b -&gt; ErrorA QErr arr a b
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a b.
(ArrowCache m arr, Given Accesses =&gt; Eq a) =&gt;
arr a b -&gt; arr a b
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/incremental-1.0.0/opt/doc/html/incremental/src/Hasura.Incremental.Internal.Cache.html#cache"><span class="hs-identifier hs-var">Inc.cache</span></a></span><span>
</span><span id="line-1543"></span><span>            </span><span class="hs-keyword">proc</span><span>
</span><span id="line-1544"></span><span>              </span><span class="hs-special">(</span><span> </span><span id="local-6989586621687414779"><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687414779"><span class="hs-identifier hs-var">dynamicConfig</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1545"></span><span>                </span><span id="local-6989586621687414780"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621687414780"><span class="hs-identifier hs-var">tableName</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1546"></span><span>                </span><span id="local-6989586621687414781"><span class="annot"><span class="annottext">[ColumnInfo b]
</span><a href="#local-6989586621687414781"><span class="hs-identifier hs-var">tableColumns</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1547"></span><span>                </span><span id="local-6989586621687414782"><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687414782"><span class="hs-identifier hs-var">triggerName</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1548"></span><span>                </span><span id="local-6989586621687414783"><span class="annot"><span class="annottext">TriggerOnReplication
</span><a href="#local-6989586621687414783"><span class="hs-identifier hs-var">triggerOnReplication</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1549"></span><span>                </span><span id="local-6989586621687414784"><span class="annot"><span class="annottext">TriggerOpsDef b
</span><a href="#local-6989586621687414784"><span class="hs-identifier hs-var">triggerDefinition</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1550"></span><span>                </span><span id="local-6989586621687414785"><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687414785"><span class="hs-identifier hs-var">sourceConfig</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1551"></span><span>                </span><span id="local-6989586621687414786"><span class="annot"><span class="annottext">Maybe (PrimaryKey b (ColumnInfo b))
</span><a href="#local-6989586621687414786"><span class="hs-identifier hs-var">primaryKey</span></a></span></span><span>
</span><span id="line-1552"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-1553"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1554"></span><span>              </span><span class="annot"><span class="annottext">ErrorA QErr arr (ExceptT QErr m ()) ()
forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *) e a.
(ArrowChoice arr, ArrowKleisli m arr, ArrowError e arr) =&gt;
arr (ExceptT e m a) a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html#bindErrorA"><span class="hs-identifier hs-var">bindErrorA</span></a></span><span>
</span><span id="line-1555"></span><span>                </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1556"></span><span>                  </span><span class="annot"><span class="annottext">ExceptT QErr m (Either QErr ()) -&gt; ExceptT QErr m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#liftEitherM"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span>
</span><span id="line-1557"></span><span>                    </span><span class="annot"><span class="annottext">(ExceptT QErr m (Either QErr ()) -&gt; ExceptT QErr m ())
-&gt; ExceptT QErr m (Either QErr ()) -&gt; ExceptT QErr m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(BackendEventTrigger b, MonadBaseControl IO m, MonadIO m,
 MonadError QErr m) =&gt;
SQLGenCtx
-&gt; SourceConfig b
-&gt; TableName b
-&gt; [ColumnInfo b]
-&gt; TriggerName
-&gt; TriggerOnReplication
-&gt; TriggerOpsDef b
-&gt; Maybe (PrimaryKey b (ColumnInfo b))
-&gt; m (Either QErr ())
</span><a href="Hasura.Eventing.Backend.html#createTableEventTrigger"><span class="hs-identifier hs-var">createTableEventTrigger</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687410604"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-1558"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CacheDynamicConfig -&gt; SQLGenCtx
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#_cdcSQLGenCtx"><span class="hs-identifier hs-var">_cdcSQLGenCtx</span></a></span><span> </span><span class="annot"><span class="annottext">CacheDynamicConfig
</span><a href="#local-6989586621687414779"><span class="hs-identifier hs-var">dynamicConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1559"></span><span>                      </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621687414785"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span>
</span><span id="line-1560"></span><span>                      </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621687414780"><span class="hs-identifier hs-var">tableName</span></a></span><span>
</span><span id="line-1561"></span><span>                      </span><span class="annot"><span class="annottext">[ColumnInfo b]
</span><a href="#local-6989586621687414781"><span class="hs-identifier hs-var">tableColumns</span></a></span><span>
</span><span id="line-1562"></span><span>                      </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687414782"><span class="hs-identifier hs-var">triggerName</span></a></span><span>
</span><span id="line-1563"></span><span>                      </span><span class="annot"><span class="annottext">TriggerOnReplication
</span><a href="#local-6989586621687414783"><span class="hs-identifier hs-var">triggerOnReplication</span></a></span><span>
</span><span id="line-1564"></span><span>                      </span><span class="annot"><span class="annottext">TriggerOpsDef b
</span><a href="#local-6989586621687414784"><span class="hs-identifier hs-var">triggerDefinition</span></a></span><span>
</span><span id="line-1565"></span><span>                      </span><span class="annot"><span class="annottext">Maybe (PrimaryKey b (ColumnInfo b))
</span><a href="#local-6989586621687414786"><span class="hs-identifier hs-var">primaryKey</span></a></span><span>
</span><span id="line-1566"></span><span>
</span><span id="line-1567"></span><span>    </span><span id="local-6989586621687409989"><span class="annot"><a href="#local-6989586621687411877"><span class="hs-identifier hs-type">buildCronTriggers</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1568"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687409989"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1569"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#CronTriggerMetadata"><span class="hs-identifier hs-type">CronTriggerMetadata</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1570"></span><span>      </span><span class="annot"><a href="#local-6989586621687409989"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#TriggerName"><span class="hs-identifier hs-type">TriggerName</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#CronTriggerInfo"><span class="hs-identifier hs-type">CronTriggerInfo</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1571"></span><span>    </span><span id="local-6989586621687411877"><span class="annot"><span class="annottext">buildCronTriggers :: forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
[CronTriggerMetadata] -&gt; m (HashMap TriggerName CronTriggerInfo)
</span><a href="#local-6989586621687411877"><span class="hs-identifier hs-var hs-var">buildCronTriggers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CronTriggerMetadata -&gt; TriggerName)
-&gt; (CronTriggerMetadata -&gt; MetadataObject)
-&gt; (CronTriggerMetadata -&gt; m (Maybe CronTriggerInfo))
-&gt; [CronTriggerMetadata]
-&gt; m (HashMap TriggerName CronTriggerInfo)
forall (m :: * -&gt; *) k a b.
(MonadWriter (Seq CollectItem) m, Hashable k) =&gt;
(a -&gt; k)
-&gt; (a -&gt; MetadataObject)
-&gt; (a -&gt; m (Maybe b))
-&gt; [a]
-&gt; m (HashMap k b)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#buildInfoMapM"><span class="hs-identifier hs-var">buildInfoMapM</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata -&gt; TriggerName
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#ctName"><span class="hs-identifier hs-var">ctName</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata -&gt; MetadataObject
</span><a href="#local-6989586621687414595"><span class="hs-identifier hs-var">mkCronTriggerMetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata -&gt; m (Maybe CronTriggerInfo)
</span><a href="#local-6989586621687414799"><span class="hs-identifier hs-var">buildCronTrigger</span></a></span><span>
</span><span id="line-1572"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1573"></span><span>        </span><span id="local-6989586621687414799"><span class="annot"><span class="annottext">buildCronTrigger :: CronTriggerMetadata -&gt; m (Maybe CronTriggerInfo)
</span><a href="#local-6989586621687414799"><span class="hs-identifier hs-var hs-var">buildCronTrigger</span></a></span></span><span> </span><span id="local-6989586621687414800"><span class="annot"><span class="annottext">CronTriggerMetadata
</span><a href="#local-6989586621687414800"><span class="hs-identifier hs-var">cronTrigger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1574"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687414801"><span class="annot"><span class="annottext">triggerName :: Text
</span><a href="#local-6989586621687414801"><span class="hs-identifier hs-var hs-var">triggerName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; Text
</span><a href="Hasura.RQL.Types.EventTrigger.html#triggerNameToTxt"><span class="hs-identifier hs-var">triggerNameToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">(TriggerName -&gt; Text) -&gt; TriggerName -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata -&gt; TriggerName
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#ctName"><span class="hs-identifier hs-var">ctName</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata
</span><a href="#local-6989586621687414800"><span class="hs-identifier hs-var">cronTrigger</span></a></span><span>
</span><span id="line-1575"></span><span>              </span><span id="local-6989586621687414803"><span class="annot"><span class="annottext">addCronTriggerContext :: Text -&gt; Text
</span><a href="#local-6989586621687414803"><span class="hs-identifier hs-var hs-var">addCronTriggerContext</span></a></span></span><span> </span><span id="local-6989586621687414804"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687414804"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;in cron trigger &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687414801"><span class="hs-identifier hs-var">triggerName</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687414804"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1576"></span><span>          </span><span class="annot"><span class="annottext">MetadataObject
-&gt; ExceptT QErr m CronTriggerInfo -&gt; m (Maybe CronTriggerInfo)
forall (m :: * -&gt; *) a.
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CronTriggerMetadata -&gt; MetadataObject
</span><a href="#local-6989586621687414595"><span class="hs-identifier hs-var">mkCronTriggerMetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata
</span><a href="#local-6989586621687414800"><span class="hs-identifier hs-var">cronTrigger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1577"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT QErr m CronTriggerInfo -&gt; m (Maybe CronTriggerInfo))
-&gt; ExceptT QErr m CronTriggerInfo -&gt; m (Maybe CronTriggerInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text)
-&gt; ExceptT QErr m CronTriggerInfo -&gt; ExceptT QErr m CronTriggerInfo
forall (m :: * -&gt; *) a. QErrM m =&gt; (Text -&gt; Text) -&gt; m a -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#modifyErr"><span class="hs-identifier hs-var">modifyErr</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621687414803"><span class="hs-identifier hs-var">addCronTriggerContext</span></a></span><span>
</span><span id="line-1578"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT QErr m CronTriggerInfo -&gt; ExceptT QErr m CronTriggerInfo)
-&gt; ExceptT QErr m CronTriggerInfo -&gt; ExceptT QErr m CronTriggerInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Environment
-&gt; CronTriggerMetadata -&gt; ExceptT QErr m CronTriggerInfo
forall (m :: * -&gt; *).
QErrM m =&gt;
Environment -&gt; CronTriggerMetadata -&gt; m CronTriggerInfo
</span><a href="Hasura.RQL.DDL.ScheduledTrigger.html#resolveCronTrigger"><span class="hs-identifier hs-var">resolveCronTrigger</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621687411809"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata
</span><a href="#local-6989586621687414800"><span class="hs-identifier hs-var">cronTrigger</span></a></span><span>
</span><span id="line-1579"></span><span>
</span><span id="line-1580"></span><span>    </span><span id="local-6989586621687410526"><span class="annot"><a href="#local-6989586621687413240"><span class="hs-identifier hs-type">buildInheritedRoles</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1581"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687410526"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1582"></span><span>      </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashSet.Internal.html#HashSet"><span class="hs-identifier hs-type">HashSet</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Roles.html#RoleName"><span class="hs-identifier hs-type">RoleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1583"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Roles.html#InheritedRole"><span class="hs-identifier hs-type">InheritedRole</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1584"></span><span>      </span><span class="annot"><a href="#local-6989586621687410526"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Roles.html#RoleName"><span class="hs-identifier hs-type">RoleName</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Roles.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1585"></span><span>    </span><span id="local-6989586621687413240"><span class="annot"><span class="annottext">buildInheritedRoles :: forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
HashSet RoleName -&gt; [Role] -&gt; m (HashMap RoleName Role)
</span><a href="#local-6989586621687413240"><span class="hs-identifier hs-var hs-var">buildInheritedRoles</span></a></span></span><span> </span><span id="local-6989586621687414825"><span class="annot"><span class="annottext">HashSet RoleName
</span><a href="#local-6989586621687414825"><span class="hs-identifier hs-var">allRoles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Role -&gt; RoleName)
-&gt; (Role -&gt; MetadataObject)
-&gt; (Role -&gt; m (Maybe Role))
-&gt; [Role]
-&gt; m (HashMap RoleName Role)
forall (m :: * -&gt; *) k a b.
(MonadWriter (Seq CollectItem) m, Hashable k) =&gt;
(a -&gt; k)
-&gt; (a -&gt; MetadataObject)
-&gt; (a -&gt; m (Maybe b))
-&gt; [a]
-&gt; m (HashMap k b)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#buildInfoMapM"><span class="hs-identifier hs-var">buildInfoMapM</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; RoleName
</span><a href="Hasura.RQL.Types.Roles.html#_rRoleName"><span class="hs-identifier hs-var">_rRoleName</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; MetadataObject
</span><a href="#local-6989586621687414610"><span class="hs-identifier hs-var">mkInheritedRoleMetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; m (Maybe Role)
</span><a href="#local-6989586621687414826"><span class="hs-identifier hs-var">buildInheritedRole</span></a></span><span>
</span><span id="line-1586"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1587"></span><span>        </span><span id="local-6989586621687414826"><span class="annot"><span class="annottext">buildInheritedRole :: Role -&gt; m (Maybe Role)
</span><a href="#local-6989586621687414826"><span class="hs-identifier hs-var hs-var">buildInheritedRole</span></a></span></span><span> </span><span id="local-6989586621687414827"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621687414827"><span class="hs-identifier hs-var">inheritedRole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1588"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687414828"><span class="annot"><span class="annottext">addInheritedRoleContext :: Text -&gt; Text
</span><a href="#local-6989586621687414828"><span class="hs-identifier hs-var hs-var">addInheritedRoleContext</span></a></span></span><span> </span><span id="local-6989586621687414829"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687414829"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;in inherited role &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">RoleName -&gt; Text
</span><a href="Hasura.RQL.Types.Roles.html#roleNameToTxt"><span class="hs-identifier hs-var">roleNameToTxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; RoleName
</span><a href="Hasura.RQL.Types.Roles.html#_rRoleName"><span class="hs-identifier hs-var">_rRoleName</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621687414827"><span class="hs-identifier hs-var">inheritedRole</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687414829"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1589"></span><span>              </span><span id="local-6989586621687414831"><span class="annot"><span class="annottext">metadataObject :: MetadataObject
</span><a href="#local-6989586621687414831"><span class="hs-identifier hs-var hs-var">metadataObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; MetadataObject
</span><a href="#local-6989586621687414610"><span class="hs-identifier hs-var">mkInheritedRoleMetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621687414827"><span class="hs-identifier hs-var">inheritedRole</span></a></span><span>
</span><span id="line-1590"></span><span>              </span><span id="local-6989586621687414832"><span class="annot"><span class="annottext">schemaObject :: SchemaObjId
</span><a href="#local-6989586621687414832"><span class="hs-identifier hs-var hs-var">schemaObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RoleName -&gt; SchemaObjId
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SORole"><span class="hs-identifier hs-var">SORole</span></a></span><span> </span><span class="annot"><span class="annottext">(RoleName -&gt; SchemaObjId) -&gt; RoleName -&gt; SchemaObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Role -&gt; RoleName
</span><a href="Hasura.RQL.Types.Roles.html#_rRoleName"><span class="hs-identifier hs-var">_rRoleName</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621687414827"><span class="hs-identifier hs-var">inheritedRole</span></a></span><span>
</span><span id="line-1591"></span><span>          </span><span class="annot"><span class="annottext">MetadataObject -&gt; ExceptT QErr m Role -&gt; m (Maybe Role)
forall (m :: * -&gt; *) a.
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687414831"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT QErr m Role -&gt; m (Maybe Role))
-&gt; ExceptT QErr m Role -&gt; m (Maybe Role)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; ExceptT QErr m Role -&gt; ExceptT QErr m Role
forall (m :: * -&gt; *) a. QErrM m =&gt; (Text -&gt; Text) -&gt; m a -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#modifyErr"><span class="hs-identifier hs-var">modifyErr</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621687414828"><span class="hs-identifier hs-var">addInheritedRoleContext</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1592"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621687414834"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621687414834"><span class="hs-identifier hs-var">resolvedInheritedRole</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414835"><span class="annot"><span class="annottext">Seq SchemaDependency
</span><a href="#local-6989586621687414835"><span class="hs-identifier hs-var">dependencies</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashSet RoleName
-&gt; Role -&gt; ExceptT QErr m (Role, Seq SchemaDependency)
forall (m :: * -&gt; *).
MonadError QErr m =&gt;
HashSet RoleName -&gt; Role -&gt; m (Role, Seq SchemaDependency)
</span><a href="Hasura.RQL.DDL.InheritedRoles.html#resolveInheritedRole"><span class="hs-identifier hs-var">resolveInheritedRole</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet RoleName
</span><a href="#local-6989586621687414825"><span class="hs-identifier hs-var">allRoles</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621687414827"><span class="hs-identifier hs-var">inheritedRole</span></a></span><span>
</span><span id="line-1593"></span><span>            </span><span class="annot"><span class="annottext">MetadataObject
-&gt; SchemaObjId -&gt; Seq SchemaDependency -&gt; ExceptT QErr m ()
forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; SchemaObjId -&gt; Seq SchemaDependency -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordDependenciesM"><span class="hs-identifier hs-var">recordDependenciesM</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687414831"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaObjId
</span><a href="#local-6989586621687414832"><span class="hs-identifier hs-var">schemaObject</span></a></span><span> </span><span class="annot"><span class="annottext">Seq SchemaDependency
</span><a href="#local-6989586621687414835"><span class="hs-identifier hs-var">dependencies</span></a></span><span>
</span><span id="line-1594"></span><span>            </span><span class="annot"><span class="annottext">Role -&gt; ExceptT QErr m Role
forall a. a -&gt; ExceptT QErr m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621687414834"><span class="hs-identifier hs-var">resolvedInheritedRole</span></a></span><span>
</span><span id="line-1595"></span><span>
</span><span id="line-1596"></span><span>    </span><span id="local-6989586621687410625"><span class="annot"><a href="#local-6989586621687414393"><span class="hs-identifier hs-type">buildActions</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1597"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687410625"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1598"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.CustomTypes.html#AnnotatedCustomTypes"><span class="hs-identifier hs-type">AnnotatedCustomTypes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1599"></span><span>      </span><span class="annot"><a href="Hasura.SQL.BackendMap.html#BackendMap"><span class="hs-identifier hs-type">BackendMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.CustomTypes.html#ScalarParsingMap"><span class="hs-identifier hs-type">ScalarParsingMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1600"></span><span>      </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Permission.html#OrderedRoles"><span class="hs-identifier hs-type">OrderedRoles</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1601"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Action.html#ActionMetadata"><span class="hs-identifier hs-type">ActionMetadata</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1602"></span><span>      </span><span class="annot"><a href="#local-6989586621687410625"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Action.html#ActionName"><span class="hs-identifier hs-type">ActionName</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Action.html#ActionInfo"><span class="hs-identifier hs-type">ActionInfo</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1603"></span><span>    </span><span id="local-6989586621687414393"><span class="annot"><span class="annottext">buildActions :: forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
AnnotatedCustomTypes
-&gt; BackendMap ScalarParsingMap
-&gt; OrderedRoles
-&gt; [ActionMetadata]
-&gt; m ActionCache
</span><a href="#local-6989586621687414393"><span class="hs-identifier hs-var hs-var">buildActions</span></a></span></span><span> </span><span id="local-6989586621687414852"><span class="annot"><span class="annottext">AnnotatedCustomTypes
</span><a href="#local-6989586621687414852"><span class="hs-identifier hs-var">resolvedCustomTypes</span></a></span></span><span> </span><span id="local-6989586621687414853"><span class="annot"><span class="annottext">BackendMap ScalarParsingMap
</span><a href="#local-6989586621687414853"><span class="hs-identifier hs-var">scalarsMap</span></a></span></span><span> </span><span id="local-6989586621687414854"><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621687414854"><span class="hs-identifier hs-var">orderedRoles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ActionMetadata -&gt; ActionName)
-&gt; (ActionMetadata -&gt; MetadataObject)
-&gt; (ActionMetadata -&gt; m (Maybe ActionInfo))
-&gt; [ActionMetadata]
-&gt; m ActionCache
forall (m :: * -&gt; *) k a b.
(MonadWriter (Seq CollectItem) m, Hashable k) =&gt;
(a -&gt; k)
-&gt; (a -&gt; MetadataObject)
-&gt; (a -&gt; m (Maybe b))
-&gt; [a]
-&gt; m (HashMap k b)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#buildInfoMapM"><span class="hs-identifier hs-var">buildInfoMapM</span></a></span><span> </span><span class="annot"><span class="annottext">ActionMetadata -&gt; ActionName
</span><a href="Hasura.RQL.Types.Action.html#_amName"><span class="hs-identifier hs-var">_amName</span></a></span><span> </span><span class="annot"><span class="annottext">ActionMetadata -&gt; MetadataObject
</span><a href="#local-6989586621687414395"><span class="hs-identifier hs-var">mkActionMetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">ActionMetadata -&gt; m (Maybe ActionInfo)
</span><a href="#local-6989586621687414856"><span class="hs-identifier hs-var">buildAction</span></a></span><span>
</span><span id="line-1604"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1605"></span><span>        </span><span id="local-6989586621687414856"><span class="annot"><span class="annottext">buildAction :: ActionMetadata -&gt; m (Maybe ActionInfo)
</span><a href="#local-6989586621687414856"><span class="hs-identifier hs-var hs-var">buildAction</span></a></span></span><span> </span><span id="local-6989586621687414857"><span class="annot"><span class="annottext">action :: ActionMetadata
</span><a href="#local-6989586621687414857"><span class="hs-identifier hs-var">action</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Action.html#ActionMetadata"><span class="hs-identifier hs-type">ActionMetadata</span></a></span><span> </span><span id="local-6989586621687414858"><span class="annot"><span class="annottext">ActionName
</span><a href="#local-6989586621687414858"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621687414859"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687414859"><span class="hs-identifier hs-var">comment</span></a></span></span><span> </span><span id="local-6989586621687414860"><span class="annot"><span class="annottext">ActionDefinitionInput
</span><a href="#local-6989586621687414860"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span id="local-6989586621687414861"><span class="annot"><span class="annottext">[ActionPermissionMetadata]
</span><a href="#local-6989586621687414861"><span class="hs-identifier hs-var">actionPermissions</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1606"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687414862"><span class="annot"><span class="annottext">addActionContext :: Text -&gt; Text
</span><a href="#local-6989586621687414862"><span class="hs-identifier hs-var hs-var">addActionContext</span></a></span></span><span> </span><span id="local-6989586621687414863"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687414863"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;in action &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ActionName
</span><a href="#local-6989586621687414858"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">ActionName -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687414863"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1607"></span><span>              </span><span id="local-6989586621687414864"><span class="annot"><span class="annottext">permissionInfos :: [ActionPermissionInfo]
</span><a href="#local-6989586621687414864"><span class="hs-identifier hs-var hs-var">permissionInfos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ActionPermissionMetadata -&gt; ActionPermissionInfo)
-&gt; [ActionPermissionMetadata] -&gt; [ActionPermissionInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RoleName -&gt; ActionPermissionInfo
</span><a href="Hasura.RQL.Types.Action.html#ActionPermissionInfo"><span class="hs-identifier hs-var">ActionPermissionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(RoleName -&gt; ActionPermissionInfo)
-&gt; (ActionPermissionMetadata -&gt; RoleName)
-&gt; ActionPermissionMetadata
-&gt; ActionPermissionInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ActionPermissionMetadata -&gt; RoleName
</span><a href="Hasura.RQL.Types.Action.html#_apmRole"><span class="hs-identifier hs-var">_apmRole</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ActionPermissionMetadata]
</span><a href="#local-6989586621687414861"><span class="hs-identifier hs-var">actionPermissions</span></a></span><span>
</span><span id="line-1608"></span><span>              </span><span id="local-6989586621687414866"><span class="annot"><span class="annottext">metadataPermissionMap :: HashMap RoleName ActionPermissionInfo
</span><a href="#local-6989586621687414866"><span class="hs-identifier hs-var hs-var">metadataPermissionMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ActionPermissionInfo -&gt; RoleName)
-&gt; [ActionPermissionInfo] -&gt; HashMap RoleName ActionPermissionInfo
forall k a. Hashable k =&gt; (a -&gt; k) -&gt; [a] -&gt; HashMap k a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#mapFromL"><span class="hs-identifier hs-var">mapFromL</span></a></span><span> </span><span class="annot"><span class="annottext">ActionPermissionInfo -&gt; RoleName
</span><a href="Hasura.RQL.Types.Action.html#_apiRole"><span class="hs-identifier hs-var">_apiRole</span></a></span><span> </span><span class="annot"><span class="annottext">[ActionPermissionInfo]
</span><a href="#local-6989586621687414864"><span class="hs-identifier hs-var">permissionInfos</span></a></span><span>
</span><span id="line-1609"></span><span>              </span><span id="local-6989586621687414868"><span class="annot"><span class="annottext">permissionsMap :: HashMap RoleName ActionPermissionInfo
</span><a href="#local-6989586621687414868"><span class="hs-identifier hs-var hs-var">permissionsMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RoleName -&gt; ActionPermissionInfo)
-&gt; HashMap RoleName ActionPermissionInfo
-&gt; OrderedRoles
-&gt; HashMap RoleName ActionPermissionInfo
forall a.
(RoleName -&gt; a)
-&gt; HashMap RoleName a -&gt; OrderedRoles -&gt; HashMap RoleName a
</span><a href="Hasura.RQL.DDL.Schema.Cache.Permission.html#mkBooleanPermissionMap"><span class="hs-identifier hs-var">mkBooleanPermissionMap</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName -&gt; ActionPermissionInfo
</span><a href="Hasura.RQL.Types.Action.html#ActionPermissionInfo"><span class="hs-identifier hs-var">ActionPermissionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap RoleName ActionPermissionInfo
</span><a href="#local-6989586621687414866"><span class="hs-identifier hs-var">metadataPermissionMap</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621687414854"><span class="hs-identifier hs-var">orderedRoles</span></a></span><span>
</span><span id="line-1610"></span><span>              </span><span id="local-6989586621687414869"><span class="annot"><span class="annottext">outputType :: GType
</span><a href="#local-6989586621687414869"><span class="hs-identifier hs-var hs-var">outputType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GraphQLType -&gt; GType
</span><a href="Hasura.Table.Cache.html#unGraphQLType"><span class="hs-identifier hs-var">unGraphQLType</span></a></span><span> </span><span class="annot"><span class="annottext">(GraphQLType -&gt; GType) -&gt; GraphQLType -&gt; GType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ActionDefinitionInput -&gt; GraphQLType
forall arg webhook. ActionDefinition arg webhook -&gt; GraphQLType
</span><a href="Hasura.RQL.Types.Action.html#_adOutputType"><span class="hs-identifier hs-var">_adOutputType</span></a></span><span> </span><span class="annot"><span class="annottext">ActionDefinitionInput
</span><a href="#local-6989586621687414860"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-1611"></span><span>          </span><span class="annot"><span class="annottext">MetadataObject -&gt; ExceptT QErr m ActionInfo -&gt; m (Maybe ActionInfo)
forall (m :: * -&gt; *) a.
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActionMetadata -&gt; MetadataObject
</span><a href="#local-6989586621687414395"><span class="hs-identifier hs-var">mkActionMetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">ActionMetadata
</span><a href="#local-6989586621687414857"><span class="hs-identifier hs-var">action</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT QErr m ActionInfo -&gt; m (Maybe ActionInfo))
-&gt; ExceptT QErr m ActionInfo -&gt; m (Maybe ActionInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text)
-&gt; ExceptT QErr m ActionInfo -&gt; ExceptT QErr m ActionInfo
forall (m :: * -&gt; *) a. QErrM m =&gt; (Text -&gt; Text) -&gt; m a -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#modifyErr"><span class="hs-identifier hs-var">modifyErr</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621687414862"><span class="hs-identifier hs-var">addActionContext</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1612"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621687414872"><span class="annot"><span class="annottext">ResolvedActionDefinition
</span><a href="#local-6989586621687414872"><span class="hs-identifier hs-var">resolvedDef</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414873"><span class="annot"><span class="annottext">AnnotatedOutputType
</span><a href="#local-6989586621687414873"><span class="hs-identifier hs-var">outObject</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Environment
-&gt; AnnotatedCustomTypes
-&gt; ActionDefinitionInput
-&gt; BackendMap ScalarParsingMap
-&gt; ExceptT QErr m (ResolvedActionDefinition, AnnotatedOutputType)
forall (m :: * -&gt; *).
QErrM m =&gt;
Environment
-&gt; AnnotatedCustomTypes
-&gt; ActionDefinitionInput
-&gt; BackendMap ScalarParsingMap
-&gt; m (ResolvedActionDefinition, AnnotatedOutputType)
</span><a href="Hasura.RQL.DDL.Action.html#resolveAction"><span class="hs-identifier hs-var">resolveAction</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621687411809"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedCustomTypes
</span><a href="#local-6989586621687414852"><span class="hs-identifier hs-var">resolvedCustomTypes</span></a></span><span> </span><span class="annot"><span class="annottext">ActionDefinitionInput
</span><a href="#local-6989586621687414860"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">BackendMap ScalarParsingMap
</span><a href="#local-6989586621687414853"><span class="hs-identifier hs-var">scalarsMap</span></a></span><span>
</span><span id="line-1613"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687414875"><span class="annot"><span class="annottext">forwardClientHeaders :: Bool
</span><a href="#local-6989586621687414875"><span class="hs-identifier hs-var hs-var">forwardClientHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResolvedActionDefinition -&gt; Bool
forall arg webhook. ActionDefinition arg webhook -&gt; Bool
</span><a href="Hasura.RQL.Types.Action.html#_adForwardClientHeaders"><span class="hs-identifier hs-var">_adForwardClientHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">ResolvedActionDefinition
</span><a href="#local-6989586621687414872"><span class="hs-identifier hs-var">resolvedDef</span></a></span><span>
</span><span id="line-1614"></span><span>            </span><span class="annot"><span class="annottext">ActionInfo -&gt; ExceptT QErr m ActionInfo
forall a. a -&gt; ExceptT QErr m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ActionInfo -&gt; ExceptT QErr m ActionInfo)
-&gt; ActionInfo -&gt; ExceptT QErr m ActionInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ActionName
-&gt; (GType, AnnotatedOutputType)
-&gt; ResolvedActionDefinition
-&gt; HashMap RoleName ActionPermissionInfo
-&gt; Bool
-&gt; Maybe Text
-&gt; ActionInfo
</span><a href="Hasura.RQL.Types.Action.html#ActionInfo"><span class="hs-identifier hs-var">ActionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ActionName
</span><a href="#local-6989586621687414858"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GType
</span><a href="#local-6989586621687414869"><span class="hs-identifier hs-var">outputType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnotatedOutputType
</span><a href="#local-6989586621687414873"><span class="hs-identifier hs-var">outObject</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ResolvedActionDefinition
</span><a href="#local-6989586621687414872"><span class="hs-identifier hs-var">resolvedDef</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap RoleName ActionPermissionInfo
</span><a href="#local-6989586621687414868"><span class="hs-identifier hs-var">permissionsMap</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687414875"><span class="hs-identifier hs-var">forwardClientHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687414859"><span class="hs-identifier hs-var">comment</span></a></span><span>
</span><span id="line-1615"></span><span>
</span><span id="line-1616"></span><span id="local-6989586621687410622"><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#buildRemoteSchemaRemoteRelationship"><span class="hs-identifier hs-type">buildRemoteSchemaRemoteRelationship</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1617"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687410622"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1618"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.SQL.AnyBackend.html#AnyBackend"><span class="hs-identifier hs-type">AB.AnyBackend</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.RemoteRelationship.html#PartiallyResolvedSource"><span class="hs-identifier hs-type">PartiallyResolvedSource</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1619"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#PartiallyResolvedRemoteSchemaMap"><span class="hs-identifier hs-type">PartiallyResolvedRemoteSchemaMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1620"></span><span>  </span><span class="annot"><a href="Hasura.RemoteSchema.Metadata.Base.html#RemoteSchemaName"><span class="hs-identifier hs-type">RemoteSchemaName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1621"></span><span>  </span><span class="annot"><a href="Hasura.RemoteSchema.SchemaCache.Types.html#RemoteSchemaIntrospection"><span class="hs-identifier hs-type">RemoteSchemaIntrospection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1622"></span><span>  </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src/Language.GraphQL.Draft.Syntax.Name.html#Name"><span class="hs-identifier hs-type">G.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1623"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Relationships.Remote.html#RemoteRelationship"><span class="hs-identifier hs-type">RemoteRelationship</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1624"></span><span>  </span><span class="annot"><a href="#local-6989586621687410622"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Relationships.Remote.html#RemoteFieldInfo"><span class="hs-identifier hs-type">RemoteFieldInfo</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src/Language.GraphQL.Draft.Syntax.Name.html#Name"><span class="hs-identifier hs-type">G.Name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-1625"></span><span id="buildRemoteSchemaRemoteRelationship"><span class="annot"><span class="annottext">buildRemoteSchemaRemoteRelationship :: forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
HashMap SourceName (AnyBackend PartiallyResolvedSource)
-&gt; PartiallyResolvedRemoteSchemaMap
-&gt; RemoteSchemaName
-&gt; RemoteSchemaIntrospection
-&gt; Name
-&gt; RemoteRelationshipG RemoteRelationshipDefinition
-&gt; m (Maybe (RemoteFieldInfo Name))
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildRemoteSchemaRemoteRelationship"><span class="hs-identifier hs-var hs-var">buildRemoteSchemaRemoteRelationship</span></a></span></span><span> </span><span id="local-6989586621687414899"><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend PartiallyResolvedSource)
</span><a href="#local-6989586621687414899"><span class="hs-identifier hs-var">allSources</span></a></span></span><span> </span><span id="local-6989586621687414900"><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaMap
</span><a href="#local-6989586621687414900"><span class="hs-identifier hs-var">remoteSchemaMap</span></a></span></span><span> </span><span id="local-6989586621687414901"><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621687414901"><span class="hs-identifier hs-var">remoteSchema</span></a></span></span><span> </span><span id="local-6989586621687414902"><span class="annot"><span class="annottext">RemoteSchemaIntrospection
</span><a href="#local-6989586621687414902"><span class="hs-identifier hs-var">remoteSchemaIntrospection</span></a></span></span><span> </span><span id="local-6989586621687414903"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621687414903"><span class="hs-identifier hs-var">typeName</span></a></span></span><span> </span><span id="local-6989586621687414904"><span class="annot"><span class="annottext">rr :: RemoteRelationshipG RemoteRelationshipDefinition
</span><a href="#local-6989586621687414904"><span class="hs-identifier hs-var">rr</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#RemoteRelationship"><span class="hs-identifier hs-type">RemoteRelationship</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687414906"><span id="local-6989586621687414907"><span class="annot"><span class="annottext">RelName
RemoteRelationshipDefinition
_rrName :: RelName
_rrDefinition :: RemoteRelationshipDefinition
_rrName :: forall definition. RemoteRelationshipG definition -&gt; RelName
_rrDefinition :: forall definition. RemoteRelationshipG definition -&gt; definition
</span><a href="#local-6989586621687414906"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1626"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687414910"><span class="annot"><span class="annottext">metadataObject :: MetadataObject
</span><a href="#local-6989586621687414910"><span class="hs-identifier hs-var hs-var">metadataObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1627"></span><span>        </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteSchemaName -&gt; Name -&gt; RelName -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MORemoteSchemaRemoteRelationship"><span class="hs-identifier hs-var">MORemoteSchemaRemoteRelationship</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621687414901"><span class="hs-identifier hs-var">remoteSchema</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621687414903"><span class="hs-identifier hs-var">typeName</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621687414906"><span class="hs-identifier hs-var">_rrName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1628"></span><span>          </span><span class="annot"><span class="annottext">(Value -&gt; MetadataObject) -&gt; Value -&gt; MetadataObject
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CreateRemoteSchemaRemoteRelationship -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span>
</span><span id="line-1629"></span><span>          </span><span class="annot"><span class="annottext">(CreateRemoteSchemaRemoteRelationship -&gt; Value)
-&gt; CreateRemoteSchemaRemoteRelationship -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
-&gt; Name
-&gt; RelName
-&gt; RemoteRelationshipDefinition
-&gt; CreateRemoteSchemaRemoteRelationship
</span><a href="Hasura.RQL.DDL.RemoteRelationship.html#CreateRemoteSchemaRemoteRelationship"><span class="hs-identifier hs-var">CreateRemoteSchemaRemoteRelationship</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621687414901"><span class="hs-identifier hs-var">remoteSchema</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621687414903"><span class="hs-identifier hs-var">typeName</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621687414906"><span class="hs-identifier hs-var">_rrName</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRelationshipDefinition
</span><a href="#local-6989586621687414907"><span class="hs-identifier hs-var">_rrDefinition</span></a></span><span>
</span><span id="line-1630"></span><span>      </span><span id="local-6989586621687414913"><span class="annot"><span class="annottext">schemaObj :: SchemaObjId
</span><a href="#local-6989586621687414913"><span class="hs-identifier hs-var hs-var">schemaObj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName -&gt; Name -&gt; RelName -&gt; SchemaObjId
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SORemoteSchemaRemoteRelationship"><span class="hs-identifier hs-var">SORemoteSchemaRemoteRelationship</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621687414901"><span class="hs-identifier hs-var">remoteSchema</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621687414903"><span class="hs-identifier hs-var">typeName</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621687414906"><span class="hs-identifier hs-var">_rrName</span></a></span><span>
</span><span id="line-1631"></span><span>      </span><span id="local-6989586621687414915"><span class="annot"><span class="annottext">addRemoteRelationshipContext :: Text -&gt; Text
</span><a href="#local-6989586621687414915"><span class="hs-identifier hs-var hs-var">addRemoteRelationshipContext</span></a></span></span><span> </span><span id="local-6989586621687414916"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687414916"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;in remote relationship &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621687414906"><span class="hs-identifier hs-var">_rrName</span></a></span><span> </span><span class="annot"><span class="annottext">RelName -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687414916"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1632"></span><span>      </span><span class="hs-comment">-- buildRemoteFieldInfo only knows how to construct dependencies on the RHS of the join condition,</span><span>
</span><span id="line-1633"></span><span>      </span><span class="hs-comment">-- so the dependencies on the remote relationship on the LHS entity have to be computed here</span><span>
</span><span id="line-1634"></span><span>      </span><span id="local-6989586621687414917"><span class="annot"><span class="annottext">lhsDependency :: SchemaDependency
</span><a href="#local-6989586621687414917"><span class="hs-identifier hs-var hs-var">lhsDependency</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1635"></span><span>        </span><span class="hs-comment">-- a direct dependency on the remote schema on which this is defined</span><span>
</span><span id="line-1636"></span><span>        </span><span class="annot"><span class="annottext">SchemaObjId -&gt; DependencyReason -&gt; SchemaDependency
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SchemaDependency"><span class="hs-identifier hs-var">SchemaDependency</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteSchemaName -&gt; SchemaObjId
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SORemoteSchema"><span class="hs-identifier hs-var">SORemoteSchema</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621687414901"><span class="hs-identifier hs-var">remoteSchema</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DependencyReason
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#DRRemoteRelationship"><span class="hs-identifier hs-var">DRRemoteRelationship</span></a></span><span>
</span><span id="line-1637"></span><span>  </span><span class="annot"><span class="annottext">MetadataObject
-&gt; ExceptT QErr m (RemoteFieldInfo Name)
-&gt; m (Maybe (RemoteFieldInfo Name))
forall (m :: * -&gt; *) a.
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687414910"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT QErr m (RemoteFieldInfo Name)
 -&gt; m (Maybe (RemoteFieldInfo Name)))
-&gt; ExceptT QErr m (RemoteFieldInfo Name)
-&gt; m (Maybe (RemoteFieldInfo Name))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text)
-&gt; ExceptT QErr m (RemoteFieldInfo Name)
-&gt; ExceptT QErr m (RemoteFieldInfo Name)
forall (m :: * -&gt; *) a. QErrM m =&gt; (Text -&gt; Text) -&gt; m a -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#modifyErr"><span class="hs-identifier hs-var">modifyErr</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621687414915"><span class="hs-identifier hs-var">addRemoteRelationshipContext</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1638"></span><span>    </span><span id="local-6989586621687414920"><span class="annot"><span class="annottext">HashMap FieldName Name
</span><a href="#local-6989586621687414920"><span class="hs-identifier hs-var">allowedLHSJoinFields</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
-&gt; RemoteSchemaIntrospection
-&gt; Name
-&gt; ExceptT QErr m (HashMap FieldName Name)
forall (m :: * -&gt; *).
MonadError QErr m =&gt;
RemoteSchemaName
-&gt; RemoteSchemaIntrospection -&gt; Name -&gt; m (HashMap FieldName Name)
</span><a href="Hasura.RQL.DDL.RemoteRelationship.html#getRemoteSchemaEntityJoinColumns"><span class="hs-identifier hs-var">getRemoteSchemaEntityJoinColumns</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621687414901"><span class="hs-identifier hs-var">remoteSchema</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaIntrospection
</span><a href="#local-6989586621687414902"><span class="hs-identifier hs-var">remoteSchemaIntrospection</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621687414903"><span class="hs-identifier hs-var">typeName</span></a></span><span>
</span><span id="line-1639"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621687414921"><span class="annot"><span class="annottext">RemoteFieldInfo Name
</span><a href="#local-6989586621687414921"><span class="hs-identifier hs-var">remoteField</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687414922"><span class="annot"><span class="annottext">Seq SchemaDependency
</span><a href="#local-6989586621687414922"><span class="hs-identifier hs-var">rhsDependencies</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1640"></span><span>      </span><span class="annot"><span class="annottext">LHSIdentifier
-&gt; HashMap FieldName Name
-&gt; RemoteRelationshipG RemoteRelationshipDefinition
-&gt; HashMap SourceName (AnyBackend PartiallyResolvedSource)
-&gt; PartiallyResolvedRemoteSchemaMap
-&gt; ExceptT QErr m (RemoteFieldInfo Name, Seq SchemaDependency)
forall (m :: * -&gt; *) lhsJoinField.
QErrM m =&gt;
LHSIdentifier
-&gt; HashMap FieldName lhsJoinField
-&gt; RemoteRelationshipG RemoteRelationshipDefinition
-&gt; HashMap SourceName (AnyBackend PartiallyResolvedSource)
-&gt; PartiallyResolvedRemoteSchemaMap
-&gt; m (RemoteFieldInfo lhsJoinField, Seq SchemaDependency)
</span><a href="Hasura.RQL.DDL.RemoteRelationship.html#buildRemoteFieldInfo"><span class="hs-identifier hs-var">buildRemoteFieldInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteSchemaName -&gt; LHSIdentifier
</span><a href="Hasura.RemoteSchema.SchemaCache.Types.html#remoteSchemaToLHSIdentifier"><span class="hs-identifier hs-var">remoteSchemaToLHSIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621687414901"><span class="hs-identifier hs-var">remoteSchema</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap FieldName Name
</span><a href="#local-6989586621687414920"><span class="hs-identifier hs-var">allowedLHSJoinFields</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRelationshipG RemoteRelationshipDefinition
</span><a href="#local-6989586621687414904"><span class="hs-identifier hs-var">rr</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend PartiallyResolvedSource)
</span><a href="#local-6989586621687414899"><span class="hs-identifier hs-var">allSources</span></a></span><span> </span><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaMap
</span><a href="#local-6989586621687414900"><span class="hs-identifier hs-var">remoteSchemaMap</span></a></span><span>
</span><span id="line-1641"></span><span>    </span><span class="annot"><span class="annottext">MetadataObject
-&gt; SchemaObjId -&gt; Seq SchemaDependency -&gt; ExceptT QErr m ()
forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; SchemaObjId -&gt; Seq SchemaDependency -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordDependenciesM"><span class="hs-identifier hs-var">recordDependenciesM</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687414910"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaObjId
</span><a href="#local-6989586621687414913"><span class="hs-identifier hs-var">schemaObj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaDependency
</span><a href="#local-6989586621687414917"><span class="hs-identifier hs-var">lhsDependency</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaDependency -&gt; Seq SchemaDependency -&gt; Seq SchemaDependency
forall a. a -&gt; Seq a -&gt; Seq a
</span><span class="hs-operator hs-var">Seq.:&lt;|</span></span><span> </span><span class="annot"><span class="annottext">Seq SchemaDependency
</span><a href="#local-6989586621687414922"><span class="hs-identifier hs-var">rhsDependencies</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1642"></span><span>    </span><span class="annot"><span class="annottext">RemoteFieldInfo Name -&gt; ExceptT QErr m (RemoteFieldInfo Name)
forall a. a -&gt; ExceptT QErr m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">RemoteFieldInfo Name
</span><a href="#local-6989586621687414921"><span class="hs-identifier hs-var">remoteField</span></a></span><span>
</span><span id="line-1643"></span><span>
</span><span id="line-1644"></span><span class="hs-keyword">data</span><span> </span><span id="BackendInfoAndSourceMetadata"><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#BackendInfoAndSourceMetadata"><span class="hs-identifier hs-var">BackendInfoAndSourceMetadata</span></a></span></span><span> </span><span id="local-6989586621687410185"><span class="annot"><a href="#local-6989586621687410185"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BackendInfoAndSourceMetadata"><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#BackendInfoAndSourceMetadata"><span class="hs-identifier hs-var">BackendInfoAndSourceMetadata</span></a></span></span><span>
</span><span id="line-1645"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_bcasmBackendInfo"><span class="annot"><span class="annottext">forall (b :: BackendType).
BackendInfoAndSourceMetadata b -&gt; BackendInfo b
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#_bcasmBackendInfo"><span class="hs-identifier hs-var hs-var">_bcasmBackendInfo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#BackendInfo"><span class="hs-identifier hs-type">BackendInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410185"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1646"></span><span>    </span><span id="_bcasmSourceMetadata"><span class="annot"><span class="annottext">forall (b :: BackendType).
BackendInfoAndSourceMetadata b -&gt; SourceMetadata b
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#_bcasmSourceMetadata"><span class="hs-identifier hs-var hs-var">_bcasmSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SourceMetadata"><span class="hs-identifier hs-type">SourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410185"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-1647"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-1648"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687414926"><span id="local-6989586621687414928"><span class="annot"><span class="annottext">(forall x.
 BackendInfoAndSourceMetadata b
 -&gt; Rep (BackendInfoAndSourceMetadata b) x)
-&gt; (forall x.
    Rep (BackendInfoAndSourceMetadata b) x
    -&gt; BackendInfoAndSourceMetadata b)
-&gt; Generic (BackendInfoAndSourceMetadata b)
forall x.
Rep (BackendInfoAndSourceMetadata b) x
-&gt; BackendInfoAndSourceMetadata b
forall x.
BackendInfoAndSourceMetadata b
-&gt; Rep (BackendInfoAndSourceMetadata b) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall (b :: BackendType) x.
Rep (BackendInfoAndSourceMetadata b) x
-&gt; BackendInfoAndSourceMetadata b
forall (b :: BackendType) x.
BackendInfoAndSourceMetadata b
-&gt; Rep (BackendInfoAndSourceMetadata b) x
$cfrom :: forall (b :: BackendType) x.
BackendInfoAndSourceMetadata b
-&gt; Rep (BackendInfoAndSourceMetadata b) x
from :: forall x.
BackendInfoAndSourceMetadata b
-&gt; Rep (BackendInfoAndSourceMetadata b) x
$cto :: forall (b :: BackendType) x.
Rep (BackendInfoAndSourceMetadata b) x
-&gt; BackendInfoAndSourceMetadata b
to :: forall x.
Rep (BackendInfoAndSourceMetadata b) x
-&gt; BackendInfoAndSourceMetadata b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-1649"></span><span>
</span><span id="line-1650"></span><span id="local-6989586621687410789"><span id="local-6989586621687414933"><span id="local-6989586621687414940"><span id="local-6989586621687414944"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410789"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#BackendInfoAndSourceMetadata"><span class="hs-identifier hs-type">BackendInfoAndSourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410789"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-1651"></span><span>
</span><span id="line-1652"></span><span id="local-6989586621687410792"><span id="local-6989586621687414949"><span id="local-6989586621687414955"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410792"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#BackendInfoAndSourceMetadata"><span class="hs-identifier hs-type">BackendInfoAndSourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687410792"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1653"></span><span>
</span><span id="line-1654"></span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#joinBackendInfosToSources"><span class="hs-identifier hs-type">joinBackendInfosToSources</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1655"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#BackendCache"><span class="hs-identifier hs-type">BackendCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1656"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#InsOrdHashMap"><span class="hs-identifier hs-type">InsOrdHashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#BackendSourceMetadata"><span class="hs-identifier hs-type">BackendSourceMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1657"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#InsOrdHashMap"><span class="hs-identifier hs-type">InsOrdHashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.SQL.AnyBackend.html#AnyBackend"><span class="hs-identifier hs-type">AB.AnyBackend</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#BackendInfoAndSourceMetadata"><span class="hs-identifier hs-type">BackendInfoAndSourceMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1658"></span><span id="joinBackendInfosToSources"><span class="annot"><span class="annottext">joinBackendInfosToSources :: BackendCache
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; InsOrdHashMap
     SourceName (AnyBackend BackendInfoAndSourceMetadata)
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#joinBackendInfosToSources"><span class="hs-identifier hs-var hs-var">joinBackendInfosToSources</span></a></span></span><span> </span><span id="local-6989586621687414959"><span class="annot"><span class="annottext">BackendCache
</span><a href="#local-6989586621687414959"><span class="hs-identifier hs-var">backendInfos</span></a></span></span><span> </span><span id="local-6989586621687414960"><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621687414960"><span class="hs-identifier hs-var">sources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1659"></span><span>  </span><span class="annot"><span class="annottext">((BackendSourceMetadata -&gt; AnyBackend BackendInfoAndSourceMetadata)
 -&gt; InsOrdHashMap SourceName BackendSourceMetadata
 -&gt; InsOrdHashMap
      SourceName (AnyBackend BackendInfoAndSourceMetadata))
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; (BackendSourceMetadata
    -&gt; AnyBackend BackendInfoAndSourceMetadata)
-&gt; InsOrdHashMap
     SourceName (AnyBackend BackendInfoAndSourceMetadata)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(BackendSourceMetadata -&gt; AnyBackend BackendInfoAndSourceMetadata)
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; InsOrdHashMap
     SourceName (AnyBackend BackendInfoAndSourceMetadata)
forall v1 v2 k.
(v1 -&gt; v2) -&gt; InsOrdHashMap k v1 -&gt; InsOrdHashMap k v2
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-49fbdaf96dc15099eff4ef8a3e0f09875e1be0b1cc3eaf40a128da3b28f930a2/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#map"><span class="hs-identifier hs-var">InsOrdHashMap.map</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621687414960"><span class="hs-identifier hs-var">sources</span></a></span><span> </span><span class="annot"><span class="annottext">((BackendSourceMetadata -&gt; AnyBackend BackendInfoAndSourceMetadata)
 -&gt; InsOrdHashMap
      SourceName (AnyBackend BackendInfoAndSourceMetadata))
-&gt; (BackendSourceMetadata
    -&gt; AnyBackend BackendInfoAndSourceMetadata)
-&gt; InsOrdHashMap
     SourceName (AnyBackend BackendInfoAndSourceMetadata)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687414962"><span class="annot"><span class="annottext">BackendSourceMetadata
</span><a href="#local-6989586621687414962"><span class="hs-identifier hs-var">abSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1660"></span><span>    </span><span class="annot"><span class="annottext">forall (c :: BackendType -&gt; Constraint) (i :: BackendType -&gt; *) r.
AllBackendsSatisfy c =&gt;
AnyBackend i -&gt; (forall (b :: BackendType). c b =&gt; i b -&gt; r) -&gt; r
</span><a href="Hasura.SQL.AnyBackend.html#dispatchAnyBackend"><span class="hs-identifier hs-var">AB.dispatchAnyBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackendSourceMetadata -&gt; AnyBackend SourceMetadata
</span><a href="Hasura.RQL.Types.Metadata.Common.html#unBackendSourceMetadata"><span class="hs-identifier hs-var">unBackendSourceMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">BackendSourceMetadata
</span><a href="#local-6989586621687414962"><span class="hs-identifier hs-var">abSourceMetadata</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((forall (b :: BackendType).
  Backend b =&gt;
  SourceMetadata b -&gt; AnyBackend BackendInfoAndSourceMetadata)
 -&gt; AnyBackend BackendInfoAndSourceMetadata)
-&gt; (forall (b :: BackendType).
    Backend b =&gt;
    SourceMetadata b -&gt; AnyBackend BackendInfoAndSourceMetadata)
-&gt; AnyBackend BackendInfoAndSourceMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621687414970"><span id="local-6989586621687414971"><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687414971"><span class="hs-identifier hs-var">sourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SourceMetadata"><span class="hs-identifier hs-type">SourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687414970"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1661"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687414972"><span class="annot"><span class="annottext">_bcasmBackendInfo :: BackendInfo b
</span><a href="#local-6989586621687414972"><span class="hs-identifier hs-var hs-var">_bcasmBackendInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BackendInfo b
-&gt; (BackendInfoWrapper b -&gt; BackendInfo b)
-&gt; Maybe (BackendInfoWrapper b)
-&gt; BackendInfo b
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">BackendInfo b
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">BackendInfoWrapper b -&gt; BackendInfo b
forall (b :: BackendType). BackendInfoWrapper b -&gt; BackendInfo b
</span><a href="Hasura.RQL.Types.SchemaCache.html#unBackendInfoWrapper"><span class="hs-identifier hs-var">unBackendInfoWrapper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
BackendMap i -&gt; Maybe (i b)
</span><a href="Hasura.SQL.BackendMap.html#lookup"><span class="hs-identifier hs-var">BackendMap.lookup</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687414970"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">BackendCache
</span><a href="#local-6989586621687414959"><span class="hs-identifier hs-var">backendInfos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1662"></span><span>          </span><span id="local-6989586621687414976"><span class="annot"><span class="annottext">_bcasmSourceMetadata :: SourceMetadata b
</span><a href="#local-6989586621687414976"><span class="hs-identifier hs-var hs-var">_bcasmSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621687414971"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-1663"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687414970"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#BackendInfoAndSourceMetadata"><span class="hs-identifier hs-type">BackendInfoAndSourceMetadata</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">BackendInfo b
SourceMetadata b
_bcasmBackendInfo :: BackendInfo b
_bcasmSourceMetadata :: SourceMetadata b
_bcasmBackendInfo :: BackendInfo b
_bcasmSourceMetadata :: SourceMetadata b
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#_bcasmBackendInfo"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-1664"></span><span>
</span><span id="line-1665"></span><span class="hs-comment">{- Note [Keep invalidation keys for inconsistent objects]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
After building the schema cache, we prune InvalidationKeys for objects
that no longer exist in the schema to avoid leaking memory for objects
that have been dropped. However, note that we *don&#8217;t* want to drop
keys for objects that are simply inconsistent!

Why? The object is still in the metadata, so next time we reload it,
we&#8217;ll reprocess that object. We want to reuse the cache if its
definition hasn&#8217;t changed, but if we dropped the invalidation key, it
will incorrectly be reprocessed (since the invalidation key changed
from present to absent). -}</span><span>
</span><span id="line-1677"></span></pre></body></html>