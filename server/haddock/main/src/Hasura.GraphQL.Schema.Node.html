<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | A collection of types and utilities around the @Node@ GraphQL</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- type exposed by the Relay API.</span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.GraphQL.Schema.Node</span><span>
</span><span id="line-4"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Node id</span></span><span>
</span><span id="line-5"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#NodeId"><span class="hs-identifier">NodeId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#V1NodeId"><span class="hs-identifier">V1NodeId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#V2NodeId"><span class="hs-identifier">V2NodeId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Node id version</span></span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#NodeIdVersion"><span class="hs-identifier">NodeIdVersion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#nodeIdVersionInt"><span class="hs-identifier">nodeIdVersionInt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#currentNodeIdVersion"><span class="hs-identifier">currentNodeIdVersion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Internal relay types</span></span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#NodeMap"><span class="hs-identifier">NodeMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#TableMap"><span class="hs-identifier">TableMap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#NodeInfo"><span class="hs-identifier">NodeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#findNode"><span class="hs-identifier">findNode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">where</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">J</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.Types</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">J</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Seq</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Sequence.NonEmpty.html"><span class="hs-identifier">Data.Sequence.NonEmpty</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NESeq</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html"><span class="hs-identifier">Hasura.Backends.Postgres.SQL.Types</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PG</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Prelude.html"><span class="hs-identifier">Hasura.Prelude</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.html"><span class="hs-identifier">Hasura.RQL.IR</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IR</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html"><span class="hs-identifier">Hasura.RQL.Types.Backend</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Column.html"><span class="hs-identifier">Hasura.RQL.Types.Column</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html"><span class="hs-identifier">Hasura.RQL.Types.Common</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Table.html"><span class="hs-identifier">Hasura.RQL.Types.Table</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.AnyBackend.html"><span class="hs-identifier">Hasura.SQL.AnyBackend</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AB</span></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-comment">{- Note [Relay Node Id]
~~~~~~~~~~~~~~~~~~~~~~~

Relay API
---------

The 'Node' interface in the Relay API schema has exactly one field, which
returns a non-null 'ID' value. In a backend that supports the Relay API, each
table's corresponding GraphQL object implements that interface, and provides an
@id@ field that uniuqely identifies each row of the table. See
https://relay.dev/graphql/objectidentification.htm for more details.

To uniquely identify a given row in a given table, we use two different pieces
of information:
  - something that uniquely identifies the table within the schema
  - something that uniquely identifies the row within the table

Both V1 and V2 (of this particular API, not of the engine, see 'NodeIdVersion')
use the same data to uniquely identify the row within the table: a list of
values that map to the table's primary keys, in order. Where they differentiate
is on how they identify the table within the schema:
  - V1 only used a Postgres table name;
  - V2 uses a source name, and a backend-agnostic table name

For now, we still only emit and accept V1 ids: switching to emitting V2 node ids
will be a breaking change that will we do soon. We will continue to accept V1
node ids after that change, meaning we still to resolve them; in practice, that
means iterating over all the Postgres sources, until we find one that has a
table with the given name. If we find more than one, then we fail, to avoid
having to pick a random one (and potentially silently return wrong results.)

Id format
---------

All the required information is encoded into a unique node id using the
following pipeline:

    values &lt;-&gt; JSON array &lt;-&gt; bytestring &lt;-&gt; base64 string

In v1, the content of the JSON array was:

    [ 1         -- JSON number: version number
    , &quot;public&quot;  -- JSON string: Postgres schema name
    , &quot;foo&quot;     -- JSON string: Postgres table name
    , ...       -- arbitrary JSON values: values for each primary key, in order
    ]

As of v2, the content of the JSON array is as follows:

    [ 2                    -- JSON number: version number
    , &quot;default&quot;            -- JSON string: source name
    , &quot;postgres&quot;           -- JSON string: backend type
    , { &quot;schema: &quot;public&quot;  -- arbitrary JSON value: table name in that backend
      , &quot;name&quot;: &quot;foo&quot;
      }
    , ...                  -- arbitrary JSON values: values for each primary key, in order
    ]

Encoding and decoding
---------------------

The encoding of a given row's id is performed in each backend's translation
layer, as crafting the row's id requires extracting information out of the
database (the primary key values). Selecting the 'id' field of a compatible
table will yield an 'AFNodeId' field in the IR (see Hasura.RQL.IR.Select), that
each compatible backend will then interpret appropriately.

Decoding, however, does not require introspecting the database, and is performed
at parsing time, so that we can select the corresponing table row. See
'nodeField' in 'Relay.hs' for more information.
-}</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- Node id</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-keyword">data</span><span> </span><span id="NodeId"><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#NodeId"><span class="hs-identifier hs-var">NodeId</span></a></span></span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NodeIdV1"><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#NodeIdV1"><span class="hs-identifier hs-var">NodeIdV1</span></a></span></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#V1NodeId"><span class="hs-identifier hs-type">V1NodeId</span></a></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NodeIdV2"><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#NodeIdV2"><span class="hs-identifier hs-var">NodeIdV2</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.SQL.AnyBackend.html#AnyBackend"><span class="hs-identifier hs-type">AB.AnyBackend</span></a></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#V2NodeId"><span class="hs-identifier hs-type">V2NodeId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-comment">-- | V1 format of a node.</span><span>
</span><span id="line-116"></span><span class="hs-comment">--</span><span>
</span><span id="line-117"></span><span class="hs-comment">-- This id does NOT uniquely identify the table properly, as it only knows the</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- table's name, but doesn't store a source name.</span><span>
</span><span id="line-119"></span><span class="hs-keyword">data</span><span> </span><span id="V1NodeId"><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#V1NodeId"><span class="hs-identifier hs-var">V1NodeId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="V1NodeId"><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#V1NodeId"><span class="hs-identifier hs-var">V1NodeId</span></a></span></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_ni1Table"><span class="annot"><span class="annottext">V1NodeId -&gt; QualifiedTable
</span><a href="Hasura.GraphQL.Schema.Node.html#_ni1Table"><span class="hs-identifier hs-var hs-var">_ni1Table</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedTable"><span class="hs-identifier hs-type">PG.QualifiedTable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-121"></span><span>    </span><span id="_ni1Columns"><span class="annot"><span class="annottext">V1NodeId -&gt; NESeq Value
</span><a href="Hasura.GraphQL.Schema.Node.html#_ni1Columns"><span class="hs-identifier hs-var hs-var">_ni1Columns</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Sequence.NonEmpty.html#NESeq"><span class="hs-identifier hs-type">NESeq.NESeq</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">J.Value</span></span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">-- | V2 format of a node.</span><span>
</span><span id="line-125"></span><span class="hs-comment">--</span><span>
</span><span id="line-126"></span><span class="hs-comment">-- Uniquely identifies a table with source name and table name, and uniquely</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- identifies a row within that table with a list of primary key values.</span><span>
</span><span id="line-128"></span><span class="hs-keyword">data</span><span> </span><span id="V2NodeId"><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#V2NodeId"><span class="hs-identifier hs-var">V2NodeId</span></a></span></span><span> </span><span id="local-6989586621689167961"><span class="annot"><a href="#local-6989586621689167961"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="V2NodeId"><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#V2NodeId"><span class="hs-identifier hs-var">V2NodeId</span></a></span></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_ni2Source"><span class="annot"><span class="annottext">V2NodeId b -&gt; SourceName
</span><a href="Hasura.GraphQL.Schema.Node.html#_ni2Source"><span class="hs-identifier hs-var hs-var">_ni2Source</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-130"></span><span>    </span><span id="_ni2Table"><span class="annot"><span class="annottext">V2NodeId b -&gt; TableName b
</span><a href="Hasura.GraphQL.Schema.Node.html#_ni2Table"><span class="hs-identifier hs-var hs-var">_ni2Table</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689167961"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-131"></span><span>    </span><span id="_ni2Columns"><span class="annot"><span class="annottext">V2NodeId b -&gt; NESeq Value
</span><a href="Hasura.GraphQL.Schema.Node.html#_ni2Columns"><span class="hs-identifier hs-var hs-var">_ni2Columns</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Data.Sequence.NonEmpty.html#NESeq"><span class="hs-identifier hs-type">NESeq.NESeq</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">J.Value</span></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621689167954"><span class="annot"><span class="hs-identifier hs-type">J.FromJSON</span></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-135"></span><span>  </span><span id="local-6989586621689167952"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser NodeId
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (Array -&gt; Parser NodeId) -&gt; Value -&gt; Parser NodeId
forall a. String -&gt; (Array -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">J.withArray</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;node id&quot;</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689167949"><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621689167949"><span class="hs-identifier hs-var">array</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Array -&gt; [Value]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621689167949"><span class="hs-identifier hs-var">array</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser NodeId
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unexpected GUID format, found empty list&quot;</span></span><span>
</span><span id="line-137"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">J.Number</span></span><span> </span><span class="annot"><span class="annottext">Scientific
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621689167946"><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621689167946"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">V1NodeId -&gt; NodeId
</span><a href="Hasura.GraphQL.Schema.Node.html#NodeIdV1"><span class="hs-identifier hs-var">NodeIdV1</span></a></span><span> </span><span class="annot"><span class="annottext">(V1NodeId -&gt; NodeId) -&gt; Parser V1NodeId -&gt; Parser NodeId
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Value] -&gt; Parser V1NodeId
</span><a href="Hasura.GraphQL.Schema.Node.html#parseNodeIdV1"><span class="hs-identifier hs-var">parseNodeIdV1</span></a></span><span> </span><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621689167946"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">J.Number</span></span><span> </span><span id="local-6989586621689167943"><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621689167943"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Value]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser NodeId
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Parser NodeId) -&gt; String -&gt; Parser NodeId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unsupported GUID version: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Scientific -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621689167943"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><span class="annottext">[Value]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser NodeId
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unexpected GUID format, needs to start with a version number&quot;</span></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#parseNodeIdV1"><span class="hs-identifier hs-type">parseNodeIdV1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">J.Value</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">J.Parser</span></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#V1NodeId"><span class="hs-identifier hs-type">V1NodeId</span></a></span><span>
</span><span id="line-142"></span><span id="parseNodeIdV1"><span class="annot"><span class="annottext">parseNodeIdV1 :: [Value] -&gt; Parser V1NodeId
</span><a href="Hasura.GraphQL.Schema.Node.html#parseNodeIdV1"><span class="hs-identifier hs-var hs-var">parseNodeIdV1</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621689167941"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689167941"><span class="hs-identifier hs-var">schemaValue</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621689167940"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689167940"><span class="hs-identifier hs-var">nameValue</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621689167939"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689167939"><span class="hs-identifier hs-var">firstColumn</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621689167938"><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621689167938"><span class="hs-identifier hs-var">remainingColumns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-143"></span><span>  </span><span class="annot"><span class="annottext">QualifiedTable -&gt; NESeq Value -&gt; V1NodeId
</span><a href="Hasura.GraphQL.Schema.Node.html#V1NodeId"><span class="hs-identifier hs-var">V1NodeId</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><span class="annottext">(QualifiedTable -&gt; NESeq Value -&gt; V1NodeId)
-&gt; Parser QualifiedTable -&gt; Parser (NESeq Value -&gt; V1NodeId)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaName -&gt; TableName -&gt; QualifiedTable
forall a. SchemaName -&gt; a -&gt; QualifiedObject a
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedObject"><span class="hs-identifier hs-var">PG.QualifiedObject</span></a></span><span> </span><span class="annot"><span class="annottext">(SchemaName -&gt; TableName -&gt; QualifiedTable)
-&gt; Parser SchemaName -&gt; Parser (TableName -&gt; QualifiedTable)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Parser SchemaName
forall a. FromJSON a =&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">J.parseJSON</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689167941"><span class="hs-identifier hs-var">schemaValue</span></a></span><span> </span><span class="annot"><span class="annottext">Parser (TableName -&gt; QualifiedTable)
-&gt; Parser TableName -&gt; Parser QualifiedTable
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Parser TableName
forall a. FromJSON a =&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">J.parseJSON</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689167940"><span class="hs-identifier hs-var">nameValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><span class="annottext">Parser (NESeq Value -&gt; V1NodeId)
-&gt; Parser (NESeq Value) -&gt; Parser V1NodeId
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">NESeq Value -&gt; Parser (NESeq Value)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689167939"><span class="hs-identifier hs-var">firstColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Seq Value -&gt; NESeq Value
forall a. a -&gt; Seq a -&gt; NESeq a
</span><a href="Data.Sequence.NonEmpty.html#%3A%3C%7C%7C"><span class="hs-operator hs-var">NESeq.:&lt;||</span></a></span><span> </span><span class="annot"><span class="annottext">[Value] -&gt; Seq Value
forall a. [a] -&gt; Seq a
</span><span class="hs-identifier hs-var">Seq.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621689167938"><span class="hs-identifier hs-var">remainingColumns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#parseNodeIdV1"><span class="hs-identifier hs-var">parseNodeIdV1</span></a></span><span> </span><span class="annot"><span class="annottext">[Value]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser V1NodeId
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GUID version 1: expecting schema name, table name and at least one column value&quot;</span></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-149"></span><span class="hs-comment">-- Node id version</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-comment">-- | Enum representing the supported versions of the API.</span><span>
</span><span id="line-152"></span><span class="hs-keyword">data</span><span> </span><span id="NodeIdVersion"><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#NodeIdVersion"><span class="hs-identifier hs-var">NodeIdVersion</span></a></span></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NIVersion1"><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#NIVersion1"><span class="hs-identifier hs-var">NIVersion1</span></a></span></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NIVersion2"><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#NIVersion2"><span class="hs-identifier hs-var">NIVersion2</span></a></span></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689167927"><span id="local-6989586621689167929"><span id="local-6989586621689167931"><span class="annot"><span class="annottext">Int -&gt; NodeIdVersion -&gt; String -&gt; String
[NodeIdVersion] -&gt; String -&gt; String
NodeIdVersion -&gt; String
(Int -&gt; NodeIdVersion -&gt; String -&gt; String)
-&gt; (NodeIdVersion -&gt; String)
-&gt; ([NodeIdVersion] -&gt; String -&gt; String)
-&gt; Show NodeIdVersion
forall a.
(Int -&gt; a -&gt; String -&gt; String)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; String -&gt; String) -&gt; Show a
showList :: [NodeIdVersion] -&gt; String -&gt; String
$cshowList :: [NodeIdVersion] -&gt; String -&gt; String
show :: NodeIdVersion -&gt; String
$cshow :: NodeIdVersion -&gt; String
showsPrec :: Int -&gt; NodeIdVersion -&gt; String -&gt; String
$cshowsPrec :: Int -&gt; NodeIdVersion -&gt; String -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689167922"><span id="local-6989586621689167924"><span class="annot"><span class="annottext">NodeIdVersion -&gt; NodeIdVersion -&gt; Bool
(NodeIdVersion -&gt; NodeIdVersion -&gt; Bool)
-&gt; (NodeIdVersion -&gt; NodeIdVersion -&gt; Bool) -&gt; Eq NodeIdVersion
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: NodeIdVersion -&gt; NodeIdVersion -&gt; Bool
$c/= :: NodeIdVersion -&gt; NodeIdVersion -&gt; Bool
== :: NodeIdVersion -&gt; NodeIdVersion -&gt; Bool
$c== :: NodeIdVersion -&gt; NodeIdVersion -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#nodeIdVersionInt"><span class="hs-identifier hs-type">nodeIdVersionInt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#NodeIdVersion"><span class="hs-identifier hs-type">NodeIdVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-158"></span><span id="nodeIdVersionInt"><span class="annot"><span class="annottext">nodeIdVersionInt :: NodeIdVersion -&gt; Int
</span><a href="Hasura.GraphQL.Schema.Node.html#nodeIdVersionInt"><span class="hs-identifier hs-var hs-var">nodeIdVersionInt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-159"></span><span>  </span><span class="annot"><span class="annottext">NodeIdVersion
</span><a href="Hasura.GraphQL.Schema.Node.html#NIVersion1"><span class="hs-identifier hs-var">NIVersion1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-160"></span><span>  </span><span class="annot"><span class="annottext">NodeIdVersion
</span><a href="Hasura.GraphQL.Schema.Node.html#NIVersion2"><span class="hs-identifier hs-var">NIVersion2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#currentNodeIdVersion"><span class="hs-identifier hs-type">currentNodeIdVersion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#NodeIdVersion"><span class="hs-identifier hs-type">NodeIdVersion</span></a></span><span>
</span><span id="line-163"></span><span id="currentNodeIdVersion"><span class="annot"><span class="annottext">currentNodeIdVersion :: NodeIdVersion
</span><a href="Hasura.GraphQL.Schema.Node.html#currentNodeIdVersion"><span class="hs-identifier hs-var hs-var">currentNodeIdVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeIdVersion
</span><a href="Hasura.GraphQL.Schema.Node.html#NIVersion1"><span class="hs-identifier hs-var">NIVersion1</span></a></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-166"></span><span class="hs-comment">-- Internal relay types</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="hs-comment">{- Note [Internal Relay HashMap]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Parsing the Node interface
--------------------------

When selecting a node in the schema, the user can use GraphQL fragments to
select different rows based on what table the node id maps to. For instance, a
Relay query could look like this (assuming that there are corresponding tables
&quot;album&quot; and &quot;track&quot; in the schema, possibly in different sources):

    query {
      node(id: &quot;base64idhere&quot;) {
        ... on album {
          albumName
        }
        ... on track {
          trackName
        }
      }
    }

What that means is that the parser for the 'Node' interface needs to delegate to
*every table parser*, to deal with all possible cases. In practice, we use the
'selectionSetInterface' combinator (from Hasura.GraphQL.Parser.Internal.Parser):
we give it a list of all the parsers, and it in turn applies all of them, and
gives us the result for each possible table:
  - if the table was &quot;album&quot;, the parsed result is: ...
  - if the table was &quot;track&quot;, the parsed result is: ...

The parser for the interface itself cannot know what the actual underlying table
is: that's determined by the node id, which is not something inherent to the
interface! Consequently, what the parser for the interface returns is a
container, that to every supported table in the schema, associates the
corresponding parser output; the node *field* can then use that map and the node
id it got as an argument to extract the relevant information out of said
container.

The 'NodeMap' container
-----------------------

To avoid having to do extra lookups, we also store in that container additional
information about the table: permissions for the current role, connection
information... so that the field, by simply doing a lookup based on the node id,
can have all the information it needs to craft a corresponding query.

In practice: the value we store in our container is a 'NodeInfo' (see
below). Our container, in turn, isn't a 'HashMap' from &quot;unique table identifier&quot;
to 'NodeInfo'; the problem is that not all sources have the same backend type,
meaning that the &quot;unique table identifier&quot; would need to be a _hetereogeneous_
key type. This can be achieved with a dependent map (such as
Data.Dependent.Map.DMap), but is extremely cumbersome. Instead, our overall
container, 'NodeMap', is two layers of 'HashMap': to a source name, we associate
a &quot;backend-erased&quot; 'TableMap' which, in turn, for the corresponding backend,
associates to a table name the corresponding 'NodeInfo'.

Module structure
----------------

Ideally, none of those types should be exported: they are used in the return
type of 'nodeInteface', but consumed immediately by 'nodeField' (see both in
Relay.hs), and they could therefore be purely internal... except for the fact
that 'Common.hs' needs to know about the NodeMap, which is why it is defined
here instead of being an implementation detail of 'Relay.hs'.
-}</span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="hs-keyword">type</span><span> </span><span id="NodeMap"><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#NodeMap"><span class="hs-identifier hs-var">NodeMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.SQL.AnyBackend.html#AnyBackend"><span class="hs-identifier hs-type">AB.AnyBackend</span></a></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#TableMap"><span class="hs-identifier hs-type">TableMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="hs-comment">-- | All the information required to craft a query to a row pointed to by a</span><span>
</span><span id="line-237"></span><span class="hs-comment">-- 'NodeId'.</span><span>
</span><span id="line-238"></span><span class="hs-keyword">data</span><span> </span><span id="NodeInfo"><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#NodeInfo"><span class="hs-identifier hs-var">NodeInfo</span></a></span></span><span> </span><span id="local-6989586621689167920"><span class="annot"><a href="#local-6989586621689167920"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="NodeInfo"><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#NodeInfo"><span class="hs-identifier hs-var">NodeInfo</span></a></span></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="nvSourceConfig"><span class="annot"><span class="annottext">NodeInfo b -&gt; SourceConfig b
</span><a href="Hasura.GraphQL.Schema.Node.html#nvSourceConfig"><span class="hs-identifier hs-var hs-var">nvSourceConfig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#SourceConfig"><span class="hs-identifier hs-type">SourceConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689167920"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-240"></span><span>    </span><span id="nvSelectPermissions"><span class="annot"><span class="annottext">NodeInfo b -&gt; SelPermInfo b
</span><a href="Hasura.GraphQL.Schema.Node.html#nvSelectPermissions"><span class="hs-identifier hs-var hs-var">nvSelectPermissions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Table.html#SelPermInfo"><span class="hs-identifier hs-type">SelPermInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689167920"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-241"></span><span>    </span><span id="nvPrimaryKeys"><span class="annot"><span class="annottext">NodeInfo b -&gt; PrimaryKeyColumns b
</span><a href="Hasura.GraphQL.Schema.Node.html#nvPrimaryKeys"><span class="hs-identifier hs-var hs-var">nvPrimaryKeys</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Column.html#PrimaryKeyColumns"><span class="hs-identifier hs-type">PrimaryKeyColumns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689167920"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-242"></span><span>    </span><span id="nvAnnotatedFields"><span class="annot"><span class="annottext">NodeInfo b
-&gt; AnnFieldsG
     b (RemoteRelationshipField UnpreparedValue) (UnpreparedValue b)
</span><a href="Hasura.GraphQL.Schema.Node.html#nvAnnotatedFields"><span class="hs-identifier hs-var hs-var">nvAnnotatedFields</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnFieldsG"><span class="hs-identifier hs-type">IR.AnnFieldsG</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689167920"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Root.html#RemoteRelationshipField"><span class="hs-identifier hs-type">IR.RemoteRelationshipField</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Value.html#UnpreparedValue"><span class="hs-identifier hs-type">IR.UnpreparedValue</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Value.html#UnpreparedValue"><span class="hs-identifier hs-type">IR.UnpreparedValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689167920"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="hs-keyword">newtype</span><span> </span><span id="TableMap"><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#TableMap"><span class="hs-identifier hs-var">TableMap</span></a></span></span><span> </span><span id="local-6989586621689167914"><span class="annot"><a href="#local-6989586621689167914"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TableMap"><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#TableMap"><span class="hs-identifier hs-var">TableMap</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689167914"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#NodeInfo"><span class="hs-identifier hs-type">NodeInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689167914"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="hs-comment">-- | Given a source name and table name, peform the double lookup within a</span><span>
</span><span id="line-248"></span><span class="hs-comment">-- 'NodeMap'.</span><span>
</span><span id="line-249"></span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#findNode"><span class="hs-identifier hs-type">findNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689167912"><span class="annot"><a href="#local-6989586621689167912"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689167912"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689167912"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#NodeMap"><span class="hs-identifier hs-type">NodeMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#NodeInfo"><span class="hs-identifier hs-type">NodeInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689167912"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span id="findNode"><span class="annot"><span class="annottext">findNode :: SourceName -&gt; TableName b -&gt; NodeMap -&gt; Maybe (NodeInfo b)
</span><a href="Hasura.GraphQL.Schema.Node.html#findNode"><span class="hs-identifier hs-var hs-var">findNode</span></a></span></span><span> </span><span id="local-6989586621689167910"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689167910"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span> </span><span id="local-6989586621689167909"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689167909"><span class="hs-identifier hs-var">tableName</span></a></span></span><span> </span><span id="local-6989586621689167908"><span class="annot"><span class="annottext">NodeMap
</span><a href="#local-6989586621689167908"><span class="hs-identifier hs-var">nodeMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-251"></span><span>  </span><span id="local-6989586621689167907"><span class="annot"><span class="annottext">AnyBackend TableMap
</span><a href="#local-6989586621689167907"><span class="hs-identifier hs-var">anyTableMap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; NodeMap -&gt; Maybe (AnyBackend TableMap)
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689167910"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">NodeMap
</span><a href="#local-6989586621689167908"><span class="hs-identifier hs-var">nodeMap</span></a></span><span>
</span><span id="line-252"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Schema.Node.html#TableMap"><span class="hs-identifier hs-type">TableMap</span></a></span><span> </span><span id="local-6989586621689167905"><span class="annot"><span class="annottext">HashMap (TableName b) (NodeInfo b)
</span><a href="#local-6989586621689167905"><span class="hs-identifier hs-var">tableMap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AnyBackend TableMap -&gt; Maybe (TableMap b)
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
AnyBackend i -&gt; Maybe (i b)
</span><a href="Hasura.SQL.AnyBackend.html#unpackAnyBackend"><span class="hs-identifier hs-var">AB.unpackAnyBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689167912"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">AnyBackend TableMap
</span><a href="#local-6989586621689167907"><span class="hs-identifier hs-var">anyTableMap</span></a></span><span>
</span><span id="line-253"></span><span>  </span><span class="annot"><span class="annottext">TableName b
-&gt; HashMap (TableName b) (NodeInfo b) -&gt; Maybe (NodeInfo b)
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689167909"><span class="hs-identifier hs-var">tableName</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (TableName b) (NodeInfo b)
</span><a href="#local-6989586621689167905"><span class="hs-identifier hs-var">tableMap</span></a></span><span>
</span><span id="line-254"></span></pre></body></html>