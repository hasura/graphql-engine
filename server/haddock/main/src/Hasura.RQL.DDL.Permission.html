<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE TypeFamilyDependencies #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.RQL.DDL.Permission</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Permission.Internal.html#CreatePerm"><span class="hs-identifier">CreatePerm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#runCreatePerm"><span class="hs-identifier">runCreatePerm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#PermDef"><span class="hs-identifier">PermDef</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#InsPerm"><span class="hs-identifier">InsPerm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#InsPermDef"><span class="hs-identifier">InsPermDef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#buildInsPermInfo"><span class="hs-identifier">buildInsPermInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#SelPerm"><span class="hs-identifier">SelPerm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#SelPermDef"><span class="hs-identifier">SelPermDef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#buildSelPermInfo"><span class="hs-identifier">buildSelPermInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#UpdPerm"><span class="hs-identifier">UpdPerm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#UpdPermDef"><span class="hs-identifier">UpdPermDef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#buildUpdPermInfo"><span class="hs-identifier">buildUpdPermInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#DelPerm"><span class="hs-identifier">DelPerm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#DelPermDef"><span class="hs-identifier">DelPermDef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#buildDelPermInfo"><span class="hs-identifier">buildDelPermInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Permission.Internal.html#DropPerm"><span class="hs-identifier">DropPerm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#runDropPerm"><span class="hs-identifier">runDropPerm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#dropPermissionInMetadata"><span class="hs-identifier">dropPermissionInMetadata</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#SetPermComment"><span class="hs-identifier">SetPermComment</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#runSetPermComment"><span class="hs-identifier">runSetPermComment</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#PermInfo"><span class="hs-identifier">PermInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#buildPermInfo"><span class="hs-identifier">buildPermInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#addPermissionToMetadata"><span class="hs-identifier">addPermissionToMetadata</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">where</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Lens'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.~)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(^?)</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.Key</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">K</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.KeyMap</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">KM</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict.InsOrd</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OMap</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashSet</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HS</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Text.Extended.html"><span class="hs-identifier">Data.Text.Extended</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Base.Error.html"><span class="hs-identifier">Hasura.Base.Error</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.EncJSON.html"><span class="hs-identifier">Hasura.EncJSON</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Prelude.html"><span class="hs-identifier">Hasura.Prelude</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Permission.Internal.html"><span class="hs-identifier">Hasura.RQL.DDL.Permission.Internal</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.BoolExp.html"><span class="hs-identifier">Hasura.RQL.IR.BoolExp</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html"><span class="hs-identifier">Hasura.RQL.Types.Backend</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Column.html"><span class="hs-identifier">Hasura.RQL.Types.Column</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html"><span class="hs-identifier">Hasura.RQL.Types.Common</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ComputedField.html"><span class="hs-identifier">Hasura.RQL.Types.ComputedField</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html"><span class="hs-identifier">Hasura.RQL.Types.Metadata</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html"><span class="hs-identifier">Hasura.RQL.Types.Metadata.Backend</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html"><span class="hs-identifier">Hasura.RQL.Types.Metadata.Object</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html"><span class="hs-identifier">Hasura.RQL.Types.Permission</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Relationships.Local.html"><span class="hs-identifier">Hasura.RQL.Types.Relationships.Local</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCache</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCache.Build</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Table.html"><span class="hs-identifier">Hasura.RQL.Types.Table</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.AnyBackend.html"><span class="hs-identifier">Hasura.SQL.AnyBackend</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AB</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.Types.html"><span class="hs-identifier">Hasura.SQL.Types</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html"><span class="hs-identifier">Hasura.Server.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Types.html#StreamingSubscriptionsCtx"><span class="hs-identifier">StreamingSubscriptionsCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Session.html"><span class="hs-identifier">Hasura.Session</span></a></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-comment">{- Note [Backend only permissions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
As of writing this note, Hasura permission system is meant to be used by the
frontend. After introducing &quot;Actions&quot;, the webhook handlers now can make GraphQL
mutations to the server with some backend logic. These mutations shouldn't be
exposed to frontend for any user since they'll bypass the business logic.

Backend only permissions is available for all(insert/update/delete) mutation operations.

For example:-
=============

We've a table named &quot;user&quot; and it has a &quot;email&quot; column. We need to validate the
email address. So we define an action &quot;create_user&quot; and it expects the same inputs
as &quot;insert_user&quot; mutation (generated by Hasura). Note that both &quot;create_user&quot; and
&quot;insert_user&quot; can insert values into the &quot;user&quot; table but only &quot;create_user&quot; has the
logic to validate the email address.

In the current Hasura permission system, a role has permission for both 'actions' and
'insert operations' on the table. That means, both the &quot;create_user&quot; and &quot;insert_user&quot;
operations will be visible to the frontend client. This is bad, since users can use
&quot;insert_user&quot; operation to circumvent the validation logic of &quot;create_user&quot;.

We can overcome this problem by using &quot;Backend only permissions&quot;. In this if the
insert/update/delete permission is marked as &quot;backend_only: true&quot;, then the insert
operation will not be visible to the frontend client unless specifically specified

Backend only permissions adds an additional privilege to Hasura generated operations.

Those are accessable only if the request is made with all of the following:
  * `x-hasura-admin-secret` (if authorization is configured),
  * `x-hasura-use-backend-only-permissions` (value must be set to &quot;true&quot;),
  * `x-hasura-role` to identify the role
  * other required session variables.

backend_only   `x-hasura-admin-secret`   `x-hasura-use-backend-only-permissions`  Result
------------    ---------------------     -------------------------------------   ------
FALSE           ANY                       ANY                                    Mutation is always visible (Default Case: When no authorization is setup)
TRUE            FALSE                     ANY                                    Mutation is always hidden
FALSE           TRUE                      ANY                                    Mutation is always visible
TRUE            TRUE (OR NOT-SET)         FALSE                                  Mutation is hidden
TRUE            TRUE (OR NOT-SET)         TRUE                                   Mutation is shown

case 1: default case - no authorization is set and no backend_only permission are set
then irresepective of the value of `x-hasura-use-backend-only-permissions` the
mutation will always be visible

case 2: the authorization is set and the backend_only permissions are set but the
`x-hasura-admin-secret` is not sent along with request then irresepective of the value
in `x-hasura-use-backend-only-permissions` the mutation will always be hidden

case 3: the authorization is set, but no backend_only permission are set, the
`x-hasura-admin-secret` is sent along with request then irresepective of the value
in `x-hasura-use-backend-only-permissions` the mutation will always be visible

case 4 and 5:
the authz is set and the backend_only permissions are also set and the
`x-hasura-admin` secret is also sent along with the request then:
  * if `x-hasura-use-backend-only-permissions` header is sent as FALSE along with the
    request then the mutation will be hidden (4th case)
  * if `x-hasura-use-backend-only-permissions` header is sent as TRUE along with the
    request then the mutation will be visible (5th case)

How it Works:-
===============

Hasura has two scenarios:
  * Frontend Scenario
  * Backend Scenario

When no backend-only permissions are set then Hasura runs only in frontend scenario,
i.e all the mutation operations are visible.

When backend-only permissions are set, there comes a notion of:
  * which mutations are visible by default i.e without any request headers (frontend scenario)
  * which mutations are visible when `x-hasura-use-backend-only-permissions` is set (backend scenario)

Hasura maintains two different graphql schema ('frontend schema' and 'backend schema')
for all mutation fields of a table:
  * 'frontend schema': info about the mutation operation allowed to be shown on the frontend client when no backend-only permissions is set
  * 'backend schema' : info about the mutation operation allowed to be shown on the frontend client when backend-only permissions is set

The generation of these schemas happen in the `buildSource` functions of
`buildRoleContext` and `buildRelayRoleContext` functions. The internal representation
of these schema's look like:
  {RoleName: (Frontend Schema/Default Schema, Backend Schema)}

For example:
------------
We've a table &quot;user&quot; tracked by hasura and a role &quot;public&quot;

* If the update permission for the table &quot;user&quot; is marked as backend_only then the
  GQL context for that table will look like:

    {&quot;public&quot;: ([&quot;insert_user&quot;,&quot;delete_user&quot;], [&quot;update_user&quot;])}

  In the above '[&quot;insert_user&quot;,&quot;delete_user&quot;]' are the only mutation operation visible
  by default on the frontend client. And the 'update_user' opertaion is only visible
  when the `x-hasura-use-backend-only-permissions` request header is present.

* If there is no backend_only permissions defined on the role then the GQL context
  looks like:

    {&quot;public&quot;: ([&quot;insert_user&quot;,&quot;delete_user&quot;, &quot;update_user&quot;], [])}

  In the above there is no specific schema for the backend scenario i.e all the
  mutation operations are visible by default.
-}</span><span>
</span><span id="line-169"></span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#procSetObj"><span class="hs-identifier hs-type">procSetObj</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689461978"><span class="annot"><a href="#local-6989586621689461978"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621689461979"><span class="annot"><a href="#local-6989586621689461979"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461979"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461978"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-172"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-173"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461978"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-174"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Table.html#FieldInfoMap"><span class="hs-identifier hs-type">FieldInfoMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Table.html#FieldInfo"><span class="hs-identifier hs-type">FieldInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461978"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-175"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Column.html#ColumnValues"><span class="hs-identifier hs-type">ColumnValues</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461978"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-176"></span><span>  </span><span class="annot"><a href="#local-6989586621689461979"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.BoolExp.html#PreSetColsPartial"><span class="hs-identifier hs-type">PreSetColsPartial</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461978"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SchemaDependency"><span class="hs-identifier hs-type">SchemaDependency</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span id="procSetObj"><span class="annot"><span class="annottext">procSetObj :: SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; Maybe (ColumnValues b Value)
-&gt; m (PreSetColsPartial b, [Text], [SchemaDependency])
</span><a href="Hasura.RQL.DDL.Permission.html#procSetObj"><span class="hs-identifier hs-var hs-var">procSetObj</span></a></span></span><span> </span><span id="local-6989586621689461832"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461832"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621689461831"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461831"><span class="hs-identifier hs-var">tn</span></a></span></span><span> </span><span id="local-6989586621689461830"><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461830"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span></span><span> </span><span id="local-6989586621689461829"><span class="annot"><span class="annottext">Maybe (ColumnValues b Value)
</span><a href="#local-6989586621689461829"><span class="hs-identifier hs-var">mObj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-178"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621689461828"><span class="annot"><span class="annottext">[(Column b, PartialSQLExp b)]
</span><a href="#local-6989586621689461828"><span class="hs-identifier hs-var">setColTups</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689461827"><span class="annot"><span class="annottext">[SchemaDependency]
</span><a href="#local-6989586621689461827"><span class="hs-identifier hs-var">deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; m ([(Column b, PartialSQLExp b)], [SchemaDependency])
-&gt; m ([(Column b, PartialSQLExp b)], [SchemaDependency])
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#withPathK"><span class="hs-identifier hs-var">withPathK</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;set&quot;</span></span><span> </span><span class="annot"><span class="annottext">(m ([(Column b, PartialSQLExp b)], [SchemaDependency])
 -&gt; m ([(Column b, PartialSQLExp b)], [SchemaDependency]))
-&gt; m ([(Column b, PartialSQLExp b)], [SchemaDependency])
-&gt; m ([(Column b, PartialSQLExp b)], [SchemaDependency])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><span class="annottext">([((Column b, PartialSQLExp b), SchemaDependency)]
 -&gt; ([(Column b, PartialSQLExp b)], [SchemaDependency]))
-&gt; m [((Column b, PartialSQLExp b), SchemaDependency)]
-&gt; m ([(Column b, PartialSQLExp b)], [SchemaDependency])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[((Column b, PartialSQLExp b), SchemaDependency)]
-&gt; ([(Column b, PartialSQLExp b)], [SchemaDependency])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">(m [((Column b, PartialSQLExp b), SchemaDependency)]
 -&gt; m ([(Column b, PartialSQLExp b)], [SchemaDependency]))
-&gt; m [((Column b, PartialSQLExp b), SchemaDependency)]
-&gt; m ([(Column b, PartialSQLExp b)], [SchemaDependency])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-180"></span><span>      </span><span class="annot"><span class="annottext">[(Column b, Value)]
-&gt; ((Column b, Value)
    -&gt; m ((Column b, PartialSQLExp b), SchemaDependency))
-&gt; m [((Column b, PartialSQLExp b), SchemaDependency)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ColumnValues b Value -&gt; [(Column b, Value)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HM.toList</span></span><span> </span><span class="annot"><span class="annottext">ColumnValues b Value
</span><a href="#local-6989586621689461822"><span class="hs-identifier hs-var">setObj</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((Column b, Value)
  -&gt; m ((Column b, PartialSQLExp b), SchemaDependency))
 -&gt; m [((Column b, PartialSQLExp b), SchemaDependency)])
-&gt; ((Column b, Value)
    -&gt; m ((Column b, PartialSQLExp b), SchemaDependency))
-&gt; m [((Column b, PartialSQLExp b), SchemaDependency)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621689461821"><span class="annot"><span class="annottext">Column b
</span><a href="#local-6989586621689461821"><span class="hs-identifier hs-var">pgCol</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689461820"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689461820"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-181"></span><span>        </span><span id="local-6989586621689461819"><span class="annot"><span class="annottext">ColumnType b
</span><a href="#local-6989586621689461819"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-182"></span><span>          </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b) -&gt; Column b -&gt; Text -&gt; m (ColumnType b)
forall (m :: * -&gt; *) (backend :: BackendType).
(MonadError QErr m, Backend backend) =&gt;
FieldInfoMap (FieldInfo backend)
-&gt; Column backend -&gt; Text -&gt; m (ColumnType backend)
</span><a href="Hasura.RQL.Types.Table.html#askColumnType"><span class="hs-identifier hs-var">askColumnType</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461830"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">Column b
</span><a href="#local-6989586621689461821"><span class="hs-identifier hs-var">pgCol</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m (ColumnType b)) -&gt; Text -&gt; m (ColumnType b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-183"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;column &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Column b
</span><a href="#local-6989586621689461821"><span class="hs-identifier hs-var">pgCol</span></a></span><span> </span><span class="annot"><span class="annottext">Column b -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; not found in table &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; TableName b -&gt; Text
forall t. ToTxt t =&gt; Text -&gt; t -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3E%3E"><span class="hs-operator hs-var">&lt;&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461831"><span class="hs-identifier hs-var">tn</span></a></span><span>
</span><span id="line-184"></span><span>        </span><span id="local-6989586621689461815"><span class="annot"><span class="annottext">PartialSQLExp b
</span><a href="#local-6989586621689461815"><span class="hs-identifier hs-var">sqlExp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CollectableType (ColumnType b) -&gt; Value -&gt; m (PartialSQLExp b)
forall (b :: BackendType) (m :: * -&gt; *).
(BackendMetadata b, MonadError QErr m) =&gt;
CollectableType (ColumnType b) -&gt; Value -&gt; m (PartialSQLExp b)
</span><a href="Hasura.RQL.Types.Metadata.Backend.html#parseCollectableType"><span class="hs-identifier hs-var">parseCollectableType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ColumnType b -&gt; CollectableType (ColumnType b)
forall a. a -&gt; CollectableType a
</span><a href="Hasura.SQL.Types.html#CollectableTypeScalar"><span class="hs-identifier hs-var">CollectableTypeScalar</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnType b
</span><a href="#local-6989586621689461819"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689461820"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-185"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689461812"><span class="annot"><span class="annottext">dep :: SchemaDependency
</span><a href="#local-6989586621689461812"><span class="hs-identifier hs-var hs-var">dep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DependencyReason
-&gt; SourceName -&gt; TableName b -&gt; Column b -&gt; SchemaDependency
forall (b :: BackendType).
Backend b =&gt;
DependencyReason
-&gt; SourceName -&gt; TableName b -&gt; Column b -&gt; SchemaDependency
</span><a href="Hasura.RQL.Types.SchemaCache.html#mkColDep"><span class="hs-identifier hs-var">mkColDep</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689461978"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PartialSQLExp b -&gt; DependencyReason
forall (backend :: BackendType).
PartialSQLExp backend -&gt; DependencyReason
</span><a href="#local-6989586621689461810"><span class="hs-identifier hs-var">getDepReason</span></a></span><span> </span><span class="annot"><span class="annottext">PartialSQLExp b
</span><a href="#local-6989586621689461815"><span class="hs-identifier hs-var">sqlExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461832"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461831"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">Column b
</span><a href="#local-6989586621689461821"><span class="hs-identifier hs-var">pgCol</span></a></span><span>
</span><span id="line-186"></span><span>        </span><span class="annot"><span class="annottext">((Column b, PartialSQLExp b), SchemaDependency)
-&gt; m ((Column b, PartialSQLExp b), SchemaDependency)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Column b
</span><a href="#local-6989586621689461821"><span class="hs-identifier hs-var">pgCol</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PartialSQLExp b
</span><a href="#local-6989586621689461815"><span class="hs-identifier hs-var">sqlExp</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SchemaDependency
</span><a href="#local-6989586621689461812"><span class="hs-identifier hs-var">dep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><span class="annottext">(PreSetColsPartial b, [Text], [SchemaDependency])
-&gt; m (PreSetColsPartial b, [Text], [SchemaDependency])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Column b, PartialSQLExp b)] -&gt; PreSetColsPartial b
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(Column b, PartialSQLExp b)]
</span><a href="#local-6989586621689461828"><span class="hs-identifier hs-var">setColTups</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621689461808"><span class="hs-identifier hs-var">depHeaders</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SchemaDependency]
</span><a href="#local-6989586621689461827"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-189"></span><span>    </span><span id="local-6989586621689461822"><span class="annot"><span class="annottext">setObj :: ColumnValues b Value
</span><a href="#local-6989586621689461822"><span class="hs-identifier hs-var hs-var">setObj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ColumnValues b Value
-&gt; Maybe (ColumnValues b Value) -&gt; ColumnValues b Value
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">ColumnValues b Value
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Maybe (ColumnValues b Value)
</span><a href="#local-6989586621689461829"><span class="hs-identifier hs-var">mObj</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span id="local-6989586621689461808"><span class="annot"><span class="annottext">depHeaders :: [Text]
</span><a href="#local-6989586621689461808"><span class="hs-identifier hs-var hs-var">depHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-191"></span><span>      </span><span class="annot"><span class="annottext">Value -&gt; [Text]
</span><a href="Hasura.RQL.DDL.Permission.Internal.html#getDepHeadersFromVal"><span class="hs-identifier hs-var">getDepHeadersFromVal</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; [Text]) -&gt; Value -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-192"></span><span>        </span><span class="annot"><span class="annottext">Object -&gt; Value
</span><span class="hs-identifier hs-var">Object</span></span><span> </span><span class="annot"><span class="annottext">(Object -&gt; Value) -&gt; Object -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-193"></span><span>          </span><span class="annot"><span class="annottext">[(Key, Value)] -&gt; Object
forall v. [(Key, v)] -&gt; KeyMap v
</span><span class="hs-identifier hs-var">KM.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Key, Value)] -&gt; Object) -&gt; [(Key, Value)] -&gt; Object
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-194"></span><span>            </span><span class="annot"><span class="annottext">((Column b, Value) -&gt; (Key, Value))
-&gt; [(Column b, Value)] -&gt; [(Key, Value)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Column b -&gt; Key) -&gt; (Column b, Value) -&gt; (Key, Value)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Key
</span><span class="hs-identifier hs-var">K.fromText</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Key) -&gt; (Column b -&gt; Text) -&gt; Column b -&gt; Key
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Column b -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Column b, Value)] -&gt; [(Key, Value)])
-&gt; [(Column b, Value)] -&gt; [(Key, Value)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-195"></span><span>              </span><span class="annot"><span class="annottext">ColumnValues b Value -&gt; [(Column b, Value)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HM.toList</span></span><span> </span><span class="annot"><span class="annottext">ColumnValues b Value
</span><a href="#local-6989586621689461822"><span class="hs-identifier hs-var">setObj</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span>    </span><span id="local-6989586621689461810"><span class="annot"><span class="annottext">getDepReason :: PartialSQLExp backend -&gt; DependencyReason
</span><a href="#local-6989586621689461810"><span class="hs-identifier hs-var hs-var">getDepReason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DependencyReason -&gt; DependencyReason -&gt; Bool -&gt; DependencyReason
forall a. a -&gt; a -&gt; Bool -&gt; a
</span><span class="hs-identifier hs-var">bool</span></span><span> </span><span class="annot"><span class="annottext">DependencyReason
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#DRSessionVariable"><span class="hs-identifier hs-var">DRSessionVariable</span></a></span><span> </span><span class="annot"><span class="annottext">DependencyReason
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#DROnType"><span class="hs-identifier hs-var">DROnType</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; DependencyReason)
-&gt; (PartialSQLExp backend -&gt; Bool)
-&gt; PartialSQLExp backend
-&gt; DependencyReason
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PartialSQLExp backend -&gt; Bool
forall (backend :: BackendType). PartialSQLExp backend -&gt; Bool
</span><a href="Hasura.RQL.IR.BoolExp.html#isStaticValue"><span class="hs-identifier hs-var">isStaticValue</span></a></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="PermInfo"><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#PermInfo"><span class="hs-identifier hs-var">PermInfo</span></a></span></span><span> </span><span id="local-6989586621689461796"><span class="annot"><a href="#local-6989586621689461796"><span class="hs-identifier hs-type">perm</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-200"></span><span>  </span><span id="PermInfo"><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#PermInfo"><span class="hs-identifier hs-var">PermInfo</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#SelPerm"><span class="hs-identifier hs-type">SelPerm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Table.html#SelPermInfo"><span class="hs-identifier hs-type">SelPermInfo</span></a></span><span>
</span><span id="line-201"></span><span>  </span><span id="PermInfo"><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#PermInfo"><span class="hs-identifier hs-var">PermInfo</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#InsPerm"><span class="hs-identifier hs-type">InsPerm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Table.html#InsPermInfo"><span class="hs-identifier hs-type">InsPermInfo</span></a></span><span>
</span><span id="line-202"></span><span>  </span><span id="PermInfo"><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#PermInfo"><span class="hs-identifier hs-var">PermInfo</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#UpdPerm"><span class="hs-identifier hs-type">UpdPerm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Table.html#UpdPermInfo"><span class="hs-identifier hs-type">UpdPermInfo</span></a></span><span>
</span><span id="line-203"></span><span>  </span><span id="PermInfo"><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#PermInfo"><span class="hs-identifier hs-var">PermInfo</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#DelPerm"><span class="hs-identifier hs-type">DelPerm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Table.html#DelPermInfo"><span class="hs-identifier hs-type">DelPermInfo</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span id="local-6989586621689461997"><span id="local-6989586621689461998"><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#addPermissionToMetadata"><span class="hs-identifier hs-type">addPermissionToMetadata</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-206"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#PermDef"><span class="hs-identifier hs-type">PermDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461998"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461997"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-207"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#TableMetadata"><span class="hs-identifier hs-type">TableMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461998"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-208"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#TableMetadata"><span class="hs-identifier hs-type">TableMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461998"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-209"></span><span id="addPermissionToMetadata"><span class="annot"><span class="annottext">addPermissionToMetadata :: PermDef b a -&gt; TableMetadata b -&gt; TableMetadata b
</span><a href="Hasura.RQL.DDL.Permission.html#addPermissionToMetadata"><span class="hs-identifier hs-var hs-var">addPermissionToMetadata</span></a></span></span><span> </span><span id="local-6989586621689461795"><span class="annot"><span class="annottext">PermDef b a
</span><a href="#local-6989586621689461795"><span class="hs-identifier hs-var">permDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PermDef b a -&gt; PermDefPermission b a
forall (b :: BackendType) (perm :: BackendType -&gt; *).
PermDef b perm -&gt; PermDefPermission b perm
</span><a href="Hasura.RQL.Types.Permission.html#_pdPermission"><span class="hs-identifier hs-var hs-var">_pdPermission</span></a></span><span> </span><span class="annot"><span class="annottext">PermDef b a
</span><a href="#local-6989586621689461795"><span class="hs-identifier hs-var">permDef</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#InsPerm%27"><span class="hs-identifier hs-type">InsPerm'</span></a></span><span> </span><span class="annot"><span class="annottext">InsPerm b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Permissions (InsPermDef b)
 -&gt; Identity (Permissions (InsPermDef b)))
-&gt; TableMetadata b -&gt; Identity (TableMetadata b)
forall (b :: BackendType).
Lens' (TableMetadata b) (Permissions (InsPermDef b))
</span><a href="Hasura.RQL.Types.Metadata.Common.html#tmInsertPermissions"><span class="hs-identifier hs-var">tmInsertPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">((Permissions (InsPermDef b)
  -&gt; Identity (Permissions (InsPermDef b)))
 -&gt; TableMetadata b -&gt; Identity (TableMetadata b))
-&gt; (Permissions (InsPermDef b) -&gt; Permissions (InsPermDef b))
-&gt; TableMetadata b
-&gt; TableMetadata b
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">RoleName
-&gt; PermDef b a
-&gt; InsOrdHashMap RoleName (PermDef b a)
-&gt; InsOrdHashMap RoleName (PermDef b a)
forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; InsOrdHashMap k v -&gt; InsOrdHashMap k v
</span><span class="hs-identifier hs-var">OMap.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PermDef b a -&gt; RoleName
forall (b :: BackendType) (perm :: BackendType -&gt; *).
PermDef b perm -&gt; RoleName
</span><a href="Hasura.RQL.Types.Permission.html#_pdRole"><span class="hs-identifier hs-var hs-var">_pdRole</span></a></span><span> </span><span class="annot"><span class="annottext">PermDef b a
</span><a href="#local-6989586621689461795"><span class="hs-identifier hs-var">permDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PermDef b a
</span><a href="#local-6989586621689461795"><span class="hs-identifier hs-var">permDef</span></a></span><span>
</span><span id="line-211"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#SelPerm%27"><span class="hs-identifier hs-type">SelPerm'</span></a></span><span> </span><span class="annot"><span class="annottext">SelPerm b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Permissions (SelPermDef b)
 -&gt; Identity (Permissions (SelPermDef b)))
-&gt; TableMetadata b -&gt; Identity (TableMetadata b)
forall (b :: BackendType).
Lens' (TableMetadata b) (Permissions (SelPermDef b))
</span><a href="Hasura.RQL.Types.Metadata.Common.html#tmSelectPermissions"><span class="hs-identifier hs-var">tmSelectPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">((Permissions (SelPermDef b)
  -&gt; Identity (Permissions (SelPermDef b)))
 -&gt; TableMetadata b -&gt; Identity (TableMetadata b))
-&gt; (Permissions (SelPermDef b) -&gt; Permissions (SelPermDef b))
-&gt; TableMetadata b
-&gt; TableMetadata b
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">RoleName
-&gt; PermDef b a
-&gt; InsOrdHashMap RoleName (PermDef b a)
-&gt; InsOrdHashMap RoleName (PermDef b a)
forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; InsOrdHashMap k v -&gt; InsOrdHashMap k v
</span><span class="hs-identifier hs-var">OMap.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PermDef b a -&gt; RoleName
forall (b :: BackendType) (perm :: BackendType -&gt; *).
PermDef b perm -&gt; RoleName
</span><a href="Hasura.RQL.Types.Permission.html#_pdRole"><span class="hs-identifier hs-var hs-var">_pdRole</span></a></span><span> </span><span class="annot"><span class="annottext">PermDef b a
</span><a href="#local-6989586621689461795"><span class="hs-identifier hs-var">permDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PermDef b a
</span><a href="#local-6989586621689461795"><span class="hs-identifier hs-var">permDef</span></a></span><span>
</span><span id="line-212"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#UpdPerm%27"><span class="hs-identifier hs-type">UpdPerm'</span></a></span><span> </span><span class="annot"><span class="annottext">UpdPerm b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Permissions (UpdPermDef b)
 -&gt; Identity (Permissions (UpdPermDef b)))
-&gt; TableMetadata b -&gt; Identity (TableMetadata b)
forall (b :: BackendType).
Lens' (TableMetadata b) (Permissions (UpdPermDef b))
</span><a href="Hasura.RQL.Types.Metadata.Common.html#tmUpdatePermissions"><span class="hs-identifier hs-var">tmUpdatePermissions</span></a></span><span> </span><span class="annot"><span class="annottext">((Permissions (UpdPermDef b)
  -&gt; Identity (Permissions (UpdPermDef b)))
 -&gt; TableMetadata b -&gt; Identity (TableMetadata b))
-&gt; (Permissions (UpdPermDef b) -&gt; Permissions (UpdPermDef b))
-&gt; TableMetadata b
-&gt; TableMetadata b
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">RoleName
-&gt; PermDef b a
-&gt; InsOrdHashMap RoleName (PermDef b a)
-&gt; InsOrdHashMap RoleName (PermDef b a)
forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; InsOrdHashMap k v -&gt; InsOrdHashMap k v
</span><span class="hs-identifier hs-var">OMap.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PermDef b a -&gt; RoleName
forall (b :: BackendType) (perm :: BackendType -&gt; *).
PermDef b perm -&gt; RoleName
</span><a href="Hasura.RQL.Types.Permission.html#_pdRole"><span class="hs-identifier hs-var hs-var">_pdRole</span></a></span><span> </span><span class="annot"><span class="annottext">PermDef b a
</span><a href="#local-6989586621689461795"><span class="hs-identifier hs-var">permDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PermDef b a
</span><a href="#local-6989586621689461795"><span class="hs-identifier hs-var">permDef</span></a></span><span>
</span><span id="line-213"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#DelPerm%27"><span class="hs-identifier hs-type">DelPerm'</span></a></span><span> </span><span class="annot"><span class="annottext">DelPerm b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Permissions (DelPermDef b)
 -&gt; Identity (Permissions (DelPermDef b)))
-&gt; TableMetadata b -&gt; Identity (TableMetadata b)
forall (b :: BackendType).
Lens' (TableMetadata b) (Permissions (DelPermDef b))
</span><a href="Hasura.RQL.Types.Metadata.Common.html#tmDeletePermissions"><span class="hs-identifier hs-var">tmDeletePermissions</span></a></span><span> </span><span class="annot"><span class="annottext">((Permissions (DelPermDef b)
  -&gt; Identity (Permissions (DelPermDef b)))
 -&gt; TableMetadata b -&gt; Identity (TableMetadata b))
-&gt; (Permissions (DelPermDef b) -&gt; Permissions (DelPermDef b))
-&gt; TableMetadata b
-&gt; TableMetadata b
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">RoleName
-&gt; PermDef b a
-&gt; InsOrdHashMap RoleName (PermDef b a)
-&gt; InsOrdHashMap RoleName (PermDef b a)
forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; InsOrdHashMap k v -&gt; InsOrdHashMap k v
</span><span class="hs-identifier hs-var">OMap.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PermDef b a -&gt; RoleName
forall (b :: BackendType) (perm :: BackendType -&gt; *).
PermDef b perm -&gt; RoleName
</span><a href="Hasura.RQL.Types.Permission.html#_pdRole"><span class="hs-identifier hs-var hs-var">_pdRole</span></a></span><span> </span><span class="annot"><span class="annottext">PermDef b a
</span><a href="#local-6989586621689461795"><span class="hs-identifier hs-var">permDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PermDef b a
</span><a href="#local-6989586621689461795"><span class="hs-identifier hs-var">permDef</span></a></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span id="local-6989586621689461780"><span id="local-6989586621689461781"><span id="local-6989586621689461782"><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#buildPermInfo"><span class="hs-identifier hs-type">buildPermInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461782"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461781"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#TableCoreInfoRM"><span class="hs-identifier hs-type">TableCoreInfoRM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461782"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461781"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-217"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-218"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461782"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-219"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Table.html#FieldInfoMap"><span class="hs-identifier hs-type">FieldInfoMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Table.html#FieldInfo"><span class="hs-identifier hs-type">FieldInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461782"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-220"></span><span>  </span><span class="annot"><a href="Hasura.Session.html#RoleName"><span class="hs-identifier hs-type">RoleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-221"></span><span>  </span><span class="annot"><a href="Hasura.Server.Types.html#StreamingSubscriptionsCtx"><span class="hs-identifier hs-type">StreamingSubscriptionsCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-222"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#PermDefPermission"><span class="hs-identifier hs-type">PermDefPermission</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461782"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461780"><span class="hs-identifier hs-type">perm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-223"></span><span>  </span><span class="annot"><a href="#local-6989586621689461781"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#WithDeps"><span class="hs-identifier hs-type">WithDeps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#PermInfo"><span class="hs-identifier hs-type">PermInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461780"><span class="hs-identifier hs-type">perm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461782"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-224"></span><span id="buildPermInfo"><span class="annot"><span class="annottext">buildPermInfo :: SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; RoleName
-&gt; StreamingSubscriptionsCtx
-&gt; PermDefPermission b perm
-&gt; m (WithDeps (PermInfo perm b))
</span><a href="Hasura.RQL.DDL.Permission.html#buildPermInfo"><span class="hs-identifier hs-var hs-var">buildPermInfo</span></a></span></span><span> </span><span id="local-6989586621689461779"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461779"><span class="hs-identifier hs-var">x1</span></a></span></span><span> </span><span id="local-6989586621689461778"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461778"><span class="hs-identifier hs-var">x2</span></a></span></span><span> </span><span id="local-6989586621689461777"><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461777"><span class="hs-identifier hs-var">x3</span></a></span></span><span> </span><span id="local-6989586621689461776"><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461776"><span class="hs-identifier hs-var">roleName</span></a></span></span><span> </span><span id="local-6989586621689461775"><span class="annot"><span class="annottext">StreamingSubscriptionsCtx
</span><a href="#local-6989586621689461775"><span class="hs-identifier hs-var">streamingSubscriptionsCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-225"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#SelPerm%27"><span class="hs-identifier hs-type">SelPerm'</span></a></span><span> </span><span id="local-6989586621689461774"><span class="annot"><span class="annottext">SelPerm b
</span><a href="#local-6989586621689461774"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; RoleName
-&gt; StreamingSubscriptionsCtx
-&gt; SelPerm b
-&gt; m (WithDeps (SelPermInfo b))
forall (b :: BackendType) (m :: * -&gt; *).
(QErrM m, TableCoreInfoRM b m, BackendMetadata b) =&gt;
SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; RoleName
-&gt; StreamingSubscriptionsCtx
-&gt; SelPerm b
-&gt; m (WithDeps (SelPermInfo b))
</span><a href="Hasura.RQL.DDL.Permission.html#buildSelPermInfo"><span class="hs-identifier hs-var">buildSelPermInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461779"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461778"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461777"><span class="hs-identifier hs-var">x3</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461776"><span class="hs-identifier hs-var">roleName</span></a></span><span> </span><span class="annot"><span class="annottext">StreamingSubscriptionsCtx
</span><a href="#local-6989586621689461775"><span class="hs-identifier hs-var">streamingSubscriptionsCtx</span></a></span><span> </span><span class="annot"><span class="annottext">SelPerm b
</span><a href="#local-6989586621689461774"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-226"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#InsPerm%27"><span class="hs-identifier hs-type">InsPerm'</span></a></span><span> </span><span id="local-6989586621689461773"><span class="annot"><span class="annottext">InsPerm b
</span><a href="#local-6989586621689461773"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; InsPerm b
-&gt; m (WithDeps (InsPermInfo b))
forall (b :: BackendType) (m :: * -&gt; *).
(QErrM m, TableCoreInfoRM b m, BackendMetadata b) =&gt;
SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; InsPerm b
-&gt; m (WithDeps (InsPermInfo b))
</span><a href="Hasura.RQL.DDL.Permission.html#buildInsPermInfo"><span class="hs-identifier hs-var">buildInsPermInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461779"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461778"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461777"><span class="hs-identifier hs-var">x3</span></a></span><span> </span><span class="annot"><span class="annottext">InsPerm b
</span><a href="#local-6989586621689461773"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-227"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#UpdPerm%27"><span class="hs-identifier hs-type">UpdPerm'</span></a></span><span> </span><span id="local-6989586621689461772"><span class="annot"><span class="annottext">UpdPerm b
</span><a href="#local-6989586621689461772"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; UpdPerm b
-&gt; m (WithDeps (UpdPermInfo b))
forall (b :: BackendType) (m :: * -&gt; *).
(QErrM m, TableCoreInfoRM b m, BackendMetadata b) =&gt;
SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; UpdPerm b
-&gt; m (WithDeps (UpdPermInfo b))
</span><a href="Hasura.RQL.DDL.Permission.html#buildUpdPermInfo"><span class="hs-identifier hs-var">buildUpdPermInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461779"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461778"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461777"><span class="hs-identifier hs-var">x3</span></a></span><span> </span><span class="annot"><span class="annottext">UpdPerm b
</span><a href="#local-6989586621689461772"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-228"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#DelPerm%27"><span class="hs-identifier hs-type">DelPerm'</span></a></span><span> </span><span id="local-6989586621689461771"><span class="annot"><span class="annottext">DelPerm b
</span><a href="#local-6989586621689461771"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; DelPerm b
-&gt; m (WithDeps (DelPermInfo b))
forall (b :: BackendType) (m :: * -&gt; *).
(QErrM m, TableCoreInfoRM b m, BackendMetadata b) =&gt;
SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; DelPerm b
-&gt; m (WithDeps (DelPermInfo b))
</span><a href="Hasura.RQL.DDL.Permission.html#buildDelPermInfo"><span class="hs-identifier hs-var">buildDelPermInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461779"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461778"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461777"><span class="hs-identifier hs-var">x3</span></a></span><span> </span><span class="annot"><span class="annottext">DelPerm b
</span><a href="#local-6989586621689461771"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#doesPermissionExistInMetadata"><span class="hs-identifier hs-type">doesPermissionExistInMetadata</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689462009"><span class="annot"><a href="#local-6989586621689462009"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-232"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#TableMetadata"><span class="hs-identifier hs-type">TableMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462009"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-233"></span><span>  </span><span class="annot"><a href="Hasura.Session.html#RoleName"><span class="hs-identifier hs-type">RoleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-234"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#PermType"><span class="hs-identifier hs-type">PermType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-235"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-236"></span><span id="doesPermissionExistInMetadata"><span class="annot"><span class="annottext">doesPermissionExistInMetadata :: TableMetadata b -&gt; RoleName -&gt; PermType -&gt; Bool
</span><a href="Hasura.RQL.DDL.Permission.html#doesPermissionExistInMetadata"><span class="hs-identifier hs-var hs-var">doesPermissionExistInMetadata</span></a></span></span><span> </span><span id="local-6989586621689461769"><span class="annot"><span class="annottext">TableMetadata b
</span><a href="#local-6989586621689461769"><span class="hs-identifier hs-var">tableMetadata</span></a></span></span><span> </span><span id="local-6989586621689461768"><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461768"><span class="hs-identifier hs-var">roleName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-237"></span><span>  </span><span class="annot"><span class="annottext">PermType
</span><a href="Hasura.RQL.Types.Permission.html#PTInsert"><span class="hs-identifier hs-var">PTInsert</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Lens' (TableMetadata b) (Permissions (InsPermDef b)) -&gt; Bool
forall a. Lens' (TableMetadata b) (Permissions a) -&gt; Bool
</span><a href="#local-6989586621689461766"><span class="hs-identifier hs-var">hasPermissionTo</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
Lens' (TableMetadata b) (Permissions (InsPermDef b))
Lens' (TableMetadata b) (Permissions (InsPermDef b))
</span><a href="Hasura.RQL.Types.Metadata.Common.html#tmInsertPermissions"><span class="hs-identifier hs-var">tmInsertPermissions</span></a></span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><span class="annottext">PermType
</span><a href="Hasura.RQL.Types.Permission.html#PTSelect"><span class="hs-identifier hs-var">PTSelect</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Lens' (TableMetadata b) (Permissions (SelPermDef b)) -&gt; Bool
forall a. Lens' (TableMetadata b) (Permissions a) -&gt; Bool
</span><a href="#local-6989586621689461766"><span class="hs-identifier hs-var">hasPermissionTo</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
Lens' (TableMetadata b) (Permissions (SelPermDef b))
Lens' (TableMetadata b) (Permissions (SelPermDef b))
</span><a href="Hasura.RQL.Types.Metadata.Common.html#tmSelectPermissions"><span class="hs-identifier hs-var">tmSelectPermissions</span></a></span><span>
</span><span id="line-239"></span><span>  </span><span class="annot"><span class="annottext">PermType
</span><a href="Hasura.RQL.Types.Permission.html#PTUpdate"><span class="hs-identifier hs-var">PTUpdate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Lens' (TableMetadata b) (Permissions (UpdPermDef b)) -&gt; Bool
forall a. Lens' (TableMetadata b) (Permissions a) -&gt; Bool
</span><a href="#local-6989586621689461766"><span class="hs-identifier hs-var">hasPermissionTo</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
Lens' (TableMetadata b) (Permissions (UpdPermDef b))
Lens' (TableMetadata b) (Permissions (UpdPermDef b))
</span><a href="Hasura.RQL.Types.Metadata.Common.html#tmUpdatePermissions"><span class="hs-identifier hs-var">tmUpdatePermissions</span></a></span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><span class="annottext">PermType
</span><a href="Hasura.RQL.Types.Permission.html#PTDelete"><span class="hs-identifier hs-var">PTDelete</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Lens' (TableMetadata b) (Permissions (DelPermDef b)) -&gt; Bool
forall a. Lens' (TableMetadata b) (Permissions a) -&gt; Bool
</span><a href="#local-6989586621689461766"><span class="hs-identifier hs-var">hasPermissionTo</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
Lens' (TableMetadata b) (Permissions (DelPermDef b))
Lens' (TableMetadata b) (Permissions (DelPermDef b))
</span><a href="Hasura.RQL.Types.Metadata.Common.html#tmDeletePermissions"><span class="hs-identifier hs-var">tmDeletePermissions</span></a></span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><a href="#local-6989586621689461766"><span class="hs-identifier hs-type">hasPermissionTo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689462042"><span class="annot"><a href="#local-6989586621689462042"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#TableMetadata"><span class="hs-identifier hs-type">TableMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462009"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#Permissions"><span class="hs-identifier hs-type">Permissions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462042"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-243"></span><span>    </span><span id="local-6989586621689461766"><span class="annot"><span class="annottext">hasPermissionTo :: Lens' (TableMetadata b) (Permissions a) -&gt; Bool
</span><a href="#local-6989586621689461766"><span class="hs-identifier hs-var hs-var">hasPermissionTo</span></a></span></span><span> </span><span id="local-6989586621689461762"><span class="annot"><span class="annottext">Lens' (TableMetadata b) (Permissions a)
</span><a href="#local-6989586621689461762"><span class="hs-identifier hs-var">perms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe a -&gt; Bool) -&gt; Maybe a -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TableMetadata b
</span><a href="#local-6989586621689461769"><span class="hs-identifier hs-var">tableMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">TableMetadata b -&gt; Getting (First a) (TableMetadata b) a -&gt; Maybe a
forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">(Permissions a -&gt; Const (First a) (Permissions a))
-&gt; TableMetadata b -&gt; Const (First a) (TableMetadata b)
Lens' (TableMetadata b) (Permissions a)
</span><a href="#local-6989586621689461762"><span class="hs-identifier hs-var">perms</span></a></span><span> </span><span class="annot"><span class="annottext">((Permissions a -&gt; Const (First a) (Permissions a))
 -&gt; TableMetadata b -&gt; Const (First a) (TableMetadata b))
-&gt; ((a -&gt; Const (First a) a)
    -&gt; Permissions a -&gt; Const (First a) (Permissions a))
-&gt; Getting (First a) (TableMetadata b) a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Index (Permissions a)
-&gt; Traversal' (Permissions a) (IxValue (Permissions a))
forall m. Ixed m =&gt; Index m -&gt; Traversal' m (IxValue m)
</span><span class="hs-identifier hs-var">ix</span></span><span> </span><span class="annot"><span class="annottext">Index (Permissions a)
RoleName
</span><a href="#local-6989586621689461768"><span class="hs-identifier hs-var">roleName</span></a></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#runCreatePerm"><span class="hs-identifier hs-type">runCreatePerm</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689461759"><span class="annot"><a href="#local-6989586621689461759"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621689461758"><span class="annot"><a href="#local-6989586621689461758"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621689461757"><span class="annot"><a href="#local-6989586621689461757"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Session.html#UserInfoM"><span class="hs-identifier hs-type">UserInfoM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461759"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461759"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461759"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461759"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461758"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-248"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Permission.Internal.html#CreatePerm"><span class="hs-identifier hs-type">CreatePerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461757"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461758"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-249"></span><span>  </span><span class="annot"><a href="#local-6989586621689461759"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span>
</span><span id="line-250"></span><span id="runCreatePerm"><span class="annot"><span class="annottext">runCreatePerm :: CreatePerm a b -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Permission.html#runCreatePerm"><span class="hs-identifier hs-var hs-var">runCreatePerm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Permission.Internal.html#CreatePerm"><span class="hs-identifier hs-type">CreatePerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Relationships.Local.html#WithTable"><span class="hs-identifier hs-type">WithTable</span></a></span><span> </span><span id="local-6989586621689461753"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461753"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621689461752"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461752"><span class="hs-identifier hs-var">tableName</span></a></span></span><span> </span><span id="local-6989586621689461751"><span class="annot"><span class="annottext">PermDef b a
</span><a href="#local-6989586621689461751"><span class="hs-identifier hs-var">permissionDefn</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-251"></span><span>  </span><span id="local-6989586621689461750"><span class="annot"><span class="annottext">TableMetadata b
</span><a href="#local-6989586621689461750"><span class="hs-identifier hs-var">tableMetadata</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; TableName b -&gt; m (TableMetadata b)
forall (b :: BackendType) (m :: * -&gt; *).
(QErrM m, MetadataM m, Backend b) =&gt;
SourceName -&gt; TableName b -&gt; m (TableMetadata b)
</span><a href="Hasura.RQL.Types.SchemaCache.html#askTableMetadata"><span class="hs-identifier hs-var">askTableMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689461758"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461753"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461752"><span class="hs-identifier hs-var">tableName</span></a></span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689461748"><span class="annot"><span class="annottext">permissionType :: PermType
</span><a href="#local-6989586621689461748"><span class="hs-identifier hs-var hs-var">permissionType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PermDefPermission b a -&gt; PermType
forall (b :: BackendType) (a :: BackendType -&gt; *).
PermDefPermission b a -&gt; PermType
</span><a href="Hasura.RQL.Types.Permission.html#reflectPermDefPermission"><span class="hs-identifier hs-var">reflectPermDefPermission</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PermDef b a -&gt; PermDefPermission b a
forall (b :: BackendType) (perm :: BackendType -&gt; *).
PermDef b perm -&gt; PermDefPermission b perm
</span><a href="Hasura.RQL.Types.Permission.html#_pdPermission"><span class="hs-identifier hs-var hs-var">_pdPermission</span></a></span><span> </span><span class="annot"><span class="annottext">PermDef b a
</span><a href="#local-6989586621689461751"><span class="hs-identifier hs-var">permissionDefn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>      </span><span id="local-6989586621689461746"><span class="annot"><span class="annottext">ptText :: Text
</span><a href="#local-6989586621689461746"><span class="hs-identifier hs-var hs-var">ptText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PermType -&gt; Text
</span><a href="Hasura.RQL.Types.Permission.html#permTypeToCode"><span class="hs-identifier hs-var">permTypeToCode</span></a></span><span> </span><span class="annot"><span class="annottext">PermType
</span><a href="#local-6989586621689461748"><span class="hs-identifier hs-var">permissionType</span></a></span><span>
</span><span id="line-254"></span><span>      </span><span id="local-6989586621689461744"><span class="annot"><span class="annottext">role :: RoleName
</span><a href="#local-6989586621689461744"><span class="hs-keyword hs-var hs-var">role</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PermDef b a -&gt; RoleName
forall (b :: BackendType) (perm :: BackendType -&gt; *).
PermDef b perm -&gt; RoleName
</span><a href="Hasura.RQL.Types.Permission.html#_pdRole"><span class="hs-identifier hs-var hs-var">_pdRole</span></a></span><span> </span><span class="annot"><span class="annottext">PermDef b a
</span><a href="#local-6989586621689461751"><span class="hs-identifier hs-var">permissionDefn</span></a></span><span>
</span><span id="line-255"></span><span>      </span><span id="local-6989586621689461743"><span class="annot"><span class="annottext">metadataObject :: MetadataObjId
</span><a href="#local-6989586621689461743"><span class="hs-identifier hs-var hs-var">metadataObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-256"></span><span>        </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceMetadataObjId -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOSourceObjId"><span class="hs-identifier hs-var">MOSourceObjId</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461753"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">(AnyBackend SourceMetadataObjId -&gt; MetadataObjId)
-&gt; AnyBackend SourceMetadataObjId -&gt; MetadataObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-257"></span><span>          </span><span class="annot"><span class="annottext">SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span> </span><span class="annot"><span class="annottext">(SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId)
-&gt; SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-258"></span><span>            </span><span class="annot"><span class="annottext">TableName b -&gt; TableMetadataObjId -&gt; SourceMetadataObjId b
forall (b :: BackendType).
TableName b -&gt; TableMetadataObjId -&gt; SourceMetadataObjId b
</span><a href="Hasura.RQL.Types.Metadata.Object.html#SMOTableObj"><span class="hs-identifier hs-var">SMOTableObj</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689461758"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461752"><span class="hs-identifier hs-var">tableName</span></a></span><span> </span><span class="annot"><span class="annottext">(TableMetadataObjId -&gt; SourceMetadataObjId b)
-&gt; TableMetadataObjId -&gt; SourceMetadataObjId b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-259"></span><span>              </span><span class="annot"><span class="annottext">RoleName -&gt; PermType -&gt; TableMetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MTOPerm"><span class="hs-identifier hs-var">MTOPerm</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461744"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">PermType
</span><a href="#local-6989586621689461748"><span class="hs-identifier hs-var">permissionType</span></a></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-comment">-- NOTE: we check if a permission exists for a `(table, role)` entity in the metadata</span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-comment">-- and not in the `RolePermInfoMap b` because there may exist a permission for the `role`</span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-comment">-- which is an inherited one, so we check it in the metadata directly</span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-comment">-- The metadata will not contain the permissions for the admin role,</span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-comment">-- because the graphql-engine automatically creates the role and it's</span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-comment">-- assumed that the admin role is an implicit role of the graphql-engine.</span><span>
</span><span id="line-268"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableMetadata b -&gt; RoleName -&gt; PermType -&gt; Bool
forall (b :: BackendType).
TableMetadata b -&gt; RoleName -&gt; PermType -&gt; Bool
</span><a href="Hasura.RQL.DDL.Permission.html#doesPermissionExistInMetadata"><span class="hs-identifier hs-var">doesPermissionExistInMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">TableMetadata b
</span><a href="#local-6989586621689461750"><span class="hs-identifier hs-var">tableMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461744"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">PermType
</span><a href="#local-6989586621689461748"><span class="hs-identifier hs-var">permissionType</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461744"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName -&gt; RoleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="Hasura.Session.html#adminRoleName"><span class="hs-identifier hs-var">adminRoleName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-269"></span><span>    </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#AlreadyExists"><span class="hs-identifier hs-var">AlreadyExists</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-270"></span><span>      </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689461746"><span class="hs-identifier hs-var">ptText</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; permission already defined on table &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461752"><span class="hs-identifier hs-var">tableName</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; with role &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; RoleName -&gt; Text
forall t. ToTxt t =&gt; Text -&gt; t -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3E%3E"><span class="hs-operator hs-var">&lt;&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461744"><span class="hs-keyword hs-var">role</span></a></span><span>
</span><span id="line-271"></span><span>  </span><span class="annot"><span class="annottext">MetadataObjId -&gt; MetadataModifier -&gt; m ()
forall (m :: * -&gt; *).
(QErrM m, CacheRWM m, MetadataM m) =&gt;
MetadataObjId -&gt; MetadataModifier -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCacheFor"><span class="hs-identifier hs-var">buildSchemaCacheFor</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObjId
</span><a href="#local-6989586621689461743"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataModifier -&gt; m ()) -&gt; MetadataModifier -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-272"></span><span>    </span><span class="annot"><span class="annottext">(Metadata -&gt; Metadata) -&gt; MetadataModifier
</span><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-var">MetadataModifier</span></a></span><span> </span><span class="annot"><span class="annottext">((Metadata -&gt; Metadata) -&gt; MetadataModifier)
-&gt; (Metadata -&gt; Metadata) -&gt; MetadataModifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-273"></span><span>      </span><span class="annot"><span class="annottext">SourceName -&gt; TableName b -&gt; ASetter' Metadata (TableMetadata b)
forall (b :: BackendType).
Backend b =&gt;
SourceName -&gt; TableName b -&gt; ASetter' Metadata (TableMetadata b)
</span><a href="Hasura.RQL.Types.Metadata.html#tableMetadataSetter"><span class="hs-identifier hs-var">tableMetadataSetter</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689461758"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461753"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461752"><span class="hs-identifier hs-var">tableName</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter' Metadata (TableMetadata b)
-&gt; (TableMetadata b -&gt; TableMetadata b) -&gt; Metadata -&gt; Metadata
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">PermDef b a -&gt; TableMetadata b -&gt; TableMetadata b
forall (b :: BackendType) (a :: BackendType -&gt; *).
PermDef b a -&gt; TableMetadata b -&gt; TableMetadata b
</span><a href="Hasura.RQL.DDL.Permission.html#addPermissionToMetadata"><span class="hs-identifier hs-var">addPermissionToMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">PermDef b a
</span><a href="#local-6989586621689461751"><span class="hs-identifier hs-var">permissionDefn</span></a></span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><span class="annottext">EncJSON -&gt; m EncJSON
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="Hasura.RQL.Types.Common.html#successMsg"><span class="hs-identifier hs-var">successMsg</span></a></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#runDropPerm"><span class="hs-identifier hs-type">runDropPerm</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689461729"><span class="annot"><a href="#local-6989586621689461729"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621689461728"><span class="annot"><a href="#local-6989586621689461728"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Session.html#UserInfoM"><span class="hs-identifier hs-type">UserInfoM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461728"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461728"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461728"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461728"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461729"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-279"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#PermType"><span class="hs-identifier hs-type">PermType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-280"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Permission.Internal.html#DropPerm"><span class="hs-identifier hs-type">DropPerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461729"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-281"></span><span>  </span><span class="annot"><a href="#local-6989586621689461728"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span>
</span><span id="line-282"></span><span id="runDropPerm"><span class="annot"><span class="annottext">runDropPerm :: PermType -&gt; DropPerm b -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Permission.html#runDropPerm"><span class="hs-identifier hs-var hs-var">runDropPerm</span></a></span></span><span> </span><span id="local-6989586621689461727"><span class="annot"><span class="annottext">PermType
</span><a href="#local-6989586621689461727"><span class="hs-identifier hs-var">permType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Permission.Internal.html#DropPerm"><span class="hs-identifier hs-type">DropPerm</span></a></span><span> </span><span id="local-6989586621689461725"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461725"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621689461724"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461724"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span id="local-6989586621689461723"><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461723"><span class="hs-keyword hs-var">role</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-283"></span><span>  </span><span id="local-6989586621689461722"><span class="annot"><span class="annottext">TableMetadata b
</span><a href="#local-6989586621689461722"><span class="hs-identifier hs-var">tableMetadata</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; TableName b -&gt; m (TableMetadata b)
forall (b :: BackendType) (m :: * -&gt; *).
(QErrM m, MetadataM m, Backend b) =&gt;
SourceName -&gt; TableName b -&gt; m (TableMetadata b)
</span><a href="Hasura.RQL.Types.SchemaCache.html#askTableMetadata"><span class="hs-identifier hs-var">askTableMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689461729"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461725"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461724"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-284"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableMetadata b -&gt; RoleName -&gt; PermType -&gt; Bool
forall (b :: BackendType).
TableMetadata b -&gt; RoleName -&gt; PermType -&gt; Bool
</span><a href="Hasura.RQL.DDL.Permission.html#doesPermissionExistInMetadata"><span class="hs-identifier hs-var">doesPermissionExistInMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">TableMetadata b
</span><a href="#local-6989586621689461722"><span class="hs-identifier hs-var">tableMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461723"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">PermType
</span><a href="#local-6989586621689461727"><span class="hs-identifier hs-var">permType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689461720"><span class="annot"><span class="annottext">errMsg :: Text
</span><a href="#local-6989586621689461720"><span class="hs-identifier hs-var hs-var">errMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PermType -&gt; Text
</span><a href="Hasura.RQL.Types.Permission.html#permTypeToCode"><span class="hs-identifier hs-var">permTypeToCode</span></a></span><span> </span><span class="annot"><span class="annottext">PermType
</span><a href="#local-6989586621689461727"><span class="hs-identifier hs-var">permType</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; permission on &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461724"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; for role &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461723"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; does not exist&quot;</span></span><span>
</span><span id="line-286"></span><span>    </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#PermissionDenied"><span class="hs-identifier hs-var">PermissionDenied</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689461720"><span class="hs-identifier hs-var">errMsg</span></a></span><span>
</span><span id="line-287"></span><span>  </span><span class="annot"><span class="annottext">m () -&gt; m ()
forall (m :: * -&gt; *) a. (QErrM m, CacheRM m) =&gt; m a -&gt; m a
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withNewInconsistentObjsCheck"><span class="hs-identifier hs-var">withNewInconsistentObjsCheck</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-288"></span><span>    </span><span class="annot"><span class="annottext">MetadataModifier -&gt; m ()
forall (m :: * -&gt; *).
(MetadataM m, CacheRWM m) =&gt;
MetadataModifier -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCache"><span class="hs-identifier hs-var">buildSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataModifier -&gt; m ()) -&gt; MetadataModifier -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-289"></span><span>      </span><span class="annot"><span class="annottext">(Metadata -&gt; Metadata) -&gt; MetadataModifier
</span><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-var">MetadataModifier</span></a></span><span> </span><span class="annot"><span class="annottext">((Metadata -&gt; Metadata) -&gt; MetadataModifier)
-&gt; (Metadata -&gt; Metadata) -&gt; MetadataModifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-290"></span><span>        </span><span class="annot"><span class="annottext">SourceName -&gt; TableName b -&gt; ASetter' Metadata (TableMetadata b)
forall (b :: BackendType).
Backend b =&gt;
SourceName -&gt; TableName b -&gt; ASetter' Metadata (TableMetadata b)
</span><a href="Hasura.RQL.Types.Metadata.html#tableMetadataSetter"><span class="hs-identifier hs-var">tableMetadataSetter</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689461729"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461725"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461724"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter' Metadata (TableMetadata b)
-&gt; (TableMetadata b -&gt; TableMetadata b) -&gt; Metadata -&gt; Metadata
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">RoleName -&gt; PermType -&gt; TableMetadata b -&gt; TableMetadata b
forall (b :: BackendType).
RoleName -&gt; PermType -&gt; TableMetadata b -&gt; TableMetadata b
</span><a href="Hasura.RQL.Types.Metadata.html#dropPermissionInMetadata"><span class="hs-identifier hs-var">dropPermissionInMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461723"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">PermType
</span><a href="#local-6989586621689461727"><span class="hs-identifier hs-var">permType</span></a></span><span>
</span><span id="line-291"></span><span>  </span><span class="annot"><span class="annottext">EncJSON -&gt; m EncJSON
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="Hasura.RQL.Types.Common.html#successMsg"><span class="hs-identifier hs-var">successMsg</span></a></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#buildInsPermInfo"><span class="hs-identifier hs-type">buildInsPermInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689462051"><span class="annot"><a href="#local-6989586621689462051"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621689462052"><span class="annot"><a href="#local-6989586621689462052"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462052"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#TableCoreInfoRM"><span class="hs-identifier hs-type">TableCoreInfoRM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462051"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462052"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462051"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-296"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-297"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462051"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-298"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Table.html#FieldInfoMap"><span class="hs-identifier hs-type">FieldInfoMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Table.html#FieldInfo"><span class="hs-identifier hs-type">FieldInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462051"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-299"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#InsPerm"><span class="hs-identifier hs-type">InsPerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462051"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-300"></span><span>  </span><span class="annot"><a href="#local-6989586621689462052"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#WithDeps"><span class="hs-identifier hs-type">WithDeps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Table.html#InsPermInfo"><span class="hs-identifier hs-type">InsPermInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462051"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span id="buildInsPermInfo"><span class="annot"><span class="annottext">buildInsPermInfo :: SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; InsPerm b
-&gt; m (WithDeps (InsPermInfo b))
</span><a href="Hasura.RQL.DDL.Permission.html#buildInsPermInfo"><span class="hs-identifier hs-var hs-var">buildInsPermInfo</span></a></span></span><span> </span><span id="local-6989586621689461716"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461716"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621689461715"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461715"><span class="hs-identifier hs-var">tn</span></a></span></span><span> </span><span id="local-6989586621689461714"><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461714"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#InsPerm"><span class="hs-identifier hs-type">InsPerm</span></a></span><span> </span><span id="local-6989586621689461712"><span class="annot"><span class="annottext">BoolExp b
</span><a href="#local-6989586621689461712"><span class="hs-identifier hs-var">checkCond</span></a></span></span><span> </span><span id="local-6989586621689461711"><span class="annot"><span class="annottext">Maybe (ColumnValues b Value)
</span><a href="#local-6989586621689461711"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span id="local-6989586621689461710"><span class="annot"><span class="annottext">Maybe (PermColSpec b)
</span><a href="#local-6989586621689461710"><span class="hs-identifier hs-var">mCols</span></a></span></span><span> </span><span id="local-6989586621689461709"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689461709"><span class="hs-identifier hs-var">backendOnly</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-302"></span><span>  </span><span class="annot"><span class="annottext">Text
-&gt; m (WithDeps (InsPermInfo b)) -&gt; m (WithDeps (InsPermInfo b))
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#withPathK"><span class="hs-identifier hs-var">withPathK</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;permission&quot;</span></span><span> </span><span class="annot"><span class="annottext">(m (WithDeps (InsPermInfo b)) -&gt; m (WithDeps (InsPermInfo b)))
-&gt; m (WithDeps (InsPermInfo b)) -&gt; m (WithDeps (InsPermInfo b))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-303"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621689461708"><span class="annot"><span class="annottext">AnnBoolExpPartialSQL b
</span><a href="#local-6989586621689461708"><span class="hs-identifier hs-var">be</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689461707"><span class="annot"><span class="annottext">[SchemaDependency]
</span><a href="#local-6989586621689461707"><span class="hs-identifier hs-var">beDeps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#withPathK"><span class="hs-identifier hs-var">withPathK</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;check&quot;</span></span><span> </span><span class="annot"><span class="annottext">(m (AnnBoolExpPartialSQL b, [SchemaDependency])
 -&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency]))
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; BoolExp b
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
forall (m :: * -&gt; *) (b :: BackendType).
(QErrM m, TableCoreInfoRM b m, BackendMetadata b) =&gt;
SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; BoolExp b
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
</span><a href="Hasura.RQL.DDL.Permission.Internal.html#procBoolExp"><span class="hs-identifier hs-var">procBoolExp</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461716"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461715"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461714"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp b
</span><a href="#local-6989586621689461712"><span class="hs-identifier hs-var">checkCond</span></a></span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621689461705"><span class="annot"><span class="annottext">HashMap (Column b) (PartialSQLExp b)
</span><a href="#local-6989586621689461705"><span class="hs-identifier hs-var">setColsSQL</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689461704"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621689461704"><span class="hs-identifier hs-var">setHdrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689461703"><span class="annot"><span class="annottext">[SchemaDependency]
</span><a href="#local-6989586621689461703"><span class="hs-identifier hs-var">setColDeps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; Maybe (ColumnValues b Value)
-&gt; m (HashMap (Column b) (PartialSQLExp b), [Text],
      [SchemaDependency])
forall (b :: BackendType) (m :: * -&gt; *).
(QErrM m, BackendMetadata b) =&gt;
SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; Maybe (ColumnValues b Value)
-&gt; m (PreSetColsPartial b, [Text], [SchemaDependency])
</span><a href="Hasura.RQL.DDL.Permission.html#procSetObj"><span class="hs-identifier hs-var">procSetObj</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461716"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461715"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461714"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ColumnValues b Value)
</span><a href="#local-6989586621689461711"><span class="hs-identifier hs-var">set</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span class="annot"><span class="annottext">m [()] -&gt; m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(m [()] -&gt; m ()) -&gt; m [()] -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-306"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; m [()] -&gt; m [()]
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#withPathK"><span class="hs-identifier hs-var">withPathK</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;columns&quot;</span></span><span> </span><span class="annot"><span class="annottext">(m [()] -&gt; m [()]) -&gt; m [()] -&gt; m [()]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-307"></span><span>        </span><span class="annot"><span class="annottext">[Column b] -&gt; (Column b -&gt; m ()) -&gt; m [()]
forall (m :: * -&gt; *) a b. QErrM m =&gt; [a] -&gt; (a -&gt; m b) -&gt; m [b]
</span><a href="Hasura.Base.Error.html#indexedForM"><span class="hs-identifier hs-var">indexedForM</span></a></span><span> </span><span class="annot"><span class="annottext">[Column b]
</span><a href="#local-6989586621689461700"><span class="hs-identifier hs-var">insCols</span></a></span><span> </span><span class="annot"><span class="annottext">((Column b -&gt; m ()) -&gt; m [()]) -&gt; (Column b -&gt; m ()) -&gt; m [()]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689461699"><span class="annot"><span class="annottext">Column b
</span><a href="#local-6989586621689461699"><span class="hs-identifier hs-var">col</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-308"></span><span>          </span><span class="hs-comment">-- Check that all columns specified do in fact exist and are columns</span><span>
</span><span id="line-309"></span><span>          </span><span class="annot"><span class="annottext">ColumnType b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b) -&gt; Column b -&gt; Text -&gt; m (ColumnType b)
forall (m :: * -&gt; *) (backend :: BackendType).
(MonadError QErr m, Backend backend) =&gt;
FieldInfoMap (FieldInfo backend)
-&gt; Column backend -&gt; Text -&gt; m (ColumnType backend)
</span><a href="Hasura.RQL.Types.Table.html#askColumnType"><span class="hs-identifier hs-var">askColumnType</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461714"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">Column b
</span><a href="#local-6989586621689461699"><span class="hs-identifier hs-var">col</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689461698"><span class="hs-identifier hs-var">relInInsErr</span></a></span><span>
</span><span id="line-310"></span><span>          </span><span class="hs-comment">-- Check that the column is insertable</span><span>
</span><span id="line-311"></span><span>          </span><span id="local-6989586621689461697"><span class="annot"><span class="annottext">ColumnInfo b
</span><a href="#local-6989586621689461697"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b) -&gt; Column b -&gt; Text -&gt; m (ColumnInfo b)
forall (m :: * -&gt; *) (backend :: BackendType).
(MonadError QErr m, Backend backend) =&gt;
FieldInfoMap (FieldInfo backend)
-&gt; Column backend -&gt; Text -&gt; m (ColumnInfo backend)
</span><a href="Hasura.RQL.Types.Table.html#askColInfo"><span class="hs-identifier hs-var">askColInfo</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461714"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">Column b
</span><a href="#local-6989586621689461699"><span class="hs-identifier hs-var">col</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-312"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ColumnMutability -&gt; Bool
</span><a href="Hasura.RQL.Types.Column.html#_cmIsInsertable"><span class="hs-identifier hs-var hs-var">_cmIsInsertable</span></a></span><span> </span><span class="annot"><span class="annottext">(ColumnMutability -&gt; Bool) -&gt; ColumnMutability -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b -&gt; ColumnMutability
forall (b :: BackendType). ColumnInfo b -&gt; ColumnMutability
</span><a href="Hasura.RQL.Types.Column.html#ciMutability"><span class="hs-identifier hs-var hs-var">ciMutability</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b
</span><a href="#local-6989586621689461697"><span class="hs-identifier hs-var">ci</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-313"></span><span>            </span><span class="annot"><span class="annottext">Text -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw500"><span class="hs-identifier hs-var">throw500</span></a></span><span>
</span><span id="line-314"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Column &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Column b
</span><a href="#local-6989586621689461699"><span class="hs-identifier hs-var">col</span></a></span><span>
</span><span id="line-315"></span><span>                  </span><span class="annot"><span class="annottext">Column b -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; is not insertable and so cannot have insert permissions defined&quot;</span></span><span>
</span><span id="line-316"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689461692"><span class="annot"><span class="annottext">fltrHeaders :: HashSet Text
</span><a href="#local-6989586621689461692"><span class="hs-identifier hs-var hs-var">fltrHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BoolExp b -&gt; HashSet Text
forall (b :: BackendType). BoolExp b -&gt; HashSet Text
</span><a href="Hasura.RQL.DDL.Permission.Internal.html#getDependentHeaders"><span class="hs-identifier hs-var">getDependentHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp b
</span><a href="#local-6989586621689461712"><span class="hs-identifier hs-var">checkCond</span></a></span><span>
</span><span id="line-319"></span><span>        </span><span id="local-6989586621689461690"><span class="annot"><span class="annottext">reqHdrs :: HashSet Text
</span><a href="#local-6989586621689461690"><span class="hs-identifier hs-var hs-var">reqHdrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet Text
</span><a href="#local-6989586621689461692"><span class="hs-identifier hs-var">fltrHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet Text -&gt; HashSet Text -&gt; HashSet Text
forall a. (Eq a, Hashable a) =&gt; HashSet a -&gt; HashSet a -&gt; HashSet a
</span><span class="hs-operator hs-var">`HS.union`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; HashSet Text
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><span class="hs-identifier hs-var">HS.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621689461704"><span class="hs-identifier hs-var">setHdrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>        </span><span id="local-6989586621689461687"><span class="annot"><span class="annottext">insColDeps :: [SchemaDependency]
</span><a href="#local-6989586621689461687"><span class="hs-identifier hs-var hs-var">insColDeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Column b -&gt; SchemaDependency) -&gt; [Column b] -&gt; [SchemaDependency]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DependencyReason
-&gt; SourceName -&gt; TableName b -&gt; Column b -&gt; SchemaDependency
forall (b :: BackendType).
Backend b =&gt;
DependencyReason
-&gt; SourceName -&gt; TableName b -&gt; Column b -&gt; SchemaDependency
</span><a href="Hasura.RQL.Types.SchemaCache.html#mkColDep"><span class="hs-identifier hs-var">mkColDep</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689462051"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">DependencyReason
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#DRUntyped"><span class="hs-identifier hs-var">DRUntyped</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461716"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461715"><span class="hs-identifier hs-var">tn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Column b]
</span><a href="#local-6989586621689461700"><span class="hs-identifier hs-var">insCols</span></a></span><span>
</span><span id="line-321"></span><span>        </span><span id="local-6989586621689461685"><span class="annot"><span class="annottext">deps :: [SchemaDependency]
</span><a href="#local-6989586621689461685"><span class="hs-identifier hs-var hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; TableName b -&gt; SchemaDependency
forall (b :: BackendType).
Backend b =&gt;
SourceName -&gt; TableName b -&gt; SchemaDependency
</span><a href="Hasura.RQL.Types.SchemaCache.html#mkParentDep"><span class="hs-identifier hs-var">mkParentDep</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689462051"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461716"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461715"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaDependency -&gt; [SchemaDependency] -&gt; [SchemaDependency]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[SchemaDependency]
</span><a href="#local-6989586621689461707"><span class="hs-identifier hs-var">beDeps</span></a></span><span> </span><span class="annot"><span class="annottext">[SchemaDependency] -&gt; [SchemaDependency] -&gt; [SchemaDependency]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[SchemaDependency]
</span><a href="#local-6989586621689461703"><span class="hs-identifier hs-var">setColDeps</span></a></span><span> </span><span class="annot"><span class="annottext">[SchemaDependency] -&gt; [SchemaDependency] -&gt; [SchemaDependency]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[SchemaDependency]
</span><a href="#local-6989586621689461687"><span class="hs-identifier hs-var">insColDeps</span></a></span><span>
</span><span id="line-322"></span><span>        </span><span id="local-6989586621689461683"><span class="annot"><span class="annottext">insColsWithoutPresets :: [Column b]
</span><a href="#local-6989586621689461683"><span class="hs-identifier hs-var hs-var">insColsWithoutPresets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Column b]
</span><a href="#local-6989586621689461700"><span class="hs-identifier hs-var">insCols</span></a></span><span> </span><span class="annot"><span class="annottext">[Column b] -&gt; [Column b] -&gt; [Column b]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">\\</span></span><span> </span><span class="annot"><span class="annottext">HashMap (Column b) (PartialSQLExp b) -&gt; [Column b]
forall k v. HashMap k v -&gt; [k]
</span><span class="hs-identifier hs-var">HM.keys</span></span><span> </span><span class="annot"><span class="annottext">HashMap (Column b) (PartialSQLExp b)
</span><a href="#local-6989586621689461705"><span class="hs-identifier hs-var">setColsSQL</span></a></span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span>    </span><span class="annot"><span class="annottext">WithDeps (InsPermInfo b) -&gt; m (WithDeps (InsPermInfo b))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashSet (Column b)
-&gt; AnnBoolExpPartialSQL b
-&gt; HashMap (Column b) (PartialSQLExp b)
-&gt; Bool
-&gt; HashSet Text
-&gt; InsPermInfo b
forall (b :: BackendType).
HashSet (Column b)
-&gt; AnnBoolExpPartialSQL b
-&gt; PreSetColsPartial b
-&gt; Bool
-&gt; HashSet Text
-&gt; InsPermInfo b
</span><a href="Hasura.RQL.Types.Table.html#InsPermInfo"><span class="hs-identifier hs-var">InsPermInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Column b] -&gt; HashSet (Column b)
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><span class="hs-identifier hs-var">HS.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Column b]
</span><a href="#local-6989586621689461683"><span class="hs-identifier hs-var">insColsWithoutPresets</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AnnBoolExpPartialSQL b
</span><a href="#local-6989586621689461708"><span class="hs-identifier hs-var">be</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Column b) (PartialSQLExp b)
</span><a href="#local-6989586621689461705"><span class="hs-identifier hs-var">setColsSQL</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689461709"><span class="hs-identifier hs-var">backendOnly</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet Text
</span><a href="#local-6989586621689461690"><span class="hs-identifier hs-var">reqHdrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SchemaDependency]
</span><a href="#local-6989586621689461685"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-326"></span><span>    </span><span id="local-6989586621689461679"><span class="annot"><span class="annottext">allInsCols :: [Column b]
</span><a href="#local-6989586621689461679"><span class="hs-identifier hs-var hs-var">allInsCols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ColumnInfo b -&gt; Column b) -&gt; [ColumnInfo b] -&gt; [Column b]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b -&gt; Column b
forall (b :: BackendType). ColumnInfo b -&gt; Column b
</span><a href="Hasura.RQL.Types.Column.html#ciColumn"><span class="hs-identifier hs-var hs-var">ciColumn</span></a></span><span> </span><span class="annot"><span class="annottext">([ColumnInfo b] -&gt; [Column b]) -&gt; [ColumnInfo b] -&gt; [Column b]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ColumnInfo b -&gt; Bool) -&gt; [ColumnInfo b] -&gt; [ColumnInfo b]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ColumnMutability -&gt; Bool
</span><a href="Hasura.RQL.Types.Column.html#_cmIsInsertable"><span class="hs-identifier hs-var hs-var">_cmIsInsertable</span></a></span><span> </span><span class="annot"><span class="annottext">(ColumnMutability -&gt; Bool)
-&gt; (ColumnInfo b -&gt; ColumnMutability) -&gt; ColumnInfo b -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b -&gt; ColumnMutability
forall (b :: BackendType). ColumnInfo b -&gt; ColumnMutability
</span><a href="Hasura.RQL.Types.Column.html#ciMutability"><span class="hs-identifier hs-var hs-var">ciMutability</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ColumnInfo b] -&gt; [ColumnInfo b])
-&gt; [ColumnInfo b] -&gt; [ColumnInfo b]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b) -&gt; [ColumnInfo b]
forall (backend :: BackendType).
FieldInfoMap (FieldInfo backend) -&gt; [ColumnInfo backend]
</span><a href="Hasura.RQL.Types.Table.html#getCols"><span class="hs-identifier hs-var">getCols</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461714"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span><span>
</span><span id="line-327"></span><span>    </span><span id="local-6989586621689461700"><span class="annot"><span class="annottext">insCols :: [Column b]
</span><a href="#local-6989586621689461700"><span class="hs-identifier hs-var hs-var">insCols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Column b] -&gt; PermColSpec b -&gt; [Column b]
forall (b :: BackendType).
[Column b] -&gt; PermColSpec b -&gt; [Column b]
</span><a href="Hasura.RQL.DDL.Permission.Internal.html#interpColSpec"><span class="hs-identifier hs-var">interpColSpec</span></a></span><span> </span><span class="annot"><span class="annottext">[Column b]
</span><a href="#local-6989586621689461679"><span class="hs-identifier hs-var">allInsCols</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PermColSpec b -&gt; Maybe (PermColSpec b) -&gt; PermColSpec b
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">PermColSpec b
forall (b :: BackendType). PermColSpec b
</span><a href="Hasura.RQL.Types.Permission.html#PCStar"><span class="hs-identifier hs-var">PCStar</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (PermColSpec b)
</span><a href="#local-6989586621689461710"><span class="hs-identifier hs-var">mCols</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>    </span><span id="local-6989586621689461698"><span class="annot"><span class="annottext">relInInsErr :: Text
</span><a href="#local-6989586621689461698"><span class="hs-identifier hs-var hs-var">relInInsErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Only table columns can have insert permissions defined, not relationships or other field types&quot;</span></span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span class="hs-comment">-- | validate the values present in the `query_root_fields` and the `subscription_root_fields`</span><span>
</span><span id="line-331"></span><span class="hs-comment">--   present in the select permission</span><span>
</span><span id="line-332"></span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#validateAllowedRootFields"><span class="hs-identifier hs-type">validateAllowedRootFields</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689461895"><span class="annot"><a href="#local-6989586621689461895"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621689461896"><span class="annot"><a href="#local-6989586621689461896"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461896"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#TableCoreInfoRM"><span class="hs-identifier hs-type">TableCoreInfoRM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461895"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461896"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461895"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-335"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-336"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461895"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-337"></span><span>  </span><span class="annot"><a href="Hasura.Session.html#RoleName"><span class="hs-identifier hs-type">RoleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-338"></span><span>  </span><span class="annot"><a href="Hasura.Server.Types.html#StreamingSubscriptionsCtx"><span class="hs-identifier hs-type">StreamingSubscriptionsCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-339"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#SelPerm"><span class="hs-identifier hs-type">SelPerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461895"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-340"></span><span>  </span><span class="annot"><a href="#local-6989586621689461896"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#AllowedRootFields"><span class="hs-identifier hs-type">AllowedRootFields</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#QueryRootFieldType"><span class="hs-identifier hs-type">QueryRootFieldType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#AllowedRootFields"><span class="hs-identifier hs-type">AllowedRootFields</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#SubscriptionRootFieldType"><span class="hs-identifier hs-type">SubscriptionRootFieldType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span id="validateAllowedRootFields"><span class="annot"><span class="annottext">validateAllowedRootFields :: SourceName
-&gt; TableName b
-&gt; RoleName
-&gt; StreamingSubscriptionsCtx
-&gt; SelPerm b
-&gt; m (AllowedRootFields QueryRootFieldType,
      AllowedRootFields SubscriptionRootFieldType)
</span><a href="Hasura.RQL.DDL.Permission.html#validateAllowedRootFields"><span class="hs-identifier hs-var hs-var">validateAllowedRootFields</span></a></span></span><span> </span><span id="local-6989586621689461673"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461673"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span> </span><span id="local-6989586621689461672"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461672"><span class="hs-identifier hs-var">tableName</span></a></span></span><span> </span><span id="local-6989586621689461671"><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461671"><span class="hs-identifier hs-var">roleName</span></a></span></span><span> </span><span id="local-6989586621689461670"><span class="annot"><span class="annottext">StreamingSubscriptionsCtx
</span><a href="#local-6989586621689461670"><span class="hs-identifier hs-var">streamSubsCtx</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#SelPerm"><span class="hs-identifier hs-type">SelPerm</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621689461662"><span id="local-6989586621689461663"><span id="local-6989586621689461664"><span id="local-6989586621689461665"><span id="local-6989586621689461666"><span id="local-6989586621689461667"><span id="local-6989586621689461668"><span class="annot"><span class="annottext">Bool
[ComputedFieldName]
Maybe Int
BoolExp b
AllowedRootFields SubscriptionRootFieldType
AllowedRootFields QueryRootFieldType
PermColSpec b
spAllowedSubscriptionRootFields :: forall (b :: BackendType).
SelPerm b -&gt; AllowedRootFields SubscriptionRootFieldType
spAllowedQueryRootFields :: forall (b :: BackendType).
SelPerm b -&gt; AllowedRootFields QueryRootFieldType
spComputedFields :: forall (b :: BackendType). SelPerm b -&gt; [ComputedFieldName]
spAllowAggregations :: forall (b :: BackendType). SelPerm b -&gt; Bool
spLimit :: forall (b :: BackendType). SelPerm b -&gt; Maybe Int
spFilter :: forall (b :: BackendType). SelPerm b -&gt; BoolExp b
spColumns :: forall (b :: BackendType). SelPerm b -&gt; PermColSpec b
spAllowedSubscriptionRootFields :: AllowedRootFields SubscriptionRootFieldType
spAllowedQueryRootFields :: AllowedRootFields QueryRootFieldType
spComputedFields :: [ComputedFieldName]
spAllowAggregations :: Bool
spLimit :: Maybe Int
spFilter :: BoolExp b
spColumns :: PermColSpec b
</span><a href="Hasura.RQL.Types.Permission.html#spAllowedSubscriptionRootFields"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-342"></span><span>  </span><span id="local-6989586621689461654"><span class="annot"><span class="annottext">TableCoreInfo b
</span><a href="#local-6989586621689461654"><span class="hs-identifier hs-var">tableCoreInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TableName b -&gt; m (Maybe (TableCoreInfo b))
forall (b :: BackendType) (m :: * -&gt; *).
TableCoreInfoRM b m =&gt;
TableName b -&gt; m (Maybe (TableCoreInfo b))
</span><a href="Hasura.RQL.Types.SchemaCache.html#lookupTableCoreInfo"><span class="hs-identifier hs-var">lookupTableCoreInfo</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689461895"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461672"><span class="hs-identifier hs-var">tableName</span></a></span><span> </span><span class="annot"><span class="annottext">m (Maybe (TableCoreInfo b))
-&gt; (Maybe (TableCoreInfo b) -&gt; m (TableCoreInfo b))
-&gt; m (TableCoreInfo b)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (TableCoreInfo b)
-&gt; m (TableCoreInfo b) -&gt; m (TableCoreInfo b)
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="Hasura.Prelude.html#onNothing"><span class="hs-operator hs-var">`onNothing`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; m (TableCoreInfo b)
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw500"><span class="hs-identifier hs-var">throw500</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m (TableCoreInfo b)) -&gt; Text -&gt; m (TableCoreInfo b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unexpected: table not found &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; TableName b -&gt; Text
forall t. ToTxt t =&gt; Text -&gt; t -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3E%3E"><span class="hs-operator hs-var">&lt;&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461672"><span class="hs-identifier hs-var">tableName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span>  </span><span class="hs-comment">-- validate the query_root_fields and subscription_root_fields values</span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689461651"><span class="annot"><span class="annottext">needToValidatePrimaryKeyRootField :: Bool
</span><a href="#local-6989586621689461651"><span class="hs-identifier hs-var hs-var">needToValidatePrimaryKeyRootField</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-346"></span><span>        </span><span class="annot"><span class="annottext">QueryRootFieldType
</span><a href="Hasura.RQL.Types.Permission.html#QRFTSelectByPk"><span class="hs-identifier hs-var">QRFTSelectByPk</span></a></span><span> </span><span class="annot"><span class="annottext">QueryRootFieldType -&gt; AllowedRootFields QueryRootFieldType -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; AllowedRootFields a -&gt; Bool
</span><a href="#local-6989586621689461649"><span class="hs-operator hs-var">`rootFieldNeedsValidation`</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedRootFields QueryRootFieldType
</span><a href="#local-6989586621689461663"><span class="hs-identifier hs-var">spAllowedQueryRootFields</span></a></span><span>
</span><span id="line-347"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">SubscriptionRootFieldType
</span><a href="Hasura.RQL.Types.Permission.html#SRFTSelectByPk"><span class="hs-identifier hs-var">SRFTSelectByPk</span></a></span><span> </span><span class="annot"><span class="annottext">SubscriptionRootFieldType
-&gt; AllowedRootFields SubscriptionRootFieldType -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; AllowedRootFields a -&gt; Bool
</span><a href="#local-6989586621689461649"><span class="hs-operator hs-var">`rootFieldNeedsValidation`</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedRootFields SubscriptionRootFieldType
</span><a href="#local-6989586621689461662"><span class="hs-identifier hs-var">spAllowedSubscriptionRootFields</span></a></span><span>
</span><span id="line-348"></span><span>      </span><span id="local-6989586621689461647"><span class="annot"><span class="annottext">needToValidateAggregationRootField :: Bool
</span><a href="#local-6989586621689461647"><span class="hs-identifier hs-var hs-var">needToValidateAggregationRootField</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-349"></span><span>        </span><span class="annot"><span class="annottext">QueryRootFieldType
</span><a href="Hasura.RQL.Types.Permission.html#QRFTSelectAggregate"><span class="hs-identifier hs-var">QRFTSelectAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">QueryRootFieldType -&gt; AllowedRootFields QueryRootFieldType -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; AllowedRootFields a -&gt; Bool
</span><a href="#local-6989586621689461649"><span class="hs-operator hs-var">`rootFieldNeedsValidation`</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedRootFields QueryRootFieldType
</span><a href="#local-6989586621689461663"><span class="hs-identifier hs-var">spAllowedQueryRootFields</span></a></span><span>
</span><span id="line-350"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">SubscriptionRootFieldType
</span><a href="Hasura.RQL.Types.Permission.html#SRFTSelectAggregate"><span class="hs-identifier hs-var">SRFTSelectAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">SubscriptionRootFieldType
-&gt; AllowedRootFields SubscriptionRootFieldType -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; AllowedRootFields a -&gt; Bool
</span><a href="#local-6989586621689461649"><span class="hs-operator hs-var">`rootFieldNeedsValidation`</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedRootFields SubscriptionRootFieldType
</span><a href="#local-6989586621689461662"><span class="hs-identifier hs-var">spAllowedSubscriptionRootFields</span></a></span><span>
</span><span id="line-351"></span><span>      </span><span id="local-6989586621689461644"><span class="annot"><span class="annottext">needToValidateStreamingRootField :: Bool
</span><a href="#local-6989586621689461644"><span class="hs-identifier hs-var hs-var">needToValidateStreamingRootField</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-352"></span><span>        </span><span class="annot"><span class="annottext">SubscriptionRootFieldType
</span><a href="Hasura.RQL.Types.Permission.html#SRFTSelectStream"><span class="hs-identifier hs-var">SRFTSelectStream</span></a></span><span> </span><span class="annot"><span class="annottext">SubscriptionRootFieldType
-&gt; AllowedRootFields SubscriptionRootFieldType -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; AllowedRootFields a -&gt; Bool
</span><a href="#local-6989586621689461649"><span class="hs-operator hs-var">`rootFieldNeedsValidation`</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedRootFields SubscriptionRootFieldType
</span><a href="#local-6989586621689461662"><span class="hs-identifier hs-var">spAllowedSubscriptionRootFields</span></a></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689461651"><span class="hs-identifier hs-var">needToValidatePrimaryKeyRootField</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TableCoreInfo b -&gt; m ()
</span><a href="#local-6989586621689461642"><span class="hs-identifier hs-var">validatePrimaryKeyRootField</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfo b
</span><a href="#local-6989586621689461654"><span class="hs-identifier hs-var">tableCoreInfo</span></a></span><span>
</span><span id="line-355"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689461647"><span class="hs-identifier hs-var">needToValidateAggregationRootField</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621689461641"><span class="hs-identifier hs-var">validateAggregationRootField</span></a></span><span>
</span><span id="line-356"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689461644"><span class="hs-identifier hs-var">needToValidateStreamingRootField</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621689461640"><span class="hs-identifier hs-var">validateStreamingRootField</span></a></span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span>  </span><span class="annot"><span class="annottext">(AllowedRootFields QueryRootFieldType,
 AllowedRootFields SubscriptionRootFieldType)
-&gt; m (AllowedRootFields QueryRootFieldType,
      AllowedRootFields SubscriptionRootFieldType)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AllowedRootFields QueryRootFieldType
</span><a href="#local-6989586621689461663"><span class="hs-identifier hs-var">spAllowedQueryRootFields</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AllowedRootFields SubscriptionRootFieldType
</span><a href="#local-6989586621689461662"><span class="hs-identifier hs-var">spAllowedSubscriptionRootFields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-360"></span><span>    </span><span id="local-6989586621689461649"><span class="annot"><span class="annottext">rootFieldNeedsValidation :: a -&gt; AllowedRootFields a -&gt; Bool
</span><a href="#local-6989586621689461649"><span class="hs-identifier hs-var hs-var">rootFieldNeedsValidation</span></a></span></span><span> </span><span id="local-6989586621689461639"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689461639"><span class="hs-identifier hs-var">rootField</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-361"></span><span>      </span><span class="annot"><span class="annottext">AllowedRootFields a
</span><a href="Hasura.RQL.Types.Permission.html#ARFAllowAllRootFields"><span class="hs-identifier hs-var">ARFAllowAllRootFields</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-362"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#ARFAllowConfiguredRootFields"><span class="hs-identifier hs-type">ARFAllowConfiguredRootFields</span></a></span><span> </span><span id="local-6989586621689461636"><span class="annot"><span class="annottext">HashSet a
</span><a href="#local-6989586621689461636"><span class="hs-identifier hs-var">allowedRootFields</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689461639"><span class="hs-identifier hs-var">rootField</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; HashSet a -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><span class="hs-operator hs-var">`HS.member`</span></span><span> </span><span class="annot"><span class="annottext">HashSet a
</span><a href="#local-6989586621689461636"><span class="hs-identifier hs-var">allowedRootFields</span></a></span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span>    </span><span id="local-6989586621689461634"><span class="annot"><span class="annottext">pkValidationError :: m ()
</span><a href="#local-6989586621689461634"><span class="hs-identifier hs-var hs-var">pkValidationError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-365"></span><span>      </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#ValidationFailed"><span class="hs-identifier hs-var">ValidationFailed</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-366"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The \&quot;select_by_pk\&quot; field cannot be included in the query_root_fields or subscription_root_fields&quot;</span></span><span>
</span><span id="line-367"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; because the role &quot;</span></span><span>
</span><span id="line-368"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461671"><span class="hs-identifier hs-var">roleName</span></a></span><span>
</span><span id="line-369"></span><span>          </span><span class="annot"><span class="annottext">RoleName -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; does not have access to the primary key of the table &quot;</span></span><span>
</span><span id="line-370"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461672"><span class="hs-identifier hs-var">tableName</span></a></span><span>
</span><span id="line-371"></span><span>          </span><span class="annot"><span class="annottext">TableName b -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; in the source &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SourceName -&gt; Text
forall t. ToTxt t =&gt; Text -&gt; t -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3E%3E"><span class="hs-operator hs-var">&lt;&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461673"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-372"></span><span>    </span><span id="local-6989586621689461642"><span class="annot"><span class="annottext">validatePrimaryKeyRootField :: TableCoreInfo b -&gt; m ()
</span><a href="#local-6989586621689461642"><span class="hs-identifier hs-var hs-var">validatePrimaryKeyRootField</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Table.html#TableCoreInfo"><span class="hs-identifier hs-type">TableCoreInfo</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621689461621"><span id="local-6989586621689461622"><span id="local-6989586621689461623"><span id="local-6989586621689461624"><span id="local-6989586621689461625"><span id="local-6989586621689461626"><span id="local-6989586621689461627"><span id="local-6989586621689461628"><span id="local-6989586621689461629"><span id="local-6989586621689461630"><span id="local-6989586621689461631"><span class="annot"><span class="annottext">Maybe EnumValues
Maybe ApolloFederationConfig
Maybe PGDescription
Maybe ViewInfo
Maybe (PrimaryKey b (ColumnInfo b))
FieldInfoMap (FieldInfo b)
HashSet (ForeignKey b)
HashSet (UniqueConstraint b)
TableName b
ExtraTableMetadata b
TableConfig b
_tciApolloFederationConfig :: forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn
-&gt; Maybe ApolloFederationConfig
_tciExtraTableMetadata :: forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn -&gt; ExtraTableMetadata b
_tciCustomConfig :: forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn -&gt; TableConfig b
_tciEnumValues :: forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn -&gt; Maybe EnumValues
_tciViewInfo :: forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn -&gt; Maybe ViewInfo
_tciForeignKeys :: forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn -&gt; HashSet (ForeignKey b)
_tciUniqueConstraints :: forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn
-&gt; HashSet (UniqueConstraint b)
_tciPrimaryKey :: forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn
-&gt; Maybe (PrimaryKey b primaryKeyColumn)
_tciFieldInfoMap :: forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn -&gt; FieldInfoMap field
_tciDescription :: forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn -&gt; Maybe PGDescription
_tciName :: forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn -&gt; TableName b
_tciApolloFederationConfig :: Maybe ApolloFederationConfig
_tciExtraTableMetadata :: ExtraTableMetadata b
_tciCustomConfig :: TableConfig b
_tciEnumValues :: Maybe EnumValues
_tciViewInfo :: Maybe ViewInfo
_tciForeignKeys :: HashSet (ForeignKey b)
_tciUniqueConstraints :: HashSet (UniqueConstraint b)
_tciPrimaryKey :: Maybe (PrimaryKey b (ColumnInfo b))
_tciFieldInfoMap :: FieldInfoMap (FieldInfo b)
_tciDescription :: Maybe PGDescription
_tciName :: TableName b
</span><a href="Hasura.RQL.Types.Table.html#_tciApolloFederationConfig"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-373"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (PrimaryKey b (ColumnInfo b))
</span><a href="#local-6989586621689461628"><span class="hs-identifier hs-var">_tciPrimaryKey</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-374"></span><span>        </span><span class="annot"><span class="annottext">Maybe (PrimaryKey b (ColumnInfo b))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621689461634"><span class="hs-identifier hs-var">pkValidationError</span></a></span><span>
</span><span id="line-375"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Table.html#PrimaryKey"><span class="hs-identifier hs-type">PrimaryKey</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint b
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621689461608"><span class="annot"><span class="annottext">NESeq (ColumnInfo b)
</span><a href="#local-6989586621689461608"><span class="hs-identifier hs-var">pkCols</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-376"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PermColSpec b
</span><a href="#local-6989586621689461668"><span class="hs-identifier hs-var">spColumns</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-377"></span><span>            </span><span class="annot"><span class="annottext">PermColSpec b
</span><a href="Hasura.RQL.Types.Permission.html#PCStar"><span class="hs-identifier hs-var">PCStar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>            </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#PCCols"><span class="hs-identifier hs-type">PCCols</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Column b] -&gt; HashSet (Column b)
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><span class="hs-identifier hs-var">HS.fromList</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621689461606"><span class="annot"><span class="annottext">HashSet (Column b)
</span><a href="#local-6989586621689461606"><span class="hs-identifier hs-var">selPermCols</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-379"></span><span>              </span><span class="hs-comment">-- Check if all the primary key columns of the table are</span><span>
</span><span id="line-380"></span><span>              </span><span class="hs-comment">-- accessible to the current role</span><span>
</span><span id="line-381"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ColumnInfo b -&gt; Bool) -&gt; NESeq (ColumnInfo b) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Column b -&gt; HashSet (Column b) -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><span class="hs-operator hs-var">`HS.member`</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Column b)
</span><a href="#local-6989586621689461606"><span class="hs-identifier hs-var">selPermCols</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Column b -&gt; Bool)
-&gt; (ColumnInfo b -&gt; Column b) -&gt; ColumnInfo b -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b -&gt; Column b
forall (b :: BackendType). ColumnInfo b -&gt; Column b
</span><a href="Hasura.RQL.Types.Column.html#ciColumn"><span class="hs-identifier hs-var hs-var">ciColumn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NESeq (ColumnInfo b)
</span><a href="#local-6989586621689461608"><span class="hs-identifier hs-var">pkCols</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621689461634"><span class="hs-identifier hs-var">pkValidationError</span></a></span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span>    </span><span id="local-6989586621689461641"><span class="annot"><span class="annottext">validateAggregationRootField :: m ()
</span><a href="#local-6989586621689461641"><span class="hs-identifier hs-var hs-var">validateAggregationRootField</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-384"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689461665"><span class="hs-identifier hs-var">spAllowAggregations</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-385"></span><span>        </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#ValidationFailed"><span class="hs-identifier hs-var">ValidationFailed</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-386"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The \&quot;select_aggregate\&quot; root field can only be enabled in the query_root_fields or &quot;</span></span><span>
</span><span id="line-387"></span><span>            </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; the subscription_root_fields when \&quot;allow_aggregations\&quot; is set to true&quot;</span></span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span>    </span><span id="local-6989586621689461640"><span class="annot"><span class="annottext">validateStreamingRootField :: m ()
</span><a href="#local-6989586621689461640"><span class="hs-identifier hs-var hs-var">validateStreamingRootField</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-390"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StreamingSubscriptionsCtx
</span><a href="#local-6989586621689461670"><span class="hs-identifier hs-var">streamSubsCtx</span></a></span><span> </span><span class="annot"><span class="annottext">StreamingSubscriptionsCtx -&gt; StreamingSubscriptionsCtx -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">StreamingSubscriptionsCtx
</span><a href="Hasura.Server.Types.html#StreamingSubscriptionsEnabled"><span class="hs-identifier hs-var">StreamingSubscriptionsEnabled</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-391"></span><span>        </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#ValidationFailed"><span class="hs-identifier hs-var">ValidationFailed</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-392"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The \&quot;select_stream\&quot; root field can only be included in the query_root_fields or &quot;</span></span><span>
</span><span id="line-393"></span><span>            </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; the subscription_root_fields when streaming subscriptions is enabled&quot;</span></span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#buildSelPermInfo"><span class="hs-identifier hs-type">buildSelPermInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-396"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689462055"><span class="annot"><a href="#local-6989586621689462055"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621689462056"><span class="annot"><a href="#local-6989586621689462056"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-397"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462056"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#TableCoreInfoRM"><span class="hs-identifier hs-type">TableCoreInfoRM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462055"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462056"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462055"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-398"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-399"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462055"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-400"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Table.html#FieldInfoMap"><span class="hs-identifier hs-type">FieldInfoMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Table.html#FieldInfo"><span class="hs-identifier hs-type">FieldInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462055"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-401"></span><span>  </span><span class="annot"><a href="Hasura.Session.html#RoleName"><span class="hs-identifier hs-type">RoleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-402"></span><span>  </span><span class="annot"><a href="Hasura.Server.Types.html#StreamingSubscriptionsCtx"><span class="hs-identifier hs-type">StreamingSubscriptionsCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-403"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#SelPerm"><span class="hs-identifier hs-type">SelPerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462055"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-404"></span><span>  </span><span class="annot"><a href="#local-6989586621689462056"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#WithDeps"><span class="hs-identifier hs-type">WithDeps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Table.html#SelPermInfo"><span class="hs-identifier hs-type">SelPermInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462055"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span id="buildSelPermInfo"><span class="annot"><span class="annottext">buildSelPermInfo :: SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; RoleName
-&gt; StreamingSubscriptionsCtx
-&gt; SelPerm b
-&gt; m (WithDeps (SelPermInfo b))
</span><a href="Hasura.RQL.DDL.Permission.html#buildSelPermInfo"><span class="hs-identifier hs-var hs-var">buildSelPermInfo</span></a></span></span><span> </span><span id="local-6989586621689461603"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461603"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621689461602"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461602"><span class="hs-identifier hs-var">tableName</span></a></span></span><span> </span><span id="local-6989586621689461601"><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461601"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span></span><span> </span><span id="local-6989586621689461600"><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461600"><span class="hs-identifier hs-var">roleName</span></a></span></span><span> </span><span id="local-6989586621689461599"><span class="annot"><span class="annottext">StreamingSubscriptionsCtx
</span><a href="#local-6989586621689461599"><span class="hs-identifier hs-var">streamSubsCtx</span></a></span></span><span> </span><span id="local-6989586621689461598"><span class="annot"><span class="annottext">SelPerm b
</span><a href="#local-6989586621689461598"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; m (WithDeps (SelPermInfo b)) -&gt; m (WithDeps (SelPermInfo b))
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#withPathK"><span class="hs-identifier hs-var">withPathK</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;permission&quot;</span></span><span> </span><span class="annot"><span class="annottext">(m (WithDeps (SelPermInfo b)) -&gt; m (WithDeps (SelPermInfo b)))
-&gt; m (WithDeps (SelPermInfo b)) -&gt; m (WithDeps (SelPermInfo b))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-406"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689461597"><span class="annot"><span class="annottext">pgCols :: [Column b]
</span><a href="#local-6989586621689461597"><span class="hs-identifier hs-var hs-var">pgCols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Column b] -&gt; PermColSpec b -&gt; [Column b]
forall (b :: BackendType).
[Column b] -&gt; PermColSpec b -&gt; [Column b]
</span><a href="Hasura.RQL.DDL.Permission.Internal.html#interpColSpec"><span class="hs-identifier hs-var">interpColSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ColumnInfo b -&gt; Column b) -&gt; [ColumnInfo b] -&gt; [Column b]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b -&gt; Column b
forall (b :: BackendType). ColumnInfo b -&gt; Column b
</span><a href="Hasura.RQL.Types.Column.html#ciColumn"><span class="hs-identifier hs-var hs-var">ciColumn</span></a></span><span> </span><span class="annot"><span class="annottext">([ColumnInfo b] -&gt; [Column b]) -&gt; [ColumnInfo b] -&gt; [Column b]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b) -&gt; [ColumnInfo b]
forall (backend :: BackendType).
FieldInfoMap (FieldInfo backend) -&gt; [ColumnInfo backend]
</span><a href="Hasura.RQL.Types.Table.html#getCols"><span class="hs-identifier hs-var">getCols</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461601"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PermColSpec b -&gt; [Column b]) -&gt; PermColSpec b -&gt; [Column b]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SelPerm b -&gt; PermColSpec b
forall (b :: BackendType). SelPerm b -&gt; PermColSpec b
</span><a href="Hasura.RQL.Types.Permission.html#spColumns"><span class="hs-identifier hs-var hs-var">spColumns</span></a></span><span> </span><span class="annot"><span class="annottext">SelPerm b
</span><a href="#local-6989586621689461598"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621689461596"><span class="annot"><span class="annottext">AnnBoolExpPartialSQL b
</span><a href="#local-6989586621689461596"><span class="hs-identifier hs-var">spiFilter</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689461595"><span class="annot"><span class="annottext">[SchemaDependency]
</span><a href="#local-6989586621689461595"><span class="hs-identifier hs-var">boolExpDeps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-409"></span><span>    </span><span class="annot"><span class="annottext">Text
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#withPathK"><span class="hs-identifier hs-var">withPathK</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;filter&quot;</span></span><span> </span><span class="annot"><span class="annottext">(m (AnnBoolExpPartialSQL b, [SchemaDependency])
 -&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency]))
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-410"></span><span>      </span><span class="annot"><span class="annottext">SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; BoolExp b
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
forall (m :: * -&gt; *) (b :: BackendType).
(QErrM m, TableCoreInfoRM b m, BackendMetadata b) =&gt;
SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; BoolExp b
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
</span><a href="Hasura.RQL.DDL.Permission.Internal.html#procBoolExp"><span class="hs-identifier hs-var">procBoolExp</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461603"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461602"><span class="hs-identifier hs-var">tableName</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461601"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">(BoolExp b -&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency]))
-&gt; BoolExp b -&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SelPerm b -&gt; BoolExp b
forall (b :: BackendType). SelPerm b -&gt; BoolExp b
</span><a href="Hasura.RQL.Types.Permission.html#spFilter"><span class="hs-identifier hs-var hs-var">spFilter</span></a></span><span> </span><span class="annot"><span class="annottext">SelPerm b
</span><a href="#local-6989586621689461598"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span>  </span><span class="hs-comment">-- check if the columns exist</span><span>
</span><span id="line-413"></span><span>  </span><span class="annot"><span class="annottext">m [ColumnType b] -&gt; m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(m [ColumnType b] -&gt; m ()) -&gt; m [ColumnType b] -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-414"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; m [ColumnType b] -&gt; m [ColumnType b]
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#withPathK"><span class="hs-identifier hs-var">withPathK</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;columns&quot;</span></span><span> </span><span class="annot"><span class="annottext">(m [ColumnType b] -&gt; m [ColumnType b])
-&gt; m [ColumnType b] -&gt; m [ColumnType b]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-415"></span><span>      </span><span class="annot"><span class="annottext">[Column b] -&gt; (Column b -&gt; m (ColumnType b)) -&gt; m [ColumnType b]
forall (m :: * -&gt; *) a b. QErrM m =&gt; [a] -&gt; (a -&gt; m b) -&gt; m [b]
</span><a href="Hasura.Base.Error.html#indexedForM"><span class="hs-identifier hs-var">indexedForM</span></a></span><span> </span><span class="annot"><span class="annottext">[Column b]
</span><a href="#local-6989586621689461597"><span class="hs-identifier hs-var">pgCols</span></a></span><span> </span><span class="annot"><span class="annottext">((Column b -&gt; m (ColumnType b)) -&gt; m [ColumnType b])
-&gt; (Column b -&gt; m (ColumnType b)) -&gt; m [ColumnType b]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689461594"><span class="annot"><span class="annottext">Column b
</span><a href="#local-6989586621689461594"><span class="hs-identifier hs-var">pgCol</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-416"></span><span>        </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b) -&gt; Column b -&gt; Text -&gt; m (ColumnType b)
forall (m :: * -&gt; *) (backend :: BackendType).
(MonadError QErr m, Backend backend) =&gt;
FieldInfoMap (FieldInfo backend)
-&gt; Column backend -&gt; Text -&gt; m (ColumnType backend)
</span><a href="Hasura.RQL.Types.Table.html#askColumnType"><span class="hs-identifier hs-var">askColumnType</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461601"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">Column b
</span><a href="#local-6989586621689461594"><span class="hs-identifier hs-var">pgCol</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689461593"><span class="hs-identifier hs-var">autoInferredErr</span></a></span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span>  </span><span class="hs-comment">-- validate computed fields</span><span>
</span><span id="line-419"></span><span>  </span><span id="local-6989586621689461592"><span class="annot"><span class="annottext">[ComputedFieldName]
</span><a href="#local-6989586621689461592"><span class="hs-identifier hs-var">validComputedFields</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-420"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; m [ComputedFieldName] -&gt; m [ComputedFieldName]
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#withPathK"><span class="hs-identifier hs-var">withPathK</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;computed_fields&quot;</span></span><span> </span><span class="annot"><span class="annottext">(m [ComputedFieldName] -&gt; m [ComputedFieldName])
-&gt; m [ComputedFieldName] -&gt; m [ComputedFieldName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-421"></span><span>      </span><span class="annot"><span class="annottext">[ComputedFieldName]
-&gt; (ComputedFieldName -&gt; m ComputedFieldName)
-&gt; m [ComputedFieldName]
forall (m :: * -&gt; *) a b. QErrM m =&gt; [a] -&gt; (a -&gt; m b) -&gt; m [b]
</span><a href="Hasura.Base.Error.html#indexedForM"><span class="hs-identifier hs-var">indexedForM</span></a></span><span> </span><span class="annot"><span class="annottext">[ComputedFieldName]
</span><a href="#local-6989586621689461591"><span class="hs-identifier hs-var">computedFields</span></a></span><span> </span><span class="annot"><span class="annottext">((ComputedFieldName -&gt; m ComputedFieldName)
 -&gt; m [ComputedFieldName])
-&gt; (ComputedFieldName -&gt; m ComputedFieldName)
-&gt; m [ComputedFieldName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689461590"><span class="annot"><span class="annottext">ComputedFieldName
</span><a href="#local-6989586621689461590"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-422"></span><span>        </span><span id="local-6989586621689461589"><span class="annot"><span class="annottext">ComputedFieldInfo b
</span><a href="#local-6989586621689461589"><span class="hs-identifier hs-var">computedFieldInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
-&gt; ComputedFieldName -&gt; m (ComputedFieldInfo b)
forall (m :: * -&gt; *) (backend :: BackendType).
MonadError QErr m =&gt;
FieldInfoMap (FieldInfo backend)
-&gt; ComputedFieldName -&gt; m (ComputedFieldInfo backend)
</span><a href="Hasura.RQL.Types.Table.html#askComputedFieldInfo"><span class="hs-identifier hs-var">askComputedFieldInfo</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461601"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">ComputedFieldName
</span><a href="#local-6989586621689461590"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-423"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ComputedFieldReturn b -&gt; ComputedFieldReturnType b
forall (b :: BackendType).
Backend b =&gt;
ComputedFieldReturn b -&gt; ComputedFieldReturnType b
</span><a href="Hasura.RQL.Types.Backend.html#computedFieldReturnType"><span class="hs-identifier hs-var">computedFieldReturnType</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689462055"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ComputedFieldInfo b -&gt; ComputedFieldReturn b
forall (b :: BackendType).
ComputedFieldInfo b -&gt; ComputedFieldReturn b
</span><a href="Hasura.RQL.Types.ComputedField.html#_cfiReturnType"><span class="hs-identifier hs-var hs-var">_cfiReturnType</span></a></span><span> </span><span class="annot"><span class="annottext">ComputedFieldInfo b
</span><a href="#local-6989586621689461589"><span class="hs-identifier hs-var">computedFieldInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-424"></span><span>          </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#ReturnsScalar"><span class="hs-identifier hs-type">ReturnsScalar</span></a></span><span> </span><span class="annot"><span class="annottext">ScalarType b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ComputedFieldName -&gt; m ComputedFieldName
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ComputedFieldName
</span><a href="#local-6989586621689461590"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-425"></span><span>          </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#ReturnsTable"><span class="hs-identifier hs-type">ReturnsTable</span></a></span><span> </span><span id="local-6989586621689461583"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461583"><span class="hs-identifier hs-var">returnTable</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-426"></span><span>            </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m ComputedFieldName
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#NotSupported"><span class="hs-identifier hs-var">NotSupported</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ComputedFieldName) -&gt; Text -&gt; m ComputedFieldName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-427"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;select permissions on computed field &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ComputedFieldName
</span><a href="#local-6989586621689461590"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-428"></span><span>                </span><span class="annot"><span class="annottext">ComputedFieldName -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; are auto-derived from the permissions on its returning table &quot;</span></span><span>
</span><span id="line-429"></span><span>                </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461583"><span class="hs-identifier hs-var">returnTable</span></a></span><span>
</span><span id="line-430"></span><span>                </span><span class="annot"><span class="annottext">TableName b -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; and cannot be specified manually&quot;</span></span><span>
</span><span id="line-431"></span><span>          </span><span class="annot"><span class="annottext">ComputedFieldReturnType b
</span><a href="Hasura.RQL.Types.Backend.html#ReturnsOthers"><span class="hs-identifier hs-var">ReturnsOthers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ComputedFieldName -&gt; m ComputedFieldName
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ComputedFieldName
</span><a href="#local-6989586621689461590"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689461580"><span class="annot"><span class="annottext">deps :: [SchemaDependency]
</span><a href="#local-6989586621689461580"><span class="hs-identifier hs-var hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-434"></span><span>        </span><span class="annot"><span class="annottext">SourceName -&gt; TableName b -&gt; SchemaDependency
forall (b :: BackendType).
Backend b =&gt;
SourceName -&gt; TableName b -&gt; SchemaDependency
</span><a href="Hasura.RQL.Types.SchemaCache.html#mkParentDep"><span class="hs-identifier hs-var">mkParentDep</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689462055"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461603"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461602"><span class="hs-identifier hs-var">tableName</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaDependency -&gt; [SchemaDependency] -&gt; [SchemaDependency]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-435"></span><span>        </span><span class="annot"><span class="annottext">[SchemaDependency]
</span><a href="#local-6989586621689461595"><span class="hs-identifier hs-var">boolExpDeps</span></a></span><span> </span><span class="annot"><span class="annottext">[SchemaDependency] -&gt; [SchemaDependency] -&gt; [SchemaDependency]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Column b -&gt; SchemaDependency) -&gt; [Column b] -&gt; [SchemaDependency]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DependencyReason
-&gt; SourceName -&gt; TableName b -&gt; Column b -&gt; SchemaDependency
forall (b :: BackendType).
Backend b =&gt;
DependencyReason
-&gt; SourceName -&gt; TableName b -&gt; Column b -&gt; SchemaDependency
</span><a href="Hasura.RQL.Types.SchemaCache.html#mkColDep"><span class="hs-identifier hs-var">mkColDep</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689462055"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">DependencyReason
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#DRUntyped"><span class="hs-identifier hs-var">DRUntyped</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461603"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461602"><span class="hs-identifier hs-var">tableName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Column b]
</span><a href="#local-6989586621689461597"><span class="hs-identifier hs-var">pgCols</span></a></span><span>
</span><span id="line-436"></span><span>          </span><span class="annot"><span class="annottext">[SchemaDependency] -&gt; [SchemaDependency] -&gt; [SchemaDependency]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(ComputedFieldName -&gt; SchemaDependency)
-&gt; [ComputedFieldName] -&gt; [SchemaDependency]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DependencyReason
-&gt; SourceName
-&gt; TableName b
-&gt; ComputedFieldName
-&gt; SchemaDependency
forall (b :: BackendType).
Backend b =&gt;
DependencyReason
-&gt; SourceName
-&gt; TableName b
-&gt; ComputedFieldName
-&gt; SchemaDependency
</span><a href="Hasura.RQL.Types.SchemaCache.html#mkComputedFieldDep"><span class="hs-identifier hs-var">mkComputedFieldDep</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689462055"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">DependencyReason
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#DRUntyped"><span class="hs-identifier hs-var">DRUntyped</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461603"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461602"><span class="hs-identifier hs-var">tableName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ComputedFieldName]
</span><a href="#local-6989586621689461592"><span class="hs-identifier hs-var">validComputedFields</span></a></span><span>
</span><span id="line-437"></span><span>      </span><span id="local-6989586621689461578"><span class="annot"><span class="annottext">spiRequiredHeaders :: HashSet Text
</span><a href="#local-6989586621689461578"><span class="hs-identifier hs-var hs-var">spiRequiredHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BoolExp b -&gt; HashSet Text
forall (b :: BackendType). BoolExp b -&gt; HashSet Text
</span><a href="Hasura.RQL.DDL.Permission.Internal.html#getDependentHeaders"><span class="hs-identifier hs-var">getDependentHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">(BoolExp b -&gt; HashSet Text) -&gt; BoolExp b -&gt; HashSet Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SelPerm b -&gt; BoolExp b
forall (b :: BackendType). SelPerm b -&gt; BoolExp b
</span><a href="Hasura.RQL.Types.Permission.html#spFilter"><span class="hs-identifier hs-var hs-var">spFilter</span></a></span><span> </span><span class="annot"><span class="annottext">SelPerm b
</span><a href="#local-6989586621689461598"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-438"></span><span>      </span><span id="local-6989586621689461577"><span class="annot"><span class="annottext">spiLimit :: Maybe Int
</span><a href="#local-6989586621689461577"><span class="hs-identifier hs-var hs-var">spiLimit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelPerm b -&gt; Maybe Int
forall (b :: BackendType). SelPerm b -&gt; Maybe Int
</span><a href="Hasura.RQL.Types.Permission.html#spLimit"><span class="hs-identifier hs-var hs-var">spLimit</span></a></span><span> </span><span class="annot"><span class="annottext">SelPerm b
</span><a href="#local-6989586621689461598"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; m () -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#withPathK"><span class="hs-identifier hs-var">withPathK</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;limit&quot;</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; (Int -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621689461577"><span class="hs-identifier hs-var">spiLimit</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689461575"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621689461575"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-441"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621689461575"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-442"></span><span>      </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#NotSupported"><span class="hs-identifier hs-var">NotSupported</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unexpected negative value&quot;</span></span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689461573"><span class="annot"><span class="annottext">spiCols :: HashMap (Column b) (Maybe (AnnColumnCaseBoolExpPartialSQL b))
</span><a href="#local-6989586621689461573"><span class="hs-identifier hs-var hs-var">spiCols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Column b, Maybe (AnnColumnCaseBoolExpPartialSQL b))]
-&gt; HashMap (Column b) (Maybe (AnnColumnCaseBoolExpPartialSQL b))
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Column b, Maybe (AnnColumnCaseBoolExpPartialSQL b))]
 -&gt; HashMap (Column b) (Maybe (AnnColumnCaseBoolExpPartialSQL b)))
-&gt; [(Column b, Maybe (AnnColumnCaseBoolExpPartialSQL b))]
-&gt; HashMap (Column b) (Maybe (AnnColumnCaseBoolExpPartialSQL b))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Column b -&gt; (Column b, Maybe (AnnColumnCaseBoolExpPartialSQL b)))
-&gt; [Column b]
-&gt; [(Column b, Maybe (AnnColumnCaseBoolExpPartialSQL b))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-special">,</span></span><span class="annot"><span class="annottext">Maybe (AnnColumnCaseBoolExpPartialSQL b)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Column b]
</span><a href="#local-6989586621689461597"><span class="hs-identifier hs-var">pgCols</span></a></span><span>
</span><span id="line-445"></span><span>      </span><span id="local-6989586621689461572"><span class="annot"><span class="annottext">spiComputedFields :: HashMap
  ComputedFieldName (Maybe (AnnColumnCaseBoolExpPartialSQL b))
</span><a href="#local-6989586621689461572"><span class="hs-identifier hs-var hs-var">spiComputedFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet ComputedFieldName -&gt; HashMap ComputedFieldName ()
forall a. HashSet a -&gt; HashMap a ()
</span><span class="hs-identifier hs-var">HS.toMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ComputedFieldName] -&gt; HashSet ComputedFieldName
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><span class="hs-identifier hs-var">HS.fromList</span></span><span> </span><span class="annot"><span class="annottext">[ComputedFieldName]
</span><a href="#local-6989586621689461592"><span class="hs-identifier hs-var">validComputedFields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap ComputedFieldName ()
-&gt; Maybe (AnnColumnCaseBoolExpPartialSQL b)
-&gt; HashMap
     ComputedFieldName (Maybe (AnnColumnCaseBoolExpPartialSQL b))
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (AnnColumnCaseBoolExpPartialSQL b)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621689461569"><span class="annot"><span class="annottext">AllowedRootFields QueryRootFieldType
</span><a href="#local-6989586621689461569"><span class="hs-identifier hs-var">spiAllowedQueryRootFields</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689461568"><span class="annot"><span class="annottext">AllowedRootFields SubscriptionRootFieldType
</span><a href="#local-6989586621689461568"><span class="hs-identifier hs-var">spiAllowedSubscriptionRootFields</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-448"></span><span>    </span><span class="annot"><span class="annottext">SourceName
-&gt; TableName b
-&gt; RoleName
-&gt; StreamingSubscriptionsCtx
-&gt; SelPerm b
-&gt; m (AllowedRootFields QueryRootFieldType,
      AllowedRootFields SubscriptionRootFieldType)
forall (b :: BackendType) (m :: * -&gt; *).
(QErrM m, TableCoreInfoRM b m, BackendMetadata b) =&gt;
SourceName
-&gt; TableName b
-&gt; RoleName
-&gt; StreamingSubscriptionsCtx
-&gt; SelPerm b
-&gt; m (AllowedRootFields QueryRootFieldType,
      AllowedRootFields SubscriptionRootFieldType)
</span><a href="Hasura.RQL.DDL.Permission.html#validateAllowedRootFields"><span class="hs-identifier hs-var">validateAllowedRootFields</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461603"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461602"><span class="hs-identifier hs-var">tableName</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461600"><span class="hs-identifier hs-var">roleName</span></a></span><span> </span><span class="annot"><span class="annottext">StreamingSubscriptionsCtx
</span><a href="#local-6989586621689461599"><span class="hs-identifier hs-var">streamSubsCtx</span></a></span><span> </span><span class="annot"><span class="annottext">SelPerm b
</span><a href="#local-6989586621689461598"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span>  </span><span class="annot"><span class="annottext">WithDeps (SelPermInfo b) -&gt; m (WithDeps (SelPermInfo b))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelPermInfo :: forall (b :: BackendType).
HashMap (Column b) (Maybe (AnnColumnCaseBoolExpPartialSQL b))
-&gt; HashMap
     ComputedFieldName (Maybe (AnnColumnCaseBoolExpPartialSQL b))
-&gt; AnnBoolExpPartialSQL b
-&gt; Maybe Int
-&gt; Bool
-&gt; HashSet Text
-&gt; AllowedRootFields QueryRootFieldType
-&gt; AllowedRootFields SubscriptionRootFieldType
-&gt; SelPermInfo b
</span><a href="Hasura.RQL.Types.Table.html#SelPermInfo"><span class="hs-identifier hs-type">SelPermInfo</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Bool
Maybe Int
HashMap (Column b) (Maybe (AnnColumnCaseBoolExpPartialSQL b))
HashMap
  ComputedFieldName (Maybe (AnnColumnCaseBoolExpPartialSQL b))
HashSet Text
AnnBoolExpPartialSQL b
AllowedRootFields SubscriptionRootFieldType
AllowedRootFields QueryRootFieldType
spiAllowedSubscriptionRootFields :: AllowedRootFields SubscriptionRootFieldType
spiAllowedQueryRootFields :: AllowedRootFields QueryRootFieldType
spiRequiredHeaders :: HashSet Text
spiAllowAgg :: Bool
spiLimit :: Maybe Int
spiFilter :: AnnBoolExpPartialSQL b
spiComputedFields :: HashMap
  ComputedFieldName (Maybe (AnnColumnCaseBoolExpPartialSQL b))
spiCols :: HashMap (Column b) (Maybe (AnnColumnCaseBoolExpPartialSQL b))
spiAllowAgg :: Bool
spiAllowedSubscriptionRootFields :: AllowedRootFields SubscriptionRootFieldType
spiAllowedQueryRootFields :: AllowedRootFields QueryRootFieldType
spiComputedFields :: HashMap
  ComputedFieldName (Maybe (AnnColumnCaseBoolExpPartialSQL b))
spiCols :: HashMap (Column b) (Maybe (AnnColumnCaseBoolExpPartialSQL b))
spiLimit :: Maybe Int
spiRequiredHeaders :: HashSet Text
spiFilter :: AnnBoolExpPartialSQL b
</span><a href="Hasura.RQL.Types.Table.html#spiAllowedSubscriptionRootFields"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SchemaDependency]
</span><a href="#local-6989586621689461580"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-452"></span><span>    </span><span id="local-6989586621689461566"><span class="annot"><span class="annottext">spiAllowAgg :: Bool
</span><a href="#local-6989586621689461566"><span class="hs-identifier hs-var hs-var">spiAllowAgg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelPerm b -&gt; Bool
forall (b :: BackendType). SelPerm b -&gt; Bool
</span><a href="Hasura.RQL.Types.Permission.html#spAllowAggregations"><span class="hs-identifier hs-var hs-var">spAllowAggregations</span></a></span><span> </span><span class="annot"><span class="annottext">SelPerm b
</span><a href="#local-6989586621689461598"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-453"></span><span>    </span><span id="local-6989586621689461591"><span class="annot"><span class="annottext">computedFields :: [ComputedFieldName]
</span><a href="#local-6989586621689461591"><span class="hs-identifier hs-var hs-var">computedFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelPerm b -&gt; [ComputedFieldName]
forall (b :: BackendType). SelPerm b -&gt; [ComputedFieldName]
</span><a href="Hasura.RQL.Types.Permission.html#spComputedFields"><span class="hs-identifier hs-var hs-var">spComputedFields</span></a></span><span> </span><span class="annot"><span class="annottext">SelPerm b
</span><a href="#local-6989586621689461598"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-454"></span><span>    </span><span id="local-6989586621689461593"><span class="annot"><span class="annottext">autoInferredErr :: Text
</span><a href="#local-6989586621689461593"><span class="hs-identifier hs-var hs-var">autoInferredErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;permissions for relationships are automatically inferred&quot;</span></span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#buildUpdPermInfo"><span class="hs-identifier hs-type">buildUpdPermInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-457"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689462048"><span class="annot"><a href="#local-6989586621689462048"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621689462049"><span class="annot"><a href="#local-6989586621689462049"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-458"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462049"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#TableCoreInfoRM"><span class="hs-identifier hs-type">TableCoreInfoRM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462048"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462049"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462048"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-459"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-460"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462048"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-461"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Table.html#FieldInfoMap"><span class="hs-identifier hs-type">FieldInfoMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Table.html#FieldInfo"><span class="hs-identifier hs-type">FieldInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462048"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-462"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#UpdPerm"><span class="hs-identifier hs-type">UpdPerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462048"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-463"></span><span>  </span><span class="annot"><a href="#local-6989586621689462049"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#WithDeps"><span class="hs-identifier hs-type">WithDeps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Table.html#UpdPermInfo"><span class="hs-identifier hs-type">UpdPermInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462048"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span id="buildUpdPermInfo"><span class="annot"><span class="annottext">buildUpdPermInfo :: SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; UpdPerm b
-&gt; m (WithDeps (UpdPermInfo b))
</span><a href="Hasura.RQL.DDL.Permission.html#buildUpdPermInfo"><span class="hs-identifier hs-var hs-var">buildUpdPermInfo</span></a></span></span><span> </span><span id="local-6989586621689461557"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461557"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621689461556"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461556"><span class="hs-identifier hs-var">tn</span></a></span></span><span> </span><span id="local-6989586621689461555"><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461555"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#UpdPerm"><span class="hs-identifier hs-type">UpdPerm</span></a></span><span> </span><span id="local-6989586621689461553"><span class="annot"><span class="annottext">PermColSpec b
</span><a href="#local-6989586621689461553"><span class="hs-identifier hs-var">colSpec</span></a></span></span><span> </span><span id="local-6989586621689461552"><span class="annot"><span class="annottext">Maybe (ColumnValues b Value)
</span><a href="#local-6989586621689461552"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span id="local-6989586621689461551"><span class="annot"><span class="annottext">BoolExp b
</span><a href="#local-6989586621689461551"><span class="hs-identifier hs-var">fltr</span></a></span></span><span> </span><span id="local-6989586621689461550"><span class="annot"><span class="annottext">Maybe (BoolExp b)
</span><a href="#local-6989586621689461550"><span class="hs-identifier hs-var">check</span></a></span></span><span> </span><span id="local-6989586621689461549"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689461549"><span class="hs-identifier hs-var">backendOnly</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-465"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621689461548"><span class="annot"><span class="annottext">AnnBoolExpPartialSQL b
</span><a href="#local-6989586621689461548"><span class="hs-identifier hs-var">be</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689461547"><span class="annot"><span class="annottext">[SchemaDependency]
</span><a href="#local-6989586621689461547"><span class="hs-identifier hs-var">beDeps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-466"></span><span>    </span><span class="annot"><span class="annottext">Text
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#withPathK"><span class="hs-identifier hs-var">withPathK</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;filter&quot;</span></span><span> </span><span class="annot"><span class="annottext">(m (AnnBoolExpPartialSQL b, [SchemaDependency])
 -&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency]))
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-467"></span><span>      </span><span class="annot"><span class="annottext">SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; BoolExp b
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
forall (m :: * -&gt; *) (b :: BackendType).
(QErrM m, TableCoreInfoRM b m, BackendMetadata b) =&gt;
SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; BoolExp b
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
</span><a href="Hasura.RQL.DDL.Permission.Internal.html#procBoolExp"><span class="hs-identifier hs-var">procBoolExp</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461557"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461556"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461555"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp b
</span><a href="#local-6989586621689461551"><span class="hs-identifier hs-var">fltr</span></a></span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span>  </span><span id="local-6989586621689461546"><span class="annot"><span class="annottext">Maybe (AnnBoolExpPartialSQL b, [SchemaDependency])
</span><a href="#local-6989586621689461546"><span class="hs-identifier hs-var">checkExpr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(BoolExp b -&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency]))
-&gt; Maybe (BoolExp b)
-&gt; m (Maybe (AnnBoolExpPartialSQL b, [SchemaDependency]))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#withPathK"><span class="hs-identifier hs-var">withPathK</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;check&quot;</span></span><span> </span><span class="annot"><span class="annottext">(m (AnnBoolExpPartialSQL b, [SchemaDependency])
 -&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency]))
-&gt; (BoolExp b -&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency]))
-&gt; BoolExp b
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; BoolExp b
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
forall (m :: * -&gt; *) (b :: BackendType).
(QErrM m, TableCoreInfoRM b m, BackendMetadata b) =&gt;
SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; BoolExp b
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
</span><a href="Hasura.RQL.DDL.Permission.Internal.html#procBoolExp"><span class="hs-identifier hs-var">procBoolExp</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461557"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461556"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461555"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (BoolExp b)
</span><a href="#local-6989586621689461550"><span class="hs-identifier hs-var">check</span></a></span><span>
</span><span id="line-470"></span><span>
</span><span id="line-471"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621689461544"><span class="annot"><span class="annottext">HashMap (Column b) (PartialSQLExp b)
</span><a href="#local-6989586621689461544"><span class="hs-identifier hs-var">setColsSQL</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689461543"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621689461543"><span class="hs-identifier hs-var">setHeaders</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689461542"><span class="annot"><span class="annottext">[SchemaDependency]
</span><a href="#local-6989586621689461542"><span class="hs-identifier hs-var">setColDeps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; Maybe (ColumnValues b Value)
-&gt; m (HashMap (Column b) (PartialSQLExp b), [Text],
      [SchemaDependency])
forall (b :: BackendType) (m :: * -&gt; *).
(QErrM m, BackendMetadata b) =&gt;
SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; Maybe (ColumnValues b Value)
-&gt; m (PreSetColsPartial b, [Text], [SchemaDependency])
</span><a href="Hasura.RQL.DDL.Permission.html#procSetObj"><span class="hs-identifier hs-var">procSetObj</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461557"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461556"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461555"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ColumnValues b Value)
</span><a href="#local-6989586621689461552"><span class="hs-identifier hs-var">set</span></a></span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span>  </span><span class="hs-comment">-- check if the columns exist</span><span>
</span><span id="line-474"></span><span>  </span><span class="annot"><span class="annottext">m [()] -&gt; m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(m [()] -&gt; m ()) -&gt; m [()] -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-475"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; m [()] -&gt; m [()]
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#withPathK"><span class="hs-identifier hs-var">withPathK</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;columns&quot;</span></span><span> </span><span class="annot"><span class="annottext">(m [()] -&gt; m [()]) -&gt; m [()] -&gt; m [()]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-476"></span><span>      </span><span class="annot"><span class="annottext">[Column b] -&gt; (Column b -&gt; m ()) -&gt; m [()]
forall (m :: * -&gt; *) a b. QErrM m =&gt; [a] -&gt; (a -&gt; m b) -&gt; m [b]
</span><a href="Hasura.Base.Error.html#indexedForM"><span class="hs-identifier hs-var">indexedForM</span></a></span><span> </span><span class="annot"><span class="annottext">[Column b]
</span><a href="#local-6989586621689461541"><span class="hs-identifier hs-var">updCols</span></a></span><span> </span><span class="annot"><span class="annottext">((Column b -&gt; m ()) -&gt; m [()]) -&gt; (Column b -&gt; m ()) -&gt; m [()]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689461540"><span class="annot"><span class="annottext">Column b
</span><a href="#local-6989586621689461540"><span class="hs-identifier hs-var">updCol</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-477"></span><span>        </span><span class="hs-comment">-- Check that all columns specified do in fact exist and are columns</span><span>
</span><span id="line-478"></span><span>        </span><span class="annot"><span class="annottext">ColumnType b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b) -&gt; Column b -&gt; Text -&gt; m (ColumnType b)
forall (m :: * -&gt; *) (backend :: BackendType).
(MonadError QErr m, Backend backend) =&gt;
FieldInfoMap (FieldInfo backend)
-&gt; Column backend -&gt; Text -&gt; m (ColumnType backend)
</span><a href="Hasura.RQL.Types.Table.html#askColumnType"><span class="hs-identifier hs-var">askColumnType</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461555"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">Column b
</span><a href="#local-6989586621689461540"><span class="hs-identifier hs-var">updCol</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689461539"><span class="hs-identifier hs-var">relInUpdErr</span></a></span><span>
</span><span id="line-479"></span><span>        </span><span class="hs-comment">-- Check that the column is updatable</span><span>
</span><span id="line-480"></span><span>        </span><span id="local-6989586621689461538"><span class="annot"><span class="annottext">ColumnInfo b
</span><a href="#local-6989586621689461538"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b) -&gt; Column b -&gt; Text -&gt; m (ColumnInfo b)
forall (m :: * -&gt; *) (backend :: BackendType).
(MonadError QErr m, Backend backend) =&gt;
FieldInfoMap (FieldInfo backend)
-&gt; Column backend -&gt; Text -&gt; m (ColumnInfo backend)
</span><a href="Hasura.RQL.Types.Table.html#askColInfo"><span class="hs-identifier hs-var">askColInfo</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461555"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">Column b
</span><a href="#local-6989586621689461540"><span class="hs-identifier hs-var">updCol</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-481"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ColumnMutability -&gt; Bool
</span><a href="Hasura.RQL.Types.Column.html#_cmIsUpdatable"><span class="hs-identifier hs-var hs-var">_cmIsUpdatable</span></a></span><span> </span><span class="annot"><span class="annottext">(ColumnMutability -&gt; Bool) -&gt; ColumnMutability -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b -&gt; ColumnMutability
forall (b :: BackendType). ColumnInfo b -&gt; ColumnMutability
</span><a href="Hasura.RQL.Types.Column.html#ciMutability"><span class="hs-identifier hs-var hs-var">ciMutability</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b
</span><a href="#local-6989586621689461538"><span class="hs-identifier hs-var">ci</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-482"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw500"><span class="hs-identifier hs-var">throw500</span></a></span><span>
</span><span id="line-483"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Column &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Column b
</span><a href="#local-6989586621689461540"><span class="hs-identifier hs-var">updCol</span></a></span><span>
</span><span id="line-484"></span><span>                </span><span class="annot"><span class="annottext">Column b -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; is not updatable and so cannot have update permissions defined&quot;</span></span><span>
</span><span id="line-485"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689461536"><span class="annot"><span class="annottext">updColDeps :: [SchemaDependency]
</span><a href="#local-6989586621689461536"><span class="hs-identifier hs-var hs-var">updColDeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Column b -&gt; SchemaDependency) -&gt; [Column b] -&gt; [SchemaDependency]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DependencyReason
-&gt; SourceName -&gt; TableName b -&gt; Column b -&gt; SchemaDependency
forall (b :: BackendType).
Backend b =&gt;
DependencyReason
-&gt; SourceName -&gt; TableName b -&gt; Column b -&gt; SchemaDependency
</span><a href="Hasura.RQL.Types.SchemaCache.html#mkColDep"><span class="hs-identifier hs-var">mkColDep</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689462048"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">DependencyReason
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#DRUntyped"><span class="hs-identifier hs-var">DRUntyped</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461557"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461556"><span class="hs-identifier hs-var">tn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Column b]
</span><a href="#local-6989586621689461541"><span class="hs-identifier hs-var">updCols</span></a></span><span>
</span><span id="line-488"></span><span>      </span><span id="local-6989586621689461535"><span class="annot"><span class="annottext">deps :: [SchemaDependency]
</span><a href="#local-6989586621689461535"><span class="hs-identifier hs-var hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; TableName b -&gt; SchemaDependency
forall (b :: BackendType).
Backend b =&gt;
SourceName -&gt; TableName b -&gt; SchemaDependency
</span><a href="Hasura.RQL.Types.SchemaCache.html#mkParentDep"><span class="hs-identifier hs-var">mkParentDep</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689462048"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461557"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461556"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaDependency -&gt; [SchemaDependency] -&gt; [SchemaDependency]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[SchemaDependency]
</span><a href="#local-6989586621689461547"><span class="hs-identifier hs-var">beDeps</span></a></span><span> </span><span class="annot"><span class="annottext">[SchemaDependency] -&gt; [SchemaDependency] -&gt; [SchemaDependency]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[SchemaDependency]
-&gt; ((AnnBoolExpPartialSQL b, [SchemaDependency])
    -&gt; [SchemaDependency])
-&gt; Maybe (AnnBoolExpPartialSQL b, [SchemaDependency])
-&gt; [SchemaDependency]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(AnnBoolExpPartialSQL b, [SchemaDependency]) -&gt; [SchemaDependency]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">Maybe (AnnBoolExpPartialSQL b, [SchemaDependency])
</span><a href="#local-6989586621689461546"><span class="hs-identifier hs-var">checkExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[SchemaDependency] -&gt; [SchemaDependency] -&gt; [SchemaDependency]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[SchemaDependency]
</span><a href="#local-6989586621689461536"><span class="hs-identifier hs-var">updColDeps</span></a></span><span> </span><span class="annot"><span class="annottext">[SchemaDependency] -&gt; [SchemaDependency] -&gt; [SchemaDependency]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[SchemaDependency]
</span><a href="#local-6989586621689461542"><span class="hs-identifier hs-var">setColDeps</span></a></span><span>
</span><span id="line-489"></span><span>      </span><span id="local-6989586621689461533"><span class="annot"><span class="annottext">depHeaders :: HashSet Text
</span><a href="#local-6989586621689461533"><span class="hs-identifier hs-var hs-var">depHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BoolExp b -&gt; HashSet Text
forall (b :: BackendType). BoolExp b -&gt; HashSet Text
</span><a href="Hasura.RQL.DDL.Permission.Internal.html#getDependentHeaders"><span class="hs-identifier hs-var">getDependentHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp b
</span><a href="#local-6989586621689461551"><span class="hs-identifier hs-var">fltr</span></a></span><span>
</span><span id="line-490"></span><span>      </span><span id="local-6989586621689461532"><span class="annot"><span class="annottext">reqHeaders :: HashSet Text
</span><a href="#local-6989586621689461532"><span class="hs-identifier hs-var hs-var">reqHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet Text
</span><a href="#local-6989586621689461533"><span class="hs-identifier hs-var">depHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet Text -&gt; HashSet Text -&gt; HashSet Text
forall a. (Eq a, Hashable a) =&gt; HashSet a -&gt; HashSet a -&gt; HashSet a
</span><span class="hs-operator hs-var">`HS.union`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; HashSet Text
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><span class="hs-identifier hs-var">HS.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621689461543"><span class="hs-identifier hs-var">setHeaders</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span>      </span><span id="local-6989586621689461531"><span class="annot"><span class="annottext">updColsWithoutPreSets :: [Column b]
</span><a href="#local-6989586621689461531"><span class="hs-identifier hs-var hs-var">updColsWithoutPreSets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Column b]
</span><a href="#local-6989586621689461541"><span class="hs-identifier hs-var">updCols</span></a></span><span> </span><span class="annot"><span class="annottext">[Column b] -&gt; [Column b] -&gt; [Column b]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">\\</span></span><span> </span><span class="annot"><span class="annottext">HashMap (Column b) (PartialSQLExp b) -&gt; [Column b]
forall k v. HashMap k v -&gt; [k]
</span><span class="hs-identifier hs-var">HM.keys</span></span><span> </span><span class="annot"><span class="annottext">HashMap (Column b) (PartialSQLExp b)
</span><a href="#local-6989586621689461544"><span class="hs-identifier hs-var">setColsSQL</span></a></span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span>  </span><span class="annot"><span class="annottext">WithDeps (UpdPermInfo b) -&gt; m (WithDeps (UpdPermInfo b))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashSet (Column b)
-&gt; TableName b
-&gt; AnnBoolExpPartialSQL b
-&gt; Maybe (AnnBoolExpPartialSQL b)
-&gt; HashMap (Column b) (PartialSQLExp b)
-&gt; Bool
-&gt; HashSet Text
-&gt; UpdPermInfo b
forall (b :: BackendType).
HashSet (Column b)
-&gt; TableName b
-&gt; AnnBoolExpPartialSQL b
-&gt; Maybe (AnnBoolExpPartialSQL b)
-&gt; PreSetColsPartial b
-&gt; Bool
-&gt; HashSet Text
-&gt; UpdPermInfo b
</span><a href="Hasura.RQL.Types.Table.html#UpdPermInfo"><span class="hs-identifier hs-var">UpdPermInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Column b] -&gt; HashSet (Column b)
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><span class="hs-identifier hs-var">HS.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Column b]
</span><a href="#local-6989586621689461531"><span class="hs-identifier hs-var">updColsWithoutPreSets</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461556"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">AnnBoolExpPartialSQL b
</span><a href="#local-6989586621689461548"><span class="hs-identifier hs-var">be</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(AnnBoolExpPartialSQL b, [SchemaDependency])
-&gt; AnnBoolExpPartialSQL b
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((AnnBoolExpPartialSQL b, [SchemaDependency])
 -&gt; AnnBoolExpPartialSQL b)
-&gt; Maybe (AnnBoolExpPartialSQL b, [SchemaDependency])
-&gt; Maybe (AnnBoolExpPartialSQL b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (AnnBoolExpPartialSQL b, [SchemaDependency])
</span><a href="#local-6989586621689461546"><span class="hs-identifier hs-var">checkExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap (Column b) (PartialSQLExp b)
</span><a href="#local-6989586621689461544"><span class="hs-identifier hs-var">setColsSQL</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689461549"><span class="hs-identifier hs-var">backendOnly</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet Text
</span><a href="#local-6989586621689461532"><span class="hs-identifier hs-var">reqHeaders</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SchemaDependency]
</span><a href="#local-6989586621689461535"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-495"></span><span>    </span><span id="local-6989586621689461528"><span class="annot"><span class="annottext">allUpdCols :: [Column b]
</span><a href="#local-6989586621689461528"><span class="hs-identifier hs-var hs-var">allUpdCols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ColumnInfo b -&gt; Column b) -&gt; [ColumnInfo b] -&gt; [Column b]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b -&gt; Column b
forall (b :: BackendType). ColumnInfo b -&gt; Column b
</span><a href="Hasura.RQL.Types.Column.html#ciColumn"><span class="hs-identifier hs-var hs-var">ciColumn</span></a></span><span> </span><span class="annot"><span class="annottext">([ColumnInfo b] -&gt; [Column b]) -&gt; [ColumnInfo b] -&gt; [Column b]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ColumnInfo b -&gt; Bool) -&gt; [ColumnInfo b] -&gt; [ColumnInfo b]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ColumnMutability -&gt; Bool
</span><a href="Hasura.RQL.Types.Column.html#_cmIsUpdatable"><span class="hs-identifier hs-var hs-var">_cmIsUpdatable</span></a></span><span> </span><span class="annot"><span class="annottext">(ColumnMutability -&gt; Bool)
-&gt; (ColumnInfo b -&gt; ColumnMutability) -&gt; ColumnInfo b -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b -&gt; ColumnMutability
forall (b :: BackendType). ColumnInfo b -&gt; ColumnMutability
</span><a href="Hasura.RQL.Types.Column.html#ciMutability"><span class="hs-identifier hs-var hs-var">ciMutability</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ColumnInfo b] -&gt; [ColumnInfo b])
-&gt; [ColumnInfo b] -&gt; [ColumnInfo b]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b) -&gt; [ColumnInfo b]
forall (backend :: BackendType).
FieldInfoMap (FieldInfo backend) -&gt; [ColumnInfo backend]
</span><a href="Hasura.RQL.Types.Table.html#getCols"><span class="hs-identifier hs-var">getCols</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461555"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span><span>
</span><span id="line-496"></span><span>    </span><span id="local-6989586621689461541"><span class="annot"><span class="annottext">updCols :: [Column b]
</span><a href="#local-6989586621689461541"><span class="hs-identifier hs-var hs-var">updCols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Column b] -&gt; PermColSpec b -&gt; [Column b]
forall (b :: BackendType).
[Column b] -&gt; PermColSpec b -&gt; [Column b]
</span><a href="Hasura.RQL.DDL.Permission.Internal.html#interpColSpec"><span class="hs-identifier hs-var">interpColSpec</span></a></span><span> </span><span class="annot"><span class="annottext">[Column b]
</span><a href="#local-6989586621689461528"><span class="hs-identifier hs-var">allUpdCols</span></a></span><span> </span><span class="annot"><span class="annottext">PermColSpec b
</span><a href="#local-6989586621689461553"><span class="hs-identifier hs-var">colSpec</span></a></span><span>
</span><span id="line-497"></span><span>    </span><span id="local-6989586621689461539"><span class="annot"><span class="annottext">relInUpdErr :: Text
</span><a href="#local-6989586621689461539"><span class="hs-identifier hs-var hs-var">relInUpdErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Only table columns can have update permissions defined, not relationships or other field types&quot;</span></span><span>
</span><span id="line-498"></span><span>
</span><span id="line-499"></span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#buildDelPermInfo"><span class="hs-identifier hs-type">buildDelPermInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-500"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689462045"><span class="annot"><a href="#local-6989586621689462045"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621689462046"><span class="annot"><a href="#local-6989586621689462046"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-501"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462046"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#TableCoreInfoRM"><span class="hs-identifier hs-type">TableCoreInfoRM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462045"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462046"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462045"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-502"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-503"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462045"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-504"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Table.html#FieldInfoMap"><span class="hs-identifier hs-type">FieldInfoMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Table.html#FieldInfo"><span class="hs-identifier hs-type">FieldInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462045"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-505"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#DelPerm"><span class="hs-identifier hs-type">DelPerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462045"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-506"></span><span>  </span><span class="annot"><a href="#local-6989586621689462046"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#WithDeps"><span class="hs-identifier hs-type">WithDeps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Table.html#DelPermInfo"><span class="hs-identifier hs-type">DelPermInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689462045"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span id="buildDelPermInfo"><span class="annot"><span class="annottext">buildDelPermInfo :: SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; DelPerm b
-&gt; m (WithDeps (DelPermInfo b))
</span><a href="Hasura.RQL.DDL.Permission.html#buildDelPermInfo"><span class="hs-identifier hs-var hs-var">buildDelPermInfo</span></a></span></span><span> </span><span id="local-6989586621689461527"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461527"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621689461526"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461526"><span class="hs-identifier hs-var">tn</span></a></span></span><span> </span><span id="local-6989586621689461525"><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461525"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#DelPerm"><span class="hs-identifier hs-type">DelPerm</span></a></span><span> </span><span id="local-6989586621689461523"><span class="annot"><span class="annottext">BoolExp b
</span><a href="#local-6989586621689461523"><span class="hs-identifier hs-var">fltr</span></a></span></span><span> </span><span id="local-6989586621689461522"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689461522"><span class="hs-identifier hs-var">backendOnly</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-508"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621689461521"><span class="annot"><span class="annottext">AnnBoolExpPartialSQL b
</span><a href="#local-6989586621689461521"><span class="hs-identifier hs-var">be</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689461520"><span class="annot"><span class="annottext">[SchemaDependency]
</span><a href="#local-6989586621689461520"><span class="hs-identifier hs-var">beDeps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-509"></span><span>    </span><span class="annot"><span class="annottext">Text
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#withPathK"><span class="hs-identifier hs-var">withPathK</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;filter&quot;</span></span><span> </span><span class="annot"><span class="annottext">(m (AnnBoolExpPartialSQL b, [SchemaDependency])
 -&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency]))
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-510"></span><span>      </span><span class="annot"><span class="annottext">SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; BoolExp b
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
forall (m :: * -&gt; *) (b :: BackendType).
(QErrM m, TableCoreInfoRM b m, BackendMetadata b) =&gt;
SourceName
-&gt; TableName b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; BoolExp b
-&gt; m (AnnBoolExpPartialSQL b, [SchemaDependency])
</span><a href="Hasura.RQL.DDL.Permission.Internal.html#procBoolExp"><span class="hs-identifier hs-var">procBoolExp</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461527"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461526"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621689461525"><span class="hs-identifier hs-var">fieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp b
</span><a href="#local-6989586621689461523"><span class="hs-identifier hs-var">fltr</span></a></span><span>
</span><span id="line-511"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689461519"><span class="annot"><span class="annottext">deps :: [SchemaDependency]
</span><a href="#local-6989586621689461519"><span class="hs-identifier hs-var hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; TableName b -&gt; SchemaDependency
forall (b :: BackendType).
Backend b =&gt;
SourceName -&gt; TableName b -&gt; SchemaDependency
</span><a href="Hasura.RQL.Types.SchemaCache.html#mkParentDep"><span class="hs-identifier hs-var">mkParentDep</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689462045"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461527"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461526"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaDependency -&gt; [SchemaDependency] -&gt; [SchemaDependency]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[SchemaDependency]
</span><a href="#local-6989586621689461520"><span class="hs-identifier hs-var">beDeps</span></a></span><span>
</span><span id="line-512"></span><span>      </span><span id="local-6989586621689461518"><span class="annot"><span class="annottext">depHeaders :: HashSet Text
</span><a href="#local-6989586621689461518"><span class="hs-identifier hs-var hs-var">depHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BoolExp b -&gt; HashSet Text
forall (b :: BackendType). BoolExp b -&gt; HashSet Text
</span><a href="Hasura.RQL.DDL.Permission.Internal.html#getDependentHeaders"><span class="hs-identifier hs-var">getDependentHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp b
</span><a href="#local-6989586621689461523"><span class="hs-identifier hs-var">fltr</span></a></span><span>
</span><span id="line-513"></span><span>  </span><span class="annot"><span class="annottext">WithDeps (DelPermInfo b) -&gt; m (WithDeps (DelPermInfo b))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableName b
-&gt; AnnBoolExpPartialSQL b -&gt; Bool -&gt; HashSet Text -&gt; DelPermInfo b
forall (b :: BackendType).
TableName b
-&gt; AnnBoolExpPartialSQL b -&gt; Bool -&gt; HashSet Text -&gt; DelPermInfo b
</span><a href="Hasura.RQL.Types.Table.html#DelPermInfo"><span class="hs-identifier hs-var">DelPermInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461526"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">AnnBoolExpPartialSQL b
</span><a href="#local-6989586621689461521"><span class="hs-identifier hs-var">be</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689461522"><span class="hs-identifier hs-var">backendOnly</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet Text
</span><a href="#local-6989586621689461518"><span class="hs-identifier hs-var">depHeaders</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SchemaDependency]
</span><a href="#local-6989586621689461519"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span>
</span><span id="line-515"></span><span class="hs-keyword">data</span><span> </span><span id="SetPermComment"><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#SetPermComment"><span class="hs-identifier hs-var">SetPermComment</span></a></span></span><span> </span><span id="local-6989586621689461862"><span class="annot"><a href="#local-6989586621689461862"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SetPermComment"><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#SetPermComment"><span class="hs-identifier hs-var">SetPermComment</span></a></span></span><span>
</span><span id="line-516"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="apSource"><span class="annot"><span class="annottext">SetPermComment b -&gt; SourceName
</span><a href="Hasura.RQL.DDL.Permission.html#apSource"><span class="hs-identifier hs-var hs-var">apSource</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-517"></span><span>    </span><span id="apTable"><span class="annot"><span class="annottext">SetPermComment b -&gt; TableName b
</span><a href="Hasura.RQL.DDL.Permission.html#apTable"><span class="hs-identifier hs-var hs-var">apTable</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461862"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-518"></span><span>    </span><span id="apRole"><span class="annot"><span class="annottext">SetPermComment b -&gt; RoleName
</span><a href="Hasura.RQL.DDL.Permission.html#apRole"><span class="hs-identifier hs-var hs-var">apRole</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Session.html#RoleName"><span class="hs-identifier hs-type">RoleName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-519"></span><span>    </span><span id="apPermission"><span class="annot"><span class="annottext">SetPermComment b -&gt; PermType
</span><a href="Hasura.RQL.DDL.Permission.html#apPermission"><span class="hs-identifier hs-var hs-var">apPermission</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Permission.html#PermType"><span class="hs-identifier hs-type">PermType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-520"></span><span>    </span><span id="apComment"><span class="annot"><span class="annottext">SetPermComment b -&gt; Maybe Text
</span><a href="Hasura.RQL.DDL.Permission.html#apComment"><span class="hs-identifier hs-var hs-var">apComment</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-521"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span id="local-6989586621689461510"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621689461507"><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461510"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#SetPermComment"><span class="hs-identifier hs-type">SetPermComment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461510"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-524"></span><span>  </span><span id="local-6989586621689461505"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser (SetPermComment b)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Object -&gt; Parser (SetPermComment b))
-&gt; Value
-&gt; Parser (SetPermComment b)
forall a. String -&gt; (Object -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">withObject</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SetPermComment&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Object -&gt; Parser (SetPermComment b))
 -&gt; Value -&gt; Parser (SetPermComment b))
-&gt; (Object -&gt; Parser (SetPermComment b))
-&gt; Value
-&gt; Parser (SetPermComment b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689461502"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621689461502"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-525"></span><span>    </span><span class="annot"><span class="annottext">SourceName
-&gt; TableName b
-&gt; RoleName
-&gt; PermType
-&gt; Maybe Text
-&gt; SetPermComment b
forall (b :: BackendType).
SourceName
-&gt; TableName b
-&gt; RoleName
-&gt; PermType
-&gt; Maybe Text
-&gt; SetPermComment b
</span><a href="Hasura.RQL.DDL.Permission.html#SetPermComment"><span class="hs-identifier hs-var">SetPermComment</span></a></span><span>
</span><span id="line-526"></span><span>      </span><span class="annot"><span class="annottext">(SourceName
 -&gt; TableName b
 -&gt; RoleName
 -&gt; PermType
 -&gt; Maybe Text
 -&gt; SetPermComment b)
-&gt; Parser SourceName
-&gt; Parser
     (TableName b
      -&gt; RoleName -&gt; PermType -&gt; Maybe Text -&gt; SetPermComment b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621689461502"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser (Maybe SourceName)
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser (Maybe a)
</span><span class="hs-operator hs-var">.:?</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;source&quot;</span></span><span> </span><span class="annot"><span class="annottext">Parser (Maybe SourceName) -&gt; SourceName -&gt; Parser SourceName
forall a. Parser (Maybe a) -&gt; a -&gt; Parser a
</span><span class="hs-operator hs-var">.!=</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="Hasura.RQL.Types.Common.html#defaultSource"><span class="hs-identifier hs-var">defaultSource</span></a></span><span>
</span><span id="line-527"></span><span>      </span><span class="annot"><span class="annottext">Parser
  (TableName b
   -&gt; RoleName -&gt; PermType -&gt; Maybe Text -&gt; SetPermComment b)
-&gt; Parser (TableName b)
-&gt; Parser (RoleName -&gt; PermType -&gt; Maybe Text -&gt; SetPermComment b)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621689461502"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser (TableName b)
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;table&quot;</span></span><span>
</span><span id="line-528"></span><span>      </span><span class="annot"><span class="annottext">Parser (RoleName -&gt; PermType -&gt; Maybe Text -&gt; SetPermComment b)
-&gt; Parser RoleName
-&gt; Parser (PermType -&gt; Maybe Text -&gt; SetPermComment b)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621689461502"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser RoleName
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;role&quot;</span></span><span>
</span><span id="line-529"></span><span>      </span><span class="annot"><span class="annottext">Parser (PermType -&gt; Maybe Text -&gt; SetPermComment b)
-&gt; Parser PermType -&gt; Parser (Maybe Text -&gt; SetPermComment b)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621689461502"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser PermType
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;permission&quot;</span></span><span>
</span><span id="line-530"></span><span>      </span><span class="annot"><span class="annottext">Parser (Maybe Text -&gt; SetPermComment b)
-&gt; Parser (Maybe Text) -&gt; Parser (SetPermComment b)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621689461502"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser (Maybe Text)
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser (Maybe a)
</span><span class="hs-operator hs-var">.:?</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;comment&quot;</span></span></span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#runSetPermComment"><span class="hs-identifier hs-type">runSetPermComment</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-533"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689461497"><span class="annot"><a href="#local-6989586621689461497"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621689461496"><span class="annot"><a href="#local-6989586621689461496"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-534"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461496"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461496"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461496"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461497"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-535"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#SetPermComment"><span class="hs-identifier hs-type">SetPermComment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689461497"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-536"></span><span>  </span><span class="annot"><a href="#local-6989586621689461496"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span>
</span><span id="line-537"></span><span id="runSetPermComment"><span class="annot"><span class="annottext">runSetPermComment :: SetPermComment b -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Permission.html#runSetPermComment"><span class="hs-identifier hs-var hs-var">runSetPermComment</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html#SetPermComment"><span class="hs-identifier hs-type">SetPermComment</span></a></span><span> </span><span id="local-6989586621689461495"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461495"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621689461494"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461494"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span id="local-6989586621689461493"><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461493"><span class="hs-identifier hs-var">roleName</span></a></span></span><span> </span><span id="local-6989586621689461492"><span class="annot"><span class="annottext">PermType
</span><a href="#local-6989586621689461492"><span class="hs-identifier hs-var">permType</span></a></span></span><span> </span><span id="local-6989586621689461491"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689461491"><span class="hs-identifier hs-var">comment</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-538"></span><span>  </span><span id="local-6989586621689461490"><span class="annot"><span class="annottext">TableInfo b
</span><a href="#local-6989586621689461490"><span class="hs-identifier hs-var">tableInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; TableName b -&gt; m (TableInfo b)
forall (b :: BackendType) (m :: * -&gt; *).
(QErrM m, CacheRM m, Backend b) =&gt;
SourceName -&gt; TableName b -&gt; m (TableInfo b)
</span><a href="Hasura.RQL.Types.SchemaCache.html#askTableInfo"><span class="hs-identifier hs-var">askTableInfo</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689461497"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461495"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461494"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-539"></span><span>
</span><span id="line-540"></span><span>  </span><span class="hs-comment">-- assert permission exists and return appropriate permission modifier</span><span>
</span><span id="line-541"></span><span>  </span><span id="local-6989586621689461488"><span class="annot"><span class="annottext">TableMetadata b -&gt; TableMetadata b
</span><a href="#local-6989586621689461488"><span class="hs-identifier hs-var">permModifier</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PermType
</span><a href="#local-6989586621689461492"><span class="hs-identifier hs-var">permType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-542"></span><span>    </span><span class="annot"><span class="annottext">PermType
</span><a href="Hasura.RQL.Types.Permission.html#PTInsert"><span class="hs-identifier hs-var">PTInsert</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-543"></span><span>      </span><span class="annot"><span class="annottext">RoleName -&gt; PermType -&gt; TableInfo b -&gt; m ()
forall (backend :: BackendType) (m :: * -&gt; *).
(Backend backend, MonadError QErr m) =&gt;
RoleName -&gt; PermType -&gt; TableInfo backend -&gt; m ()
</span><a href="Hasura.RQL.DDL.Permission.Internal.html#assertPermDefined"><span class="hs-identifier hs-var">assertPermDefined</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461493"><span class="hs-identifier hs-var">roleName</span></a></span><span> </span><span class="annot"><span class="annottext">PermType
</span><a href="Hasura.RQL.Types.Permission.html#PTInsert"><span class="hs-identifier hs-var">PTInsert</span></a></span><span> </span><span class="annot"><span class="annottext">TableInfo b
</span><a href="#local-6989586621689461490"><span class="hs-identifier hs-var">tableInfo</span></a></span><span>
</span><span id="line-544"></span><span>      </span><span class="annot"><span class="annottext">(TableMetadata b -&gt; TableMetadata b)
-&gt; m (TableMetadata b -&gt; TableMetadata b)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((TableMetadata b -&gt; TableMetadata b)
 -&gt; m (TableMetadata b -&gt; TableMetadata b))
-&gt; (TableMetadata b -&gt; TableMetadata b)
-&gt; m (TableMetadata b -&gt; TableMetadata b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Permissions (InsPermDef b)
 -&gt; Identity (Permissions (InsPermDef b)))
-&gt; TableMetadata b -&gt; Identity (TableMetadata b)
forall (b :: BackendType).
Lens' (TableMetadata b) (Permissions (InsPermDef b))
</span><a href="Hasura.RQL.Types.Metadata.Common.html#tmInsertPermissions"><span class="hs-identifier hs-var">tmInsertPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">((Permissions (InsPermDef b)
  -&gt; Identity (Permissions (InsPermDef b)))
 -&gt; TableMetadata b -&gt; Identity (TableMetadata b))
-&gt; ((Maybe Text -&gt; Identity (Maybe Text))
    -&gt; Permissions (InsPermDef b)
    -&gt; Identity (Permissions (InsPermDef b)))
-&gt; (Maybe Text -&gt; Identity (Maybe Text))
-&gt; TableMetadata b
-&gt; Identity (TableMetadata b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Index (Permissions (InsPermDef b))
-&gt; Traversal'
     (Permissions (InsPermDef b)) (IxValue (Permissions (InsPermDef b)))
forall m. Ixed m =&gt; Index m -&gt; Traversal' m (IxValue m)
</span><span class="hs-identifier hs-var">ix</span></span><span> </span><span class="annot"><span class="annottext">Index (Permissions (InsPermDef b))
RoleName
</span><a href="#local-6989586621689461493"><span class="hs-identifier hs-var">roleName</span></a></span><span> </span><span class="annot"><span class="annottext">((InsPermDef b -&gt; Identity (InsPermDef b))
 -&gt; Permissions (InsPermDef b)
 -&gt; Identity (Permissions (InsPermDef b)))
-&gt; ((Maybe Text -&gt; Identity (Maybe Text))
    -&gt; InsPermDef b -&gt; Identity (InsPermDef b))
-&gt; (Maybe Text -&gt; Identity (Maybe Text))
-&gt; Permissions (InsPermDef b)
-&gt; Identity (Permissions (InsPermDef b))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Identity (Maybe Text))
-&gt; InsPermDef b -&gt; Identity (InsPermDef b)
forall (b :: BackendType) (perm :: BackendType -&gt; *).
Lens' (PermDef b perm) (Maybe Text)
</span><a href="Hasura.RQL.Types.Permission.html#pdComment"><span class="hs-identifier hs-var">pdComment</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe Text -&gt; Identity (Maybe Text))
 -&gt; TableMetadata b -&gt; Identity (TableMetadata b))
-&gt; Maybe Text -&gt; TableMetadata b -&gt; TableMetadata b
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689461491"><span class="hs-identifier hs-var">comment</span></a></span><span>
</span><span id="line-545"></span><span>    </span><span class="annot"><span class="annottext">PermType
</span><a href="Hasura.RQL.Types.Permission.html#PTSelect"><span class="hs-identifier hs-var">PTSelect</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-546"></span><span>      </span><span class="annot"><span class="annottext">RoleName -&gt; PermType -&gt; TableInfo b -&gt; m ()
forall (backend :: BackendType) (m :: * -&gt; *).
(Backend backend, MonadError QErr m) =&gt;
RoleName -&gt; PermType -&gt; TableInfo backend -&gt; m ()
</span><a href="Hasura.RQL.DDL.Permission.Internal.html#assertPermDefined"><span class="hs-identifier hs-var">assertPermDefined</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461493"><span class="hs-identifier hs-var">roleName</span></a></span><span> </span><span class="annot"><span class="annottext">PermType
</span><a href="Hasura.RQL.Types.Permission.html#PTSelect"><span class="hs-identifier hs-var">PTSelect</span></a></span><span> </span><span class="annot"><span class="annottext">TableInfo b
</span><a href="#local-6989586621689461490"><span class="hs-identifier hs-var">tableInfo</span></a></span><span>
</span><span id="line-547"></span><span>      </span><span class="annot"><span class="annottext">(TableMetadata b -&gt; TableMetadata b)
-&gt; m (TableMetadata b -&gt; TableMetadata b)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((TableMetadata b -&gt; TableMetadata b)
 -&gt; m (TableMetadata b -&gt; TableMetadata b))
-&gt; (TableMetadata b -&gt; TableMetadata b)
-&gt; m (TableMetadata b -&gt; TableMetadata b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Permissions (SelPermDef b)
 -&gt; Identity (Permissions (SelPermDef b)))
-&gt; TableMetadata b -&gt; Identity (TableMetadata b)
forall (b :: BackendType).
Lens' (TableMetadata b) (Permissions (SelPermDef b))
</span><a href="Hasura.RQL.Types.Metadata.Common.html#tmSelectPermissions"><span class="hs-identifier hs-var">tmSelectPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">((Permissions (SelPermDef b)
  -&gt; Identity (Permissions (SelPermDef b)))
 -&gt; TableMetadata b -&gt; Identity (TableMetadata b))
-&gt; ((Maybe Text -&gt; Identity (Maybe Text))
    -&gt; Permissions (SelPermDef b)
    -&gt; Identity (Permissions (SelPermDef b)))
-&gt; (Maybe Text -&gt; Identity (Maybe Text))
-&gt; TableMetadata b
-&gt; Identity (TableMetadata b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Index (Permissions (SelPermDef b))
-&gt; Traversal'
     (Permissions (SelPermDef b)) (IxValue (Permissions (SelPermDef b)))
forall m. Ixed m =&gt; Index m -&gt; Traversal' m (IxValue m)
</span><span class="hs-identifier hs-var">ix</span></span><span> </span><span class="annot"><span class="annottext">Index (Permissions (SelPermDef b))
RoleName
</span><a href="#local-6989586621689461493"><span class="hs-identifier hs-var">roleName</span></a></span><span> </span><span class="annot"><span class="annottext">((SelPermDef b -&gt; Identity (SelPermDef b))
 -&gt; Permissions (SelPermDef b)
 -&gt; Identity (Permissions (SelPermDef b)))
-&gt; ((Maybe Text -&gt; Identity (Maybe Text))
    -&gt; SelPermDef b -&gt; Identity (SelPermDef b))
-&gt; (Maybe Text -&gt; Identity (Maybe Text))
-&gt; Permissions (SelPermDef b)
-&gt; Identity (Permissions (SelPermDef b))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Identity (Maybe Text))
-&gt; SelPermDef b -&gt; Identity (SelPermDef b)
forall (b :: BackendType) (perm :: BackendType -&gt; *).
Lens' (PermDef b perm) (Maybe Text)
</span><a href="Hasura.RQL.Types.Permission.html#pdComment"><span class="hs-identifier hs-var">pdComment</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe Text -&gt; Identity (Maybe Text))
 -&gt; TableMetadata b -&gt; Identity (TableMetadata b))
-&gt; Maybe Text -&gt; TableMetadata b -&gt; TableMetadata b
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689461491"><span class="hs-identifier hs-var">comment</span></a></span><span>
</span><span id="line-548"></span><span>    </span><span class="annot"><span class="annottext">PermType
</span><a href="Hasura.RQL.Types.Permission.html#PTUpdate"><span class="hs-identifier hs-var">PTUpdate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-549"></span><span>      </span><span class="annot"><span class="annottext">RoleName -&gt; PermType -&gt; TableInfo b -&gt; m ()
forall (backend :: BackendType) (m :: * -&gt; *).
(Backend backend, MonadError QErr m) =&gt;
RoleName -&gt; PermType -&gt; TableInfo backend -&gt; m ()
</span><a href="Hasura.RQL.DDL.Permission.Internal.html#assertPermDefined"><span class="hs-identifier hs-var">assertPermDefined</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461493"><span class="hs-identifier hs-var">roleName</span></a></span><span> </span><span class="annot"><span class="annottext">PermType
</span><a href="Hasura.RQL.Types.Permission.html#PTUpdate"><span class="hs-identifier hs-var">PTUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TableInfo b
</span><a href="#local-6989586621689461490"><span class="hs-identifier hs-var">tableInfo</span></a></span><span>
</span><span id="line-550"></span><span>      </span><span class="annot"><span class="annottext">(TableMetadata b -&gt; TableMetadata b)
-&gt; m (TableMetadata b -&gt; TableMetadata b)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((TableMetadata b -&gt; TableMetadata b)
 -&gt; m (TableMetadata b -&gt; TableMetadata b))
-&gt; (TableMetadata b -&gt; TableMetadata b)
-&gt; m (TableMetadata b -&gt; TableMetadata b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Permissions (UpdPermDef b)
 -&gt; Identity (Permissions (UpdPermDef b)))
-&gt; TableMetadata b -&gt; Identity (TableMetadata b)
forall (b :: BackendType).
Lens' (TableMetadata b) (Permissions (UpdPermDef b))
</span><a href="Hasura.RQL.Types.Metadata.Common.html#tmUpdatePermissions"><span class="hs-identifier hs-var">tmUpdatePermissions</span></a></span><span> </span><span class="annot"><span class="annottext">((Permissions (UpdPermDef b)
  -&gt; Identity (Permissions (UpdPermDef b)))
 -&gt; TableMetadata b -&gt; Identity (TableMetadata b))
-&gt; ((Maybe Text -&gt; Identity (Maybe Text))
    -&gt; Permissions (UpdPermDef b)
    -&gt; Identity (Permissions (UpdPermDef b)))
-&gt; (Maybe Text -&gt; Identity (Maybe Text))
-&gt; TableMetadata b
-&gt; Identity (TableMetadata b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Index (Permissions (UpdPermDef b))
-&gt; Traversal'
     (Permissions (UpdPermDef b)) (IxValue (Permissions (UpdPermDef b)))
forall m. Ixed m =&gt; Index m -&gt; Traversal' m (IxValue m)
</span><span class="hs-identifier hs-var">ix</span></span><span> </span><span class="annot"><span class="annottext">Index (Permissions (UpdPermDef b))
RoleName
</span><a href="#local-6989586621689461493"><span class="hs-identifier hs-var">roleName</span></a></span><span> </span><span class="annot"><span class="annottext">((UpdPermDef b -&gt; Identity (UpdPermDef b))
 -&gt; Permissions (UpdPermDef b)
 -&gt; Identity (Permissions (UpdPermDef b)))
-&gt; ((Maybe Text -&gt; Identity (Maybe Text))
    -&gt; UpdPermDef b -&gt; Identity (UpdPermDef b))
-&gt; (Maybe Text -&gt; Identity (Maybe Text))
-&gt; Permissions (UpdPermDef b)
-&gt; Identity (Permissions (UpdPermDef b))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Identity (Maybe Text))
-&gt; UpdPermDef b -&gt; Identity (UpdPermDef b)
forall (b :: BackendType) (perm :: BackendType -&gt; *).
Lens' (PermDef b perm) (Maybe Text)
</span><a href="Hasura.RQL.Types.Permission.html#pdComment"><span class="hs-identifier hs-var">pdComment</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe Text -&gt; Identity (Maybe Text))
 -&gt; TableMetadata b -&gt; Identity (TableMetadata b))
-&gt; Maybe Text -&gt; TableMetadata b -&gt; TableMetadata b
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689461491"><span class="hs-identifier hs-var">comment</span></a></span><span>
</span><span id="line-551"></span><span>    </span><span class="annot"><span class="annottext">PermType
</span><a href="Hasura.RQL.Types.Permission.html#PTDelete"><span class="hs-identifier hs-var">PTDelete</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-552"></span><span>      </span><span class="annot"><span class="annottext">RoleName -&gt; PermType -&gt; TableInfo b -&gt; m ()
forall (backend :: BackendType) (m :: * -&gt; *).
(Backend backend, MonadError QErr m) =&gt;
RoleName -&gt; PermType -&gt; TableInfo backend -&gt; m ()
</span><a href="Hasura.RQL.DDL.Permission.Internal.html#assertPermDefined"><span class="hs-identifier hs-var">assertPermDefined</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461493"><span class="hs-identifier hs-var">roleName</span></a></span><span> </span><span class="annot"><span class="annottext">PermType
</span><a href="Hasura.RQL.Types.Permission.html#PTDelete"><span class="hs-identifier hs-var">PTDelete</span></a></span><span> </span><span class="annot"><span class="annottext">TableInfo b
</span><a href="#local-6989586621689461490"><span class="hs-identifier hs-var">tableInfo</span></a></span><span>
</span><span id="line-553"></span><span>      </span><span class="annot"><span class="annottext">(TableMetadata b -&gt; TableMetadata b)
-&gt; m (TableMetadata b -&gt; TableMetadata b)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((TableMetadata b -&gt; TableMetadata b)
 -&gt; m (TableMetadata b -&gt; TableMetadata b))
-&gt; (TableMetadata b -&gt; TableMetadata b)
-&gt; m (TableMetadata b -&gt; TableMetadata b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Permissions (DelPermDef b)
 -&gt; Identity (Permissions (DelPermDef b)))
-&gt; TableMetadata b -&gt; Identity (TableMetadata b)
forall (b :: BackendType).
Lens' (TableMetadata b) (Permissions (DelPermDef b))
</span><a href="Hasura.RQL.Types.Metadata.Common.html#tmDeletePermissions"><span class="hs-identifier hs-var">tmDeletePermissions</span></a></span><span> </span><span class="annot"><span class="annottext">((Permissions (DelPermDef b)
  -&gt; Identity (Permissions (DelPermDef b)))
 -&gt; TableMetadata b -&gt; Identity (TableMetadata b))
-&gt; ((Maybe Text -&gt; Identity (Maybe Text))
    -&gt; Permissions (DelPermDef b)
    -&gt; Identity (Permissions (DelPermDef b)))
-&gt; (Maybe Text -&gt; Identity (Maybe Text))
-&gt; TableMetadata b
-&gt; Identity (TableMetadata b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Index (Permissions (DelPermDef b))
-&gt; Traversal'
     (Permissions (DelPermDef b)) (IxValue (Permissions (DelPermDef b)))
forall m. Ixed m =&gt; Index m -&gt; Traversal' m (IxValue m)
</span><span class="hs-identifier hs-var">ix</span></span><span> </span><span class="annot"><span class="annottext">Index (Permissions (DelPermDef b))
RoleName
</span><a href="#local-6989586621689461493"><span class="hs-identifier hs-var">roleName</span></a></span><span> </span><span class="annot"><span class="annottext">((DelPermDef b -&gt; Identity (DelPermDef b))
 -&gt; Permissions (DelPermDef b)
 -&gt; Identity (Permissions (DelPermDef b)))
-&gt; ((Maybe Text -&gt; Identity (Maybe Text))
    -&gt; DelPermDef b -&gt; Identity (DelPermDef b))
-&gt; (Maybe Text -&gt; Identity (Maybe Text))
-&gt; Permissions (DelPermDef b)
-&gt; Identity (Permissions (DelPermDef b))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Identity (Maybe Text))
-&gt; DelPermDef b -&gt; Identity (DelPermDef b)
forall (b :: BackendType) (perm :: BackendType -&gt; *).
Lens' (PermDef b perm) (Maybe Text)
</span><a href="Hasura.RQL.Types.Permission.html#pdComment"><span class="hs-identifier hs-var">pdComment</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe Text -&gt; Identity (Maybe Text))
 -&gt; TableMetadata b -&gt; Identity (TableMetadata b))
-&gt; Maybe Text -&gt; TableMetadata b -&gt; TableMetadata b
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689461491"><span class="hs-identifier hs-var">comment</span></a></span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689461485"><span class="annot"><span class="annottext">metadataObject :: MetadataObjId
</span><a href="#local-6989586621689461485"><span class="hs-identifier hs-var hs-var">metadataObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-556"></span><span>        </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceMetadataObjId -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOSourceObjId"><span class="hs-identifier hs-var">MOSourceObjId</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461495"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">(AnyBackend SourceMetadataObjId -&gt; MetadataObjId)
-&gt; AnyBackend SourceMetadataObjId -&gt; MetadataObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-557"></span><span>          </span><span class="annot"><span class="annottext">SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span> </span><span class="annot"><span class="annottext">(SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId)
-&gt; SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-558"></span><span>            </span><span class="annot"><span class="annottext">TableName b -&gt; TableMetadataObjId -&gt; SourceMetadataObjId b
forall (b :: BackendType).
TableName b -&gt; TableMetadataObjId -&gt; SourceMetadataObjId b
</span><a href="Hasura.RQL.Types.Metadata.Object.html#SMOTableObj"><span class="hs-identifier hs-var">SMOTableObj</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689461497"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461494"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">(TableMetadataObjId -&gt; SourceMetadataObjId b)
-&gt; TableMetadataObjId -&gt; SourceMetadataObjId b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-559"></span><span>              </span><span class="annot"><span class="annottext">RoleName -&gt; PermType -&gt; TableMetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MTOPerm"><span class="hs-identifier hs-var">MTOPerm</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689461493"><span class="hs-identifier hs-var">roleName</span></a></span><span> </span><span class="annot"><span class="annottext">PermType
</span><a href="#local-6989586621689461492"><span class="hs-identifier hs-var">permType</span></a></span><span>
</span><span id="line-560"></span><span>  </span><span class="annot"><span class="annottext">MetadataObjId -&gt; MetadataModifier -&gt; m ()
forall (m :: * -&gt; *).
(QErrM m, CacheRWM m, MetadataM m) =&gt;
MetadataObjId -&gt; MetadataModifier -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCacheFor"><span class="hs-identifier hs-var">buildSchemaCacheFor</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObjId
</span><a href="#local-6989586621689461485"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataModifier -&gt; m ()) -&gt; MetadataModifier -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-561"></span><span>    </span><span class="annot"><span class="annottext">(Metadata -&gt; Metadata) -&gt; MetadataModifier
</span><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-var">MetadataModifier</span></a></span><span> </span><span class="annot"><span class="annottext">((Metadata -&gt; Metadata) -&gt; MetadataModifier)
-&gt; (Metadata -&gt; Metadata) -&gt; MetadataModifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-562"></span><span>      </span><span class="annot"><span class="annottext">SourceName -&gt; TableName b -&gt; ASetter' Metadata (TableMetadata b)
forall (b :: BackendType).
Backend b =&gt;
SourceName -&gt; TableName b -&gt; ASetter' Metadata (TableMetadata b)
</span><a href="Hasura.RQL.Types.Metadata.html#tableMetadataSetter"><span class="hs-identifier hs-var">tableMetadataSetter</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689461497"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689461495"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621689461494"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter' Metadata (TableMetadata b)
-&gt; (TableMetadata b -&gt; TableMetadata b) -&gt; Metadata -&gt; Metadata
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">TableMetadata b -&gt; TableMetadata b
</span><a href="#local-6989586621689461488"><span class="hs-identifier hs-var">permModifier</span></a></span><span>
</span><span id="line-563"></span><span>  </span><span class="annot"><span class="annottext">EncJSON -&gt; m EncJSON
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="Hasura.RQL.Types.Common.html#successMsg"><span class="hs-identifier hs-var">successMsg</span></a></span><span>
</span><span id="line-564"></span></pre></body></html>