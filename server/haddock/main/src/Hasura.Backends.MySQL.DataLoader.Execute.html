<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-4"></span><span class="hs-comment">--</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Execute the plan given from .Plan.</span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.Backends.MySQL.DataLoader.Execute</span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#OutputValue"><span class="hs-identifier">OutputValue</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier">RecordSet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#ExecuteProblem"><span class="hs-identifier">ExecuteProblem</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#execute"><span class="hs-identifier">execute</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#runExecute"><span class="hs-identifier">runExecute</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-comment">-- for testing</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#joinObjectRows"><span class="hs-identifier">joinObjectRows</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#leftObjectJoin"><span class="hs-identifier">leftObjectJoin</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">where</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Value</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">J</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Graph</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict.InsOrd</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OMap</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IORef</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Vector</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TypeLits</span></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.Connection.html"><span class="hs-identifier">Hasura.Backends.MySQL.Connection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.MySQL.Connection.html#runQueryYieldingRows"><span class="hs-identifier">runQueryYieldingRows</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html"><span class="hs-identifier">Hasura.Backends.MySQL.DataLoader.Plan</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#Action"><span class="hs-identifier">Action</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier">FieldName</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#HeadAndTail"><span class="hs-identifier">HeadAndTail</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#Join"><span class="hs-identifier">Join</span></a></span><span>
</span><span id="line-35"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#%24sel%3AjoinFieldName%3AJoin"><span class="hs-identifier">joinFieldName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>        </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#%24sel%3AjoinRhsOffset%3AJoin"><span class="hs-identifier">joinRhsOffset</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>        </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#%24sel%3AjoinRhsTop%3AJoin"><span class="hs-identifier">joinRhsTop</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>        </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#%24sel%3AjoinType%3AJoin"><span class="hs-identifier">joinType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>        </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#%24sel%3AleftRecordSet%3AJoin"><span class="hs-identifier">leftRecordSet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>        </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#%24sel%3ArightRecordSet%3AJoin"><span class="hs-identifier">rightRecordSet</span></a></span><span>
</span><span id="line-41"></span><span>      </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#PlannedAction"><span class="hs-identifier">PlannedAction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#Ref"><span class="hs-identifier">Ref</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#selectQuery"><span class="hs-identifier">selectQuery</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#toFieldName"><span class="hs-identifier">toFieldName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html"><span class="hs-identifier">Hasura.Backends.MySQL.DataLoader.Plan</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DataLoaderPlan</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html"><span class="hs-identifier">Hasura.Backends.MySQL.DataLoader.Plan</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Plan</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.ToQuery.html"><span class="hs-identifier">Hasura.Backends.MySQL.ToQuery</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.MySQL.ToQuery.html#fromSelect"><span class="hs-identifier">fromSelect</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.ToQuery.html#toQueryFlat"><span class="hs-identifier">toQueryFlat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.Types.html"><span class="hs-identifier">Hasura.Backends.MySQL.Types</span></a></span><span> </span><span class="hs-keyword">hiding</span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.Types.Internal.html#FieldName"><span class="hs-identifier">FieldName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="Hasura.Backends.MySQL.Types.Internal.html#ScalarValue"><span class="hs-identifier">ScalarValue</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><a href="Hasura.Backends.MySQL.Types.Internal.html#selectWhere"><span class="hs-identifier">selectWhere</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-comment">-- import Hasura.Backends.MySQL.Types qualified as MySQL</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Parser.html"><span class="hs-identifier">Hasura.GraphQL.Parser</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-comment">-- Brings an instance for Hashable (Vector a)...</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Prelude.html"><span class="hs-identifier">Hasura.Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">concatMap</span></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><span class="hs-identifier">elem</span></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><span class="hs-identifier">head</span></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><span class="hs-identifier">map</span></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><span class="hs-identifier">tail</span></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><span class="hs-identifier">toList</span></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-comment">-- | A set of records produced by the database. These are joined</span><span>
</span><span id="line-69"></span><span class="hs-comment">-- together. There are all sorts of optimizations possible here, from</span><span>
</span><span id="line-70"></span><span class="hs-comment">-- using a matrix/flat vector, unboxed sums for Value, etc. Presently</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- we choose a naive implementation in the interest of getting other</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- work done.</span><span>
</span><span id="line-73"></span><span class="hs-keyword">data</span><span> </span><span id="RecordSet"><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier hs-var">RecordSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RecordSet"><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier hs-var">RecordSet</span></a></span></span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="origin"><span class="annot"><span class="annottext">RecordSet -&gt; Maybe PlannedAction
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#origin"><span class="hs-identifier hs-var hs-var">origin</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#PlannedAction"><span class="hs-identifier hs-type">PlannedAction</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>    </span><span id="rows"><span class="annot"><span class="annottext">RecordSet -&gt; Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#rows"><span class="hs-identifier hs-var hs-var">rows</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InsOrdHashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#OutputValue"><span class="hs-identifier hs-type">OutputValue</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>    </span><span id="wantedFields"><span class="annot"><span class="annottext">RecordSet -&gt; Maybe [Text]
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#wantedFields"><span class="hs-identifier hs-var hs-var">wantedFields</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689204858"><span id="local-6989586621689204860"><span id="local-6989586621689204862"><span class="annot"><span class="annottext">Int -&gt; RecordSet -&gt; ShowS
[RecordSet] -&gt; ShowS
RecordSet -&gt; String
(Int -&gt; RecordSet -&gt; ShowS)
-&gt; (RecordSet -&gt; String)
-&gt; ([RecordSet] -&gt; ShowS)
-&gt; Show RecordSet
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [RecordSet] -&gt; ShowS
$cshowList :: [RecordSet] -&gt; ShowS
show :: RecordSet -&gt; String
$cshow :: RecordSet -&gt; String
showsPrec :: Int -&gt; RecordSet -&gt; ShowS
$cshowsPrec :: Int -&gt; RecordSet -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621689204850"><span id="local-6989586621689204852"><span id="local-6989586621689204854"><span class="annot"><span class="hs-identifier hs-type">GHC.TypeLits.TypeError</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">GHC.TypeLits.Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Aeson loses key order, so you can't use this instance.&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier hs-type">RecordSet</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-81"></span><span>  </span><span id="local-6989586621689204848"><span class="annot"><span class="annottext">toJSON :: RecordSet -&gt; Value
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier hs-type">RecordSet</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Value
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;RecordSet.toJSON: do not use.&quot;</span></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">-- | The read-only info. used by the Execute monad. Later, this IORef</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- may become either atomically modified or in an STM or MVar so that</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- jobs can be executed in parallel.</span><span>
</span><span id="line-86"></span><span class="hs-keyword">data</span><span> </span><span id="ExecuteReader"><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#ExecuteReader"><span class="hs-identifier hs-var">ExecuteReader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ExecuteReader"><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#ExecuteReader"><span class="hs-identifier hs-var">ExecuteReader</span></a></span></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="recordSets"><span class="annot"><span class="annottext">ExecuteReader -&gt; IORef (InsOrdHashMap Ref RecordSet)
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#recordSets"><span class="hs-identifier hs-var hs-var">recordSets</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InsOrdHashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#Ref"><span class="hs-identifier hs-type">Ref</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier hs-type">RecordSet</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>    </span><span id="credentials"><span class="annot"><span class="annottext">ExecuteReader -&gt; SourceConfig
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#credentials"><span class="hs-identifier hs-var hs-var">credentials</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.Backends.MySQL.Types.Internal.html#SourceConfig"><span class="hs-identifier hs-type">SourceConfig</span></a></span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">-- | Any problem encountered while executing the plan.</span><span>
</span><span id="line-92"></span><span class="hs-keyword">data</span><span> </span><span id="ExecuteProblem"><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#ExecuteProblem"><span class="hs-identifier hs-var">ExecuteProblem</span></a></span></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="GetJobDecodeProblem"><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#GetJobDecodeProblem"><span class="hs-identifier hs-var">GetJobDecodeProblem</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CreateQueryJobDecodeProblem"><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#CreateQueryJobDecodeProblem"><span class="hs-identifier hs-var">CreateQueryJobDecodeProblem</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="JoinProblem"><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#JoinProblem"><span class="hs-identifier hs-var">JoinProblem</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#ExecuteProblem"><span class="hs-identifier hs-type">ExecuteProblem</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="UnsupportedJoinBug"><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#UnsupportedJoinBug"><span class="hs-identifier hs-var">UnsupportedJoinBug</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.Types.Internal.html#JoinType"><span class="hs-identifier hs-type">JoinType</span></a></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MissingRecordSetBug"><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#MissingRecordSetBug"><span class="hs-identifier hs-var">MissingRecordSetBug</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#Ref"><span class="hs-identifier hs-type">Ref</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="BrokenJoinInvariant"><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#BrokenJoinInvariant"><span class="hs-identifier hs-var">BrokenJoinInvariant</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-type">DataLoaderPlan.FieldName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689204831"><span id="local-6989586621689204833"><span id="local-6989586621689204835"><span class="annot"><span class="annottext">Int -&gt; ExecuteProblem -&gt; ShowS
[ExecuteProblem] -&gt; ShowS
ExecuteProblem -&gt; String
(Int -&gt; ExecuteProblem -&gt; ShowS)
-&gt; (ExecuteProblem -&gt; String)
-&gt; ([ExecuteProblem] -&gt; ShowS)
-&gt; Show ExecuteProblem
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ExecuteProblem] -&gt; ShowS
$cshowList :: [ExecuteProblem] -&gt; ShowS
show :: ExecuteProblem -&gt; String
$cshow :: ExecuteProblem -&gt; String
showsPrec :: Int -&gt; ExecuteProblem -&gt; ShowS
$cshowsPrec :: Int -&gt; ExecuteProblem -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-comment">-- | Execute monad; as queries are performed, the record sets are</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- stored in the map.</span><span>
</span><span id="line-103"></span><span class="hs-keyword">newtype</span><span> </span><span id="Execute"><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#Execute"><span class="hs-identifier hs-var">Execute</span></a></span></span><span> </span><span id="local-6989586621689204959"><span class="annot"><a href="#local-6989586621689204959"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Execute"><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#Execute"><span class="hs-identifier hs-var">Execute</span></a></span></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-special">{</span><span id="unExecute"><span class="annot"><span class="annottext">Execute a -&gt; ReaderT ExecuteReader (ExceptT ExecuteProblem IO) a
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#unExecute"><span class="hs-identifier hs-var hs-var">unExecute</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#ExecuteReader"><span class="hs-identifier hs-type">ExecuteReader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#ExecuteProblem"><span class="hs-identifier hs-type">ExecuteProblem</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689204959"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-keyword">deriving</span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-special">(</span><span> </span><span id="local-6989586621689204825"><span id="local-6989586621689204827"><span class="annot"><span class="annottext">a -&gt; Execute b -&gt; Execute a
(a -&gt; b) -&gt; Execute a -&gt; Execute b
(forall a b. (a -&gt; b) -&gt; Execute a -&gt; Execute b)
-&gt; (forall a b. a -&gt; Execute b -&gt; Execute a) -&gt; Functor Execute
forall a b. a -&gt; Execute b -&gt; Execute a
forall a b. (a -&gt; b) -&gt; Execute a -&gt; Execute b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: a -&gt; Execute b -&gt; Execute a
$c&lt;$ :: forall a b. a -&gt; Execute b -&gt; Execute a
fmap :: (a -&gt; b) -&gt; Execute a -&gt; Execute b
$cfmap :: forall a b. (a -&gt; b) -&gt; Execute a -&gt; Execute b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>      </span><span id="local-6989586621689204813"><span id="local-6989586621689204815"><span id="local-6989586621689204817"><span id="local-6989586621689204819"><span id="local-6989586621689204821"><span class="annot"><span class="annottext">Functor Execute
a -&gt; Execute a
Functor Execute
-&gt; (forall a. a -&gt; Execute a)
-&gt; (forall a b. Execute (a -&gt; b) -&gt; Execute a -&gt; Execute b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c) -&gt; Execute a -&gt; Execute b -&gt; Execute c)
-&gt; (forall a b. Execute a -&gt; Execute b -&gt; Execute b)
-&gt; (forall a b. Execute a -&gt; Execute b -&gt; Execute a)
-&gt; Applicative Execute
Execute a -&gt; Execute b -&gt; Execute b
Execute a -&gt; Execute b -&gt; Execute a
Execute (a -&gt; b) -&gt; Execute a -&gt; Execute b
(a -&gt; b -&gt; c) -&gt; Execute a -&gt; Execute b -&gt; Execute c
forall a. a -&gt; Execute a
forall a b. Execute a -&gt; Execute b -&gt; Execute a
forall a b. Execute a -&gt; Execute b -&gt; Execute b
forall a b. Execute (a -&gt; b) -&gt; Execute a -&gt; Execute b
forall a b c. (a -&gt; b -&gt; c) -&gt; Execute a -&gt; Execute b -&gt; Execute c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
&lt;* :: Execute a -&gt; Execute b -&gt; Execute a
$c&lt;* :: forall a b. Execute a -&gt; Execute b -&gt; Execute a
*&gt; :: Execute a -&gt; Execute b -&gt; Execute b
$c*&gt; :: forall a b. Execute a -&gt; Execute b -&gt; Execute b
liftA2 :: (a -&gt; b -&gt; c) -&gt; Execute a -&gt; Execute b -&gt; Execute c
$cliftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; Execute a -&gt; Execute b -&gt; Execute c
&lt;*&gt; :: Execute (a -&gt; b) -&gt; Execute a -&gt; Execute b
$c&lt;*&gt; :: forall a b. Execute (a -&gt; b) -&gt; Execute a -&gt; Execute b
pure :: a -&gt; Execute a
$cpure :: forall a. a -&gt; Execute a
$cp1Applicative :: Functor Execute
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>      </span><span id="local-6989586621689204805"><span id="local-6989586621689204807"><span id="local-6989586621689204809"><span class="annot"><span class="annottext">Applicative Execute
a -&gt; Execute a
Applicative Execute
-&gt; (forall a b. Execute a -&gt; (a -&gt; Execute b) -&gt; Execute b)
-&gt; (forall a b. Execute a -&gt; Execute b -&gt; Execute b)
-&gt; (forall a. a -&gt; Execute a)
-&gt; Monad Execute
Execute a -&gt; (a -&gt; Execute b) -&gt; Execute b
Execute a -&gt; Execute b -&gt; Execute b
forall a. a -&gt; Execute a
forall a b. Execute a -&gt; Execute b -&gt; Execute b
forall a b. Execute a -&gt; (a -&gt; Execute b) -&gt; Execute b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
return :: a -&gt; Execute a
$creturn :: forall a. a -&gt; Execute a
&gt;&gt; :: Execute a -&gt; Execute b -&gt; Execute b
$c&gt;&gt; :: forall a b. Execute a -&gt; Execute b -&gt; Execute b
&gt;&gt;= :: Execute a -&gt; (a -&gt; Execute b) -&gt; Execute b
$c&gt;&gt;= :: forall a b. Execute a -&gt; (a -&gt; Execute b) -&gt; Execute b
$cp1Monad :: Applicative Execute
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>      </span><span id="local-6989586621689204797"><span id="local-6989586621689204799"><span id="local-6989586621689204801"><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#ExecuteReader"><span class="hs-identifier hs-type">ExecuteReader</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>      </span><span id="local-6989586621689204793"><span class="annot"><span class="annottext">Monad Execute
Monad Execute -&gt; (forall a. IO a -&gt; Execute a) -&gt; MonadIO Execute
IO a -&gt; Execute a
forall a. IO a -&gt; Execute a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. IO a -&gt; m a) -&gt; MonadIO m
liftIO :: IO a -&gt; Execute a
$cliftIO :: forall a. IO a -&gt; Execute a
$cp1MonadIO :: Monad Execute
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></span></span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>      </span><span id="local-6989586621689204787"><span id="local-6989586621689204789"><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#ExecuteProblem"><span class="hs-identifier hs-type">ExecuteProblem</span></a></span></span></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-comment">-- | A value outputted by this execute module in a record set.</span><span>
</span><span id="line-115"></span><span id="local-6989586621689204784"><span id="local-6989586621689204785"></span></span><span class="hs-keyword">data</span><span> </span><span id="OutputValue"><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#OutputValue"><span class="hs-identifier hs-var">OutputValue</span></a></span></span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ArrayOutputValue"><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#ArrayOutputValue"><span class="hs-identifier hs-var">ArrayOutputValue</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#OutputValue"><span class="hs-identifier hs-type">OutputValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="RecordOutputValue"><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordOutputValue"><span class="hs-identifier hs-var">RecordOutputValue</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InsOrdHashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-type">DataLoaderPlan.FieldName</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#OutputValue"><span class="hs-identifier hs-type">OutputValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ScalarOutputValue"><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#ScalarOutputValue"><span class="hs-identifier hs-var">ScalarOutputValue</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">J.Value</span></span><span> </span><span class="hs-comment">-- TODO: switch to 'MySQL.Scalar...'?</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NullOutputValue"><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#NullOutputValue"><span class="hs-identifier hs-var">NullOutputValue</span></a></span></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689204774"><span id="local-6989586621689204776"><span id="local-6989586621689204778"><span class="annot"><span class="annottext">Int -&gt; OutputValue -&gt; ShowS
[OutputValue] -&gt; ShowS
OutputValue -&gt; String
(Int -&gt; OutputValue -&gt; ShowS)
-&gt; (OutputValue -&gt; String)
-&gt; ([OutputValue] -&gt; ShowS)
-&gt; Show OutputValue
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [OutputValue] -&gt; ShowS
$cshowList :: [OutputValue] -&gt; ShowS
show :: OutputValue -&gt; String
$cshow :: OutputValue -&gt; String
showsPrec :: Int -&gt; OutputValue -&gt; ShowS
$cshowsPrec :: Int -&gt; OutputValue -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689204770"><span id="local-6989586621689204772"><span class="annot"><span class="annottext">OutputValue -&gt; OutputValue -&gt; Bool
(OutputValue -&gt; OutputValue -&gt; Bool)
-&gt; (OutputValue -&gt; OutputValue -&gt; Bool) -&gt; Eq OutputValue
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: OutputValue -&gt; OutputValue -&gt; Bool
$c/= :: OutputValue -&gt; OutputValue -&gt; Bool
== :: OutputValue -&gt; OutputValue -&gt; Bool
$c== :: OutputValue -&gt; OutputValue -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. OutputValue -&gt; Rep OutputValue x)
-&gt; (forall x. Rep OutputValue x -&gt; OutputValue)
-&gt; Generic OutputValue
forall x. Rep OutputValue x -&gt; OutputValue
forall x. OutputValue -&gt; Rep OutputValue x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep OutputValue x -&gt; OutputValue
$cfrom :: forall x. OutputValue -&gt; Rep OutputValue x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621689204762"><span id="local-6989586621689204764"><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#OutputValue"><span class="hs-identifier hs-type">OutputValue</span></a></span></span></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- Main entry points</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-comment">-- | Using the config, run the execute action. Finally, resolve the</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- head-and-tail to a record set.</span><span>
</span><span id="line-129"></span><span id="local-6989586621689204759"><span id="local-6989586621689204760"><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#runExecute"><span class="hs-identifier hs-type">runExecute</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689204760"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><a href="Hasura.Backends.MySQL.Types.Internal.html#SourceConfig"><span class="hs-identifier hs-type">SourceConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#HeadAndTail"><span class="hs-identifier hs-type">HeadAndTail</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#Execute"><span class="hs-identifier hs-type">Execute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689204759"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-134"></span><span>  </span><span class="annot"><a href="#local-6989586621689204760"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#ExecuteProblem"><span class="hs-identifier hs-type">ExecuteProblem</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier hs-type">RecordSet</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-135"></span><span id="runExecute"><span class="annot"><span class="annottext">runExecute :: SourceConfig
-&gt; HeadAndTail -&gt; Execute a -&gt; m (Either ExecuteProblem RecordSet)
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#runExecute"><span class="hs-identifier hs-var hs-var">runExecute</span></a></span></span><span> </span><span id="local-6989586621689204758"><span class="annot"><span class="annottext">SourceConfig
</span><a href="#local-6989586621689204758"><span class="hs-identifier hs-var">credentials</span></a></span></span><span> </span><span id="local-6989586621689204757"><span class="annot"><span class="annottext">HeadAndTail
</span><a href="#local-6989586621689204757"><span class="hs-identifier hs-var">headAndTail</span></a></span></span><span> </span><span id="local-6989586621689204756"><span class="annot"><span class="annottext">Execute a
</span><a href="#local-6989586621689204756"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-136"></span><span>  </span><span id="local-6989586621689204755"><span class="annot"><span class="annottext">IORef (InsOrdHashMap Ref RecordSet)
</span><a href="#local-6989586621689204755"><span class="hs-identifier hs-var">recordSets</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IORef (InsOrdHashMap Ref RecordSet))
-&gt; m (IORef (InsOrdHashMap Ref RecordSet))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InsOrdHashMap Ref RecordSet
-&gt; IO (IORef (InsOrdHashMap Ref RecordSet))
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap Ref RecordSet
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>  </span><span class="annot"><span class="annottext">IO (Either ExecuteProblem RecordSet)
-&gt; m (Either ExecuteProblem RecordSet)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either ExecuteProblem RecordSet)
 -&gt; m (Either ExecuteProblem RecordSet))
-&gt; IO (Either ExecuteProblem RecordSet)
-&gt; m (Either ExecuteProblem RecordSet)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><span class="annottext">ExceptT ExecuteProblem IO RecordSet
-&gt; IO (Either ExecuteProblem RecordSet)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT ExecuteProblem IO RecordSet
 -&gt; IO (Either ExecuteProblem RecordSet))
-&gt; ExceptT ExecuteProblem IO RecordSet
-&gt; IO (Either ExecuteProblem RecordSet)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-139"></span><span>      </span><span class="annot"><span class="annottext">ReaderT ExecuteReader (ExceptT ExecuteProblem IO) RecordSet
-&gt; ExecuteReader -&gt; ExceptT ExecuteProblem IO RecordSet
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var hs-var">runReaderT</span></span><span>
</span><span id="line-140"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Execute RecordSet
-&gt; ReaderT ExecuteReader (ExceptT ExecuteProblem IO) RecordSet
forall a.
Execute a -&gt; ReaderT ExecuteReader (ExceptT ExecuteProblem IO) a
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#unExecute"><span class="hs-identifier hs-var hs-var">unExecute</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Execute a
</span><a href="#local-6989586621689204756"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">Execute a -&gt; Execute RecordSet -&gt; Execute RecordSet
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HeadAndTail -&gt; Execute RecordSet
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#getFinalRecordSet"><span class="hs-identifier hs-var">getFinalRecordSet</span></a></span><span> </span><span class="annot"><span class="annottext">HeadAndTail
</span><a href="#local-6989586621689204757"><span class="hs-identifier hs-var">headAndTail</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExecuteReader :: IORef (InsOrdHashMap Ref RecordSet)
-&gt; SourceConfig -&gt; ExecuteReader
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#ExecuteReader"><span class="hs-identifier hs-type">ExecuteReader</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">SourceConfig
credentials :: SourceConfig
credentials :: SourceConfig
</span><a href="#local-6989586621689204758"><span class="hs-identifier hs-var hs-var">credentials</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IORef (InsOrdHashMap Ref RecordSet)
recordSets :: IORef (InsOrdHashMap Ref RecordSet)
recordSets :: IORef (InsOrdHashMap Ref RecordSet)
</span><a href="#local-6989586621689204755"><span class="hs-identifier hs-var hs-var">recordSets</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-comment">-- | Execute the forest of actions.</span><span>
</span><span id="line-144"></span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#execute"><span class="hs-identifier hs-type">execute</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Forest</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#PlannedAction"><span class="hs-identifier hs-type">PlannedAction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#Execute"><span class="hs-identifier hs-type">Execute</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span id="execute"><span class="annot"><span class="annottext">execute :: Forest PlannedAction -&gt; Execute ()
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#execute"><span class="hs-identifier hs-var hs-var">execute</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Tree PlannedAction -&gt; Execute ())
-&gt; Forest PlannedAction -&gt; Execute ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PlannedAction -&gt; Execute ()) -&gt; Tree PlannedAction -&gt; Execute ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="annot"><span class="annottext">PlannedAction -&gt; Execute ()
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#executePlannedAction"><span class="hs-identifier hs-var">executePlannedAction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-comment">-- | Execute an action, then store its result in the ref assigned to it.</span><span>
</span><span id="line-148"></span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#executePlannedAction"><span class="hs-identifier hs-type">executePlannedAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#PlannedAction"><span class="hs-identifier hs-type">PlannedAction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#Execute"><span class="hs-identifier hs-type">Execute</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span id="executePlannedAction"><span class="annot"><span class="annottext">executePlannedAction :: PlannedAction -&gt; Execute ()
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#executePlannedAction"><span class="hs-identifier hs-var hs-var">executePlannedAction</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#PlannedAction"><span class="hs-identifier hs-type">PlannedAction</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621689204746"><span class="annot"><span class="annottext">Ref
$sel:ref:PlannedAction :: PlannedAction -&gt; Ref
ref :: Ref
</span><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#%24sel%3Aref%3APlannedAction"><span class="hs-identifier hs-var hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689204744"><span class="annot"><span class="annottext">Action
$sel:action:PlannedAction :: PlannedAction -&gt; Action
action :: Action
</span><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#%24sel%3Aaction%3APlannedAction"><span class="hs-identifier hs-var hs-var">action</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><span class="annottext">Action -&gt; Execute RecordSet
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#fetchRecordSetForAction"><span class="hs-identifier hs-var">fetchRecordSetForAction</span></a></span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621689204744"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">Execute RecordSet -&gt; (RecordSet -&gt; Execute ()) -&gt; Execute ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Ref -&gt; RecordSet -&gt; Execute ()
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#saveRecordSet"><span class="hs-identifier hs-var">saveRecordSet</span></a></span><span> </span><span class="annot"><span class="annottext">Ref
</span><a href="#local-6989586621689204746"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-comment">-- | Fetch the record set for the given action.</span><span>
</span><span id="line-153"></span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#fetchRecordSetForAction"><span class="hs-identifier hs-type">fetchRecordSetForAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#Execute"><span class="hs-identifier hs-type">Execute</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier hs-type">RecordSet</span></a></span><span>
</span><span id="line-154"></span><span id="fetchRecordSetForAction"><span class="annot"><span class="annottext">fetchRecordSetForAction :: Action -&gt; Execute RecordSet
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#fetchRecordSetForAction"><span class="hs-identifier hs-var hs-var">fetchRecordSetForAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#SelectAction"><span class="hs-identifier hs-type">SelectAction</span></a></span><span> </span><span id="local-6989586621689204739"><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621689204739"><span class="hs-identifier hs-var">select</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-157"></span><span>      </span><span id="local-6989586621689204738"><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204738"><span class="hs-identifier hs-var">recordSet</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-158"></span><span>        </span><span class="annot"><a href="Hasura.Backends.MySQL.Types.Internal.html#SourceConfig"><span class="hs-identifier hs-type">SourceConfig</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621689204736"><span class="annot"><span class="annottext">Pool Connection
scConnectionPool :: SourceConfig -&gt; Pool Connection
scConnectionPool :: Pool Connection
</span><a href="Hasura.Backends.MySQL.Types.Internal.html#scConnectionPool"><span class="hs-identifier hs-var hs-var">scConnectionPool</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ExecuteReader -&gt; SourceConfig) -&gt; Execute SourceConfig
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">ExecuteReader -&gt; SourceConfig
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#credentials"><span class="hs-identifier hs-var hs-var">credentials</span></a></span><span>
</span><span id="line-159"></span><span>        </span><span id="local-6989586621689204733"><span class="annot"><span class="annottext">Either ExecuteProblem (Vector (InsOrdHashMap FieldName Value))
</span><a href="#local-6989586621689204733"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-160"></span><span>          </span><span class="annot"><span class="annottext">IO (Either ExecuteProblem (Vector (InsOrdHashMap FieldName Value)))
-&gt; Execute
     (Either ExecuteProblem (Vector (InsOrdHashMap FieldName Value)))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO
   (Either ExecuteProblem (Vector (InsOrdHashMap FieldName Value)))
 -&gt; Execute
      (Either ExecuteProblem (Vector (InsOrdHashMap FieldName Value))))
-&gt; IO
     (Either ExecuteProblem (Vector (InsOrdHashMap FieldName Value)))
-&gt; Execute
     (Either ExecuteProblem (Vector (InsOrdHashMap FieldName Value)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-161"></span><span>            </span><span class="annot"><span class="annottext">ExceptT ExecuteProblem IO (Vector (InsOrdHashMap FieldName Value))
-&gt; IO
     (Either ExecuteProblem (Vector (InsOrdHashMap FieldName Value)))
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT ExecuteProblem IO (Vector (InsOrdHashMap FieldName Value))
 -&gt; IO
      (Either ExecuteProblem (Vector (InsOrdHashMap FieldName Value))))
-&gt; ExceptT
     ExecuteProblem IO (Vector (InsOrdHashMap FieldName Value))
-&gt; IO
     (Either ExecuteProblem (Vector (InsOrdHashMap FieldName Value)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-162"></span><span>              </span><span class="annot"><span class="annottext">Pool Connection
-&gt; Query
-&gt; ExceptT
     ExecuteProblem IO (Vector (InsOrdHashMap FieldName Value))
forall (m :: * -&gt; *).
MonadIO m =&gt;
Pool Connection
-&gt; Query -&gt; m (Vector (InsOrdHashMap FieldName Value))
</span><a href="Hasura.Backends.MySQL.Connection.html#runQueryYieldingRows"><span class="hs-identifier hs-var">runQueryYieldingRows</span></a></span><span>
</span><span id="line-163"></span><span>                </span><span class="annot"><span class="annottext">Pool Connection
</span><a href="#local-6989586621689204736"><span class="hs-identifier hs-var">scConnectionPool</span></a></span><span>
</span><span id="line-164"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Printer -&gt; Query
</span><a href="Hasura.Backends.MySQL.ToQuery.html#toQueryFlat"><span class="hs-identifier hs-var">toQueryFlat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Select -&gt; Printer
</span><a href="Hasura.Backends.MySQL.ToQuery.html#fromSelect"><span class="hs-identifier hs-var">fromSelect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Select -&gt; Select
</span><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#selectQuery"><span class="hs-identifier hs-var">selectQuery</span></a></span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621689204739"><span class="hs-identifier hs-var">select</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either ExecuteProblem (Vector (InsOrdHashMap FieldName Value))
</span><a href="#local-6989586621689204733"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-166"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621689204732"><span class="annot"><span class="annottext">ExecuteProblem
</span><a href="#local-6989586621689204732"><span class="hs-identifier hs-var">problem</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExecuteProblem -&gt; Execute RecordSet
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExecuteProblem -&gt; ExecuteProblem
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#JoinProblem"><span class="hs-identifier hs-var">JoinProblem</span></a></span><span> </span><span class="annot"><span class="annottext">ExecuteProblem
</span><a href="#local-6989586621689204732"><span class="hs-identifier hs-var">problem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621689204730"><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName Value)
</span><a href="#local-6989586621689204730"><span class="hs-identifier hs-var">rows</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RecordSet -&gt; Execute RecordSet
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName Value) -&gt; RecordSet
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#makeRecordSet"><span class="hs-identifier hs-var">makeRecordSet</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName Value)
</span><a href="#local-6989586621689204730"><span class="hs-identifier hs-var">rows</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>      </span><span class="hs-comment">-- Update the wanted fields from the original select. This lets</span><span>
</span><span id="line-169"></span><span>      </span><span class="hs-comment">-- the executor know which fields to include after performing a</span><span>
</span><span id="line-170"></span><span>      </span><span class="hs-comment">-- join.</span><span>
</span><span id="line-171"></span><span>      </span><span class="annot"><span class="annottext">RecordSet -&gt; Execute RecordSet
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204738"><span class="hs-identifier hs-var">recordSet</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">wantedFields :: Maybe [Text]
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#wantedFields"><span class="hs-identifier hs-var">wantedFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Select -&gt; Maybe [Text]
</span><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#%24sel%3AselectWantedFields%3ASelect"><span class="hs-identifier hs-var hs-var">Plan.selectWantedFields</span></a></span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621689204739"><span class="hs-identifier hs-var">select</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-172"></span><span>    </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#JoinAction"><span class="hs-identifier hs-type">JoinAction</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#Join"><span class="hs-identifier hs-type">Plan.Join</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:joinType:Join :: Join -&gt; JoinType
</span><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#%24sel%3AjoinType%3AJoin"><span class="hs-identifier hs-var">joinType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621689204725"><span class="annot"><span class="annottext">JoinType
</span><a href="#local-6989586621689204725"><span class="hs-identifier hs-var">joinType'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:joinFieldName:Join :: Join -&gt; Text
</span><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#%24sel%3AjoinFieldName%3AJoin"><span class="hs-identifier hs-var">joinFieldName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621689204724"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689204724"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689204719"><span id="local-6989586621689204720"><span id="local-6989586621689204721"><span id="local-6989586621689204722"><span id="local-6989586621689204723"><span class="annot"><span class="annottext">Maybe Int
Maybe [Text]
Top
Ref
$sel:wantedFields:Join :: Join -&gt; Maybe [Text]
wantedFields :: Maybe [Text]
joinRhsOffset :: Maybe Int
joinRhsTop :: Top
rightRecordSet :: Ref
leftRecordSet :: Ref
$sel:rightRecordSet:Join :: Join -&gt; Ref
$sel:leftRecordSet:Join :: Join -&gt; Ref
$sel:joinRhsTop:Join :: Join -&gt; Top
$sel:joinRhsOffset:Join :: Join -&gt; Maybe Int
</span><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#%24sel%3AwantedFields%3AJoin"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-173"></span><span>      </span><span id="local-6989586621689204717"><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204717"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ref -&gt; Execute RecordSet
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#getRecordSet"><span class="hs-identifier hs-var">getRecordSet</span></a></span><span> </span><span class="annot"><span class="annottext">Ref
</span><a href="#local-6989586621689204723"><span class="hs-identifier hs-var">leftRecordSet</span></a></span><span>
</span><span id="line-174"></span><span>      </span><span id="local-6989586621689204715"><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204715"><span class="hs-identifier hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ref -&gt; Execute RecordSet
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#getRecordSet"><span class="hs-identifier hs-var">getRecordSet</span></a></span><span> </span><span class="annot"><span class="annottext">Ref
</span><a href="#local-6989586621689204722"><span class="hs-identifier hs-var">rightRecordSet</span></a></span><span>
</span><span id="line-175"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">JoinType
</span><a href="#local-6989586621689204725"><span class="hs-identifier hs-var">joinType'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-176"></span><span>        </span><span class="annot"><a href="Hasura.Backends.MySQL.Types.Internal.html#ArrayJoin"><span class="hs-identifier hs-type">ArrayJoin</span></a></span><span> </span><span id="local-6989586621689204713"><span class="annot"><span class="annottext">[(FieldName, FieldName)]
</span><a href="#local-6989586621689204713"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-177"></span><span>          </span><span class="annot"><span class="annottext">Maybe [Text]
-&gt; Text
-&gt; [(FieldName, FieldName)]
-&gt; Top
-&gt; Maybe Int
-&gt; RecordSet
-&gt; RecordSet
-&gt; Either ExecuteProblem RecordSet
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#leftArrayJoin"><span class="hs-identifier hs-var">leftArrayJoin</span></a></span><span>
</span><span id="line-178"></span><span>            </span><span class="annot"><span class="annottext">Maybe [Text]
</span><a href="#local-6989586621689204719"><span class="hs-identifier hs-var">wantedFields</span></a></span><span>
</span><span id="line-179"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689204724"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-180"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(FieldName, FieldName)] -&gt; [(FieldName, FieldName)]
</span><a href="#local-6989586621689204711"><span class="hs-identifier hs-var">toFieldNames</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldName, FieldName)]
</span><a href="#local-6989586621689204713"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>            </span><span class="annot"><span class="annottext">Top
</span><a href="#local-6989586621689204721"><span class="hs-identifier hs-var">joinRhsTop</span></a></span><span>
</span><span id="line-182"></span><span>            </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621689204720"><span class="hs-identifier hs-var">joinRhsOffset</span></a></span><span>
</span><span id="line-183"></span><span>            </span><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204717"><span class="hs-identifier hs-var">left</span></a></span><span>
</span><span id="line-184"></span><span>            </span><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204715"><span class="hs-identifier hs-var">right</span></a></span><span>
</span><span id="line-185"></span><span>            </span><span class="annot"><span class="annottext">Either ExecuteProblem RecordSet
-&gt; (ExecuteProblem -&gt; Execute RecordSet) -&gt; Execute RecordSet
forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="Hasura.Prelude.html#onLeft"><span class="hs-operator hs-var">`onLeft`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExecuteProblem -&gt; Execute RecordSet
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(ExecuteProblem -&gt; Execute RecordSet)
-&gt; (ExecuteProblem -&gt; ExecuteProblem)
-&gt; ExecuteProblem
-&gt; Execute RecordSet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ExecuteProblem -&gt; ExecuteProblem
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#JoinProblem"><span class="hs-identifier hs-var">JoinProblem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>        </span><span class="annot"><a href="Hasura.Backends.MySQL.Types.Internal.html#ObjectJoin"><span class="hs-identifier hs-type">ObjectJoin</span></a></span><span> </span><span id="local-6989586621689204707"><span class="annot"><span class="annottext">[(FieldName, FieldName)]
</span><a href="#local-6989586621689204707"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-187"></span><span>          </span><span class="annot"><span class="annottext">Maybe [Text]
-&gt; Text
-&gt; [(FieldName, FieldName)]
-&gt; RecordSet
-&gt; RecordSet
-&gt; Either ExecuteProblem RecordSet
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#leftObjectJoin"><span class="hs-identifier hs-var">leftObjectJoin</span></a></span><span>
</span><span id="line-188"></span><span>            </span><span class="annot"><span class="annottext">Maybe [Text]
</span><a href="#local-6989586621689204719"><span class="hs-identifier hs-var">wantedFields</span></a></span><span>
</span><span id="line-189"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689204724"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-190"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(FieldName, FieldName)] -&gt; [(FieldName, FieldName)]
</span><a href="#local-6989586621689204711"><span class="hs-identifier hs-var">toFieldNames</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldName, FieldName)]
</span><a href="#local-6989586621689204707"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>            </span><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204717"><span class="hs-identifier hs-var">left</span></a></span><span>
</span><span id="line-192"></span><span>            </span><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204715"><span class="hs-identifier hs-var">right</span></a></span><span>
</span><span id="line-193"></span><span>            </span><span class="annot"><span class="annottext">Either ExecuteProblem RecordSet
-&gt; (ExecuteProblem -&gt; Execute RecordSet) -&gt; Execute RecordSet
forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="Hasura.Prelude.html#onLeft"><span class="hs-operator hs-var">`onLeft`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExecuteProblem -&gt; Execute RecordSet
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(ExecuteProblem -&gt; Execute RecordSet)
-&gt; (ExecuteProblem -&gt; ExecuteProblem)
-&gt; ExecuteProblem
-&gt; Execute RecordSet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ExecuteProblem -&gt; ExecuteProblem
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#JoinProblem"><span class="hs-identifier hs-var">JoinProblem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>        </span><span class="annot"><span class="annottext">JoinType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExecuteProblem -&gt; Execute RecordSet
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JoinType -&gt; ExecuteProblem
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#UnsupportedJoinBug"><span class="hs-identifier hs-var">UnsupportedJoinBug</span></a></span><span> </span><span class="annot"><span class="annottext">JoinType
</span><a href="#local-6989586621689204725"><span class="hs-identifier hs-var">joinType'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621689204711"><span class="annot"><span class="annottext">toFieldNames :: [(FieldName, FieldName)] -&gt; [(FieldName, FieldName)]
</span><a href="#local-6989586621689204711"><span class="hs-identifier hs-var hs-var">toFieldNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((FieldName, FieldName) -&gt; (FieldName, FieldName))
-&gt; [(FieldName, FieldName)] -&gt; [(FieldName, FieldName)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FieldName -&gt; FieldName)
-&gt; (FieldName -&gt; FieldName)
-&gt; (FieldName, FieldName)
-&gt; (FieldName, FieldName)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; FieldName
</span><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#toFieldName"><span class="hs-identifier hs-var">toFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; FieldName
</span><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#toFieldName"><span class="hs-identifier hs-var">toFieldName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-comment">-- | Make a record set from a flat record from the DB.</span><span>
</span><span id="line-199"></span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#makeRecordSet"><span class="hs-identifier hs-type">makeRecordSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InsOrdHashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">J.Value</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier hs-type">RecordSet</span></a></span><span>
</span><span id="line-200"></span><span id="makeRecordSet"><span class="annot"><span class="annottext">makeRecordSet :: Vector (InsOrdHashMap FieldName Value) -&gt; RecordSet
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#makeRecordSet"><span class="hs-identifier hs-var hs-var">makeRecordSet</span></a></span></span><span> </span><span id="local-6989586621689204705"><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName Value)
</span><a href="#local-6989586621689204705"><span class="hs-identifier hs-var">rows</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><span class="annottext">RecordSet :: Maybe PlannedAction
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
-&gt; Maybe [Text]
-&gt; RecordSet
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier hs-type">RecordSet</span></a></span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">origin :: Maybe PlannedAction
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#origin"><span class="hs-identifier hs-var">origin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe PlannedAction
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- No information for this yet, but will follow</span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-comment">-- up with a change for this later.</span><span>
</span><span id="line-204"></span><span>      </span><span class="annot"><span class="annottext">rows :: Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#rows"><span class="hs-identifier hs-var">rows</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InsOrdHashMap FieldName Value
 -&gt; InsOrdHashMap FieldName OutputValue)
-&gt; Vector (InsOrdHashMap FieldName Value)
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Value -&gt; OutputValue)
-&gt; InsOrdHashMap FieldName Value
-&gt; InsOrdHashMap FieldName OutputValue
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; OutputValue
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#ScalarOutputValue"><span class="hs-identifier hs-var">ScalarOutputValue</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName Value)
</span><a href="#local-6989586621689204705"><span class="hs-identifier hs-var">rows</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-205"></span><span>      </span><span class="annot"><span class="annottext">wantedFields :: Maybe [Text]
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#wantedFields"><span class="hs-identifier hs-var">wantedFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#saveRecordSet"><span class="hs-identifier hs-type">saveRecordSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#Ref"><span class="hs-identifier hs-type">Ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier hs-type">RecordSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#Execute"><span class="hs-identifier hs-type">Execute</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span id="saveRecordSet"><span class="annot"><span class="annottext">saveRecordSet :: Ref -&gt; RecordSet -&gt; Execute ()
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#saveRecordSet"><span class="hs-identifier hs-var hs-var">saveRecordSet</span></a></span></span><span> </span><span id="local-6989586621689204704"><span class="annot"><span class="annottext">Ref
</span><a href="#local-6989586621689204704"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621689204703"><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204703"><span class="hs-identifier hs-var">recordSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-210"></span><span>  </span><span id="local-6989586621689204702"><span class="annot"><span class="annottext">IORef (InsOrdHashMap Ref RecordSet)
</span><a href="#local-6989586621689204702"><span class="hs-identifier hs-var">recordSetsRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ExecuteReader -&gt; IORef (InsOrdHashMap Ref RecordSet))
-&gt; Execute (IORef (InsOrdHashMap Ref RecordSet))
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">ExecuteReader -&gt; IORef (InsOrdHashMap Ref RecordSet)
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#recordSets"><span class="hs-identifier hs-var hs-var">recordSets</span></a></span><span>
</span><span id="line-211"></span><span>  </span><span class="annot"><span class="annottext">IO () -&gt; Execute ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IORef (InsOrdHashMap Ref RecordSet)
-&gt; (InsOrdHashMap Ref RecordSet -&gt; InsOrdHashMap Ref RecordSet)
-&gt; IO ()
forall a. IORef a -&gt; (a -&gt; a) -&gt; IO ()
</span><span class="hs-identifier hs-var">modifyIORef'</span></span><span> </span><span class="annot"><span class="annottext">IORef (InsOrdHashMap Ref RecordSet)
</span><a href="#local-6989586621689204702"><span class="hs-identifier hs-var">recordSetsRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ref
-&gt; RecordSet
-&gt; InsOrdHashMap Ref RecordSet
-&gt; InsOrdHashMap Ref RecordSet
forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; InsOrdHashMap k v -&gt; InsOrdHashMap k v
</span><span class="hs-identifier hs-var">OMap.insert</span></span><span> </span><span class="annot"><span class="annottext">Ref
</span><a href="#local-6989586621689204704"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204703"><span class="hs-identifier hs-var">recordSet</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#getRecordSet"><span class="hs-identifier hs-type">getRecordSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#Ref"><span class="hs-identifier hs-type">Ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#Execute"><span class="hs-identifier hs-type">Execute</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier hs-type">RecordSet</span></a></span><span>
</span><span id="line-214"></span><span id="getRecordSet"><span class="annot"><span class="annottext">getRecordSet :: Ref -&gt; Execute RecordSet
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#getRecordSet"><span class="hs-identifier hs-var hs-var">getRecordSet</span></a></span></span><span> </span><span id="local-6989586621689204699"><span class="annot"><span class="annottext">Ref
</span><a href="#local-6989586621689204699"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-215"></span><span>  </span><span id="local-6989586621689204698"><span class="annot"><span class="annottext">IORef (InsOrdHashMap Ref RecordSet)
</span><a href="#local-6989586621689204698"><span class="hs-identifier hs-var">recordSetsRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ExecuteReader -&gt; IORef (InsOrdHashMap Ref RecordSet))
-&gt; Execute (IORef (InsOrdHashMap Ref RecordSet))
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">ExecuteReader -&gt; IORef (InsOrdHashMap Ref RecordSet)
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#recordSets"><span class="hs-identifier hs-var hs-var">recordSets</span></a></span><span>
</span><span id="line-216"></span><span>  </span><span id="local-6989586621689204697"><span class="annot"><span class="annottext">InsOrdHashMap Ref RecordSet
</span><a href="#local-6989586621689204697"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (InsOrdHashMap Ref RecordSet)
-&gt; Execute (InsOrdHashMap Ref RecordSet)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IORef (InsOrdHashMap Ref RecordSet)
-&gt; IO (InsOrdHashMap Ref RecordSet)
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (InsOrdHashMap Ref RecordSet)
</span><a href="#local-6989586621689204698"><span class="hs-identifier hs-var">recordSetsRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>  </span><span class="annot"><span class="annottext">Ref -&gt; InsOrdHashMap Ref RecordSet -&gt; Maybe RecordSet
forall k v. (Eq k, Hashable k) =&gt; k -&gt; InsOrdHashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">OMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">Ref
</span><a href="#local-6989586621689204699"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap Ref RecordSet
</span><a href="#local-6989586621689204697"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RecordSet -&gt; Execute RecordSet -&gt; Execute RecordSet
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="Hasura.Prelude.html#onNothing"><span class="hs-operator hs-var">`onNothing`</span></a></span><span> </span><span class="annot"><span class="annottext">ExecuteProblem -&gt; Execute RecordSet
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ref -&gt; ExecuteProblem
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#MissingRecordSetBug"><span class="hs-identifier hs-var">MissingRecordSetBug</span></a></span><span> </span><span class="annot"><span class="annottext">Ref
</span><a href="#local-6989586621689204699"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-comment">-- | See documentation for 'HeadAndTail'.</span><span>
</span><span id="line-220"></span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#getFinalRecordSet"><span class="hs-identifier hs-type">getFinalRecordSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#HeadAndTail"><span class="hs-identifier hs-type">HeadAndTail</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#Execute"><span class="hs-identifier hs-type">Execute</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier hs-type">RecordSet</span></a></span><span>
</span><span id="line-221"></span><span id="getFinalRecordSet"><span class="annot"><span class="annottext">getFinalRecordSet :: HeadAndTail -&gt; Execute RecordSet
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#getFinalRecordSet"><span class="hs-identifier hs-var hs-var">getFinalRecordSet</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#HeadAndTail"><span class="hs-identifier hs-type">HeadAndTail</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621689204691"><span id="local-6989586621689204692"><span class="annot"><span class="annottext">Ref
$sel:tail:HeadAndTail :: HeadAndTail -&gt; Ref
$sel:head:HeadAndTail :: HeadAndTail -&gt; Ref
tail :: Ref
head :: Ref
</span><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#%24sel%3Atail%3AHeadAndTail"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-222"></span><span>  </span><span id="local-6989586621689204688"><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204688"><span class="hs-identifier hs-var">headSet</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ref -&gt; Execute RecordSet
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#getRecordSet"><span class="hs-identifier hs-var">getRecordSet</span></a></span><span> </span><span class="annot"><span class="annottext">Ref
</span><a href="#local-6989586621689204692"><span class="hs-identifier hs-var">head</span></a></span><span>
</span><span id="line-223"></span><span>  </span><span id="local-6989586621689204687"><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204687"><span class="hs-identifier hs-var">tailSet</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Ref
</span><a href="#local-6989586621689204691"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Ref -&gt; Ref -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Ref
</span><a href="#local-6989586621689204692"><span class="hs-identifier hs-var">head</span></a></span><span>
</span><span id="line-225"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Ref -&gt; Execute RecordSet
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#getRecordSet"><span class="hs-identifier hs-var">getRecordSet</span></a></span><span> </span><span class="annot"><span class="annottext">Ref
</span><a href="#local-6989586621689204691"><span class="hs-identifier hs-var">tail</span></a></span><span>
</span><span id="line-226"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">RecordSet -&gt; Execute RecordSet
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204688"><span class="hs-identifier hs-var">headSet</span></a></span><span>
</span><span id="line-227"></span><span>  </span><span class="annot"><span class="annottext">RecordSet -&gt; Execute RecordSet
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-228"></span><span>    </span><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204687"><span class="hs-identifier hs-var">tailSet</span></a></span><span>
</span><span id="line-229"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rows :: Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#rows"><span class="hs-identifier hs-var">rows</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-230"></span><span>          </span><span class="annot"><span class="annottext">(InsOrdHashMap FieldName OutputValue
 -&gt; InsOrdHashMap FieldName OutputValue)
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span>
</span><span id="line-231"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(FieldName -&gt; OutputValue -&gt; Bool)
-&gt; InsOrdHashMap FieldName OutputValue
-&gt; InsOrdHashMap FieldName OutputValue
forall k v.
(k -&gt; v -&gt; Bool) -&gt; InsOrdHashMap k v -&gt; InsOrdHashMap k v
</span><span class="hs-identifier hs-var">OMap.filterWithKey</span></span><span>
</span><span id="line-232"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span id="local-6989586621689204683"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689204683"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OutputValue
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-233"></span><span>                    </span><span class="annot"><span class="annottext">Bool -&gt; ([Text] -&gt; Bool) -&gt; Maybe [Text] -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">elem</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689204683"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecordSet -&gt; Maybe [Text]
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#wantedFields"><span class="hs-identifier hs-var hs-var">wantedFields</span></a></span><span> </span><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204688"><span class="hs-identifier hs-var">headSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecordSet -&gt; Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#rows"><span class="hs-identifier hs-var hs-var">rows</span></a></span><span> </span><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204687"><span class="hs-identifier hs-var">tailSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="hs-comment">{- WIP, it seems:
-- | Make an lhs_fk IN (rhs_fk1, rhs_fk2, ..) expression list.
makeRelationshipIn :: DataLoaderPlan.Relationship -&gt; Execute [Expression]
makeRelationshipIn
  DataLoaderPlan.Relationship
    { leftRecordSet,
      joinType = _,
      rightTable = _rightTable
    } = do
    RecordSet {rows = _rows} &lt;- getRecordSet leftRecordSet
    -- TODO: A follow-up PR will add IN(..) and will join on the join
    -- fields for the left/right tables. It needs support from Types.hs.
    pure []
    where
      _lookupField' k row =
        case OMap.lookup k row of
          Nothing -&gt; Nothing
          Just x -&gt; Just x

-- | Will be used by makeRelationshipIn for forming lhs_fk IN (rhs_fk1, rhs_fk2, ..)
planFieldNameToQueryFieldName :: EntityAlias -&gt; FieldName -&gt; MySQL.FieldName
planFieldNameToQueryFieldName (EntityAlias fieldNameEntity) (FieldName fieldName) =
  MySQL.FieldName {fNameEntity = fieldNameEntity, fName = fieldName}
-}</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-comment">-- | Inefficient but clean left object join.</span><span>
</span><span id="line-265"></span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#leftObjectJoin"><span class="hs-identifier hs-type">leftObjectJoin</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-266"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-267"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-type">DataLoaderPlan.FieldName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-type">DataLoaderPlan.FieldName</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-269"></span><span>  </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier hs-type">RecordSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-270"></span><span>  </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier hs-type">RecordSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-271"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#ExecuteProblem"><span class="hs-identifier hs-type">ExecuteProblem</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier hs-type">RecordSet</span></a></span><span>
</span><span id="line-272"></span><span id="leftObjectJoin"><span class="annot"><span class="annottext">leftObjectJoin :: Maybe [Text]
-&gt; Text
-&gt; [(FieldName, FieldName)]
-&gt; RecordSet
-&gt; RecordSet
-&gt; Either ExecuteProblem RecordSet
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#leftObjectJoin"><span class="hs-identifier hs-var hs-var">leftObjectJoin</span></a></span></span><span> </span><span id="local-6989586621689204681"><span class="annot"><span class="annottext">Maybe [Text]
</span><a href="#local-6989586621689204681"><span class="hs-identifier hs-var">wantedFields</span></a></span></span><span> </span><span id="local-6989586621689204680"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689204680"><span class="hs-identifier hs-var">joinAlias</span></a></span></span><span> </span><span id="local-6989586621689204679"><span class="annot"><span class="annottext">[(FieldName, FieldName)]
</span><a href="#local-6989586621689204679"><span class="hs-identifier hs-var">joinFields</span></a></span></span><span> </span><span id="local-6989586621689204678"><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204678"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span id="local-6989586621689204677"><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204677"><span class="hs-identifier hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-273"></span><span>  </span><span id="local-6989586621689204676"><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="#local-6989586621689204676"><span class="hs-identifier hs-var">rows'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([InsOrdHashMap FieldName OutputValue]
 -&gt; Vector (InsOrdHashMap FieldName OutputValue))
-&gt; Either ExecuteProblem [InsOrdHashMap FieldName OutputValue]
-&gt; Either
     ExecuteProblem (Vector (InsOrdHashMap FieldName OutputValue))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[InsOrdHashMap FieldName OutputValue]
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">V.fromList</span></span><span> </span><span class="annot"><span class="annottext">(Either ExecuteProblem [InsOrdHashMap FieldName OutputValue]
 -&gt; Either
      ExecuteProblem (Vector (InsOrdHashMap FieldName OutputValue)))
-&gt; (Vector (InsOrdHashMap FieldName OutputValue)
    -&gt; Either ExecuteProblem [InsOrdHashMap FieldName OutputValue])
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
-&gt; Either
     ExecuteProblem (Vector (InsOrdHashMap FieldName OutputValue))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(InsOrdHashMap FieldName OutputValue
 -&gt; Either ExecuteProblem (InsOrdHashMap FieldName OutputValue))
-&gt; [InsOrdHashMap FieldName OutputValue]
-&gt; Either ExecuteProblem [InsOrdHashMap FieldName OutputValue]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue
-&gt; Either ExecuteProblem (InsOrdHashMap FieldName OutputValue)
</span><a href="#local-6989586621689204673"><span class="hs-identifier hs-var">makeRows</span></a></span><span> </span><span class="annot"><span class="annottext">([InsOrdHashMap FieldName OutputValue]
 -&gt; Either ExecuteProblem [InsOrdHashMap FieldName OutputValue])
-&gt; (Vector (InsOrdHashMap FieldName OutputValue)
    -&gt; [InsOrdHashMap FieldName OutputValue])
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
-&gt; Either ExecuteProblem [InsOrdHashMap FieldName OutputValue]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName OutputValue)
-&gt; [InsOrdHashMap FieldName OutputValue]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(Vector (InsOrdHashMap FieldName OutputValue)
 -&gt; Either
      ExecuteProblem (Vector (InsOrdHashMap FieldName OutputValue)))
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
-&gt; Either
     ExecuteProblem (Vector (InsOrdHashMap FieldName OutputValue))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecordSet -&gt; Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#rows"><span class="hs-identifier hs-var hs-var">rows</span></a></span><span> </span><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204678"><span class="hs-identifier hs-var">left</span></a></span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><span class="annottext">RecordSet -&gt; Either ExecuteProblem RecordSet
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-275"></span><span>    </span><span class="annot"><span class="annottext">RecordSet :: Maybe PlannedAction
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
-&gt; Maybe [Text]
-&gt; RecordSet
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier hs-type">RecordSet</span></a></span><span>
</span><span id="line-276"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">origin :: Maybe PlannedAction
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#origin"><span class="hs-identifier hs-var">origin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe PlannedAction
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-277"></span><span>        </span><span class="annot"><span class="annottext">wantedFields :: Maybe [Text]
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#wantedFields"><span class="hs-identifier hs-var">wantedFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><span class="annottext">rows :: Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#rows"><span class="hs-identifier hs-var">rows</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="#local-6989586621689204676"><span class="hs-identifier hs-var">rows'</span></a></span><span>
</span><span id="line-279"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-281"></span><span>    </span><span class="annot"><a href="#local-6989586621689204673"><span class="hs-identifier hs-type">makeRows</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">InsOrdHashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#OutputValue"><span class="hs-identifier hs-type">OutputValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#ExecuteProblem"><span class="hs-identifier hs-type">ExecuteProblem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InsOrdHashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#OutputValue"><span class="hs-identifier hs-type">OutputValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>    </span><span id="local-6989586621689204673"><span class="annot"><span class="annottext">makeRows :: InsOrdHashMap FieldName OutputValue
-&gt; Either ExecuteProblem (InsOrdHashMap FieldName OutputValue)
</span><a href="#local-6989586621689204673"><span class="hs-identifier hs-var hs-var">makeRows</span></a></span></span><span> </span><span id="local-6989586621689204672"><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue
</span><a href="#local-6989586621689204672"><span class="hs-identifier hs-var">leftRow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-283"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689204671"><span class="annot"><span class="annottext">rightRows :: Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="#local-6989586621689204671"><span class="hs-identifier hs-var hs-var">rightRows</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-284"></span><span>            </span><span class="annot"><span class="annottext">[InsOrdHashMap FieldName OutputValue]
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">V.fromList</span></span><span>
</span><span id="line-285"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue
</span><a href="#local-6989586621689204670"><span class="hs-identifier hs-var">rightRow</span></a></span><span>
</span><span id="line-286"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(FieldName, FieldName)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[(FieldName, FieldName)]
</span><a href="#local-6989586621689204679"><span class="hs-identifier hs-var">joinFields</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-287"></span><span>                  </span><span id="local-6989586621689204670"><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue
</span><a href="#local-6989586621689204670"><span class="hs-identifier hs-var">rightRow</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName OutputValue)
-&gt; [InsOrdHashMap FieldName OutputValue]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecordSet -&gt; Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#rows"><span class="hs-identifier hs-var hs-var">rows</span></a></span><span> </span><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204677"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-288"></span><span>                  </span><span class="annot"><span class="annottext">((FieldName, FieldName) -&gt; Bool)
-&gt; [(FieldName, FieldName)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span>
</span><span id="line-289"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621689204666"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621689204666"><span class="hs-identifier hs-var">rightField</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689204665"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621689204665"><span class="hs-identifier hs-var">leftField</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-290"></span><span>                        </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-291"></span><span>                          </span><span class="annot"><span class="annottext">Maybe Bool -&gt; Maybe Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-292"></span><span>                                 </span><span id="local-6989586621689204664"><span class="annot"><span class="annottext">OutputValue
</span><a href="#local-6989586621689204664"><span class="hs-identifier hs-var">leftValue</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FieldName
-&gt; InsOrdHashMap FieldName OutputValue -&gt; Maybe OutputValue
forall k v. (Eq k, Hashable k) =&gt; k -&gt; InsOrdHashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">OMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621689204665"><span class="hs-identifier hs-var">leftField</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue
</span><a href="#local-6989586621689204672"><span class="hs-identifier hs-var">leftRow</span></a></span><span>
</span><span id="line-293"></span><span>                                 </span><span id="local-6989586621689204663"><span class="annot"><span class="annottext">OutputValue
</span><a href="#local-6989586621689204663"><span class="hs-identifier hs-var">rightValue</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FieldName
-&gt; InsOrdHashMap FieldName OutputValue -&gt; Maybe OutputValue
forall k v. (Eq k, Hashable k) =&gt; k -&gt; InsOrdHashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">OMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621689204666"><span class="hs-identifier hs-var">rightField</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue
</span><a href="#local-6989586621689204670"><span class="hs-identifier hs-var">rightRow</span></a></span><span>
</span><span id="line-294"></span><span>                                 </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutputValue
</span><a href="#local-6989586621689204664"><span class="hs-identifier hs-var">leftValue</span></a></span><span> </span><span class="annot"><span class="annottext">OutputValue -&gt; OutputValue -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OutputValue
</span><a href="#local-6989586621689204663"><span class="hs-identifier hs-var">rightValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>                             </span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>                    </span><span class="annot"><span class="annottext">[(FieldName, FieldName)]
</span><a href="#local-6989586621689204679"><span class="hs-identifier hs-var">joinFields</span></a></span><span>
</span><span id="line-298"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-299"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-comment">-- The line below will return Left is rightRows has more than one element.</span><span>
</span><span id="line-300"></span><span>          </span><span class="hs-comment">-- Consider moving the check here if it makes sense in the future.</span><span>
</span><span id="line-301"></span><span>          </span><span class="annot"><span class="annottext">Maybe [Text]
-&gt; Text
-&gt; InsOrdHashMap FieldName OutputValue
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
-&gt; Either ExecuteProblem (InsOrdHashMap FieldName OutputValue)
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#joinObjectRows"><span class="hs-identifier hs-var">joinObjectRows</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
</span><a href="#local-6989586621689204681"><span class="hs-identifier hs-var">wantedFields</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689204680"><span class="hs-identifier hs-var">joinAlias</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue
</span><a href="#local-6989586621689204672"><span class="hs-identifier hs-var">leftRow</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="#local-6989586621689204671"><span class="hs-identifier hs-var">rightRows</span></a></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span class="hs-comment">-- | A naive, exponential reference implementation of a left join. It</span><span>
</span><span id="line-304"></span><span class="hs-comment">-- serves as a trivial sample implementation for correctness checking</span><span>
</span><span id="line-305"></span><span class="hs-comment">-- of more efficient ones.</span><span>
</span><span id="line-306"></span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#leftArrayJoin"><span class="hs-identifier hs-type">leftArrayJoin</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-307"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-308"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-309"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-type">DataLoaderPlan.FieldName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-type">DataLoaderPlan.FieldName</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-310"></span><span>  </span><span class="annot"><a href="Hasura.Backends.MySQL.Types.Internal.html#Top"><span class="hs-identifier hs-type">Top</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-311"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-312"></span><span>  </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier hs-type">RecordSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-313"></span><span>  </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier hs-type">RecordSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-314"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#ExecuteProblem"><span class="hs-identifier hs-type">ExecuteProblem</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier hs-type">RecordSet</span></a></span><span>
</span><span id="line-315"></span><span id="leftArrayJoin"><span class="annot"><span class="annottext">leftArrayJoin :: Maybe [Text]
-&gt; Text
-&gt; [(FieldName, FieldName)]
-&gt; Top
-&gt; Maybe Int
-&gt; RecordSet
-&gt; RecordSet
-&gt; Either ExecuteProblem RecordSet
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#leftArrayJoin"><span class="hs-identifier hs-var hs-var">leftArrayJoin</span></a></span></span><span> </span><span id="local-6989586621689204662"><span class="annot"><span class="annottext">Maybe [Text]
</span><a href="#local-6989586621689204662"><span class="hs-identifier hs-var">wantedFields</span></a></span></span><span> </span><span id="local-6989586621689204661"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689204661"><span class="hs-identifier hs-var">joinAlias</span></a></span></span><span> </span><span id="local-6989586621689204660"><span class="annot"><span class="annottext">[(FieldName, FieldName)]
</span><a href="#local-6989586621689204660"><span class="hs-identifier hs-var">joinFields</span></a></span></span><span> </span><span id="local-6989586621689204659"><span class="annot"><span class="annottext">Top
</span><a href="#local-6989586621689204659"><span class="hs-identifier hs-var">rhsTop</span></a></span></span><span> </span><span id="local-6989586621689204658"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621689204658"><span class="hs-identifier hs-var">rhsOffset</span></a></span></span><span> </span><span id="local-6989586621689204657"><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204657"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span id="local-6989586621689204656"><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204656"><span class="hs-identifier hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-316"></span><span>  </span><span class="annot"><span class="annottext">RecordSet -&gt; Either ExecuteProblem RecordSet
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-317"></span><span>    </span><span class="annot"><span class="annottext">RecordSet :: Maybe PlannedAction
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
-&gt; Maybe [Text]
-&gt; RecordSet
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordSet"><span class="hs-identifier hs-type">RecordSet</span></a></span><span>
</span><span id="line-318"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">origin :: Maybe PlannedAction
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#origin"><span class="hs-identifier hs-var">origin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe PlannedAction
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-319"></span><span>        </span><span class="annot"><span class="annottext">wantedFields :: Maybe [Text]
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#wantedFields"><span class="hs-identifier hs-var">wantedFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-320"></span><span>        </span><span class="annot"><span class="annottext">rows :: Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#rows"><span class="hs-identifier hs-var">rows</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-321"></span><span>          </span><span class="annot"><span class="annottext">[InsOrdHashMap FieldName OutputValue]
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">V.fromList</span></span><span>
</span><span id="line-322"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
-&gt; Text
-&gt; InsOrdHashMap FieldName OutputValue
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
-&gt; InsOrdHashMap FieldName OutputValue
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#joinArrayRows"><span class="hs-identifier hs-var">joinArrayRows</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
</span><a href="#local-6989586621689204662"><span class="hs-identifier hs-var">wantedFields</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689204661"><span class="hs-identifier hs-var">joinAlias</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue
</span><a href="#local-6989586621689204654"><span class="hs-identifier hs-var">leftRow</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="#local-6989586621689204653"><span class="hs-identifier hs-var">rightRows</span></a></span><span>
</span><span id="line-323"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621689204654"><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue
</span><a href="#local-6989586621689204654"><span class="hs-identifier hs-var">leftRow</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName OutputValue)
-&gt; [InsOrdHashMap FieldName OutputValue]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecordSet -&gt; Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#rows"><span class="hs-identifier hs-var hs-var">rows</span></a></span><span> </span><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204657"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-324"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689204653"><span class="annot"><span class="annottext">rightRows :: Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="#local-6989586621689204653"><span class="hs-identifier hs-var hs-var">rightRows</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-325"></span><span>                      </span><span class="annot"><span class="annottext">[InsOrdHashMap FieldName OutputValue]
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">V.fromList</span></span><span>
</span><span id="line-326"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[InsOrdHashMap FieldName OutputValue]
-&gt; [InsOrdHashMap FieldName OutputValue]
</span><a href="#local-6989586621689204652"><span class="hs-identifier hs-var">limit</span></a></span><span>
</span><span id="line-327"></span><span>                            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[InsOrdHashMap FieldName OutputValue]
-&gt; [InsOrdHashMap FieldName OutputValue]
</span><a href="#local-6989586621689204651"><span class="hs-identifier hs-var">offset</span></a></span><span>
</span><span id="line-328"></span><span>                                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue
</span><a href="#local-6989586621689204650"><span class="hs-identifier hs-var">rightRow</span></a></span><span>
</span><span id="line-329"></span><span>                                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(FieldName, FieldName)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[(FieldName, FieldName)]
</span><a href="#local-6989586621689204660"><span class="hs-identifier hs-var">joinFields</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-330"></span><span>                                    </span><span id="local-6989586621689204650"><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue
</span><a href="#local-6989586621689204650"><span class="hs-identifier hs-var">rightRow</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName OutputValue)
-&gt; [InsOrdHashMap FieldName OutputValue]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecordSet -&gt; Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#rows"><span class="hs-identifier hs-var hs-var">rows</span></a></span><span> </span><span class="annot"><span class="annottext">RecordSet
</span><a href="#local-6989586621689204656"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-331"></span><span>                                    </span><span class="annot"><span class="annottext">((FieldName, FieldName) -&gt; Bool)
-&gt; [(FieldName, FieldName)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span>
</span><span id="line-332"></span><span>                                      </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621689204649"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621689204649"><span class="hs-identifier hs-var">rightField</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689204648"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621689204648"><span class="hs-identifier hs-var">leftField</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-333"></span><span>                                          </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-334"></span><span>                                            </span><span class="annot"><span class="annottext">Maybe Bool -&gt; Maybe Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-335"></span><span>                                                   </span><span id="local-6989586621689204647"><span class="annot"><span class="annottext">OutputValue
</span><a href="#local-6989586621689204647"><span class="hs-identifier hs-var">leftValue</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FieldName
-&gt; InsOrdHashMap FieldName OutputValue -&gt; Maybe OutputValue
forall k v. (Eq k, Hashable k) =&gt; k -&gt; InsOrdHashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">OMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621689204648"><span class="hs-identifier hs-var">leftField</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue
</span><a href="#local-6989586621689204654"><span class="hs-identifier hs-var">leftRow</span></a></span><span>
</span><span id="line-336"></span><span>                                                   </span><span id="local-6989586621689204646"><span class="annot"><span class="annottext">OutputValue
</span><a href="#local-6989586621689204646"><span class="hs-identifier hs-var">rightValue</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FieldName
-&gt; InsOrdHashMap FieldName OutputValue -&gt; Maybe OutputValue
forall k v. (Eq k, Hashable k) =&gt; k -&gt; InsOrdHashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">OMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621689204649"><span class="hs-identifier hs-var">rightField</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue
</span><a href="#local-6989586621689204650"><span class="hs-identifier hs-var">rightRow</span></a></span><span>
</span><span id="line-337"></span><span>                                                   </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutputValue
</span><a href="#local-6989586621689204647"><span class="hs-identifier hs-var">leftValue</span></a></span><span> </span><span class="annot"><span class="annottext">OutputValue -&gt; OutputValue -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OutputValue
</span><a href="#local-6989586621689204646"><span class="hs-identifier hs-var">rightValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>                                               </span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>                                      </span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>                                      </span><span class="annot"><span class="annottext">[(FieldName, FieldName)]
</span><a href="#local-6989586621689204660"><span class="hs-identifier hs-var">joinFields</span></a></span><span>
</span><span id="line-341"></span><span>                                </span><span class="hs-special">]</span><span>
</span><span id="line-342"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-345"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-347"></span><span>    </span><span id="local-6989586621689204651"><span class="annot"><span class="annottext">offset :: [InsOrdHashMap FieldName OutputValue]
-&gt; [InsOrdHashMap FieldName OutputValue]
</span><a href="#local-6989586621689204651"><span class="hs-identifier hs-var hs-var">offset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([InsOrdHashMap FieldName OutputValue]
 -&gt; [InsOrdHashMap FieldName OutputValue])
-&gt; (Int
    -&gt; [InsOrdHashMap FieldName OutputValue]
    -&gt; [InsOrdHashMap FieldName OutputValue])
-&gt; Maybe Int
-&gt; [InsOrdHashMap FieldName OutputValue]
-&gt; [InsOrdHashMap FieldName OutputValue]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">[InsOrdHashMap FieldName OutputValue]
-&gt; [InsOrdHashMap FieldName OutputValue]
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [InsOrdHashMap FieldName OutputValue]
-&gt; [InsOrdHashMap FieldName OutputValue]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621689204658"><span class="hs-identifier hs-var">rhsOffset</span></a></span><span>
</span><span id="line-348"></span><span>    </span><span id="local-6989586621689204652"><span class="annot"><span class="annottext">limit :: [InsOrdHashMap FieldName OutputValue]
-&gt; [InsOrdHashMap FieldName OutputValue]
</span><a href="#local-6989586621689204652"><span class="hs-identifier hs-var hs-var">limit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-349"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Top
</span><a href="#local-6989586621689204659"><span class="hs-identifier hs-var">rhsTop</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-350"></span><span>        </span><span class="annot"><span class="annottext">Top
</span><a href="Hasura.Backends.MySQL.Types.Internal.html#NoTop"><span class="hs-identifier hs-var">NoTop</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[InsOrdHashMap FieldName OutputValue]
-&gt; [InsOrdHashMap FieldName OutputValue]
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-351"></span><span>        </span><span class="annot"><a href="Hasura.Backends.MySQL.Types.Internal.html#Top"><span class="hs-identifier hs-type">Top</span></a></span><span> </span><span id="local-6989586621689204641"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621689204641"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [InsOrdHashMap FieldName OutputValue]
-&gt; [InsOrdHashMap FieldName OutputValue]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621689204641"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="hs-comment">-- | Join a row with another as an array join.</span><span>
</span><span id="line-354"></span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#joinArrayRows"><span class="hs-identifier hs-type">joinArrayRows</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-355"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-356"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-357"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">InsOrdHashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-type">DataLoaderPlan.FieldName</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#OutputValue"><span class="hs-identifier hs-type">OutputValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-358"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InsOrdHashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-type">DataLoaderPlan.FieldName</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#OutputValue"><span class="hs-identifier hs-type">OutputValue</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-359"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">InsOrdHashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-type">DataLoaderPlan.FieldName</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#OutputValue"><span class="hs-identifier hs-type">OutputValue</span></a></span><span>
</span><span id="line-360"></span><span id="joinArrayRows"><span class="annot"><span class="annottext">joinArrayRows :: Maybe [Text]
-&gt; Text
-&gt; InsOrdHashMap FieldName OutputValue
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
-&gt; InsOrdHashMap FieldName OutputValue
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#joinArrayRows"><span class="hs-identifier hs-var hs-var">joinArrayRows</span></a></span></span><span> </span><span id="local-6989586621689204639"><span class="annot"><span class="annottext">Maybe [Text]
</span><a href="#local-6989586621689204639"><span class="hs-identifier hs-var">wantedFields</span></a></span></span><span> </span><span id="local-6989586621689204638"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689204638"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span> </span><span id="local-6989586621689204637"><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue
</span><a href="#local-6989586621689204637"><span class="hs-identifier hs-var">leftRow</span></a></span></span><span> </span><span id="local-6989586621689204636"><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="#local-6989586621689204636"><span class="hs-identifier hs-var">rightRow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-361"></span><span>  </span><span class="annot"><span class="annottext">FieldName
-&gt; OutputValue
-&gt; InsOrdHashMap FieldName OutputValue
-&gt; InsOrdHashMap FieldName OutputValue
forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; InsOrdHashMap k v -&gt; InsOrdHashMap k v
</span><span class="hs-identifier hs-var">OMap.insert</span></span><span>
</span><span id="line-362"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; FieldName
</span><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-var">DataLoaderPlan.FieldName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689204638"><span class="hs-identifier hs-var">fieldName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Vector OutputValue -&gt; OutputValue
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#ArrayOutputValue"><span class="hs-identifier hs-var">ArrayOutputValue</span></a></span><span>
</span><span id="line-364"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(InsOrdHashMap FieldName OutputValue -&gt; OutputValue)
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
-&gt; Vector OutputValue
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span>
</span><span id="line-365"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue -&gt; OutputValue
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordOutputValue"><span class="hs-identifier hs-var">RecordOutputValue</span></a></span><span>
</span><span id="line-366"></span><span>                </span><span class="annot"><span class="annottext">(InsOrdHashMap FieldName OutputValue -&gt; OutputValue)
-&gt; (InsOrdHashMap FieldName OutputValue
    -&gt; InsOrdHashMap FieldName OutputValue)
-&gt; InsOrdHashMap FieldName OutputValue
-&gt; OutputValue
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(FieldName -&gt; OutputValue -&gt; Bool)
-&gt; InsOrdHashMap FieldName OutputValue
-&gt; InsOrdHashMap FieldName OutputValue
forall k v.
(k -&gt; v -&gt; Bool) -&gt; InsOrdHashMap k v -&gt; InsOrdHashMap k v
</span><span class="hs-identifier hs-var">OMap.filterWithKey</span></span><span>
</span><span id="line-367"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-type">DataLoaderPlan.FieldName</span></a></span><span> </span><span id="local-6989586621689204635"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689204635"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OutputValue
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-368"></span><span>                      </span><span class="annot"><span class="annottext">Bool -&gt; ([Text] -&gt; Bool) -&gt; Maybe [Text] -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">elem</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689204635"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
</span><a href="#local-6989586621689204639"><span class="hs-identifier hs-var">wantedFields</span></a></span><span>
</span><span id="line-369"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>            </span><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="#local-6989586621689204636"><span class="hs-identifier hs-var">rightRow</span></a></span><span>
</span><span id="line-372"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>    </span><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue
</span><a href="#local-6989586621689204637"><span class="hs-identifier hs-var">leftRow</span></a></span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span class="hs-comment">-- | Join a row with another as an object join.</span><span>
</span><span id="line-377"></span><span class="hs-comment">--</span><span>
</span><span id="line-378"></span><span class="hs-comment">-- If rightRow is not a single row, we throw 'BrokenJoinInvariant'.</span><span>
</span><span id="line-379"></span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#joinObjectRows"><span class="hs-identifier hs-type">joinObjectRows</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-380"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-381"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-382"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">InsOrdHashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-type">DataLoaderPlan.FieldName</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#OutputValue"><span class="hs-identifier hs-type">OutputValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-383"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InsOrdHashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-type">DataLoaderPlan.FieldName</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#OutputValue"><span class="hs-identifier hs-type">OutputValue</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-384"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#ExecuteProblem"><span class="hs-identifier hs-type">ExecuteProblem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InsOrdHashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-type">DataLoaderPlan.FieldName</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#OutputValue"><span class="hs-identifier hs-type">OutputValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span id="joinObjectRows"><span class="annot"><span class="annottext">joinObjectRows :: Maybe [Text]
-&gt; Text
-&gt; InsOrdHashMap FieldName OutputValue
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
-&gt; Either ExecuteProblem (InsOrdHashMap FieldName OutputValue)
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#joinObjectRows"><span class="hs-identifier hs-var hs-var">joinObjectRows</span></a></span></span><span> </span><span id="local-6989586621689204634"><span class="annot"><span class="annottext">Maybe [Text]
</span><a href="#local-6989586621689204634"><span class="hs-identifier hs-var">wantedFields</span></a></span></span><span> </span><span id="local-6989586621689204633"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689204633"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span> </span><span id="local-6989586621689204632"><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue
</span><a href="#local-6989586621689204632"><span class="hs-identifier hs-var">leftRow</span></a></span></span><span> </span><span id="local-6989586621689204631"><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="#local-6989586621689204631"><span class="hs-identifier hs-var">rightRows</span></a></span></span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName OutputValue) -&gt; Int
forall a. Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="#local-6989586621689204631"><span class="hs-identifier hs-var">rightRows</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExecuteProblem
-&gt; Either ExecuteProblem (InsOrdHashMap FieldName OutputValue)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(ExecuteProblem
 -&gt; Either ExecuteProblem (InsOrdHashMap FieldName OutputValue))
-&gt; (Vector (InsOrdHashMap FieldName OutputValue) -&gt; ExecuteProblem)
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
-&gt; Either ExecuteProblem (InsOrdHashMap FieldName OutputValue)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[FieldName] -&gt; ExecuteProblem
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#BrokenJoinInvariant"><span class="hs-identifier hs-var">BrokenJoinInvariant</span></a></span><span> </span><span class="annot"><span class="annottext">([FieldName] -&gt; ExecuteProblem)
-&gt; (Vector (InsOrdHashMap FieldName OutputValue) -&gt; [FieldName])
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
-&gt; ExecuteProblem
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(InsOrdHashMap FieldName OutputValue -&gt; [FieldName])
-&gt; Vector (InsOrdHashMap FieldName OutputValue) -&gt; [FieldName]
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue -&gt; [FieldName]
forall k v. InsOrdHashMap k v -&gt; [k]
</span><span class="hs-identifier hs-var">OMap.keys</span></span><span> </span><span class="annot"><span class="annottext">(Vector (InsOrdHashMap FieldName OutputValue)
 -&gt; Either ExecuteProblem (InsOrdHashMap FieldName OutputValue))
-&gt; Vector (InsOrdHashMap FieldName OutputValue)
-&gt; Either ExecuteProblem (InsOrdHashMap FieldName OutputValue)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="#local-6989586621689204631"><span class="hs-identifier hs-var">rightRows</span></a></span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-388"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689204627"><span class="annot"><span class="annottext">row :: InsOrdHashMap FieldName OutputValue
</span><a href="#local-6989586621689204627"><span class="hs-identifier hs-var hs-var">row</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName OutputValue)
-&gt; InsOrdHashMap FieldName OutputValue
forall a. Vector a -&gt; a
</span><span class="hs-identifier hs-var">V.head</span></span><span> </span><span class="annot"><span class="annottext">Vector (InsOrdHashMap FieldName OutputValue)
</span><a href="#local-6989586621689204631"><span class="hs-identifier hs-var">rightRows</span></a></span><span>
</span><span id="line-389"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue
-&gt; Either ExecuteProblem (InsOrdHashMap FieldName OutputValue)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(InsOrdHashMap FieldName OutputValue
 -&gt; Either ExecuteProblem (InsOrdHashMap FieldName OutputValue))
-&gt; InsOrdHashMap FieldName OutputValue
-&gt; Either ExecuteProblem (InsOrdHashMap FieldName OutputValue)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-390"></span><span>          </span><span class="annot"><span class="annottext">FieldName
-&gt; OutputValue
-&gt; InsOrdHashMap FieldName OutputValue
-&gt; InsOrdHashMap FieldName OutputValue
forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; InsOrdHashMap k v -&gt; InsOrdHashMap k v
</span><span class="hs-identifier hs-var">OMap.insert</span></span><span>
</span><span id="line-391"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; FieldName
</span><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-var">DataLoaderPlan.FieldName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689204633"><span class="hs-identifier hs-var">fieldName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue -&gt; OutputValue
</span><a href="Hasura.Backends.MySQL.DataLoader.Execute.html#RecordOutputValue"><span class="hs-identifier hs-var">RecordOutputValue</span></a></span><span>
</span><span id="line-393"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(FieldName -&gt; OutputValue -&gt; Bool)
-&gt; InsOrdHashMap FieldName OutputValue
-&gt; InsOrdHashMap FieldName OutputValue
forall k v.
(k -&gt; v -&gt; Bool) -&gt; InsOrdHashMap k v -&gt; InsOrdHashMap k v
</span><span class="hs-identifier hs-var">OMap.filterWithKey</span></span><span>
</span><span id="line-394"></span><span>                    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.MySQL.DataLoader.Plan.html#FieldName"><span class="hs-identifier hs-type">DataLoaderPlan.FieldName</span></a></span><span> </span><span id="local-6989586621689204625"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689204625"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OutputValue
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ([Text] -&gt; Bool) -&gt; Maybe [Text] -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">elem</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689204625"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
</span><a href="#local-6989586621689204634"><span class="hs-identifier hs-var">wantedFields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span>                    </span><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue
</span><a href="#local-6989586621689204627"><span class="hs-identifier hs-var">row</span></a></span><span>
</span><span id="line-396"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>            </span><span class="annot"><span class="annottext">InsOrdHashMap FieldName OutputValue
</span><a href="#local-6989586621689204632"><span class="hs-identifier hs-var">leftRow</span></a></span><span>
</span><span id="line-399"></span></pre></body></html>