<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE Arrows #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">-- | Types and functions used in the process of building the schema cache from metadata information</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- stored in the @hdb_catalog@ schema in Postgres.</span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.RQL.Types.SchemaCache.Build</span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataDependency"><span class="hs-identifier">MetadataDependency</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistencies"><span class="hs-identifier">recordInconsistencies</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistencyM"><span class="hs-identifier">recordInconsistencyM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistenciesM"><span class="hs-identifier">recordInconsistenciesM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordDependencies"><span class="hs-identifier">recordDependencies</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordDependenciesM"><span class="hs-identifier">recordDependenciesM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistency"><span class="hs-identifier">withRecordInconsistency</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier">withRecordInconsistencyM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencies"><span class="hs-identifier">withRecordInconsistencies</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier">CacheRWM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCacheWithOptions"><span class="hs-identifier">buildSchemaCacheWithOptions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#BuildReason"><span class="hs-identifier">BuildReason</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier">CacheInvalidations</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#ValidateNewSchemaCache"><span class="hs-identifier">ValidateNewSchemaCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#ValidateNewSchemaCacheResult"><span class="hs-identifier">ValidateNewSchemaCacheResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier">MetadataM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataT"><span class="hs-identifier">MetadataT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#runMetadataT"><span class="hs-identifier">runMetadataT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCacheWithInvalidations"><span class="hs-identifier">buildSchemaCacheWithInvalidations</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCache"><span class="hs-identifier">buildSchemaCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCache"><span class="hs-identifier">tryBuildSchemaCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCacheWithModifiers"><span class="hs-identifier">tryBuildSchemaCacheWithModifiers</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCacheAndWarnOnFailingObjects"><span class="hs-identifier">tryBuildSchemaCacheAndWarnOnFailingObjects</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCacheFor"><span class="hs-identifier">buildSchemaCacheFor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#throwOnInconsistencies"><span class="hs-identifier">throwOnInconsistencies</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#withNewInconsistentObjsCheck"><span class="hs-identifier">withNewInconsistentObjsCheck</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#getInconsistentQueryCollections"><span class="hs-identifier">getInconsistentQueryCollections</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#StoredIntrospection"><span class="hs-identifier">StoredIntrospection</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#StoredIntrospectionItem"><span class="hs-identifier">StoredIntrospectionItem</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier">CollectItem</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">where</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Extended.html"><span class="hs-identifier">Control.Arrow.Extended</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/mmorph-1.2.0-b97db20fdd237afaed65fccc5829c422d35937fead9df9f9f77000a8c06eab8e/share/doc/html/src/Control.Monad.Morph.html"><span class="hs-identifier">Control.Monad.Morph</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-db4229aec3d9c1011503cf06798714c732b74d731fab23998dd34d578ed6d457/share/doc/html/src/Control.Monad.Trans.Control.html"><span class="hs-identifier">Control.Monad.Trans.Control</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-db4229aec3d9c1011503cf06798714c732b74d731fab23998dd34d578ed6d457/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier">MonadBaseControl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.html"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.FromJSON.html#FromJSON"><span class="hs-identifier">FromJSON</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#ToJSON"><span class="hs-identifier">ToJSON</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier">Value</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.FromJSON.html#genericParseJSON"><span class="hs-identifier">genericParseJSON</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#genericToEncoding"><span class="hs-identifier">genericToEncoding</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#genericToJSON"><span class="hs-identifier">genericToJSON</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.HashMap.Strict.Extended.html"><span class="hs-identifier">Data.HashMap.Strict.Extended</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HashMap</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-b5ad8e22c80bc291a2f581fb78a4448e46180aa38110e81c957f693abd1dc222/share/doc/html/src/Data.HashMap.Strict.InsOrd.html"><span class="hs-identifier">Data.HashMap.Strict.InsOrd</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">InsOrdHashMap</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.HashMap.Strict.Multi.html"><span class="hs-identifier">Data.HashMap.Strict.Multi</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MultiMap</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.List.Extended.html"><span class="hs-identifier">Data.List.Extended</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Seq</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html"><span class="hs-identifier">Data.Text.Extended</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.NonEmpty.html"><span class="hs-identifier">Data.Text.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.NonEmpty.html#unNonEmptyText"><span class="hs-identifier">unNonEmptyText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Trie.html"><span class="hs-identifier">Data.Trie</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Trie</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.html"><span class="hs-identifier">Database.PG.Query</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PG</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.DataConnector.Adapter.Types.html"><span class="hs-identifier">Hasura.Backends.DataConnector.Adapter.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.DataConnector.html#DataConnectorName"><span class="hs-identifier">DataConnectorName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.html"><span class="hs-identifier">Hasura.Backends.Postgres.Connection</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html"><span class="hs-identifier">Hasura.Base.Error</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html"><span class="hs-identifier">Hasura.EncJSON</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Analyse.html"><span class="hs-identifier">Hasura.GraphQL.Analyse</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html"><span class="hs-identifier">Hasura.GraphQL.Transport.HTTP.Protocol</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html"><span class="hs-identifier">Hasura.Prelude</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.QueryTags.html"><span class="hs-identifier">Hasura.QueryTags</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Warnings.html"><span class="hs-identifier">Hasura.RQL.DDL.Warnings</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Allowlist.html"><span class="hs-identifier">Hasura.RQL.Types.Allowlist</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Allowlist.html#NormalizedQuery"><span class="hs-identifier">NormalizedQuery</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Allowlist.html#unNormalizedQuery"><span class="hs-identifier">unNormalizedQuery</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html"><span class="hs-identifier">Hasura.RQL.Types.Common</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html"><span class="hs-identifier">Hasura.RQL.Types.Endpoint</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html"><span class="hs-identifier">Hasura.RQL.Types.Metadata</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html"><span class="hs-identifier">Hasura.RQL.Types.Metadata.Object</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html"><span class="hs-identifier">Hasura.RQL.Types.QueryCollection</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCache</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Session.html"><span class="hs-identifier">Hasura.RQL.Types.Session</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RemoteSchema.Metadata.html"><span class="hs-identifier">Hasura.RemoteSchema.Metadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RemoteSchema.Metadata.Base.html#RemoteSchemaName"><span class="hs-identifier">RemoteSchemaName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.FeatureFlag.html"><span class="hs-identifier">Hasura.Server.Init.FeatureFlag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.FeatureFlag.html#HasFeatureFlagChecker"><span class="hs-identifier">HasFeatureFlagChecker</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html"><span class="hs-identifier">Hasura.Server.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier">MonadGetPolicies</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Services.Network.html"><span class="hs-identifier">Hasura.Services.Network</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Tracing.html"><span class="hs-identifier">Hasura.Tracing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.Monad.html#TraceT"><span class="hs-identifier">TraceT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Tracing.html"><span class="hs-identifier">Hasura.Tracing</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Tracing</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src/Language.GraphQL.Draft.Syntax.html"><span class="hs-identifier">Language.GraphQL.Draft.Syntax</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">G</span></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="annot"><span class="hs-comment">-- * Inconsistencies</span></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span id="local-6989586621687616696"><span id="local-6989586621687616698"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistencies"><span class="hs-identifier hs-type">recordInconsistencies</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#ArrowWriter"><span class="hs-identifier hs-type">ArrowWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687616696"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621687616698"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621687616698"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621687616698"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-d0f6d61f5277bae932134563876cbceb4967915f364959864c72abbc2978d8ed/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687616696"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-84"></span><span id="recordInconsistencies"><span class="annot"><span class="annottext">recordInconsistencies :: forall (arr :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(ArrowWriter (Seq CollectItem) arr, Functor f, Foldable f) =&gt;
arr ((Maybe Value, f MetadataObject), Text) ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistencies"><span class="hs-identifier hs-var hs-var">recordInconsistencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621687617525"><span class="annot"><span class="annottext">Maybe Value
</span><a href="#local-6989586621687617525"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687617526"><span class="annot"><span class="annottext">f MetadataObject
</span><a href="#local-6989586621687617526"><span class="hs-identifier hs-var">mo</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621687617527"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687617527"><span class="hs-identifier hs-var">reason</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><span class="annottext">arr (Seq CollectItem) ()
forall w (arr :: * -&gt; * -&gt; *). ArrowWriter w arr =&gt; arr w ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#tellA"><span class="hs-identifier hs-var">tellA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">[CollectItem] -&gt; Seq CollectItem
forall a. [a] -&gt; Seq a
</span><span class="hs-identifier hs-var">Seq.fromList</span></span><span> </span><span class="annot"><span class="annottext">([CollectItem] -&gt; Seq CollectItem)
-&gt; [CollectItem] -&gt; Seq CollectItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">f CollectItem -&gt; [CollectItem]
forall a. f a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(f CollectItem -&gt; [CollectItem]) -&gt; f CollectItem -&gt; [CollectItem]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(MetadataObject -&gt; CollectItem)
-&gt; f MetadataObject -&gt; f CollectItem
forall a b. (a -&gt; b) -&gt; f a -&gt; f b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InconsistentMetadata -&gt; CollectItem
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectInconsistentMetadata"><span class="hs-identifier hs-var">CollectInconsistentMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">(InconsistentMetadata -&gt; CollectItem)
-&gt; (MetadataObject -&gt; InconsistentMetadata)
-&gt; MetadataObject
-&gt; CollectItem
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Value -&gt; MetadataObject -&gt; InconsistentMetadata
</span><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentObject"><span class="hs-identifier hs-var">InconsistentObject</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687617527"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Value
</span><a href="#local-6989586621687617525"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">f MetadataObject
</span><a href="#local-6989586621687617526"><span class="hs-identifier hs-var">mo</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span id="local-6989586621687616718"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistencyM"><span class="hs-identifier hs-type">recordInconsistencyM</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687616718"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-d0f6d61f5277bae932134563876cbceb4967915f364959864c72abbc2978d8ed/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687616718"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-89"></span><span id="recordInconsistencyM"><span class="annot"><span class="annottext">recordInconsistencyM :: forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
Maybe Value -&gt; MetadataObject -&gt; Text -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistencyM"><span class="hs-identifier hs-var hs-var">recordInconsistencyM</span></a></span></span><span> </span><span id="local-6989586621687617536"><span class="annot"><span class="annottext">Maybe Value
</span><a href="#local-6989586621687617536"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span id="local-6989586621687617537"><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687617537"><span class="hs-identifier hs-var">mo</span></a></span></span><span> </span><span id="local-6989586621687617538"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687617538"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Maybe Value, MetadataObject)] -&gt; Text -&gt; m ()
forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
[(Maybe Value, MetadataObject)] -&gt; Text -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistenciesM%27"><span class="hs-identifier hs-var">recordInconsistenciesM'</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Value
</span><a href="#local-6989586621687617536"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687617537"><span class="hs-identifier hs-var">mo</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687617538"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span id="local-6989586621687616722"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistenciesM"><span class="hs-identifier hs-type">recordInconsistenciesM</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687616722"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-d0f6d61f5277bae932134563876cbceb4967915f364959864c72abbc2978d8ed/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687616722"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-93"></span><span id="recordInconsistenciesM"><span class="annot"><span class="annottext">recordInconsistenciesM :: forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
[MetadataObject] -&gt; Text -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistenciesM"><span class="hs-identifier hs-var hs-var">recordInconsistenciesM</span></a></span></span><span> </span><span id="local-6989586621687617543"><span class="annot"><span class="annottext">[MetadataObject]
</span><a href="#local-6989586621687617543"><span class="hs-identifier hs-var">metadataObjects</span></a></span></span><span> </span><span id="local-6989586621687617544"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687617544"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Maybe Value, MetadataObject)] -&gt; Text -&gt; m ()
forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
[(Maybe Value, MetadataObject)] -&gt; Text -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistenciesM%27"><span class="hs-identifier hs-var">recordInconsistenciesM'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(MetadataObject -&gt; (Maybe Value, MetadataObject))
-&gt; [MetadataObject] -&gt; [(Maybe Value, MetadataObject)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[MetadataObject]
</span><a href="#local-6989586621687617543"><span class="hs-identifier hs-var">metadataObjects</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687617544"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span id="local-6989586621687616721"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistenciesM%27"><span class="hs-identifier hs-type">recordInconsistenciesM'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687616721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-d0f6d61f5277bae932134563876cbceb4967915f364959864c72abbc2978d8ed/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687616721"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-97"></span><span id="recordInconsistenciesM%27"><span class="annot"><span class="annottext">recordInconsistenciesM' :: forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
[(Maybe Value, MetadataObject)] -&gt; Text -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistenciesM%27"><span class="hs-identifier hs-var hs-var">recordInconsistenciesM'</span></a></span></span><span> </span><span id="local-6989586621687617548"><span class="annot"><span class="annottext">[(Maybe Value, MetadataObject)]
</span><a href="#local-6989586621687617548"><span class="hs-identifier hs-var">metadataObjects</span></a></span></span><span> </span><span id="local-6989586621687617549"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687617549"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><span class="annottext">Seq CollectItem -&gt; m ()
forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><span class="hs-identifier hs-var">tell</span></span><span> </span><span class="annot"><span class="annottext">(Seq CollectItem -&gt; m ()) -&gt; Seq CollectItem -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[CollectItem] -&gt; Seq CollectItem
forall a. [a] -&gt; Seq a
</span><span class="hs-identifier hs-var">Seq.fromList</span></span><span> </span><span class="annot"><span class="annottext">([CollectItem] -&gt; Seq CollectItem)
-&gt; [CollectItem] -&gt; Seq CollectItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Maybe Value, MetadataObject) -&gt; CollectItem)
-&gt; [(Maybe Value, MetadataObject)] -&gt; [CollectItem]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InconsistentMetadata -&gt; CollectItem
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectInconsistentMetadata"><span class="hs-identifier hs-var">CollectInconsistentMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">(InconsistentMetadata -&gt; CollectItem)
-&gt; ((Maybe Value, MetadataObject) -&gt; InconsistentMetadata)
-&gt; (Maybe Value, MetadataObject)
-&gt; CollectItem
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Value -&gt; MetadataObject -&gt; InconsistentMetadata)
-&gt; (Maybe Value, MetadataObject) -&gt; InconsistentMetadata
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Maybe Value -&gt; MetadataObject -&gt; InconsistentMetadata
</span><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentObject"><span class="hs-identifier hs-var">InconsistentObject</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687617549"><span class="hs-identifier hs-var">reason</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Maybe Value, MetadataObject)]
</span><a href="#local-6989586621687617548"><span class="hs-identifier hs-var">metadataObjects</span></a></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="annot"><span class="hs-comment">-- * Dependencies</span></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-keyword">data</span><span> </span><span id="MetadataDependency"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataDependency"><span class="hs-identifier hs-var">MetadataDependency</span></a></span></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="MetadataDependency"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataDependency"><span class="hs-identifier hs-var">MetadataDependency</span></a></span></span><span>
</span><span id="line-104"></span><span>      </span><span class="annot"><span class="hs-comment">-- | for error reporting on missing dependencies</span></span><span>
</span><span id="line-105"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span><span>
</span><span id="line-106"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SchemaObjId"><span class="hs-identifier hs-type">SchemaObjId</span></a></span><span>
</span><span id="line-107"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SchemaDependency"><span class="hs-identifier hs-type">SchemaDependency</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687617554"><span id="local-6989586621687617562"><span class="annot"><span class="annottext">MetadataDependency -&gt; MetadataDependency -&gt; Bool
(MetadataDependency -&gt; MetadataDependency -&gt; Bool)
-&gt; (MetadataDependency -&gt; MetadataDependency -&gt; Bool)
-&gt; Eq MetadataDependency
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: MetadataDependency -&gt; MetadataDependency -&gt; Bool
== :: MetadataDependency -&gt; MetadataDependency -&gt; Bool
$c/= :: MetadataDependency -&gt; MetadataDependency -&gt; Bool
/= :: MetadataDependency -&gt; MetadataDependency -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687617567"><span id="local-6989586621687617577"><span id="local-6989586621687617581"><span class="annot"><span class="annottext">Int -&gt; MetadataDependency -&gt; ShowS
[MetadataDependency] -&gt; ShowS
MetadataDependency -&gt; String
(Int -&gt; MetadataDependency -&gt; ShowS)
-&gt; (MetadataDependency -&gt; String)
-&gt; ([MetadataDependency] -&gt; ShowS)
-&gt; Show MetadataDependency
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; MetadataDependency -&gt; ShowS
showsPrec :: Int -&gt; MetadataDependency -&gt; ShowS
$cshow :: MetadataDependency -&gt; String
show :: MetadataDependency -&gt; String
$cshowList :: [MetadataDependency] -&gt; ShowS
showList :: [MetadataDependency] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span id="local-6989586621687616742"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordDependencies"><span class="hs-identifier hs-type">recordDependencies</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#ArrowWriter"><span class="hs-identifier hs-type">ArrowWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687616742"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SchemaObjId"><span class="hs-identifier hs-type">SchemaObjId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SchemaDependency"><span class="hs-identifier hs-type">SchemaDependency</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687616742"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-113"></span><span id="recordDependencies"><span class="annot"><span class="annottext">recordDependencies :: forall (arr :: * -&gt; * -&gt; *).
ArrowWriter (Seq CollectItem) arr =&gt;
arr (MetadataObject, SchemaObjId, Seq SchemaDependency) ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordDependencies"><span class="hs-identifier hs-var hs-var">recordDependencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687617592"><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687617592"><span class="hs-identifier hs-var">metadataObject</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687617593"><span class="annot"><span class="annottext">SchemaObjId
</span><a href="#local-6989586621687617593"><span class="hs-identifier hs-var">schemaObjectId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687617594"><span class="annot"><span class="annottext">Seq SchemaDependency
</span><a href="#local-6989586621687617594"><span class="hs-identifier hs-var">dependencies</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-114"></span><span>  </span><span class="annot"><span class="annottext">arr (Seq CollectItem) ()
forall w (arr :: * -&gt; * -&gt; *). ArrowWriter w arr =&gt; arr w ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#tellA"><span class="hs-identifier hs-var">tellA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">MetadataDependency -&gt; CollectItem
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectMetadataDependency"><span class="hs-identifier hs-var">CollectMetadataDependency</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataDependency -&gt; CollectItem)
-&gt; (SchemaDependency -&gt; MetadataDependency)
-&gt; SchemaDependency
-&gt; CollectItem
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MetadataObject
-&gt; SchemaObjId -&gt; SchemaDependency -&gt; MetadataDependency
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataDependency"><span class="hs-identifier hs-var">MetadataDependency</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687617592"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaObjId
</span><a href="#local-6989586621687617593"><span class="hs-identifier hs-var">schemaObjectId</span></a></span><span> </span><span class="annot"><span class="annottext">(SchemaDependency -&gt; CollectItem)
-&gt; Seq SchemaDependency -&gt; Seq CollectItem
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Seq SchemaDependency
</span><a href="#local-6989586621687617594"><span class="hs-identifier hs-var">dependencies</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span id="local-6989586621687616744"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordDependenciesM"><span class="hs-identifier hs-type">recordDependenciesM</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687616744"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-118"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-119"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SchemaObjId"><span class="hs-identifier hs-type">SchemaObjId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SchemaDependency"><span class="hs-identifier hs-type">SchemaDependency</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-121"></span><span>  </span><span class="annot"><a href="#local-6989586621687616744"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-122"></span><span id="recordDependenciesM"><span class="annot"><span class="annottext">recordDependenciesM :: forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; SchemaObjId -&gt; Seq SchemaDependency -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordDependenciesM"><span class="hs-identifier hs-var hs-var">recordDependenciesM</span></a></span></span><span> </span><span id="local-6989586621687617599"><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687617599"><span class="hs-identifier hs-var">metadataObject</span></a></span></span><span> </span><span id="local-6989586621687617600"><span class="annot"><span class="annottext">SchemaObjId
</span><a href="#local-6989586621687617600"><span class="hs-identifier hs-var">schemaObjectId</span></a></span></span><span> </span><span id="local-6989586621687617601"><span class="annot"><span class="annottext">Seq SchemaDependency
</span><a href="#local-6989586621687617601"><span class="hs-identifier hs-var">dependencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-123"></span><span>  </span><span class="annot"><span class="annottext">Seq CollectItem -&gt; m ()
forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><span class="hs-identifier hs-var">tell</span></span><span> </span><span class="annot"><span class="annottext">(Seq CollectItem -&gt; m ()) -&gt; Seq CollectItem -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetadataDependency -&gt; CollectItem
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectMetadataDependency"><span class="hs-identifier hs-var">CollectMetadataDependency</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataDependency -&gt; CollectItem)
-&gt; (SchemaDependency -&gt; MetadataDependency)
-&gt; SchemaDependency
-&gt; CollectItem
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MetadataObject
-&gt; SchemaObjId -&gt; SchemaDependency -&gt; MetadataDependency
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataDependency"><span class="hs-identifier hs-var">MetadataDependency</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687617599"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaObjId
</span><a href="#local-6989586621687617600"><span class="hs-identifier hs-var">schemaObjectId</span></a></span><span> </span><span class="annot"><span class="annottext">(SchemaDependency -&gt; CollectItem)
-&gt; Seq SchemaDependency -&gt; Seq CollectItem
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Seq SchemaDependency
</span><a href="#local-6989586621687617601"><span class="hs-identifier hs-var">dependencies</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="annot"><span class="hs-comment">-- * Helpers</span></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="annot"><span class="hs-comment">-- | Monadic version of 'withRecordInconsistency'</span></span><span>
</span><span id="line-128"></span><span id="local-6989586621687616746"><span id="local-6989586621687616747"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-type">withRecordInconsistencyM</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687616746"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687616746"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687616747"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><a href="#local-6989586621687616746"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621687616747"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-133"></span><span id="withRecordInconsistencyM"><span class="annot"><span class="annottext">withRecordInconsistencyM :: forall (m :: * -&gt; *) a.
MonadWriter (Seq CollectItem) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var hs-var">withRecordInconsistencyM</span></a></span></span><span> </span><span id="local-6989586621687617616"><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687617616"><span class="hs-identifier hs-var">metadataObject</span></a></span></span><span> </span><span id="local-6989586621687617617"><span class="annot"><span class="annottext">ExceptT QErr m a
</span><a href="#local-6989586621687617617"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-134"></span><span>  </span><span id="local-6989586621687617618"><span class="annot"><span class="annottext">Either QErr a
</span><a href="#local-6989586621687617618"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT QErr m a -&gt; m (Either QErr a)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">ExceptT QErr m a
</span><a href="#local-6989586621687617617"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either QErr a
</span><a href="#local-6989586621687617618"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621687617620"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687617620"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-137"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">QErr -&gt; Maybe QErrExtra
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#qeInternal"><span class="hs-identifier hs-var">qeInternal</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687617620"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-138"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#ExtraExtensions"><span class="hs-identifier hs-type">ExtraExtensions</span></a></span><span> </span><span id="local-6989586621687617623"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687617623"><span class="hs-identifier hs-var">exts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-139"></span><span>          </span><span class="hs-comment">-- the QErr type contains an optional qeInternal :: Maybe QErrExtra field, which either stores an error coming</span><span>
</span><span id="line-140"></span><span>          </span><span class="hs-comment">-- from an action webhook (ExtraExtensions) or an internal error thrown somewhere within graphql-engine.</span><span>
</span><span id="line-141"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-142"></span><span>          </span><span class="hs-comment">-- if we do have an error here, it should be an internal error and hence never be of the former case:</span><span>
</span><span id="line-143"></span><span>          </span><span class="annot"><span class="annottext">Maybe Value -&gt; MetadataObject -&gt; Text -&gt; m ()
forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
Maybe Value -&gt; MetadataObject -&gt; Text -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistencyM"><span class="hs-identifier hs-var">recordInconsistencyM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Maybe Value
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687617623"><span class="hs-identifier hs-var">exts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687617616"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;withRecordInconsistency: unexpected ExtraExtensions&quot;</span></span><span>
</span><span id="line-144"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#ExtraInternal"><span class="hs-identifier hs-type">ExtraInternal</span></a></span><span> </span><span id="local-6989586621687617626"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687617626"><span class="hs-identifier hs-var">internal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-145"></span><span>          </span><span class="annot"><span class="annottext">Maybe Value -&gt; MetadataObject -&gt; Text -&gt; m ()
forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
Maybe Value -&gt; MetadataObject -&gt; Text -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistencyM"><span class="hs-identifier hs-var">recordInconsistencyM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Maybe Value
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687617626"><span class="hs-identifier hs-var">internal</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687617616"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QErr -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#qeError"><span class="hs-identifier hs-var">qeError</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687617620"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>        </span><span class="annot"><span class="annottext">Maybe QErrExtra
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-147"></span><span>          </span><span class="annot"><span class="annottext">Maybe Value -&gt; MetadataObject -&gt; Text -&gt; m ()
forall (m :: * -&gt; *).
MonadWriter (Seq CollectItem) m =&gt;
Maybe Value -&gt; MetadataObject -&gt; Text -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistencyM"><span class="hs-identifier hs-var">recordInconsistencyM</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687617616"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QErr -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#qeError"><span class="hs-identifier hs-var">qeError</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687617620"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>      </span><span class="annot"><span class="annottext">Maybe a -&gt; m (Maybe a)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621687617628"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621687617628"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; m (Maybe a)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe a -&gt; m (Maybe a)) -&gt; Maybe a -&gt; m (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621687617628"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span id="local-6989586621687616759"><span id="local-6989586621687616761"><span id="local-6989586621687616762"><span id="local-6989586621687616763"><span id="local-6989586621687616764"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistenciesWith"><span class="hs-identifier hs-type">recordInconsistenciesWith</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ArrowChoice</span></span><span> </span><span class="annot"><a href="#local-6989586621687616759"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#ArrowWriter"><span class="hs-identifier hs-type">ArrowWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687616759"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#ArrowWriter"><span class="hs-identifier hs-type">ArrowWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687616759"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621687616761"><span class="hs-identifier hs-type">mo</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-d0f6d61f5277bae932134563876cbceb4967915f364959864c72abbc2978d8ed/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687616759"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-154"></span><span>  </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#ErrorA"><span class="hs-identifier hs-type">ErrorA</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687616759"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687616762"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621687616763"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687616764"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-155"></span><span>  </span><span class="annot"><a href="#local-6989586621687616759"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687616762"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687616761"><span class="hs-identifier hs-type">mo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621687616763"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621687616764"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-156"></span><span id="recordInconsistenciesWith"><span class="annot"><span class="annottext">recordInconsistenciesWith :: forall (arr :: * -&gt; * -&gt; *) mo e s a.
(ArrowChoice arr, ArrowWriter (Seq CollectItem) arr) =&gt;
(ArrowWriter (Seq CollectItem) arr =&gt;
 arr ((Maybe Value, mo), Text) ())
-&gt; ErrorA QErr arr (e, s) a -&gt; arr (e, (mo, s)) (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistenciesWith"><span class="hs-identifier hs-var hs-var">recordInconsistenciesWith</span></a></span></span><span> </span><span id="local-6989586621687617646"><span class="annot"><span class="annottext">ArrowWriter (Seq CollectItem) arr =&gt;
arr ((Maybe Value, mo), Text) ()
</span><a href="#local-6989586621687617646"><span class="hs-identifier hs-var">recordInconsistency'</span></a></span></span><span> </span><span id="local-6989586621687617647"><span class="annot"><span class="annottext">ErrorA QErr arr (e, s) a
</span><a href="#local-6989586621687617647"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687617648"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621687617648"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687617649"><span class="annot"><span class="annottext">mo
</span><a href="#local-6989586621687617649"><span class="hs-identifier hs-var">metadataObject</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687617650"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621687617650"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-157"></span><span>  </span><span id="local-6989586621687617651"><span class="annot"><span class="annottext">Either QErr a
</span><a href="#local-6989586621687617651"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ErrorA QErr arr (e, s) a -&gt; arr (e, s) (Either QErr a)
forall {k} e (arr :: k -&gt; * -&gt; *) (a :: k) b.
ErrorA e arr a b -&gt; arr a (Either e b)
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#runErrorA"><span class="hs-identifier hs-var">runErrorA</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorA QErr arr (e, s) a
</span><a href="#local-6989586621687617647"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621687617648"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621687617650"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either QErr a
</span><a href="#local-6989586621687617651"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621687617653"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687617653"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-160"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">QErr -&gt; Maybe QErrExtra
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#qeInternal"><span class="hs-identifier hs-var">qeInternal</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687617653"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-161"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#ExtraExtensions"><span class="hs-identifier hs-type">ExtraExtensions</span></a></span><span> </span><span id="local-6989586621687617654"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687617654"><span class="hs-identifier hs-var">exts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-162"></span><span>          </span><span class="hs-comment">-- the QErr type contains an optional qeInternal :: Maybe QErrExtra field, which either stores an error coming</span><span>
</span><span id="line-163"></span><span>          </span><span class="hs-comment">-- from an action webhook (ExtraExtensions) or an internal error thrown somewhere within graphql-engine.</span><span>
</span><span id="line-164"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-165"></span><span>          </span><span class="hs-comment">-- if we do have an error here, it should be an internal error and hence never be of the former case:</span><span>
</span><span id="line-166"></span><span>          </span><span class="annot"><span class="annottext">arr ((Maybe Value, mo), Text) ()
ArrowWriter (Seq CollectItem) arr =&gt;
arr ((Maybe Value, mo), Text) ()
</span><a href="#local-6989586621687617646"><span class="hs-identifier hs-var">recordInconsistency'</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Maybe Value
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687617654"><span class="hs-identifier hs-var">exts</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mo
</span><a href="#local-6989586621687617649"><span class="hs-identifier hs-var">metadataObject</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;withRecordInconsistency: unexpected ExtraExtensions&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#ExtraInternal"><span class="hs-identifier hs-type">ExtraInternal</span></a></span><span> </span><span id="local-6989586621687617655"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687617655"><span class="hs-identifier hs-var">internal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-168"></span><span>          </span><span class="annot"><span class="annottext">arr ((Maybe Value, mo), Text) ()
ArrowWriter (Seq CollectItem) arr =&gt;
arr ((Maybe Value, mo), Text) ()
</span><a href="#local-6989586621687617646"><span class="hs-identifier hs-var">recordInconsistency'</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Maybe Value
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687617655"><span class="hs-identifier hs-var">internal</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mo
</span><a href="#local-6989586621687617649"><span class="hs-identifier hs-var">metadataObject</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QErr -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#qeError"><span class="hs-identifier hs-var">qeError</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687617653"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>        </span><span class="annot"><span class="annottext">Maybe QErrExtra
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-170"></span><span>          </span><span class="annot"><span class="annottext">arr ((Maybe Value, mo), Text) ()
ArrowWriter (Seq CollectItem) arr =&gt;
arr ((Maybe Value, mo), Text) ()
</span><a href="#local-6989586621687617646"><span class="hs-identifier hs-var">recordInconsistency'</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mo
</span><a href="#local-6989586621687617649"><span class="hs-identifier hs-var">metadataObject</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QErr -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#qeError"><span class="hs-identifier hs-var">qeError</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687617653"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>      </span><span class="annot"><span class="annottext">arr (Maybe a) (Maybe a)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-172"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621687617657"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621687617657"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">arr (Maybe a) (Maybe a)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621687617657"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-173"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistenciesWith"><span class="hs-pragma hs-type">recordInconsistenciesWith</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="annot"><span class="hs-comment">-- | Record any errors resulting from a computation as inconsistencies</span></span><span>
</span><span id="line-176"></span><span id="local-6989586621687616779"><span id="local-6989586621687616780"><span id="local-6989586621687616781"><span id="local-6989586621687616782"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistency"><span class="hs-identifier hs-type">withRecordInconsistency</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ArrowChoice</span></span><span> </span><span class="annot"><a href="#local-6989586621687616779"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#ArrowWriter"><span class="hs-identifier hs-type">ArrowWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687616779"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-178"></span><span>  </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#ErrorA"><span class="hs-identifier hs-type">ErrorA</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687616779"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687616780"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621687616781"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687616782"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-179"></span><span>  </span><span class="annot"><a href="#local-6989586621687616779"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687616780"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621687616781"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621687616782"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-180"></span><span id="withRecordInconsistency"><span class="annot"><span class="annottext">withRecordInconsistency :: forall (arr :: * -&gt; * -&gt; *) e s a.
(ArrowChoice arr, ArrowWriter (Seq CollectItem) arr) =&gt;
ErrorA QErr arr (e, s) a -&gt; arr (e, (MetadataObject, s)) (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistency"><span class="hs-identifier hs-var hs-var">withRecordInconsistency</span></a></span></span><span> </span><span id="local-6989586621687617666"><span class="annot"><span class="annottext">ErrorA QErr arr (e, s) a
</span><a href="#local-6989586621687617666"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687617667"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621687617667"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687617668"><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687617668"><span class="hs-identifier hs-var">mo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687617669"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621687617669"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-181"></span><span>  </span><span class="annot"><span class="annottext">(ArrowWriter (Seq CollectItem) arr =&gt;
 arr ((Maybe Value, Identity MetadataObject), Text) ())
-&gt; ErrorA QErr arr (e, s) a
-&gt; arr (e, (Identity MetadataObject, s)) (Maybe a)
forall (arr :: * -&gt; * -&gt; *) mo e s a.
(ArrowChoice arr, ArrowWriter (Seq CollectItem) arr) =&gt;
(ArrowWriter (Seq CollectItem) arr =&gt;
 arr ((Maybe Value, mo), Text) ())
-&gt; ErrorA QErr arr (e, s) a -&gt; arr (e, (mo, s)) (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistenciesWith"><span class="hs-identifier hs-var">recordInconsistenciesWith</span></a></span><span> </span><span class="annot"><span class="annottext">arr ((Maybe Value, Identity MetadataObject), Text) ()
ArrowWriter (Seq CollectItem) arr =&gt;
arr ((Maybe Value, Identity MetadataObject), Text) ()
forall (arr :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(ArrowWriter (Seq CollectItem) arr, Functor f, Foldable f) =&gt;
arr ((Maybe Value, f MetadataObject), Text) ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistencies"><span class="hs-identifier hs-var">recordInconsistencies</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorA QErr arr (e, s) a
</span><a href="#local-6989586621687617666"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621687617667"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetadataObject -&gt; Identity MetadataObject
forall a. a -&gt; Identity a
</span><span class="hs-identifier hs-var">Identity</span></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687617668"><span class="hs-identifier hs-var">mo</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621687617669"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistency"><span class="hs-pragma hs-type">withRecordInconsistency</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span id="local-6989586621687616789"><span id="local-6989586621687616790"><span id="local-6989586621687616791"><span id="local-6989586621687616792"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencies"><span class="hs-identifier hs-type">withRecordInconsistencies</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ArrowChoice</span></span><span> </span><span class="annot"><a href="#local-6989586621687616789"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#ArrowWriter"><span class="hs-identifier hs-type">ArrowWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-type">CollectItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687616789"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-186"></span><span>  </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/arrows-extra-1.0.0/opt/doc/html/arrows-extra/src/Control.Arrow.Trans.html#ErrorA"><span class="hs-identifier hs-type">ErrorA</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687616789"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687616790"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621687616791"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687616792"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><a href="#local-6989586621687616789"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687616790"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621687616791"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621687616792"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-188"></span><span id="withRecordInconsistencies"><span class="annot"><span class="annottext">withRecordInconsistencies :: forall (arr :: * -&gt; * -&gt; *) e s a.
(ArrowChoice arr, ArrowWriter (Seq CollectItem) arr) =&gt;
ErrorA QErr arr (e, s) a
-&gt; arr (e, ([MetadataObject], s)) (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencies"><span class="hs-identifier hs-var hs-var">withRecordInconsistencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ArrowWriter (Seq CollectItem) arr =&gt;
 arr ((Maybe Value, [MetadataObject]), Text) ())
-&gt; ErrorA QErr arr (e, s) a
-&gt; arr (e, ([MetadataObject], s)) (Maybe a)
forall (arr :: * -&gt; * -&gt; *) mo e s a.
(ArrowChoice arr, ArrowWriter (Seq CollectItem) arr) =&gt;
(ArrowWriter (Seq CollectItem) arr =&gt;
 arr ((Maybe Value, mo), Text) ())
-&gt; ErrorA QErr arr (e, s) a -&gt; arr (e, (mo, s)) (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistenciesWith"><span class="hs-identifier hs-var">recordInconsistenciesWith</span></a></span><span> </span><span class="annot"><span class="annottext">arr ((Maybe Value, [MetadataObject]), Text) ()
ArrowWriter (Seq CollectItem) arr =&gt;
arr ((Maybe Value, [MetadataObject]), Text) ()
forall (arr :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(ArrowWriter (Seq CollectItem) arr, Functor f, Foldable f) =&gt;
arr ((Maybe Value, f MetadataObject), Text) ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistencies"><span class="hs-identifier hs-var">recordInconsistencies</span></a></span><span>
</span><span id="line-189"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencies"><span class="hs-pragma hs-type">withRecordInconsistencies</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- operations for triggering a schema cache rebuild</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#CacheRM"><span class="hs-identifier hs-type">CacheRM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687616797"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="CacheRWM"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-var">CacheRWM</span></a></span></span><span> </span><span id="local-6989586621687616797"><span class="annot"><a href="#local-6989586621687616797"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-195"></span><span>  </span><span id="tryBuildSchemaCacheWithOptions"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCacheWithOptions"><span class="hs-identifier hs-type">tryBuildSchemaCacheWithOptions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621687616807"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#BuildReason"><span class="hs-identifier hs-type">BuildReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-type">CacheInvalidations</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#Metadata"><span class="hs-identifier hs-type">Metadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#MetadataResourceVersion"><span class="hs-identifier hs-type">MetadataResourceVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#ValidateNewSchemaCache"><span class="hs-identifier hs-type">ValidateNewSchemaCache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687616807"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687616797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687616807"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-196"></span><span>  </span><span id="setMetadataResourceVersionInSchemaCache"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#setMetadataResourceVersionInSchemaCache"><span class="hs-identifier hs-type">setMetadataResourceVersionInSchemaCache</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#MetadataResourceVersion"><span class="hs-identifier hs-type">MetadataResourceVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687616797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span id="local-6989586621687616800"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCacheWithOptions"><span class="hs-identifier hs-type">buildSchemaCacheWithOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687616800"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#BuildReason"><span class="hs-identifier hs-type">BuildReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-type">CacheInvalidations</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#Metadata"><span class="hs-identifier hs-type">Metadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#MetadataResourceVersion"><span class="hs-identifier hs-type">MetadataResourceVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687616800"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-199"></span><span id="buildSchemaCacheWithOptions"><span class="annot"><span class="annottext">buildSchemaCacheWithOptions :: forall (m :: * -&gt; *).
CacheRWM m =&gt;
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCacheWithOptions"><span class="hs-identifier hs-var hs-var">buildSchemaCacheWithOptions</span></a></span></span><span> </span><span id="local-6989586621687617690"><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621687617690"><span class="hs-identifier hs-var">buildReason</span></a></span></span><span> </span><span id="local-6989586621687617691"><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687617691"><span class="hs-identifier hs-var">cacheInvalidation</span></a></span></span><span> </span><span id="local-6989586621687617692"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687617692"><span class="hs-identifier hs-var">metadata</span></a></span></span><span> </span><span id="local-6989586621687617693"><span class="annot"><span class="annottext">Maybe MetadataResourceVersion
</span><a href="#local-6989586621687617693"><span class="hs-identifier hs-var">metadataResourceVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-200"></span><span>  </span><span class="annot"><span class="annottext">BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache ()
-&gt; m ()
forall a.
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; m a
forall (m :: * -&gt; *) a.
CacheRWM m =&gt;
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; m a
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCacheWithOptions"><span class="hs-identifier hs-var">tryBuildSchemaCacheWithOptions</span></a></span><span> </span><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621687617690"><span class="hs-identifier hs-var">buildReason</span></a></span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687617691"><span class="hs-identifier hs-var">cacheInvalidation</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687617692"><span class="hs-identifier hs-var">metadata</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe MetadataResourceVersion
</span><a href="#local-6989586621687617693"><span class="hs-identifier hs-var">metadataResourceVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">SchemaCache
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidateNewSchemaCacheResult
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#KeepNewSchemaCache"><span class="hs-identifier hs-var">KeepNewSchemaCache</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="hs-keyword">data</span><span> </span><span id="BuildReason"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#BuildReason"><span class="hs-identifier hs-var">BuildReason</span></a></span></span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | The build was triggered by an update this instance made to the catalog (in the</span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-comment">-- currently-active transaction), so information in Postgres that needs to be kept in sync with</span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-comment">-- the catalog (i.e. table event triggers in @hdb_catalog@ schema) should be updated.</span><span>
</span><span id="line-206"></span><span>    </span><span id="CatalogUpdate"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogUpdate"><span class="hs-identifier hs-var">CatalogUpdate</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashSet.Internal.html#HashSet"><span class="hs-identifier hs-type">HashSet</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | The build was triggered by a notification that some other currently-running Hasura instance</span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-comment">-- updated the catalog. Since that instance already updated table event triggers in @hdb_catalog@,</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-comment">-- this build should be read-only.</span><span>
</span><span id="line-210"></span><span>    </span><span id="CatalogSync"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogSync"><span class="hs-identifier hs-var">CatalogSync</span></a></span></span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687617698"><span id="local-6989586621687617703"><span class="annot"><span class="annottext">BuildReason -&gt; BuildReason -&gt; Bool
(BuildReason -&gt; BuildReason -&gt; Bool)
-&gt; (BuildReason -&gt; BuildReason -&gt; Bool) -&gt; Eq BuildReason
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: BuildReason -&gt; BuildReason -&gt; Bool
== :: BuildReason -&gt; BuildReason -&gt; Bool
$c/= :: BuildReason -&gt; BuildReason -&gt; Bool
/= :: BuildReason -&gt; BuildReason -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687617710"><span id="local-6989586621687617716"><span id="local-6989586621687617720"><span class="annot"><span class="annottext">Int -&gt; BuildReason -&gt; ShowS
[BuildReason] -&gt; ShowS
BuildReason -&gt; String
(Int -&gt; BuildReason -&gt; ShowS)
-&gt; (BuildReason -&gt; String)
-&gt; ([BuildReason] -&gt; ShowS)
-&gt; Show BuildReason
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; BuildReason -&gt; ShowS
showsPrec :: Int -&gt; BuildReason -&gt; ShowS
$cshow :: BuildReason -&gt; String
show :: BuildReason -&gt; String
$cshowList :: [BuildReason] -&gt; ShowS
showList :: [BuildReason] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="hs-keyword">data</span><span> </span><span id="CacheInvalidations"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-var">CacheInvalidations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CacheInvalidations"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-var">CacheInvalidations</span></a></span></span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- | Force reloading of all database information, including information not technically stored in</span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-comment">-- metadata (currently just enum values). Set by the @reload_metadata@ API.</span><span>
</span><span id="line-216"></span><span>    </span><span id="ciMetadata"><span class="annot"><span class="annottext">CacheInvalidations -&gt; Bool
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#ciMetadata"><span class="hs-identifier hs-var hs-var">ciMetadata</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-comment">-- | Force refetching of the given remote schemas, even if their definition has not changed. Set</span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-comment">-- by the @reload_remote_schema@ API.</span><span>
</span><span id="line-219"></span><span>    </span><span id="ciRemoteSchemas"><span class="annot"><span class="annottext">CacheInvalidations -&gt; HashSet RemoteSchemaName
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#ciRemoteSchemas"><span class="hs-identifier hs-var hs-var">ciRemoteSchemas</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashSet.Internal.html#HashSet"><span class="hs-identifier hs-type">HashSet</span></a></span><span> </span><span class="annot"><a href="Hasura.RemoteSchema.Metadata.Base.html#RemoteSchemaName"><span class="hs-identifier hs-type">RemoteSchemaName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-comment">-- | Force re-establishing connections of the given data sources, even if their configuration has not changed. Set</span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-comment">-- by the @pg_reload_source@ API.</span><span>
</span><span id="line-222"></span><span>    </span><span id="ciSources"><span class="annot"><span class="annottext">CacheInvalidations -&gt; HashSet SourceName
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#ciSources"><span class="hs-identifier hs-var hs-var">ciSources</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashSet.Internal.html#HashSet"><span class="hs-identifier hs-type">HashSet</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-223"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Force re-fetching of `DataConnectorInfo` from the named data connectors.</span></span><span>
</span><span id="line-224"></span><span>    </span><span id="ciDataConnectors"><span class="annot"><span class="annottext">CacheInvalidations -&gt; HashSet DataConnectorName
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#ciDataConnectors"><span class="hs-identifier hs-var hs-var">ciDataConnectors</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashSet.Internal.html#HashSet"><span class="hs-identifier hs-type">HashSet</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.DataConnector.html#DataConnectorName"><span class="hs-identifier hs-type">DataConnectorName</span></a></span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687617731"><span id="local-6989586621687617733"><span class="annot"><span class="annottext">(forall x. CacheInvalidations -&gt; Rep CacheInvalidations x)
-&gt; (forall x. Rep CacheInvalidations x -&gt; CacheInvalidations)
-&gt; Generic CacheInvalidations
forall x. Rep CacheInvalidations x -&gt; CacheInvalidations
forall x. CacheInvalidations -&gt; Rep CacheInvalidations x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. CacheInvalidations -&gt; Rep CacheInvalidations x
from :: forall x. CacheInvalidations -&gt; Rep CacheInvalidations x
$cto :: forall x. Rep CacheInvalidations x -&gt; CacheInvalidations
to :: forall x. Rep CacheInvalidations x -&gt; CacheInvalidations
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687617738"><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.FromJSON.html#FromJSON"><span class="hs-identifier hs-type">FromJSON</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-type">CacheInvalidations</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-229"></span><span>  </span><span id="local-6989586621687617866"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser CacheInvalidations
</span><a href="#local-6989586621687617866"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Options -&gt; Value -&gt; Parser CacheInvalidations
forall a.
(Generic a, GFromJSON Zero (Rep a)) =&gt;
Options -&gt; Value -&gt; Parser a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.FromJSON.html#genericParseJSON"><span class="hs-identifier hs-var">genericParseJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Options
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#hasuraJSON"><span class="hs-identifier hs-var">hasuraJSON</span></a></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687617872"><span id="local-6989586621687617876"><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#ToJSON"><span class="hs-identifier hs-type">ToJSON</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-type">CacheInvalidations</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-232"></span><span>  </span><span id="local-6989586621687618003"><span class="annot"><span class="annottext">toJSON :: CacheInvalidations -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Options -&gt; CacheInvalidations -&gt; Value
forall a.
(Generic a, GToJSON' Value Zero (Rep a)) =&gt;
Options -&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#genericToJSON"><span class="hs-identifier hs-var">genericToJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Options
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#hasuraJSON"><span class="hs-identifier hs-var">hasuraJSON</span></a></span><span>
</span><span id="line-233"></span><span>  </span><span id="local-6989586621687618105"><span class="annot"><span class="annottext">toEncoding :: CacheInvalidations -&gt; Encoding
</span><a href="#local-6989586621687618105"><span class="hs-identifier hs-var hs-var hs-var hs-var">toEncoding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Options -&gt; CacheInvalidations -&gt; Encoding
forall a.
(Generic a, GToJSON' Encoding Zero (Rep a)) =&gt;
Options -&gt; a -&gt; Encoding
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#genericToEncoding"><span class="hs-identifier hs-var">genericToEncoding</span></a></span><span> </span><span class="annot"><span class="annottext">Options
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#hasuraJSON"><span class="hs-identifier hs-var">hasuraJSON</span></a></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687618109"><span id="local-6989586621687618113"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-type">CacheInvalidations</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-236"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-type">CacheInvalidations</span></a></span><span> </span><span id="local-6989586621687618128"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687618128"><span class="hs-identifier hs-var">a1</span></a></span></span><span> </span><span id="local-6989586621687618129"><span class="annot"><span class="annottext">HashSet RemoteSchemaName
</span><a href="#local-6989586621687618129"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621687618130"><span class="annot"><span class="annottext">HashSet SourceName
</span><a href="#local-6989586621687618130"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span id="local-6989586621687618131"><span class="annot"><span class="annottext">HashSet DataConnectorName
</span><a href="#local-6989586621687618131"><span class="hs-identifier hs-var">d1</span></a></span></span><span> </span><span id="local-6989586621687618132"><span class="annot"><span class="annottext">&lt;&gt; :: CacheInvalidations -&gt; CacheInvalidations -&gt; CacheInvalidations
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-type">CacheInvalidations</span></a></span><span> </span><span id="local-6989586621687618133"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687618133"><span class="hs-identifier hs-var">a2</span></a></span></span><span> </span><span id="local-6989586621687618134"><span class="annot"><span class="annottext">HashSet RemoteSchemaName
</span><a href="#local-6989586621687618134"><span class="hs-identifier hs-var">b2</span></a></span></span><span> </span><span id="local-6989586621687618135"><span class="annot"><span class="annottext">HashSet SourceName
</span><a href="#local-6989586621687618135"><span class="hs-identifier hs-var">c2</span></a></span></span><span> </span><span id="local-6989586621687618136"><span class="annot"><span class="annottext">HashSet DataConnectorName
</span><a href="#local-6989586621687618136"><span class="hs-identifier hs-var">d2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-237"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; HashSet RemoteSchemaName
-&gt; HashSet SourceName
-&gt; HashSet DataConnectorName
-&gt; CacheInvalidations
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-var">CacheInvalidations</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687618128"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687618133"><span class="hs-identifier hs-var">a2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashSet RemoteSchemaName
</span><a href="#local-6989586621687618129"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet RemoteSchemaName
-&gt; HashSet RemoteSchemaName -&gt; HashSet RemoteSchemaName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashSet RemoteSchemaName
</span><a href="#local-6989586621687618134"><span class="hs-identifier hs-var">b2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashSet SourceName
</span><a href="#local-6989586621687618130"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet SourceName -&gt; HashSet SourceName -&gt; HashSet SourceName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashSet SourceName
</span><a href="#local-6989586621687618135"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashSet DataConnectorName
</span><a href="#local-6989586621687618131"><span class="hs-identifier hs-var">d1</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet DataConnectorName
-&gt; HashSet DataConnectorName -&gt; HashSet DataConnectorName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashSet DataConnectorName
</span><a href="#local-6989586621687618136"><span class="hs-identifier hs-var">d2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687618142"><span id="local-6989586621687618146"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-type">CacheInvalidations</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-240"></span><span>  </span><span id="local-6989586621687618159"><span class="annot"><span class="annottext">mempty :: CacheInvalidations
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; HashSet RemoteSchemaName
-&gt; HashSet SourceName
-&gt; HashSet DataConnectorName
-&gt; CacheInvalidations
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-var">CacheInvalidations</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">HashSet RemoteSchemaName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">HashSet SourceName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">HashSet DataConnectorName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="hs-comment">-- | Function that validates the new schema cache (usually involves checking for any metadata inconsistencies)</span><span>
</span><span id="line-243"></span><span class="hs-comment">-- and can decide whether or not to keep or discard the new schema cache ('ValidateNewSchemaCacheResult'). It</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- can also return some arbitrary extra information that will be returned from 'tryBuildSchemaCacheWithOptions'.</span><span>
</span><span id="line-245"></span><span class="hs-comment">--</span><span>
</span><span id="line-246"></span><span class="hs-comment">-- First parameter is the old schema cache, the second is the new schema cache.</span><span>
</span><span id="line-247"></span><span class="hs-keyword">type</span><span> </span><span id="ValidateNewSchemaCache"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#ValidateNewSchemaCache"><span class="hs-identifier hs-var">ValidateNewSchemaCache</span></a></span></span><span> </span><span id="local-6989586621687618160"><span class="annot"><a href="#local-6989586621687618160"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#SchemaCache"><span class="hs-identifier hs-type">SchemaCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#SchemaCache"><span class="hs-identifier hs-type">SchemaCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#ValidateNewSchemaCacheResult"><span class="hs-identifier hs-type">ValidateNewSchemaCacheResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621687618160"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span class="hs-keyword">data</span><span> </span><span id="ValidateNewSchemaCacheResult"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#ValidateNewSchemaCacheResult"><span class="hs-identifier hs-var">ValidateNewSchemaCacheResult</span></a></span></span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="KeepNewSchemaCache"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#KeepNewSchemaCache"><span class="hs-identifier hs-var">KeepNewSchemaCache</span></a></span></span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="DiscardNewSchemaCache"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#DiscardNewSchemaCache"><span class="hs-identifier hs-var">DiscardNewSchemaCache</span></a></span></span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687618163"><span id="local-6989586621687618165"><span class="annot"><span class="annottext">ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; Bool
(ValidateNewSchemaCacheResult
 -&gt; ValidateNewSchemaCacheResult -&gt; Bool)
-&gt; (ValidateNewSchemaCacheResult
    -&gt; ValidateNewSchemaCacheResult -&gt; Bool)
-&gt; Eq ValidateNewSchemaCacheResult
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; Bool
== :: ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; Bool
$c/= :: ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; Bool
/= :: ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687618169"><span id="local-6989586621687618171"><span id="local-6989586621687618175"><span class="annot"><span class="annottext">Int -&gt; ValidateNewSchemaCacheResult -&gt; ShowS
[ValidateNewSchemaCacheResult] -&gt; ShowS
ValidateNewSchemaCacheResult -&gt; String
(Int -&gt; ValidateNewSchemaCacheResult -&gt; ShowS)
-&gt; (ValidateNewSchemaCacheResult -&gt; String)
-&gt; ([ValidateNewSchemaCacheResult] -&gt; ShowS)
-&gt; Show ValidateNewSchemaCacheResult
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; ValidateNewSchemaCacheResult -&gt; ShowS
showsPrec :: Int -&gt; ValidateNewSchemaCacheResult -&gt; ShowS
$cshow :: ValidateNewSchemaCacheResult -&gt; String
show :: ValidateNewSchemaCacheResult -&gt; String
$cshowList :: [ValidateNewSchemaCacheResult] -&gt; ShowS
showList :: [ValidateNewSchemaCacheResult] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687618180"><span id="local-6989586621687618182"><span id="local-6989586621687618184"><span id="local-6989586621687618188"><span id="local-6989586621687618191"><span id="local-6989586621687618194"><span id="local-6989586621687618197"><span class="annot"><span class="annottext">Eq ValidateNewSchemaCacheResult
Eq ValidateNewSchemaCacheResult
-&gt; (ValidateNewSchemaCacheResult
    -&gt; ValidateNewSchemaCacheResult -&gt; Ordering)
-&gt; (ValidateNewSchemaCacheResult
    -&gt; ValidateNewSchemaCacheResult -&gt; Bool)
-&gt; (ValidateNewSchemaCacheResult
    -&gt; ValidateNewSchemaCacheResult -&gt; Bool)
-&gt; (ValidateNewSchemaCacheResult
    -&gt; ValidateNewSchemaCacheResult -&gt; Bool)
-&gt; (ValidateNewSchemaCacheResult
    -&gt; ValidateNewSchemaCacheResult -&gt; Bool)
-&gt; (ValidateNewSchemaCacheResult
    -&gt; ValidateNewSchemaCacheResult -&gt; ValidateNewSchemaCacheResult)
-&gt; (ValidateNewSchemaCacheResult
    -&gt; ValidateNewSchemaCacheResult -&gt; ValidateNewSchemaCacheResult)
-&gt; Ord ValidateNewSchemaCacheResult
ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; Bool
ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; Ordering
ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; ValidateNewSchemaCacheResult
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; Ordering
compare :: ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; Ordering
$c&lt; :: ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; Bool
&lt; :: ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; Bool
$c&lt;= :: ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; Bool
&lt;= :: ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; Bool
$c&gt; :: ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; Bool
&gt; :: ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; Bool
$c&gt;= :: ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; Bool
&gt;= :: ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; Bool
$cmax :: ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; ValidateNewSchemaCacheResult
max :: ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; ValidateNewSchemaCacheResult
$cmin :: ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; ValidateNewSchemaCacheResult
min :: ValidateNewSchemaCacheResult
-&gt; ValidateNewSchemaCacheResult -&gt; ValidateNewSchemaCacheResult
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687617050"><span id="local-6989586621687617051"><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617050"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621687617051"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617050"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-255"></span><span>  </span><span id="local-6989586621687618215"><span class="annot"><span class="annottext">tryBuildSchemaCacheWithOptions :: forall a.
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; ReaderT r m a
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCacheWithOptions"><span class="hs-identifier hs-var hs-var hs-var hs-var">tryBuildSchemaCacheWithOptions</span></a></span></span><span> </span><span id="local-6989586621687618216"><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621687618216"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621687618217"><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687618217"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621687618218"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687618218"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621687618219"><span class="annot"><span class="annottext">Maybe MetadataResourceVersion
</span><a href="#local-6989586621687618219"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621687618220"><span class="annot"><span class="annottext">ValidateNewSchemaCache a
</span><a href="#local-6989586621687618220"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; ReaderT r m a
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT r m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; ReaderT r m a) -&gt; m a -&gt; ReaderT r m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; m a
forall a.
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; m a
forall (m :: * -&gt; *) a.
CacheRWM m =&gt;
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; m a
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCacheWithOptions"><span class="hs-identifier hs-var">tryBuildSchemaCacheWithOptions</span></a></span><span> </span><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621687618216"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687618217"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687618218"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe MetadataResourceVersion
</span><a href="#local-6989586621687618219"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ValidateNewSchemaCache a
</span><a href="#local-6989586621687618220"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-256"></span><span>  </span><span id="local-6989586621687618225"><span class="annot"><span class="annottext">setMetadataResourceVersionInSchemaCache :: MetadataResourceVersion -&gt; ReaderT r m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#setMetadataResourceVersionInSchemaCache"><span class="hs-identifier hs-var hs-var hs-var hs-var">setMetadataResourceVersionInSchemaCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m () -&gt; ReaderT r m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT r m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ReaderT r m ())
-&gt; (MetadataResourceVersion -&gt; m ())
-&gt; MetadataResourceVersion
-&gt; ReaderT r m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion -&gt; m ()
forall (m :: * -&gt; *). CacheRWM m =&gt; MetadataResourceVersion -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#setMetadataResourceVersionInSchemaCache"><span class="hs-identifier hs-var">setMetadataResourceVersionInSchemaCache</span></a></span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687617063"><span id="local-6989586621687617064"><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617063"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="#local-6989586621687617064"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617063"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-259"></span><span>  </span><span id="local-6989586621687618239"><span class="annot"><span class="annottext">tryBuildSchemaCacheWithOptions :: forall a.
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; StateT s m a
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCacheWithOptions"><span class="hs-identifier hs-var hs-var hs-var hs-var">tryBuildSchemaCacheWithOptions</span></a></span></span><span> </span><span id="local-6989586621687618240"><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621687618240"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621687618241"><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687618241"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621687618242"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687618242"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621687618243"><span class="annot"><span class="annottext">Maybe MetadataResourceVersion
</span><a href="#local-6989586621687618243"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621687618244"><span class="annot"><span class="annottext">ValidateNewSchemaCache a
</span><a href="#local-6989586621687618244"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; StateT s m a
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT s m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; StateT s m a) -&gt; m a -&gt; StateT s m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; m a
forall a.
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; m a
forall (m :: * -&gt; *) a.
CacheRWM m =&gt;
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; m a
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCacheWithOptions"><span class="hs-identifier hs-var">tryBuildSchemaCacheWithOptions</span></a></span><span> </span><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621687618240"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687618241"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687618242"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe MetadataResourceVersion
</span><a href="#local-6989586621687618243"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ValidateNewSchemaCache a
</span><a href="#local-6989586621687618244"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-260"></span><span>  </span><span id="local-6989586621687618248"><span class="annot"><span class="annottext">setMetadataResourceVersionInSchemaCache :: MetadataResourceVersion -&gt; StateT s m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#setMetadataResourceVersionInSchemaCache"><span class="hs-identifier hs-var hs-var hs-var hs-var">setMetadataResourceVersionInSchemaCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m () -&gt; StateT s m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT s m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; StateT s m ())
-&gt; (MetadataResourceVersion -&gt; m ())
-&gt; MetadataResourceVersion
-&gt; StateT s m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion -&gt; m ()
forall (m :: * -&gt; *). CacheRWM m =&gt; MetadataResourceVersion -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#setMetadataResourceVersionInSchemaCache"><span class="hs-identifier hs-var">setMetadataResourceVersionInSchemaCache</span></a></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687617070"><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617070"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.Monad.html#TraceT"><span class="hs-identifier hs-type">TraceT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617070"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-263"></span><span>  </span><span id="local-6989586621687618262"><span class="annot"><span class="annottext">tryBuildSchemaCacheWithOptions :: forall a.
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; TraceT m a
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCacheWithOptions"><span class="hs-identifier hs-var hs-var hs-var hs-var">tryBuildSchemaCacheWithOptions</span></a></span></span><span> </span><span id="local-6989586621687618263"><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621687618263"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621687618264"><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687618264"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621687618265"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687618265"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621687618266"><span class="annot"><span class="annottext">Maybe MetadataResourceVersion
</span><a href="#local-6989586621687618266"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621687618267"><span class="annot"><span class="annottext">ValidateNewSchemaCache a
</span><a href="#local-6989586621687618267"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; TraceT m a
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; TraceT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; TraceT m a) -&gt; m a -&gt; TraceT m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; m a
forall a.
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; m a
forall (m :: * -&gt; *) a.
CacheRWM m =&gt;
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; m a
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCacheWithOptions"><span class="hs-identifier hs-var">tryBuildSchemaCacheWithOptions</span></a></span><span> </span><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621687618263"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687618264"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687618265"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe MetadataResourceVersion
</span><a href="#local-6989586621687618266"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ValidateNewSchemaCache a
</span><a href="#local-6989586621687618267"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-264"></span><span>  </span><span id="local-6989586621687618271"><span class="annot"><span class="annottext">setMetadataResourceVersionInSchemaCache :: MetadataResourceVersion -&gt; TraceT m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#setMetadataResourceVersionInSchemaCache"><span class="hs-identifier hs-var hs-var hs-var hs-var">setMetadataResourceVersionInSchemaCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m () -&gt; TraceT m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; TraceT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; TraceT m ())
-&gt; (MetadataResourceVersion -&gt; m ())
-&gt; MetadataResourceVersion
-&gt; TraceT m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion -&gt; m ()
forall (m :: * -&gt; *). CacheRWM m =&gt; MetadataResourceVersion -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#setMetadataResourceVersionInSchemaCache"><span class="hs-identifier hs-var">setMetadataResourceVersionInSchemaCache</span></a></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687617075"><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617075"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#TxET"><span class="hs-identifier hs-type">PG.TxET</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617075"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-267"></span><span>  </span><span id="local-6989586621687618285"><span class="annot"><span class="annottext">tryBuildSchemaCacheWithOptions :: forall a.
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; TxET QErr m a
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCacheWithOptions"><span class="hs-identifier hs-var hs-var hs-var hs-var">tryBuildSchemaCacheWithOptions</span></a></span></span><span> </span><span id="local-6989586621687618286"><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621687618286"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621687618287"><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687618287"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621687618288"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687618288"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621687618289"><span class="annot"><span class="annottext">Maybe MetadataResourceVersion
</span><a href="#local-6989586621687618289"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621687618290"><span class="annot"><span class="annottext">ValidateNewSchemaCache a
</span><a href="#local-6989586621687618290"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; TxET QErr m a
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; TxET QErr m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; TxET QErr m a) -&gt; m a -&gt; TxET QErr m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; m a
forall a.
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; m a
forall (m :: * -&gt; *) a.
CacheRWM m =&gt;
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; m a
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCacheWithOptions"><span class="hs-identifier hs-var">tryBuildSchemaCacheWithOptions</span></a></span><span> </span><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621687618286"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687618287"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687618288"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe MetadataResourceVersion
</span><a href="#local-6989586621687618289"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ValidateNewSchemaCache a
</span><a href="#local-6989586621687618290"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-268"></span><span>  </span><span id="local-6989586621687618294"><span class="annot"><span class="annottext">setMetadataResourceVersionInSchemaCache :: MetadataResourceVersion -&gt; TxET QErr m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#setMetadataResourceVersionInSchemaCache"><span class="hs-identifier hs-var hs-var hs-var hs-var">setMetadataResourceVersionInSchemaCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m () -&gt; TxET QErr m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; TxET QErr m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; TxET QErr m ())
-&gt; (MetadataResourceVersion -&gt; m ())
-&gt; MetadataResourceVersion
-&gt; TxET QErr m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion -&gt; m ()
forall (m :: * -&gt; *). CacheRWM m =&gt; MetadataResourceVersion -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#setMetadataResourceVersionInSchemaCache"><span class="hs-identifier hs-var">setMetadataResourceVersionInSchemaCache</span></a></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="hs-keyword">newtype</span><span> </span><span id="MetadataT"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataT"><span class="hs-identifier hs-var">MetadataT</span></a></span></span><span> </span><span id="local-6989586621687617078"><span class="annot"><a href="#local-6989586621687617078"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621687617079"><span class="annot"><a href="#local-6989586621687617079"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MetadataT"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataT"><span class="hs-identifier hs-var">MetadataT</span></a></span></span><span> </span><span class="hs-special">{</span><span id="unMetadataT"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MetadataT m a -&gt; StateT Metadata m a
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#unMetadataT"><span class="hs-identifier hs-var hs-var">unMetadataT</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#Metadata"><span class="hs-identifier hs-type">Metadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617078"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617079"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-special">(</span><span> </span><span id="local-6989586621687618299"><span id="local-6989586621687618304"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; MetadataT m a -&gt; MetadataT m b)
-&gt; (forall a b. a -&gt; MetadataT m b -&gt; MetadataT m a)
-&gt; Functor (MetadataT m)
forall a b. a -&gt; MetadataT m b -&gt; MetadataT m a
forall a b. (a -&gt; b) -&gt; MetadataT m a -&gt; MetadataT m b
forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; MetadataT m b -&gt; MetadataT m a
forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; MetadataT m a -&gt; MetadataT m b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; MetadataT m a -&gt; MetadataT m b
fmap :: forall a b. (a -&gt; b) -&gt; MetadataT m a -&gt; MetadataT m b
$c&lt;$ :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; MetadataT m b -&gt; MetadataT m a
&lt;$ :: forall a b. a -&gt; MetadataT m b -&gt; MetadataT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-273"></span><span>      </span><span id="local-6989586621687618314"><span id="local-6989586621687618319"><span id="local-6989586621687618323"><span id="local-6989586621687618327"><span id="local-6989586621687618331"><span class="annot"><span class="annottext">Functor (MetadataT m)
Functor (MetadataT m)
-&gt; (forall a. a -&gt; MetadataT m a)
-&gt; (forall a b.
    MetadataT m (a -&gt; b) -&gt; MetadataT m a -&gt; MetadataT m b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c) -&gt; MetadataT m a -&gt; MetadataT m b -&gt; MetadataT m c)
-&gt; (forall a b. MetadataT m a -&gt; MetadataT m b -&gt; MetadataT m b)
-&gt; (forall a b. MetadataT m a -&gt; MetadataT m b -&gt; MetadataT m a)
-&gt; Applicative (MetadataT m)
forall a. a -&gt; MetadataT m a
forall a b. MetadataT m a -&gt; MetadataT m b -&gt; MetadataT m a
forall a b. MetadataT m a -&gt; MetadataT m b -&gt; MetadataT m b
forall a b. MetadataT m (a -&gt; b) -&gt; MetadataT m a -&gt; MetadataT m b
forall a b c.
(a -&gt; b -&gt; c) -&gt; MetadataT m a -&gt; MetadataT m b -&gt; MetadataT m c
forall {m :: * -&gt; *}. Monad m =&gt; Functor (MetadataT m)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; MetadataT m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
MetadataT m a -&gt; MetadataT m b -&gt; MetadataT m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
MetadataT m a -&gt; MetadataT m b -&gt; MetadataT m b
forall (m :: * -&gt; *) a b.
Monad m =&gt;
MetadataT m (a -&gt; b) -&gt; MetadataT m a -&gt; MetadataT m b
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; b -&gt; c) -&gt; MetadataT m a -&gt; MetadataT m b -&gt; MetadataT m c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
$cpure :: forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; MetadataT m a
pure :: forall a. a -&gt; MetadataT m a
$c&lt;*&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
MetadataT m (a -&gt; b) -&gt; MetadataT m a -&gt; MetadataT m b
&lt;*&gt; :: forall a b. MetadataT m (a -&gt; b) -&gt; MetadataT m a -&gt; MetadataT m b
$cliftA2 :: forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; b -&gt; c) -&gt; MetadataT m a -&gt; MetadataT m b -&gt; MetadataT m c
liftA2 :: forall a b c.
(a -&gt; b -&gt; c) -&gt; MetadataT m a -&gt; MetadataT m b -&gt; MetadataT m c
$c*&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
MetadataT m a -&gt; MetadataT m b -&gt; MetadataT m b
*&gt; :: forall a b. MetadataT m a -&gt; MetadataT m b -&gt; MetadataT m b
$c&lt;* :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
MetadataT m a -&gt; MetadataT m b -&gt; MetadataT m a
&lt;* :: forall a b. MetadataT m a -&gt; MetadataT m b -&gt; MetadataT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-274"></span><span>      </span><span id="local-6989586621687618343"><span id="local-6989586621687618348"><span id="local-6989586621687618352"><span class="annot"><span class="annottext">Applicative (MetadataT m)
Applicative (MetadataT m)
-&gt; (forall a b.
    MetadataT m a -&gt; (a -&gt; MetadataT m b) -&gt; MetadataT m b)
-&gt; (forall a b. MetadataT m a -&gt; MetadataT m b -&gt; MetadataT m b)
-&gt; (forall a. a -&gt; MetadataT m a)
-&gt; Monad (MetadataT m)
forall a. a -&gt; MetadataT m a
forall a b. MetadataT m a -&gt; MetadataT m b -&gt; MetadataT m b
forall a b. MetadataT m a -&gt; (a -&gt; MetadataT m b) -&gt; MetadataT m b
forall (m :: * -&gt; *). Monad m =&gt; Applicative (MetadataT m)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; MetadataT m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
MetadataT m a -&gt; MetadataT m b -&gt; MetadataT m b
forall (m :: * -&gt; *) a b.
Monad m =&gt;
MetadataT m a -&gt; (a -&gt; MetadataT m b) -&gt; MetadataT m b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
$c&gt;&gt;= :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
MetadataT m a -&gt; (a -&gt; MetadataT m b) -&gt; MetadataT m b
&gt;&gt;= :: forall a b. MetadataT m a -&gt; (a -&gt; MetadataT m b) -&gt; MetadataT m b
$c&gt;&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
MetadataT m a -&gt; MetadataT m b -&gt; MetadataT m b
&gt;&gt; :: forall a b. MetadataT m a -&gt; MetadataT m b -&gt; MetadataT m b
$creturn :: forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; MetadataT m a
return :: forall a. a -&gt; MetadataT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-275"></span><span>      </span><span id="local-6989586621687618360"><span class="annot"><span class="annottext">(forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MetadataT m a)
-&gt; MonadTrans MetadataT
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MetadataT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *).
(forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; t m a) -&gt; MonadTrans t
$clift :: forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MetadataT m a
lift :: forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MetadataT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">MonadTrans</span></span></span><span class="hs-special">,</span><span>
</span><span id="line-276"></span><span>      </span><span id="local-6989586621687618372"><span class="annot"><span class="annottext">Monad (MetadataT m)
Monad (MetadataT m)
-&gt; (forall a. IO a -&gt; MetadataT m a) -&gt; MonadIO (MetadataT m)
forall a. IO a -&gt; MetadataT m a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. IO a -&gt; m a) -&gt; MonadIO m
forall {m :: * -&gt; *}. MonadIO m =&gt; Monad (MetadataT m)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; MetadataT m a
$cliftIO :: forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; MetadataT m a
liftIO :: forall a. IO a -&gt; MetadataT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></span></span><span class="hs-special">,</span><span>
</span><span id="line-277"></span><span>      </span><span id="local-6989586621687618379"><span id="local-6989586621687618385"><span id="local-6989586621687618390"><span id="local-6989586621687618394"><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621687618379"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-278"></span><span>      </span><span id="local-6989586621687618400"><span id="local-6989586621687618406"><span id="local-6989586621687618411"><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="#local-6989586621687618400"><span class="hs-identifier hs-type">e</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-279"></span><span>      </span><span id="local-6989586621687618422"><span class="annot"><span class="annottext">MonadError QErr (MetadataT m)
MonadError QErr (MetadataT m)
-&gt; (forall a. TxE QErr a -&gt; MetadataT m a) -&gt; MonadTx (MetadataT m)
forall a. TxE QErr a -&gt; MetadataT m a
forall (m :: * -&gt; *).
MonadError QErr m -&gt; (forall a. TxE QErr a -&gt; m a) -&gt; MonadTx m
forall {m :: * -&gt; *}. MonadTx m =&gt; MonadError QErr (MetadataT m)
forall (m :: * -&gt; *) a. MonadTx m =&gt; TxE QErr a -&gt; MetadataT m a
$cliftTx :: forall (m :: * -&gt; *) a. MonadTx m =&gt; TxE QErr a -&gt; MetadataT m a
liftTx :: forall a. TxE QErr a -&gt; MetadataT m a
</span><a href="Hasura.Backends.Postgres.Connection.MonadTx.html#MonadTx"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadTx</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-280"></span><span>      </span><span id="local-6989586621687618429"><span id="local-6989586621687618435"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#TableCoreInfoRM"><span class="hs-identifier hs-type">TableCoreInfoRM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687618429"><span class="hs-identifier hs-type">b</span></a></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-281"></span><span>      </span><span id="local-6989586621687618447"><span class="annot"><span class="annottext">Monad (MetadataT m)
MetadataT m SchemaCache
Monad (MetadataT m)
-&gt; MetadataT m SchemaCache -&gt; CacheRM (MetadataT m)
forall (m :: * -&gt; *). Monad m -&gt; m SchemaCache -&gt; CacheRM m
forall {m :: * -&gt; *}. CacheRM m =&gt; Monad (MetadataT m)
forall (m :: * -&gt; *). CacheRM m =&gt; MetadataT m SchemaCache
$caskSchemaCache :: forall (m :: * -&gt; *). CacheRM m =&gt; MetadataT m SchemaCache
askSchemaCache :: MetadataT m SchemaCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#CacheRM"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">CacheRM</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-282"></span><span>      </span><span id="local-6989586621687618457"><span id="local-6989586621687618461"><span class="annot"><span class="annottext">CacheRM (MetadataT m)
CacheRM (MetadataT m)
-&gt; (forall a.
    BuildReason
    -&gt; CacheInvalidations
    -&gt; Metadata
    -&gt; Maybe MetadataResourceVersion
    -&gt; ValidateNewSchemaCache a
    -&gt; MetadataT m a)
-&gt; (MetadataResourceVersion -&gt; MetadataT m ())
-&gt; CacheRWM (MetadataT m)
MetadataResourceVersion -&gt; MetadataT m ()
forall a.
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; MetadataT m a
forall (m :: * -&gt; *).
CacheRM m
-&gt; (forall a.
    BuildReason
    -&gt; CacheInvalidations
    -&gt; Metadata
    -&gt; Maybe MetadataResourceVersion
    -&gt; ValidateNewSchemaCache a
    -&gt; m a)
-&gt; (MetadataResourceVersion -&gt; m ())
-&gt; CacheRWM m
forall {m :: * -&gt; *}. CacheRWM m =&gt; CacheRM (MetadataT m)
forall (m :: * -&gt; *).
CacheRWM m =&gt;
MetadataResourceVersion -&gt; MetadataT m ()
forall (m :: * -&gt; *) a.
CacheRWM m =&gt;
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; MetadataT m a
$ctryBuildSchemaCacheWithOptions :: forall (m :: * -&gt; *) a.
CacheRWM m =&gt;
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; MetadataT m a
tryBuildSchemaCacheWithOptions :: forall a.
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; MetadataT m a
$csetMetadataResourceVersionInSchemaCache :: forall (m :: * -&gt; *).
CacheRWM m =&gt;
MetadataResourceVersion -&gt; MetadataT m ()
setMetadataResourceVersionInSchemaCache :: MetadataResourceVersion -&gt; MetadataT m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var">CacheRWM</span></a></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-283"></span><span>      </span><span id="local-6989586621687618468"><span class="annot"><span class="annottext">(forall (m :: * -&gt; *) (n :: * -&gt; *) b.
 Monad m =&gt;
 (forall a. m a -&gt; n a) -&gt; MetadataT m b -&gt; MetadataT n b)
-&gt; MFunctor MetadataT
forall {k} (t :: (* -&gt; *) -&gt; k -&gt; *).
(forall (m :: * -&gt; *) (n :: * -&gt; *) (b :: k).
 Monad m =&gt;
 (forall a. m a -&gt; n a) -&gt; t m b -&gt; t n b)
-&gt; MFunctor t
forall (m :: * -&gt; *) (n :: * -&gt; *) b.
Monad m =&gt;
(forall a. m a -&gt; n a) -&gt; MetadataT m b -&gt; MetadataT n b
$choist :: forall (m :: * -&gt; *) (n :: * -&gt; *) b.
Monad m =&gt;
(forall a. m a -&gt; n a) -&gt; MetadataT m b -&gt; MetadataT n b
hoist :: forall (m :: * -&gt; *) (n :: * -&gt; *) b.
Monad m =&gt;
(forall a. m a -&gt; n a) -&gt; MetadataT m b -&gt; MetadataT n b
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/mmorph-1.2.0-b97db20fdd237afaed65fccc5829c422d35937fead9df9f9f77000a8c06eab8e/share/doc/html/src/Control.Monad.Morph.html#MFunctor"><span class="hs-identifier hs-var hs-var hs-var hs-var">MFunctor</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-284"></span><span>      </span><span id="local-6989586621687618481"><span class="annot"><span class="annottext">Monad (MetadataT m)
MetadataT m (Maybe TraceContext)
Monad (MetadataT m)
-&gt; MetadataT m (Maybe TraceContext)
-&gt; MonadTraceContext (MetadataT m)
forall (m :: * -&gt; *).
Monad m -&gt; m (Maybe TraceContext) -&gt; MonadTraceContext m
forall {m :: * -&gt; *}. MonadTraceContext m =&gt; Monad (MetadataT m)
forall (m :: * -&gt; *).
MonadTraceContext m =&gt;
MetadataT m (Maybe TraceContext)
$ccurrentContext :: forall (m :: * -&gt; *).
MonadTraceContext m =&gt;
MetadataT m (Maybe TraceContext)
currentContext :: MetadataT m (Maybe TraceContext)
</span><a href="Hasura.Tracing.Class.html#MonadTraceContext"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">Tracing.MonadTraceContext</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-285"></span><span>      </span><span id="local-6989586621687618493"><span id="local-6989586621687618498"><span id="local-6989586621687618502"><span class="annot"><span class="annottext">MonadTraceContext (MetadataT m)
TraceMetadata -&gt; MetadataT m ()
MonadTraceContext (MetadataT m)
-&gt; (forall a.
    TraceContext
    -&gt; SamplingPolicy -&gt; Text -&gt; MetadataT m a -&gt; MetadataT m a)
-&gt; (forall a. SpanId -&gt; Text -&gt; MetadataT m a -&gt; MetadataT m a)
-&gt; (TraceMetadata -&gt; MetadataT m ())
-&gt; MonadTrace (MetadataT m)
forall a. SpanId -&gt; Text -&gt; MetadataT m a -&gt; MetadataT m a
forall a.
TraceContext
-&gt; SamplingPolicy -&gt; Text -&gt; MetadataT m a -&gt; MetadataT m a
forall (m :: * -&gt; *).
MonadTraceContext m
-&gt; (forall a. TraceContext -&gt; SamplingPolicy -&gt; Text -&gt; m a -&gt; m a)
-&gt; (forall a. SpanId -&gt; Text -&gt; m a -&gt; m a)
-&gt; (TraceMetadata -&gt; m ())
-&gt; MonadTrace m
forall {m :: * -&gt; *}.
MonadTrace m =&gt;
MonadTraceContext (MetadataT m)
forall (m :: * -&gt; *).
MonadTrace m =&gt;
TraceMetadata -&gt; MetadataT m ()
forall (m :: * -&gt; *) a.
MonadTrace m =&gt;
SpanId -&gt; Text -&gt; MetadataT m a -&gt; MetadataT m a
forall (m :: * -&gt; *) a.
MonadTrace m =&gt;
TraceContext
-&gt; SamplingPolicy -&gt; Text -&gt; MetadataT m a -&gt; MetadataT m a
$cnewTraceWith :: forall (m :: * -&gt; *) a.
MonadTrace m =&gt;
TraceContext
-&gt; SamplingPolicy -&gt; Text -&gt; MetadataT m a -&gt; MetadataT m a
newTraceWith :: forall a.
TraceContext
-&gt; SamplingPolicy -&gt; Text -&gt; MetadataT m a -&gt; MetadataT m a
$cnewSpanWith :: forall (m :: * -&gt; *) a.
MonadTrace m =&gt;
SpanId -&gt; Text -&gt; MetadataT m a -&gt; MetadataT m a
newSpanWith :: forall a. SpanId -&gt; Text -&gt; MetadataT m a -&gt; MetadataT m a
$cattachMetadata :: forall (m :: * -&gt; *).
MonadTrace m =&gt;
TraceMetadata -&gt; MetadataT m ()
attachMetadata :: TraceMetadata -&gt; MetadataT m ()
</span><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Tracing.MonadTrace</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-286"></span><span>      </span><span id="local-6989586621687618508"><span id="local-6989586621687618522"><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/transformers-base-0.4.6-bfccd6e5febd14b0c80b8671d40d0a3d2cf51c261490e5db29874602833b847c/share/doc/html/src/Control.Monad.Base.html#MonadBase"><span class="hs-identifier hs-type">MonadBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687618508"><span class="hs-identifier hs-type">b</span></a></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-287"></span><span>      </span><span id="local-6989586621687618531"><span id="local-6989586621687618537"><span id="local-6989586621687618543"><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-db4229aec3d9c1011503cf06798714c732b74d731fab23998dd34d578ed6d457/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687618531"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-288"></span><span>      </span><span id="local-6989586621687618555"><span class="annot"><span class="annottext">Monad (MetadataT m)
MetadataT m Manager
Monad (MetadataT m)
-&gt; MetadataT m Manager -&gt; ProvidesNetwork (MetadataT m)
forall (m :: * -&gt; *). Monad m -&gt; m Manager -&gt; ProvidesNetwork m
forall {m :: * -&gt; *}. ProvidesNetwork m =&gt; Monad (MetadataT m)
forall (m :: * -&gt; *). ProvidesNetwork m =&gt; MetadataT m Manager
$caskHTTPManager :: forall (m :: * -&gt; *). ProvidesNetwork m =&gt; MetadataT m Manager
askHTTPManager :: MetadataT m Manager
</span><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">ProvidesNetwork</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-289"></span><span>      </span><span id="local-6989586621687618567"><span class="annot"><span class="annottext">Monad (MetadataT m)
Monad (MetadataT m)
-&gt; (FeatureFlag -&gt; MetadataT m Bool)
-&gt; HasFeatureFlagChecker (MetadataT m)
FeatureFlag -&gt; MetadataT m Bool
forall (m :: * -&gt; *).
Monad m -&gt; (FeatureFlag -&gt; m Bool) -&gt; HasFeatureFlagChecker m
forall {m :: * -&gt; *}.
HasFeatureFlagChecker m =&gt;
Monad (MetadataT m)
forall (m :: * -&gt; *).
HasFeatureFlagChecker m =&gt;
FeatureFlag -&gt; MetadataT m Bool
$ccheckFlag :: forall (m :: * -&gt; *).
HasFeatureFlagChecker m =&gt;
FeatureFlag -&gt; MetadataT m Bool
checkFlag :: FeatureFlag -&gt; MetadataT m Bool
</span><a href="Hasura.Server.Init.FeatureFlag.html#HasFeatureFlagChecker"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">HasFeatureFlagChecker</span></a></span></span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687618579"><span class="annot"><span class="annottext">Monad (MetadataT m)
Monad (MetadataT m)
-&gt; (QueryTagsAttributes
    -&gt; Maybe QueryTagsConfig -&gt; Tagged (MetadataT m) QueryTagsComment)
-&gt; MonadQueryTags (MetadataT m)
QueryTagsAttributes
-&gt; Maybe QueryTagsConfig -&gt; Tagged (MetadataT m) QueryTagsComment
forall (m :: * -&gt; *).
Monad m
-&gt; (QueryTagsAttributes
    -&gt; Maybe QueryTagsConfig -&gt; Tagged m QueryTagsComment)
-&gt; MonadQueryTags m
forall {m :: * -&gt; *}. MonadQueryTags m =&gt; Monad (MetadataT m)
forall (m :: * -&gt; *).
MonadQueryTags m =&gt;
QueryTagsAttributes
-&gt; Maybe QueryTagsConfig -&gt; Tagged (MetadataT m) QueryTagsComment
$ccreateQueryTags :: forall (m :: * -&gt; *).
MonadQueryTags m =&gt;
QueryTagsAttributes
-&gt; Maybe QueryTagsConfig -&gt; Tagged (MetadataT m) QueryTagsComment
createQueryTags :: QueryTagsAttributes
-&gt; Maybe QueryTagsConfig -&gt; Tagged (MetadataT m) QueryTagsComment
</span><a href="Hasura.QueryTags.html#MonadQueryTags"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadQueryTags</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687617282"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621687617282"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataT"><span class="hs-identifier hs-type">MetadataT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617282"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-294"></span><span>  </span><span id="local-6989586621687618595"><span class="annot"><span class="annottext">getMetadata :: MetadataT m Metadata
</span><a href="#local-6989586621687618595"><span class="hs-identifier hs-var hs-var hs-var hs-var">getMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT Metadata m Metadata -&gt; MetadataT m Metadata
forall (m :: * -&gt; *) a. StateT Metadata m a -&gt; MetadataT m a
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataT"><span class="hs-identifier hs-var">MetadataT</span></a></span><span> </span><span class="annot"><span class="annottext">StateT Metadata m Metadata
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-295"></span><span>  </span><span id="local-6989586621687618599"><span class="annot"><span class="annottext">putMetadata :: Metadata -&gt; MetadataT m ()
</span><a href="#local-6989586621687618599"><span class="hs-identifier hs-var hs-var hs-var hs-var">putMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT Metadata m () -&gt; MetadataT m ()
forall (m :: * -&gt; *) a. StateT Metadata m a -&gt; MetadataT m a
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataT"><span class="hs-identifier hs-var">MetadataT</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT Metadata m () -&gt; MetadataT m ())
-&gt; (Metadata -&gt; StateT Metadata m ()) -&gt; Metadata -&gt; MetadataT m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; StateT Metadata m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687617292"><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Session.html#UserInfoM"><span class="hs-identifier hs-type">UserInfoM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617292"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Session.html#UserInfoM"><span class="hs-identifier hs-type">UserInfoM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataT"><span class="hs-identifier hs-type">MetadataT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617292"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-298"></span><span>  </span><span id="local-6989586621687618613"><span class="annot"><span class="annottext">askUserInfo :: MetadataT m UserInfo
</span><a href="#local-6989586621687618613"><span class="hs-identifier hs-var hs-var hs-var hs-var">askUserInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m UserInfo -&gt; MetadataT m UserInfo
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MetadataT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m UserInfo
forall (m :: * -&gt; *). UserInfoM m =&gt; m UserInfo
</span><a href="Hasura.RQL.Types.Session.html#askUserInfo"><span class="hs-identifier hs-var">askUserInfo</span></a></span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687617298"><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier hs-type">MonadGetPolicies</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617298"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier hs-type">MonadGetPolicies</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataT"><span class="hs-identifier hs-type">MetadataT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617298"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-301"></span><span>  </span><span id="local-6989586621687618627"><span class="annot"><span class="annottext">runGetApiTimeLimit :: MetadataT m (Maybe MaxTime)
</span><a href="#local-6989586621687618627"><span class="hs-identifier hs-var hs-var hs-var hs-var">runGetApiTimeLimit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Maybe MaxTime) -&gt; MetadataT m (Maybe MaxTime)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MetadataT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m (Maybe MaxTime)
forall (m :: * -&gt; *). MonadGetPolicies m =&gt; m (Maybe MaxTime)
</span><a href="Hasura.Server.Types.html#runGetApiTimeLimit"><span class="hs-identifier hs-var">runGetApiTimeLimit</span></a></span><span>
</span><span id="line-302"></span><span>  </span><span id="local-6989586621687618632"><span class="annot"><span class="annottext">runGetPrometheusMetricsGranularity :: MetadataT m (IO GranularPrometheusMetricsState)
</span><a href="#local-6989586621687618632"><span class="hs-identifier hs-var hs-var hs-var hs-var">runGetPrometheusMetricsGranularity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (IO GranularPrometheusMetricsState)
-&gt; MetadataT m (IO GranularPrometheusMetricsState)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MetadataT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m (IO GranularPrometheusMetricsState)
forall (m :: * -&gt; *).
MonadGetPolicies m =&gt;
m (IO GranularPrometheusMetricsState)
</span><a href="Hasura.Server.Types.html#runGetPrometheusMetricsGranularity"><span class="hs-identifier hs-var">runGetPrometheusMetricsGranularity</span></a></span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span class="hs-comment">-- | @runMetadataT@ puts a stateful metadata in scope. @MetadataDefaults@ is</span><span>
</span><span id="line-305"></span><span class="hs-comment">-- provided so that it can be considered from the --metadataDefaults arguments.</span><span>
</span><span id="line-306"></span><span id="local-6989586621687617300"><span id="local-6989586621687617301"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#runMetadataT"><span class="hs-identifier hs-type">runMetadataT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#Metadata"><span class="hs-identifier hs-type">Metadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataDefaults"><span class="hs-identifier hs-type">MetadataDefaults</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataT"><span class="hs-identifier hs-type">MetadataT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617300"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617301"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687617300"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687617301"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#Metadata"><span class="hs-identifier hs-type">Metadata</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-307"></span><span id="runMetadataT"><span class="annot"><span class="annottext">runMetadataT :: forall (m :: * -&gt; *) a.
Metadata -&gt; MetadataDefaults -&gt; MetadataT m a -&gt; m (a, Metadata)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#runMetadataT"><span class="hs-identifier hs-var hs-var">runMetadataT</span></a></span></span><span> </span><span id="local-6989586621687618634"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687618634"><span class="hs-identifier hs-var">metadata</span></a></span></span><span> </span><span id="local-6989586621687618635"><span class="annot"><span class="annottext">MetadataDefaults
</span><a href="#local-6989586621687618635"><span class="hs-identifier hs-var">defaults</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataT"><span class="hs-identifier hs-type">MetadataT</span></a></span><span> </span><span id="local-6989586621687618636"><span class="annot"><span class="annottext">StateT Metadata m a
</span><a href="#local-6989586621687618636"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-308"></span><span>  </span><span class="annot"><span class="annottext">StateT Metadata m a -&gt; Metadata -&gt; m (a, Metadata)
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var">runStateT</span></span><span> </span><span class="annot"><span class="annottext">StateT Metadata m a
</span><a href="#local-6989586621687618636"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687618634"><span class="hs-identifier hs-var">metadata</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; MetadataDefaults -&gt; Metadata
</span><a href="Hasura.RQL.Types.Metadata.html#overrideMetadataDefaults"><span class="hs-operator hs-var">`overrideMetadataDefaults`</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataDefaults
</span><a href="#local-6989586621687618635"><span class="hs-identifier hs-var">defaults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span id="local-6989586621687617307"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCacheWithInvalidations"><span class="hs-identifier hs-type">buildSchemaCacheWithInvalidations</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617307"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617307"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-type">CacheInvalidations</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-type">MetadataModifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687617307"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-311"></span><span id="buildSchemaCacheWithInvalidations"><span class="annot"><span class="annottext">buildSchemaCacheWithInvalidations :: forall (m :: * -&gt; *).
(MetadataM m, CacheRWM m) =&gt;
CacheInvalidations -&gt; MetadataModifier -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCacheWithInvalidations"><span class="hs-identifier hs-var hs-var">buildSchemaCacheWithInvalidations</span></a></span></span><span> </span><span id="local-6989586621687618653"><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687618653"><span class="hs-identifier hs-var">cacheInvalidations</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-type">MetadataModifier</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687618655"><span class="annot"><span class="annottext">Metadata -&gt; Metadata
runMetadataModifier :: Metadata -&gt; Metadata
runMetadataModifier :: MetadataModifier -&gt; Metadata -&gt; Metadata
</span><a href="#local-6989586621687618655"><span class="hs-glyph hs-var hs-var">..</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-312"></span><span>  </span><span id="local-6989586621687618657"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687618657"><span class="hs-identifier hs-var">metadata</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Metadata
forall (m :: * -&gt; *). MetadataM m =&gt; m Metadata
</span><a href="Hasura.RQL.Types.Metadata.html#getMetadata"><span class="hs-identifier hs-var">getMetadata</span></a></span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687618658"><span class="annot"><span class="annottext">modifiedMetadata :: Metadata
</span><a href="#local-6989586621687618658"><span class="hs-identifier hs-var hs-var">modifiedMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; Metadata
</span><a href="#local-6989586621687618655"><span class="hs-identifier hs-var">runMetadataModifier</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687618657"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-314"></span><span>  </span><span class="annot"><span class="annottext">BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; m ()
forall (m :: * -&gt; *).
CacheRWM m =&gt;
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCacheWithOptions"><span class="hs-identifier hs-var">buildSchemaCacheWithOptions</span></a></span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (HashSet SourceName) -&gt; BuildReason
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogUpdate"><span class="hs-identifier hs-var">CatalogUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (HashSet SourceName)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>    </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621687618653"><span class="hs-identifier hs-var">cacheInvalidations</span></a></span><span>
</span><span id="line-317"></span><span>    </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687618658"><span class="hs-identifier hs-var">modifiedMetadata</span></a></span><span>
</span><span id="line-318"></span><span>    </span><span class="annot"><span class="annottext">Maybe MetadataResourceVersion
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-319"></span><span>  </span><span class="annot"><span class="annottext">Metadata -&gt; m ()
forall (m :: * -&gt; *). MetadataM m =&gt; Metadata -&gt; m ()
</span><a href="Hasura.RQL.Types.Metadata.html#putMetadata"><span class="hs-identifier hs-var">putMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687618658"><span class="hs-identifier hs-var">modifiedMetadata</span></a></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span id="local-6989586621687617311"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCache"><span class="hs-identifier hs-type">buildSchemaCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617311"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617311"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-type">MetadataModifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687617311"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-322"></span><span id="buildSchemaCache"><span class="annot"><span class="annottext">buildSchemaCache :: forall (m :: * -&gt; *).
(MetadataM m, CacheRWM m) =&gt;
MetadataModifier -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCache"><span class="hs-identifier hs-var hs-var">buildSchemaCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CacheInvalidations -&gt; MetadataModifier -&gt; m ()
forall (m :: * -&gt; *).
(MetadataM m, CacheRWM m) =&gt;
CacheInvalidations -&gt; MetadataModifier -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCacheWithInvalidations"><span class="hs-identifier hs-var">buildSchemaCacheWithInvalidations</span></a></span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span class="hs-comment">-- | Rebuilds the schema cache after modifying metadata and returns any _new_ metadata inconsistencies.</span><span>
</span><span id="line-325"></span><span class="hs-comment">-- If there are any new inconsistencies, the changes to the metadata and the schema cache are abandoned.</span><span>
</span><span id="line-326"></span><span id="local-6989586621687617313"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCache"><span class="hs-identifier hs-type">tryBuildSchemaCache</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-327"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617313"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617313"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-328"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-type">MetadataModifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-329"></span><span>  </span><span class="annot"><a href="#local-6989586621687617313"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObjId"><span class="hs-identifier hs-type">MetadataObjId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-330"></span><span id="tryBuildSchemaCache"><span class="annot"><span class="annottext">tryBuildSchemaCache :: forall (m :: * -&gt; *).
(CacheRWM m, MetadataM m) =&gt;
MetadataModifier
-&gt; m (HashMap MetadataObjId (NonEmpty InconsistentMetadata))
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCache"><span class="hs-identifier hs-var hs-var">tryBuildSchemaCache</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-type">MetadataModifier</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687618671"><span class="annot"><span class="annottext">Metadata -&gt; Metadata
runMetadataModifier :: MetadataModifier -&gt; Metadata -&gt; Metadata
runMetadataModifier :: Metadata -&gt; Metadata
</span><a href="Hasura.RQL.Types.Metadata.html#runMetadataModifier"><span class="hs-glyph hs-var hs-var">..</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-331"></span><span>  </span><span class="annot"><span class="annottext">[Metadata -&gt; m Metadata]
-&gt; m (HashMap MetadataObjId (NonEmpty InconsistentMetadata))
forall (m :: * -&gt; *).
(CacheRWM m, MetadataM m) =&gt;
[Metadata -&gt; m Metadata]
-&gt; m (HashMap MetadataObjId (NonEmpty InconsistentMetadata))
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCacheWithModifiers"><span class="hs-identifier hs-var">tryBuildSchemaCacheWithModifiers</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Metadata -&gt; m Metadata
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Metadata -&gt; m Metadata)
-&gt; (Metadata -&gt; Metadata) -&gt; Metadata -&gt; m Metadata
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; Metadata
</span><a href="#local-6989586621687618671"><span class="hs-identifier hs-var">runMetadataModifier</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span class="hs-comment">-- | Rebuilds the schema cache after modifying metadata sequentially and returns any _new_ metadata inconsistencies.</span><span>
</span><span id="line-334"></span><span class="hs-comment">-- If there are any new inconsistencies, the changes to the metadata and the schema cache are abandoned.</span><span>
</span><span id="line-335"></span><span class="hs-comment">-- If the metadata modifiers run into validation issues (e.g. a native query is already tracked in the metadata),</span><span>
</span><span id="line-336"></span><span class="hs-comment">-- we throw these errors back without changing the metadata and schema cache.</span><span>
</span><span id="line-337"></span><span id="local-6989586621687617317"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCacheWithModifiers"><span class="hs-identifier hs-type">tryBuildSchemaCacheWithModifiers</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-338"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617317"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617317"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#Metadata"><span class="hs-identifier hs-type">Metadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687617317"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#Metadata"><span class="hs-identifier hs-type">Metadata</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-340"></span><span>  </span><span class="annot"><a href="#local-6989586621687617317"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObjId"><span class="hs-identifier hs-type">MetadataObjId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-341"></span><span id="tryBuildSchemaCacheWithModifiers"><span class="annot"><span class="annottext">tryBuildSchemaCacheWithModifiers :: forall (m :: * -&gt; *).
(CacheRWM m, MetadataM m) =&gt;
[Metadata -&gt; m Metadata]
-&gt; m (HashMap MetadataObjId (NonEmpty InconsistentMetadata))
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCacheWithModifiers"><span class="hs-identifier hs-var hs-var">tryBuildSchemaCacheWithModifiers</span></a></span></span><span> </span><span id="local-6989586621687618706"><span class="annot"><span class="annottext">[Metadata -&gt; m Metadata]
</span><a href="#local-6989586621687618706"><span class="hs-identifier hs-var">modifiers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-342"></span><span>  </span><span id="local-6989586621687618707"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687618707"><span class="hs-identifier hs-var">modifiedMetadata</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-343"></span><span>    </span><span id="local-6989586621687618708"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687618708"><span class="hs-identifier hs-var">metadata</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Metadata
forall (m :: * -&gt; *). MetadataM m =&gt; m Metadata
</span><a href="Hasura.RQL.Types.Metadata.html#getMetadata"><span class="hs-identifier hs-var">getMetadata</span></a></span><span>
</span><span id="line-344"></span><span>    </span><span class="annot"><span class="annottext">(Metadata -&gt; (Metadata -&gt; m Metadata) -&gt; m Metadata)
-&gt; Metadata -&gt; [Metadata -&gt; m Metadata] -&gt; m Metadata
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Metadata -&gt; m Metadata) -&gt; Metadata -&gt; m Metadata)
-&gt; Metadata -&gt; (Metadata -&gt; m Metadata) -&gt; m Metadata
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(Metadata -&gt; m Metadata) -&gt; Metadata -&gt; m Metadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">($)</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687618708"><span class="hs-identifier hs-var">metadata</span></a></span><span> </span><span class="annot"><span class="annottext">[Metadata -&gt; m Metadata]
</span><a href="#local-6989586621687618706"><span class="hs-identifier hs-var">modifiers</span></a></span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span>  </span><span id="local-6989586621687618711"><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618711"><span class="hs-identifier hs-var">newInconsistentObjects</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-347"></span><span>    </span><span class="annot"><span class="annottext">BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache
     (HashMap MetadataObjId (NonEmpty InconsistentMetadata))
-&gt; m (HashMap MetadataObjId (NonEmpty InconsistentMetadata))
forall a.
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; m a
forall (m :: * -&gt; *) a.
CacheRWM m =&gt;
BuildReason
-&gt; CacheInvalidations
-&gt; Metadata
-&gt; Maybe MetadataResourceVersion
-&gt; ValidateNewSchemaCache a
-&gt; m a
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCacheWithOptions"><span class="hs-identifier hs-var">tryBuildSchemaCacheWithOptions</span></a></span><span>
</span><span id="line-348"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (HashSet SourceName) -&gt; BuildReason
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogUpdate"><span class="hs-identifier hs-var">CatalogUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (HashSet SourceName)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>      </span><span class="annot"><span class="annottext">CacheInvalidations
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-350"></span><span>      </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687618707"><span class="hs-identifier hs-var">modifiedMetadata</span></a></span><span>
</span><span id="line-351"></span><span>      </span><span class="annot"><span class="annottext">Maybe MetadataResourceVersion
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-352"></span><span>      </span><span class="annot"><span class="annottext">ValidateNewSchemaCache
  (HashMap MetadataObjId (NonEmpty InconsistentMetadata))
</span><a href="#local-6989586621687618712"><span class="hs-identifier hs-var">validateNewSchemaCache</span></a></span><span>
</span><span id="line-353"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618711"><span class="hs-identifier hs-var">newInconsistentObjects</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
-&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>    </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; m ()
forall (m :: * -&gt; *). MetadataM m =&gt; Metadata -&gt; m ()
</span><a href="Hasura.RQL.Types.Metadata.html#putMetadata"><span class="hs-identifier hs-var">putMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621687618707"><span class="hs-identifier hs-var">modifiedMetadata</span></a></span><span>
</span><span id="line-355"></span><span>  </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
-&gt; m (HashMap MetadataObjId (NonEmpty InconsistentMetadata))
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(HashMap MetadataObjId (NonEmpty InconsistentMetadata)
 -&gt; m (HashMap MetadataObjId (NonEmpty InconsistentMetadata)))
-&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata)
-&gt; m (HashMap MetadataObjId (NonEmpty InconsistentMetadata))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618711"><span class="hs-identifier hs-var">newInconsistentObjects</span></a></span><span>
</span><span id="line-356"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-357"></span><span>    </span><span class="annot"><a href="#local-6989586621687618712"><span class="hs-identifier hs-type">validateNewSchemaCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#SchemaCache"><span class="hs-identifier hs-type">SchemaCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#SchemaCache"><span class="hs-identifier hs-type">SchemaCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#ValidateNewSchemaCacheResult"><span class="hs-identifier hs-type">ValidateNewSchemaCacheResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObjId"><span class="hs-identifier hs-type">MetadataObjId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>    </span><span id="local-6989586621687618712"><span class="annot"><span class="annottext">validateNewSchemaCache :: ValidateNewSchemaCache
  (HashMap MetadataObjId (NonEmpty InconsistentMetadata))
</span><a href="#local-6989586621687618712"><span class="hs-identifier hs-var hs-var">validateNewSchemaCache</span></a></span></span><span> </span><span id="local-6989586621687618714"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687618714"><span class="hs-identifier hs-var">oldSchemaCache</span></a></span></span><span> </span><span id="local-6989586621687618715"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687618715"><span class="hs-identifier hs-var">newSchemaCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-359"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687618718"><span class="annot"><span class="annottext">diffInconsistentObjects :: SchemaCache
-&gt; SchemaCache
-&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618718"><span class="hs-identifier hs-var hs-var">diffInconsistentObjects</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
-&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata)
-&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata)
forall k v w.
(Eq k, Hashable k) =&gt;
HashMap k v -&gt; HashMap k w -&gt; HashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#difference"><span class="hs-identifier hs-var">HashMap.difference</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap MetadataObjId (NonEmpty InconsistentMetadata)
 -&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata)
 -&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata))
-&gt; (SchemaCache
    -&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata))
-&gt; SchemaCache
-&gt; SchemaCache
-&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata)
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InconsistentMetadata]
-&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="Hasura.RQL.Types.Metadata.Object.html#groupInconsistentMetadataById"><span class="hs-identifier hs-var">groupInconsistentMetadataById</span></a></span><span> </span><span class="annot"><span class="annottext">([InconsistentMetadata]
 -&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata))
-&gt; (SchemaCache -&gt; [InconsistentMetadata])
-&gt; SchemaCache
-&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; [InconsistentMetadata]
</span><a href="Hasura.RQL.Types.SchemaCache.html#scInconsistentObjs"><span class="hs-identifier hs-var">scInconsistentObjs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>          </span><span id="local-6989586621687618723"><span class="annot"><span class="annottext">newInconsistentObjects :: HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618723"><span class="hs-identifier hs-var hs-var">newInconsistentObjects</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687618715"><span class="hs-identifier hs-var">newSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
-&gt; SchemaCache
-&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618718"><span class="hs-operator hs-var">`diffInconsistentObjects`</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687618714"><span class="hs-identifier hs-var">oldSchemaCache</span></a></span><span>
</span><span id="line-361"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618723"><span class="hs-identifier hs-var">newInconsistentObjects</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
-&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-362"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidateNewSchemaCacheResult
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#KeepNewSchemaCache"><span class="hs-identifier hs-var">KeepNewSchemaCache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618723"><span class="hs-identifier hs-var">newInconsistentObjects</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidateNewSchemaCacheResult
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#DiscardNewSchemaCache"><span class="hs-identifier hs-var">DiscardNewSchemaCache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618723"><span class="hs-identifier hs-var">newInconsistentObjects</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span class="hs-comment">-- | Tries to modify the metadata for all the specified metadata objects. If the modification fails,</span><span>
</span><span id="line-366"></span><span class="hs-comment">-- any objects that directly caused a new metadata inconsistency are removed and the modification</span><span>
</span><span id="line-367"></span><span class="hs-comment">-- is attempted again without those failing objects. The failing objects are raised as warnings</span><span>
</span><span id="line-368"></span><span class="hs-comment">-- in 'MonadWarnings' and the successful objects are returned. If there are metadata inconsistencies</span><span>
</span><span id="line-369"></span><span class="hs-comment">-- that are not directly related to the specified metadata objects, an error is thrown.</span><span>
</span><span id="line-370"></span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCacheAndWarnOnFailingObjects"><span class="hs-identifier hs-type">tryBuildSchemaCacheAndWarnOnFailingObjects</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-371"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687617338"><span class="annot"><a href="#local-6989586621687617338"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621687617341"><span class="annot"><a href="#local-6989586621687617341"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617338"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Warnings.html#MonadWarnings"><span class="hs-identifier hs-type">MonadWarnings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617338"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617338"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617338"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-373"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Function makes a metadata modifier for a metadata object</span></span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687617341"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687617338"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-type">MetadataModifier</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-375"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Warning code to use for failed metadata objects</span></span><span>
</span><span id="line-376"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Warnings.html#WarningCode"><span class="hs-identifier hs-type">WarningCode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-377"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Map of metadata objects to apply to metadata using the 'mkMetadataModifier' function</span></span><span>
</span><span id="line-378"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObjId"><span class="hs-identifier hs-type">MetadataObjId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617341"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-379"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Successfully applied metadata objects</span></span><span>
</span><span id="line-380"></span><span>  </span><span class="annot"><a href="#local-6989586621687617338"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObjId"><span class="hs-identifier hs-type">MetadataObjId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617341"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span id="tryBuildSchemaCacheAndWarnOnFailingObjects"><span class="annot"><span class="annottext">tryBuildSchemaCacheAndWarnOnFailingObjects :: forall (m :: * -&gt; *) a.
(CacheRWM m, MonadWarnings m, QErrM m, MetadataM m) =&gt;
(a -&gt; m MetadataModifier)
-&gt; WarningCode
-&gt; HashMap MetadataObjId a
-&gt; m (HashMap MetadataObjId a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCacheAndWarnOnFailingObjects"><span class="hs-identifier hs-var hs-var">tryBuildSchemaCacheAndWarnOnFailingObjects</span></a></span></span><span> </span><span id="local-6989586621687618780"><span class="annot"><span class="annottext">a -&gt; m MetadataModifier
</span><a href="#local-6989586621687618780"><span class="hs-identifier hs-var">mkMetadataModifier</span></a></span></span><span> </span><span id="local-6989586621687618781"><span class="annot"><span class="annottext">WarningCode
</span><a href="#local-6989586621687618781"><span class="hs-identifier hs-var">warningCode</span></a></span></span><span> </span><span id="local-6989586621687618782"><span class="annot"><span class="annottext">HashMap MetadataObjId a
</span><a href="#local-6989586621687618782"><span class="hs-identifier hs-var">metadataObjects</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-382"></span><span>  </span><span id="local-6989586621687618783"><span class="annot"><span class="annottext">MetadataModifier
</span><a href="#local-6989586621687618783"><span class="hs-identifier hs-var">metadataModifier</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([MetadataModifier] -&gt; MetadataModifier)
-&gt; m [MetadataModifier] -&gt; m MetadataModifier
forall a b. (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[MetadataModifier] -&gt; MetadataModifier
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">(m [MetadataModifier] -&gt; m MetadataModifier)
-&gt; ([a] -&gt; m [MetadataModifier]) -&gt; [a] -&gt; m MetadataModifier
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; m MetadataModifier) -&gt; [a] -&gt; m [MetadataModifier]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; m MetadataModifier
</span><a href="#local-6989586621687618780"><span class="hs-identifier hs-var">mkMetadataModifier</span></a></span><span> </span><span class="annot"><span class="annottext">([a] -&gt; m MetadataModifier) -&gt; [a] -&gt; m MetadataModifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId a -&gt; [a]
forall k v. HashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#elems"><span class="hs-identifier hs-var">HashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId a
</span><a href="#local-6989586621687618782"><span class="hs-identifier hs-var">metadataObjects</span></a></span><span>
</span><span id="line-383"></span><span>  </span><span id="local-6989586621687618786"><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618786"><span class="hs-identifier hs-var">metadataInconsistencies</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetadataModifier
-&gt; m (HashMap MetadataObjId (NonEmpty InconsistentMetadata))
forall (m :: * -&gt; *).
(CacheRWM m, MetadataM m) =&gt;
MetadataModifier
-&gt; m (HashMap MetadataObjId (NonEmpty InconsistentMetadata))
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCache"><span class="hs-identifier hs-var">tryBuildSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataModifier
</span><a href="#local-6989586621687618783"><span class="hs-identifier hs-var">metadataModifier</span></a></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687618787"><span class="annot"><span class="annottext">inconsistentObjects :: HashMap MetadataObjId (NonEmpty InconsistentMetadata, a)
</span><a href="#local-6989586621687618787"><span class="hs-identifier hs-var hs-var">inconsistentObjects</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NonEmpty InconsistentMetadata
 -&gt; a -&gt; (NonEmpty InconsistentMetadata, a))
-&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata)
-&gt; HashMap MetadataObjId a
-&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata, a)
forall k v1 v2 v3.
(Eq k, Hashable k) =&gt;
(v1 -&gt; v2 -&gt; v3) -&gt; HashMap k v1 -&gt; HashMap k v2 -&gt; HashMap k v3
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.Strict.html#intersectionWith"><span class="hs-identifier hs-var">HashMap.intersectionWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618786"><span class="hs-identifier hs-var">metadataInconsistencies</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId a
</span><a href="#local-6989586621687618782"><span class="hs-identifier hs-var">metadataObjects</span></a></span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687618789"><span class="annot"><span class="annottext">successfulObjects :: HashMap MetadataObjId a
</span><a href="#local-6989586621687618789"><span class="hs-identifier hs-var hs-var">successfulObjects</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId a
-&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata, a)
-&gt; HashMap MetadataObjId a
forall k v w.
(Eq k, Hashable k) =&gt;
HashMap k v -&gt; HashMap k w -&gt; HashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#difference"><span class="hs-identifier hs-var">HashMap.difference</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId a
</span><a href="#local-6989586621687618782"><span class="hs-identifier hs-var">metadataObjects</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata, a)
</span><a href="#local-6989586621687618787"><span class="hs-identifier hs-var">inconsistentObjects</span></a></span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span>  </span><span id="local-6989586621687618790"><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618790"><span class="hs-identifier hs-var">finalMetadataInconsistencies</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-389"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata, a) -&gt; Bool
forall a. HashMap MetadataObjId a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata, a)
</span><a href="#local-6989586621687618787"><span class="hs-identifier hs-var">inconsistentObjects</span></a></span><span>
</span><span id="line-390"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-391"></span><span>        </span><span class="hs-comment">-- Raise warnings for objects that failed to track</span><span>
</span><span id="line-392"></span><span>        </span><span class="annot"><span class="annottext">[(MetadataObjId, (NonEmpty InconsistentMetadata, a))]
-&gt; ((MetadataObjId, (NonEmpty InconsistentMetadata, a)) -&gt; m ())
-&gt; m ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata, a)
-&gt; [(MetadataObjId, (NonEmpty InconsistentMetadata, a))]
forall k v. HashMap k v -&gt; [(k, v)]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#toList"><span class="hs-identifier hs-var">HashMap.toList</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata, a)
</span><a href="#local-6989586621687618787"><span class="hs-identifier hs-var">inconsistentObjects</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((MetadataObjId, (NonEmpty InconsistentMetadata, a)) -&gt; m ())
 -&gt; m ())
-&gt; ((MetadataObjId, (NonEmpty InconsistentMetadata, a)) -&gt; m ())
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621687618795"><span class="annot"><span class="annottext">MetadataObjId
</span><a href="#local-6989586621687618795"><span class="hs-identifier hs-var">metadataObjId</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687618796"><span class="annot"><span class="annottext">NonEmpty InconsistentMetadata
</span><a href="#local-6989586621687618796"><span class="hs-identifier hs-var">inconsistencies</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-393"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687618797"><span class="annot"><span class="annottext">errorReasons :: Text
</span><a href="#local-6989586621687618797"><span class="hs-identifier hs-var hs-var">errorReasons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty Text -&gt; Text
forall t (f :: * -&gt; *). (ToTxt t, Foldable f) =&gt; f t -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#commaSeparated"><span class="hs-identifier hs-var">commaSeparated</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty Text -&gt; Text) -&gt; NonEmpty Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InconsistentMetadata -&gt; Text
</span><a href="Hasura.RQL.Types.Metadata.Object.html#imReason"><span class="hs-identifier hs-var">imReason</span></a></span><span> </span><span class="annot"><span class="annottext">(InconsistentMetadata -&gt; Text)
-&gt; NonEmpty InconsistentMetadata -&gt; NonEmpty Text
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty InconsistentMetadata
</span><a href="#local-6989586621687618796"><span class="hs-identifier hs-var">inconsistencies</span></a></span><span>
</span><span id="line-394"></span><span>          </span><span class="annot"><span class="annottext">MetadataWarning -&gt; m ()
forall (m :: * -&gt; *). MonadWarnings m =&gt; MetadataWarning -&gt; m ()
</span><a href="Hasura.RQL.DDL.Warnings.html#warn"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataWarning -&gt; m ()) -&gt; MetadataWarning -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WarningCode -&gt; MetadataObjId -&gt; Text -&gt; MetadataWarning
</span><a href="Hasura.RQL.DDL.Warnings.html#MetadataWarning"><span class="hs-identifier hs-var">MetadataWarning</span></a></span><span> </span><span class="annot"><span class="annottext">WarningCode
</span><a href="#local-6989586621687618781"><span class="hs-identifier hs-var">warningCode</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObjId
</span><a href="#local-6989586621687618795"><span class="hs-identifier hs-var">metadataObjId</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687618797"><span class="hs-identifier hs-var">errorReasons</span></a></span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span>        </span><span class="hs-comment">-- Try again, this time only with objects that were previously successful</span><span>
</span><span id="line-397"></span><span>        </span><span id="local-6989586621687618802"><span class="annot"><span class="annottext">MetadataModifier
</span><a href="#local-6989586621687618802"><span class="hs-identifier hs-var">withoutFailedObjectsMetadataModifier</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([MetadataModifier] -&gt; MetadataModifier)
-&gt; m [MetadataModifier] -&gt; m MetadataModifier
forall a b. (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[MetadataModifier] -&gt; MetadataModifier
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">(m [MetadataModifier] -&gt; m MetadataModifier)
-&gt; ([a] -&gt; m [MetadataModifier]) -&gt; [a] -&gt; m MetadataModifier
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; m MetadataModifier) -&gt; [a] -&gt; m [MetadataModifier]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; m MetadataModifier
</span><a href="#local-6989586621687618780"><span class="hs-identifier hs-var">mkMetadataModifier</span></a></span><span> </span><span class="annot"><span class="annottext">([a] -&gt; m MetadataModifier) -&gt; [a] -&gt; m MetadataModifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId a -&gt; [a]
forall k v. HashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#elems"><span class="hs-identifier hs-var">HashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId a
</span><a href="#local-6989586621687618789"><span class="hs-identifier hs-var">successfulObjects</span></a></span><span>
</span><span id="line-398"></span><span>        </span><span class="annot"><span class="annottext">MetadataModifier
-&gt; m (HashMap MetadataObjId (NonEmpty InconsistentMetadata))
forall (m :: * -&gt; *).
(CacheRWM m, MetadataM m) =&gt;
MetadataModifier
-&gt; m (HashMap MetadataObjId (NonEmpty InconsistentMetadata))
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCache"><span class="hs-identifier hs-var">tryBuildSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataModifier
</span><a href="#local-6989586621687618802"><span class="hs-identifier hs-var">withoutFailedObjectsMetadataModifier</span></a></span><span>
</span><span id="line-399"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-comment">-- Otherwise just look at the rest of the errors, if any</span><span>
</span><span id="line-400"></span><span>        </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
-&gt; m (HashMap MetadataObjId (NonEmpty InconsistentMetadata))
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618786"><span class="hs-identifier hs-var">metadataInconsistencies</span></a></span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata) -&gt; Bool
forall a. HashMap MetadataObjId a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618790"><span class="hs-identifier hs-var">finalMetadataInconsistencies</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>    </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; m ()
forall a. QErr -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span>
</span><span id="line-404"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; QErr
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#err400"><span class="hs-identifier hs-var">err400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#Unexpected"><span class="hs-identifier hs-var">Unexpected</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;cannot continue due to newly found inconsistent metadata&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">qeInternal :: Maybe QErrExtra
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#qeInternal"><span class="hs-identifier hs-var">qeInternal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QErrExtra -&gt; Maybe QErrExtra
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(QErrExtra -&gt; Maybe QErrExtra) -&gt; QErrExtra -&gt; Maybe QErrExtra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; QErrExtra
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#ExtraInternal"><span class="hs-identifier hs-var">ExtraInternal</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; QErrExtra) -&gt; Value -&gt; QErrExtra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata] -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InconsistentMetadata] -&gt; [InconsistentMetadata]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.nub</span></span><span> </span><span class="annot"><span class="annottext">([InconsistentMetadata] -&gt; [InconsistentMetadata])
-&gt; ([NonEmpty InconsistentMetadata] -&gt; [InconsistentMetadata])
-&gt; [NonEmpty InconsistentMetadata]
-&gt; [InconsistentMetadata]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty InconsistentMetadata -&gt; [InconsistentMetadata])
-&gt; [NonEmpty InconsistentMetadata] -&gt; [InconsistentMetadata]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty InconsistentMetadata -&gt; [InconsistentMetadata]
forall a. NonEmpty a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">([NonEmpty InconsistentMetadata] -&gt; [InconsistentMetadata])
-&gt; [NonEmpty InconsistentMetadata] -&gt; [InconsistentMetadata]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
-&gt; [NonEmpty InconsistentMetadata]
forall k v. HashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#elems"><span class="hs-identifier hs-var">HashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618790"><span class="hs-identifier hs-var">finalMetadataInconsistencies</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span>  </span><span class="annot"><span class="annottext">HashMap MetadataObjId a -&gt; m (HashMap MetadataObjId a)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId a
</span><a href="#local-6989586621687618789"><span class="hs-identifier hs-var">successfulObjects</span></a></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span class="hs-comment">-- | Rebuilds the schema cache after modifying metadata. If an object with the given object id became newly inconsistent,</span><span>
</span><span id="line-411"></span><span class="hs-comment">-- raises an error about it specifically. Otherwise, raises a generic metadata inconsistency error.</span><span>
</span><span id="line-412"></span><span id="local-6989586621687617374"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCacheFor"><span class="hs-identifier hs-type">buildSchemaCacheFor</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-413"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617374"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617374"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617374"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-414"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObjId"><span class="hs-identifier hs-type">MetadataObjId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-415"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-type">MetadataModifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-416"></span><span>  </span><span class="annot"><a href="#local-6989586621687617374"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-417"></span><span id="buildSchemaCacheFor"><span class="annot"><span class="annottext">buildSchemaCacheFor :: forall (m :: * -&gt; *).
(QErrM m, CacheRWM m, MetadataM m) =&gt;
MetadataObjId -&gt; MetadataModifier -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCacheFor"><span class="hs-identifier hs-var hs-var">buildSchemaCacheFor</span></a></span></span><span> </span><span id="local-6989586621687618837"><span class="annot"><span class="annottext">MetadataObjId
</span><a href="#local-6989586621687618837"><span class="hs-identifier hs-var">objectId</span></a></span></span><span> </span><span id="local-6989586621687618838"><span class="annot"><span class="annottext">MetadataModifier
</span><a href="#local-6989586621687618838"><span class="hs-identifier hs-var">metadataModifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-418"></span><span>  </span><span id="local-6989586621687618839"><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618839"><span class="hs-identifier hs-var">newInconsistentObjects</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetadataModifier
-&gt; m (HashMap MetadataObjId (NonEmpty InconsistentMetadata))
forall (m :: * -&gt; *).
(CacheRWM m, MetadataM m) =&gt;
MetadataModifier
-&gt; m (HashMap MetadataObjId (NonEmpty InconsistentMetadata))
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#tryBuildSchemaCache"><span class="hs-identifier hs-var">tryBuildSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataModifier
</span><a href="#local-6989586621687618838"><span class="hs-identifier hs-var">metadataModifier</span></a></span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span>  </span><span class="annot"><span class="annottext">Maybe (NonEmpty InconsistentMetadata)
-&gt; (NonEmpty InconsistentMetadata -&gt; m Any) -&gt; m ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetadataObjId
-&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata)
-&gt; Maybe (NonEmpty InconsistentMetadata)
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#lookup"><span class="hs-identifier hs-var">HashMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObjId
</span><a href="#local-6989586621687618837"><span class="hs-identifier hs-var">objectId</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618839"><span class="hs-identifier hs-var">newInconsistentObjects</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((NonEmpty InconsistentMetadata -&gt; m Any) -&gt; m ())
-&gt; (NonEmpty InconsistentMetadata -&gt; m Any) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687618841"><span class="annot"><span class="annottext">NonEmpty InconsistentMetadata
</span><a href="#local-6989586621687618841"><span class="hs-identifier hs-var">matchingObjects</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-421"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687618842"><span class="annot"><span class="annottext">reasons :: Text
</span><a href="#local-6989586621687618842"><span class="hs-identifier hs-var hs-var">reasons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty Text -&gt; Text
forall t (f :: * -&gt; *). (ToTxt t, Foldable f) =&gt; f t -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#commaSeparated"><span class="hs-identifier hs-var">commaSeparated</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty Text -&gt; Text) -&gt; NonEmpty Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InconsistentMetadata -&gt; Text
</span><a href="Hasura.RQL.Types.Metadata.Object.html#imReason"><span class="hs-identifier hs-var">imReason</span></a></span><span> </span><span class="annot"><span class="annottext">(InconsistentMetadata -&gt; Text)
-&gt; NonEmpty InconsistentMetadata -&gt; NonEmpty Text
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty InconsistentMetadata
</span><a href="#local-6989586621687618841"><span class="hs-identifier hs-var">matchingObjects</span></a></span><span>
</span><span id="line-422"></span><span>    </span><span class="annot"><span class="annottext">QErr -&gt; m Any
forall a. QErr -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; QErr
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#err400"><span class="hs-identifier hs-var">err400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#InvalidConfiguration"><span class="hs-identifier hs-var">InvalidConfiguration</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687618842"><span class="hs-identifier hs-var">reasons</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">qeInternal :: Maybe QErrExtra
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#qeInternal"><span class="hs-identifier hs-var">qeInternal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QErrExtra -&gt; Maybe QErrExtra
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(QErrExtra -&gt; Maybe QErrExtra) -&gt; QErrExtra -&gt; Maybe QErrExtra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; QErrExtra
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#ExtraInternal"><span class="hs-identifier hs-var">ExtraInternal</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; QErrExtra) -&gt; Value -&gt; QErrExtra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty InconsistentMetadata -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty InconsistentMetadata
</span><a href="#local-6989586621687618841"><span class="hs-identifier hs-var">matchingObjects</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata) -&gt; Bool
forall a. HashMap MetadataObjId a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618839"><span class="hs-identifier hs-var">newInconsistentObjects</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>    </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; m ()
forall a. QErr -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span>
</span><span id="line-426"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; QErr
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#err400"><span class="hs-identifier hs-var">err400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#Unexpected"><span class="hs-identifier hs-var">Unexpected</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;cannot continue due to new inconsistent metadata&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">qeInternal :: Maybe QErrExtra
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#qeInternal"><span class="hs-identifier hs-var">qeInternal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QErrExtra -&gt; Maybe QErrExtra
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(QErrExtra -&gt; Maybe QErrExtra) -&gt; QErrExtra -&gt; Maybe QErrExtra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; QErrExtra
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#ExtraInternal"><span class="hs-identifier hs-var">ExtraInternal</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; QErrExtra) -&gt; Value -&gt; QErrExtra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata] -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InconsistentMetadata] -&gt; [InconsistentMetadata]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.nub</span></span><span> </span><span class="annot"><span class="annottext">([InconsistentMetadata] -&gt; [InconsistentMetadata])
-&gt; ([NonEmpty InconsistentMetadata] -&gt; [InconsistentMetadata])
-&gt; [NonEmpty InconsistentMetadata]
-&gt; [InconsistentMetadata]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty InconsistentMetadata -&gt; [InconsistentMetadata])
-&gt; [NonEmpty InconsistentMetadata] -&gt; [InconsistentMetadata]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty InconsistentMetadata -&gt; [InconsistentMetadata]
forall a. NonEmpty a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">([NonEmpty InconsistentMetadata] -&gt; [InconsistentMetadata])
-&gt; [NonEmpty InconsistentMetadata] -&gt; [InconsistentMetadata]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
-&gt; [NonEmpty InconsistentMetadata]
forall k v. HashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#elems"><span class="hs-identifier hs-var">HashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618839"><span class="hs-identifier hs-var">newInconsistentObjects</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span class="annot"><span class="hs-comment">-- | Requests the schema cache, and fails if there is any inconsistent metadata.</span></span><span>
</span><span id="line-431"></span><span id="local-6989586621687617379"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#throwOnInconsistencies"><span class="hs-identifier hs-type">throwOnInconsistencies</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617379"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617379"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687617379"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-432"></span><span id="throwOnInconsistencies"><span class="annot"><span class="annottext">throwOnInconsistencies :: forall (m :: * -&gt; *). (QErrM m, CacheRWM m) =&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#throwOnInconsistencies"><span class="hs-identifier hs-var hs-var">throwOnInconsistencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-433"></span><span>  </span><span id="local-6989586621687618856"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687618856"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m SchemaCache
forall (m :: * -&gt; *). CacheRM m =&gt; m SchemaCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#askSchemaCache"><span class="hs-identifier hs-var">askSchemaCache</span></a></span><span>
</span><span id="line-434"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687618858"><span class="annot"><span class="annottext">inconsObjs :: [InconsistentMetadata]
</span><a href="#local-6989586621687618858"><span class="hs-identifier hs-var hs-var">inconsObjs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; [InconsistentMetadata]
</span><a href="Hasura.RQL.Types.SchemaCache.html#scInconsistentObjs"><span class="hs-identifier hs-var">scInconsistentObjs</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687618856"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-435"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InconsistentMetadata] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687618858"><span class="hs-identifier hs-var">inconsObjs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-436"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687618860"><span class="annot"><span class="annottext">err :: QErr
</span><a href="#local-6989586621687618860"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; QErr
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#err400"><span class="hs-identifier hs-var">err400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#Unexpected"><span class="hs-identifier hs-var">Unexpected</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;cannot continue due to inconsistent metadata&quot;</span></span><span>
</span><span id="line-437"></span><span>    </span><span class="annot"><span class="annottext">QErr -&gt; m ()
forall a. QErr -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687618860"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">qeInternal :: Maybe QErrExtra
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#qeInternal"><span class="hs-identifier hs-var">qeInternal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QErrExtra -&gt; Maybe QErrExtra
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(QErrExtra -&gt; Maybe QErrExtra) -&gt; QErrExtra -&gt; Maybe QErrExtra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; QErrExtra
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#ExtraInternal"><span class="hs-identifier hs-var">ExtraInternal</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; QErrExtra) -&gt; Value -&gt; QErrExtra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata] -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687618858"><span class="hs-identifier hs-var">inconsObjs</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span class="hs-comment">-- | Executes the given action, and if any new 'InconsistentMetadata's are added to the schema</span><span>
</span><span id="line-440"></span><span class="hs-comment">-- cache as a result of its execution, raises an error.</span><span>
</span><span id="line-441"></span><span id="local-6989586621687617381"><span id="local-6989586621687617382"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#withNewInconsistentObjsCheck"><span class="hs-identifier hs-type">withNewInconsistentObjsCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617381"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#CacheRM"><span class="hs-identifier hs-type">CacheRM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617381"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687617381"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617382"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687617381"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687617382"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-442"></span><span id="withNewInconsistentObjsCheck"><span class="annot"><span class="annottext">withNewInconsistentObjsCheck :: forall (m :: * -&gt; *) a. (QErrM m, CacheRM m) =&gt; m a -&gt; m a
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withNewInconsistentObjsCheck"><span class="hs-identifier hs-var hs-var">withNewInconsistentObjsCheck</span></a></span></span><span> </span><span id="local-6989586621687618885"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621687618885"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-443"></span><span>  </span><span id="local-6989586621687618886"><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687618886"><span class="hs-identifier hs-var">originalObjects</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; [InconsistentMetadata]
</span><a href="Hasura.RQL.Types.SchemaCache.html#scInconsistentObjs"><span class="hs-identifier hs-var">scInconsistentObjs</span></a></span><span> </span><span class="annot"><span class="annottext">(SchemaCache -&gt; [InconsistentMetadata])
-&gt; m SchemaCache -&gt; m [InconsistentMetadata]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m SchemaCache
forall (m :: * -&gt; *). CacheRM m =&gt; m SchemaCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#askSchemaCache"><span class="hs-identifier hs-var">askSchemaCache</span></a></span><span>
</span><span id="line-444"></span><span>  </span><span id="local-6989586621687618887"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621687618887"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621687618885"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-445"></span><span>  </span><span id="local-6989586621687618888"><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687618888"><span class="hs-identifier hs-var">currentObjects</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; [InconsistentMetadata]
</span><a href="Hasura.RQL.Types.SchemaCache.html#scInconsistentObjs"><span class="hs-identifier hs-var">scInconsistentObjs</span></a></span><span> </span><span class="annot"><span class="annottext">(SchemaCache -&gt; [InconsistentMetadata])
-&gt; m SchemaCache -&gt; m [InconsistentMetadata]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m SchemaCache
forall (m :: * -&gt; *). CacheRM m =&gt; m SchemaCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#askSchemaCache"><span class="hs-identifier hs-var">askSchemaCache</span></a></span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687618891"><span class="annot"><span class="annottext">diffInconsistentObjects :: [InconsistentMetadata]
-&gt; [InconsistentMetadata]
-&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618891"><span class="hs-identifier hs-var hs-var">diffInconsistentObjects</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
-&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata)
-&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata)
forall k v w.
(Eq k, Hashable k) =&gt;
HashMap k v -&gt; HashMap k w -&gt; HashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#difference"><span class="hs-identifier hs-var">HashMap.difference</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap MetadataObjId (NonEmpty InconsistentMetadata)
 -&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata)
 -&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata))
-&gt; ([InconsistentMetadata]
    -&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata))
-&gt; [InconsistentMetadata]
-&gt; [InconsistentMetadata]
-&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata)
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
-&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="Hasura.RQL.Types.Metadata.Object.html#groupInconsistentMetadataById"><span class="hs-identifier hs-var">groupInconsistentMetadataById</span></a></span><span>
</span><span id="line-448"></span><span>      </span><span id="local-6989586621687618892"><span class="annot"><span class="annottext">newInconsistentObjects :: [InconsistentMetadata]
</span><a href="#local-6989586621687618892"><span class="hs-identifier hs-var hs-var">newInconsistentObjects</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-449"></span><span>        </span><span class="annot"><span class="annottext">[InconsistentMetadata] -&gt; [InconsistentMetadata]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.List.Extended.html#uniques"><span class="hs-identifier hs-var">L.uniques</span></a></span><span> </span><span class="annot"><span class="annottext">([InconsistentMetadata] -&gt; [InconsistentMetadata])
-&gt; [InconsistentMetadata] -&gt; [InconsistentMetadata]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty InconsistentMetadata -&gt; [InconsistentMetadata])
-&gt; [NonEmpty InconsistentMetadata] -&gt; [InconsistentMetadata]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty InconsistentMetadata -&gt; [InconsistentMetadata]
forall a. NonEmpty a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">([NonEmpty InconsistentMetadata] -&gt; [InconsistentMetadata])
-&gt; [NonEmpty InconsistentMetadata] -&gt; [InconsistentMetadata]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap MetadataObjId (NonEmpty InconsistentMetadata)
-&gt; [NonEmpty InconsistentMetadata]
forall k v. HashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#elems"><span class="hs-identifier hs-var">HashMap.elems</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687618888"><span class="hs-identifier hs-var">currentObjects</span></a></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
-&gt; [InconsistentMetadata]
-&gt; HashMap MetadataObjId (NonEmpty InconsistentMetadata)
</span><a href="#local-6989586621687618891"><span class="hs-operator hs-var">`diffInconsistentObjects`</span></a></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687618886"><span class="hs-identifier hs-var">originalObjects</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InconsistentMetadata] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687618892"><span class="hs-identifier hs-var">newInconsistentObjects</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>    </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; m ()
forall a. QErr -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span>
</span><span id="line-452"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; QErr
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#err500"><span class="hs-identifier hs-var">err500</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#Unexpected"><span class="hs-identifier hs-var">Unexpected</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;cannot continue due to newly found inconsistent metadata&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">qeInternal :: Maybe QErrExtra
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#qeInternal"><span class="hs-identifier hs-var">qeInternal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QErrExtra -&gt; Maybe QErrExtra
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(QErrExtra -&gt; Maybe QErrExtra) -&gt; QErrExtra -&gt; Maybe QErrExtra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; QErrExtra
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#ExtraInternal"><span class="hs-identifier hs-var">ExtraInternal</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; QErrExtra) -&gt; Value -&gt; QErrExtra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata] -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621687618892"><span class="hs-identifier hs-var">newInconsistentObjects</span></a></span><span>
</span><span id="line-454"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; m a
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621687618887"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span class="hs-comment">-- | getInconsistentQueryCollections is a helper function that runs the</span><span>
</span><span id="line-459"></span><span class="hs-comment">-- static analysis over the saved queries and reports any inconsistenties</span><span>
</span><span id="line-460"></span><span class="hs-comment">-- with the current schema.</span><span>
</span><span id="line-461"></span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#getInconsistentQueryCollections"><span class="hs-identifier hs-type">getInconsistentQueryCollections</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-462"></span><span>  </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src/Language.GraphQL.Draft.Syntax.html#SchemaIntrospection"><span class="hs-identifier hs-type">G.SchemaIntrospection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-463"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#QueryCollections"><span class="hs-identifier hs-type">QueryCollections</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-464"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#CollectionName"><span class="hs-identifier hs-type">CollectionName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#ListedQuery"><span class="hs-identifier hs-type">ListedQuery</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-465"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointTrie"><span class="hs-identifier hs-type">EndpointTrie</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#GQLQueryWithText"><span class="hs-identifier hs-type">GQLQueryWithText</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-466"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Allowlist.html#NormalizedQuery"><span class="hs-identifier hs-type">NormalizedQuery</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-467"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-468"></span><span id="getInconsistentQueryCollections"><span class="annot"><span class="annottext">getInconsistentQueryCollections :: SchemaIntrospection
-&gt; QueryCollections
-&gt; ((CollectionName, ListedQuery) -&gt; MetadataObject)
-&gt; EndpointTrie GQLQueryWithText
-&gt; [NormalizedQuery]
-&gt; [InconsistentMetadata]
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#getInconsistentQueryCollections"><span class="hs-identifier hs-var hs-var">getInconsistentQueryCollections</span></a></span></span><span> </span><span id="local-6989586621687618895"><span class="annot"><span class="annottext">SchemaIntrospection
</span><a href="#local-6989586621687618895"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span id="local-6989586621687618896"><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621687618896"><span class="hs-identifier hs-var">qcs</span></a></span></span><span> </span><span id="local-6989586621687618897"><span class="annot"><span class="annottext">(CollectionName, ListedQuery) -&gt; MetadataObject
</span><a href="#local-6989586621687618897"><span class="hs-identifier hs-var">lqToMetadataObj</span></a></span></span><span> </span><span id="local-6989586621687618898"><span class="annot"><span class="annottext">EndpointTrie GQLQueryWithText
</span><a href="#local-6989586621687618898"><span class="hs-identifier hs-var">restEndpoints</span></a></span></span><span> </span><span id="local-6989586621687618899"><span class="annot"><span class="annottext">[NormalizedQuery]
</span><a href="#local-6989586621687618899"><span class="hs-identifier hs-var">allowLst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-469"></span><span>  </span><span class="annot"><span class="annottext">((MetadataObject, Text) -&gt; InconsistentMetadata)
-&gt; [(MetadataObject, Text)] -&gt; [InconsistentMetadata]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621687618900"><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687618900"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687618901"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687618901"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Value -&gt; MetadataObject -&gt; InconsistentMetadata
</span><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentObject"><span class="hs-identifier hs-var">InconsistentObject</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687618901"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621687618900"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(MetadataObject, Text)]
</span><a href="#local-6989586621687618902"><span class="hs-identifier hs-var">inconsistentMetaObjs</span></a></span><span>
</span><span id="line-470"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-471"></span><span>    </span><span id="local-6989586621687618902"><span class="annot"><span class="annottext">inconsistentMetaObjs :: [(MetadataObject, Text)]
</span><a href="#local-6989586621687618902"><span class="hs-identifier hs-var hs-var">inconsistentMetaObjs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either (MetadataObject, Text) ()] -&gt; [(MetadataObject, Text)]
forall a b. [Either a b] -&gt; [a]
</span><span class="hs-identifier hs-var">lefts</span></span><span> </span><span class="annot"><span class="annottext">([Either (MetadataObject, Text) ()] -&gt; [(MetadataObject, Text)])
-&gt; [Either (MetadataObject, Text) ()] -&gt; [(MetadataObject, Text)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((CollectionName, ListedQuery), [ExecutableDefinition Name])
-&gt; Either (MetadataObject, Text) ()
</span><a href="#local-6989586621687618904"><span class="hs-identifier hs-var">validateQuery</span></a></span><span> </span><span class="annot"><span class="annottext">(((CollectionName, ListedQuery), [ExecutableDefinition Name])
 -&gt; Either (MetadataObject, Text) ())
-&gt; [((CollectionName, ListedQuery), [ExecutableDefinition Name])]
-&gt; [Either (MetadataObject, Text) ()]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[((CollectionName, ListedQuery), [ExecutableDefinition Name])]
</span><a href="#local-6989586621687618905"><span class="hs-identifier hs-var">lqLst</span></a></span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span>    </span><span class="annot"><a href="#local-6989586621687618906"><span class="hs-identifier hs-type">zipLQwithDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#CollectionName"><span class="hs-identifier hs-type">CollectionName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#CreateCollection"><span class="hs-identifier hs-type">CreateCollection</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#CollectionName"><span class="hs-identifier hs-type">CollectionName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#ListedQuery"><span class="hs-identifier hs-type">ListedQuery</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src/Language.GraphQL.Draft.Syntax.html#ExecutableDefinition"><span class="hs-identifier hs-type">G.ExecutableDefinition</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src/Language.GraphQL.Draft.Syntax.Name.html#Name"><span class="hs-identifier hs-type">G.Name</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-474"></span><span>    </span><span id="local-6989586621687618906"><span class="annot"><span class="annottext">zipLQwithDef :: (CollectionName, CreateCollection)
-&gt; [((CollectionName, ListedQuery), [ExecutableDefinition Name])]
</span><a href="#local-6989586621687618906"><span class="hs-identifier hs-var hs-var">zipLQwithDef</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687618907"><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621687618907"><span class="hs-identifier hs-var">cName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687618908"><span class="annot"><span class="annottext">CreateCollection
</span><a href="#local-6989586621687618908"><span class="hs-identifier hs-var">cc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ListedQuery
 -&gt; ((CollectionName, ListedQuery), [ExecutableDefinition Name]))
-&gt; [ListedQuery]
-&gt; [((CollectionName, ListedQuery), [ExecutableDefinition Name])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621687618909"><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621687618909"><span class="hs-identifier hs-var">lq</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621687618907"><span class="hs-identifier hs-var">cName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621687618909"><span class="hs-identifier hs-var">lq</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExecutableDocument Name -&gt; [ExecutableDefinition Name]
forall var. ExecutableDocument var -&gt; [ExecutableDefinition var]
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src/Language.GraphQL.Draft.Syntax.html#getExecutableDefinitions"><span class="hs-identifier hs-var">G.getExecutableDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">(ExecutableDocument Name -&gt; [ExecutableDefinition Name])
-&gt; (ListedQuery -&gt; ExecutableDocument Name)
-&gt; ListedQuery
-&gt; [ExecutableDefinition Name]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GQLQuery -&gt; ExecutableDocument Name
</span><a href="Hasura.RQL.Types.QueryCollection.html#unGQLQuery"><span class="hs-identifier hs-var">unGQLQuery</span></a></span><span> </span><span class="annot"><span class="annottext">(GQLQuery -&gt; ExecutableDocument Name)
-&gt; (ListedQuery -&gt; GQLQuery)
-&gt; ListedQuery
-&gt; ExecutableDocument Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GQLQueryWithText -&gt; GQLQuery
</span><a href="Hasura.RQL.Types.QueryCollection.html#getGQLQuery"><span class="hs-identifier hs-var">getGQLQuery</span></a></span><span> </span><span class="annot"><span class="annottext">(GQLQueryWithText -&gt; GQLQuery)
-&gt; (ListedQuery -&gt; GQLQueryWithText) -&gt; ListedQuery -&gt; GQLQuery
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ListedQuery -&gt; GQLQueryWithText
</span><a href="Hasura.RQL.Types.QueryCollection.html#_lqQuery"><span class="hs-identifier hs-var">_lqQuery</span></a></span><span> </span><span class="annot"><span class="annottext">(ListedQuery -&gt; [ExecutableDefinition Name])
-&gt; ListedQuery -&gt; [ExecutableDefinition Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621687618909"><span class="hs-identifier hs-var">lq</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ListedQuery]
</span><a href="#local-6989586621687618914"><span class="hs-identifier hs-var">lqs</span></a></span><span>
</span><span id="line-475"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-476"></span><span>        </span><span id="local-6989586621687618914"><span class="annot"><span class="annottext">lqs :: [ListedQuery]
</span><a href="#local-6989586621687618914"><span class="hs-identifier hs-var hs-var">lqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CollectionDef -&gt; [ListedQuery]
</span><a href="Hasura.RQL.Types.QueryCollection.html#_cdQueries"><span class="hs-identifier hs-var">_cdQueries</span></a></span><span> </span><span class="annot"><span class="annottext">(CollectionDef -&gt; [ListedQuery])
-&gt; (CreateCollection -&gt; CollectionDef)
-&gt; CreateCollection
-&gt; [ListedQuery]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CreateCollection -&gt; CollectionDef
</span><a href="Hasura.RQL.Types.QueryCollection.html#_ccDefinition"><span class="hs-identifier hs-var">_ccDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">(CreateCollection -&gt; [ListedQuery])
-&gt; CreateCollection -&gt; [ListedQuery]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CreateCollection
</span><a href="#local-6989586621687618908"><span class="hs-identifier hs-var">cc</span></a></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span>    </span><span class="annot"><a href="#local-6989586621687618917"><span class="hs-identifier hs-type">inAllowList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Allowlist.html#NormalizedQuery"><span class="hs-identifier hs-type">NormalizedQuery</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#ListedQuery"><span class="hs-identifier hs-type">ListedQuery</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-479"></span><span>    </span><span id="local-6989586621687618917"><span class="annot"><span class="annottext">inAllowList :: [NormalizedQuery] -&gt; ListedQuery -&gt; Bool
</span><a href="#local-6989586621687618917"><span class="hs-identifier hs-var hs-var">inAllowList</span></a></span></span><span> </span><span id="local-6989586621687618918"><span class="annot"><span class="annottext">[NormalizedQuery]
</span><a href="#local-6989586621687618918"><span class="hs-identifier hs-var">nativeQueryList</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#ListedQuery"><span class="hs-identifier hs-type">ListedQuery</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687618920"><span id="local-6989586621687618921"><span class="annot"><span class="annottext">GQLQueryWithText
QueryName
_lqQuery :: ListedQuery -&gt; GQLQueryWithText
_lqName :: QueryName
_lqQuery :: GQLQueryWithText
_lqName :: ListedQuery -&gt; QueryName
</span><a href="Hasura.RQL.Types.QueryCollection.html#_lqQuery"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NormalizedQuery -&gt; Bool) -&gt; [NormalizedQuery] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621687618924"><span class="annot"><span class="annottext">NormalizedQuery
</span><a href="#local-6989586621687618924"><span class="hs-identifier hs-var">nqCode</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NormalizedQuery -&gt; ExecutableDocument Name
</span><a href="Hasura.RQL.Types.Allowlist.html#unNormalizedQuery"><span class="hs-identifier hs-var">unNormalizedQuery</span></a></span><span> </span><span class="annot"><span class="annottext">NormalizedQuery
</span><a href="#local-6989586621687618924"><span class="hs-identifier hs-var">nqCode</span></a></span><span> </span><span class="annot"><span class="annottext">ExecutableDocument Name -&gt; ExecutableDocument Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GQLQuery -&gt; ExecutableDocument Name
</span><a href="Hasura.RQL.Types.QueryCollection.html#unGQLQuery"><span class="hs-identifier hs-var">unGQLQuery</span></a></span><span> </span><span class="annot"><span class="annottext">(GQLQuery -&gt; ExecutableDocument Name)
-&gt; (GQLQueryWithText -&gt; GQLQuery)
-&gt; GQLQueryWithText
-&gt; ExecutableDocument Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GQLQueryWithText -&gt; GQLQuery
</span><a href="Hasura.RQL.Types.QueryCollection.html#getGQLQuery"><span class="hs-identifier hs-var">getGQLQuery</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GQLQueryWithText
</span><a href="#local-6989586621687618921"><span class="hs-identifier hs-var">_lqQuery</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NormalizedQuery]
</span><a href="#local-6989586621687618918"><span class="hs-identifier hs-var">nativeQueryList</span></a></span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span>    </span><span class="annot"><a href="#local-6989586621687618925"><span class="hs-identifier hs-type">inRESTEndpoints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointTrie"><span class="hs-identifier hs-type">EndpointTrie</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#GQLQueryWithText"><span class="hs-identifier hs-type">GQLQueryWithText</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#ListedQuery"><span class="hs-identifier hs-type">ListedQuery</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-d0f6d61f5277bae932134563876cbceb4967915f364959864c72abbc2978d8ed/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-482"></span><span>    </span><span id="local-6989586621687618925"><span class="annot"><span class="annottext">inRESTEndpoints :: EndpointTrie GQLQueryWithText -&gt; ListedQuery -&gt; [Text]
</span><a href="#local-6989586621687618925"><span class="hs-identifier hs-var hs-var">inRESTEndpoints</span></a></span></span><span> </span><span id="local-6989586621687618926"><span class="annot"><span class="annottext">EndpointTrie GQLQueryWithText
</span><a href="#local-6989586621687618926"><span class="hs-identifier hs-var">edTrie</span></a></span></span><span> </span><span id="local-6989586621687618927"><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621687618927"><span class="hs-identifier hs-var">lq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Text, GQLQueryWithText) -&gt; Text)
-&gt; [(Text, GQLQueryWithText)] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Text, GQLQueryWithText) -&gt; Text
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">([(Text, GQLQueryWithText)] -&gt; [Text])
-&gt; [(Text, GQLQueryWithText)] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Text, GQLQueryWithText) -&gt; Bool)
-&gt; [(Text, GQLQueryWithText)] -&gt; [(Text, GQLQueryWithText)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text, GQLQueryWithText) -&gt; Bool
</span><a href="#local-6989586621687618929"><span class="hs-identifier hs-var">queryIsFaulty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Text, GQLQueryWithText)]
</span><a href="#local-6989586621687618930"><span class="hs-identifier hs-var">allQueries</span></a></span><span>
</span><span id="line-483"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-484"></span><span>        </span><span id="local-6989586621687618931"><span class="annot"><span class="annottext">methodMaps :: [MultiMap EndpointMethod (EndpointMetadata GQLQueryWithText)]
</span><a href="#local-6989586621687618931"><span class="hs-identifier hs-var hs-var">methodMaps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EndpointTrie GQLQueryWithText
-&gt; [MultiMap EndpointMethod (EndpointMetadata GQLQueryWithText)]
forall k v. Trie k v -&gt; [v]
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Trie.html#elems"><span class="hs-identifier hs-var">Trie.elems</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointTrie GQLQueryWithText
</span><a href="#local-6989586621687618926"><span class="hs-identifier hs-var">edTrie</span></a></span><span>
</span><span id="line-485"></span><span>        </span><span id="local-6989586621687618933"><span class="annot"><span class="annottext">endpoints :: [EndpointMetadata GQLQueryWithText]
</span><a href="#local-6989586621687618933"><span class="hs-identifier hs-var hs-var">endpoints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((EndpointMethod, [EndpointMetadata GQLQueryWithText])
 -&gt; [EndpointMetadata GQLQueryWithText])
-&gt; [(EndpointMethod, [EndpointMetadata GQLQueryWithText])]
-&gt; [EndpointMetadata GQLQueryWithText]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(EndpointMethod, [EndpointMetadata GQLQueryWithText])
-&gt; [EndpointMetadata GQLQueryWithText]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(EndpointMethod, [EndpointMetadata GQLQueryWithText])]
 -&gt; [EndpointMetadata GQLQueryWithText])
-&gt; [(EndpointMethod, [EndpointMetadata GQLQueryWithText])]
-&gt; [EndpointMetadata GQLQueryWithText]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(MultiMap EndpointMethod (EndpointMetadata GQLQueryWithText)
 -&gt; [(EndpointMethod, [EndpointMetadata GQLQueryWithText])])
-&gt; [MultiMap EndpointMethod (EndpointMetadata GQLQueryWithText)]
-&gt; [(EndpointMethod, [EndpointMetadata GQLQueryWithText])]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MultiMap EndpointMethod (EndpointMetadata GQLQueryWithText)
-&gt; [(EndpointMethod, [EndpointMetadata GQLQueryWithText])]
forall k v. MultiMap k v -&gt; [(k, [v])]
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.HashMap.Strict.Multi.html#toList"><span class="hs-identifier hs-var">MultiMap.toList</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[MultiMap EndpointMethod (EndpointMetadata GQLQueryWithText)]
</span><a href="#local-6989586621687618931"><span class="hs-identifier hs-var">methodMaps</span></a></span><span>
</span><span id="line-486"></span><span>        </span><span class="annot"><a href="#local-6989586621687618930"><span class="hs-identifier hs-type">allQueries</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-d0f6d61f5277bae932134563876cbceb4967915f364959864c72abbc2978d8ed/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#GQLQueryWithText"><span class="hs-identifier hs-type">GQLQueryWithText</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-487"></span><span>        </span><span id="local-6989586621687618930"><span class="annot"><span class="annottext">allQueries :: [(Text, GQLQueryWithText)]
</span><a href="#local-6989586621687618930"><span class="hs-identifier hs-var hs-var">allQueries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EndpointMetadata GQLQueryWithText -&gt; (Text, GQLQueryWithText))
-&gt; [EndpointMetadata GQLQueryWithText]
-&gt; [(Text, GQLQueryWithText)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621687618936"><span class="annot"><span class="annottext">EndpointMetadata GQLQueryWithText
</span><a href="#local-6989586621687618936"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmptyText -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.NonEmpty.html#unNonEmptyText"><span class="hs-identifier hs-var">unNonEmptyText</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmptyText -&gt; Text)
-&gt; (EndpointMetadata GQLQueryWithText -&gt; NonEmptyText)
-&gt; EndpointMetadata GQLQueryWithText
-&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EndpointName -&gt; NonEmptyText
</span><a href="Hasura.RQL.Types.Endpoint.html#unEndpointName"><span class="hs-identifier hs-var">unEndpointName</span></a></span><span> </span><span class="annot"><span class="annottext">(EndpointName -&gt; NonEmptyText)
-&gt; (EndpointMetadata GQLQueryWithText -&gt; EndpointName)
-&gt; EndpointMetadata GQLQueryWithText
-&gt; NonEmptyText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata GQLQueryWithText -&gt; EndpointName
forall query. EndpointMetadata query -&gt; EndpointName
</span><a href="Hasura.RQL.Types.Endpoint.html#_ceName"><span class="hs-identifier hs-var">_ceName</span></a></span><span> </span><span class="annot"><span class="annottext">(EndpointMetadata GQLQueryWithText -&gt; Text)
-&gt; EndpointMetadata GQLQueryWithText -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata GQLQueryWithText
</span><a href="#local-6989586621687618936"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EndpointDef GQLQueryWithText -&gt; GQLQueryWithText
forall query. EndpointDef query -&gt; query
</span><a href="Hasura.RQL.Types.Endpoint.html#_edQuery"><span class="hs-identifier hs-var">_edQuery</span></a></span><span> </span><span class="annot"><span class="annottext">(EndpointDef GQLQueryWithText -&gt; GQLQueryWithText)
-&gt; (EndpointMetadata GQLQueryWithText
    -&gt; EndpointDef GQLQueryWithText)
-&gt; EndpointMetadata GQLQueryWithText
-&gt; GQLQueryWithText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata GQLQueryWithText -&gt; EndpointDef GQLQueryWithText
forall query. EndpointMetadata query -&gt; EndpointDef query
</span><a href="Hasura.RQL.Types.Endpoint.html#_ceDefinition"><span class="hs-identifier hs-var">_ceDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">(EndpointMetadata GQLQueryWithText -&gt; GQLQueryWithText)
-&gt; EndpointMetadata GQLQueryWithText -&gt; GQLQueryWithText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata GQLQueryWithText
</span><a href="#local-6989586621687618936"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[EndpointMetadata GQLQueryWithText]
</span><a href="#local-6989586621687618933"><span class="hs-identifier hs-var">endpoints</span></a></span><span>
</span><span id="line-488"></span><span>
</span><span id="line-489"></span><span>        </span><span class="annot"><a href="#local-6989586621687618929"><span class="hs-identifier hs-type">queryIsFaulty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-d0f6d61f5277bae932134563876cbceb4967915f364959864c72abbc2978d8ed/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#GQLQueryWithText"><span class="hs-identifier hs-type">GQLQueryWithText</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-490"></span><span>        </span><span id="local-6989586621687618929"><span class="annot"><span class="annottext">queryIsFaulty :: (Text, GQLQueryWithText) -&gt; Bool
</span><a href="#local-6989586621687618929"><span class="hs-identifier hs-var hs-var">queryIsFaulty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687618941"><span class="annot"><span class="annottext">GQLQueryWithText
</span><a href="#local-6989586621687618941"><span class="hs-identifier hs-var">gqlQ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ListedQuery -&gt; GQLQueryWithText
</span><a href="Hasura.RQL.Types.QueryCollection.html#_lqQuery"><span class="hs-identifier hs-var">_lqQuery</span></a></span><span> </span><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621687618927"><span class="hs-identifier hs-var">lq</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GQLQueryWithText -&gt; GQLQueryWithText -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GQLQueryWithText
</span><a href="#local-6989586621687618941"><span class="hs-identifier hs-var">gqlQ</span></a></span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span>    </span><span id="local-6989586621687618905"><span class="annot"><span class="annottext">lqLst :: [((CollectionName, ListedQuery), [ExecutableDefinition Name])]
</span><a href="#local-6989586621687618905"><span class="hs-identifier hs-var hs-var">lqLst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((CollectionName, CreateCollection)
 -&gt; [((CollectionName, ListedQuery), [ExecutableDefinition Name])])
-&gt; [(CollectionName, CreateCollection)]
-&gt; [((CollectionName, ListedQuery), [ExecutableDefinition Name])]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(CollectionName, CreateCollection)
-&gt; [((CollectionName, ListedQuery), [ExecutableDefinition Name])]
</span><a href="#local-6989586621687618906"><span class="hs-identifier hs-var">zipLQwithDef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QueryCollections -&gt; [(CollectionName, CreateCollection)]
forall k v. InsOrdHashMap k v -&gt; [(k, v)]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/insert-ordered-containers-0.2.5.1-b5ad8e22c80bc291a2f581fb78a4448e46180aa38110e81c957f693abd1dc222/share/doc/html/src/Data.HashMap.Strict.InsOrd.html#toList"><span class="hs-identifier hs-var">InsOrdHashMap.toList</span></a></span><span> </span><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621687618896"><span class="hs-identifier hs-var">qcs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>
</span><span id="line-494"></span><span>    </span><span class="annot"><a href="#local-6989586621687618943"><span class="hs-identifier hs-type">formatError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#CollectionName"><span class="hs-identifier hs-type">CollectionName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#ListedQuery"><span class="hs-identifier hs-type">ListedQuery</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-d0f6d61f5277bae932134563876cbceb4967915f364959864c72abbc2978d8ed/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-d0f6d61f5277bae932134563876cbceb4967915f364959864c72abbc2978d8ed/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-495"></span><span>    </span><span id="local-6989586621687618943"><span class="annot"><span class="annottext">formatError :: (CollectionName, ListedQuery) -&gt; [Text] -&gt; Text
</span><a href="#local-6989586621687618943"><span class="hs-identifier hs-var hs-var">formatError</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687618944"><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621687618944"><span class="hs-identifier hs-var">cName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687618945"><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621687618945"><span class="hs-identifier hs-var">lq</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621687618946"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621687618946"><span class="hs-identifier hs-var">allErrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687618947"><span class="hs-identifier hs-var">msgInit</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="#local-6989586621687618948"><span class="hs-identifier hs-var">lToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621687618946"><span class="hs-identifier hs-var">allErrs</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687618949"><span class="hs-identifier hs-var">faultyEndpoints</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687618950"><span class="hs-identifier hs-var">isInAllowList</span></a></span><span>
</span><span id="line-496"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-497"></span><span>        </span><span id="local-6989586621687618947"><span class="annot"><span class="annottext">msgInit :: Text
</span><a href="#local-6989586621687618947"><span class="hs-identifier hs-var hs-var">msgInit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;In query collection \&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">CollectionName -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621687618944"><span class="hs-identifier hs-var">cName</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\&quot; the query \&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QueryName -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">(QueryName -&gt; Text)
-&gt; (ListedQuery -&gt; QueryName) -&gt; ListedQuery -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ListedQuery -&gt; QueryName
</span><a href="Hasura.RQL.Types.QueryCollection.html#_lqName"><span class="hs-identifier hs-var">_lqName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621687618945"><span class="hs-identifier hs-var">lq</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\&quot; is invalid with the following error(s): &quot;</span></span><span>
</span><span id="line-498"></span><span>        </span><span id="local-6989586621687618948"><span class="annot"><span class="annottext">lToTxt :: [Text] -&gt; Text
</span><a href="#local-6989586621687618948"><span class="hs-identifier hs-var hs-var">lToTxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall t (f :: * -&gt; *). (ToTxt t, Foldable f) =&gt; f t -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#dquoteList"><span class="hs-identifier hs-var">dquoteList</span></a></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; ([Text] -&gt; [Text]) -&gt; [Text] -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span>
</span><span id="line-499"></span><span>        </span><span id="local-6989586621687618949"><span class="annot"><span class="annottext">faultyEndpoints :: Text
</span><a href="#local-6989586621687618949"><span class="hs-identifier hs-var hs-var">faultyEndpoints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EndpointTrie GQLQueryWithText -&gt; ListedQuery -&gt; [Text]
</span><a href="#local-6989586621687618925"><span class="hs-identifier hs-var">inRESTEndpoints</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointTrie GQLQueryWithText
</span><a href="#local-6989586621687618898"><span class="hs-identifier hs-var">restEndpoints</span></a></span><span> </span><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621687618945"><span class="hs-identifier hs-var">lq</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-500"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-501"></span><span>          </span><span id="local-6989586621687618956"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621687618956"><span class="hs-identifier hs-var">ePoints</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;. This query is being used in the following REST endpoint(s): &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="#local-6989586621687618948"><span class="hs-identifier hs-var">lToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621687618956"><span class="hs-identifier hs-var">ePoints</span></a></span><span>
</span><span id="line-502"></span><span>
</span><span id="line-503"></span><span>        </span><span id="local-6989586621687618950"><span class="annot"><span class="annottext">isInAllowList :: Text
</span><a href="#local-6989586621687618950"><span class="hs-identifier hs-var hs-var">isInAllowList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[NormalizedQuery] -&gt; ListedQuery -&gt; Bool
</span><a href="#local-6989586621687618917"><span class="hs-identifier hs-var">inAllowList</span></a></span><span> </span><span class="annot"><span class="annottext">[NormalizedQuery]
</span><a href="#local-6989586621687618899"><span class="hs-identifier hs-var">allowLst</span></a></span><span> </span><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621687618945"><span class="hs-identifier hs-var">lq</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;. This query is in allowlist.&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span>    </span><span id="local-6989586621687618904"><span class="annot"><span class="annottext">validateQuery :: ((CollectionName, ListedQuery), [ExecutableDefinition Name])
-&gt; Either (MetadataObject, Text) ()
</span><a href="#local-6989586621687618904"><span class="hs-identifier hs-var hs-var">validateQuery</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687618957"><span class="annot"><span class="annottext">(CollectionName, ListedQuery)
</span><a href="#local-6989586621687618957"><span class="hs-identifier hs-var">eMeta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687618958"><span class="annot"><span class="annottext">[ExecutableDefinition Name]
</span><a href="#local-6989586621687618958"><span class="hs-identifier hs-var">eDefs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-506"></span><span>      </span><span class="hs-comment">-- create the gql request object</span><span>
</span><span id="line-507"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687618959"><span class="annot"><span class="annottext">gqlRequest :: GQLReq GQLExecDoc
</span><a href="#local-6989586621687618959"><span class="hs-identifier hs-var hs-var">gqlRequest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe OperationName
-&gt; GQLExecDoc -&gt; Maybe VariableValues -&gt; GQLReq GQLExecDoc
forall a.
Maybe OperationName -&gt; a -&gt; Maybe VariableValues -&gt; GQLReq a
</span><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLReq"><span class="hs-identifier hs-var">GQLReq</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe OperationName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ExecutableDefinition Name] -&gt; GQLExecDoc
</span><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLExecDoc"><span class="hs-identifier hs-var">GQLExecDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[ExecutableDefinition Name]
</span><a href="#local-6989586621687618958"><span class="hs-identifier hs-var">eDefs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe VariableValues
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span>      </span><span class="hs-comment">-- @getSingleOperation@ will do the fragment inlining</span><span>
</span><span id="line-510"></span><span>      </span><span id="local-6989586621687618962"><span class="annot"><span class="annottext">SingleOperation
</span><a href="#local-6989586621687618962"><span class="hs-identifier hs-var">singleOperation</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GQLReq GQLExecDoc -&gt; Either QErr SingleOperation
forall (m :: * -&gt; *).
MonadError QErr m =&gt;
GQLReq GQLExecDoc -&gt; m SingleOperation
</span><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#getSingleOperation"><span class="hs-identifier hs-var">getSingleOperation</span></a></span><span> </span><span class="annot"><span class="annottext">GQLReq GQLExecDoc
</span><a href="#local-6989586621687618959"><span class="hs-identifier hs-var">gqlRequest</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-511"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621687618964"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687618964"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(MetadataObject, Text)
-&gt; Either (MetadataObject, Text) SingleOperation
forall a. (MetadataObject, Text) -&gt; Either (MetadataObject, Text) a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CollectionName, ListedQuery) -&gt; MetadataObject
</span><a href="#local-6989586621687618897"><span class="hs-identifier hs-var">lqToMetadataObj</span></a></span><span> </span><span class="annot"><span class="annottext">(CollectionName, ListedQuery)
</span><a href="#local-6989586621687618957"><span class="hs-identifier hs-var">eMeta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(CollectionName, ListedQuery) -&gt; [Text] -&gt; Text
</span><a href="#local-6989586621687618943"><span class="hs-identifier hs-var">formatError</span></a></span><span> </span><span class="annot"><span class="annottext">(CollectionName, ListedQuery)
</span><a href="#local-6989586621687618957"><span class="hs-identifier hs-var">eMeta</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QErr -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#qeError"><span class="hs-identifier hs-var">qeError</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687618964"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-512"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621687618965"><span class="annot"><span class="annottext">SingleOperation
</span><a href="#local-6989586621687618965"><span class="hs-identifier hs-var">singleOp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SingleOperation -&gt; Either (MetadataObject, Text) SingleOperation
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">SingleOperation
</span><a href="#local-6989586621687618965"><span class="hs-identifier hs-var">singleOp</span></a></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span>      </span><span class="hs-comment">-- perform the validation</span><span>
</span><span id="line-515"></span><span>      </span><span class="annot"><span class="annottext">Maybe [Text]
-&gt; ([Text] -&gt; Either (MetadataObject, Text) Any)
-&gt; Either (MetadataObject, Text) ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaIntrospection -&gt; SingleOperation -&gt; Maybe [Text]
</span><a href="Hasura.GraphQL.Analyse.html#diagnoseGraphQLQuery"><span class="hs-identifier hs-var">diagnoseGraphQLQuery</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaIntrospection
</span><a href="#local-6989586621687618895"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">SingleOperation
</span><a href="#local-6989586621687618962"><span class="hs-identifier hs-var">singleOperation</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687618967"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621687618967"><span class="hs-identifier hs-var">errors</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-516"></span><span>        </span><span class="annot"><span class="annottext">(MetadataObject, Text) -&gt; Either (MetadataObject, Text) Any
forall a. (MetadataObject, Text) -&gt; Either (MetadataObject, Text) a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CollectionName, ListedQuery) -&gt; MetadataObject
</span><a href="#local-6989586621687618897"><span class="hs-identifier hs-var">lqToMetadataObj</span></a></span><span> </span><span class="annot"><span class="annottext">(CollectionName, ListedQuery)
</span><a href="#local-6989586621687618957"><span class="hs-identifier hs-var">eMeta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(CollectionName, ListedQuery) -&gt; [Text] -&gt; Text
</span><a href="#local-6989586621687618943"><span class="hs-identifier hs-var">formatError</span></a></span><span> </span><span class="annot"><span class="annottext">(CollectionName, ListedQuery)
</span><a href="#local-6989586621687618957"><span class="hs-identifier hs-var">eMeta</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621687618967"><span class="hs-identifier hs-var">errors</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span class="hs-keyword">data</span><span> </span><span id="StoredIntrospection"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#StoredIntrospection"><span class="hs-identifier hs-var">StoredIntrospection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="StoredIntrospection"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#StoredIntrospection"><span class="hs-identifier hs-var">StoredIntrospection</span></a></span></span><span>
</span><span id="line-519"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Just catalog introspection - not including enums</span><span>
</span><span id="line-520"></span><span>    </span><span id="siBackendIntrospection"><span class="annot"><span class="annottext">StoredIntrospection -&gt; HashMap SourceName EncJSON
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#siBackendIntrospection"><span class="hs-identifier hs-var hs-var">siBackendIntrospection</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-521"></span><span>    </span><span id="siRemotes"><span class="annot"><span class="annottext">StoredIntrospection -&gt; HashMap RemoteSchemaName EncJSON
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#siRemotes"><span class="hs-identifier hs-var hs-var">siRemotes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RemoteSchema.Metadata.Base.html#RemoteSchemaName"><span class="hs-identifier hs-type">RemoteSchemaName</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span>
</span><span id="line-522"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-523"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687618972"><span id="local-6989586621687618974"><span class="annot"><span class="annottext">(forall x. StoredIntrospection -&gt; Rep StoredIntrospection x)
-&gt; (forall x. Rep StoredIntrospection x -&gt; StoredIntrospection)
-&gt; Generic StoredIntrospection
forall x. Rep StoredIntrospection x -&gt; StoredIntrospection
forall x. StoredIntrospection -&gt; Rep StoredIntrospection x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. StoredIntrospection -&gt; Rep StoredIntrospection x
from :: forall x. StoredIntrospection -&gt; Rep StoredIntrospection x
$cto :: forall x. Rep StoredIntrospection x -&gt; StoredIntrospection
to :: forall x. Rep StoredIntrospection x -&gt; StoredIntrospection
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span class="hs-comment">-- Note that we don't want to introduce an `Eq EncJSON` instance, as this is a</span><span>
</span><span id="line-526"></span><span class="hs-comment">-- bit of a footgun. But for Stored Introspection purposes, it's fine: the</span><span>
</span><span id="line-527"></span><span class="hs-comment">-- worst-case effect of a semantically inaccurate `Eq` instance is that we</span><span>
</span><span id="line-528"></span><span class="hs-comment">-- rebuild the Schema Cache too often.</span><span>
</span><span id="line-529"></span><span class="hs-comment">--</span><span>
</span><span id="line-530"></span><span class="hs-comment">-- However, this does mean that we have to spell out this instance a bit.</span><span>
</span><span id="line-531"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687618978"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#StoredIntrospection"><span class="hs-identifier hs-type">StoredIntrospection</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-532"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#StoredIntrospection"><span class="hs-identifier hs-type">StoredIntrospection</span></a></span><span> </span><span id="local-6989586621687618992"><span class="annot"><span class="annottext">HashMap SourceName EncJSON
</span><a href="#local-6989586621687618992"><span class="hs-identifier hs-var">bs1</span></a></span></span><span> </span><span id="local-6989586621687618993"><span class="annot"><span class="annottext">HashMap RemoteSchemaName EncJSON
</span><a href="#local-6989586621687618993"><span class="hs-identifier hs-var">rs1</span></a></span></span><span> </span><span id="local-6989586621687618994"><span class="annot"><span class="annottext">== :: StoredIntrospection -&gt; StoredIntrospection -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#StoredIntrospection"><span class="hs-identifier hs-type">StoredIntrospection</span></a></span><span> </span><span id="local-6989586621687618995"><span class="annot"><span class="annottext">HashMap SourceName EncJSON
</span><a href="#local-6989586621687618995"><span class="hs-identifier hs-var">bs2</span></a></span></span><span> </span><span id="local-6989586621687618996"><span class="annot"><span class="annottext">HashMap RemoteSchemaName EncJSON
</span><a href="#local-6989586621687618996"><span class="hs-identifier hs-var">rs2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-533"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EncJSON -&gt; ByteString
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#encJToLBS"><span class="hs-identifier hs-var">encJToLBS</span></a></span><span> </span><span class="annot"><span class="annottext">(EncJSON -&gt; ByteString)
-&gt; HashMap SourceName EncJSON -&gt; HashMap SourceName ByteString
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashMap SourceName EncJSON
</span><a href="#local-6989586621687618992"><span class="hs-identifier hs-var">bs1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap SourceName ByteString
-&gt; HashMap SourceName ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EncJSON -&gt; ByteString
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#encJToLBS"><span class="hs-identifier hs-var">encJToLBS</span></a></span><span> </span><span class="annot"><span class="annottext">(EncJSON -&gt; ByteString)
-&gt; HashMap SourceName EncJSON -&gt; HashMap SourceName ByteString
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashMap SourceName EncJSON
</span><a href="#local-6989586621687618995"><span class="hs-identifier hs-var">bs2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EncJSON -&gt; ByteString
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#encJToLBS"><span class="hs-identifier hs-var">encJToLBS</span></a></span><span> </span><span class="annot"><span class="annottext">(EncJSON -&gt; ByteString)
-&gt; HashMap RemoteSchemaName EncJSON
-&gt; HashMap RemoteSchemaName ByteString
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashMap RemoteSchemaName EncJSON
</span><a href="#local-6989586621687618993"><span class="hs-identifier hs-var">rs1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap RemoteSchemaName ByteString
-&gt; HashMap RemoteSchemaName ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EncJSON -&gt; ByteString
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#encJToLBS"><span class="hs-identifier hs-var">encJToLBS</span></a></span><span> </span><span class="annot"><span class="annottext">(EncJSON -&gt; ByteString)
-&gt; HashMap RemoteSchemaName EncJSON
-&gt; HashMap RemoteSchemaName ByteString
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashMap RemoteSchemaName EncJSON
</span><a href="#local-6989586621687618996"><span class="hs-identifier hs-var">rs2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687619001"><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.FromJSON.html#FromJSON"><span class="hs-identifier hs-type">FromJSON</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#StoredIntrospection"><span class="hs-identifier hs-type">StoredIntrospection</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-536"></span><span>  </span><span id="local-6989586621687619066"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser StoredIntrospection
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.FromJSON.html#parseJSON"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Options -&gt; Value -&gt; Parser StoredIntrospection
forall a.
(Generic a, GFromJSON Zero (Rep a)) =&gt;
Options -&gt; Value -&gt; Parser a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.FromJSON.html#genericParseJSON"><span class="hs-identifier hs-var">genericParseJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Options
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#hasuraJSON"><span class="hs-identifier hs-var">hasuraJSON</span></a></span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687619069"><span id="local-6989586621687619073"><span id="local-6989586621687619076"><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#ToJSON"><span class="hs-identifier hs-type">ToJSON</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#StoredIntrospection"><span class="hs-identifier hs-type">StoredIntrospection</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-539"></span><span>  </span><span id="local-6989586621687619147"><span class="annot"><span class="annottext">toJSON :: StoredIntrospection -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Options -&gt; StoredIntrospection -&gt; Value
forall a.
(Generic a, GToJSON' Value Zero (Rep a)) =&gt;
Options -&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#genericToJSON"><span class="hs-identifier hs-var">genericToJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Options
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#hasuraJSON"><span class="hs-identifier hs-var">hasuraJSON</span></a></span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span class="annot"><span class="hs-comment">-- | Represents remote schema or source introspection data to be persisted in a storage (database).</span></span><span>
</span><span id="line-542"></span><span class="hs-keyword">data</span><span> </span><span id="StoredIntrospectionItem"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#StoredIntrospectionItem"><span class="hs-identifier hs-var">StoredIntrospectionItem</span></a></span></span><span>
</span><span id="line-543"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="SourceIntrospectionItem"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#SourceIntrospectionItem"><span class="hs-identifier hs-var">SourceIntrospectionItem</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span>
</span><span id="line-544"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="RemoteSchemaIntrospectionItem"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#RemoteSchemaIntrospectionItem"><span class="hs-identifier hs-var">RemoteSchemaIntrospectionItem</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RemoteSchema.Metadata.Base.html#RemoteSchemaName"><span class="hs-identifier hs-type">RemoteSchemaName</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span>
</span><span id="line-545"></span><span>
</span><span id="line-546"></span><span class="hs-comment">-- The same comment as above for `Eq StoredIntrospection` applies here as well: our refusal to have an `Eq EncJSON` instance means that we can't `stock`-derive this instance.</span><span>
</span><span id="line-547"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687619152"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#StoredIntrospectionItem"><span class="hs-identifier hs-type">StoredIntrospectionItem</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-548"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#SourceIntrospectionItem"><span class="hs-identifier hs-type">SourceIntrospectionItem</span></a></span><span> </span><span id="local-6989586621687619159"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687619159"><span class="hs-identifier hs-var">lSource</span></a></span></span><span> </span><span id="local-6989586621687619160"><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687619160"><span class="hs-identifier hs-var">lIntrospection</span></a></span></span><span> </span><span id="local-6989586621687619161"><span class="annot"><span class="annottext">== :: StoredIntrospectionItem -&gt; StoredIntrospectionItem -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#SourceIntrospectionItem"><span class="hs-identifier hs-type">SourceIntrospectionItem</span></a></span><span> </span><span id="local-6989586621687619162"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687619162"><span class="hs-identifier hs-var">rSource</span></a></span></span><span> </span><span id="local-6989586621687619163"><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687619163"><span class="hs-identifier hs-var">rIntrospection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-549"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687619159"><span class="hs-identifier hs-var">lSource</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; SourceName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687619162"><span class="hs-identifier hs-var">rSource</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EncJSON -&gt; ByteString
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#encJToLBS"><span class="hs-identifier hs-var">encJToLBS</span></a></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687619160"><span class="hs-identifier hs-var">lIntrospection</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EncJSON -&gt; ByteString
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#encJToLBS"><span class="hs-identifier hs-var">encJToLBS</span></a></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687619163"><span class="hs-identifier hs-var">rIntrospection</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-550"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#RemoteSchemaIntrospectionItem"><span class="hs-identifier hs-type">RemoteSchemaIntrospectionItem</span></a></span><span> </span><span id="local-6989586621687619164"><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621687619164"><span class="hs-identifier hs-var">lRemoteSchema</span></a></span></span><span> </span><span id="local-6989586621687619165"><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687619165"><span class="hs-identifier hs-var">lIntrospection</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#RemoteSchemaIntrospectionItem"><span class="hs-identifier hs-type">RemoteSchemaIntrospectionItem</span></a></span><span> </span><span id="local-6989586621687619166"><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621687619166"><span class="hs-identifier hs-var">rRemoteSchema</span></a></span></span><span> </span><span id="local-6989586621687619167"><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687619167"><span class="hs-identifier hs-var">rIntrospection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-551"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621687619164"><span class="hs-identifier hs-var">lRemoteSchema</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName -&gt; RemoteSchemaName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621687619166"><span class="hs-identifier hs-var">rRemoteSchema</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EncJSON -&gt; ByteString
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#encJToLBS"><span class="hs-identifier hs-var">encJToLBS</span></a></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687619165"><span class="hs-identifier hs-var">lIntrospection</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EncJSON -&gt; ByteString
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#encJToLBS"><span class="hs-identifier hs-var">encJToLBS</span></a></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687619167"><span class="hs-identifier hs-var">rIntrospection</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span>  </span><span class="annot"><span class="annottext">StoredIntrospectionItem
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">StoredIntrospectionItem
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687619169"><span id="local-6989586621687619174"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#StoredIntrospectionItem"><span class="hs-identifier hs-type">StoredIntrospectionItem</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-555"></span><span>  </span><span id="local-6989586621687619183"><span class="annot"><span class="annottext">show :: StoredIntrospectionItem -&gt; String
</span><a href="#local-6989586621687619183"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-556"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#SourceIntrospectionItem"><span class="hs-identifier hs-type">SourceIntrospectionItem</span></a></span><span> </span><span id="local-6989586621687619185"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687619185"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;introspection data of source &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687619185"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-557"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#RemoteSchemaIntrospectionItem"><span class="hs-identifier hs-type">RemoteSchemaIntrospectionItem</span></a></span><span> </span><span id="local-6989586621687619186"><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621687619186"><span class="hs-identifier hs-var">remoteSchemaName</span></a></span></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;introspection data of source &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621687619186"><span class="hs-identifier hs-var">remoteSchemaName</span></a></span><span>
</span><span id="line-558"></span><span>
</span><span id="line-559"></span><span class="hs-comment">-- | Items to be collected while building schema cache</span><span>
</span><span id="line-560"></span><span class="hs-comment">-- See @'buildSchemaCacheRule' for more details.</span><span>
</span><span id="line-561"></span><span class="hs-keyword">data</span><span> </span><span id="CollectItem"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectItem"><span class="hs-identifier hs-var">CollectItem</span></a></span></span><span>
</span><span id="line-562"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="CollectInconsistentMetadata"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectInconsistentMetadata"><span class="hs-identifier hs-var">CollectInconsistentMetadata</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span>
</span><span id="line-563"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CollectMetadataDependency"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectMetadataDependency"><span class="hs-identifier hs-var">CollectMetadataDependency</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataDependency"><span class="hs-identifier hs-type">MetadataDependency</span></a></span><span>
</span><span id="line-564"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CollectStoredIntrospection"><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CollectStoredIntrospection"><span class="hs-identifier hs-var">CollectStoredIntrospection</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#StoredIntrospectionItem"><span class="hs-identifier hs-type">StoredIntrospectionItem</span></a></span><span>
</span><span id="line-565"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687619189"><span id="local-6989586621687619198"><span id="local-6989586621687619202"><span class="annot"><span class="annottext">Int -&gt; CollectItem -&gt; ShowS
[CollectItem] -&gt; ShowS
CollectItem -&gt; String
(Int -&gt; CollectItem -&gt; ShowS)
-&gt; (CollectItem -&gt; String)
-&gt; ([CollectItem] -&gt; ShowS)
-&gt; Show CollectItem
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; CollectItem -&gt; ShowS
showsPrec :: Int -&gt; CollectItem -&gt; ShowS
$cshow :: CollectItem -&gt; String
show :: CollectItem -&gt; String
$cshowList :: [CollectItem] -&gt; ShowS
showList :: [CollectItem] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687619205"><span id="local-6989586621687619210"><span class="annot"><span class="annottext">CollectItem -&gt; CollectItem -&gt; Bool
(CollectItem -&gt; CollectItem -&gt; Bool)
-&gt; (CollectItem -&gt; CollectItem -&gt; Bool) -&gt; Eq CollectItem
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: CollectItem -&gt; CollectItem -&gt; Bool
== :: CollectItem -&gt; CollectItem -&gt; Bool
$c/= :: CollectItem -&gt; CollectItem -&gt; Bool
/= :: CollectItem -&gt; CollectItem -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-566"></span></pre></body></html>