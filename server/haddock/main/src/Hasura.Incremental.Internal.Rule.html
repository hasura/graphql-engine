<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# OPTIONS_HADDOCK not-home #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">-- | Defines the basic 'Rule' datatype and its core operations.</span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.Incremental.Internal.Rule</span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#ArrowDistribute"><span class="hs-identifier">ArrowDistribute</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Result"><span class="hs-identifier">Result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rebuildRule"><span class="hs-identifier">rebuildRule</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#result"><span class="hs-identifier">result</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier">Rule</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#build"><span class="hs-identifier">build</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rebuild"><span class="hs-identifier">rebuild</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">where</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html"><span class="hs-identifier">Control.Arrow.Extended</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Category</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Profunctor</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Tuple</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">swap</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Dependency.html"><span class="hs-identifier">Hasura.Incremental.Internal.Dependency</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier">Hasura.Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">id</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.)</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-comment">-- | A value of type @'Rule' m a b@ is a /build rule/: a computation that describes how to build a</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- value of type @b@ from a value of type @a@ in a monad @m@. What distinguishes @'Rule' m a b@ from</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- an ordinary function of type @a -&gt; m b@ is that it can be made /incremental/ (in the sense of</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- &#8220;incremental compilation&#8221;)&#8212;after executing it, future executions can perform a subset of the</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- required work if only a portion of the input changed.</span><span>
</span><span id="line-28"></span><span class="hs-comment">--</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- To achieve this, 'Rule's have a more restrictive interface: there is no @Monad ('Rule' m a)@</span><span>
</span><span id="line-30"></span><span class="hs-comment">-- instance, for example. Instead, 'Rule's are composed using the 'Arrow' hierarchy of operations,</span><span>
</span><span id="line-31"></span><span class="hs-comment">-- which ensures that the dependency graph of build rules is mostly static (though it may contain</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- conditional branches, and combinators such as 'keyed' can express restricted forms of dynamic</span><span>
</span><span id="line-33"></span><span class="hs-comment">-- dependencies). Each atomic rule may be defined using the 'Monad' instance for @m@, but</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- incrementalization is not supported inside those rules &#8212; they are treated as a single, monolithic</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- computation.</span><span>
</span><span id="line-36"></span><span class="hs-comment">--</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- Atomic rules are created with the 'arrM' function, and caching can be added to a rule using the</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- 'cache' combinator. Rules can be executed using the 'build' function, which returns a 'Result'. A</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- 'Result' contains the built value, accessible via 'result', but it also allows supplying a new</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- input value using 'rebuild' to produce a new result incrementally.</span><span>
</span><span id="line-41"></span><span class="hs-keyword">newtype</span><span> </span><span id="Rule"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-var">Rule</span></a></span></span><span> </span><span id="local-6989586621689655902"><span class="annot"><a href="#local-6989586621689655902"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621689655904"><span class="annot"><a href="#local-6989586621689655904"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621689655903"><span class="annot"><a href="#local-6989586621689655903"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Note: this is a CPS encoding of `Accesses -&gt; a -&gt; m (Result m a b)`. In practice, the CPS</span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-comment">-- encoding seems to provide meaningful performance improvements: it cuts down significantly on</span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-comment">-- allocation and is friendlier to GHC&#8217;s optimizer.</span><span>
</span><span id="line-45"></span><span>    </span><span id="Rule"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-var">Rule</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689655947"><span class="annot"><a href="#local-6989586621689655947"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Dependency.html#Accesses"><span class="hs-identifier hs-type">Accesses</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689655904"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Dependency.html#Accesses"><span class="hs-identifier hs-type">Accesses</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689655903"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655902"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655904"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655903"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689655902"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655947"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689655902"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655947"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span id="local-6989586621689655915"><span id="local-6989586621689655916"><span id="local-6989586621689655917"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#build"><span class="hs-identifier hs-type">build</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621689655917"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655917"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655916"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655915"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689655916"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689655917"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655917"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655916"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655915"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-48"></span><span id="build"><span class="annot"><span class="annottext">build :: Rule m a b -&gt; a -&gt; m (Result m a b)
</span><a href="Hasura.Incremental.Internal.Rule.html#build"><span class="hs-identifier hs-var hs-var">build</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span id="local-6989586621689655570"><span class="annot"><span class="annottext">forall r.
Accesses -&gt; a -&gt; (Accesses -&gt; b -&gt; Rule m a b -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655570"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621689655569"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689655569"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Accesses
-&gt; a
-&gt; (Accesses -&gt; b -&gt; Rule m a b -&gt; m (Result m a b))
-&gt; m (Result m a b)
forall r.
Accesses -&gt; a -&gt; (Accesses -&gt; b -&gt; Rule m a b -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655570"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689655569"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Accesses
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621689655568"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689655568"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621689655567"><span class="annot"><span class="annottext">Rule m a b
</span><a href="#local-6989586621689655567"><span class="hs-identifier hs-var">r'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result m a b -&gt; m (Result m a b)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Result m a b -&gt; m (Result m a b))
-&gt; Result m a b -&gt; m (Result m a b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; Rule m a b -&gt; Result m a b
forall (m :: * -&gt; *) a b. b -&gt; Rule m a b -&gt; Result m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#Result"><span class="hs-identifier hs-var">Result</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689655568"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a b
</span><a href="#local-6989586621689655567"><span class="hs-identifier hs-var">r'</span></a></span><span>
</span><span id="line-49"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#build"><span class="hs-pragma hs-type">build</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-keyword">data</span><span> </span><span id="Result"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Result"><span class="hs-identifier hs-var">Result</span></a></span></span><span> </span><span id="local-6989586621689655939"><span class="annot"><a href="#local-6989586621689655939"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621689655938"><span class="annot"><a href="#local-6989586621689655938"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621689655940"><span class="annot"><a href="#local-6989586621689655940"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Result"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Result"><span class="hs-identifier hs-var">Result</span></a></span></span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="result"><span class="annot"><span class="annottext">Result m a b -&gt; b
</span><a href="Hasura.Incremental.Internal.Rule.html#result"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621689655940"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span id="rebuildRule"><span class="annot"><span class="annottext">Result m a b -&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#rebuildRule"><span class="hs-identifier hs-var hs-var">rebuildRule</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655939"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655938"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655940"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689655562"><span id="local-6989586621689655564"><span class="annot"><span class="annottext">a -&gt; Result m a b -&gt; Result m a a
(a -&gt; b) -&gt; Result m a a -&gt; Result m a b
(forall a b. (a -&gt; b) -&gt; Result m a a -&gt; Result m a b)
-&gt; (forall a b. a -&gt; Result m a b -&gt; Result m a a)
-&gt; Functor (Result m a)
forall a b. a -&gt; Result m a b -&gt; Result m a a
forall a b. (a -&gt; b) -&gt; Result m a a -&gt; Result m a b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
forall (m :: * -&gt; *) a a b. a -&gt; Result m a b -&gt; Result m a a
forall (m :: * -&gt; *) a a b.
(a -&gt; b) -&gt; Result m a a -&gt; Result m a b
&lt;$ :: a -&gt; Result m a b -&gt; Result m a a
$c&lt;$ :: forall (m :: * -&gt; *) a a b. a -&gt; Result m a b -&gt; Result m a a
fmap :: (a -&gt; b) -&gt; Result m a a -&gt; Result m a b
$cfmap :: forall (m :: * -&gt; *) a a b.
(a -&gt; b) -&gt; Result m a a -&gt; Result m a b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span id="local-6989586621689655558"><span id="local-6989586621689655559"><span id="local-6989586621689655560"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rebuild"><span class="hs-identifier hs-type">rebuild</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621689655560"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655560"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655559"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655558"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689655559"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689655560"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655560"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655559"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655558"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-58"></span><span id="rebuild"><span class="annot"><span class="annottext">rebuild :: Result m a b -&gt; a -&gt; m (Result m a b)
</span><a href="Hasura.Incremental.Internal.Rule.html#rebuild"><span class="hs-identifier hs-var hs-var">rebuild</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m a b -&gt; a -&gt; m (Result m a b)
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
Rule m a b -&gt; a -&gt; m (Result m a b)
</span><a href="Hasura.Incremental.Internal.Rule.html#build"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">(Rule m a b -&gt; a -&gt; m (Result m a b))
-&gt; (Result m a b -&gt; Rule m a b)
-&gt; Result m a b
-&gt; a
-&gt; m (Result m a b)
forall k (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Result m a b -&gt; Rule m a b
forall (m :: * -&gt; *) a b. Result m a b -&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#rebuildRule"><span class="hs-identifier hs-var hs-var">rebuildRule</span></a></span><span>
</span><span id="line-59"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rebuild"><span class="hs-pragma hs-type">rebuild</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-comment">{- Note [Rule rewrite rules]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
As explained by Note [Arrow rewrite rules] in Control.Arrow.Extended, it&#8217;s important to define
type-specific rewrite rules to get good performance with arrows when the concrete type is used. This
is especially important for `Rule`, since the recursive definitions of operations like `.` and `arr`
are very difficult for the optimizer to deal with, and the composition of lots of small rules
created with `arr` is very inefficient.

Since GHC aggressively specializes and inlines class methods, the rules cannot be defined on the
class methods themselves. Instead, the class methods expand to auxiliary definitions, and those
definitions include an INLINABLE[0] pragma that ensures they do not inline until the final
optimization phase. The rules are defined in terms of those definitions, so they will be able to do
their work in prior phases.

Note [Desugaring derived operations]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
One subtlety to the above is that we want to define operations in terms of other operations as much
as possible to avoid the need to write an enormous number of rewrite rules, but if we define them
that way directly, then we&#8217;ll end up using needlessly inefficient implementations when the
operations aren&#8217;t specialized. Therefore, we provide efficient implementations of operations like
`second`, but aggressively rewrite them in terms of simpler primitives like `first` when GHC is able
to specialize them. -}</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span id="local-6989586621689655897"><span id="local-6989586621689655898"><span id="local-6989586621689655899"><span id="local-6989586621689655900"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rComp"><span class="hs-identifier hs-type">rComp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655900"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655899"><span class="hs-identifier hs-type">a1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655898"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655900"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655897"><span class="hs-identifier hs-type">a2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655899"><span class="hs-identifier hs-type">a1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655900"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655897"><span class="hs-identifier hs-type">a2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655898"><span class="hs-identifier hs-type">b</span></a></span></span></span></span></span><span>
</span><span id="line-85"></span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span id="local-6989586621689655555"><span class="annot"><span class="annottext">forall r.
Accesses -&gt; a1 -&gt; (Accesses -&gt; b -&gt; Rule m a1 b -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655555"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="rComp"><span class="annot"><span class="annottext">rComp :: Rule m a1 b -&gt; Rule m a2 a1 -&gt; Rule m a2 b
</span><a href="Hasura.Incremental.Internal.Rule.html#rComp"><span class="hs-operator hs-var hs-var">`rComp`</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span id="local-6989586621689655554"><span class="annot"><span class="annottext">forall r.
Accesses -&gt; a2 -&gt; (Accesses -&gt; a1 -&gt; Rule m a2 a1 -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655554"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall r.
 Accesses -&gt; a2 -&gt; (Accesses -&gt; b -&gt; Rule m a2 b -&gt; m r) -&gt; m r)
-&gt; Rule m a2 b
forall (m :: * -&gt; *) a b.
(forall r.
 Accesses -&gt; a -&gt; (Accesses -&gt; b -&gt; Rule m a b -&gt; m r) -&gt; m r)
-&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-var">Rule</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655553"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655553"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621689655552"><span class="annot"><span class="annottext">a2
</span><a href="#local-6989586621689655552"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621689655551"><span class="annot"><span class="annottext">Accesses -&gt; b -&gt; Rule m a2 b -&gt; m r
</span><a href="#local-6989586621689655551"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; a2 -&gt; (Accesses -&gt; a1 -&gt; Rule m a2 a1 -&gt; m r) -&gt; m r
forall r.
Accesses -&gt; a2 -&gt; (Accesses -&gt; a1 -&gt; Rule m a2 a1 -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655554"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655553"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">a2
</span><a href="#local-6989586621689655552"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655550"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655550"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span id="local-6989586621689655549"><span class="annot"><span class="annottext">a1
</span><a href="#local-6989586621689655549"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621689655548"><span class="annot"><span class="annottext">Rule m a2 a1
</span><a href="#local-6989586621689655548"><span class="hs-identifier hs-var">g'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; a1 -&gt; (Accesses -&gt; b -&gt; Rule m a1 b -&gt; m r) -&gt; m r
forall r.
Accesses -&gt; a1 -&gt; (Accesses -&gt; b -&gt; Rule m a1 b -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655555"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655550"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">a1
</span><a href="#local-6989586621689655549"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655547"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655547"><span class="hs-identifier hs-var">s''</span></a></span></span><span> </span><span id="local-6989586621689655546"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689655546"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621689655545"><span class="annot"><span class="annottext">Rule m a1 b
</span><a href="#local-6989586621689655545"><span class="hs-identifier hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; b -&gt; Rule m a2 b -&gt; m r
</span><a href="#local-6989586621689655551"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655547"><span class="hs-identifier hs-var">s''</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689655546"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule m a1 b
</span><a href="#local-6989586621689655545"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a1 b -&gt; Rule m a2 a1 -&gt; Rule m a2 b
forall (m :: * -&gt; *) a1 b a2.
Rule m a1 b -&gt; Rule m a2 a1 -&gt; Rule m a2 b
</span><a href="Hasura.Incremental.Internal.Rule.html#rComp"><span class="hs-operator hs-var">`rComp`</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a2 a1
</span><a href="#local-6989586621689655548"><span class="hs-identifier hs-var">g'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">0</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rComp"><span class="hs-pragma hs-type">rComp</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-pragma">{-# RULES</span><span> </span><span class="annot"><span class="hs-pragma">&quot;associate&quot;</span></span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655544"><span class="annot"><a href="#local-6989586621689655544"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655543"><span class="annot"><a href="#local-6989586621689655543"><span class="hs-pragma hs-var">g</span></a></span></span><span> </span><span id="local-6989586621689655542"><span class="annot"><a href="#local-6989586621689655542"><span class="hs-pragma hs-var">h</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="#local-6989586621689655544"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655543"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="#local-6989586621689655542"><span class="hs-pragma hs-type">h</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655544"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="#local-6989586621689655543"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="#local-6989586621689655542"><span class="hs-pragma hs-type">h</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span id="local-6989586621689655892"><span id="local-6989586621689655893"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rId"><span class="hs-identifier hs-type">rId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655893"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655892"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655892"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-91"></span><span id="rId"><span class="annot"><span class="annottext">rId :: Rule m a a
</span><a href="Hasura.Incremental.Internal.Rule.html#rId"><span class="hs-identifier hs-var hs-var">rId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall r.
 Accesses -&gt; a -&gt; (Accesses -&gt; a -&gt; Rule m a a -&gt; m r) -&gt; m r)
-&gt; Rule m a a
forall (m :: * -&gt; *) a b.
(forall r.
 Accesses -&gt; a -&gt; (Accesses -&gt; b -&gt; Rule m a b -&gt; m r) -&gt; m r)
-&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-var">Rule</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655540"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655540"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621689655539"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689655539"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621689655538"><span class="annot"><span class="annottext">Accesses -&gt; a -&gt; Rule m a a -&gt; m r
</span><a href="#local-6989586621689655538"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; a -&gt; Rule m a a -&gt; m r
</span><a href="#local-6989586621689655538"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655540"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689655539"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a a
forall (m :: * -&gt; *) a. Rule m a a
</span><a href="Hasura.Incremental.Internal.Rule.html#rId"><span class="hs-identifier hs-var">rId</span></a></span><span>
</span><span id="line-92"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">0</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rId"><span class="hs-pragma hs-type">rId</span></a></span><span> </span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#ifndef __HLINT__
</span><span class="hs-pragma">{-# RULES</span><span>
</span><span id="line-95"></span><span class="annot"><span class="hs-pragma">&quot;f/id&quot;</span></span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655537"><span class="annot"><a href="#local-6989586621689655537"><span class="hs-pragma hs-var">f</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="#local-6989586621689655537"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rId"><span class="hs-pragma hs-type">rId</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="#local-6989586621689655537"><span class="hs-pragma hs-type">f</span></a></span><span>
</span><span id="line-96"></span><span class="annot"><span class="hs-pragma">&quot;id/f&quot;</span></span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655536"><span class="annot"><a href="#local-6989586621689655536"><span class="hs-pragma hs-var">f</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rId"><span class="hs-pragma hs-type">rId</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="#local-6989586621689655536"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="#local-6989586621689655536"><span class="hs-pragma hs-type">f</span></a></span><span>
</span><span id="line-97"></span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-100"></span><span id="local-6989586621689655885"><span id="local-6989586621689655886"><span id="local-6989586621689655887"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-identifier hs-type">rArr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655887"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689655886"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655885"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655887"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655886"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-101"></span><span id="rArr"><span class="annot"><span class="annottext">rArr :: (a -&gt; b) -&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-identifier hs-var hs-var">rArr</span></a></span></span><span> </span><span id="local-6989586621689655534"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621689655534"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall r.
 Accesses -&gt; a -&gt; (Accesses -&gt; b -&gt; Rule m a b -&gt; m r) -&gt; m r)
-&gt; Rule m a b
forall (m :: * -&gt; *) a b.
(forall r.
 Accesses -&gt; a -&gt; (Accesses -&gt; b -&gt; Rule m a b -&gt; m r) -&gt; m r)
-&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-var">Rule</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655533"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655533"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621689655532"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689655532"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621689655531"><span class="annot"><span class="annottext">Accesses -&gt; b -&gt; Rule m a b -&gt; m r
</span><a href="#local-6989586621689655531"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; b -&gt; Rule m a b -&gt; m r
</span><a href="#local-6989586621689655531"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655533"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621689655534"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689655532"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; Rule m a b
forall a b (m :: * -&gt; *). (a -&gt; b) -&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-identifier hs-var">rArr</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621689655534"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">0</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#ifndef __HLINT__
</span><span class="hs-pragma">{-# RULES</span><span>
</span><span id="line-105"></span><span class="annot"><span class="hs-pragma">&quot;arr/id&quot;</span></span><span>        </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">\</span><span id="local-6989586621689655530"><span class="annot"><a href="#local-6989586621689655530"><span class="hs-pragma hs-var">x</span></a></span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689655530"><span class="hs-pragma hs-type">x</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rId"><span class="hs-pragma hs-type">rId</span></a></span><span>
</span><span id="line-106"></span><span class="annot"><span class="hs-pragma">&quot;arr/const&quot;</span></span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655529"><span class="annot"><a href="#local-6989586621689655529"><span class="hs-pragma hs-var">x</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">\</span><span class="annot"><span class="hs-pragma">_</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689655529"><span class="hs-pragma hs-type">x</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rPure"><span class="hs-pragma hs-type">rPure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655529"><span class="hs-pragma hs-type">x</span></a></span><span>
</span><span id="line-107"></span><span class="annot"><span class="hs-pragma">&quot;arr/arr&quot;</span></span><span>       </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655527"><span class="annot"><a href="#local-6989586621689655527"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655526"><span class="annot"><a href="#local-6989586621689655526"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655527"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655526"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655527"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="#local-6989586621689655526"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-108"></span><span class="annot"><span class="hs-pragma">&quot;arr/arr/f&quot;</span></span><span>     </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655525"><span class="annot"><a href="#local-6989586621689655525"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655524"><span class="annot"><a href="#local-6989586621689655524"><span class="hs-pragma hs-var">g</span></a></span></span><span> </span><span id="local-6989586621689655523"><span class="annot"><a href="#local-6989586621689655523"><span class="hs-pragma hs-var">h</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655525"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655524"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655523"><span class="hs-pragma hs-type">h</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="#local-6989586621689655525"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655524"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="#local-6989586621689655523"><span class="hs-pragma hs-type">h</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-109"></span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-112"></span><span id="local-6989586621689655875"><span id="local-6989586621689655876"><span id="local-6989586621689655877"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-identifier hs-type">rArrM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621689655877"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655876"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689655877"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655875"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655877"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655876"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655875"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-113"></span><span id="rArrM"><span class="annot"><span class="annottext">rArrM :: (a -&gt; m b) -&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-identifier hs-var hs-var">rArrM</span></a></span></span><span> </span><span id="local-6989586621689655521"><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621689655521"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall r.
 Accesses -&gt; a -&gt; (Accesses -&gt; b -&gt; Rule m a b -&gt; m r) -&gt; m r)
-&gt; Rule m a b
forall (m :: * -&gt; *) a b.
(forall r.
 Accesses -&gt; a -&gt; (Accesses -&gt; b -&gt; Rule m a b -&gt; m r) -&gt; m r)
-&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-var">Rule</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655520"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655520"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621689655519"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689655519"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621689655518"><span class="annot"><span class="annottext">Accesses -&gt; b -&gt; Rule m a b -&gt; m r
</span><a href="#local-6989586621689655518"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621689655521"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689655519"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">m b -&gt; (b -&gt; m r) -&gt; m r
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655517"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689655517"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; b -&gt; Rule m a b -&gt; m r
</span><a href="#local-6989586621689655518"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655520"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689655517"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; m b) -&gt; Rule m a b
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-identifier hs-var">rArrM</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621689655521"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">0</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-pragma hs-type">rArrM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#ifndef __HLINT__
</span><span class="hs-pragma">{-# RULES</span><span>
</span><span id="line-117"></span><span class="annot"><span class="hs-pragma">&quot;arrM/arrM&quot;</span></span><span>   </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655516"><span class="annot"><a href="#local-6989586621689655516"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655515"><span class="annot"><a href="#local-6989586621689655515"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-pragma hs-type">rArrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655516"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-pragma hs-type">rArrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655515"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-pragma hs-type">rArrM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655516"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">&lt;=&lt;</span></span><span> </span><span class="annot"><a href="#local-6989586621689655515"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-118"></span><span class="annot"><span class="hs-pragma">&quot;arr/arrM&quot;</span></span><span>    </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655513"><span class="annot"><a href="#local-6989586621689655513"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655512"><span class="annot"><a href="#local-6989586621689655512"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655513"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-pragma hs-type">rArrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655512"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-pragma hs-type">rArrM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">fmap</span></span><span> </span><span class="annot"><a href="#local-6989586621689655513"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="#local-6989586621689655512"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-119"></span><span class="annot"><span class="hs-pragma">&quot;arrM/arr&quot;</span></span><span>    </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655511"><span class="annot"><a href="#local-6989586621689655511"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655510"><span class="annot"><a href="#local-6989586621689655510"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-pragma hs-type">rArrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655511"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655510"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-pragma hs-type">rArrM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655511"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="#local-6989586621689655510"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-120"></span><span class="annot"><span class="hs-pragma">&quot;arrM/arrM/f&quot;</span></span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655509"><span class="annot"><a href="#local-6989586621689655509"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655508"><span class="annot"><a href="#local-6989586621689655508"><span class="hs-pragma hs-var">g</span></a></span></span><span> </span><span id="local-6989586621689655507"><span class="annot"><a href="#local-6989586621689655507"><span class="hs-pragma hs-var">h</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655509"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-pragma hs-type">rArrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655508"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-pragma hs-type">rArrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655507"><span class="hs-pragma hs-type">h</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="#local-6989586621689655509"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-pragma hs-type">rArrM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655508"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">&lt;=&lt;</span></span><span> </span><span class="annot"><a href="#local-6989586621689655507"><span class="hs-pragma hs-type">h</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-121"></span><span class="annot"><span class="hs-pragma">&quot;arr/arrM/f&quot;</span></span><span>  </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655506"><span class="annot"><a href="#local-6989586621689655506"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655505"><span class="annot"><a href="#local-6989586621689655505"><span class="hs-pragma hs-var">g</span></a></span></span><span> </span><span id="local-6989586621689655504"><span class="annot"><a href="#local-6989586621689655504"><span class="hs-pragma hs-var">h</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655506"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655505"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-pragma hs-type">rArrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655504"><span class="hs-pragma hs-type">h</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="#local-6989586621689655506"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-pragma hs-type">rArrM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">fmap</span></span><span> </span><span class="annot"><a href="#local-6989586621689655505"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="#local-6989586621689655504"><span class="hs-pragma hs-type">h</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-122"></span><span class="annot"><span class="hs-pragma">&quot;arrM/arr/f&quot;</span></span><span>  </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655503"><span class="annot"><a href="#local-6989586621689655503"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655502"><span class="annot"><a href="#local-6989586621689655502"><span class="hs-pragma hs-var">g</span></a></span></span><span> </span><span id="local-6989586621689655501"><span class="annot"><a href="#local-6989586621689655501"><span class="hs-pragma hs-var">h</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655503"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-pragma hs-type">rArrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655502"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655501"><span class="hs-pragma hs-type">h</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="#local-6989586621689655503"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-pragma hs-type">rArrM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655502"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="#local-6989586621689655501"><span class="hs-pragma hs-type">h</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-123"></span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-126"></span><span id="local-6989586621689655866"><span id="local-6989586621689655867"><span id="local-6989586621689655868"><span id="local-6989586621689655869"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFirst"><span class="hs-identifier hs-type">rFirst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655869"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655868"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655867"><span class="hs-identifier hs-type">b1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655869"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655868"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689655866"><span class="hs-identifier hs-type">b2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655867"><span class="hs-identifier hs-type">b1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689655866"><span class="hs-identifier hs-type">b2</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-127"></span><span id="rFirst"><span class="annot"><span class="annottext">rFirst :: Rule m a b1 -&gt; Rule m (a, b2) (b1, b2)
</span><a href="Hasura.Incremental.Internal.Rule.html#rFirst"><span class="hs-identifier hs-var hs-var">rFirst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span id="local-6989586621689655499"><span class="annot"><span class="annottext">forall r.
Accesses -&gt; a -&gt; (Accesses -&gt; b1 -&gt; Rule m a b1 -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655499"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall r.
 Accesses
 -&gt; (a, b2)
 -&gt; (Accesses -&gt; (b1, b2) -&gt; Rule m (a, b2) (b1, b2) -&gt; m r)
 -&gt; m r)
-&gt; Rule m (a, b2) (b1, b2)
forall (m :: * -&gt; *) a b.
(forall r.
 Accesses -&gt; a -&gt; (Accesses -&gt; b -&gt; Rule m a b -&gt; m r) -&gt; m r)
-&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-var">Rule</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655498"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655498"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621689655497"><span class="annot"><a href="#local-6989586621689655497"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689655496"><span class="annot"><a href="#local-6989586621689655496"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621689655495"><span class="annot"><span class="annottext">Accesses -&gt; (b1, b2) -&gt; Rule m (a, b2) (b1, b2) -&gt; m r
</span><a href="#local-6989586621689655495"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; a -&gt; (Accesses -&gt; b1 -&gt; Rule m a b1 -&gt; m r) -&gt; m r
forall r.
Accesses -&gt; a -&gt; (Accesses -&gt; b1 -&gt; Rule m a b1 -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655499"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655498"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689655497"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655494"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655494"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span id="local-6989586621689655493"><span class="annot"><span class="annottext">b1
</span><a href="#local-6989586621689655493"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621689655492"><span class="annot"><span class="annottext">Rule m a b1
</span><a href="#local-6989586621689655492"><span class="hs-identifier hs-var">r'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; (b1, b2) -&gt; Rule m (a, b2) (b1, b2) -&gt; m r
</span><a href="#local-6989586621689655495"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655494"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b1
</span><a href="#local-6989586621689655493"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b2
</span><a href="#local-6989586621689655496"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule m a b1 -&gt; Rule m (a, b2) (b1, b2)
forall (m :: * -&gt; *) a b1 b2.
Rule m a b1 -&gt; Rule m (a, b2) (b1, b2)
</span><a href="Hasura.Incremental.Internal.Rule.html#rFirst"><span class="hs-identifier hs-var">rFirst</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a b1
</span><a href="#local-6989586621689655492"><span class="hs-identifier hs-var">r'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">0</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFirst"><span class="hs-pragma hs-type">rFirst</span></a></span><span> </span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#ifndef __HLINT__
</span><span class="hs-pragma">{-# RULES</span><span>
</span><span id="line-131"></span><span class="annot"><span class="hs-pragma">&quot;first/id&quot;</span></span><span>         </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFirst"><span class="hs-pragma hs-type">rFirst</span></a></span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rId"><span class="hs-pragma hs-type">rId</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rId"><span class="hs-pragma hs-type">rId</span></a></span><span>
</span><span id="line-132"></span><span class="annot"><span class="hs-pragma">&quot;first/arr&quot;</span></span><span>        </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655491"><span class="annot"><a href="#local-6989586621689655491"><span class="hs-pragma hs-var">f</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFirst"><span class="hs-pragma hs-type">rFirst</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655491"><span class="hs-pragma hs-type">f</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">first</span></span><span> </span><span class="annot"><a href="#local-6989586621689655491"><span class="hs-pragma hs-type">f</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-133"></span><span class="annot"><span class="hs-pragma">&quot;first/arrM&quot;</span></span><span>       </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655490"><span class="annot"><a href="#local-6989586621689655490"><span class="hs-pragma hs-var">f</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFirst"><span class="hs-pragma hs-type">rFirst</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-pragma hs-type">rArrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655490"><span class="hs-pragma hs-type">f</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-pragma hs-type">rArrM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-var">runKleisli</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">first</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Kleisli</span></span><span> </span><span class="annot"><a href="#local-6989586621689655490"><span class="hs-pragma hs-type">f</span></a></span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span>
</span><span id="line-134"></span><span class="annot"><span class="hs-pragma">&quot;first/push&quot;</span></span><span>  </span><span class="hs-pragma">[</span><span class="hs-pragma">~</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655487"><span class="annot"><a href="#local-6989586621689655487"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655486"><span class="annot"><a href="#local-6989586621689655486"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFirst"><span class="hs-pragma hs-type">rFirst</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655487"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="#local-6989586621689655486"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFirst"><span class="hs-pragma hs-type">rFirst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655487"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFirst"><span class="hs-pragma hs-type">rFirst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655486"><span class="hs-pragma hs-type">g</span></a></span><span>
</span><span id="line-135"></span><span class="annot"><span class="hs-pragma">&quot;first/pull&quot;</span></span><span>   </span><span class="hs-pragma">[</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655485"><span class="annot"><a href="#local-6989586621689655485"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655484"><span class="annot"><a href="#local-6989586621689655484"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFirst"><span class="hs-pragma hs-type">rFirst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655485"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFirst"><span class="hs-pragma hs-type">rFirst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655484"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFirst"><span class="hs-pragma hs-type">rFirst</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655485"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="#local-6989586621689655484"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-136"></span><span class="annot"><span class="hs-pragma">&quot;first/f/pull&quot;</span></span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655483"><span class="annot"><a href="#local-6989586621689655483"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655482"><span class="annot"><a href="#local-6989586621689655482"><span class="hs-pragma hs-var">g</span></a></span></span><span> </span><span id="local-6989586621689655481"><span class="annot"><a href="#local-6989586621689655481"><span class="hs-pragma hs-var">h</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655483"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFirst"><span class="hs-pragma hs-type">rFirst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655482"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFirst"><span class="hs-pragma hs-type">rFirst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655481"><span class="hs-pragma hs-type">h</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="#local-6989586621689655483"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFirst"><span class="hs-pragma hs-type">rFirst</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655482"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="#local-6989586621689655481"><span class="hs-pragma hs-type">h</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-137"></span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-140"></span><span id="local-6989586621689655477"><span id="local-6989586621689655478"><span id="local-6989586621689655479"><span id="local-6989586621689655480"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rLeft"><span class="hs-identifier hs-type">rLeft</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655480"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655479"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655478"><span class="hs-identifier hs-type">b1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655480"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621689655479"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655477"><span class="hs-identifier hs-type">b2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621689655478"><span class="hs-identifier hs-type">b1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655477"><span class="hs-identifier hs-type">b2</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-141"></span><span id="rLeft"><span class="annot"><span class="annottext">rLeft :: Rule m a b1 -&gt; Rule m (Either a b2) (Either b1 b2)
</span><a href="Hasura.Incremental.Internal.Rule.html#rLeft"><span class="hs-identifier hs-var hs-var">rLeft</span></a></span></span><span> </span><span id="local-6989586621689655475"><span class="annot"><span class="annottext">Rule m a b1
</span><a href="#local-6989586621689655475"><span class="hs-identifier hs-var">r0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m a b1 -&gt; Rule m (Either a b2) (Either b1 b2)
</span><a href="#local-6989586621689655474"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a b1
</span><a href="#local-6989586621689655475"><span class="hs-identifier hs-var">r0</span></a></span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-143"></span><span>    </span><span id="local-6989586621689655474"><span class="annot"><span class="annottext">go :: Rule m a b1 -&gt; Rule m (Either a b2) (Either b1 b2)
</span><a href="#local-6989586621689655474"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span id="local-6989586621689655473"><span class="annot"><span class="annottext">forall r.
Accesses -&gt; a -&gt; (Accesses -&gt; b1 -&gt; Rule m a b1 -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655473"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall r.
 Accesses
 -&gt; Either a b2
 -&gt; (Accesses
     -&gt; Either b1 b2 -&gt; Rule m (Either a b2) (Either b1 b2) -&gt; m r)
 -&gt; m r)
-&gt; Rule m (Either a b2) (Either b1 b2)
forall (m :: * -&gt; *) a b.
(forall r.
 Accesses -&gt; a -&gt; (Accesses -&gt; b -&gt; Rule m a b -&gt; m r) -&gt; m r)
-&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-var">Rule</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655472"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655472"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621689655471"><span class="annot"><span class="annottext">Either a b2
</span><a href="#local-6989586621689655471"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621689655470"><span class="annot"><span class="annottext">Accesses
-&gt; Either b1 b2 -&gt; Rule m (Either a b2) (Either b1 b2) -&gt; m r
</span><a href="#local-6989586621689655470"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either a b2
</span><a href="#local-6989586621689655471"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-144"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621689655469"><span class="annot"><a href="#local-6989586621689655469"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; a -&gt; (Accesses -&gt; b1 -&gt; Rule m a b1 -&gt; m r) -&gt; m r
forall r.
Accesses -&gt; a -&gt; (Accesses -&gt; b1 -&gt; Rule m a b1 -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655473"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655472"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689655469"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655468"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655468"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span id="local-6989586621689655467"><span class="annot"><span class="annottext">b1
</span><a href="#local-6989586621689655467"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621689655466"><span class="annot"><span class="annottext">Rule m a b1
</span><a href="#local-6989586621689655466"><span class="hs-identifier hs-var">r'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses
-&gt; Either b1 b2 -&gt; Rule m (Either a b2) (Either b1 b2) -&gt; m r
</span><a href="#local-6989586621689655470"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655468"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b1 -&gt; Either b1 b2
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">b1
</span><a href="#local-6989586621689655467"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule m a b1 -&gt; Rule m (Either a b2) (Either b1 b2)
</span><a href="#local-6989586621689655474"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a b1
</span><a href="#local-6989586621689655466"><span class="hs-identifier hs-var">r'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621689655465"><span class="annot"><a href="#local-6989586621689655465"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses
-&gt; Either b1 b2 -&gt; Rule m (Either a b2) (Either b1 b2) -&gt; m r
</span><a href="#local-6989586621689655470"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655472"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b2 -&gt; Either b1 b2
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">b2
</span><a href="#local-6989586621689655465"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule m a b1 -&gt; Rule m (Either a b2) (Either b1 b2)
</span><a href="#local-6989586621689655474"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a b1
</span><a href="#local-6989586621689655475"><span class="hs-identifier hs-var">r0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">0</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rLeft"><span class="hs-pragma hs-type">rLeft</span></a></span><span> </span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#ifndef __HLINT__
</span><span class="hs-pragma">{-# RULES</span><span>
</span><span id="line-149"></span><span class="annot"><span class="hs-pragma">&quot;left/id&quot;</span></span><span>         </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rLeft"><span class="hs-pragma hs-type">rLeft</span></a></span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rId"><span class="hs-pragma hs-type">rId</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rId"><span class="hs-pragma hs-type">rId</span></a></span><span>
</span><span id="line-150"></span><span class="annot"><span class="hs-pragma">&quot;left/arr&quot;</span></span><span>        </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655464"><span class="annot"><a href="#local-6989586621689655464"><span class="hs-pragma hs-var">f</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rLeft"><span class="hs-pragma hs-type">rLeft</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655464"><span class="hs-pragma hs-type">f</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">left</span></span><span> </span><span class="annot"><a href="#local-6989586621689655464"><span class="hs-pragma hs-type">f</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-151"></span><span class="annot"><span class="hs-pragma">&quot;left/arrM&quot;</span></span><span>       </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655462"><span class="annot"><a href="#local-6989586621689655462"><span class="hs-pragma hs-var">f</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rLeft"><span class="hs-pragma hs-type">rLeft</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-pragma hs-type">rArrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655462"><span class="hs-pragma hs-type">f</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-pragma hs-type">rArrM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-var">runKleisli</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">left</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Kleisli</span></span><span> </span><span class="annot"><a href="#local-6989586621689655462"><span class="hs-pragma hs-type">f</span></a></span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span>
</span><span id="line-152"></span><span class="annot"><span class="hs-pragma">&quot;left/push&quot;</span></span><span>  </span><span class="hs-pragma">[</span><span class="hs-pragma">~</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655461"><span class="annot"><a href="#local-6989586621689655461"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655460"><span class="annot"><a href="#local-6989586621689655460"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rLeft"><span class="hs-pragma hs-type">rLeft</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655461"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="#local-6989586621689655460"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rLeft"><span class="hs-pragma hs-type">rLeft</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655461"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rLeft"><span class="hs-pragma hs-type">rLeft</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655460"><span class="hs-pragma hs-type">g</span></a></span><span>
</span><span id="line-153"></span><span class="annot"><span class="hs-pragma">&quot;left/pull&quot;</span></span><span>   </span><span class="hs-pragma">[</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655459"><span class="annot"><a href="#local-6989586621689655459"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655458"><span class="annot"><a href="#local-6989586621689655458"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rLeft"><span class="hs-pragma hs-type">rLeft</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655459"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rLeft"><span class="hs-pragma hs-type">rLeft</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655458"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rLeft"><span class="hs-pragma hs-type">rLeft</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655459"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="#local-6989586621689655458"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-154"></span><span class="annot"><span class="hs-pragma">&quot;left/f/pull&quot;</span></span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655457"><span class="annot"><a href="#local-6989586621689655457"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655456"><span class="annot"><a href="#local-6989586621689655456"><span class="hs-pragma hs-var">g</span></a></span></span><span> </span><span id="local-6989586621689655455"><span class="annot"><a href="#local-6989586621689655455"><span class="hs-pragma hs-var">h</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655457"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rLeft"><span class="hs-pragma hs-type">rLeft</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655456"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rLeft"><span class="hs-pragma hs-type">rLeft</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655455"><span class="hs-pragma hs-type">h</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="#local-6989586621689655457"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rLeft"><span class="hs-pragma hs-type">rLeft</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655456"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rComp</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="#local-6989586621689655455"><span class="hs-pragma hs-type">h</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-155"></span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-158"></span><span id="local-6989586621689655852"><span id="local-6989586621689655853"><span id="local-6989586621689655854"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rPure"><span class="hs-identifier hs-type">rPure</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621689655854"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655853"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655852"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655854"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-159"></span><span id="rPure"><span class="annot"><span class="annottext">rPure :: b -&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#rPure"><span class="hs-identifier hs-var hs-var">rPure</span></a></span></span><span> </span><span id="local-6989586621689655454"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689655454"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall r.
 Accesses -&gt; a -&gt; (Accesses -&gt; b -&gt; Rule m a b -&gt; m r) -&gt; m r)
-&gt; Rule m a b
forall (m :: * -&gt; *) a b.
(forall r.
 Accesses -&gt; a -&gt; (Accesses -&gt; b -&gt; Rule m a b -&gt; m r) -&gt; m r)
-&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-var">Rule</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655453"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655453"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621689655452"><span class="annot"><span class="annottext">Accesses -&gt; b -&gt; Rule m a b -&gt; m r
</span><a href="#local-6989586621689655452"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; b -&gt; Rule m a b -&gt; m r
</span><a href="#local-6989586621689655452"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655453"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689655454"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; Rule m a b
forall b (m :: * -&gt; *) a. b -&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#rPure"><span class="hs-identifier hs-var">rPure</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689655454"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">0</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rPure"><span class="hs-pragma hs-type">rPure</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="hs-pragma">{-# RULES</span><span> </span><span class="annot"><span class="hs-pragma">&quot;pure/push&quot;</span></span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">~</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rPure"><span class="hs-pragma hs-type">rPure</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">const</span></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [Desugaring derived operations]</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span id="local-6989586621689655843"><span id="local-6989586621689655844"><span id="local-6989586621689655845"><span id="local-6989586621689655846"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rSecond"><span class="hs-identifier hs-type">rSecond</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655846"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655845"><span class="hs-identifier hs-type">a1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655844"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655846"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655843"><span class="hs-identifier hs-type">a2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689655845"><span class="hs-identifier hs-type">a1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655843"><span class="hs-identifier hs-type">a2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689655844"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-165"></span><span id="rSecond"><span class="annot"><span class="annottext">rSecond :: Rule m a1 b -&gt; Rule m (a2, a1) (a2, b)
</span><a href="Hasura.Incremental.Internal.Rule.html#rSecond"><span class="hs-identifier hs-var hs-var">rSecond</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span id="local-6989586621689655449"><span class="annot"><span class="annottext">forall r.
Accesses -&gt; a1 -&gt; (Accesses -&gt; b -&gt; Rule m a1 b -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655449"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall r.
 Accesses
 -&gt; (a2, a1)
 -&gt; (Accesses -&gt; (a2, b) -&gt; Rule m (a2, a1) (a2, b) -&gt; m r)
 -&gt; m r)
-&gt; Rule m (a2, a1) (a2, b)
forall (m :: * -&gt; *) a b.
(forall r.
 Accesses -&gt; a -&gt; (Accesses -&gt; b -&gt; Rule m a b -&gt; m r) -&gt; m r)
-&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-var">Rule</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655448"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655448"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621689655447"><span class="annot"><a href="#local-6989586621689655447"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689655446"><span class="annot"><a href="#local-6989586621689655446"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621689655445"><span class="annot"><span class="annottext">Accesses -&gt; (a2, b) -&gt; Rule m (a2, a1) (a2, b) -&gt; m r
</span><a href="#local-6989586621689655445"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; a1 -&gt; (Accesses -&gt; b -&gt; Rule m a1 b -&gt; m r) -&gt; m r
forall r.
Accesses -&gt; a1 -&gt; (Accesses -&gt; b -&gt; Rule m a1 b -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655449"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655448"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">a1
</span><a href="#local-6989586621689655446"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655444"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655444"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span id="local-6989586621689655443"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689655443"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621689655442"><span class="annot"><span class="annottext">Rule m a1 b
</span><a href="#local-6989586621689655442"><span class="hs-identifier hs-var">r'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; (a2, b) -&gt; Rule m (a2, a1) (a2, b) -&gt; m r
</span><a href="#local-6989586621689655445"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655444"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a2
</span><a href="#local-6989586621689655447"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689655443"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule m a1 b -&gt; Rule m (a2, a1) (a2, b)
forall (m :: * -&gt; *) a1 b a2.
Rule m a1 b -&gt; Rule m (a2, a1) (a2, b)
</span><a href="Hasura.Incremental.Internal.Rule.html#rSecond"><span class="hs-identifier hs-var">rSecond</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a1 b
</span><a href="#local-6989586621689655442"><span class="hs-identifier hs-var">r'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">0</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rSecond"><span class="hs-pragma hs-type">rSecond</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="hs-comment">-- see Note [Desugaring derived operations]</span><span>
</span><span id="line-169"></span><span class="hs-pragma">{-# RULES</span><span> </span><span class="annot"><span class="hs-pragma">&quot;second/push&quot;</span></span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">~</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655441"><span class="annot"><a href="#local-6989586621689655441"><span class="hs-pragma hs-var">f</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rSecond"><span class="hs-pragma hs-type">rSecond</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655441"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">swap</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFirst"><span class="hs-pragma hs-type">rFirst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655441"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">swap</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span id="local-6989586621689655439"><span id="local-6989586621689655440"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#swapEither"><span class="hs-identifier hs-type">swapEither</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621689655440"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655439"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621689655439"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655440"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-172"></span><span id="swapEither"><span class="annot"><span class="annottext">swapEither :: Either a b -&gt; Either b a
</span><a href="Hasura.Incremental.Internal.Rule.html#swapEither"><span class="hs-identifier hs-var hs-var">swapEither</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Either b a) -&gt; (b -&gt; Either b a) -&gt; Either a b -&gt; Either b a
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Either b a
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; Either b a
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span>
</span><span id="line-173"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">0</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#swapEither"><span class="hs-pragma hs-type">swapEither</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span id="local-6989586621689655433"><span id="local-6989586621689655434"><span id="local-6989586621689655435"><span id="local-6989586621689655436"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rRight"><span class="hs-identifier hs-type">rRight</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655436"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655435"><span class="hs-identifier hs-type">a1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655434"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655436"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621689655433"><span class="hs-identifier hs-type">a2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655435"><span class="hs-identifier hs-type">a1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621689655433"><span class="hs-identifier hs-type">a2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655434"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-176"></span><span id="rRight"><span class="annot"><span class="annottext">rRight :: Rule m a1 b -&gt; Rule m (Either a2 a1) (Either a2 b)
</span><a href="Hasura.Incremental.Internal.Rule.html#rRight"><span class="hs-identifier hs-var hs-var">rRight</span></a></span></span><span> </span><span id="local-6989586621689655431"><span class="annot"><span class="annottext">Rule m a1 b
</span><a href="#local-6989586621689655431"><span class="hs-identifier hs-var">r0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m a1 b -&gt; Rule m (Either a2 a1) (Either a2 b)
</span><a href="#local-6989586621689655430"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a1 b
</span><a href="#local-6989586621689655431"><span class="hs-identifier hs-var">r0</span></a></span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-178"></span><span>    </span><span id="local-6989586621689655430"><span class="annot"><span class="annottext">go :: Rule m a1 b -&gt; Rule m (Either a2 a1) (Either a2 b)
</span><a href="#local-6989586621689655430"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span id="local-6989586621689655429"><span class="annot"><span class="annottext">forall r.
Accesses -&gt; a1 -&gt; (Accesses -&gt; b -&gt; Rule m a1 b -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655429"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall r.
 Accesses
 -&gt; Either a2 a1
 -&gt; (Accesses
     -&gt; Either a2 b -&gt; Rule m (Either a2 a1) (Either a2 b) -&gt; m r)
 -&gt; m r)
-&gt; Rule m (Either a2 a1) (Either a2 b)
forall (m :: * -&gt; *) a b.
(forall r.
 Accesses -&gt; a -&gt; (Accesses -&gt; b -&gt; Rule m a b -&gt; m r) -&gt; m r)
-&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-var">Rule</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655428"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655428"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621689655427"><span class="annot"><span class="annottext">Either a2 a1
</span><a href="#local-6989586621689655427"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621689655426"><span class="annot"><span class="annottext">Accesses
-&gt; Either a2 b -&gt; Rule m (Either a2 a1) (Either a2 b) -&gt; m r
</span><a href="#local-6989586621689655426"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either a2 a1
</span><a href="#local-6989586621689655427"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-179"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621689655425"><span class="annot"><a href="#local-6989586621689655425"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses
-&gt; Either a2 b -&gt; Rule m (Either a2 a1) (Either a2 b) -&gt; m r
</span><a href="#local-6989586621689655426"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655428"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a2 -&gt; Either a2 b
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">a2
</span><a href="#local-6989586621689655425"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule m a1 b -&gt; Rule m (Either a2 a1) (Either a2 b)
</span><a href="#local-6989586621689655430"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a1 b
</span><a href="#local-6989586621689655431"><span class="hs-identifier hs-var">r0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621689655424"><span class="annot"><a href="#local-6989586621689655424"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; a1 -&gt; (Accesses -&gt; b -&gt; Rule m a1 b -&gt; m r) -&gt; m r
forall r.
Accesses -&gt; a1 -&gt; (Accesses -&gt; b -&gt; Rule m a1 b -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655429"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655428"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">a1
</span><a href="#local-6989586621689655424"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655423"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655423"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span id="local-6989586621689655422"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689655422"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621689655421"><span class="annot"><span class="annottext">Rule m a1 b
</span><a href="#local-6989586621689655421"><span class="hs-identifier hs-var">r'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses
-&gt; Either a2 b -&gt; Rule m (Either a2 a1) (Either a2 b) -&gt; m r
</span><a href="#local-6989586621689655426"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655423"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; Either a2 b
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689655422"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule m a1 b -&gt; Rule m (Either a2 a1) (Either a2 b)
</span><a href="#local-6989586621689655430"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a1 b
</span><a href="#local-6989586621689655421"><span class="hs-identifier hs-var">r'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">0</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rRight"><span class="hs-pragma hs-type">rRight</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-comment">-- see Note [Desugaring derived operations]</span><span>
</span><span id="line-184"></span><span class="hs-pragma">{-# RULES</span><span> </span><span class="annot"><span class="hs-pragma">&quot;right/push&quot;</span></span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">~</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655420"><span class="annot"><a href="#local-6989586621689655420"><span class="hs-pragma hs-var">f</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rRight"><span class="hs-pragma hs-type">rRight</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655420"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#swapEither"><span class="hs-pragma hs-type">swapEither</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rLeft"><span class="hs-pragma hs-type">rLeft</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655420"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#swapEither"><span class="hs-pragma hs-type">swapEither</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span id="local-6989586621689655822"><span id="local-6989586621689655823"><span id="local-6989586621689655824"><span id="local-6989586621689655825"><span id="local-6989586621689655826"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rSplit"><span class="hs-identifier hs-type">rSplit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655826"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655825"><span class="hs-identifier hs-type">a1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655824"><span class="hs-identifier hs-type">b1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655826"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655823"><span class="hs-identifier hs-type">a2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655822"><span class="hs-identifier hs-type">b2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655826"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655825"><span class="hs-identifier hs-type">a1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689655823"><span class="hs-identifier hs-type">a2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655824"><span class="hs-identifier hs-type">b1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689655822"><span class="hs-identifier hs-type">b2</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-187"></span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span id="local-6989586621689655418"><span class="annot"><span class="annottext">forall r.
Accesses -&gt; a1 -&gt; (Accesses -&gt; b1 -&gt; Rule m a1 b1 -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655418"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="rSplit"><span class="annot"><span class="annottext">rSplit :: Rule m a1 b1 -&gt; Rule m a2 b2 -&gt; Rule m (a1, a2) (b1, b2)
</span><a href="Hasura.Incremental.Internal.Rule.html#rSplit"><span class="hs-operator hs-var hs-var">`rSplit`</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span id="local-6989586621689655417"><span class="annot"><span class="annottext">forall r.
Accesses -&gt; a2 -&gt; (Accesses -&gt; b2 -&gt; Rule m a2 b2 -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655417"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><span class="annottext">(forall r.
 Accesses
 -&gt; (a1, a2)
 -&gt; (Accesses -&gt; (b1, b2) -&gt; Rule m (a1, a2) (b1, b2) -&gt; m r)
 -&gt; m r)
-&gt; Rule m (a1, a2) (b1, b2)
forall (m :: * -&gt; *) a b.
(forall r.
 Accesses -&gt; a -&gt; (Accesses -&gt; b -&gt; Rule m a b -&gt; m r) -&gt; m r)
-&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-var">Rule</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655416"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655416"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621689655415"><span class="annot"><a href="#local-6989586621689655415"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689655414"><span class="annot"><a href="#local-6989586621689655414"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621689655413"><span class="annot"><span class="annottext">Accesses -&gt; (b1, b2) -&gt; Rule m (a1, a2) (b1, b2) -&gt; m r
</span><a href="#local-6989586621689655413"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; a1 -&gt; (Accesses -&gt; b1 -&gt; Rule m a1 b1 -&gt; m r) -&gt; m r
forall r.
Accesses -&gt; a1 -&gt; (Accesses -&gt; b1 -&gt; Rule m a1 b1 -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655418"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655416"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">a1
</span><a href="#local-6989586621689655415"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655412"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655412"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span id="local-6989586621689655411"><span class="annot"><span class="annottext">b1
</span><a href="#local-6989586621689655411"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621689655410"><span class="annot"><span class="annottext">Rule m a1 b1
</span><a href="#local-6989586621689655410"><span class="hs-identifier hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; a2 -&gt; (Accesses -&gt; b2 -&gt; Rule m a2 b2 -&gt; m r) -&gt; m r
forall r.
Accesses -&gt; a2 -&gt; (Accesses -&gt; b2 -&gt; Rule m a2 b2 -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655417"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655412"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">a2
</span><a href="#local-6989586621689655414"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655409"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655409"><span class="hs-identifier hs-var">s''</span></a></span></span><span> </span><span id="local-6989586621689655408"><span class="annot"><span class="annottext">b2
</span><a href="#local-6989586621689655408"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621689655407"><span class="annot"><span class="annottext">Rule m a2 b2
</span><a href="#local-6989586621689655407"><span class="hs-identifier hs-var">g'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; (b1, b2) -&gt; Rule m (a1, a2) (b1, b2) -&gt; m r
</span><a href="#local-6989586621689655413"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655409"><span class="hs-identifier hs-var">s''</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b1
</span><a href="#local-6989586621689655411"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b2
</span><a href="#local-6989586621689655408"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule m a1 b1
</span><a href="#local-6989586621689655410"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a1 b1 -&gt; Rule m a2 b2 -&gt; Rule m (a1, a2) (b1, b2)
forall (m :: * -&gt; *) a1 b1 a2 b2.
Rule m a1 b1 -&gt; Rule m a2 b2 -&gt; Rule m (a1, a2) (b1, b2)
</span><a href="Hasura.Incremental.Internal.Rule.html#rSplit"><span class="hs-operator hs-var">`rSplit`</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a2 b2
</span><a href="#local-6989586621689655407"><span class="hs-identifier hs-var">g'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">0</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rSplit"><span class="hs-pragma hs-type">rSplit</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-comment">-- see Note [Desugaring derived operations]</span><span>
</span><span id="line-192"></span><span class="hs-pragma">{-# RULES</span><span> </span><span class="annot"><span class="hs-pragma">&quot;***/push&quot;</span></span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">~</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655406"><span class="annot"><a href="#local-6989586621689655406"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655405"><span class="annot"><a href="#local-6989586621689655405"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="#local-6989586621689655406"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rSplit</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="#local-6989586621689655405"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rSecond"><span class="hs-pragma hs-type">rSecond</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655405"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFirst"><span class="hs-pragma hs-type">rFirst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655406"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span id="local-6989586621689655813"><span id="local-6989586621689655814"><span id="local-6989586621689655815"><span id="local-6989586621689655816"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFanout"><span class="hs-identifier hs-type">rFanout</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655816"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655815"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655814"><span class="hs-identifier hs-type">b1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655816"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655815"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655813"><span class="hs-identifier hs-type">b2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655816"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655815"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655814"><span class="hs-identifier hs-type">b1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689655813"><span class="hs-identifier hs-type">b2</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-195"></span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span id="local-6989586621689655403"><span class="annot"><span class="annottext">forall r.
Accesses -&gt; a -&gt; (Accesses -&gt; b1 -&gt; Rule m a b1 -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655403"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="rFanout"><span class="annot"><span class="annottext">rFanout :: Rule m a b1 -&gt; Rule m a b2 -&gt; Rule m a (b1, b2)
</span><a href="Hasura.Incremental.Internal.Rule.html#rFanout"><span class="hs-operator hs-var hs-var">`rFanout`</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span id="local-6989586621689655402"><span class="annot"><span class="annottext">forall r.
Accesses -&gt; a -&gt; (Accesses -&gt; b2 -&gt; Rule m a b2 -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655402"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-196"></span><span>  </span><span class="annot"><span class="annottext">(forall r.
 Accesses
 -&gt; a -&gt; (Accesses -&gt; (b1, b2) -&gt; Rule m a (b1, b2) -&gt; m r) -&gt; m r)
-&gt; Rule m a (b1, b2)
forall (m :: * -&gt; *) a b.
(forall r.
 Accesses -&gt; a -&gt; (Accesses -&gt; b -&gt; Rule m a b -&gt; m r) -&gt; m r)
-&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-var">Rule</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655401"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655401"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621689655400"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689655400"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621689655399"><span class="annot"><span class="annottext">Accesses -&gt; (b1, b2) -&gt; Rule m a (b1, b2) -&gt; m r
</span><a href="#local-6989586621689655399"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; a -&gt; (Accesses -&gt; b1 -&gt; Rule m a b1 -&gt; m r) -&gt; m r
forall r.
Accesses -&gt; a -&gt; (Accesses -&gt; b1 -&gt; Rule m a b1 -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655403"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655401"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689655400"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655398"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655398"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span id="local-6989586621689655397"><span class="annot"><span class="annottext">b1
</span><a href="#local-6989586621689655397"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621689655396"><span class="annot"><span class="annottext">Rule m a b1
</span><a href="#local-6989586621689655396"><span class="hs-identifier hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; a -&gt; (Accesses -&gt; b2 -&gt; Rule m a b2 -&gt; m r) -&gt; m r
forall r.
Accesses -&gt; a -&gt; (Accesses -&gt; b2 -&gt; Rule m a b2 -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655402"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655398"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689655400"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655395"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655395"><span class="hs-identifier hs-var">s''</span></a></span></span><span> </span><span id="local-6989586621689655394"><span class="annot"><span class="annottext">b2
</span><a href="#local-6989586621689655394"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621689655393"><span class="annot"><span class="annottext">Rule m a b2
</span><a href="#local-6989586621689655393"><span class="hs-identifier hs-var">g'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; (b1, b2) -&gt; Rule m a (b1, b2) -&gt; m r
</span><a href="#local-6989586621689655399"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655395"><span class="hs-identifier hs-var">s''</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b1
</span><a href="#local-6989586621689655397"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b2
</span><a href="#local-6989586621689655394"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule m a b1
</span><a href="#local-6989586621689655396"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a b1 -&gt; Rule m a b2 -&gt; Rule m a (b1, b2)
forall (m :: * -&gt; *) a b1 b2.
Rule m a b1 -&gt; Rule m a b2 -&gt; Rule m a (b1, b2)
</span><a href="Hasura.Incremental.Internal.Rule.html#rFanout"><span class="hs-operator hs-var">`rFanout`</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a b2
</span><a href="#local-6989586621689655393"><span class="hs-identifier hs-var">g'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">0</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFanout"><span class="hs-pragma hs-type">rFanout</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-comment">-- see Note [Desugaring derived operations]</span><span>
</span><span id="line-200"></span><span class="hs-pragma">{-# RULES</span><span> </span><span class="annot"><span class="hs-pragma">&quot;&amp;&amp;&amp;/push&quot;</span></span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">~</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655392"><span class="annot"><a href="#local-6989586621689655392"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655391"><span class="annot"><a href="#local-6989586621689655391"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="#local-6989586621689655392"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rFanout</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="#local-6989586621689655391"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655392"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">***</span></span><span> </span><span class="annot"><a href="#local-6989586621689655391"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">\</span><span id="local-6989586621689655389"><span class="annot"><a href="#local-6989586621689655389"><span class="hs-pragma hs-var">a</span></a></span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655389"><span class="hs-pragma hs-type">a</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="#local-6989586621689655389"><span class="hs-pragma hs-type">a</span></a></span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span id="local-6989586621689655384"><span id="local-6989586621689655385"><span id="local-6989586621689655386"><span id="local-6989586621689655387"><span id="local-6989586621689655388"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFork"><span class="hs-identifier hs-type">rFork</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655388"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655387"><span class="hs-identifier hs-type">a1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655386"><span class="hs-identifier hs-type">b1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655388"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655385"><span class="hs-identifier hs-type">a2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655384"><span class="hs-identifier hs-type">b2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655388"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621689655387"><span class="hs-identifier hs-type">a1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655385"><span class="hs-identifier hs-type">a2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621689655386"><span class="hs-identifier hs-type">b1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655384"><span class="hs-identifier hs-type">b2</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-203"></span><span id="local-6989586621689655382"><span class="annot"><span class="annottext">Rule m a1 b1
</span><a href="#local-6989586621689655382"><span class="hs-identifier hs-var">f0</span></a></span></span><span> </span><span id="rFork"><span class="annot"><span class="annottext">rFork :: Rule m a1 b1
-&gt; Rule m a2 b2 -&gt; Rule m (Either a1 a2) (Either b1 b2)
</span><a href="Hasura.Incremental.Internal.Rule.html#rFork"><span class="hs-operator hs-var hs-var">`rFork`</span></a></span></span><span> </span><span id="local-6989586621689655381"><span class="annot"><span class="annottext">Rule m a2 b2
</span><a href="#local-6989586621689655381"><span class="hs-identifier hs-var">g0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m a1 b1
-&gt; Rule m a2 b2 -&gt; Rule m (Either a1 a2) (Either b1 b2)
</span><a href="#local-6989586621689655380"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a1 b1
</span><a href="#local-6989586621689655382"><span class="hs-identifier hs-var">f0</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a2 b2
</span><a href="#local-6989586621689655381"><span class="hs-identifier hs-var">g0</span></a></span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-205"></span><span>    </span><span id="local-6989586621689655380"><span class="annot"><span class="annottext">go :: Rule m a1 b1
-&gt; Rule m a2 b2 -&gt; Rule m (Either a1 a2) (Either b1 b2)
</span><a href="#local-6989586621689655380"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span id="local-6989586621689655379"><span class="annot"><span class="annottext">forall r.
Accesses -&gt; a1 -&gt; (Accesses -&gt; b1 -&gt; Rule m a1 b1 -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655379"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span id="local-6989586621689655378"><span class="annot"><span class="annottext">forall r.
Accesses -&gt; a2 -&gt; (Accesses -&gt; b2 -&gt; Rule m a2 b2 -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655378"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall r.
 Accesses
 -&gt; Either a1 a2
 -&gt; (Accesses
     -&gt; Either b1 b2 -&gt; Rule m (Either a1 a2) (Either b1 b2) -&gt; m r)
 -&gt; m r)
-&gt; Rule m (Either a1 a2) (Either b1 b2)
forall (m :: * -&gt; *) a b.
(forall r.
 Accesses -&gt; a -&gt; (Accesses -&gt; b -&gt; Rule m a b -&gt; m r) -&gt; m r)
-&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-var">Rule</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655377"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655377"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621689655376"><span class="annot"><span class="annottext">Either a1 a2
</span><a href="#local-6989586621689655376"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621689655375"><span class="annot"><span class="annottext">Accesses
-&gt; Either b1 b2 -&gt; Rule m (Either a1 a2) (Either b1 b2) -&gt; m r
</span><a href="#local-6989586621689655375"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either a1 a2
</span><a href="#local-6989586621689655376"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-206"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621689655374"><span class="annot"><a href="#local-6989586621689655374"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; a1 -&gt; (Accesses -&gt; b1 -&gt; Rule m a1 b1 -&gt; m r) -&gt; m r
forall r.
Accesses -&gt; a1 -&gt; (Accesses -&gt; b1 -&gt; Rule m a1 b1 -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655379"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655377"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">a1
</span><a href="#local-6989586621689655374"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655373"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655373"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span id="local-6989586621689655372"><span class="annot"><span class="annottext">b1
</span><a href="#local-6989586621689655372"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621689655371"><span class="annot"><span class="annottext">Rule m a1 b1
</span><a href="#local-6989586621689655371"><span class="hs-identifier hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses
-&gt; Either b1 b2 -&gt; Rule m (Either a1 a2) (Either b1 b2) -&gt; m r
</span><a href="#local-6989586621689655375"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655373"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b1 -&gt; Either b1 b2
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">b1
</span><a href="#local-6989586621689655372"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule m a1 b1
-&gt; Rule m a2 b2 -&gt; Rule m (Either a1 a2) (Either b1 b2)
</span><a href="#local-6989586621689655380"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a1 b1
</span><a href="#local-6989586621689655371"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a2 b2
</span><a href="#local-6989586621689655381"><span class="hs-identifier hs-var">g0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621689655370"><span class="annot"><a href="#local-6989586621689655370"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; a2 -&gt; (Accesses -&gt; b2 -&gt; Rule m a2 b2 -&gt; m r) -&gt; m r
forall r.
Accesses -&gt; a2 -&gt; (Accesses -&gt; b2 -&gt; Rule m a2 b2 -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655378"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655377"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">a2
</span><a href="#local-6989586621689655370"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655369"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655369"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span id="local-6989586621689655368"><span class="annot"><span class="annottext">b2
</span><a href="#local-6989586621689655368"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621689655367"><span class="annot"><span class="annottext">Rule m a2 b2
</span><a href="#local-6989586621689655367"><span class="hs-identifier hs-var">g'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses
-&gt; Either b1 b2 -&gt; Rule m (Either a1 a2) (Either b1 b2) -&gt; m r
</span><a href="#local-6989586621689655375"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655369"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b2 -&gt; Either b1 b2
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">b2
</span><a href="#local-6989586621689655368"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule m a1 b1
-&gt; Rule m a2 b2 -&gt; Rule m (Either a1 a2) (Either b1 b2)
</span><a href="#local-6989586621689655380"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a1 b1
</span><a href="#local-6989586621689655382"><span class="hs-identifier hs-var">f0</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a2 b2
</span><a href="#local-6989586621689655367"><span class="hs-identifier hs-var">g'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">0</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFork"><span class="hs-pragma hs-type">rFork</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="hs-comment">-- see Note [Desugaring derived operations]</span><span>
</span><span id="line-211"></span><span class="hs-pragma">{-# RULES</span><span> </span><span class="annot"><span class="hs-pragma">&quot;+++/push&quot;</span></span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">~</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655366"><span class="annot"><a href="#local-6989586621689655366"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655365"><span class="annot"><a href="#local-6989586621689655365"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="#local-6989586621689655366"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rFork</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="#local-6989586621689655365"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rRight"><span class="hs-pragma hs-type">rRight</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655365"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rLeft"><span class="hs-pragma hs-type">rLeft</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655366"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span id="local-6989586621689655364"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#fromEither"><span class="hs-identifier hs-type">fromEither</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621689655364"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655364"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689655364"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-214"></span><span id="fromEither"><span class="annot"><span class="annottext">fromEither :: Either a a -&gt; a
</span><a href="Hasura.Incremental.Internal.Rule.html#fromEither"><span class="hs-identifier hs-var hs-var">fromEither</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; Either a a -&gt; a
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall k (cat :: k -&gt; k -&gt; *) (a :: k). Category cat =&gt; cat a a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall k (cat :: k -&gt; k -&gt; *) (a :: k). Category cat =&gt; cat a a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-215"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">0</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#fromEither"><span class="hs-pragma hs-type">fromEither</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span id="local-6989586621689655358"><span id="local-6989586621689655359"><span id="local-6989586621689655360"><span id="local-6989586621689655361"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFanin"><span class="hs-identifier hs-type">rFanin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655361"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655360"><span class="hs-identifier hs-type">a1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655359"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655361"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655358"><span class="hs-identifier hs-type">a2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655359"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655361"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621689655360"><span class="hs-identifier hs-type">a1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655358"><span class="hs-identifier hs-type">a2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689655359"><span class="hs-identifier hs-type">b</span></a></span></span></span></span></span><span>
</span><span id="line-218"></span><span id="local-6989586621689655356"><span class="annot"><span class="annottext">Rule m a1 b
</span><a href="#local-6989586621689655356"><span class="hs-identifier hs-var">f0</span></a></span></span><span> </span><span id="rFanin"><span class="annot"><span class="annottext">rFanin :: Rule m a1 b -&gt; Rule m a2 b -&gt; Rule m (Either a1 a2) b
</span><a href="Hasura.Incremental.Internal.Rule.html#rFanin"><span class="hs-operator hs-var hs-var">`rFanin`</span></a></span></span><span> </span><span id="local-6989586621689655355"><span class="annot"><span class="annottext">Rule m a2 b
</span><a href="#local-6989586621689655355"><span class="hs-identifier hs-var">g0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m a1 b -&gt; Rule m a2 b -&gt; Rule m (Either a1 a2) b
</span><a href="#local-6989586621689655354"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a1 b
</span><a href="#local-6989586621689655356"><span class="hs-identifier hs-var">f0</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a2 b
</span><a href="#local-6989586621689655355"><span class="hs-identifier hs-var">g0</span></a></span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-220"></span><span>    </span><span id="local-6989586621689655354"><span class="annot"><span class="annottext">go :: Rule m a1 b -&gt; Rule m a2 b -&gt; Rule m (Either a1 a2) b
</span><a href="#local-6989586621689655354"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span id="local-6989586621689655353"><span class="annot"><span class="annottext">forall r.
Accesses -&gt; a1 -&gt; (Accesses -&gt; b -&gt; Rule m a1 b -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655353"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span id="local-6989586621689655352"><span class="annot"><span class="annottext">forall r.
Accesses -&gt; a2 -&gt; (Accesses -&gt; b -&gt; Rule m a2 b -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655352"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall r.
 Accesses
 -&gt; Either a1 a2
 -&gt; (Accesses -&gt; b -&gt; Rule m (Either a1 a2) b -&gt; m r)
 -&gt; m r)
-&gt; Rule m (Either a1 a2) b
forall (m :: * -&gt; *) a b.
(forall r.
 Accesses -&gt; a -&gt; (Accesses -&gt; b -&gt; Rule m a b -&gt; m r) -&gt; m r)
-&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-var">Rule</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655351"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655351"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621689655350"><span class="annot"><span class="annottext">Either a1 a2
</span><a href="#local-6989586621689655350"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621689655349"><span class="annot"><span class="annottext">Accesses -&gt; b -&gt; Rule m (Either a1 a2) b -&gt; m r
</span><a href="#local-6989586621689655349"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either a1 a2
</span><a href="#local-6989586621689655350"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-221"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621689655348"><span class="annot"><a href="#local-6989586621689655348"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; a1 -&gt; (Accesses -&gt; b -&gt; Rule m a1 b -&gt; m r) -&gt; m r
forall r.
Accesses -&gt; a1 -&gt; (Accesses -&gt; b -&gt; Rule m a1 b -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655353"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655351"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">a1
</span><a href="#local-6989586621689655348"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655347"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655347"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span id="local-6989586621689655346"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689655346"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621689655345"><span class="annot"><span class="annottext">Rule m a1 b
</span><a href="#local-6989586621689655345"><span class="hs-identifier hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; b -&gt; Rule m (Either a1 a2) b -&gt; m r
</span><a href="#local-6989586621689655349"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655347"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689655346"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule m a1 b -&gt; Rule m a2 b -&gt; Rule m (Either a1 a2) b
</span><a href="#local-6989586621689655354"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a1 b
</span><a href="#local-6989586621689655345"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a2 b
</span><a href="#local-6989586621689655355"><span class="hs-identifier hs-var">g0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621689655344"><span class="annot"><a href="#local-6989586621689655344"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; a2 -&gt; (Accesses -&gt; b -&gt; Rule m a2 b -&gt; m r) -&gt; m r
forall r.
Accesses -&gt; a2 -&gt; (Accesses -&gt; b -&gt; Rule m a2 b -&gt; m r) -&gt; m r
</span><a href="#local-6989586621689655352"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655351"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">a2
</span><a href="#local-6989586621689655344"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655343"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655343"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span id="local-6989586621689655342"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689655342"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621689655341"><span class="annot"><span class="annottext">Rule m a2 b
</span><a href="#local-6989586621689655341"><span class="hs-identifier hs-var">g'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses -&gt; b -&gt; Rule m (Either a1 a2) b -&gt; m r
</span><a href="#local-6989586621689655349"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655343"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689655342"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule m a1 b -&gt; Rule m a2 b -&gt; Rule m (Either a1 a2) b
</span><a href="#local-6989586621689655354"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a1 b
</span><a href="#local-6989586621689655356"><span class="hs-identifier hs-var">f0</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a2 b
</span><a href="#local-6989586621689655341"><span class="hs-identifier hs-var">g'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">0</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rFanin"><span class="hs-pragma hs-type">rFanin</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="hs-comment">-- see Note [Desugaring derived operations]</span><span>
</span><span id="line-226"></span><span class="hs-pragma">{-# RULES</span><span> </span><span class="annot"><span class="hs-pragma">&quot;|||/push&quot;</span></span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">~</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689655340"><span class="annot"><a href="#local-6989586621689655340"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655339"><span class="annot"><a href="#local-6989586621689655339"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="#local-6989586621689655340"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">rFanin</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="#local-6989586621689655339"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-pragma hs-type">rArr</span></a></span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#fromEither"><span class="hs-pragma hs-type">fromEither</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689655340"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">+++</span></span><span> </span><span class="annot"><a href="#local-6989586621689655339"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span id="local-6989586621689655336"><span id="local-6989586621689655337"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621689655333"><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655337"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655336"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-229"></span><span>  </span><span id="local-6989586621689655332"><span class="annot"><span class="annottext">fmap :: (a -&gt; b) -&gt; Rule m a a -&gt; Rule m a b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">fmap</span></span></span><span> </span><span id="local-6989586621689655331"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621689655331"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655330"><span class="annot"><span class="annottext">Rule m a a
</span><a href="#local-6989586621689655330"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; Rule m a b
forall (a :: * -&gt; * -&gt; *) b c. Arrow a =&gt; (b -&gt; c) -&gt; a b c
</span><span class="hs-identifier hs-var">arr</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621689655331"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a b -&gt; Rule m a a -&gt; Rule m a b
forall k (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Rule m a a
</span><a href="#local-6989586621689655330"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">fmap</span></span><span> </span><span class="hs-pragma">#-}</span></span></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span id="local-6989586621689655328"><span id="local-6989586621689655329"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621689655320"><span id="local-6989586621689655322"><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655329"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655328"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-233"></span><span>  </span><span id="local-6989586621689655318"><span class="annot"><span class="annottext">pure :: a -&gt; Rule m a a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">pure</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Rule m a a
forall b (m :: * -&gt; *) a. b -&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#rPure"><span class="hs-identifier hs-var">rPure</span></a></span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">pure</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-235"></span><span>  </span><span id="local-6989586621689655317"><span class="annot"><span class="annottext">&lt;*&gt; :: Rule m a (a -&gt; b) -&gt; Rule m a a -&gt; Rule m a b
</span><span class="hs-operator hs-var hs-var hs-var hs-var">(&lt;*&gt;)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a -&gt; b) -&gt; a -&gt; b)
-&gt; Rule m a (a -&gt; b) -&gt; Rule m a a -&gt; Rule m a b
forall (f :: * -&gt; *) a b c.
Applicative f =&gt;
(a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><span class="hs-identifier hs-var">liftA2</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; a -&gt; b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">($)</span></span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">&lt;*&gt;</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-237"></span><span>  </span><span id="local-6989586621689655315"><span class="annot"><span class="annottext">liftA2 :: (a -&gt; b -&gt; c) -&gt; Rule m a a -&gt; Rule m a b -&gt; Rule m a c
</span><a href="#local-6989586621689655315"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftA2</span></a></span></span><span> </span><span id="local-6989586621689655314"><span class="annot"><span class="annottext">a -&gt; b -&gt; c
</span><a href="#local-6989586621689655314"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655313"><span class="annot"><span class="annottext">Rule m a a
</span><a href="#local-6989586621689655313"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621689655312"><span class="annot"><span class="annottext">Rule m a b
</span><a href="#local-6989586621689655312"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, b) -&gt; c) -&gt; Rule m (a, b) c
forall (a :: * -&gt; * -&gt; *) b c. Arrow a =&gt; (b -&gt; c) -&gt; a b c
</span><span class="hs-identifier hs-var">arr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; c
</span><a href="#local-6989586621689655314"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Rule m (a, b) c -&gt; Rule m a (a, b) -&gt; Rule m a c
forall k (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule m a a
</span><a href="#local-6989586621689655313"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m a a -&gt; Rule m a b -&gt; Rule m a (a, b)
forall (a :: * -&gt; * -&gt; *) b c c'.
Arrow a =&gt;
a b c -&gt; a b c' -&gt; a b (c, c')
</span><span class="hs-operator hs-var">&amp;&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Rule m a b
</span><a href="#local-6989586621689655312"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">liftA2</span></span><span> </span><span class="hs-pragma">#-}</span></span></span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span id="local-6989586621689655309"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621689655302"><span id="local-6989586621689655304"><span class="annot"><span class="hs-identifier hs-type">Profunctor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655309"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-241"></span><span>  </span><span id="local-6989586621689655300"><span class="annot"><span class="annottext">dimap :: (a -&gt; b) -&gt; (c -&gt; d) -&gt; Rule m b c -&gt; Rule m a d
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">dimap</span></span></span><span> </span><span id="local-6989586621689655298"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621689655298"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655297"><span class="annot"><span class="annottext">c -&gt; d
</span><a href="#local-6989586621689655297"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621689655296"><span class="annot"><span class="annottext">Rule m b c
</span><a href="#local-6989586621689655296"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(c -&gt; d) -&gt; Rule m c d
forall (a :: * -&gt; * -&gt; *) b c. Arrow a =&gt; (b -&gt; c) -&gt; a b c
</span><span class="hs-identifier hs-var">arr</span></span><span> </span><span class="annot"><span class="annottext">c -&gt; d
</span><a href="#local-6989586621689655297"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m c d -&gt; Rule m a c -&gt; Rule m a d
forall k (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Rule m b c
</span><a href="#local-6989586621689655296"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m b c -&gt; Rule m a b -&gt; Rule m a c
forall k (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; Rule m a b
forall (a :: * -&gt; * -&gt; *) b c. Arrow a =&gt; (b -&gt; c) -&gt; a b c
</span><span class="hs-identifier hs-var">arr</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621689655298"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">dimap</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-243"></span><span>  </span><span id="local-6989586621689655295"><span class="annot"><span class="annottext">lmap :: (a -&gt; b) -&gt; Rule m b c -&gt; Rule m a c
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">lmap</span></span></span><span> </span><span id="local-6989586621689655293"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621689655293"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689655292"><span class="annot"><span class="annottext">Rule m b c
</span><a href="#local-6989586621689655292"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m b c
</span><a href="#local-6989586621689655292"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m b c -&gt; Rule m a b -&gt; Rule m a c
forall k (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; Rule m a b
forall (a :: * -&gt; * -&gt; *) b c. Arrow a =&gt; (b -&gt; c) -&gt; a b c
</span><span class="hs-identifier hs-var">arr</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621689655293"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">lmap</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-245"></span><span>  </span><span id="local-6989586621689655291"><span class="annot"><span class="annottext">rmap :: (b -&gt; c) -&gt; Rule m a b -&gt; Rule m a c
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">rmap</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; c) -&gt; Rule m a b -&gt; Rule m a c
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">rmap</span></span><span> </span><span class="hs-pragma">#-}</span></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span id="local-6989586621689655289"><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Strong</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655289"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-249"></span><span>  </span><span id="local-6989586621689655284"><span class="annot"><span class="annottext">first' :: Rule m a b -&gt; Rule m (a, c) (b, c)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">first'</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m a b -&gt; Rule m (a, c) (b, c)
forall (m :: * -&gt; *) a b1 b2.
Rule m a b1 -&gt; Rule m (a, b2) (b1, b2)
</span><a href="Hasura.Incremental.Internal.Rule.html#rFirst"><span class="hs-identifier hs-var">rFirst</span></a></span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">first'</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-251"></span><span>  </span><span id="local-6989586621689655282"><span class="annot"><span class="annottext">second' :: Rule m a b -&gt; Rule m (c, a) (c, b)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">second'</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m a b -&gt; Rule m (c, a) (c, b)
forall (m :: * -&gt; *) a1 b a2.
Rule m a1 b -&gt; Rule m (a2, a1) (a2, b)
</span><a href="Hasura.Incremental.Internal.Rule.html#rSecond"><span class="hs-identifier hs-var">rSecond</span></a></span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">second'</span></span><span> </span><span class="hs-pragma">#-}</span></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span id="local-6989586621689655280"><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Choice</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655280"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-255"></span><span>  </span><span id="local-6989586621689655275"><span class="annot"><span class="annottext">left' :: Rule m a b -&gt; Rule m (Either a c) (Either b c)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">left'</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m a b -&gt; Rule m (Either a c) (Either b c)
forall (m :: * -&gt; *) a b c.
Rule m a b -&gt; Rule m (Either a c) (Either b c)
</span><a href="Hasura.Incremental.Internal.Rule.html#rLeft"><span class="hs-identifier hs-var">rLeft</span></a></span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">left'</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-257"></span><span>  </span><span id="local-6989586621689655273"><span class="annot"><span class="annottext">right' :: Rule m a b -&gt; Rule m (Either c a) (Either c b)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">right'</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m a b -&gt; Rule m (Either c a) (Either c b)
forall (m :: * -&gt; *) a b c.
Rule m a b -&gt; Rule m (Either c a) (Either c b)
</span><a href="Hasura.Incremental.Internal.Rule.html#rRight"><span class="hs-identifier hs-var">rRight</span></a></span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">right'</span></span><span> </span><span class="hs-pragma">#-}</span></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span id="local-6989586621689655271"><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Category</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655271"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-261"></span><span>  </span><span id="local-6989586621689655267"><span class="annot"><span class="annottext">id :: Rule m a a
</span><a href="#local-6989586621689655267"><span class="hs-identifier hs-var hs-var hs-var hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m a a
forall (m :: * -&gt; *) a. Rule m a a
</span><a href="Hasura.Incremental.Internal.Rule.html#rId"><span class="hs-identifier hs-var">rId</span></a></span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">id</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-263"></span><span>  </span><span id="local-6989586621689655266"><span class="annot"><span class="annottext">. :: Rule m b c -&gt; Rule m a b -&gt; Rule m a c
</span><a href="#local-6989586621689655266"><span class="hs-operator hs-var hs-var hs-var hs-var">(.)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m b c -&gt; Rule m a b -&gt; Rule m a c
forall (m :: * -&gt; *) a1 b a2.
Rule m a1 b -&gt; Rule m a2 a1 -&gt; Rule m a2 b
</span><a href="Hasura.Incremental.Internal.Rule.html#rComp"><span class="hs-identifier hs-var">rComp</span></a></span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">.</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span id="local-6989586621689655265"><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Arrow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655265"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-267"></span><span>  </span><span id="local-6989586621689655257"><span class="annot"><span class="annottext">arr :: (b -&gt; c) -&gt; Rule m b c
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">arr</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; c) -&gt; Rule m b c
forall a b (m :: * -&gt; *). (a -&gt; b) -&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#rArr"><span class="hs-identifier hs-var">rArr</span></a></span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-269"></span><span>  </span><span id="local-6989586621689655256"><span class="annot"><span class="annottext">first :: Rule m b c -&gt; Rule m (b, d) (c, d)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">first</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m b c -&gt; Rule m (b, d) (c, d)
forall (m :: * -&gt; *) a b1 b2.
Rule m a b1 -&gt; Rule m (a, b2) (b1, b2)
</span><a href="Hasura.Incremental.Internal.Rule.html#rFirst"><span class="hs-identifier hs-var">rFirst</span></a></span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">first</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-271"></span><span>  </span><span id="local-6989586621689655255"><span class="annot"><span class="annottext">second :: Rule m b c -&gt; Rule m (d, b) (d, c)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">second</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m b c -&gt; Rule m (d, b) (d, c)
forall (m :: * -&gt; *) a1 b a2.
Rule m a1 b -&gt; Rule m (a2, a1) (a2, b)
</span><a href="Hasura.Incremental.Internal.Rule.html#rSecond"><span class="hs-identifier hs-var">rSecond</span></a></span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">second</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-273"></span><span>  </span><span id="local-6989586621689655253"><span class="annot"><span class="annottext">*** :: Rule m b c -&gt; Rule m b' c' -&gt; Rule m (b, b') (c, c')
</span><a href="#local-6989586621689655253"><span class="hs-operator hs-var hs-var hs-var hs-var">(***)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m b c -&gt; Rule m b' c' -&gt; Rule m (b, b') (c, c')
forall (m :: * -&gt; *) a1 b1 a2 b2.
Rule m a1 b1 -&gt; Rule m a2 b2 -&gt; Rule m (a1, a2) (b1, b2)
</span><a href="Hasura.Incremental.Internal.Rule.html#rSplit"><span class="hs-identifier hs-var">rSplit</span></a></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">***</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-275"></span><span>  </span><span id="local-6989586621689655252"><span class="annot"><span class="annottext">&amp;&amp;&amp; :: Rule m b c -&gt; Rule m b c' -&gt; Rule m b (c, c')
</span><a href="#local-6989586621689655252"><span class="hs-operator hs-var hs-var hs-var hs-var">(&amp;&amp;&amp;)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m b c -&gt; Rule m b c' -&gt; Rule m b (c, c')
forall (m :: * -&gt; *) a b1 b2.
Rule m a b1 -&gt; Rule m a b2 -&gt; Rule m a (b1, b2)
</span><a href="Hasura.Incremental.Internal.Rule.html#rFanout"><span class="hs-identifier hs-var">rFanout</span></a></span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">&amp;&amp;&amp;</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span id="local-6989586621689655251"><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ArrowChoice</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655251"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-279"></span><span>  </span><span id="local-6989586621689655244"><span class="annot"><span class="annottext">left :: Rule m b c -&gt; Rule m (Either b d) (Either c d)
</span><a href="#local-6989586621689655244"><span class="hs-identifier hs-var hs-var hs-var hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m b c -&gt; Rule m (Either b d) (Either c d)
forall (m :: * -&gt; *) a b c.
Rule m a b -&gt; Rule m (Either a c) (Either b c)
</span><a href="Hasura.Incremental.Internal.Rule.html#rLeft"><span class="hs-identifier hs-var">rLeft</span></a></span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">left</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-281"></span><span>  </span><span id="local-6989586621689655243"><span class="annot"><span class="annottext">right :: Rule m b c -&gt; Rule m (Either d b) (Either d c)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">right</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m b c -&gt; Rule m (Either d b) (Either d c)
forall (m :: * -&gt; *) a b c.
Rule m a b -&gt; Rule m (Either c a) (Either c b)
</span><a href="Hasura.Incremental.Internal.Rule.html#rRight"><span class="hs-identifier hs-var">rRight</span></a></span><span>
</span><span id="line-282"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">right</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-283"></span><span>  </span><span id="local-6989586621689655241"><span class="annot"><span class="annottext">+++ :: Rule m b c -&gt; Rule m b' c' -&gt; Rule m (Either b b') (Either c c')
</span><a href="#local-6989586621689655241"><span class="hs-operator hs-var hs-var hs-var hs-var">(+++)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m b c -&gt; Rule m b' c' -&gt; Rule m (Either b b') (Either c c')
forall (m :: * -&gt; *) b c b' c'.
Rule m b c -&gt; Rule m b' c' -&gt; Rule m (Either b b') (Either c c')
</span><a href="Hasura.Incremental.Internal.Rule.html#rFork"><span class="hs-identifier hs-var">rFork</span></a></span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">+++</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-285"></span><span>  </span><span id="local-6989586621689655240"><span class="annot"><span class="annottext">||| :: Rule m b d -&gt; Rule m c d -&gt; Rule m (Either b c) d
</span><span class="hs-operator hs-var hs-var hs-var hs-var">(|||)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m b d -&gt; Rule m c d -&gt; Rule m (Either b c) d
forall (m :: * -&gt; *) b d c.
Rule m b d -&gt; Rule m c d -&gt; Rule m (Either b c) d
</span><a href="Hasura.Incremental.Internal.Rule.html#rFanin"><span class="hs-identifier hs-var">rFanin</span></a></span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">|||</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span id="local-6989586621689655239"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621689655239"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#ArrowKleisli"><span class="hs-identifier hs-type">ArrowKleisli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655239"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655239"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-289"></span><span>  </span><span id="local-6989586621689655234"><span class="annot"><span class="annottext">arrM :: (a -&gt; m b) -&gt; Rule m a b
</span><a href="Control.Arrow.Extended.html#arrM"><span class="hs-identifier hs-var hs-var hs-var hs-var">arrM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; m b) -&gt; Rule m a b
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#rArrM"><span class="hs-identifier hs-var">rArrM</span></a></span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="hs-pragma">#-}</span></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Arrow</span></span><span> </span><span class="annot"><a href="#local-6989586621689655614"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="ArrowDistribute"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#ArrowDistribute"><span class="hs-identifier hs-var">ArrowDistribute</span></a></span></span><span> </span><span id="local-6989586621689655614"><span class="annot"><a href="#local-6989586621689655614"><span class="hs-identifier hs-type">arr</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-comment">-- | Distributes an arrow that operates on key-value pairs, over a 'HM.HashMap' in an</span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-comment">-- order-independent way.</span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-comment">-- This is intended to be used as a control operator in @proc@ notation; see</span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-comment">-- Note [Weird control operator types] in &quot;Control.Arrow.Extended&quot;.</span><span>
</span><span id="line-298"></span><span>  </span><span id="local-6989586621689655617"><span id="local-6989586621689655618"><span id="local-6989586621689655619"><span id="local-6989586621689655620"><span id="local-6989586621689655622"><span id="keyed"><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#keyed"><span class="hs-identifier hs-type">keyed</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-299"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621689655622"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621689655622"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-300"></span><span>    </span><span class="annot"><a href="#local-6989586621689655614"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655620"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655622"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655619"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689655618"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689655617"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-301"></span><span>    </span><span class="annot"><a href="#local-6989586621689655614"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655620"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="#local-6989586621689655622"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655619"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689655618"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="#local-6989586621689655622"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655617"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span id="local-6989586621689655230"><span id="local-6989586621689655231"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621689655231"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#ArrowDistribute"><span class="hs-identifier hs-type">ArrowDistribute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655230"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#ArrowDistribute"><span class="hs-identifier hs-type">ArrowDistribute</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Arrow.Trans.html#WriterA"><span class="hs-identifier hs-type">WriterA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655231"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655230"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-304"></span><span>  </span><span id="local-6989586621689655226"><span class="annot"><span class="annottext">keyed :: WriterA w arr (e, (k, (a, s))) b
-&gt; WriterA w arr (e, (HashMap k a, s)) (HashMap k b)
</span><a href="#local-6989586621689655226"><span class="hs-identifier hs-var hs-var hs-var hs-var">keyed</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Arrow.Trans.html#WriterA"><span class="hs-identifier hs-type">WriterA</span></a></span><span> </span><span id="local-6989586621689655224"><span class="annot"><span class="annottext">arr (e, (k, (a, s))) (b, w)
</span><a href="#local-6989586621689655224"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">arr (e, (HashMap k a, s)) (HashMap k b, w)
-&gt; WriterA w arr (e, (HashMap k a, s)) (HashMap k b)
forall w (arr :: * -&gt; * -&gt; *) a b.
(Monoid w, Arrow arr) =&gt;
arr a (b, w) -&gt; WriterA w arr a b
</span><a href="Control.Arrow.Trans.html#WriterA"><span class="hs-identifier hs-var">WriterA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HashMap k (b, w) -&gt; (HashMap k b, w))
-&gt; arr (HashMap k (b, w)) (HashMap k b, w)
forall (a :: * -&gt; * -&gt; *) b c. Arrow a =&gt; (b -&gt; c) -&gt; a b c
</span><span class="hs-identifier hs-var">arr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(w, HashMap k b) -&gt; (HashMap k b, w)
forall a b. (a, b) -&gt; (b, a)
</span><span class="hs-identifier hs-var">swap</span></span><span> </span><span class="annot"><span class="annottext">((w, HashMap k b) -&gt; (HashMap k b, w))
-&gt; (HashMap k (b, w) -&gt; (w, HashMap k b))
-&gt; HashMap k (b, w)
-&gt; (HashMap k b, w)
forall k (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((b, w) -&gt; (w, b)) -&gt; HashMap k (b, w) -&gt; (w, HashMap k b)
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">(b, w) -&gt; (w, b)
forall a b. (a, b) -&gt; (b, a)
</span><span class="hs-identifier hs-var">swap</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">arr (HashMap k (b, w)) (HashMap k b, w)
-&gt; arr (e, (HashMap k a, s)) (HashMap k (b, w))
-&gt; arr (e, (HashMap k a, s)) (HashMap k b, w)
forall k (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">arr (e, (k, (a, s))) (b, w)
-&gt; arr (e, (HashMap k a, s)) (HashMap k (b, w))
forall (arr :: * -&gt; * -&gt; *) k e a s b.
(ArrowDistribute arr, Eq k, Hashable k) =&gt;
arr (e, (k, (a, s))) b -&gt; arr (e, (HashMap k a, s)) (HashMap k b)
</span><a href="Hasura.Incremental.Internal.Rule.html#keyed"><span class="hs-identifier hs-var">keyed</span></a></span><span> </span><span class="annot"><span class="annottext">arr (e, (k, (a, s))) (b, w)
</span><a href="#local-6989586621689655224"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#keyed"><span class="hs-pragma hs-type">keyed</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span class="hs-comment">-- | Unlike 'traverseA', using 'keyed' preserves incrementalization: if the input rule is</span><span>
</span><span id="line-308"></span><span class="hs-comment">-- incremental in its argument, the resulting rule will be incremental as well for any entries in</span><span>
</span><span id="line-309"></span><span class="hs-comment">-- the map that do not change between builds.</span><span>
</span><span id="line-310"></span><span id="local-6989586621689655222"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#ArrowDistribute"><span class="hs-identifier hs-type">ArrowDistribute</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655222"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-311"></span><span>  </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#keyed"><span class="hs-identifier hs-type">keyed</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689655219"><span class="annot"><a href="#local-6989586621689655219"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621689655218"><span class="annot"><a href="#local-6989586621689655218"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621689655217"><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621689655216"><span class="annot"><a href="#local-6989586621689655216"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621689655215"><span class="annot"><a href="#local-6989586621689655215"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-314"></span><span>    </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655222"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655216"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655219"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689655215"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689655218"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-315"></span><span>    </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655222"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655216"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655219"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689655215"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655218"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>  </span><span id="local-6989586621689655214"><span class="annot"><span class="annottext">keyed :: Rule m (e, (k, (a, s))) b
-&gt; Rule m (e, (HashMap k a, s)) (HashMap k b)
</span><a href="#local-6989586621689655214"><span class="hs-identifier hs-var hs-var hs-var hs-var">keyed</span></a></span></span><span> </span><span id="local-6989586621689655213"><span class="annot"><span class="annottext">Rule m (e, (k, (a, s))) b
</span><a href="#local-6989586621689655213"><span class="hs-identifier hs-var">r0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap k (Rule m (e, (k, (a, s))) b)
-&gt; Rule m (e, (HashMap k a, s)) (HashMap k b)
</span><a href="#local-6989586621689655212"><span class="hs-identifier hs-var">keyedWith</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap k (Rule m (e, (k, (a, s))) b)
forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span>
</span><span id="line-317"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-318"></span><span>      </span><span class="annot"><a href="#local-6989586621689655212"><span class="hs-identifier hs-type">keyedWith</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-319"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655222"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655216"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655219"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689655215"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689655218"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-320"></span><span>        </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655222"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655216"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655219"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689655215"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655218"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>      </span><span id="local-6989586621689655212"><span class="annot"><span class="annottext">keyedWith :: HashMap k (Rule m (e, (k, (a, s))) b)
-&gt; Rule m (e, (HashMap k a, s)) (HashMap k b)
</span><a href="#local-6989586621689655212"><span class="hs-identifier hs-var hs-var">keyedWith</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621689655210"><span class="annot"><span class="annottext">HashMap k (Rule m (e, (k, (a, s))) b)
</span><a href="#local-6989586621689655210"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall r.
 Accesses
 -&gt; (e, (HashMap k a, s))
 -&gt; (Accesses
     -&gt; HashMap k b
     -&gt; Rule m (e, (HashMap k a, s)) (HashMap k b)
     -&gt; m r)
 -&gt; m r)
-&gt; Rule m (e, (HashMap k a, s)) (HashMap k b)
forall (m :: * -&gt; *) a b.
(forall r.
 Accesses -&gt; a -&gt; (Accesses -&gt; b -&gt; Rule m a b -&gt; m r) -&gt; m r)
-&gt; Rule m a b
</span><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-var">Rule</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655209"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655209"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621689655208"><span class="annot"><a href="#local-6989586621689655208"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689655207"><span class="annot"><a href="#local-6989586621689655207"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689655206"><span class="annot"><a href="#local-6989586621689655206"><span class="hs-identifier hs-var">sk</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621689655205"><span class="annot"><span class="annottext">Accesses
-&gt; HashMap k b -&gt; Rule m (e, (HashMap k a, s)) (HashMap k b) -&gt; m r
</span><a href="#local-6989586621689655205"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-322"></span><span>        </span><span class="annot"><span class="annottext">(k
 -&gt; a
 -&gt; (Accesses
     -&gt; HashMap k b -&gt; HashMap k (Rule m (e, (k, (a, s))) b) -&gt; m r)
 -&gt; Accesses
 -&gt; HashMap k b
 -&gt; HashMap k (Rule m (e, (k, (a, s))) b)
 -&gt; m r)
-&gt; (Accesses
    -&gt; HashMap k b -&gt; HashMap k (Rule m (e, (k, (a, s))) b) -&gt; m r)
-&gt; HashMap k a
-&gt; Accesses
-&gt; HashMap k b
-&gt; HashMap k (Rule m (e, (k, (a, s))) b)
-&gt; m r
forall k v a. (k -&gt; v -&gt; a -&gt; a) -&gt; a -&gt; HashMap k v -&gt; a
</span><span class="hs-identifier hs-var">HM.foldrWithKey</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap k (Rule m (e, (k, (a, s))) b)
-&gt; e
-&gt; s
-&gt; k
-&gt; a
-&gt; (Accesses
    -&gt; HashMap k b -&gt; HashMap k (Rule m (e, (k, (a, s))) b) -&gt; m r)
-&gt; Accesses
-&gt; HashMap k b
-&gt; HashMap k (Rule m (e, (k, (a, s))) b)
-&gt; m r
forall r.
HashMap k (Rule m (e, (k, (a, s))) b)
-&gt; e
-&gt; s
-&gt; k
-&gt; a
-&gt; (Accesses
    -&gt; HashMap k b -&gt; HashMap k (Rule m (e, (k, (a, s))) b) -&gt; m r)
-&gt; Accesses
-&gt; HashMap k b
-&gt; HashMap k (Rule m (e, (k, (a, s))) b)
-&gt; m r
</span><a href="#local-6989586621689655203"><span class="hs-identifier hs-var">process</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap k (Rule m (e, (k, (a, s))) b)
</span><a href="#local-6989586621689655210"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621689655208"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621689655206"><span class="hs-identifier hs-var">sk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Accesses
 -&gt; HashMap k b
 -&gt; Rule m (e, (HashMap k a, s)) (HashMap k b)
 -&gt; m r)
-&gt; Accesses
-&gt; HashMap k b
-&gt; HashMap k (Rule m (e, (k, (a, s))) b)
-&gt; m r
forall r.
(Accesses
 -&gt; HashMap k b
 -&gt; Rule m (e, (HashMap k a, s)) (HashMap k b)
 -&gt; m r)
-&gt; Accesses
-&gt; HashMap k b
-&gt; HashMap k (Rule m (e, (k, (a, s))) b)
-&gt; m r
</span><a href="#local-6989586621689655202"><span class="hs-identifier hs-var">finish</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
-&gt; HashMap k b -&gt; Rule m (e, (HashMap k a, s)) (HashMap k b) -&gt; m r
</span><a href="#local-6989586621689655205"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap k a
</span><a href="#local-6989586621689655207"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655209"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap k b
forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span> </span><span class="annot"><span class="annottext">HashMap k (Rule m (e, (k, (a, s))) b)
forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span>      </span><span id="local-6989586621689655586"><span class="annot"><a href="#local-6989586621689655203"><span class="hs-identifier hs-type">process</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-325"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655222"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655216"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655219"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689655215"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689655218"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-326"></span><span>        </span><span class="annot"><a href="#local-6989586621689655216"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-327"></span><span>        </span><span class="annot"><a href="#local-6989586621689655215"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-328"></span><span>        </span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-329"></span><span>        </span><span class="annot"><a href="#local-6989586621689655219"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-330"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Dependency.html#Accesses"><span class="hs-identifier hs-type">Accesses</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655218"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655222"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655216"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655219"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689655215"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689655218"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689655222"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655586"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-331"></span><span>        </span><span class="annot"><a href="Hasura.Incremental.Internal.Dependency.html#Accesses"><span class="hs-identifier hs-type">Accesses</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-332"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655218"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-333"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655222"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655216"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655219"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689655215"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689655218"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-334"></span><span>        </span><span class="annot"><a href="#local-6989586621689655222"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655586"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-335"></span><span>      </span><span id="local-6989586621689655203"><span class="annot"><span class="annottext">process :: HashMap k (Rule m (e, (k, (a, s))) b)
-&gt; e
-&gt; s
-&gt; k
-&gt; a
-&gt; (Accesses
    -&gt; HashMap k b -&gt; HashMap k (Rule m (e, (k, (a, s))) b) -&gt; m r)
-&gt; Accesses
-&gt; HashMap k b
-&gt; HashMap k (Rule m (e, (k, (a, s))) b)
-&gt; m r
</span><a href="#local-6989586621689655203"><span class="hs-identifier hs-var hs-var">process</span></a></span></span><span> </span><span id="local-6989586621689655201"><span class="annot"><span class="annottext">HashMap k (Rule m (e, (k, (a, s))) b)
</span><a href="#local-6989586621689655201"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span id="local-6989586621689655200"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621689655200"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621689655199"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621689655199"><span class="hs-identifier hs-var">sk</span></a></span></span><span> </span><span id="local-6989586621689655198"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621689655198"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621689655197"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689655197"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621689655196"><span class="annot"><span class="annottext">Accesses
-&gt; HashMap k b -&gt; HashMap k (Rule m (e, (k, (a, s))) b) -&gt; m r
</span><a href="#local-6989586621689655196"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621689655195"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655195"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621689655194"><span class="annot"><span class="annottext">HashMap k b
</span><a href="#local-6989586621689655194"><span class="hs-identifier hs-var">vs'</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621689655193"><span class="annot"><span class="annottext">HashMap k (Rule m (e, (k, (a, s))) b)
</span><a href="#local-6989586621689655193"><span class="hs-identifier hs-var">rs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-336"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span id="local-6989586621689655192"><span class="annot"><span class="annottext">forall r.
Accesses
-&gt; (e, (k, (a, s)))
-&gt; (Accesses -&gt; b -&gt; Rule m (e, (k, (a, s))) b -&gt; m r)
-&gt; m r
</span><a href="#local-6989586621689655192"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule m (e, (k, (a, s))) b
-&gt; k
-&gt; HashMap k (Rule m (e, (k, (a, s))) b)
-&gt; Rule m (e, (k, (a, s))) b
forall k v. (Eq k, Hashable k) =&gt; v -&gt; k -&gt; HashMap k v -&gt; v
</span><span class="hs-identifier hs-var">HM.lookupDefault</span></span><span> </span><span class="annot"><span class="annottext">Rule m (e, (k, (a, s))) b
</span><a href="#local-6989586621689655213"><span class="hs-identifier hs-var">r0</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621689655198"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap k (Rule m (e, (k, (a, s))) b)
</span><a href="#local-6989586621689655201"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-337"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Accesses
-&gt; (e, (k, (a, s)))
-&gt; (Accesses -&gt; b -&gt; Rule m (e, (k, (a, s))) b -&gt; m r)
-&gt; m r
forall r.
Accesses
-&gt; (e, (k, (a, s)))
-&gt; (Accesses -&gt; b -&gt; Rule m (e, (k, (a, s))) b -&gt; m r)
-&gt; m r
</span><a href="#local-6989586621689655192"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655195"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621689655200"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621689655198"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689655197"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621689655199"><span class="hs-identifier hs-var">sk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689655190"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655190"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span id="local-6989586621689655189"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689655189"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621689655188"><span class="annot"><span class="annottext">Rule m (e, (k, (a, s))) b
</span><a href="#local-6989586621689655188"><span class="hs-identifier hs-var">r'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Accesses
-&gt; HashMap k b -&gt; HashMap k (Rule m (e, (k, (a, s))) b) -&gt; m r
</span><a href="#local-6989586621689655196"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655190"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; b -&gt; HashMap k b -&gt; HashMap k b
forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insert</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621689655198"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689655189"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap k b
</span><a href="#local-6989586621689655194"><span class="hs-identifier hs-var">vs'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k
-&gt; Rule m (e, (k, (a, s))) b
-&gt; HashMap k (Rule m (e, (k, (a, s))) b)
-&gt; HashMap k (Rule m (e, (k, (a, s))) b)
forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insert</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621689655198"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Rule m (e, (k, (a, s))) b
</span><a href="#local-6989586621689655188"><span class="hs-identifier hs-var">r'</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap k (Rule m (e, (k, (a, s))) b)
</span><a href="#local-6989586621689655193"><span class="hs-identifier hs-var">rs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span>      </span><span id="local-6989586621689655585"><span class="annot"><a href="#local-6989586621689655202"><span class="hs-identifier hs-type">finish</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-340"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Dependency.html#Accesses"><span class="hs-identifier hs-type">Accesses</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655218"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655222"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655216"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655219"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689655215"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655218"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689655222"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655585"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-341"></span><span>        </span><span class="annot"><a href="Hasura.Incremental.Internal.Dependency.html#Accesses"><span class="hs-identifier hs-type">Accesses</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-342"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655218"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-343"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655222"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655216"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655217"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689655219"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689655215"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689655218"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-344"></span><span>        </span><span class="annot"><a href="#local-6989586621689655222"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689655585"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-345"></span><span>      </span><span id="local-6989586621689655202"><span class="annot"><span class="annottext">finish :: (Accesses
 -&gt; HashMap k b
 -&gt; Rule m (e, (HashMap k a, s)) (HashMap k b)
 -&gt; m r)
-&gt; Accesses
-&gt; HashMap k b
-&gt; HashMap k (Rule m (e, (k, (a, s))) b)
-&gt; m r
</span><a href="#local-6989586621689655202"><span class="hs-identifier hs-var hs-var">finish</span></a></span></span><span> </span><span id="local-6989586621689655186"><span class="annot"><span class="annottext">Accesses
-&gt; HashMap k b -&gt; Rule m (e, (HashMap k a, s)) (HashMap k b) -&gt; m r
</span><a href="#local-6989586621689655186"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621689655185"><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655185"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621689655184"><span class="annot"><span class="annottext">HashMap k b
</span><a href="#local-6989586621689655184"><span class="hs-identifier hs-var">vs'</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621689655183"><span class="annot"><span class="annottext">HashMap k (Rule m (e, (k, (a, s))) b)
</span><a href="#local-6989586621689655183"><span class="hs-identifier hs-var">rs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Accesses
-&gt; HashMap k b -&gt; Rule m (e, (HashMap k a, s)) (HashMap k b) -&gt; m r
</span><a href="#local-6989586621689655186"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Accesses
</span><a href="#local-6989586621689655185"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap k b
</span><a href="#local-6989586621689655184"><span class="hs-identifier hs-var">vs'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap k (Rule m (e, (k, (a, s))) b)
-&gt; Rule m (e, (HashMap k a, s)) (HashMap k b)
</span><a href="#local-6989586621689655212"><span class="hs-identifier hs-var">keyedWith</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap k (Rule m (e, (k, (a, s))) b)
</span><a href="#local-6989586621689655183"><span class="hs-identifier hs-var">rs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Hasura.Incremental.Internal.Rule.html#keyed"><span class="hs-pragma hs-type">keyed</span></a></span><span> </span><span class="hs-pragma">#-}</span></span><span>
</span><span id="line-347"></span></pre></body></html>