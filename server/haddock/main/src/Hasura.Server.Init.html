<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# OPTIONS_GHC -O0 #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">-- | Arg and Env Parsing for initialisation of the engine along with</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- corresponding logging and other helper functionality.</span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- This module is intended as the interface for options parsing and</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- its submodules should not need to be imported directly.</span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.Server.Init</span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Option Fetching and Merging</span></span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.html#mkHGEOptions"><span class="hs-identifier">mkHGEOptions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.html#mkServeOptions"><span class="hs-identifier">mkServeOptions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.html#processPostgresConnInfo"><span class="hs-identifier">processPostgresConnInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Metadata DB</span></span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.html#getDbId"><span class="hs-identifier">getDbId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.html#getPgVersion"><span class="hs-identifier">getPgVersion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Re-exports</span></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html"><span class="hs-identifier">Hasura.Server.Init.Config</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html"><span class="hs-identifier">Hasura.Server.Init.Env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.html"><span class="hs-identifier">Hasura.Server.Init.Arg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Logging.html"><span class="hs-identifier">Hasura.Server.Init.Logging</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">where</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashSet</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HashSet</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier">Database.PG.Query</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Query</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.html"><span class="hs-identifier">Hasura.Backends.Postgres.Connection</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Connection</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Base.Error.html"><span class="hs-identifier">Hasura.Base.Error</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Error</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.Options.html"><span class="hs-identifier">Hasura.GraphQL.Execute.Subscription.Options</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Subscription.Options</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.Options.html"><span class="hs-identifier">Hasura.GraphQL.Schema.Options</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Options</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Logging.html"><span class="hs-identifier">Hasura.Logging</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Logging</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier">Hasura.Prelude</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html"><span class="hs-identifier">Hasura.RQL.Types.Common</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Common</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Auth.html"><span class="hs-identifier">Hasura.Server.Auth</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Auth</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Cors.html"><span class="hs-identifier">Hasura.Server.Cors</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cors</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.html"><span class="hs-identifier">Hasura.Server.Init.Arg</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html"><span class="hs-identifier">Hasura.Server.Init.Config</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html"><span class="hs-identifier">Hasura.Server.Init.Env</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Logging.html"><span class="hs-identifier">Hasura.Server.Init.Logging</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Logging.html"><span class="hs-identifier">Hasura.Server.Logging</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Server.Logging</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html"><span class="hs-identifier">Hasura.Server.Types</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Types</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.WebSockets</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WebSockets</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Refined</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unrefine</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- TODO(SOLOMON): Where does this note belong?</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-comment">{- Note [ReadOnly Mode]
~~~~~~~~~~~~~~~~~~~~~~~~~

This mode starts the server in a (database) read-only mode. That is, only
read-only queries are allowed on users' database sources, and write
queries throw a runtime error. The use-case is for failsafe operations.
Metadata APIs are also disabled.

Following is the precise behaviour -
  1. For any GraphQL API (relay/hasura; http/websocket) - disable execution of
  mutations
  2. Metadata API is disabled
  3. /v2/query API - insert, delete, update, run_sql are disabled
  4. /v1/query API - insert, delete, update, run_sql are disabled
  5. No source catalog migrations are run
  6. During build schema cache phase, building event triggers are disabled (as
  they create corresponding database triggers)
-}</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- | Query the Metadata DB for the Metadata DB UUID.</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- TODO: Move into a dedicated Metadata module (ala Pro).</span><span>
</span><span id="line-76"></span><span class="annot"><a href="Hasura.Server.Init.html#getDbId"><span class="hs-identifier hs-type">getDbId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">Query.TxE</span></a></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">Error.QErr</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Types.html#MetadataDbId"><span class="hs-identifier hs-type">Types.MetadataDbId</span></a></span><span>
</span><span id="line-77"></span><span id="getDbId"><span class="annot"><span class="annottext">getDbId :: TxE QErr MetadataDbId
</span><a href="Hasura.Server.Init.html#getDbId"><span class="hs-identifier hs-var hs-var">getDbId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; MetadataDbId
</span><a href="Hasura.Server.Types.html#MetadataDbId"><span class="hs-identifier hs-var">Types.MetadataDbId</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; MetadataDbId)
-&gt; (SingleRow (Identity Text) -&gt; Text)
-&gt; SingleRow (Identity Text)
-&gt; MetadataDbId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Identity Text -&gt; Text
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity Text -&gt; Text)
-&gt; (SingleRow (Identity Text) -&gt; Identity Text)
-&gt; SingleRow (Identity Text)
-&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SingleRow (Identity Text) -&gt; Identity Text
forall a. SingleRow a -&gt; a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var hs-var">Query.getRow</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><span class="annottext">(SingleRow (Identity Text) -&gt; MetadataDbId)
-&gt; TxET QErr IO (SingleRow (Identity Text))
-&gt; TxE QErr MetadataDbId
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query -&gt; () -&gt; Bool -&gt; TxET QErr IO (SingleRow (Identity Text))
forall (m :: * -&gt; *) a r e.
(MonadIO m, FromRes a, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">Query.withQE</span></a></span><span>
</span><span id="line-80"></span><span>      </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">Connection.defaultTxErrorHandler</span></a></span><span>
</span><span id="line-81"></span><span>      </span><span class="annot"><span class="">[Query.sql|
    SELECT (hasura_uuid :: text) FROM hdb_catalog.hdb_version
  |]</span></span><span>
</span><span id="line-84"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="annot"><a href="Hasura.Server.Init.html#getPgVersion"><span class="hs-identifier hs-type">getPgVersion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">Query.TxE</span></a></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">Error.QErr</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Types.html#PGVersion"><span class="hs-identifier hs-type">Types.PGVersion</span></a></span><span>
</span><span id="line-88"></span><span id="getPgVersion"><span class="annot"><span class="annottext">getPgVersion :: TxE QErr PGVersion
</span><a href="Hasura.Server.Init.html#getPgVersion"><span class="hs-identifier hs-var hs-var">getPgVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; PGVersion
</span><a href="Hasura.Server.Types.html#PGVersion"><span class="hs-identifier hs-var">Types.PGVersion</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; PGVersion) -&gt; TxET QErr IO Int -&gt; TxE QErr PGVersion
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxET QErr IO Int
forall (m :: * -&gt; *) e. MonadIO m =&gt; TxET e m Int
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">Query.serverVersion</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-comment">-- | Given the 'ServeOptionsRaw' parsed from the arg parser,</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- postprocess the db url and fetch env vars associated with the main</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- command parser, then process the subcommand raw values if</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- necessary.</span><span>
</span><span id="line-96"></span><span id="local-6989586621689758189"><span class="annot"><a href="Hasura.Server.Init.html#mkHGEOptions"><span class="hs-identifier hs-type">mkHGEOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#EnabledLogTypes"><span class="hs-identifier hs-type">Logging.EnabledLogTypes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689758189"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#HGEOptionsRaw"><span class="hs-identifier hs-type">HGEOptionsRaw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptionsRaw"><span class="hs-identifier hs-type">ServeOptionsRaw</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689758189"><span class="hs-identifier hs-type">impl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#WithEnv"><span class="hs-identifier hs-type">WithEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#HGEOptions"><span class="hs-identifier hs-type">HGEOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptions"><span class="hs-identifier hs-type">ServeOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689758189"><span class="hs-identifier hs-type">impl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-98"></span><span id="mkHGEOptions"><span class="annot"><span class="annottext">mkHGEOptions :: HGEOptionsRaw (ServeOptionsRaw impl)
-&gt; WithEnv (HGEOptions (ServeOptions impl))
</span><a href="Hasura.Server.Init.html#mkHGEOptions"><span class="hs-identifier hs-var hs-var">mkHGEOptions</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#HGEOptionsRaw"><span class="hs-identifier hs-type">HGEOptionsRaw</span></a></span><span> </span><span id="local-6989586621689758187"><span class="annot"><span class="annottext">PostgresConnInfo (Maybe PostgresConnInfoRaw)
</span><a href="#local-6989586621689758187"><span class="hs-identifier hs-var">rawDbUrl</span></a></span></span><span> </span><span id="local-6989586621689758186"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621689758186"><span class="hs-identifier hs-var">rawMetadataDbUrl</span></a></span></span><span> </span><span id="local-6989586621689758185"><span class="annot"><span class="annottext">HGECommand (ServeOptionsRaw impl)
</span><a href="#local-6989586621689758185"><span class="hs-identifier hs-var">rawCmd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-99"></span><span>  </span><span id="local-6989586621689758184"><span class="annot"><span class="annottext">PostgresConnInfo (Maybe UrlConf)
</span><a href="#local-6989586621689758184"><span class="hs-identifier hs-var">dbUrl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PostgresConnInfo (Maybe PostgresConnInfoRaw)
-&gt; WithEnv (PostgresConnInfo (Maybe UrlConf))
</span><a href="Hasura.Server.Init.html#processPostgresConnInfo"><span class="hs-identifier hs-var">processPostgresConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">PostgresConnInfo (Maybe PostgresConnInfoRaw)
</span><a href="#local-6989586621689758187"><span class="hs-identifier hs-var">rawDbUrl</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span id="local-6989586621689758183"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621689758183"><span class="hs-identifier hs-var">metadataDbUrl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; Option () -&gt; WithEnvT Identity (Maybe String)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option () -&gt; WithEnvT m (Maybe option)
</span><a href="Hasura.Server.Init.Env.html#withOption"><span class="hs-identifier hs-var">withOption</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621689758186"><span class="hs-identifier hs-var">rawMetadataDbUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Option ()
</span><a href="Hasura.Server.Init.Arg.html#metadataDbUrlOption"><span class="hs-identifier hs-var">metadataDbUrlOption</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span id="local-6989586621689758180"><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
</span><a href="#local-6989586621689758180"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptionsRaw impl)
</span><a href="#local-6989586621689758185"><span class="hs-identifier hs-var">rawCmd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.Config.html#HCServe"><span class="hs-identifier hs-type">HCServe</span></a></span><span> </span><span id="local-6989586621689758178"><span class="annot"><span class="annottext">ServeOptionsRaw impl
</span><a href="#local-6989586621689758178"><span class="hs-identifier hs-var">rso</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServeOptions impl -&gt; HGECommand (ServeOptions impl)
forall a. a -&gt; HGECommand a
</span><a href="Hasura.Server.Init.Config.html#HCServe"><span class="hs-identifier hs-var">HCServe</span></a></span><span> </span><span class="annot"><span class="annottext">(ServeOptions impl -&gt; HGECommand (ServeOptions impl))
-&gt; WithEnvT Identity (ServeOptions impl)
-&gt; WithEnvT Identity (HGECommand (ServeOptions impl))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ServeOptionsRaw impl -&gt; WithEnvT Identity (ServeOptions impl)
forall impl.
EnabledLogTypes impl =&gt;
ServeOptionsRaw impl -&gt; WithEnv (ServeOptions impl)
</span><a href="Hasura.Server.Init.html#mkServeOptions"><span class="hs-identifier hs-var">mkServeOptions</span></a></span><span> </span><span class="annot"><span class="annottext">ServeOptionsRaw impl
</span><a href="#local-6989586621689758178"><span class="hs-identifier hs-var">rso</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span class="annot"><span class="annottext">HGECommand (ServeOptionsRaw impl)
</span><a href="Hasura.Server.Init.Config.html#HCExport"><span class="hs-identifier hs-var">HCExport</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
-&gt; WithEnvT Identity (HGECommand (ServeOptions impl))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
forall a. HGECommand a
</span><a href="Hasura.Server.Init.Config.html#HCExport"><span class="hs-identifier hs-var">HCExport</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><span class="annottext">HGECommand (ServeOptionsRaw impl)
</span><a href="Hasura.Server.Init.Config.html#HCClean"><span class="hs-identifier hs-var">HCClean</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
-&gt; WithEnvT Identity (HGECommand (ServeOptions impl))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
forall a. HGECommand a
</span><a href="Hasura.Server.Init.Config.html#HCClean"><span class="hs-identifier hs-var">HCClean</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><span class="annottext">HGECommand (ServeOptionsRaw impl)
</span><a href="Hasura.Server.Init.Config.html#HCVersion"><span class="hs-identifier hs-var">HCVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
-&gt; WithEnvT Identity (HGECommand (ServeOptions impl))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
forall a. HGECommand a
</span><a href="Hasura.Server.Init.Config.html#HCVersion"><span class="hs-identifier hs-var">HCVersion</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.Config.html#HCDowngrade"><span class="hs-identifier hs-type">HCDowngrade</span></a></span><span> </span><span id="local-6989586621689758173"><span class="annot"><span class="annottext">DowngradeOptions
</span><a href="#local-6989586621689758173"><span class="hs-identifier hs-var">tgt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
-&gt; WithEnvT Identity (HGECommand (ServeOptions impl))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DowngradeOptions -&gt; HGECommand (ServeOptions impl)
forall a. DowngradeOptions -&gt; HGECommand a
</span><a href="Hasura.Server.Init.Config.html#HCDowngrade"><span class="hs-identifier hs-var">HCDowngrade</span></a></span><span> </span><span class="annot"><span class="annottext">DowngradeOptions
</span><a href="#local-6989586621689758173"><span class="hs-identifier hs-var">tgt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><span class="annottext">HGEOptions (ServeOptions impl)
-&gt; WithEnv (HGEOptions (ServeOptions impl))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(HGEOptions (ServeOptions impl)
 -&gt; WithEnv (HGEOptions (ServeOptions impl)))
-&gt; HGEOptions (ServeOptions impl)
-&gt; WithEnv (HGEOptions (ServeOptions impl))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PostgresConnInfo (Maybe UrlConf)
-&gt; Maybe String
-&gt; HGECommand (ServeOptions impl)
-&gt; HGEOptions (ServeOptions impl)
forall impl.
PostgresConnInfo (Maybe UrlConf)
-&gt; Maybe String -&gt; HGECommand impl -&gt; HGEOptions impl
</span><a href="Hasura.Server.Init.Config.html#HGEOptions"><span class="hs-identifier hs-var">HGEOptions</span></a></span><span> </span><span class="annot"><span class="annottext">PostgresConnInfo (Maybe UrlConf)
</span><a href="#local-6989586621689758184"><span class="hs-identifier hs-var">dbUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621689758183"><span class="hs-identifier hs-var">metadataDbUrl</span></a></span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
</span><a href="#local-6989586621689758180"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">-- | 'PostressConnInfo' is a a tuple of some @a@ with a 'Maybe Int'</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- representing the retries setting. This function thus takes a</span><span>
</span><span id="line-111"></span><span class="hs-comment">-- retries setting and a 'PostgresConnInfoRaw' from the arg parser and</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- merges those results with the contents of their corresponding env</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- vars.</span><span>
</span><span id="line-114"></span><span class="annot"><a href="Hasura.Server.Init.html#processPostgresConnInfo"><span class="hs-identifier hs-type">processPostgresConnInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-115"></span><span>  </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresConnInfo"><span class="hs-identifier hs-type">PostgresConnInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresConnInfoRaw"><span class="hs-identifier hs-type">PostgresConnInfoRaw</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-116"></span><span>  </span><span class="annot"><a href="Hasura.Server.Init.Env.html#WithEnv"><span class="hs-identifier hs-type">WithEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresConnInfo"><span class="hs-identifier hs-type">PostgresConnInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#UrlConf"><span class="hs-identifier hs-type">Common.UrlConf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span id="processPostgresConnInfo"><span class="annot"><span class="annottext">processPostgresConnInfo :: PostgresConnInfo (Maybe PostgresConnInfoRaw)
-&gt; WithEnv (PostgresConnInfo (Maybe UrlConf))
</span><a href="Hasura.Server.Init.html#processPostgresConnInfo"><span class="hs-identifier hs-var hs-var">processPostgresConnInfo</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresConnInfo"><span class="hs-identifier hs-type">PostgresConnInfo</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621689758169"><span id="local-6989586621689758170"><span class="annot"><span class="annottext">Maybe Int
Maybe PostgresConnInfoRaw
_pciRetries :: forall a. PostgresConnInfo a -&gt; Maybe Int
_pciDatabaseConn :: forall a. PostgresConnInfo a -&gt; a
_pciRetries :: Maybe Int
_pciDatabaseConn :: Maybe PostgresConnInfoRaw
</span><a href="Hasura.Server.Init.Config.html#_pciRetries"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-118"></span><span>  </span><span id="local-6989586621689758166"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621689758166"><span class="hs-identifier hs-var">withEnvRetries</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Option () -&gt; WithEnvT Identity (Maybe Int)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option () -&gt; WithEnvT m (Maybe option)
</span><a href="Hasura.Server.Init.Env.html#withOption"><span class="hs-identifier hs-var">withOption</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621689758169"><span class="hs-identifier hs-var">_pciRetries</span></a></span><span> </span><span class="annot"><span class="annottext">Option ()
</span><a href="Hasura.Server.Init.Arg.html#retriesNumOption"><span class="hs-identifier hs-var">retriesNumOption</span></a></span><span>
</span><span id="line-119"></span><span>  </span><span id="local-6989586621689758164"><span class="annot"><span class="annottext">Maybe UrlConf
</span><a href="#local-6989586621689758164"><span class="hs-identifier hs-var">databaseUrl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe PostgresConnInfoRaw -&gt; WithEnv (Maybe UrlConf)
</span><a href="Hasura.Server.Init.html#rawConnInfoToUrlConf"><span class="hs-identifier hs-var">rawConnInfoToUrlConf</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PostgresConnInfoRaw
</span><a href="#local-6989586621689758170"><span class="hs-identifier hs-var">_pciDatabaseConn</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><span class="annottext">PostgresConnInfo (Maybe UrlConf)
-&gt; WithEnv (PostgresConnInfo (Maybe UrlConf))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(PostgresConnInfo (Maybe UrlConf)
 -&gt; WithEnv (PostgresConnInfo (Maybe UrlConf)))
-&gt; PostgresConnInfo (Maybe UrlConf)
-&gt; WithEnv (PostgresConnInfo (Maybe UrlConf))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe UrlConf -&gt; Maybe Int -&gt; PostgresConnInfo (Maybe UrlConf)
forall a. a -&gt; Maybe Int -&gt; PostgresConnInfo a
</span><a href="Hasura.Server.Init.Config.html#PostgresConnInfo"><span class="hs-identifier hs-var">PostgresConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UrlConf
</span><a href="#local-6989586621689758164"><span class="hs-identifier hs-var">databaseUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621689758166"><span class="hs-identifier hs-var">withEnvRetries</span></a></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-comment">-- | A helper function for 'processPostgresConnInfo' which fetches</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- postgres connection info from the 'WithEnv' and merges it with the</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- arg parser result.</span><span>
</span><span id="line-125"></span><span class="annot"><a href="Hasura.Server.Init.html#rawConnInfoToUrlConf"><span class="hs-identifier hs-type">rawConnInfoToUrlConf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresConnInfoRaw"><span class="hs-identifier hs-type">PostgresConnInfoRaw</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#WithEnv"><span class="hs-identifier hs-type">WithEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#UrlConf"><span class="hs-identifier hs-type">Common.UrlConf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span id="rawConnInfoToUrlConf"><span class="annot"><span class="annottext">rawConnInfoToUrlConf :: Maybe PostgresConnInfoRaw -&gt; WithEnv (Maybe UrlConf)
</span><a href="Hasura.Server.Init.html#rawConnInfoToUrlConf"><span class="hs-identifier hs-var hs-var">rawConnInfoToUrlConf</span></a></span></span><span> </span><span id="local-6989586621689758162"><span class="annot"><span class="annottext">Maybe PostgresConnInfoRaw
</span><a href="#local-6989586621689758162"><span class="hs-identifier hs-var">maybeRawConnInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-127"></span><span>  </span><span id="local-6989586621689758161"><span class="annot"><span class="annottext">[(String, String)]
</span><a href="#local-6989586621689758161"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WithEnvT Identity [(String, String)]
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689758159"><span class="annot"><span class="annottext">databaseUrlEnvVar :: String
</span><a href="#local-6989586621689758159"><span class="hs-identifier hs-var hs-var">databaseUrlEnvVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Option () -&gt; String
forall def. Option def -&gt; String
</span><a href="Hasura.Server.Init.Config.html#_envVar"><span class="hs-identifier hs-var hs-var">_envVar</span></a></span><span> </span><span class="annot"><span class="annottext">Option ()
</span><a href="Hasura.Server.Init.Arg.html#databaseUrlOption"><span class="hs-identifier hs-var">databaseUrlOption</span></a></span><span>
</span><span id="line-129"></span><span>      </span><span id="local-6989586621689758156"><span class="annot"><span class="annottext">hasDatabaseUrlEnv :: Bool
</span><a href="#local-6989586621689758156"><span class="hs-identifier hs-var hs-var">hasDatabaseUrlEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((String, String) -&gt; Bool) -&gt; [(String, String)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621689758159"><span class="hs-identifier hs-var">databaseUrlEnvVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Bool)
-&gt; ((String, String) -&gt; String) -&gt; (String, String) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, String)]
</span><a href="#local-6989586621689758161"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><span class="annottext">Maybe UrlConf -&gt; WithEnv (Maybe UrlConf)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe UrlConf -&gt; WithEnv (Maybe UrlConf))
-&gt; Maybe UrlConf -&gt; WithEnv (Maybe UrlConf)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe PostgresConnInfoRaw
</span><a href="#local-6989586621689758162"><span class="hs-identifier hs-var">maybeRawConnInfo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-comment">-- If no --database-url or connection options provided in CLI command</span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><span class="annottext">Maybe PostgresConnInfoRaw
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-134"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689758156"><span class="hs-identifier hs-var">hasDatabaseUrlEnv</span></a></span><span>
</span><span id="line-135"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-comment">-- Consider env variable as is in order to store it as @`UrlConf`</span><span>
</span><span id="line-136"></span><span>        </span><span class="hs-comment">-- in default source configuration in metadata</span><span>
</span><span id="line-137"></span><span>          </span><span class="annot"><span class="annottext">UrlConf -&gt; Maybe UrlConf
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(UrlConf -&gt; Maybe UrlConf) -&gt; UrlConf -&gt; Maybe UrlConf
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; UrlConf
</span><a href="Hasura.RQL.Types.Common.html#UrlFromEnv"><span class="hs-identifier hs-var">Common.UrlFromEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; UrlConf) -&gt; Text -&gt; UrlConf
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621689758159"><span class="hs-identifier hs-var">databaseUrlEnvVar</span></a></span><span>
</span><span id="line-138"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe UrlConf
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621689758152"><span class="annot"><span class="annottext">PostgresConnInfoRaw
</span><a href="#local-6989586621689758152"><span class="hs-identifier hs-var">databaseConn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-140"></span><span>      </span><span class="annot"><span class="annottext">UrlConf -&gt; Maybe UrlConf
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(UrlConf -&gt; Maybe UrlConf)
-&gt; (URLTemplate -&gt; UrlConf) -&gt; URLTemplate -&gt; Maybe UrlConf
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">InputWebhook -&gt; UrlConf
</span><a href="Hasura.RQL.Types.Common.html#UrlValue"><span class="hs-identifier hs-var">Common.UrlValue</span></a></span><span> </span><span class="annot"><span class="annottext">(InputWebhook -&gt; UrlConf)
-&gt; (URLTemplate -&gt; InputWebhook) -&gt; URLTemplate -&gt; UrlConf
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">URLTemplate -&gt; InputWebhook
</span><a href="Hasura.RQL.Types.Common.html#InputWebhook"><span class="hs-identifier hs-var">Common.InputWebhook</span></a></span><span> </span><span class="annot"><span class="annottext">(URLTemplate -&gt; Maybe UrlConf) -&gt; URLTemplate -&gt; Maybe UrlConf
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PostgresConnInfoRaw
</span><a href="#local-6989586621689758152"><span class="hs-identifier hs-var">databaseConn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-141"></span><span>        </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PGConnDatabaseUrl"><span class="hs-identifier hs-type">PGConnDatabaseUrl</span></a></span><span> </span><span id="local-6989586621689758148"><span class="annot"><span class="annottext">URLTemplate
</span><a href="#local-6989586621689758148"><span class="hs-identifier hs-var">urlTemplate</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">URLTemplate
</span><a href="#local-6989586621689758148"><span class="hs-identifier hs-var">urlTemplate</span></a></span><span>
</span><span id="line-142"></span><span>        </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PGConnDetails"><span class="hs-identifier hs-type">PGConnDetails</span></a></span><span> </span><span id="local-6989586621689758146"><span class="annot"><span class="annottext">PostgresConnDetailsRaw
</span><a href="#local-6989586621689758146"><span class="hs-identifier hs-var">connDetails</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PostgresConnDetailsRaw -&gt; URLTemplate
</span><a href="Hasura.Server.Init.Config.html#rawConnDetailsToUrl"><span class="hs-identifier hs-var">rawConnDetailsToUrl</span></a></span><span> </span><span class="annot"><span class="annottext">PostgresConnDetailsRaw
</span><a href="#local-6989586621689758146"><span class="hs-identifier hs-var">connDetails</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-comment">-- | Merge the results of the serve subcommmand arg parser with</span><span>
</span><span id="line-147"></span><span class="hs-comment">-- corresponding values from the 'WithEnv' context.</span><span>
</span><span id="line-148"></span><span class="annot"><a href="Hasura.Server.Init.html#mkServeOptions"><span class="hs-identifier hs-type">mkServeOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689758305"><span class="annot"><a href="#local-6989586621689758305"><span class="hs-identifier hs-type">impl</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Hasura.Logging.html#EnabledLogTypes"><span class="hs-identifier hs-type">Logging.EnabledLogTypes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689758305"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptionsRaw"><span class="hs-identifier hs-type">ServeOptionsRaw</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689758305"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#WithEnv"><span class="hs-identifier hs-type">WithEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptions"><span class="hs-identifier hs-type">ServeOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689758305"><span class="hs-identifier hs-type">impl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span id="mkServeOptions"><span class="annot"><span class="annottext">mkServeOptions :: ServeOptionsRaw impl -&gt; WithEnv (ServeOptions impl)
</span><a href="Hasura.Server.Init.html#mkServeOptions"><span class="hs-identifier hs-var hs-var">mkServeOptions</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptionsRaw"><span class="hs-identifier hs-type">ServeOptionsRaw</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621689758102"><span id="local-6989586621689758103"><span id="local-6989586621689758104"><span id="local-6989586621689758105"><span id="local-6989586621689758106"><span id="local-6989586621689758107"><span id="local-6989586621689758108"><span id="local-6989586621689758109"><span id="local-6989586621689758110"><span id="local-6989586621689758111"><span id="local-6989586621689758112"><span id="local-6989586621689758113"><span id="local-6989586621689758114"><span id="local-6989586621689758115"><span id="local-6989586621689758116"><span id="local-6989586621689758117"><span id="local-6989586621689758118"><span id="local-6989586621689758119"><span id="local-6989586621689758120"><span id="local-6989586621689758121"><span id="local-6989586621689758122"><span id="local-6989586621689758123"><span id="local-6989586621689758124"><span id="local-6989586621689758125"><span id="local-6989586621689758126"><span id="local-6989586621689758127"><span id="local-6989586621689758128"><span id="local-6989586621689758129"><span id="local-6989586621689758130"><span id="local-6989586621689758131"><span id="local-6989586621689758132"><span id="local-6989586621689758133"><span id="local-6989586621689758134"><span id="local-6989586621689758135"><span id="local-6989586621689758136"><span id="local-6989586621689758137"><span id="local-6989586621689758138"><span id="local-6989586621689758139"><span id="local-6989586621689758140"><span id="local-6989586621689758141"><span id="local-6989586621689758142"><span id="local-6989586621689758143"><span class="annot"><span class="annottext">Bool
Maybe Bool
Maybe Text
Maybe (HashSet (EngineLogType impl))
Maybe (HashSet ExperimentalFeature)
Maybe (HashSet API)
Maybe TxIsolation
Maybe (Refined NonNegative Int)
Maybe (Refined NonNegative Seconds)
Maybe (Refined NonNegative Milliseconds)
Maybe (Refined Positive Int)
Maybe RefetchInterval
Maybe BatchSize
Maybe InferFunctionPermissions
Maybe DangerouslyCollapseBooleans
Maybe LogLevel
Maybe CorsConfig
Maybe RoleName
Maybe JWTConfig
Maybe ExtensionsSchema
Maybe NamingCase
Maybe AdminSecretHash
Maybe HostPreference
Maybe WSConnectionInitTimeout
Maybe KeepAliveDelay
Maybe OptionalInterval
Maybe Port
RemoteSchemaPermissions
StringifyNumbers
MaintenanceMode ()
MetadataQueryLoggingMode
ConnParamsRaw
AuthHookRaw
rsoExtensionsSchema :: forall impl. ServeOptionsRaw impl -&gt; Maybe ExtensionsSchema
rsoDefaultNamingConvention :: forall impl. ServeOptionsRaw impl -&gt; Maybe NamingCase
rsoEnableMetadataQueryLoggingEnv :: forall impl. ServeOptionsRaw impl -&gt; MetadataQueryLoggingMode
rsoWebSocketConnectionInitTimeout :: forall impl. ServeOptionsRaw impl -&gt; Maybe WSConnectionInitTimeout
rsoGracefulShutdownTimeout :: forall impl.
ServeOptionsRaw impl -&gt; Maybe (Refined NonNegative Seconds)
rsoEventsFetchBatchSize :: forall impl.
ServeOptionsRaw impl -&gt; Maybe (Refined NonNegative Int)
rsoExperimentalFeatures :: forall impl.
ServeOptionsRaw impl -&gt; Maybe (HashSet ExperimentalFeature)
rsoSchemaPollInterval :: forall impl. ServeOptionsRaw impl -&gt; Maybe OptionalInterval
rsoEnableMaintenanceMode :: forall impl. ServeOptionsRaw impl -&gt; MaintenanceMode ()
rsoInferFunctionPermissions :: forall impl. ServeOptionsRaw impl -&gt; Maybe InferFunctionPermissions
rsoWebSocketKeepAlive :: forall impl. ServeOptionsRaw impl -&gt; Maybe KeepAliveDelay
rsoWebSocketCompression :: forall impl. ServeOptionsRaw impl -&gt; Bool
rsoEnableRemoteSchemaPermissions :: forall impl. ServeOptionsRaw impl -&gt; RemoteSchemaPermissions
rsoAsyncActionsFetchInterval :: forall impl. ServeOptionsRaw impl -&gt; Maybe OptionalInterval
rsoEventsFetchInterval :: forall impl.
ServeOptionsRaw impl -&gt; Maybe (Refined NonNegative Milliseconds)
rsoEventsHttpPoolSize :: forall impl. ServeOptionsRaw impl -&gt; Maybe (Refined Positive Int)
rsoAdminInternalErrors :: forall impl. ServeOptionsRaw impl -&gt; Maybe Bool
rsoDevMode :: forall impl. ServeOptionsRaw impl -&gt; Bool
rsoLogLevel :: forall impl. ServeOptionsRaw impl -&gt; Maybe LogLevel
rsoEnabledLogTypes :: forall impl.
ServeOptionsRaw impl -&gt; Maybe (HashSet (EngineLogType impl))
rsoEnableAllowlist :: forall impl. ServeOptionsRaw impl -&gt; Bool
rsoStreamingMxBatchSize :: forall impl. ServeOptionsRaw impl -&gt; Maybe BatchSize
rsoStreamingMxRefetchInt :: forall impl. ServeOptionsRaw impl -&gt; Maybe RefetchInterval
rsoMxBatchSize :: forall impl. ServeOptionsRaw impl -&gt; Maybe BatchSize
rsoMxRefetchInt :: forall impl. ServeOptionsRaw impl -&gt; Maybe RefetchInterval
rsoEnabledAPIs :: forall impl. ServeOptionsRaw impl -&gt; Maybe (HashSet API)
rsoDangerousBooleanCollapse :: forall impl.
ServeOptionsRaw impl -&gt; Maybe DangerouslyCollapseBooleans
rsoStringifyNum :: forall impl. ServeOptionsRaw impl -&gt; StringifyNumbers
rsoWsReadCookie :: forall impl. ServeOptionsRaw impl -&gt; Bool
rsoEnableTelemetry :: forall impl. ServeOptionsRaw impl -&gt; Maybe Bool
rsoConsoleSentryDsn :: forall impl. ServeOptionsRaw impl -&gt; Maybe Text
rsoConsoleAssetsDir :: forall impl. ServeOptionsRaw impl -&gt; Maybe Text
rsoEnableConsole :: forall impl. ServeOptionsRaw impl -&gt; Bool
rsoCorsConfig :: forall impl. ServeOptionsRaw impl -&gt; Maybe CorsConfig
rsoUnAuthRole :: forall impl. ServeOptionsRaw impl -&gt; Maybe RoleName
rsoJwtSecret :: forall impl. ServeOptionsRaw impl -&gt; Maybe JWTConfig
rsoAuthHook :: forall impl. ServeOptionsRaw impl -&gt; AuthHookRaw
rsoAdminSecret :: forall impl. ServeOptionsRaw impl -&gt; Maybe AdminSecretHash
rsoTxIso :: forall impl. ServeOptionsRaw impl -&gt; Maybe TxIsolation
rsoConnParams :: forall impl. ServeOptionsRaw impl -&gt; ConnParamsRaw
rsoHost :: forall impl. ServeOptionsRaw impl -&gt; Maybe HostPreference
rsoPort :: forall impl. ServeOptionsRaw impl -&gt; Maybe Port
rsoExtensionsSchema :: Maybe ExtensionsSchema
rsoDefaultNamingConvention :: Maybe NamingCase
rsoEnableMetadataQueryLoggingEnv :: MetadataQueryLoggingMode
rsoWebSocketConnectionInitTimeout :: Maybe WSConnectionInitTimeout
rsoGracefulShutdownTimeout :: Maybe (Refined NonNegative Seconds)
rsoEventsFetchBatchSize :: Maybe (Refined NonNegative Int)
rsoExperimentalFeatures :: Maybe (HashSet ExperimentalFeature)
rsoSchemaPollInterval :: Maybe OptionalInterval
rsoEnableMaintenanceMode :: MaintenanceMode ()
rsoInferFunctionPermissions :: Maybe InferFunctionPermissions
rsoWebSocketKeepAlive :: Maybe KeepAliveDelay
rsoWebSocketCompression :: Bool
rsoEnableRemoteSchemaPermissions :: RemoteSchemaPermissions
rsoAsyncActionsFetchInterval :: Maybe OptionalInterval
rsoEventsFetchInterval :: Maybe (Refined NonNegative Milliseconds)
rsoEventsHttpPoolSize :: Maybe (Refined Positive Int)
rsoAdminInternalErrors :: Maybe Bool
rsoDevMode :: Bool
rsoLogLevel :: Maybe LogLevel
rsoEnabledLogTypes :: Maybe (HashSet (EngineLogType impl))
rsoEnableAllowlist :: Bool
rsoStreamingMxBatchSize :: Maybe BatchSize
rsoStreamingMxRefetchInt :: Maybe RefetchInterval
rsoMxBatchSize :: Maybe BatchSize
rsoMxRefetchInt :: Maybe RefetchInterval
rsoEnabledAPIs :: Maybe (HashSet API)
rsoDangerousBooleanCollapse :: Maybe DangerouslyCollapseBooleans
rsoStringifyNum :: StringifyNumbers
rsoWsReadCookie :: Bool
rsoEnableTelemetry :: Maybe Bool
rsoConsoleSentryDsn :: Maybe Text
rsoConsoleAssetsDir :: Maybe Text
rsoEnableConsole :: Bool
rsoCorsConfig :: Maybe CorsConfig
rsoUnAuthRole :: Maybe RoleName
rsoJwtSecret :: Maybe JWTConfig
rsoAuthHook :: AuthHookRaw
rsoAdminSecret :: Maybe AdminSecretHash
rsoTxIso :: Maybe TxIsolation
rsoConnParams :: ConnParamsRaw
rsoHost :: Maybe HostPreference
rsoPort :: Maybe Port
</span><a href="Hasura.Server.Init.Config.html#rsoExtensionsSchema"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-150"></span><span>  </span><span id="local-6989586621689758059"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621689758059"><span class="hs-identifier hs-var">soPort</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Port -&gt; Option Port -&gt; WithEnvT Identity Port
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Port
</span><a href="#local-6989586621689758143"><span class="hs-identifier hs-var">rsoPort</span></a></span><span> </span><span class="annot"><span class="annottext">Option Port
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#servePortOption"><span class="hs-identifier hs-var">servePortOption</span></a></span><span>
</span><span id="line-151"></span><span>  </span><span id="local-6989586621689758056"><span class="annot"><span class="annottext">HostPreference
</span><a href="#local-6989586621689758056"><span class="hs-identifier hs-var">soHost</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe HostPreference
-&gt; Option HostPreference -&gt; WithEnvT Identity HostPreference
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HostPreference
</span><a href="#local-6989586621689758142"><span class="hs-identifier hs-var">rsoHost</span></a></span><span> </span><span class="annot"><span class="annottext">Option HostPreference
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#serveHostOption"><span class="hs-identifier hs-var">serveHostOption</span></a></span><span>
</span><span id="line-152"></span><span>  </span><span id="local-6989586621689758054"><span class="annot"><span class="annottext">ConnParams
</span><a href="#local-6989586621689758054"><span class="hs-identifier hs-var">soConnParams</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConnParamsRaw -&gt; WithEnvT Identity ConnParams
forall (m :: * -&gt; *).
Monad m =&gt;
ConnParamsRaw -&gt; WithEnvT m ConnParams
</span><a href="#local-6989586621689758053"><span class="hs-identifier hs-var">mkConnParams</span></a></span><span> </span><span class="annot"><span class="annottext">ConnParamsRaw
</span><a href="#local-6989586621689758141"><span class="hs-identifier hs-var">rsoConnParams</span></a></span><span>
</span><span id="line-153"></span><span>  </span><span id="local-6989586621689758052"><span class="annot"><span class="annottext">TxIsolation
</span><a href="#local-6989586621689758052"><span class="hs-identifier hs-var">soTxIso</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe TxIsolation
-&gt; Option TxIsolation -&gt; WithEnvT Identity TxIsolation
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TxIsolation
</span><a href="#local-6989586621689758140"><span class="hs-identifier hs-var">rsoTxIso</span></a></span><span> </span><span class="annot"><span class="annottext">Option TxIsolation
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#txIsolationOption"><span class="hs-identifier hs-var">txIsolationOption</span></a></span><span>
</span><span id="line-154"></span><span>  </span><span id="local-6989586621689758050"><span class="annot"><span class="annottext">HashSet AdminSecretHash
</span><a href="#local-6989586621689758050"><span class="hs-identifier hs-var">soAdminSecret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashSet AdminSecretHash
-&gt; (AdminSecretHash -&gt; HashSet AdminSecretHash)
-&gt; Maybe AdminSecretHash
-&gt; HashSet AdminSecretHash
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">HashSet AdminSecretHash
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AdminSecretHash -&gt; HashSet AdminSecretHash
forall a. Hashable a =&gt; a -&gt; HashSet a
</span><span class="hs-identifier hs-var">HashSet.singleton</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe AdminSecretHash -&gt; HashSet AdminSecretHash)
-&gt; WithEnvT Identity (Maybe AdminSecretHash)
-&gt; WithEnvT Identity (HashSet AdminSecretHash)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe AdminSecretHash
-&gt; [Option ()] -&gt; WithEnvT Identity (Maybe AdminSecretHash)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; [Option ()] -&gt; WithEnvT m (Maybe option)
</span><a href="Hasura.Server.Init.Env.html#withOptions"><span class="hs-identifier hs-var">withOptions</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe AdminSecretHash
</span><a href="#local-6989586621689758139"><span class="hs-identifier hs-var">rsoAdminSecret</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Option ()
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#adminSecretOption"><span class="hs-identifier hs-var">adminSecretOption</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Option ()
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#accessKeyOption"><span class="hs-identifier hs-var">accessKeyOption</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-155"></span><span>  </span><span id="local-6989586621689758044"><span class="annot"><span class="annottext">Maybe AuthHook
</span><a href="#local-6989586621689758044"><span class="hs-identifier hs-var">soAuthHook</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AuthHookRaw -&gt; WithEnvT Identity (Maybe AuthHook)
forall (m :: * -&gt; *).
Monad m =&gt;
AuthHookRaw -&gt; WithEnvT m (Maybe AuthHook)
</span><a href="#local-6989586621689758043"><span class="hs-identifier hs-var">mkAuthHook</span></a></span><span> </span><span class="annot"><span class="annottext">AuthHookRaw
</span><a href="#local-6989586621689758138"><span class="hs-identifier hs-var">rsoAuthHook</span></a></span><span>
</span><span id="line-156"></span><span>  </span><span id="local-6989586621689758042"><span class="annot"><span class="annottext">[JWTConfig]
</span><a href="#local-6989586621689758042"><span class="hs-identifier hs-var">soJwtSecret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe JWTConfig -&gt; [JWTConfig]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe JWTConfig -&gt; [JWTConfig])
-&gt; WithEnvT Identity (Maybe JWTConfig)
-&gt; WithEnvT Identity [JWTConfig]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe JWTConfig -&gt; Option () -&gt; WithEnvT Identity (Maybe JWTConfig)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option () -&gt; WithEnvT m (Maybe option)
</span><a href="Hasura.Server.Init.Env.html#withOption"><span class="hs-identifier hs-var">withOption</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe JWTConfig
</span><a href="#local-6989586621689758137"><span class="hs-identifier hs-var">rsoJwtSecret</span></a></span><span> </span><span class="annot"><span class="annottext">Option ()
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#jwtSecretOption"><span class="hs-identifier hs-var">jwtSecretOption</span></a></span><span>
</span><span id="line-157"></span><span>  </span><span id="local-6989586621689758039"><span class="annot"><span class="annottext">Maybe RoleName
</span><a href="#local-6989586621689758039"><span class="hs-identifier hs-var">soUnAuthRole</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe RoleName -&gt; Option () -&gt; WithEnvT Identity (Maybe RoleName)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option () -&gt; WithEnvT m (Maybe option)
</span><a href="Hasura.Server.Init.Env.html#withOption"><span class="hs-identifier hs-var">withOption</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RoleName
</span><a href="#local-6989586621689758136"><span class="hs-identifier hs-var">rsoUnAuthRole</span></a></span><span> </span><span class="annot"><span class="annottext">Option ()
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#unAuthRoleOption"><span class="hs-identifier hs-var">unAuthRoleOption</span></a></span><span>
</span><span id="line-158"></span><span>  </span><span id="local-6989586621689758037"><span class="annot"><span class="annottext">CorsConfig
</span><a href="#local-6989586621689758037"><span class="hs-identifier hs-var">soCorsConfig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe CorsConfig -&gt; WithEnvT Identity CorsConfig
</span><a href="#local-6989586621689758036"><span class="hs-identifier hs-var">mkCorsConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CorsConfig
</span><a href="#local-6989586621689758135"><span class="hs-identifier hs-var">rsoCorsConfig</span></a></span><span>
</span><span id="line-159"></span><span>  </span><span id="local-6989586621689758035"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689758035"><span class="hs-identifier hs-var">soEnableConsole</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Option Bool -&gt; WithEnvT Identity Bool
forall (m :: * -&gt; *).
Monad m =&gt;
Bool -&gt; Option Bool -&gt; WithEnvT m Bool
</span><a href="Hasura.Server.Init.Env.html#withOptionSwitch"><span class="hs-identifier hs-var">withOptionSwitch</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689758134"><span class="hs-identifier hs-var">rsoEnableConsole</span></a></span><span> </span><span class="annot"><span class="annottext">Option Bool
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#enableConsoleOption"><span class="hs-identifier hs-var">enableConsoleOption</span></a></span><span>
</span><span id="line-160"></span><span>  </span><span id="local-6989586621689758032"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689758032"><span class="hs-identifier hs-var">soConsoleAssetsDir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; Option () -&gt; WithEnvT Identity (Maybe Text)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option () -&gt; WithEnvT m (Maybe option)
</span><a href="Hasura.Server.Init.Env.html#withOption"><span class="hs-identifier hs-var">withOption</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689758133"><span class="hs-identifier hs-var">rsoConsoleAssetsDir</span></a></span><span> </span><span class="annot"><span class="annottext">Option ()
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#consoleAssetsDirOption"><span class="hs-identifier hs-var">consoleAssetsDirOption</span></a></span><span>
</span><span id="line-161"></span><span>  </span><span id="local-6989586621689758030"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689758030"><span class="hs-identifier hs-var">soConsoleSentryDsn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; Option () -&gt; WithEnvT Identity (Maybe Text)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option () -&gt; WithEnvT m (Maybe option)
</span><a href="Hasura.Server.Init.Env.html#withOption"><span class="hs-identifier hs-var">withOption</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689758132"><span class="hs-identifier hs-var">rsoConsoleSentryDsn</span></a></span><span> </span><span class="annot"><span class="annottext">Option ()
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#consoleSentryDsnOption"><span class="hs-identifier hs-var">consoleSentryDsnOption</span></a></span><span>
</span><span id="line-162"></span><span>  </span><span id="local-6989586621689758028"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689758028"><span class="hs-identifier hs-var">soEnableTelemetry</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; Option Bool -&gt; WithEnvT Identity Bool
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621689758131"><span class="hs-identifier hs-var">rsoEnableTelemetry</span></a></span><span> </span><span class="annot"><span class="annottext">Option Bool
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#enableTelemetryOption"><span class="hs-identifier hs-var">enableTelemetryOption</span></a></span><span>
</span><span id="line-163"></span><span>  </span><span id="local-6989586621689758026"><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689758026"><span class="hs-identifier hs-var">soStringifyNum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689758129"><span class="hs-identifier hs-var">rsoStringifyNum</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-165"></span><span>      </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="Hasura.GraphQL.Schema.Options.html#Don%27tStringifyNumbers"><span class="hs-identifier hs-var">Options.Don'tStringifyNumbers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe StringifyNumbers
-&gt; Option StringifyNumbers -&gt; WithEnvT Identity StringifyNumbers
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe StringifyNumbers
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Option StringifyNumbers
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#stringifyNumOption"><span class="hs-identifier hs-var">stringifyNumOption</span></a></span><span>
</span><span id="line-166"></span><span>      </span><span id="local-6989586621689758023"><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689758023"><span class="hs-identifier hs-var">stringifyNums</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StringifyNumbers -&gt; WithEnvT Identity StringifyNumbers
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689758023"><span class="hs-identifier hs-var">stringifyNums</span></a></span><span>
</span><span id="line-167"></span><span>  </span><span id="local-6989586621689758022"><span class="annot"><span class="annottext">DangerouslyCollapseBooleans
</span><a href="#local-6989586621689758022"><span class="hs-identifier hs-var">soDangerousBooleanCollapse</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe DangerouslyCollapseBooleans
-&gt; Option DangerouslyCollapseBooleans
-&gt; WithEnvT Identity DangerouslyCollapseBooleans
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DangerouslyCollapseBooleans
</span><a href="#local-6989586621689758128"><span class="hs-identifier hs-var">rsoDangerousBooleanCollapse</span></a></span><span> </span><span class="annot"><span class="annottext">Option DangerouslyCollapseBooleans
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#dangerousBooleanCollapseOption"><span class="hs-identifier hs-var">dangerousBooleanCollapseOption</span></a></span><span>
</span><span id="line-168"></span><span>  </span><span id="local-6989586621689758020"><span class="annot"><span class="annottext">HashSet API
</span><a href="#local-6989586621689758020"><span class="hs-identifier hs-var">soEnabledAPIs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (HashSet API)
-&gt; Option (HashSet API) -&gt; WithEnvT Identity (HashSet API)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (HashSet API)
</span><a href="#local-6989586621689758127"><span class="hs-identifier hs-var">rsoEnabledAPIs</span></a></span><span> </span><span class="annot"><span class="annottext">Option (HashSet API)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#enabledAPIsOption"><span class="hs-identifier hs-var">enabledAPIsOption</span></a></span><span>
</span><span id="line-169"></span><span>  </span><span id="local-6989586621689758018"><span class="annot"><span class="annottext">SubscriptionsOptions
</span><a href="#local-6989586621689758018"><span class="hs-identifier hs-var">soLiveQueryOpts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-170"></span><span>    </span><span id="local-6989586621689758017"><span class="annot"><span class="annottext">RefetchInterval
</span><a href="#local-6989586621689758017"><span class="hs-identifier hs-var">_lqoRefetchInterval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe RefetchInterval
-&gt; Option RefetchInterval -&gt; WithEnvT Identity RefetchInterval
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RefetchInterval
</span><a href="#local-6989586621689758126"><span class="hs-identifier hs-var">rsoMxRefetchInt</span></a></span><span> </span><span class="annot"><span class="annottext">Option RefetchInterval
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#mxRefetchDelayOption"><span class="hs-identifier hs-var">mxRefetchDelayOption</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span id="local-6989586621689758015"><span class="annot"><span class="annottext">BatchSize
</span><a href="#local-6989586621689758015"><span class="hs-identifier hs-var">_lqoBatchSize</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe BatchSize -&gt; Option BatchSize -&gt; WithEnvT Identity BatchSize
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe BatchSize
</span><a href="#local-6989586621689758125"><span class="hs-identifier hs-var">rsoMxBatchSize</span></a></span><span> </span><span class="annot"><span class="annottext">Option BatchSize
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#mxBatchSizeOption"><span class="hs-identifier hs-var">mxBatchSizeOption</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="annot"><span class="annottext">SubscriptionsOptions -&gt; WithEnvT Identity SubscriptionsOptions
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SubscriptionsOptions -&gt; WithEnvT Identity SubscriptionsOptions)
-&gt; SubscriptionsOptions -&gt; WithEnvT Identity SubscriptionsOptions
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SubscriptionsOptions :: BatchSize -&gt; RefetchInterval -&gt; SubscriptionsOptions
</span><a href="Hasura.GraphQL.Execute.Subscription.Options.html#SubscriptionsOptions"><span class="hs-identifier hs-type">Subscription.Options.SubscriptionsOptions</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">RefetchInterval
BatchSize
_lqoRefetchInterval :: RefetchInterval
_lqoBatchSize :: BatchSize
_lqoBatchSize :: BatchSize
_lqoRefetchInterval :: RefetchInterval
</span><a href="Hasura.GraphQL.Execute.Subscription.Options.html#_lqoRefetchInterval"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-173"></span><span>  </span><span id="local-6989586621689758010"><span class="annot"><span class="annottext">SubscriptionsOptions
</span><a href="#local-6989586621689758010"><span class="hs-identifier hs-var">soStreamingQueryOpts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-174"></span><span>    </span><span id="local-6989586621689758009"><span class="annot"><span class="annottext">RefetchInterval
</span><a href="#local-6989586621689758009"><span class="hs-identifier hs-var">_lqoRefetchInterval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe RefetchInterval
-&gt; Option RefetchInterval -&gt; WithEnvT Identity RefetchInterval
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RefetchInterval
</span><a href="#local-6989586621689758124"><span class="hs-identifier hs-var">rsoStreamingMxRefetchInt</span></a></span><span> </span><span class="annot"><span class="annottext">Option RefetchInterval
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#streamingMxRefetchDelayOption"><span class="hs-identifier hs-var">streamingMxRefetchDelayOption</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span id="local-6989586621689758007"><span class="annot"><span class="annottext">BatchSize
</span><a href="#local-6989586621689758007"><span class="hs-identifier hs-var">_lqoBatchSize</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe BatchSize -&gt; Option BatchSize -&gt; WithEnvT Identity BatchSize
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe BatchSize
</span><a href="#local-6989586621689758123"><span class="hs-identifier hs-var">rsoStreamingMxBatchSize</span></a></span><span> </span><span class="annot"><span class="annottext">Option BatchSize
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#streamingMxBatchSizeOption"><span class="hs-identifier hs-var">streamingMxBatchSizeOption</span></a></span><span>
</span><span id="line-176"></span><span>    </span><span class="annot"><span class="annottext">SubscriptionsOptions -&gt; WithEnvT Identity SubscriptionsOptions
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SubscriptionsOptions -&gt; WithEnvT Identity SubscriptionsOptions)
-&gt; SubscriptionsOptions -&gt; WithEnvT Identity SubscriptionsOptions
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SubscriptionsOptions :: BatchSize -&gt; RefetchInterval -&gt; SubscriptionsOptions
</span><a href="Hasura.GraphQL.Execute.Subscription.Options.html#SubscriptionsOptions"><span class="hs-identifier hs-type">Subscription.Options.SubscriptionsOptions</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">RefetchInterval
BatchSize
_lqoBatchSize :: BatchSize
_lqoRefetchInterval :: RefetchInterval
_lqoRefetchInterval :: RefetchInterval
_lqoBatchSize :: BatchSize
</span><a href="#local-6989586621689758007"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-177"></span><span>  </span><span id="local-6989586621689758005"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689758005"><span class="hs-identifier hs-var">soEnableAllowlist</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Option Bool -&gt; WithEnvT Identity Bool
forall (m :: * -&gt; *).
Monad m =&gt;
Bool -&gt; Option Bool -&gt; WithEnvT m Bool
</span><a href="Hasura.Server.Init.Env.html#withOptionSwitch"><span class="hs-identifier hs-var">withOptionSwitch</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689758122"><span class="hs-identifier hs-var">rsoEnableAllowlist</span></a></span><span> </span><span class="annot"><span class="annottext">Option Bool
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#enableAllowlistOption"><span class="hs-identifier hs-var">enableAllowlistOption</span></a></span><span>
</span><span id="line-178"></span><span>  </span><span id="local-6989586621689758003"><span class="annot"><span class="annottext">HashSet (EngineLogType impl)
</span><a href="#local-6989586621689758003"><span class="hs-identifier hs-var">soEnabledLogTypes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (HashSet (EngineLogType impl))
-&gt; Option (HashSet (EngineLogType impl))
-&gt; WithEnvT Identity (HashSet (EngineLogType impl))
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (HashSet (EngineLogType impl))
</span><a href="#local-6989586621689758121"><span class="hs-identifier hs-var">rsoEnabledLogTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EnabledLogTypes impl =&gt; Option (HashSet (EngineLogType impl))
forall impl.
EnabledLogTypes impl =&gt;
Option (HashSet (EngineLogType impl))
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#enabledLogsOption"><span class="hs-identifier hs-var">enabledLogsOption</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689758305"><span class="hs-identifier hs-type">impl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>  </span><span id="local-6989586621689758001"><span class="annot"><span class="annottext">LogLevel
</span><a href="#local-6989586621689758001"><span class="hs-identifier hs-var">soLogLevel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe LogLevel -&gt; Option LogLevel -&gt; WithEnvT Identity LogLevel
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe LogLevel
</span><a href="#local-6989586621689758120"><span class="hs-identifier hs-var">rsoLogLevel</span></a></span><span> </span><span class="annot"><span class="annottext">Option LogLevel
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#logLevelOption"><span class="hs-identifier hs-var">logLevelOption</span></a></span><span>
</span><span id="line-180"></span><span>  </span><span id="local-6989586621689757999"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689757999"><span class="hs-identifier hs-var">soDevMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Option Bool -&gt; WithEnvT Identity Bool
forall (m :: * -&gt; *).
Monad m =&gt;
Bool -&gt; Option Bool -&gt; WithEnvT m Bool
</span><a href="Hasura.Server.Init.Env.html#withOptionSwitch"><span class="hs-identifier hs-var">withOptionSwitch</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689758119"><span class="hs-identifier hs-var">rsoDevMode</span></a></span><span> </span><span class="annot"><span class="annottext">Option Bool
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#graphqlDevModeOption"><span class="hs-identifier hs-var">graphqlDevModeOption</span></a></span><span>
</span><span id="line-181"></span><span>  </span><span id="local-6989586621689757997"><span class="annot"><span class="annottext">ResponseInternalErrorsConfig
</span><a href="#local-6989586621689757997"><span class="hs-identifier hs-var">soResponseInternalErrorsConfig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; WithEnvT Identity ResponseInternalErrorsConfig
</span><a href="#local-6989586621689757996"><span class="hs-identifier hs-var">mkResponseInternalErrorsConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689757999"><span class="hs-identifier hs-var">soDevMode</span></a></span><span>
</span><span id="line-182"></span><span>  </span><span id="local-6989586621689757995"><span class="annot"><span class="annottext">Refined Positive Int
</span><a href="#local-6989586621689757995"><span class="hs-identifier hs-var">soEventsHttpPoolSize</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (Refined Positive Int)
-&gt; Option (Refined Positive Int)
-&gt; WithEnvT Identity (Refined Positive Int)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Refined Positive Int)
</span><a href="#local-6989586621689758117"><span class="hs-identifier hs-var">rsoEventsHttpPoolSize</span></a></span><span> </span><span class="annot"><span class="annottext">Option (Refined Positive Int)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#graphqlEventsHttpPoolSizeOption"><span class="hs-identifier hs-var">graphqlEventsHttpPoolSizeOption</span></a></span><span>
</span><span id="line-183"></span><span>  </span><span id="local-6989586621689757993"><span class="annot"><span class="annottext">Refined NonNegative Milliseconds
</span><a href="#local-6989586621689757993"><span class="hs-identifier hs-var">soEventsFetchInterval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (Refined NonNegative Milliseconds)
-&gt; Option (Refined NonNegative Milliseconds)
-&gt; WithEnvT Identity (Refined NonNegative Milliseconds)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Refined NonNegative Milliseconds)
</span><a href="#local-6989586621689758116"><span class="hs-identifier hs-var">rsoEventsFetchInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Option (Refined NonNegative Milliseconds)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#graphqlEventsFetchIntervalOption"><span class="hs-identifier hs-var">graphqlEventsFetchIntervalOption</span></a></span><span>
</span><span id="line-184"></span><span>  </span><span id="local-6989586621689757991"><span class="annot"><span class="annottext">OptionalInterval
</span><a href="#local-6989586621689757991"><span class="hs-identifier hs-var">soAsyncActionsFetchInterval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe OptionalInterval
-&gt; Option OptionalInterval -&gt; WithEnvT Identity OptionalInterval
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe OptionalInterval
</span><a href="#local-6989586621689758115"><span class="hs-identifier hs-var">rsoAsyncActionsFetchInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Option OptionalInterval
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#asyncActionsFetchIntervalOption"><span class="hs-identifier hs-var">asyncActionsFetchIntervalOption</span></a></span><span>
</span><span id="line-185"></span><span>  </span><span id="local-6989586621689757989"><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621689757989"><span class="hs-identifier hs-var">soEnableRemoteSchemaPermissions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621689758114"><span class="hs-identifier hs-var">rsoEnableRemoteSchemaPermissions</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-187"></span><span>      </span><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="Hasura.GraphQL.Schema.Options.html#DisableRemoteSchemaPermissions"><span class="hs-identifier hs-var">Options.DisableRemoteSchemaPermissions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe RemoteSchemaPermissions
-&gt; Option RemoteSchemaPermissions
-&gt; WithEnvT Identity RemoteSchemaPermissions
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RemoteSchemaPermissions
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Option RemoteSchemaPermissions
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#enableRemoteSchemaPermsOption"><span class="hs-identifier hs-var">enableRemoteSchemaPermsOption</span></a></span><span>
</span><span id="line-188"></span><span>      </span><span id="local-6989586621689757986"><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621689757986"><span class="hs-identifier hs-var">enableRemoteSchemaPermissions</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RemoteSchemaPermissions
-&gt; WithEnvT Identity RemoteSchemaPermissions
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621689757986"><span class="hs-identifier hs-var">enableRemoteSchemaPermissions</span></a></span><span>
</span><span id="line-189"></span><span>  </span><span id="local-6989586621689757985"><span class="annot"><span class="annottext">ConnectionOptions
</span><a href="#local-6989586621689757985"><span class="hs-identifier hs-var">soConnectionOptions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WithEnvT Identity ConnectionOptions
</span><a href="#local-6989586621689757984"><span class="hs-identifier hs-var">mkConnectionOptions</span></a></span><span>
</span><span id="line-190"></span><span>  </span><span id="local-6989586621689757983"><span class="annot"><span class="annottext">KeepAliveDelay
</span><a href="#local-6989586621689757983"><span class="hs-identifier hs-var">soWebSocketKeepAlive</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe KeepAliveDelay
-&gt; Option KeepAliveDelay -&gt; WithEnvT Identity KeepAliveDelay
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe KeepAliveDelay
</span><a href="#local-6989586621689758112"><span class="hs-identifier hs-var">rsoWebSocketKeepAlive</span></a></span><span> </span><span class="annot"><span class="annottext">Option KeepAliveDelay
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#webSocketKeepAliveOption"><span class="hs-identifier hs-var">webSocketKeepAliveOption</span></a></span><span>
</span><span id="line-191"></span><span>  </span><span id="local-6989586621689757981"><span class="annot"><span class="annottext">InferFunctionPermissions
</span><a href="#local-6989586621689757981"><span class="hs-identifier hs-var">soInferFunctionPermissions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe InferFunctionPermissions
-&gt; Option InferFunctionPermissions
-&gt; WithEnvT Identity InferFunctionPermissions
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe InferFunctionPermissions
</span><a href="#local-6989586621689758111"><span class="hs-identifier hs-var">rsoInferFunctionPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">Option InferFunctionPermissions
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#inferFunctionPermsOption"><span class="hs-identifier hs-var">inferFunctionPermsOption</span></a></span><span>
</span><span id="line-192"></span><span>  </span><span id="local-6989586621689757979"><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621689757979"><span class="hs-identifier hs-var">soEnableMaintenanceMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621689758110"><span class="hs-identifier hs-var">rsoEnableMaintenanceMode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-193"></span><span>    </span><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="Hasura.Server.Types.html#MaintenanceModeDisabled"><span class="hs-identifier hs-var">Types.MaintenanceModeDisabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (MaintenanceMode ())
-&gt; Option (MaintenanceMode ())
-&gt; WithEnvT Identity (MaintenanceMode ())
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (MaintenanceMode ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Option (MaintenanceMode ())
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#enableMaintenanceModeOption"><span class="hs-identifier hs-var">enableMaintenanceModeOption</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span id="local-6989586621689757976"><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621689757976"><span class="hs-identifier hs-var">maintenanceModeEnabled</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaintenanceMode () -&gt; WithEnvT Identity (MaintenanceMode ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621689757976"><span class="hs-identifier hs-var">maintenanceModeEnabled</span></a></span><span>
</span><span id="line-195"></span><span>  </span><span id="local-6989586621689757975"><span class="annot"><span class="annottext">OptionalInterval
</span><a href="#local-6989586621689757975"><span class="hs-identifier hs-var">soSchemaPollInterval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe OptionalInterval
-&gt; Option OptionalInterval -&gt; WithEnvT Identity OptionalInterval
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe OptionalInterval
</span><a href="#local-6989586621689758109"><span class="hs-identifier hs-var">rsoSchemaPollInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Option OptionalInterval
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#schemaPollIntervalOption"><span class="hs-identifier hs-var">schemaPollIntervalOption</span></a></span><span>
</span><span id="line-196"></span><span>  </span><span id="local-6989586621689757973"><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621689757973"><span class="hs-identifier hs-var">soExperimentalFeatures</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (HashSet ExperimentalFeature)
-&gt; Option (HashSet ExperimentalFeature)
-&gt; WithEnvT Identity (HashSet ExperimentalFeature)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (HashSet ExperimentalFeature)
</span><a href="#local-6989586621689758108"><span class="hs-identifier hs-var">rsoExperimentalFeatures</span></a></span><span> </span><span class="annot"><span class="annottext">Option (HashSet ExperimentalFeature)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#experimentalFeaturesOption"><span class="hs-identifier hs-var">experimentalFeaturesOption</span></a></span><span>
</span><span id="line-197"></span><span>  </span><span id="local-6989586621689757971"><span class="annot"><span class="annottext">Refined NonNegative Int
</span><a href="#local-6989586621689757971"><span class="hs-identifier hs-var">soEventsFetchBatchSize</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (Refined NonNegative Int)
-&gt; Option (Refined NonNegative Int)
-&gt; WithEnvT Identity (Refined NonNegative Int)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Refined NonNegative Int)
</span><a href="#local-6989586621689758107"><span class="hs-identifier hs-var">rsoEventsFetchBatchSize</span></a></span><span> </span><span class="annot"><span class="annottext">Option (Refined NonNegative Int)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#eventsFetchBatchSizeOption"><span class="hs-identifier hs-var">eventsFetchBatchSizeOption</span></a></span><span>
</span><span id="line-198"></span><span>  </span><span id="local-6989586621689757969"><span class="annot"><span class="annottext">Refined NonNegative Seconds
</span><a href="#local-6989586621689757969"><span class="hs-identifier hs-var">soGracefulShutdownTimeout</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (Refined NonNegative Seconds)
-&gt; Option (Refined NonNegative Seconds)
-&gt; WithEnvT Identity (Refined NonNegative Seconds)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Refined NonNegative Seconds)
</span><a href="#local-6989586621689758106"><span class="hs-identifier hs-var">rsoGracefulShutdownTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">Option (Refined NonNegative Seconds)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#gracefulShutdownOption"><span class="hs-identifier hs-var">gracefulShutdownOption</span></a></span><span>
</span><span id="line-199"></span><span>  </span><span id="local-6989586621689757967"><span class="annot"><span class="annottext">WSConnectionInitTimeout
</span><a href="#local-6989586621689757967"><span class="hs-identifier hs-var">soWebSocketConnectionInitTimeout</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe WSConnectionInitTimeout
-&gt; Option WSConnectionInitTimeout
-&gt; WithEnvT Identity WSConnectionInitTimeout
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe WSConnectionInitTimeout
</span><a href="#local-6989586621689758105"><span class="hs-identifier hs-var">rsoWebSocketConnectionInitTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">Option WSConnectionInitTimeout
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#webSocketConnectionInitTimeoutOption"><span class="hs-identifier hs-var">webSocketConnectionInitTimeoutOption</span></a></span><span>
</span><span id="line-200"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689757965"><span class="annot"><span class="annottext">soEventingMode :: EventingMode
</span><a href="#local-6989586621689757965"><span class="hs-identifier hs-var hs-var">soEventingMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EventingMode
</span><a href="Hasura.Server.Types.html#EventingEnabled"><span class="hs-identifier hs-var">Types.EventingEnabled</span></a></span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689757963"><span class="annot"><span class="annottext">soReadOnlyMode :: ReadOnlyMode
</span><a href="#local-6989586621689757963"><span class="hs-identifier hs-var hs-var">soReadOnlyMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="Hasura.Server.Types.html#ReadOnlyModeDisabled"><span class="hs-identifier hs-var">Types.ReadOnlyModeDisabled</span></a></span><span>
</span><span id="line-202"></span><span>  </span><span id="local-6989586621689757961"><span class="annot"><span class="annottext">MetadataQueryLoggingMode
</span><a href="#local-6989586621689757961"><span class="hs-identifier hs-var">soEnableMetadataQueryLogging</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MetadataQueryLoggingMode
</span><a href="#local-6989586621689758104"><span class="hs-identifier hs-var">rsoEnableMetadataQueryLoggingEnv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><span class="annottext">MetadataQueryLoggingMode
</span><a href="Hasura.Server.Logging.html#MetadataQueryLoggingDisabled"><span class="hs-identifier hs-var">Server.Logging.MetadataQueryLoggingDisabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe MetadataQueryLoggingMode
-&gt; Option MetadataQueryLoggingMode
-&gt; WithEnvT Identity MetadataQueryLoggingMode
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe MetadataQueryLoggingMode
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Option MetadataQueryLoggingMode
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#enableMetadataQueryLoggingOption"><span class="hs-identifier hs-var">enableMetadataQueryLoggingOption</span></a></span><span>
</span><span id="line-204"></span><span>    </span><span id="local-6989586621689757958"><span class="annot"><span class="annottext">MetadataQueryLoggingMode
</span><a href="#local-6989586621689757958"><span class="hs-identifier hs-var">metadataQueryLoggingEnabled</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetadataQueryLoggingMode
-&gt; WithEnvT Identity MetadataQueryLoggingMode
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">MetadataQueryLoggingMode
</span><a href="#local-6989586621689757958"><span class="hs-identifier hs-var">metadataQueryLoggingEnabled</span></a></span><span>
</span><span id="line-205"></span><span>  </span><span id="local-6989586621689757957"><span class="annot"><span class="annottext">Maybe NamingCase
</span><a href="#local-6989586621689757957"><span class="hs-identifier hs-var">soDefaultNamingConvention</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe NamingCase
-&gt; Option () -&gt; WithEnvT Identity (Maybe NamingCase)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option () -&gt; WithEnvT m (Maybe option)
</span><a href="Hasura.Server.Init.Env.html#withOption"><span class="hs-identifier hs-var">withOption</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NamingCase
</span><a href="#local-6989586621689758103"><span class="hs-identifier hs-var">rsoDefaultNamingConvention</span></a></span><span> </span><span class="annot"><span class="annottext">Option ()
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#defaultNamingConventionOption"><span class="hs-identifier hs-var">defaultNamingConventionOption</span></a></span><span>
</span><span id="line-206"></span><span>  </span><span id="local-6989586621689757955"><span class="annot"><span class="annottext">ExtensionsSchema
</span><a href="#local-6989586621689757955"><span class="hs-identifier hs-var">soExtensionsSchema</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ExtensionsSchema
-&gt; Option ExtensionsSchema -&gt; WithEnvT Identity ExtensionsSchema
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ExtensionsSchema
</span><a href="#local-6989586621689758102"><span class="hs-identifier hs-var">rsoExtensionsSchema</span></a></span><span> </span><span class="annot"><span class="annottext">Option ExtensionsSchema
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#metadataDBExtensionsSchemaOption"><span class="hs-identifier hs-var">metadataDBExtensionsSchemaOption</span></a></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span>  </span><span class="annot"><span class="annottext">ServeOptions impl -&gt; WithEnv (ServeOptions impl)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ServeOptions :: forall impl.
Port
-&gt; HostPreference
-&gt; ConnParams
-&gt; TxIsolation
-&gt; HashSet AdminSecretHash
-&gt; Maybe AuthHook
-&gt; [JWTConfig]
-&gt; Maybe RoleName
-&gt; CorsConfig
-&gt; Bool
-&gt; Maybe Text
-&gt; Maybe Text
-&gt; Bool
-&gt; StringifyNumbers
-&gt; DangerouslyCollapseBooleans
-&gt; HashSet API
-&gt; SubscriptionsOptions
-&gt; SubscriptionsOptions
-&gt; Bool
-&gt; HashSet (EngineLogType impl)
-&gt; LogLevel
-&gt; ResponseInternalErrorsConfig
-&gt; Refined Positive Int
-&gt; Refined NonNegative Milliseconds
-&gt; OptionalInterval
-&gt; RemoteSchemaPermissions
-&gt; ConnectionOptions
-&gt; KeepAliveDelay
-&gt; InferFunctionPermissions
-&gt; MaintenanceMode ()
-&gt; OptionalInterval
-&gt; HashSet ExperimentalFeature
-&gt; Refined NonNegative Int
-&gt; Bool
-&gt; Refined NonNegative Seconds
-&gt; WSConnectionInitTimeout
-&gt; EventingMode
-&gt; ReadOnlyMode
-&gt; MetadataQueryLoggingMode
-&gt; Maybe NamingCase
-&gt; ExtensionsSchema
-&gt; ServeOptions impl
</span><a href="Hasura.Server.Init.Config.html#ServeOptions"><span class="hs-identifier hs-type">ServeOptions</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Bool
[JWTConfig]
Maybe Text
Maybe RoleName
Maybe NamingCase
Maybe AuthHook
HashSet (EngineLogType impl)
HashSet ExperimentalFeature
HashSet AdminSecretHash
HashSet API
ConnParams
TxIsolation
Refined NonNegative Int
Refined NonNegative Seconds
Refined NonNegative Milliseconds
Refined Positive Int
SubscriptionsOptions
RemoteSchemaPermissions
InferFunctionPermissions
DangerouslyCollapseBooleans
StringifyNumbers
LogLevel
CorsConfig
ExtensionsSchema
EventingMode
ReadOnlyMode
MaintenanceMode ()
MetadataQueryLoggingMode
HostPreference
ConnectionOptions
ResponseInternalErrorsConfig
WSConnectionInitTimeout
KeepAliveDelay
OptionalInterval
Port
soExtensionsSchema :: ExtensionsSchema
soDefaultNamingConvention :: Maybe NamingCase
soEnableMetadataQueryLogging :: MetadataQueryLoggingMode
soReadOnlyMode :: ReadOnlyMode
soEventingMode :: EventingMode
soWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
soGracefulShutdownTimeout :: Refined NonNegative Seconds
soDevMode :: Bool
soEventsFetchBatchSize :: Refined NonNegative Int
soExperimentalFeatures :: HashSet ExperimentalFeature
soSchemaPollInterval :: OptionalInterval
soEnableMaintenanceMode :: MaintenanceMode ()
soInferFunctionPermissions :: InferFunctionPermissions
soWebSocketKeepAlive :: KeepAliveDelay
soConnectionOptions :: ConnectionOptions
soEnableRemoteSchemaPermissions :: RemoteSchemaPermissions
soAsyncActionsFetchInterval :: OptionalInterval
soEventsFetchInterval :: Refined NonNegative Milliseconds
soEventsHttpPoolSize :: Refined Positive Int
soResponseInternalErrorsConfig :: ResponseInternalErrorsConfig
soLogLevel :: LogLevel
soEnabledLogTypes :: HashSet (EngineLogType impl)
soEnableAllowlist :: Bool
soStreamingQueryOpts :: SubscriptionsOptions
soLiveQueryOpts :: SubscriptionsOptions
soEnabledAPIs :: HashSet API
soDangerousBooleanCollapse :: DangerouslyCollapseBooleans
soStringifyNum :: StringifyNumbers
soEnableTelemetry :: Bool
soConsoleSentryDsn :: Maybe Text
soConsoleAssetsDir :: Maybe Text
soEnableConsole :: Bool
soCorsConfig :: CorsConfig
soUnAuthRole :: Maybe RoleName
soJwtSecret :: [JWTConfig]
soAuthHook :: Maybe AuthHook
soAdminSecret :: HashSet AdminSecretHash
soTxIso :: TxIsolation
soConnParams :: ConnParams
soHost :: HostPreference
soPort :: Port
soExtensionsSchema :: ExtensionsSchema
soDefaultNamingConvention :: Maybe NamingCase
soEnableMetadataQueryLogging :: MetadataQueryLoggingMode
soReadOnlyMode :: ReadOnlyMode
soEventingMode :: EventingMode
soWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
soGracefulShutdownTimeout :: Refined NonNegative Seconds
soEventsFetchBatchSize :: Refined NonNegative Int
soExperimentalFeatures :: HashSet ExperimentalFeature
soSchemaPollInterval :: OptionalInterval
soEnableMaintenanceMode :: MaintenanceMode ()
soInferFunctionPermissions :: InferFunctionPermissions
soWebSocketKeepAlive :: KeepAliveDelay
soConnectionOptions :: ConnectionOptions
soEnableRemoteSchemaPermissions :: RemoteSchemaPermissions
soAsyncActionsFetchInterval :: OptionalInterval
soEventsFetchInterval :: Refined NonNegative Milliseconds
soEventsHttpPoolSize :: Refined Positive Int
soResponseInternalErrorsConfig :: ResponseInternalErrorsConfig
soDevMode :: Bool
soLogLevel :: LogLevel
soEnabledLogTypes :: HashSet (EngineLogType impl)
soEnableAllowlist :: Bool
soStreamingQueryOpts :: SubscriptionsOptions
soLiveQueryOpts :: SubscriptionsOptions
soEnabledAPIs :: HashSet API
soDangerousBooleanCollapse :: DangerouslyCollapseBooleans
soStringifyNum :: StringifyNumbers
soEnableTelemetry :: Bool
soConsoleSentryDsn :: Maybe Text
soConsoleAssetsDir :: Maybe Text
soEnableConsole :: Bool
soCorsConfig :: CorsConfig
soUnAuthRole :: Maybe RoleName
soJwtSecret :: [JWTConfig]
soAuthHook :: Maybe AuthHook
soAdminSecret :: HashSet AdminSecretHash
soTxIso :: TxIsolation
soConnParams :: ConnParams
soHost :: HostPreference
soPort :: Port
</span><a href="Hasura.Server.Init.Config.html#soExtensionsSchema"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-210"></span><span>    </span><span id="local-6989586621689758053"><span class="annot"><span class="annottext">mkConnParams :: ConnParamsRaw -&gt; WithEnvT m ConnParams
</span><a href="#local-6989586621689758053"><span class="hs-identifier hs-var hs-var">mkConnParams</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#ConnParamsRaw"><span class="hs-identifier hs-type">ConnParamsRaw</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621689757905"><span id="local-6989586621689757906"><span id="local-6989586621689757907"><span id="local-6989586621689757908"><span id="local-6989586621689757909"><span id="local-6989586621689757910"><span class="annot"><span class="annottext">Maybe Bool
Maybe (Refined NonNegative Int)
Maybe (Refined NonNegative NominalDiffTime)
rcpPoolTimeout :: ConnParamsRaw -&gt; Maybe (Refined NonNegative NominalDiffTime)
rcpAllowPrepare :: ConnParamsRaw -&gt; Maybe Bool
rcpConnLifetime :: ConnParamsRaw -&gt; Maybe (Refined NonNegative NominalDiffTime)
rcpIdleTime :: ConnParamsRaw -&gt; Maybe (Refined NonNegative Int)
rcpConns :: ConnParamsRaw -&gt; Maybe (Refined NonNegative Int)
rcpStripes :: ConnParamsRaw -&gt; Maybe (Refined NonNegative Int)
rcpPoolTimeout :: Maybe (Refined NonNegative NominalDiffTime)
rcpAllowPrepare :: Maybe Bool
rcpConnLifetime :: Maybe (Refined NonNegative NominalDiffTime)
rcpIdleTime :: Maybe (Refined NonNegative Int)
rcpConns :: Maybe (Refined NonNegative Int)
rcpStripes :: Maybe (Refined NonNegative Int)
</span><a href="Hasura.Server.Init.Config.html#rcpPoolTimeout"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-211"></span><span>      </span><span id="local-6989586621689757898"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621689757898"><span class="hs-identifier hs-var">cpStripes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Refined NonNegative Int -&gt; Int
forall k (p :: k) x. Refined p x -&gt; x
</span><span class="hs-identifier hs-var">unrefine</span></span><span> </span><span class="annot"><span class="annottext">(Refined NonNegative Int -&gt; Int)
-&gt; WithEnvT m (Refined NonNegative Int) -&gt; WithEnvT m Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Refined NonNegative Int)
-&gt; Option (Refined NonNegative Int)
-&gt; WithEnvT m (Refined NonNegative Int)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Refined NonNegative Int)
</span><a href="#local-6989586621689757910"><span class="hs-identifier hs-var">rcpStripes</span></a></span><span> </span><span class="annot"><span class="annottext">Option (Refined NonNegative Int)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#pgStripesOption"><span class="hs-identifier hs-var">pgStripesOption</span></a></span><span>
</span><span id="line-212"></span><span>      </span><span class="hs-comment">-- Note: by Little's Law we can expect e.g. (with 50 max connections) a</span><span>
</span><span id="line-213"></span><span>      </span><span class="hs-comment">-- hard throughput cap at 1000RPS when db queries take 50ms on average:</span><span>
</span><span id="line-214"></span><span>      </span><span id="local-6989586621689757896"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621689757896"><span class="hs-identifier hs-var">cpConns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Refined NonNegative Int -&gt; Int
forall k (p :: k) x. Refined p x -&gt; x
</span><span class="hs-identifier hs-var">unrefine</span></span><span> </span><span class="annot"><span class="annottext">(Refined NonNegative Int -&gt; Int)
-&gt; WithEnvT m (Refined NonNegative Int) -&gt; WithEnvT m Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Refined NonNegative Int)
-&gt; Option (Refined NonNegative Int)
-&gt; WithEnvT m (Refined NonNegative Int)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Refined NonNegative Int)
</span><a href="#local-6989586621689757909"><span class="hs-identifier hs-var">rcpConns</span></a></span><span> </span><span class="annot"><span class="annottext">Option (Refined NonNegative Int)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#pgConnsOption"><span class="hs-identifier hs-var">pgConnsOption</span></a></span><span>
</span><span id="line-215"></span><span>      </span><span id="local-6989586621689757894"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621689757894"><span class="hs-identifier hs-var">cpIdleTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Refined NonNegative Int -&gt; Int
forall k (p :: k) x. Refined p x -&gt; x
</span><span class="hs-identifier hs-var">unrefine</span></span><span> </span><span class="annot"><span class="annottext">(Refined NonNegative Int -&gt; Int)
-&gt; WithEnvT m (Refined NonNegative Int) -&gt; WithEnvT m Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Refined NonNegative Int)
-&gt; Option (Refined NonNegative Int)
-&gt; WithEnvT m (Refined NonNegative Int)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Refined NonNegative Int)
</span><a href="#local-6989586621689757908"><span class="hs-identifier hs-var">rcpIdleTime</span></a></span><span> </span><span class="annot"><span class="annottext">Option (Refined NonNegative Int)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#pgTimeoutOption"><span class="hs-identifier hs-var">pgTimeoutOption</span></a></span><span>
</span><span id="line-216"></span><span>      </span><span id="local-6989586621689757892"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689757892"><span class="hs-identifier hs-var">cpAllowPrepare</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; Option Bool -&gt; WithEnvT m Bool
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621689757906"><span class="hs-identifier hs-var">rcpAllowPrepare</span></a></span><span> </span><span class="annot"><span class="annottext">Option Bool
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#pgUsePreparedStatementsOption"><span class="hs-identifier hs-var">pgUsePreparedStatementsOption</span></a></span><span>
</span><span id="line-217"></span><span>      </span><span class="hs-comment">-- TODO: Add newtype to allow this:</span><span>
</span><span id="line-218"></span><span>      </span><span id="local-6989586621689757890"><span class="annot"><span class="annottext">Maybe NominalDiffTime
</span><a href="#local-6989586621689757890"><span class="hs-identifier hs-var">cpMbLifetime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-219"></span><span>        </span><span id="local-6989586621689757889"><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621689757889"><span class="hs-identifier hs-var">lifetime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Refined NonNegative NominalDiffTime -&gt; NominalDiffTime
forall k (p :: k) x. Refined p x -&gt; x
</span><span class="hs-identifier hs-var">unrefine</span></span><span> </span><span class="annot"><span class="annottext">(Refined NonNegative NominalDiffTime -&gt; NominalDiffTime)
-&gt; WithEnvT m (Refined NonNegative NominalDiffTime)
-&gt; WithEnvT m NominalDiffTime
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Refined NonNegative NominalDiffTime)
-&gt; Option (Refined NonNegative NominalDiffTime)
-&gt; WithEnvT m (Refined NonNegative NominalDiffTime)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Refined NonNegative NominalDiffTime)
</span><a href="#local-6989586621689757907"><span class="hs-identifier hs-var">rcpConnLifetime</span></a></span><span> </span><span class="annot"><span class="annottext">Option (Refined NonNegative NominalDiffTime)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#pgConnLifetimeOption"><span class="hs-identifier hs-var">pgConnLifetimeOption</span></a></span><span>
</span><span id="line-220"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621689757889"><span class="hs-identifier hs-var">lifetime</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; NominalDiffTime -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><span class="hs-number">0</span></span><span>
</span><span id="line-221"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe NominalDiffTime -&gt; WithEnvT m (Maybe NominalDiffTime)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe NominalDiffTime
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-222"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe NominalDiffTime -&gt; WithEnvT m (Maybe NominalDiffTime)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NominalDiffTime -&gt; Maybe NominalDiffTime
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621689757889"><span class="hs-identifier hs-var">lifetime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>      </span><span id="local-6989586621689757887"><span class="annot"><span class="annottext">Maybe NominalDiffTime
</span><a href="#local-6989586621689757887"><span class="hs-identifier hs-var">cpTimeout</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Refined NonNegative NominalDiffTime -&gt; NominalDiffTime)
-&gt; Maybe (Refined NonNegative NominalDiffTime)
-&gt; Maybe NominalDiffTime
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Refined NonNegative NominalDiffTime -&gt; NominalDiffTime
forall k (p :: k) x. Refined p x -&gt; x
</span><span class="hs-identifier hs-var">unrefine</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Refined NonNegative NominalDiffTime)
 -&gt; Maybe NominalDiffTime)
-&gt; WithEnvT m (Maybe (Refined NonNegative NominalDiffTime))
-&gt; WithEnvT m (Maybe NominalDiffTime)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Refined NonNegative NominalDiffTime)
-&gt; Option ()
-&gt; WithEnvT m (Maybe (Refined NonNegative NominalDiffTime))
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option () -&gt; WithEnvT m (Maybe option)
</span><a href="Hasura.Server.Init.Env.html#withOption"><span class="hs-identifier hs-var">withOption</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Refined NonNegative NominalDiffTime)
</span><a href="#local-6989586621689757905"><span class="hs-identifier hs-var">rcpPoolTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">Option ()
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#pgPoolTimeoutOption"><span class="hs-identifier hs-var">pgPoolTimeoutOption</span></a></span><span>
</span><span id="line-224"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689757885"><span class="annot"><span class="annottext">cpCancel :: Bool
</span><a href="#local-6989586621689757885"><span class="hs-identifier hs-var hs-var">cpCancel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-225"></span><span>      </span><span class="annot"><span class="annottext">ConnParams -&gt; WithEnvT m ConnParams
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ConnParams -&gt; WithEnvT m ConnParams)
-&gt; ConnParams -&gt; WithEnvT m ConnParams
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-226"></span><span>        </span><span class="annot"><span class="annottext">ConnParams :: Int
-&gt; Int
-&gt; Int
-&gt; Bool
-&gt; Maybe NominalDiffTime
-&gt; Maybe NominalDiffTime
-&gt; Bool
-&gt; ConnParams
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">Query.ConnParams</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Bool
Int
Maybe NominalDiffTime
cpStripes :: Int
cpConns :: Int
cpIdleTime :: Int
cpAllowPrepare :: Bool
cpMbLifetime :: Maybe NominalDiffTime
cpTimeout :: Maybe NominalDiffTime
cpCancel :: Bool
cpCancel :: Bool
cpTimeout :: Maybe NominalDiffTime
cpMbLifetime :: Maybe NominalDiffTime
cpAllowPrepare :: Bool
cpIdleTime :: Int
cpConns :: Int
cpStripes :: Int
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span>    </span><span id="local-6989586621689758043"><span class="annot"><span class="annottext">mkAuthHook :: AuthHookRaw -&gt; WithEnvT m (Maybe AuthHook)
</span><a href="#local-6989586621689758043"><span class="hs-identifier hs-var hs-var">mkAuthHook</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#AuthHookRaw"><span class="hs-identifier hs-type">AuthHookRaw</span></a></span><span> </span><span id="local-6989586621689757875"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689757875"><span class="hs-identifier hs-var">mUrl</span></a></span></span><span> </span><span id="local-6989586621689757874"><span class="annot"><span class="annottext">Maybe AuthHookType
</span><a href="#local-6989586621689757874"><span class="hs-identifier hs-var">mType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-229"></span><span>      </span><span id="local-6989586621689757873"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689757873"><span class="hs-identifier hs-var">mUrlEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; Option () -&gt; WithEnvT m (Maybe Text)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option () -&gt; WithEnvT m (Maybe option)
</span><a href="Hasura.Server.Init.Env.html#withOption"><span class="hs-identifier hs-var">withOption</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689757875"><span class="hs-identifier hs-var">mUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Option ()
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#authHookOption"><span class="hs-identifier hs-var">authHookOption</span></a></span><span>
</span><span id="line-230"></span><span>      </span><span class="hs-comment">-- Also support HASURA_GRAPHQL_AUTH_HOOK_TYPE</span><span>
</span><span id="line-231"></span><span>      </span><span class="hs-comment">-- TODO (from master):- drop this in next major update &lt;--- (NOTE: This comment is from 2020-08-21)</span><span>
</span><span id="line-232"></span><span>      </span><span id="local-6989586621689757871"><span class="annot"><span class="annottext">AuthHookType
</span><a href="#local-6989586621689757871"><span class="hs-identifier hs-var">authMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-233"></span><span>        </span><span class="annot"><span class="annottext">Maybe AuthHookType
-&gt; WithEnvT m AuthHookType -&gt; WithEnvT m AuthHookType
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">onNothing</span></a></span><span>
</span><span id="line-234"></span><span>          </span><span class="annot"><span class="annottext">Maybe AuthHookType
</span><a href="#local-6989586621689757874"><span class="hs-identifier hs-var">mType</span></a></span><span>
</span><span id="line-235"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">AuthHookType -&gt; Maybe AuthHookType -&gt; AuthHookType
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Option AuthHookType -&gt; AuthHookType
forall def. Option def -&gt; def
</span><a href="Hasura.Server.Init.Config.html#_default"><span class="hs-identifier hs-var hs-var">_default</span></a></span><span> </span><span class="annot"><span class="annottext">Option AuthHookType
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#authHookModeOption"><span class="hs-identifier hs-var">authHookModeOption</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>              </span><span class="annot"><span class="annottext">(Maybe AuthHookType -&gt; AuthHookType)
-&gt; WithEnvT m (Maybe AuthHookType) -&gt; WithEnvT m AuthHookType
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; WithEnvT m (Maybe AuthHookType)
forall (m :: * -&gt; *) a.
(Monad m, FromEnv a) =&gt;
[String] -&gt; WithEnvT m (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#considerEnvs"><span class="hs-identifier hs-var">considerEnvs</span></a></span><span>
</span><span id="line-237"></span><span>                </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Option AuthHookType -&gt; String
forall def. Option def -&gt; String
</span><a href="Hasura.Server.Init.Config.html#_envVar"><span class="hs-identifier hs-var hs-var">_envVar</span></a></span><span> </span><span class="annot"><span class="annottext">Option AuthHookType
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#authHookModeOption"><span class="hs-identifier hs-var">authHookModeOption</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HASURA_GRAPHQL_AUTH_HOOK_TYPE&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-238"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>      </span><span class="annot"><span class="annottext">Maybe AuthHook -&gt; WithEnvT m (Maybe AuthHook)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe AuthHook -&gt; WithEnvT m (Maybe AuthHook))
-&gt; Maybe AuthHook -&gt; WithEnvT m (Maybe AuthHook)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; AuthHookType -&gt; AuthHook
</span><a href="Hasura.Server.Auth.WebHook.html#AuthHook"><span class="hs-operator hs-var">`Auth.AuthHook`</span></a></span><span> </span><span class="annot"><span class="annottext">AuthHookType
</span><a href="#local-6989586621689757871"><span class="hs-identifier hs-var">authMode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; AuthHook) -&gt; Maybe Text -&gt; Maybe AuthHook
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689757873"><span class="hs-identifier hs-var">mUrlEnv</span></a></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span>    </span><span id="local-6989586621689758036"><span class="annot"><span class="annottext">mkCorsConfig :: Maybe CorsConfig -&gt; WithEnvT Identity CorsConfig
</span><a href="#local-6989586621689758036"><span class="hs-identifier hs-var hs-var">mkCorsConfig</span></a></span></span><span> </span><span id="local-6989586621689757864"><span class="annot"><span class="annottext">Maybe CorsConfig
</span><a href="#local-6989586621689757864"><span class="hs-identifier hs-var">mCfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-242"></span><span>      </span><span id="local-6989586621689757863"><span class="annot"><span class="annottext">CorsConfig
</span><a href="#local-6989586621689757863"><span class="hs-identifier hs-var">corsCfg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-243"></span><span>        </span><span id="local-6989586621689757862"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689757862"><span class="hs-identifier hs-var">corsDisabled</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; Option Bool -&gt; WithEnvT Identity Bool
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Option Bool
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#disableCorsOption"><span class="hs-identifier hs-var">disableCorsOption</span></a></span><span>
</span><span id="line-244"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689757862"><span class="hs-identifier hs-var">corsDisabled</span></a></span><span>
</span><span id="line-245"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">CorsConfig -&gt; WithEnvT Identity CorsConfig
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; CorsConfig
</span><a href="Hasura.Server.Cors.html#CCDisabled"><span class="hs-identifier hs-var">Cors.CCDisabled</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; CorsConfig) -&gt; Bool -&gt; CorsConfig
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Option Bool -&gt; Bool
forall def. Option def -&gt; def
</span><a href="Hasura.Server.Init.Config.html#_default"><span class="hs-identifier hs-var hs-var">_default</span></a></span><span> </span><span class="annot"><span class="annottext">Option Bool
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#disableCorsOption"><span class="hs-identifier hs-var">disableCorsOption</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe CorsConfig
-&gt; Option CorsConfig -&gt; WithEnvT Identity CorsConfig
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CorsConfig
</span><a href="#local-6989586621689757864"><span class="hs-identifier hs-var">mCfg</span></a></span><span> </span><span class="annot"><span class="annottext">Option CorsConfig
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#corsDomainOption"><span class="hs-identifier hs-var">corsDomainOption</span></a></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span>      </span><span id="local-6989586621689757858"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689757858"><span class="hs-identifier hs-var">readCookVal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-249"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689758130"><span class="hs-identifier hs-var">rsoWsReadCookie</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-250"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; Option Bool -&gt; WithEnvT Identity Bool
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Option Bool
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#wsReadCookieOption"><span class="hs-identifier hs-var">wsReadCookieOption</span></a></span><span>
</span><span id="line-251"></span><span>          </span><span id="local-6989586621689757856"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689757856"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; WithEnvT Identity Bool
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689757856"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-252"></span><span>      </span><span id="local-6989586621689757855"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689757855"><span class="hs-identifier hs-var">wsReadCookie</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CorsConfig -&gt; Bool
</span><a href="Hasura.Server.Cors.html#isCorsDisabled"><span class="hs-identifier hs-var">Cors.isCorsDisabled</span></a></span><span> </span><span class="annot"><span class="annottext">CorsConfig
</span><a href="#local-6989586621689757863"><span class="hs-identifier hs-var">corsCfg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689757858"><span class="hs-identifier hs-var">readCookVal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-253"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; WithEnvT Identity Bool
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689757858"><span class="hs-identifier hs-var">readCookVal</span></a></span><span>
</span><span id="line-254"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-255"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; WithEnvT Identity Bool
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; WithEnvT Identity Bool)
-&gt; String -&gt; WithEnvT Identity Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-256"></span><span>            </span><span class="annot"><span class="annottext">Option Bool -&gt; String
forall def. Option def -&gt; String
</span><a href="Hasura.Server.Init.Config.html#_envVar"><span class="hs-identifier hs-var hs-var">_envVar</span></a></span><span> </span><span class="annot"><span class="annottext">Option Bool
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#wsReadCookieOption"><span class="hs-identifier hs-var">wsReadCookieOption</span></a></span><span>
</span><span id="line-257"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; can only be used when CORS is disabled&quot;</span></span><span>
</span><span id="line-258"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; WithEnvT Identity Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-259"></span><span>      </span><span class="annot"><span class="annottext">CorsConfig -&gt; WithEnvT Identity CorsConfig
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(CorsConfig -&gt; WithEnvT Identity CorsConfig)
-&gt; CorsConfig -&gt; WithEnvT Identity CorsConfig
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CorsConfig
</span><a href="#local-6989586621689757863"><span class="hs-identifier hs-var">corsCfg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-260"></span><span>        </span><span class="annot"><a href="Hasura.Server.Cors.html#CCDisabled"><span class="hs-identifier hs-type">Cors.CCDisabled</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; CorsConfig
</span><a href="Hasura.Server.Cors.html#CCDisabled"><span class="hs-identifier hs-var">Cors.CCDisabled</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689757855"><span class="hs-identifier hs-var">wsReadCookie</span></a></span><span>
</span><span id="line-261"></span><span>        </span><span class="annot"><span class="annottext">CorsConfig
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CorsConfig
</span><a href="#local-6989586621689757863"><span class="hs-identifier hs-var">corsCfg</span></a></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span>    </span><span id="local-6989586621689757996"><span class="annot"><span class="annottext">mkResponseInternalErrorsConfig :: Bool -&gt; WithEnvT Identity ResponseInternalErrorsConfig
</span><a href="#local-6989586621689757996"><span class="hs-identifier hs-var hs-var">mkResponseInternalErrorsConfig</span></a></span></span><span> </span><span id="local-6989586621689757852"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689757852"><span class="hs-identifier hs-var">devMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-264"></span><span>      </span><span id="local-6989586621689757851"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689757851"><span class="hs-identifier hs-var">adminInternalErrors</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; Option Bool -&gt; WithEnvT Identity Bool
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621689758118"><span class="hs-identifier hs-var">rsoAdminInternalErrors</span></a></span><span> </span><span class="annot"><span class="annottext">Option Bool
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#graphqlAdminInternalErrorsOption"><span class="hs-identifier hs-var">graphqlAdminInternalErrorsOption</span></a></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span>      </span><span class="hs-keyword">if</span><span>
</span><span id="line-267"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689757852"><span class="hs-identifier hs-var">devMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResponseInternalErrorsConfig
-&gt; WithEnvT Identity ResponseInternalErrorsConfig
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ResponseInternalErrorsConfig
</span><a href="Hasura.Server.Init.Config.html#InternalErrorsAllRequests"><span class="hs-identifier hs-var">InternalErrorsAllRequests</span></a></span><span>
</span><span id="line-268"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689757851"><span class="hs-identifier hs-var">adminInternalErrors</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResponseInternalErrorsConfig
-&gt; WithEnvT Identity ResponseInternalErrorsConfig
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ResponseInternalErrorsConfig
</span><a href="Hasura.Server.Init.Config.html#InternalErrorsAdminOnly"><span class="hs-identifier hs-var">InternalErrorsAdminOnly</span></a></span><span>
</span><span id="line-269"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResponseInternalErrorsConfig
-&gt; WithEnvT Identity ResponseInternalErrorsConfig
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ResponseInternalErrorsConfig
</span><a href="Hasura.Server.Init.Config.html#InternalErrorsDisabled"><span class="hs-identifier hs-var">InternalErrorsDisabled</span></a></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span>    </span><span id="local-6989586621689757984"><span class="annot"><span class="annottext">mkConnectionOptions :: WithEnvT Identity ConnectionOptions
</span><a href="#local-6989586621689757984"><span class="hs-identifier hs-var hs-var">mkConnectionOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-272"></span><span>      </span><span id="local-6989586621689757846"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689757846"><span class="hs-identifier hs-var">webSocketCompressionFromEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Option Bool -&gt; WithEnvT Identity Bool
forall (m :: * -&gt; *).
Monad m =&gt;
Bool -&gt; Option Bool -&gt; WithEnvT m Bool
</span><a href="Hasura.Server.Init.Env.html#withOptionSwitch"><span class="hs-identifier hs-var">withOptionSwitch</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689758113"><span class="hs-identifier hs-var">rsoWebSocketCompression</span></a></span><span> </span><span class="annot"><span class="annottext">Option Bool
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#webSocketCompressionOption"><span class="hs-identifier hs-var">webSocketCompressionOption</span></a></span><span>
</span><span id="line-273"></span><span>      </span><span class="annot"><span class="annottext">ConnectionOptions -&gt; WithEnvT Identity ConnectionOptions
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ConnectionOptions -&gt; WithEnvT Identity ConnectionOptions)
-&gt; ConnectionOptions -&gt; WithEnvT Identity ConnectionOptions
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-274"></span><span>        </span><span class="annot"><span class="annottext">ConnectionOptions
</span><span class="hs-identifier hs-var">WebSockets.defaultConnectionOptions</span></span><span>
</span><span id="line-275"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">connectionCompressionOptions :: CompressionOptions
</span><span class="hs-identifier hs-var">WebSockets.connectionCompressionOptions</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-276"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689757846"><span class="hs-identifier hs-var">webSocketCompressionFromEnv</span></a></span><span>
</span><span id="line-277"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">PermessageDeflate -&gt; CompressionOptions
</span><span class="hs-identifier hs-var">WebSockets.PermessageDeflateCompression</span></span><span> </span><span class="annot"><span class="annottext">PermessageDeflate
</span><span class="hs-identifier hs-var">WebSockets.defaultPermessageDeflate</span></span><span>
</span><span id="line-278"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">CompressionOptions
</span><span class="hs-identifier hs-var">WebSockets.NoCompression</span></span><span>
</span><span id="line-279"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-280"></span></pre></body></html>