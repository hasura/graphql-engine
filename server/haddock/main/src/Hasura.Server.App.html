<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.Server.App</span><span>
</span><span id="line-4"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier">APIResp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier">JSONResp</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-5"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleRenderer"><span class="hs-identifier">ConsoleRenderer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier">Handler</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier">HandlerCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.App.html#hcReqHeaders"><span class="hs-identifier">hcReqHeaders</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier">hcServerCtx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#hcUser"><span class="hs-identifier">hcUser</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#HasuraApp"><span class="hs-identifier">HasuraApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.App.html#HasuraApp"><span class="hs-identifier">HasuraApp</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadConfigApiHandler"><span class="hs-identifier">MonadConfigApiHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#ServerCtx"><span class="hs-identifier">ServerCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.App.html#scManager"><span class="hs-identifier">scManager</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#scLoggingSettings"><span class="hs-identifier">scLoggingSettings</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#boolToText"><span class="hs-identifier">boolToText</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#configApiGetHandler"><span class="hs-identifier">configApiGetHandler</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#isAdminSecretSet"><span class="hs-identifier">isAdminSecretSet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier">mkGetHandler</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#mkSpockAction"><span class="hs-identifier">mkSpockAction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#mkWaiApp"><span class="hs-identifier">mkWaiApp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier">onlyAdmin</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#renderHtmlTemplate"><span class="hs-identifier">renderHtmlTemplate</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">where</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.Async.Lifted.Safe</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LA</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IOException</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">try</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.Monad.Stateless.html"><span class="hs-identifier">Control.Monad.Stateless</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Control</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadBaseControl</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Control</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MTC</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">json</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">J</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.Key</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">K</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.KeyMap</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">KM</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B8</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.CaseInsensitive</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CI</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Environment.html"><span class="hs-identifier">Data.Environment</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Env</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashSet</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromString</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Conversions</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">convertText</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Text.Extended.html"><span class="hs-identifier">Data.Text.Extended</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Lazy</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LT</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Lazy.Encoding</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TL</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stats.Extended.html"><span class="hs-identifier">GHC.Stats.Extended</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">RTS</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/graphql-engine-1.0.0/l/dc-api/opt/doc/html/graphql-engine/src"><span class="hs-identifier">Hasura.Backends.DataConnector.API</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/graphql-engine-1.0.0/l/dc-api/opt/doc/html/graphql-engine/src"><span class="hs-identifier">openApiSchema</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Types.html"><span class="hs-identifier">Hasura.Backends.Postgres.Execute.Types</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Base.Error.html"><span class="hs-identifier">Hasura.Base.Error</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.EncJSON.html"><span class="hs-identifier">Hasura.EncJSON</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.html"><span class="hs-identifier">Hasura.GraphQL.Execute</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Backend.html"><span class="hs-identifier">Hasura.GraphQL.Execute.Backend</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EB</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.Options.html"><span class="hs-identifier">Hasura.GraphQL.Execute.Subscription.Options</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ES</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.Poll.html"><span class="hs-identifier">Hasura.GraphQL.Execute.Subscription.Poll</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ES</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.State.html"><span class="hs-identifier">Hasura.GraphQL.Execute.Subscription.State</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ES</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Explain.html"><span class="hs-identifier">Hasura.GraphQL.Explain</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">GE</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Logging.html"><span class="hs-identifier">Hasura.GraphQL.Logging</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Logging.html#MonadQueryLog"><span class="hs-identifier">MonadQueryLog</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.NamingCase.html"><span class="hs-identifier">Hasura.GraphQL.Schema.NamingCase</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.Options.html"><span class="hs-identifier">Hasura.GraphQL.Schema.Options</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Options</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html"><span class="hs-identifier">Hasura.GraphQL.Transport.HTTP</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">GH</span></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html"><span class="hs-identifier">Hasura.GraphQL.Transport.HTTP.Protocol</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">GH</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WSServerApp.html"><span class="hs-identifier">Hasura.GraphQL.Transport.WSServerApp</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WS</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Server.html"><span class="hs-identifier">Hasura.GraphQL.Transport.WebSocket.Server</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WS</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.HTTP.html"><span class="hs-identifier">Hasura.HTTP</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Logging.html"><span class="hs-identifier">Hasura.Logging</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Metadata.Class.html"><span class="hs-identifier">Hasura.Metadata.Class</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Prelude.html"><span class="hs-identifier">Hasura.Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">get</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">put</span></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html"><span class="hs-identifier">Hasura.RQL.Types.Common</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html"><span class="hs-identifier">Hasura.RQL.Types.Endpoint</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EP</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCache</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html"><span class="hs-identifier">Hasura.RQL.Types.Source</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.Backend.html"><span class="hs-identifier">Hasura.SQL.Backend</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.API.Config.html"><span class="hs-identifier">Hasura.Server.API.Config</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.API.Config.html#runGetConfig"><span class="hs-identifier">runGetConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.API.Metadata.html"><span class="hs-identifier">Hasura.Server.API.Metadata</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.API.PGDump.html"><span class="hs-identifier">Hasura.Server.API.PGDump</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PGD</span></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.API.Query.html"><span class="hs-identifier">Hasura.Server.API.Query</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.API.V2Query.html"><span class="hs-identifier">Hasura.Server.API.V2Query</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2Q</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Auth.html"><span class="hs-identifier">Hasura.Server.Auth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Auth.html#AuthMode"><span class="hs-identifier">AuthMode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Auth.html#UserAuthentication"><span class="hs-identifier">UserAuthentication</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Compression.html"><span class="hs-identifier">Hasura.Server.Compression</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Cors.html"><span class="hs-identifier">Hasura.Server.Cors</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.html"><span class="hs-identifier">Hasura.Server.Init</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Limits.html"><span class="hs-identifier">Hasura.Server.Limits</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Logging.html"><span class="hs-identifier">Hasura.Server.Logging</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Metrics.html"><span class="hs-identifier">Hasura.Server.Metrics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Metrics.html#ServerMetrics"><span class="hs-identifier">ServerMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Middleware.html"><span class="hs-identifier">Hasura.Server.Middleware</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Middleware.html#corsMiddleware"><span class="hs-identifier">corsMiddleware</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.OpenAPI.html"><span class="hs-identifier">Hasura.Server.OpenAPI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.OpenAPI.html#buildOpenAPI"><span class="hs-identifier">buildOpenAPI</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Rest.html"><span class="hs-identifier">Hasura.Server.Rest</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.SchemaCacheRef.html"><span class="hs-identifier">Hasura.Server.SchemaCacheRef</span></a></span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Server.SchemaCacheRef.html#SchemaCacheRef"><span class="hs-identifier">SchemaCacheRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>    </span><span class="annot"><a href="Hasura.Server.SchemaCacheRef.html#getSchemaCache"><span class="hs-identifier">getSchemaCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>    </span><span class="annot"><a href="Hasura.Server.SchemaCacheRef.html#readSchemaCacheRef"><span class="hs-identifier">readSchemaCacheRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><a href="Hasura.Server.SchemaCacheRef.html#withSchemaCacheUpdate"><span class="hs-identifier">withSchemaCacheUpdate</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html"><span class="hs-identifier">Hasura.Server.Types</span></a></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Utils.html"><span class="hs-identifier">Hasura.Server.Utils</span></a></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Version.html"><span class="hs-identifier">Hasura.Server.Version</span></a></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Session.html"><span class="hs-identifier">Hasura.Session</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Tracing.html"><span class="hs-identifier">Hasura.Tracing</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Tracing</span></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Client</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HTTP</span></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Types</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HTTP</span></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Mime</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">defaultMimeLookup</span></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.Wai.Extended.html"><span class="hs-identifier">Network.Wai.Extended</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Wai</span></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WebSockets.Custom.html"><span class="hs-identifier">Network.Wai.Handler.WebSockets.Custom</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WSC</span></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.WebSockets</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WS</span></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">joinPath</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">takeFileName</span></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Mem</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">performMajorGC</span></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Metrics</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EKG</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Metrics.Json</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EKG</span></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Mustache</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Web.Spock.Core</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;//&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Web.Spock.Core</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Spock</span></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-keyword">data</span><span> </span><span id="ServerCtx"><span class="annot"><a href="Hasura.Server.App.html#ServerCtx"><span class="hs-identifier hs-var">ServerCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ServerCtx"><span class="annot"><a href="Hasura.Server.App.html#ServerCtx"><span class="hs-identifier hs-var">ServerCtx</span></a></span></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="scLogger"><span class="annot"><span class="annottext">ServerCtx -&gt; Logger Hasura
</span><a href="Hasura.Server.App.html#scLogger"><span class="hs-identifier hs-var hs-var">scLogger</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">L.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">L.Hasura</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-114"></span><span>    </span><span id="scCacheRef"><span class="annot"><span class="annottext">ServerCtx -&gt; SchemaCacheRef
</span><a href="Hasura.Server.App.html#scCacheRef"><span class="hs-identifier hs-var hs-var">scCacheRef</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.Server.SchemaCacheRef.html#SchemaCacheRef"><span class="hs-identifier hs-type">SchemaCacheRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-115"></span><span>    </span><span id="scAuthMode"><span class="annot"><span class="annottext">ServerCtx -&gt; AuthMode
</span><a href="Hasura.Server.App.html#scAuthMode"><span class="hs-identifier hs-var hs-var">scAuthMode</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.Server.Auth.html#AuthMode"><span class="hs-identifier hs-type">AuthMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span>    </span><span id="scManager"><span class="annot"><span class="annottext">ServerCtx -&gt; Manager
</span><a href="Hasura.Server.App.html#scManager"><span class="hs-identifier hs-var hs-var">scManager</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">HTTP.Manager</span></span><span class="hs-special">,</span><span>
</span><span id="line-117"></span><span>    </span><span id="scSQLGenCtx"><span class="annot"><span class="annottext">ServerCtx -&gt; SQLGenCtx
</span><a href="Hasura.Server.App.html#scSQLGenCtx"><span class="hs-identifier hs-var hs-var">scSQLGenCtx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SQLGenCtx"><span class="hs-identifier hs-type">SQLGenCtx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-118"></span><span>    </span><span id="scEnabledAPIs"><span class="annot"><span class="annottext">ServerCtx -&gt; HashSet API
</span><a href="Hasura.Server.App.html#scEnabledAPIs"><span class="hs-identifier hs-var hs-var">scEnabledAPIs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.HashSet</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#API"><span class="hs-identifier hs-type">API</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-119"></span><span>    </span><span id="scInstanceId"><span class="annot"><span class="annottext">ServerCtx -&gt; InstanceId
</span><a href="Hasura.Server.App.html#scInstanceId"><span class="hs-identifier hs-var hs-var">scInstanceId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.Server.Types.html#InstanceId"><span class="hs-identifier hs-type">InstanceId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-120"></span><span>    </span><span id="scSubscriptionState"><span class="annot"><span class="annottext">ServerCtx -&gt; SubscriptionsState
</span><a href="Hasura.Server.App.html#scSubscriptionState"><span class="hs-identifier hs-var hs-var">scSubscriptionState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.State.html#SubscriptionsState"><span class="hs-identifier hs-type">ES.SubscriptionsState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-121"></span><span>    </span><span id="scEnableAllowlist"><span class="annot"><span class="annottext">ServerCtx -&gt; Bool
</span><a href="Hasura.Server.App.html#scEnableAllowlist"><span class="hs-identifier hs-var hs-var">scEnableAllowlist</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span>
</span><span id="line-122"></span><span>    </span><span id="scEkgStore"><span class="annot"><span class="annottext">ServerCtx -&gt; Store EmptyMetrics
</span><a href="Hasura.Server.App.html#scEkgStore"><span class="hs-identifier hs-var hs-var">scEkgStore</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EKG.Store</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EKG.EmptyMetrics</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-123"></span><span>    </span><span id="scResponseInternalErrorsConfig"><span class="annot"><span class="annottext">ServerCtx -&gt; ResponseInternalErrorsConfig
</span><a href="Hasura.Server.App.html#scResponseInternalErrorsConfig"><span class="hs-identifier hs-var hs-var">scResponseInternalErrorsConfig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.Server.Init.Config.html#ResponseInternalErrorsConfig"><span class="hs-identifier hs-type">ResponseInternalErrorsConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-124"></span><span>    </span><span id="scEnvironment"><span class="annot"><span class="annottext">ServerCtx -&gt; Environment
</span><a href="Hasura.Server.App.html#scEnvironment"><span class="hs-identifier hs-var hs-var">scEnvironment</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Data.Environment.html#Environment"><span class="hs-identifier hs-type">Env.Environment</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-125"></span><span>    </span><span id="scRemoteSchemaPermsCtx"><span class="annot"><span class="annottext">ServerCtx -&gt; RemoteSchemaPermissions
</span><a href="Hasura.Server.App.html#scRemoteSchemaPermsCtx"><span class="hs-identifier hs-var hs-var">scRemoteSchemaPermsCtx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.GraphQL.Schema.Options.html#RemoteSchemaPermissions"><span class="hs-identifier hs-type">Options.RemoteSchemaPermissions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-126"></span><span>    </span><span id="scFunctionPermsCtx"><span class="annot"><span class="annottext">ServerCtx -&gt; InferFunctionPermissions
</span><a href="Hasura.Server.App.html#scFunctionPermsCtx"><span class="hs-identifier hs-var hs-var">scFunctionPermsCtx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.GraphQL.Schema.Options.html#InferFunctionPermissions"><span class="hs-identifier hs-type">Options.InferFunctionPermissions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-127"></span><span>    </span><span id="scEnableMaintenanceMode"><span class="annot"><span class="annottext">ServerCtx -&gt; MaintenanceMode ()
</span><a href="Hasura.Server.App.html#scEnableMaintenanceMode"><span class="hs-identifier hs-var hs-var">scEnableMaintenanceMode</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Types.html#MaintenanceMode"><span class="hs-identifier hs-type">MaintenanceMode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-128"></span><span>    </span><span id="scExperimentalFeatures"><span class="annot"><span class="annottext">ServerCtx -&gt; HashSet ExperimentalFeature
</span><a href="Hasura.Server.App.html#scExperimentalFeatures"><span class="hs-identifier hs-var hs-var">scExperimentalFeatures</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.HashSet</span></span><span> </span><span class="annot"><a href="Hasura.Server.Types.html#ExperimentalFeature"><span class="hs-identifier hs-type">ExperimentalFeature</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-129"></span><span>    </span><span id="scLoggingSettings"><span class="annot"><span class="annottext">ServerCtx -&gt; LoggingSettings
</span><a href="Hasura.Server.App.html#scLoggingSettings"><span class="hs-identifier hs-var hs-var">scLoggingSettings</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.Server.Logging.html#LoggingSettings"><span class="hs-identifier hs-type">LoggingSettings</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-130"></span><span>    </span><span id="scEventingMode"><span class="annot"><span class="annottext">ServerCtx -&gt; EventingMode
</span><a href="Hasura.Server.App.html#scEventingMode"><span class="hs-identifier hs-var hs-var">scEventingMode</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.Server.Types.html#EventingMode"><span class="hs-identifier hs-type">EventingMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-131"></span><span>    </span><span id="scEnableReadOnlyMode"><span class="annot"><span class="annottext">ServerCtx -&gt; ReadOnlyMode
</span><a href="Hasura.Server.App.html#scEnableReadOnlyMode"><span class="hs-identifier hs-var hs-var">scEnableReadOnlyMode</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.Server.Types.html#ReadOnlyMode"><span class="hs-identifier hs-type">ReadOnlyMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-132"></span><span>    </span><span id="scDefaultNamingConvention"><span class="annot"><span class="annottext">ServerCtx -&gt; Maybe NamingCase
</span><a href="Hasura.Server.App.html#scDefaultNamingConvention"><span class="hs-identifier hs-var hs-var">scDefaultNamingConvention</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.NamingCase.html#NamingCase"><span class="hs-identifier hs-type">NamingCase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-keyword">data</span><span> </span><span id="HandlerCtx"><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-var">HandlerCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HandlerCtx"><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-var">HandlerCtx</span></a></span></span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="hcServerCtx"><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.Server.App.html#ServerCtx"><span class="hs-identifier hs-type">ServerCtx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-137"></span><span>    </span><span id="hcUser"><span class="annot"><span class="annottext">HandlerCtx -&gt; UserInfo
</span><a href="Hasura.Server.App.html#hcUser"><span class="hs-identifier hs-var hs-var">hcUser</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.Session.html#UserInfo"><span class="hs-identifier hs-type">UserInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-138"></span><span>    </span><span id="hcReqHeaders"><span class="annot"><span class="annottext">HandlerCtx -&gt; [Header]
</span><a href="Hasura.Server.App.html#hcReqHeaders"><span class="hs-identifier hs-var hs-var">hcReqHeaders</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HTTP.Header</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-139"></span><span>    </span><span id="hcRequestId"><span class="annot"><span class="annottext">HandlerCtx -&gt; RequestId
</span><a href="Hasura.Server.App.html#hcRequestId"><span class="hs-identifier hs-var hs-var">hcRequestId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.Server.Types.html#RequestId"><span class="hs-identifier hs-type">RequestId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-140"></span><span>    </span><span id="hcSourceIpAddress"><span class="annot"><span class="annottext">HandlerCtx -&gt; IpAddress
</span><a href="Hasura.Server.App.html#hcSourceIpAddress"><span class="hs-identifier hs-var hs-var">hcSourceIpAddress</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Network.Wai.Extended.html#IpAddress"><span class="hs-identifier hs-type">Wai.IpAddress</span></a></span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-keyword">type</span><span> </span><span id="Handler"><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-var">Handler</span></a></span></span><span> </span><span id="local-6989586621689329563"><span class="annot"><a href="#local-6989586621689329563"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MetadataStorageT"><span class="hs-identifier hs-type">MetadataStorageT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329563"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="hs-keyword">data</span><span> </span><span id="APIResp"><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-var">APIResp</span></a></span></span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="JSONResp"><span class="annot"><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="RawResp"><span class="annot"><a href="Hasura.Server.App.html#RawResp"><span class="hs-identifier hs-var">RawResp</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="hs-comment">-- | API request handlers for different endpoints</span><span>
</span><span id="line-150"></span><span class="hs-keyword">data</span><span> </span><span id="APIHandler"><span class="annot"><a href="Hasura.Server.App.html#APIHandler"><span class="hs-identifier hs-var">APIHandler</span></a></span></span><span> </span><span id="local-6989586621689329561"><span class="annot"><a href="#local-6989586621689329561"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621689329560"><span class="annot"><a href="#local-6989586621689329560"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-comment">-- | A simple GET request</span><span>
</span><span id="line-152"></span><span>  </span><span id="local-6989586621689330048"><span id="local-6989586621689330049"><span id="AHGet"><span class="annot"><a href="Hasura.Server.App.html#AHGet"><span class="hs-identifier hs-var">AHGet</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689330049"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLogMetadata"><span class="hs-identifier hs-type">HttpLogMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689330049"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-type">APIResp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIHandler"><span class="hs-identifier hs-type">APIHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689330049"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689330048"><span class="hs-identifier hs-type">void</span></a></span></span></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-comment">-- | A simple POST request that expects a request body from which an 'a' can be extracted</span><span>
</span><span id="line-154"></span><span>  </span><span id="local-6989586621689330044"><span id="local-6989586621689330045"><span id="AHPost"><span class="annot"><a href="Hasura.Server.App.html#AHPost"><span class="hs-identifier hs-var">AHPost</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689330045"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689330044"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLogMetadata"><span class="hs-identifier hs-type">HttpLogMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689330044"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-type">APIResp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIHandler"><span class="hs-identifier hs-type">APIHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689330044"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689330045"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-comment">-- | A general GraphQL request (query or mutation) for which the content of the query</span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-comment">-- is made available to the handler for authentication.</span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-comment">-- This is a more specific version of the 'AHPost' constructor.</span><span>
</span><span id="line-158"></span><span>  </span><span id="local-6989586621689330041"><span id="AHGraphQLRequest"><span class="annot"><a href="Hasura.Server.App.html#AHGraphQLRequest"><span class="hs-identifier hs-var">AHGraphQLRequest</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#ReqsText"><span class="hs-identifier hs-type">GH.ReqsText</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689330041"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLogMetadata"><span class="hs-identifier hs-type">HttpLogMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689330041"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-type">APIResp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIHandler"><span class="hs-identifier hs-type">APIHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689330041"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#ReqsText"><span class="hs-identifier hs-type">GH.ReqsText</span></a></span></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="annot"><a href="Hasura.Server.App.html#boolToText"><span class="hs-identifier hs-type">boolToText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-161"></span><span id="boolToText"><span class="annot"><span class="annottext">boolToText :: Bool -&gt; Text
</span><a href="Hasura.Server.App.html#boolToText"><span class="hs-identifier hs-var hs-var">boolToText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool -&gt; Text
forall a. a -&gt; a -&gt; Bool -&gt; a
</span><span class="hs-identifier hs-var">bool</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;false&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;true&quot;</span></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="annot"><a href="Hasura.Server.App.html#isAdminSecretSet"><span class="hs-identifier hs-type">isAdminSecretSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Server.Auth.html#AuthMode"><span class="hs-identifier hs-type">AuthMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-164"></span><span id="isAdminSecretSet"><span class="annot"><span class="annottext">isAdminSecretSet :: AuthMode -&gt; Text
</span><a href="Hasura.Server.App.html#isAdminSecretSet"><span class="hs-identifier hs-var hs-var">isAdminSecretSet</span></a></span></span><span> </span><span class="annot"><span class="annottext">AuthMode
</span><a href="Hasura.Server.Auth.html#AMNoAuth"><span class="hs-identifier hs-var">AMNoAuth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Text
</span><a href="Hasura.Server.App.html#boolToText"><span class="hs-identifier hs-var">boolToText</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-165"></span><span class="annot"><a href="Hasura.Server.App.html#isAdminSecretSet"><span class="hs-identifier hs-var">isAdminSecretSet</span></a></span><span> </span><span class="annot"><span class="annottext">AuthMode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Text
</span><a href="Hasura.Server.App.html#boolToText"><span class="hs-identifier hs-var">boolToText</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span id="local-6989586621689329756"><span class="annot"><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier hs-type">mkGetHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329756"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLogMetadata"><span class="hs-identifier hs-type">HttpLogMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329756"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-type">APIResp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIHandler"><span class="hs-identifier hs-type">APIHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329756"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-168"></span><span id="mkGetHandler"><span class="annot"><span class="annottext">mkGetHandler :: Handler m (HttpLogMetadata m, APIResp) -&gt; APIHandler m ()
</span><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier hs-var hs-var">mkGetHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handler m (HttpLogMetadata m, APIResp) -&gt; APIHandler m ()
forall (m :: * -&gt; *) void.
Handler m (HttpLogMetadata m, APIResp) -&gt; APIHandler m void
</span><a href="Hasura.Server.App.html#AHGet"><span class="hs-identifier hs-var">AHGet</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span id="local-6989586621689329553"><span id="local-6989586621689329554"><span class="annot"><a href="Hasura.Server.App.html#mkPostHandler"><span class="hs-identifier hs-type">mkPostHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689329554"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329553"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLogMetadata"><span class="hs-identifier hs-type">HttpLogMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329553"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-type">APIResp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIHandler"><span class="hs-identifier hs-type">APIHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329553"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329554"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-171"></span><span id="mkPostHandler"><span class="annot"><span class="annottext">mkPostHandler :: (a -&gt; Handler m (HttpLogMetadata m, APIResp)) -&gt; APIHandler m a
</span><a href="Hasura.Server.App.html#mkPostHandler"><span class="hs-identifier hs-var hs-var">mkPostHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Handler m (HttpLogMetadata m, APIResp)) -&gt; APIHandler m a
forall a (m :: * -&gt; *).
(a -&gt; Handler m (HttpLogMetadata m, APIResp)) -&gt; APIHandler m a
</span><a href="Hasura.Server.App.html#AHPost"><span class="hs-identifier hs-var">AHPost</span></a></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span id="local-6989586621689329551"><span class="annot"><a href="Hasura.Server.App.html#mkGQLRequestHandler"><span class="hs-identifier hs-type">mkGQLRequestHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#ReqsText"><span class="hs-identifier hs-type">GH.ReqsText</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329551"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLogMetadata"><span class="hs-identifier hs-type">HttpLogMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329551"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-type">APIResp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIHandler"><span class="hs-identifier hs-type">APIHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329551"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#ReqsText"><span class="hs-identifier hs-type">GH.ReqsText</span></a></span></span><span>
</span><span id="line-174"></span><span id="mkGQLRequestHandler"><span class="annot"><span class="annottext">mkGQLRequestHandler :: (ReqsText -&gt; Handler m (HttpLogMetadata m, APIResp))
-&gt; APIHandler m ReqsText
</span><a href="Hasura.Server.App.html#mkGQLRequestHandler"><span class="hs-identifier hs-var hs-var">mkGQLRequestHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ReqsText -&gt; Handler m (HttpLogMetadata m, APIResp))
-&gt; APIHandler m ReqsText
forall (m :: * -&gt; *).
(ReqsText -&gt; Handler m (HttpLogMetadata m, APIResp))
-&gt; APIHandler m ReqsText
</span><a href="Hasura.Server.App.html#AHGraphQLRequest"><span class="hs-identifier hs-var">AHGraphQLRequest</span></a></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span id="local-6989586621689329648"><span id="local-6989586621689329649"><span class="annot"><a href="Hasura.Server.App.html#mkAPIRespHandler"><span class="hs-identifier hs-type">mkAPIRespHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621689329649"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689329648"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329649"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689329648"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329649"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-type">APIResp</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-177"></span><span id="mkAPIRespHandler"><span class="annot"><span class="annottext">mkAPIRespHandler :: (a -&gt; Handler m (HttpResponse EncJSON)) -&gt; a -&gt; Handler m APIResp
</span><a href="Hasura.Server.App.html#mkAPIRespHandler"><span class="hs-identifier hs-var hs-var">mkAPIRespHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Handler m (HttpResponse EncJSON) -&gt; Handler m APIResp)
-&gt; (a -&gt; Handler m (HttpResponse EncJSON))
-&gt; a
-&gt; Handler m APIResp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((Handler m (HttpResponse EncJSON) -&gt; Handler m APIResp)
 -&gt; (a -&gt; Handler m (HttpResponse EncJSON))
 -&gt; a
 -&gt; Handler m APIResp)
-&gt; ((HttpResponse EncJSON -&gt; APIResp)
    -&gt; Handler m (HttpResponse EncJSON) -&gt; Handler m APIResp)
-&gt; (HttpResponse EncJSON -&gt; APIResp)
-&gt; (a -&gt; Handler m (HttpResponse EncJSON))
-&gt; a
-&gt; Handler m APIResp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; APIResp)
-&gt; Handler m (HttpResponse EncJSON) -&gt; Handler m APIResp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; APIResp
</span><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span id="local-6989586621689329640"><span id="local-6989586621689329641"><span id="local-6989586621689329642"><span class="annot"><a href="Hasura.Server.App.html#mkGQLAPIRespHandler"><span class="hs-identifier hs-type">mkGQLAPIRespHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621689329642"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689329641"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329642"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689329640"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-182"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689329641"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329642"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689329640"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-type">APIResp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-183"></span><span id="mkGQLAPIRespHandler"><span class="annot"><span class="annottext">mkGQLAPIRespHandler :: (a -&gt; Handler m (b, HttpResponse EncJSON))
-&gt; a -&gt; Handler m (b, APIResp)
</span><a href="Hasura.Server.App.html#mkGQLAPIRespHandler"><span class="hs-identifier hs-var hs-var">mkGQLAPIRespHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Handler m (b, HttpResponse EncJSON) -&gt; Handler m (b, APIResp))
-&gt; (a -&gt; Handler m (b, HttpResponse EncJSON))
-&gt; a
-&gt; Handler m (b, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((Handler m (b, HttpResponse EncJSON) -&gt; Handler m (b, APIResp))
 -&gt; (a -&gt; Handler m (b, HttpResponse EncJSON))
 -&gt; a
 -&gt; Handler m (b, APIResp))
-&gt; ((HttpResponse EncJSON -&gt; APIResp)
    -&gt; Handler m (b, HttpResponse EncJSON) -&gt; Handler m (b, APIResp))
-&gt; (HttpResponse EncJSON -&gt; APIResp)
-&gt; (a -&gt; Handler m (b, HttpResponse EncJSON))
-&gt; a
-&gt; Handler m (b, APIResp)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((b, HttpResponse EncJSON) -&gt; (b, APIResp))
-&gt; Handler m (b, HttpResponse EncJSON) -&gt; Handler m (b, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(((b, HttpResponse EncJSON) -&gt; (b, APIResp))
 -&gt; Handler m (b, HttpResponse EncJSON) -&gt; Handler m (b, APIResp))
-&gt; ((HttpResponse EncJSON -&gt; APIResp)
    -&gt; (b, HttpResponse EncJSON) -&gt; (b, APIResp))
-&gt; (HttpResponse EncJSON -&gt; APIResp)
-&gt; Handler m (b, HttpResponse EncJSON)
-&gt; Handler m (b, APIResp)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; APIResp)
-&gt; (b, HttpResponse EncJSON) -&gt; (b, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; APIResp
</span><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="annot"><a href="Hasura.Server.App.html#isMetadataEnabled"><span class="hs-identifier hs-type">isMetadataEnabled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#ServerCtx"><span class="hs-identifier hs-type">ServerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-186"></span><span id="isMetadataEnabled"><span class="annot"><span class="annottext">isMetadataEnabled :: ServerCtx -&gt; Bool
</span><a href="Hasura.Server.App.html#isMetadataEnabled"><span class="hs-identifier hs-var hs-var">isMetadataEnabled</span></a></span></span><span> </span><span id="local-6989586621689329545"><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329545"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">API -&gt; HashSet API -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><span class="hs-identifier hs-var">S.member</span></span><span> </span><span class="annot"><span class="annottext">API
</span><a href="Hasura.Server.Init.Config.html#METADATA"><span class="hs-identifier hs-var">METADATA</span></a></span><span> </span><span class="annot"><span class="annottext">(HashSet API -&gt; Bool) -&gt; HashSet API -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerCtx -&gt; HashSet API
</span><a href="Hasura.Server.App.html#scEnabledAPIs"><span class="hs-identifier hs-var hs-var">scEnabledAPIs</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329545"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="annot"><a href="Hasura.Server.App.html#isGraphQLEnabled"><span class="hs-identifier hs-type">isGraphQLEnabled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#ServerCtx"><span class="hs-identifier hs-type">ServerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-189"></span><span id="isGraphQLEnabled"><span class="annot"><span class="annottext">isGraphQLEnabled :: ServerCtx -&gt; Bool
</span><a href="Hasura.Server.App.html#isGraphQLEnabled"><span class="hs-identifier hs-var hs-var">isGraphQLEnabled</span></a></span></span><span> </span><span id="local-6989586621689329541"><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329541"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">API -&gt; HashSet API -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><span class="hs-identifier hs-var">S.member</span></span><span> </span><span class="annot"><span class="annottext">API
</span><a href="Hasura.Server.Init.Config.html#GRAPHQL"><span class="hs-identifier hs-var">GRAPHQL</span></a></span><span> </span><span class="annot"><span class="annottext">(HashSet API -&gt; Bool) -&gt; HashSet API -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerCtx -&gt; HashSet API
</span><a href="Hasura.Server.App.html#scEnabledAPIs"><span class="hs-identifier hs-var hs-var">scEnabledAPIs</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329541"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="annot"><a href="Hasura.Server.App.html#isPGDumpEnabled"><span class="hs-identifier hs-type">isPGDumpEnabled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#ServerCtx"><span class="hs-identifier hs-type">ServerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-192"></span><span id="isPGDumpEnabled"><span class="annot"><span class="annottext">isPGDumpEnabled :: ServerCtx -&gt; Bool
</span><a href="Hasura.Server.App.html#isPGDumpEnabled"><span class="hs-identifier hs-var hs-var">isPGDumpEnabled</span></a></span></span><span> </span><span id="local-6989586621689329538"><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329538"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">API -&gt; HashSet API -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><span class="hs-identifier hs-var">S.member</span></span><span> </span><span class="annot"><span class="annottext">API
</span><a href="Hasura.Server.Init.Config.html#PGDUMP"><span class="hs-identifier hs-var">PGDUMP</span></a></span><span> </span><span class="annot"><span class="annottext">(HashSet API -&gt; Bool) -&gt; HashSet API -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerCtx -&gt; HashSet API
</span><a href="Hasura.Server.App.html#scEnabledAPIs"><span class="hs-identifier hs-var hs-var">scEnabledAPIs</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329538"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="annot"><a href="Hasura.Server.App.html#isConfigEnabled"><span class="hs-identifier hs-type">isConfigEnabled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#ServerCtx"><span class="hs-identifier hs-type">ServerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-195"></span><span id="isConfigEnabled"><span class="annot"><span class="annottext">isConfigEnabled :: ServerCtx -&gt; Bool
</span><a href="Hasura.Server.App.html#isConfigEnabled"><span class="hs-identifier hs-var hs-var">isConfigEnabled</span></a></span></span><span> </span><span id="local-6989586621689329535"><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329535"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">API -&gt; HashSet API -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><span class="hs-identifier hs-var">S.member</span></span><span> </span><span class="annot"><span class="annottext">API
</span><a href="Hasura.Server.Init.Config.html#CONFIG"><span class="hs-identifier hs-var">CONFIG</span></a></span><span> </span><span class="annot"><span class="annottext">(HashSet API -&gt; Bool) -&gt; HashSet API -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerCtx -&gt; HashSet API
</span><a href="Hasura.Server.App.html#scEnabledAPIs"><span class="hs-identifier hs-var hs-var">scEnabledAPIs</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329535"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="annot"><a href="Hasura.Server.App.html#isDeveloperAPIEnabled"><span class="hs-identifier hs-type">isDeveloperAPIEnabled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#ServerCtx"><span class="hs-identifier hs-type">ServerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-198"></span><span id="isDeveloperAPIEnabled"><span class="annot"><span class="annottext">isDeveloperAPIEnabled :: ServerCtx -&gt; Bool
</span><a href="Hasura.Server.App.html#isDeveloperAPIEnabled"><span class="hs-identifier hs-var hs-var">isDeveloperAPIEnabled</span></a></span></span><span> </span><span id="local-6989586621689329532"><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329532"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">API -&gt; HashSet API -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><span class="hs-identifier hs-var">S.member</span></span><span> </span><span class="annot"><span class="annottext">API
</span><a href="Hasura.Server.Init.Config.html#DEVELOPER"><span class="hs-identifier hs-var">DEVELOPER</span></a></span><span> </span><span class="annot"><span class="annottext">(HashSet API -&gt; Bool) -&gt; HashSet API -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerCtx -&gt; HashSet API
</span><a href="Hasura.Server.App.html#scEnabledAPIs"><span class="hs-identifier hs-var hs-var">scEnabledAPIs</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329532"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-comment">-- {-# SCC parseBody #-}</span><span>
</span><span id="line-201"></span><span id="local-6989586621689329887"><span id="local-6989586621689329888"><span class="annot"><a href="Hasura.Server.App.html#parseBody"><span class="hs-identifier hs-type">parseBody</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621689329888"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329887"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689329887"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689329888"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-202"></span><span id="parseBody"><span class="annot"><span class="annottext">parseBody :: ByteString -&gt; m (Value, a)
</span><a href="Hasura.Server.App.html#parseBody"><span class="hs-identifier hs-var hs-var">parseBody</span></a></span></span><span> </span><span id="local-6989586621689329529"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329529"><span class="hs-identifier hs-var">reqBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either String Value
forall a. FromJSON a =&gt; ByteString -&gt; Either String a
</span><span class="hs-identifier hs-var">eitherDecode'</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329529"><span class="hs-identifier hs-var">reqBody</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621689329527"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621689329527"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m (Value, a)
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#InvalidJSON"><span class="hs-identifier hs-var">InvalidJSON</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621689329527"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621689329523"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689329523"><span class="hs-identifier hs-var">jVal</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689329523"><span class="hs-identifier hs-var">jVal</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a -&gt; (Value, a)) -&gt; m a -&gt; m (Value, a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; m a
forall a (m :: * -&gt; *). (FromJSON a, QErrM m) =&gt; Value -&gt; m a
</span><a href="Hasura.Base.Error.html#decodeValue"><span class="hs-identifier hs-var">decodeValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689329523"><span class="hs-identifier hs-var">jVal</span></a></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span id="local-6989586621689329818"><span class="annot"><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-type">onlyAdmin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329818"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329818"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689329818"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-208"></span><span id="onlyAdmin"><span class="annot"><span class="annottext">onlyAdmin :: m ()
</span><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-var hs-var">onlyAdmin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-209"></span><span>  </span><span id="local-6989586621689329520"><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689329520"><span class="hs-identifier hs-var">uRole</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; RoleName) -&gt; m RoleName
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserInfo -&gt; RoleName
</span><a href="Hasura.Session.html#_uiRole"><span class="hs-identifier hs-var hs-var">_uiRole</span></a></span><span> </span><span class="annot"><span class="annottext">(UserInfo -&gt; RoleName)
-&gt; (HandlerCtx -&gt; UserInfo) -&gt; HandlerCtx -&gt; RoleName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; UserInfo
</span><a href="Hasura.Server.App.html#hcUser"><span class="hs-identifier hs-var hs-var">hcUser</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621689329520"><span class="hs-identifier hs-var">uRole</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName -&gt; RoleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="Hasura.Session.html#adminRoleName"><span class="hs-identifier hs-var">adminRoleName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#AccessDenied"><span class="hs-identifier hs-var">AccessDenied</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;You have to be an admin to access this endpoint&quot;</span></span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span id="local-6989586621689329862"><span class="annot"><a href="Hasura.Server.App.html#setHeader"><span class="hs-identifier hs-type">setHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329862"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.Header</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spock.ActionT</span></span><span> </span><span class="annot"><a href="#local-6989586621689329862"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-214"></span><span id="setHeader"><span class="annot"><span class="annottext">setHeader :: Header -&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#setHeader"><span class="hs-identifier hs-var hs-var">setHeader</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621689329513"><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621689329513"><span class="hs-identifier hs-var">headerName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329512"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329512"><span class="hs-identifier hs-var">headerValue</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-215"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; ActionT m ()
forall (m :: * -&gt; *) ctx.
MonadIO m =&gt;
Text -&gt; Text -&gt; ActionCtxT ctx m ()
</span><span class="hs-identifier hs-var">Spock.setHeader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="Hasura.Prelude.html#bsToTxt"><span class="hs-identifier hs-var">bsToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Text) -&gt; ByteString -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HeaderName -&gt; ByteString
forall s. CI s -&gt; s
</span><span class="hs-identifier hs-var hs-var">CI.original</span></span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621689329513"><span class="hs-identifier hs-var">headerName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="Hasura.Prelude.html#bsToTxt"><span class="hs-identifier hs-var">bsToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329512"><span class="hs-identifier hs-var">headerValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-comment">-- | Typeclass representing the metadata API authorization effect</span><span>
</span><span id="line-218"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621689329980"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="MonadMetadataApiAuthorization"><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-var">MonadMetadataApiAuthorization</span></a></span></span><span> </span><span id="local-6989586621689329980"><span class="annot"><a href="#local-6989586621689329980"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-219"></span><span>  </span><span id="authorizeV1QueryApi"><span class="annot"><a href="Hasura.Server.App.html#authorizeV1QueryApi"><span class="hs-identifier hs-type">authorizeV1QueryApi</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-220"></span><span>    </span><span class="annot"><a href="Hasura.Server.API.Query.html#RQLQuery"><span class="hs-identifier hs-type">RQLQuery</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689329980"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span>  </span><span id="authorizeV1MetadataApi"><span class="annot"><a href="Hasura.Server.App.html#authorizeV1MetadataApi"><span class="hs-identifier hs-type">authorizeV1MetadataApi</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-223"></span><span>    </span><span class="annot"><a href="Hasura.Server.API.Metadata.html#RQLMetadata"><span class="hs-identifier hs-type">RQLMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689329980"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span>  </span><span id="authorizeV2QueryApi"><span class="annot"><a href="Hasura.Server.App.html#authorizeV2QueryApi"><span class="hs-identifier hs-type">authorizeV2QueryApi</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-226"></span><span>    </span><span class="annot"><a href="Hasura.Server.API.V2Query.html#RQLQuery"><span class="hs-identifier hs-type">V2Q.RQLQuery</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689329980"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span id="local-6989586621689329504"><span id="local-6989586621689329505"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329505"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621689329504"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329505"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-229"></span><span>  </span><span id="local-6989586621689329498"><span class="annot"><span class="annottext">authorizeV1QueryApi :: RQLQuery -&gt; HandlerCtx -&gt; ReaderT r m (Either QErr ())
</span><a href="#local-6989586621689329498"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV1QueryApi</span></a></span></span><span> </span><span id="local-6989586621689329497"><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621689329497"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621689329496"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329496"><span class="hs-identifier hs-var">hc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; ReaderT r m (Either QErr ())
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; ReaderT r m (Either QErr ()))
-&gt; m (Either QErr ()) -&gt; ReaderT r m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1QueryApi"><span class="hs-identifier hs-var">authorizeV1QueryApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621689329497"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329496"><span class="hs-identifier hs-var">hc</span></a></span><span>
</span><span id="line-230"></span><span>  </span><span id="local-6989586621689329494"><span class="annot"><span class="annottext">authorizeV1MetadataApi :: RQLMetadata -&gt; HandlerCtx -&gt; ReaderT r m (Either QErr ())
</span><a href="#local-6989586621689329494"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV1MetadataApi</span></a></span></span><span> </span><span id="local-6989586621689329493"><span class="annot"><span class="annottext">RQLMetadata
</span><a href="#local-6989586621689329493"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621689329492"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329492"><span class="hs-identifier hs-var">hc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; ReaderT r m (Either QErr ())
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; ReaderT r m (Either QErr ()))
-&gt; m (Either QErr ()) -&gt; ReaderT r m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLMetadata -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLMetadata -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1MetadataApi"><span class="hs-identifier hs-var">authorizeV1MetadataApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLMetadata
</span><a href="#local-6989586621689329493"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329492"><span class="hs-identifier hs-var">hc</span></a></span><span>
</span><span id="line-231"></span><span>  </span><span id="local-6989586621689329491"><span class="annot"><span class="annottext">authorizeV2QueryApi :: RQLQuery -&gt; HandlerCtx -&gt; ReaderT r m (Either QErr ())
</span><a href="#local-6989586621689329491"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV2QueryApi</span></a></span></span><span> </span><span id="local-6989586621689329490"><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621689329490"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621689329489"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329489"><span class="hs-identifier hs-var">hc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; ReaderT r m (Either QErr ())
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; ReaderT r m (Either QErr ()))
-&gt; m (Either QErr ()) -&gt; ReaderT r m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV2QueryApi"><span class="hs-identifier hs-var">authorizeV2QueryApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621689329490"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329489"><span class="hs-identifier hs-var">hc</span></a></span></span></span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span id="local-6989586621689329488"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329488"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MetadataStorageT"><span class="hs-identifier hs-type">MetadataStorageT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329488"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-234"></span><span>  </span><span id="local-6989586621689329483"><span class="annot"><span class="annottext">authorizeV1QueryApi :: RQLQuery -&gt; HandlerCtx -&gt; MetadataStorageT m (Either QErr ())
</span><a href="#local-6989586621689329483"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV1QueryApi</span></a></span></span><span> </span><span id="local-6989586621689329482"><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621689329482"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621689329481"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329481"><span class="hs-identifier hs-var">hc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; MetadataStorageT m (Either QErr ())
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; MetadataStorageT m (Either QErr ()))
-&gt; m (Either QErr ()) -&gt; MetadataStorageT m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1QueryApi"><span class="hs-identifier hs-var">authorizeV1QueryApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621689329482"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329481"><span class="hs-identifier hs-var">hc</span></a></span><span>
</span><span id="line-235"></span><span>  </span><span id="local-6989586621689329480"><span class="annot"><span class="annottext">authorizeV1MetadataApi :: RQLMetadata -&gt; HandlerCtx -&gt; MetadataStorageT m (Either QErr ())
</span><a href="#local-6989586621689329480"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV1MetadataApi</span></a></span></span><span> </span><span id="local-6989586621689329479"><span class="annot"><span class="annottext">RQLMetadata
</span><a href="#local-6989586621689329479"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621689329478"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329478"><span class="hs-identifier hs-var">hc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; MetadataStorageT m (Either QErr ())
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; MetadataStorageT m (Either QErr ()))
-&gt; m (Either QErr ()) -&gt; MetadataStorageT m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLMetadata -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLMetadata -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1MetadataApi"><span class="hs-identifier hs-var">authorizeV1MetadataApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLMetadata
</span><a href="#local-6989586621689329479"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329478"><span class="hs-identifier hs-var">hc</span></a></span><span>
</span><span id="line-236"></span><span>  </span><span id="local-6989586621689329477"><span class="annot"><span class="annottext">authorizeV2QueryApi :: RQLQuery -&gt; HandlerCtx -&gt; MetadataStorageT m (Either QErr ())
</span><a href="#local-6989586621689329477"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV2QueryApi</span></a></span></span><span> </span><span id="local-6989586621689329476"><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621689329476"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621689329475"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329475"><span class="hs-identifier hs-var">hc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; MetadataStorageT m (Either QErr ())
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; MetadataStorageT m (Either QErr ()))
-&gt; m (Either QErr ()) -&gt; MetadataStorageT m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV2QueryApi"><span class="hs-identifier hs-var">authorizeV2QueryApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621689329476"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329475"><span class="hs-identifier hs-var">hc</span></a></span></span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span id="local-6989586621689329474"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329474"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.html#TraceT"><span class="hs-identifier hs-type">Tracing.TraceT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329474"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-239"></span><span>  </span><span id="local-6989586621689329469"><span class="annot"><span class="annottext">authorizeV1QueryApi :: RQLQuery -&gt; HandlerCtx -&gt; TraceT m (Either QErr ())
</span><a href="#local-6989586621689329469"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV1QueryApi</span></a></span></span><span> </span><span id="local-6989586621689329468"><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621689329468"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621689329467"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329467"><span class="hs-identifier hs-var">hc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; TraceT m (Either QErr ())
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; TraceT m (Either QErr ()))
-&gt; m (Either QErr ()) -&gt; TraceT m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1QueryApi"><span class="hs-identifier hs-var">authorizeV1QueryApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621689329468"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329467"><span class="hs-identifier hs-var">hc</span></a></span><span>
</span><span id="line-240"></span><span>  </span><span id="local-6989586621689329466"><span class="annot"><span class="annottext">authorizeV1MetadataApi :: RQLMetadata -&gt; HandlerCtx -&gt; TraceT m (Either QErr ())
</span><a href="#local-6989586621689329466"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV1MetadataApi</span></a></span></span><span> </span><span id="local-6989586621689329465"><span class="annot"><span class="annottext">RQLMetadata
</span><a href="#local-6989586621689329465"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621689329464"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329464"><span class="hs-identifier hs-var">hc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; TraceT m (Either QErr ())
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; TraceT m (Either QErr ()))
-&gt; m (Either QErr ()) -&gt; TraceT m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLMetadata -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLMetadata -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1MetadataApi"><span class="hs-identifier hs-var">authorizeV1MetadataApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLMetadata
</span><a href="#local-6989586621689329465"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329464"><span class="hs-identifier hs-var">hc</span></a></span><span>
</span><span id="line-241"></span><span>  </span><span id="local-6989586621689329463"><span class="annot"><span class="annottext">authorizeV2QueryApi :: RQLQuery -&gt; HandlerCtx -&gt; TraceT m (Either QErr ())
</span><a href="#local-6989586621689329463"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV2QueryApi</span></a></span></span><span> </span><span id="local-6989586621689329462"><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621689329462"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621689329461"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329461"><span class="hs-identifier hs-var">hc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; TraceT m (Either QErr ())
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; TraceT m (Either QErr ()))
-&gt; m (Either QErr ()) -&gt; TraceT m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV2QueryApi"><span class="hs-identifier hs-var">authorizeV2QueryApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621689329462"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329461"><span class="hs-identifier hs-var">hc</span></a></span></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="hs-comment">-- | The config API (/v1alpha1/config) handler</span><span>
</span><span id="line-244"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621689329643"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="MonadConfigApiHandler"><span class="annot"><a href="Hasura.Server.App.html#MonadConfigApiHandler"><span class="hs-identifier hs-var">MonadConfigApiHandler</span></a></span></span><span> </span><span id="local-6989586621689329643"><span class="annot"><a href="#local-6989586621689329643"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-245"></span><span>  </span><span id="runConfigApiHandler"><span class="annot"><a href="Hasura.Server.App.html#runConfigApiHandler"><span class="hs-identifier hs-type">runConfigApiHandler</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#ServerCtx"><span class="hs-identifier hs-type">ServerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-comment">-- | console assets directory</span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-249"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Spock.SpockCtxT</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689329643"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="hs-comment">-- instance (MonadIO m, UserAuthentication m, HttpLog m, Tracing.HasReporter m) =&gt; MonadConfigApiHandler (Tracing.TraceT m) where</span><span>
</span><span id="line-252"></span><span class="hs-comment">--   runConfigApiHandler = configApiGetHandler</span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span id="local-6989586621689329901"><span id="local-6989586621689329902"><span id="local-6989586621689329903"><span class="annot"><a href="Hasura.Server.App.html#mapActionT"><span class="hs-identifier hs-type">mapActionT</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621689329903"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621689329902"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689329903"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MTC.StT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Spock.ActionCtxT</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689329901"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689329902"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MTC.StT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Spock.ActionCtxT</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689329901"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-257"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Spock.ActionT</span></span><span> </span><span class="annot"><a href="#local-6989586621689329903"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329901"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-258"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Spock.ActionT</span></span><span> </span><span class="annot"><a href="#local-6989586621689329902"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329901"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-259"></span><span id="mapActionT"><span class="annot"><span class="annottext">mapActionT :: (m (StT (ActionCtxT ()) a) -&gt; n (StT (ActionCtxT ()) a))
-&gt; ActionT m a -&gt; ActionT n a
</span><a href="Hasura.Server.App.html#mapActionT"><span class="hs-identifier hs-var hs-var">mapActionT</span></a></span></span><span> </span><span id="local-6989586621689329458"><span class="annot"><span class="annottext">m (StT (ActionCtxT ()) a) -&gt; n (StT (ActionCtxT ()) a)
</span><a href="#local-6989586621689329458"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689329457"><span class="annot"><span class="annottext">ActionT m a
</span><a href="#local-6989586621689329457"><span class="hs-identifier hs-var">tma</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">n (Either ActionInterupt a, ResponseState, ()) -&gt; ActionT n a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTransControl t, Monad m) =&gt;
m (StT t a) -&gt; t m a
</span><span class="hs-identifier hs-var">MTC.restoreT</span></span><span> </span><span class="annot"><span class="annottext">(n (Either ActionInterupt a, ResponseState, ()) -&gt; ActionT n a)
-&gt; ((Either ActionInterupt a, ResponseState, ())
    -&gt; n (Either ActionInterupt a, ResponseState, ()))
-&gt; (Either ActionInterupt a, ResponseState, ())
-&gt; ActionT n a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Either ActionInterupt a, ResponseState, ())
-&gt; n (Either ActionInterupt a, ResponseState, ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((Either ActionInterupt a, ResponseState, ()) -&gt; ActionT n a)
-&gt; ActionCtxT () n (Either ActionInterupt a, ResponseState, ())
-&gt; ActionT n a
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">(Run (ActionCtxT ())
 -&gt; n (Either ActionInterupt a, ResponseState, ()))
-&gt; ActionCtxT () n (Either ActionInterupt a, ResponseState, ())
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTransControl t, Monad m) =&gt;
(Run t -&gt; m a) -&gt; t m a
</span><span class="hs-identifier hs-var">MTC.liftWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621689329453"><span class="annot"><span class="annottext">Run (ActionCtxT ())
</span><a href="#local-6989586621689329453"><span class="hs-identifier hs-var">run</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (StT (ActionCtxT ()) a) -&gt; n (StT (ActionCtxT ()) a)
</span><a href="#local-6989586621689329458"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActionT m a -&gt; m (StT (ActionCtxT ()) a)
Run (ActionCtxT ())
</span><a href="#local-6989586621689329453"><span class="hs-identifier hs-var">run</span></a></span><span> </span><span class="annot"><span class="annottext">ActionT m a
</span><a href="#local-6989586621689329457"><span class="hs-identifier hs-var">tma</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span id="local-6989586621689329758"><span id="local-6989586621689329759"><span class="annot"><a href="Hasura.Server.App.html#mkSpockAction"><span class="hs-identifier hs-type">mkSpockAction</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329759"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329759"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621689329758"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Auth.html#UserAuthentication"><span class="hs-identifier hs-type">UserAuthentication</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.html#TraceT"><span class="hs-identifier hs-type">Tracing.TraceT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329759"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329759"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Tracing.html#HasReporter"><span class="hs-identifier hs-type">Tracing.HasReporter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329759"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329759"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-263"></span><span>  </span><span class="annot"><a href="Hasura.Server.App.html#ServerCtx"><span class="hs-identifier hs-type">ServerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-comment">-- | `QErr` JSON encoder function</span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-comment">-- | `QErr` modifier</span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-268"></span><span>  </span><span class="annot"><a href="Hasura.Server.App.html#APIHandler"><span class="hs-identifier hs-type">APIHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.html#TraceT"><span class="hs-identifier hs-type">Tracing.TraceT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329759"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689329758"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-269"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Spock.ActionT</span></span><span> </span><span class="annot"><a href="#local-6989586621689329759"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-270"></span><span id="mkSpockAction"><span class="annot"><span class="annottext">mkSpockAction :: ServerCtx
-&gt; (Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr)
-&gt; APIHandler (TraceT m) a
-&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#mkSpockAction"><span class="hs-identifier hs-var hs-var">mkSpockAction</span></a></span></span><span> </span><span id="local-6989586621689329452"><span class="annot"><span class="annottext">serverCtx :: ServerCtx
</span><a href="#local-6989586621689329452"><span class="hs-identifier hs-var">serverCtx</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.Server.App.html#ServerCtx"><span class="hs-identifier hs-type">ServerCtx</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621689329432"><span id="local-6989586621689329433"><span id="local-6989586621689329434"><span id="local-6989586621689329435"><span id="local-6989586621689329436"><span id="local-6989586621689329437"><span id="local-6989586621689329438"><span id="local-6989586621689329439"><span id="local-6989586621689329440"><span id="local-6989586621689329441"><span id="local-6989586621689329442"><span id="local-6989586621689329443"><span id="local-6989586621689329444"><span id="local-6989586621689329445"><span id="local-6989586621689329446"><span id="local-6989586621689329447"><span id="local-6989586621689329448"><span id="local-6989586621689329449"><span id="local-6989586621689329450"><span id="local-6989586621689329451"><span class="annot"><span class="annottext">Bool
Maybe NamingCase
HashSet ExperimentalFeature
HashSet API
Logger Hasura
RemoteSchemaPermissions
InferFunctionPermissions
Environment
Store EmptyMetrics
Manager
SQLGenCtx
EventingMode
ReadOnlyMode
MaintenanceMode ()
InstanceId
LoggingSettings
SchemaCacheRef
AuthMode
ResponseInternalErrorsConfig
SubscriptionsState
scDefaultNamingConvention :: Maybe NamingCase
scEnableReadOnlyMode :: ReadOnlyMode
scEventingMode :: EventingMode
scLoggingSettings :: LoggingSettings
scExperimentalFeatures :: HashSet ExperimentalFeature
scEnableMaintenanceMode :: MaintenanceMode ()
scFunctionPermsCtx :: InferFunctionPermissions
scRemoteSchemaPermsCtx :: RemoteSchemaPermissions
scEnvironment :: Environment
scResponseInternalErrorsConfig :: ResponseInternalErrorsConfig
scEkgStore :: Store EmptyMetrics
scEnableAllowlist :: Bool
scSubscriptionState :: SubscriptionsState
scInstanceId :: InstanceId
scEnabledAPIs :: HashSet API
scSQLGenCtx :: SQLGenCtx
scManager :: Manager
scAuthMode :: AuthMode
scCacheRef :: SchemaCacheRef
scLogger :: Logger Hasura
scDefaultNamingConvention :: ServerCtx -&gt; Maybe NamingCase
scEnableReadOnlyMode :: ServerCtx -&gt; ReadOnlyMode
scEventingMode :: ServerCtx -&gt; EventingMode
scExperimentalFeatures :: ServerCtx -&gt; HashSet ExperimentalFeature
scEnableMaintenanceMode :: ServerCtx -&gt; MaintenanceMode ()
scFunctionPermsCtx :: ServerCtx -&gt; InferFunctionPermissions
scRemoteSchemaPermsCtx :: ServerCtx -&gt; RemoteSchemaPermissions
scEnvironment :: ServerCtx -&gt; Environment
scResponseInternalErrorsConfig :: ServerCtx -&gt; ResponseInternalErrorsConfig
scEkgStore :: ServerCtx -&gt; Store EmptyMetrics
scEnableAllowlist :: ServerCtx -&gt; Bool
scSubscriptionState :: ServerCtx -&gt; SubscriptionsState
scInstanceId :: ServerCtx -&gt; InstanceId
scEnabledAPIs :: ServerCtx -&gt; HashSet API
scSQLGenCtx :: ServerCtx -&gt; SQLGenCtx
scAuthMode :: ServerCtx -&gt; AuthMode
scCacheRef :: ServerCtx -&gt; SchemaCacheRef
scLogger :: ServerCtx -&gt; Logger Hasura
scLoggingSettings :: ServerCtx -&gt; LoggingSettings
scManager :: ServerCtx -&gt; Manager
</span><a href="#local-6989586621689329432"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621689329431"><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Value
</span><a href="#local-6989586621689329431"><span class="hs-identifier hs-var">qErrEncoder</span></a></span></span><span> </span><span id="local-6989586621689329430"><span class="annot"><span class="annottext">QErr -&gt; QErr
</span><a href="#local-6989586621689329430"><span class="hs-identifier hs-var">qErrModifier</span></a></span></span><span> </span><span id="local-6989586621689329429"><span class="annot"><span class="annottext">APIHandler (TraceT m) a
</span><a href="#local-6989586621689329429"><span class="hs-identifier hs-var">apiHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-271"></span><span>  </span><span id="local-6989586621689329428"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689329428"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m Request
forall (m :: * -&gt; *) ctx. MonadIO m =&gt; ActionCtxT ctx m Request
</span><span class="hs-identifier hs-var">Spock.request</span></span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689329426"><span class="annot"><span class="annottext">origHeaders :: [Header]
</span><a href="#local-6989586621689329426"><span class="hs-identifier hs-var hs-var">origHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request -&gt; [Header]
</span><span class="hs-identifier hs-var hs-var">Wai.requestHeaders</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689329428"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-273"></span><span>      </span><span id="local-6989586621689329424"><span class="annot"><span class="annottext">ipAddress :: IpAddress
</span><a href="#local-6989586621689329424"><span class="hs-identifier hs-var hs-var">ipAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request -&gt; IpAddress
</span><a href="Network.Wai.Extended.html#getSourceFromFallback"><span class="hs-identifier hs-var">Wai.getSourceFromFallback</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689329428"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-274"></span><span>      </span><span id="local-6989586621689329422"><span class="annot"><span class="annottext">pathInfo :: ByteString
</span><a href="#local-6989586621689329422"><span class="hs-identifier hs-var hs-var">pathInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request -&gt; ByteString
</span><span class="hs-identifier hs-var hs-var">Wai.rawPathInfo</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689329428"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-comment">-- Bytes are actually read from the socket here. Time this.</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621689329420"><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621689329420"><span class="hs-identifier hs-var">ioWaitTime</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329419"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329419"><span class="hs-identifier hs-var">reqBody</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m ByteString
-&gt; ActionCtxT () m (DiffTime, ByteString)
forall (m :: * -&gt; *) a. MonadIO m =&gt; m a -&gt; m (DiffTime, a)
</span><a href="Hasura.Prelude.html#withElapsedTime"><span class="hs-identifier hs-var">withElapsedTime</span></a></span><span> </span><span class="annot"><span class="annottext">(ActionCtxT () m ByteString
 -&gt; ActionCtxT () m (DiffTime, ByteString))
-&gt; ActionCtxT () m ByteString
-&gt; ActionCtxT () m (DiffTime, ByteString)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO ByteString -&gt; ActionCtxT () m ByteString
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; ActionCtxT () m ByteString)
-&gt; IO ByteString -&gt; ActionCtxT () m ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; IO ByteString
</span><span class="hs-identifier hs-var">Wai.strictRequestBody</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689329428"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621689329415"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689329415"><span class="hs-identifier hs-var">requestId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329414"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329414"><span class="hs-identifier hs-var">headers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; ActionCtxT () m (RequestId, [Header])
forall (m :: * -&gt; *).
MonadIO m =&gt;
[Header] -&gt; m (RequestId, [Header])
</span><a href="Hasura.Server.Types.html#getRequestId"><span class="hs-identifier hs-var">getRequestId</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329426"><span class="hs-identifier hs-var">origHeaders</span></a></span><span>
</span><span id="line-280"></span><span>  </span><span id="local-6989586621689329412"><span class="annot"><span class="annottext">Maybe TraceContext
</span><a href="#local-6989586621689329412"><span class="hs-identifier hs-var">tracingCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe TraceContext) -&gt; ActionCtxT () m (Maybe TraceContext)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe TraceContext) -&gt; ActionCtxT () m (Maybe TraceContext))
-&gt; IO (Maybe TraceContext) -&gt; ActionCtxT () m (Maybe TraceContext)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; IO (Maybe TraceContext)
</span><a href="Hasura.Tracing.html#extractHttpContext"><span class="hs-identifier hs-var">Tracing.extractHttpContext</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329414"><span class="hs-identifier hs-var">headers</span></a></span><span>
</span><span id="line-281"></span><span>  </span><span id="local-6989586621689329410"><span class="annot"><span class="annottext">ResourceLimits
</span><a href="#local-6989586621689329410"><span class="hs-identifier hs-var">handlerLimit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m ResourceLimits -&gt; ActionCtxT () m ResourceLimits
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m ResourceLimits
forall (m :: * -&gt; *). HasResourceLimits m =&gt; m ResourceLimits
</span><a href="Hasura.Server.Limits.html#askHTTPHandlerLimit"><span class="hs-identifier hs-var">askHTTPHandlerLimit</span></a></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621689329408"><span class="hs-identifier hs-type">runTraceT</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-284"></span><span>        </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689329900"><span class="annot"><a href="#local-6989586621689329900"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621689329899"><span class="annot"><a href="#local-6989586621689329899"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-285"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329900"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Tracing.html#HasReporter"><span class="hs-identifier hs-type">Tracing.HasReporter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329900"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-286"></span><span>        </span><span class="annot"><a href="Hasura.Tracing.html#TraceT"><span class="hs-identifier hs-type">Tracing.TraceT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329900"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329899"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-287"></span><span>        </span><span class="annot"><a href="#local-6989586621689329900"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329899"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-288"></span><span>      </span><span id="local-6989586621689329408"><span class="annot"><span class="annottext">runTraceT :: TraceT m a -&gt; m a
</span><a href="#local-6989586621689329408"><span class="hs-identifier hs-var hs-var">runTraceT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-289"></span><span>        </span><span class="annot"><span class="annottext">(Text -&gt; TraceT m a -&gt; m a)
-&gt; (TraceContext -&gt; Text -&gt; TraceT m a -&gt; m a)
-&gt; Maybe TraceContext
-&gt; Text
-&gt; TraceT m a
-&gt; m a
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span>
</span><span id="line-290"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; TraceT m a -&gt; m a
forall (m :: * -&gt; *) a.
(HasReporter m, MonadIO m) =&gt;
Text -&gt; TraceT m a -&gt; m a
</span><a href="Hasura.Tracing.html#runTraceT"><span class="hs-identifier hs-var">Tracing.runTraceT</span></a></span><span>
</span><span id="line-291"></span><span>          </span><span class="annot"><span class="annottext">TraceContext -&gt; Text -&gt; TraceT m a -&gt; m a
forall (m :: * -&gt; *) a.
(MonadIO m, HasReporter m) =&gt;
TraceContext -&gt; Text -&gt; TraceT m a -&gt; m a
</span><a href="Hasura.Tracing.html#runTraceTInContext"><span class="hs-identifier hs-var">Tracing.runTraceTInContext</span></a></span><span>
</span><span id="line-292"></span><span>          </span><span class="annot"><span class="annottext">Maybe TraceContext
</span><a href="#local-6989586621689329412"><span class="hs-identifier hs-var">tracingCtx</span></a></span><span>
</span><span id="line-293"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; String
</span><span class="hs-identifier hs-var">B8.unpack</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329422"><span class="hs-identifier hs-var">pathInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span>      </span><span id="local-6989586621689329892"><span id="local-6989586621689329893"><span class="annot"><a href="#local-6989586621689329403"><span class="hs-identifier hs-type">runHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-296"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329893"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-297"></span><span>        </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-298"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MetadataStorageT"><span class="hs-identifier hs-type">MetadataStorageT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329893"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689329892"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-299"></span><span>        </span><span class="annot"><a href="#local-6989586621689329893"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329892"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-300"></span><span>      </span><span id="local-6989586621689329403"><span class="annot"><span class="annottext">runHandler :: HandlerCtx
-&gt; ReaderT HandlerCtx (MetadataStorageT m) a -&gt; m (Either QErr a)
</span><a href="#local-6989586621689329403"><span class="hs-identifier hs-var hs-var">runHandler</span></a></span></span><span> </span><span id="local-6989586621689329402"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329402"><span class="hs-identifier hs-var">handlerCtx</span></a></span></span><span> </span><span id="local-6989586621689329401"><span class="annot"><span class="annottext">ReaderT HandlerCtx (MetadataStorageT m) a
</span><a href="#local-6989586621689329401"><span class="hs-identifier hs-var">handler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-301"></span><span>        </span><span class="annot"><span class="annottext">MetadataStorageT m a -&gt; m (Either QErr a)
forall (m :: * -&gt; *) a. MetadataStorageT m a -&gt; m (Either QErr a)
</span><a href="Hasura.Metadata.Class.html#runMetadataStorageT"><span class="hs-identifier hs-var">runMetadataStorageT</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataStorageT m a -&gt; m (Either QErr a))
-&gt; MetadataStorageT m a -&gt; m (Either QErr a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ReaderT HandlerCtx (MetadataStorageT m) a
 -&gt; HandlerCtx -&gt; MetadataStorageT m a)
-&gt; HandlerCtx
-&gt; ReaderT HandlerCtx (MetadataStorageT m) a
-&gt; MetadataStorageT m a
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ReaderT HandlerCtx (MetadataStorageT m) a
-&gt; HandlerCtx -&gt; MetadataStorageT m a
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329402"><span class="hs-identifier hs-var">handlerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT HandlerCtx (MetadataStorageT m) a -&gt; MetadataStorageT m a)
-&gt; ReaderT HandlerCtx (MetadataStorageT m) a
-&gt; MetadataStorageT m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ResourceLimits
-&gt; forall (m :: * -&gt; *) a.
   (MonadBaseControl IO m, MonadError QErr m) =&gt;
   m a -&gt; m a
</span><a href="Hasura.Server.Limits.html#runResourceLimits"><span class="hs-identifier hs-var hs-var">runResourceLimits</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceLimits
</span><a href="#local-6989586621689329410"><span class="hs-identifier hs-var">handlerLimit</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT HandlerCtx (MetadataStorageT m) a
 -&gt; ReaderT HandlerCtx (MetadataStorageT m) a)
-&gt; ReaderT HandlerCtx (MetadataStorageT m) a
-&gt; ReaderT HandlerCtx (MetadataStorageT m) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ReaderT HandlerCtx (MetadataStorageT m) a
</span><a href="#local-6989586621689329401"><span class="hs-identifier hs-var">handler</span></a></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span>      </span><span id="local-6989586621689329396"><span class="annot"><span class="annottext">getInfo :: Maybe ReqsText
-&gt; ActionCtxT () (TraceT m) (UserInfo, [Header], HandlerCtx, Bool)
</span><a href="#local-6989586621689329396"><span class="hs-identifier hs-var hs-var">getInfo</span></a></span></span><span> </span><span id="local-6989586621689329395"><span class="annot"><span class="annottext">Maybe ReqsText
</span><a href="#local-6989586621689329395"><span class="hs-identifier hs-var">parsedRequest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-304"></span><span>        </span><span id="local-6989586621689329394"><span class="annot"><span class="annottext">Either QErr (UserInfo, Maybe UTCTime, [Header])
</span><a href="#local-6989586621689329394"><span class="hs-identifier hs-var">authenticationResp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TraceT m (Either QErr (UserInfo, Maybe UTCTime, [Header]))
-&gt; ActionCtxT
     () (TraceT m) (Either QErr (UserInfo, Maybe UTCTime, [Header]))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger Hasura
-&gt; Manager
-&gt; [Header]
-&gt; AuthMode
-&gt; Maybe ReqsText
-&gt; TraceT m (Either QErr (UserInfo, Maybe UTCTime, [Header]))
forall (m :: * -&gt; *).
UserAuthentication m =&gt;
Logger Hasura
-&gt; Manager
-&gt; [Header]
-&gt; AuthMode
-&gt; Maybe ReqsText
-&gt; m (Either QErr (UserInfo, Maybe UTCTime, [Header]))
</span><a href="Hasura.Server.Auth.html#resolveUserInfo"><span class="hs-identifier hs-var">resolveUserInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329451"><span class="hs-identifier hs-var">scLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621689329448"><span class="hs-identifier hs-var">scManager</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329414"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621689329449"><span class="hs-identifier hs-var">scAuthMode</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ReqsText
</span><a href="#local-6989586621689329395"><span class="hs-identifier hs-var">parsedRequest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>        </span><span id="local-6989586621689329392"><span class="annot"><span class="annottext">(UserInfo, Maybe UTCTime, [Header])
</span><a href="#local-6989586621689329392"><span class="hs-identifier hs-var">authInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Either QErr (UserInfo, Maybe UTCTime, [Header])
-&gt; (QErr
    -&gt; ActionCtxT () (TraceT m) (UserInfo, Maybe UTCTime, [Header]))
-&gt; ActionCtxT () (TraceT m) (UserInfo, Maybe UTCTime, [Header])
forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="Hasura.Prelude.html#onLeft"><span class="hs-identifier hs-var">onLeft</span></a></span><span> </span><span class="annot"><span class="annottext">Either QErr (UserInfo, Maybe UTCTime, [Header])
</span><a href="#local-6989586621689329394"><span class="hs-identifier hs-var">authenticationResp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; Bool
-&gt; [Header]
-&gt; QErr
-&gt; ActionCtxT () (TraceT m) (UserInfo, Maybe UTCTime, [Header])
forall (m :: * -&gt; *) ctx a.
(MonadIO m, HttpLog m) =&gt;
Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; Bool
-&gt; [Header]
-&gt; QErr
-&gt; ActionCtxT ctx m a
</span><a href="#local-6989586621689329390"><span class="hs-identifier hs-var">logErrorAndResp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UserInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689329415"><span class="hs-identifier hs-var">requestId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689329428"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329419"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329426"><span class="hs-identifier hs-var">origHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">(QErr
 -&gt; ActionCtxT () (TraceT m) (UserInfo, Maybe UTCTime, [Header]))
-&gt; (QErr -&gt; QErr)
-&gt; QErr
-&gt; ActionCtxT () (TraceT m) (UserInfo, Maybe UTCTime, [Header])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
</span><a href="#local-6989586621689329430"><span class="hs-identifier hs-var">qErrModifier</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689329389"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329389"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329388"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329388"><span class="hs-identifier hs-var">authHeaders</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UserInfo, Maybe UTCTime, [Header])
</span><a href="#local-6989586621689329392"><span class="hs-identifier hs-var">authInfo</span></a></span><span>
</span><span id="line-307"></span><span>        </span><span class="annot"><span class="annottext">(UserInfo, [Header], HandlerCtx, Bool)
-&gt; ActionCtxT () (TraceT m) (UserInfo, [Header], HandlerCtx, Bool)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-308"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329389"><span class="hs-identifier hs-var">userInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-309"></span><span>            </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329388"><span class="hs-identifier hs-var">authHeaders</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-310"></span><span>            </span><span class="annot"><span class="annottext">ServerCtx
-&gt; UserInfo -&gt; [Header] -&gt; RequestId -&gt; IpAddress -&gt; HandlerCtx
</span><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-var">HandlerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329452"><span class="hs-identifier hs-var">serverCtx</span></a></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329389"><span class="hs-identifier hs-var">userInfo</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329414"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689329415"><span class="hs-identifier hs-var">requestId</span></a></span><span> </span><span class="annot"><span class="annottext">IpAddress
</span><a href="#local-6989586621689329424"><span class="hs-identifier hs-var">ipAddress</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-311"></span><span>            </span><span class="annot"><span class="annottext">RoleName -&gt; ResponseInternalErrorsConfig -&gt; Bool
</span><a href="Hasura.Server.Init.Config.html#shouldIncludeInternal"><span class="hs-identifier hs-var">shouldIncludeInternal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserInfo -&gt; RoleName
</span><a href="Hasura.Session.html#_uiRole"><span class="hs-identifier hs-var hs-var">_uiRole</span></a></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329389"><span class="hs-identifier hs-var">userInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ResponseInternalErrorsConfig
</span><a href="#local-6989586621689329441"><span class="hs-identifier hs-var">scResponseInternalErrorsConfig</span></a></span><span>
</span><span id="line-312"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>  </span><span class="annot"><span class="annottext">(TraceT m (StT (ActionCtxT ()) ()) -&gt; m (StT (ActionCtxT ()) ()))
-&gt; ActionT (TraceT m) () -&gt; ActionT m ()
forall (m :: * -&gt; *) (n :: * -&gt; *) a.
(Monad m, Monad n) =&gt;
(m (StT (ActionCtxT ()) a) -&gt; n (StT (ActionCtxT ()) a))
-&gt; ActionT m a -&gt; ActionT n a
</span><a href="Hasura.Server.App.html#mapActionT"><span class="hs-identifier hs-var">mapActionT</span></a></span><span> </span><span class="annot"><span class="annottext">TraceT m (StT (ActionCtxT ()) ()) -&gt; m (StT (ActionCtxT ()) ())
forall (m :: * -&gt; *) a.
(MonadIO m, HasReporter m) =&gt;
TraceT m a -&gt; m a
</span><a href="#local-6989586621689329408"><span class="hs-identifier hs-var">runTraceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ActionT (TraceT m) () -&gt; ActionT m ())
-&gt; ActionT (TraceT m) () -&gt; ActionT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-comment">-- Add the request ID to the tracing metadata so that we</span><span>
</span><span id="line-316"></span><span>    </span><span class="hs-comment">-- can correlate requests and traces</span><span>
</span><span id="line-317"></span><span>    </span><span class="annot"><span class="annottext">TraceT m () -&gt; ActionT (TraceT m) ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TraceT m () -&gt; ActionT (TraceT m) ())
-&gt; TraceT m () -&gt; ActionT (TraceT m) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TracingMetadata -&gt; TraceT m ()
forall (m :: * -&gt; *). MonadTrace m =&gt; TracingMetadata -&gt; m ()
</span><a href="Hasura.Tracing.html#attachMetadata"><span class="hs-identifier hs-var">Tracing.attachMetadata</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;request_id&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RequestId -&gt; Text
</span><a href="Hasura.Server.Types.html#unRequestId"><span class="hs-identifier hs-var hs-var">unRequestId</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689329415"><span class="hs-identifier hs-var">requestId</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621689329384"><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621689329384"><span class="hs-identifier hs-var">serviceTime</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689329383"><span class="annot"><span class="annottext">Either
  QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
</span><a href="#local-6989586621689329383"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329382"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329382"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329381"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329381"><span class="hs-identifier hs-var">authHeaders</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329380"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329380"><span class="hs-identifier hs-var">includeInternal</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329379"><span class="annot"><span class="annottext">Maybe Value
</span><a href="#local-6989586621689329379"><span class="hs-identifier hs-var">queryJSON</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT
  ()
  (TraceT m)
  (Either
     QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp),
   UserInfo, [Header], Bool, Maybe Value)
-&gt; ActionCtxT
     ()
     (TraceT m)
     (DiffTime,
      (Either
         QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp),
       UserInfo, [Header], Bool, Maybe Value))
forall (m :: * -&gt; *) a. MonadIO m =&gt; m a -&gt; m (DiffTime, a)
</span><a href="Hasura.Prelude.html#withElapsedTime"><span class="hs-identifier hs-var">withElapsedTime</span></a></span><span> </span><span class="annot"><span class="annottext">(ActionCtxT
   ()
   (TraceT m)
   (Either
      QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp),
    UserInfo, [Header], Bool, Maybe Value)
 -&gt; ActionCtxT
      ()
      (TraceT m)
      (DiffTime,
       (Either
          QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp),
        UserInfo, [Header], Bool, Maybe Value)))
-&gt; ActionCtxT
     ()
     (TraceT m)
     (Either
        QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp),
      UserInfo, [Header], Bool, Maybe Value)
-&gt; ActionCtxT
     ()
     (TraceT m)
     (DiffTime,
      (Either
         QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp),
       UserInfo, [Header], Bool, Maybe Value))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">APIHandler (TraceT m) a
</span><a href="#local-6989586621689329429"><span class="hs-identifier hs-var">apiHandler</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-320"></span><span>      </span><span class="hs-comment">-- in the case of a simple get/post we don't have to send the webhook anything</span><span>
</span><span id="line-321"></span><span>      </span><span class="annot"><a href="Hasura.Server.App.html#AHGet"><span class="hs-identifier hs-type">AHGet</span></a></span><span> </span><span id="local-6989586621689329378"><span class="annot"><span class="annottext">Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
</span><a href="#local-6989586621689329378"><span class="hs-identifier hs-var">handler</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-322"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621689329377"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329377"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329376"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329376"><span class="hs-identifier hs-var">authHeaders</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329375"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329375"><span class="hs-identifier hs-var">handlerState</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329374"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329374"><span class="hs-identifier hs-var">includeInternal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ReqsText
-&gt; ActionCtxT () (TraceT m) (UserInfo, [Header], HandlerCtx, Bool)
</span><a href="#local-6989586621689329396"><span class="hs-identifier hs-var">getInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ReqsText
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-323"></span><span>        </span><span id="local-6989586621689329373"><span class="annot"><span class="annottext">Either
  QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
</span><a href="#local-6989586621689329373"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TraceT
  m
  (Either
     QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp))
-&gt; ActionCtxT
     ()
     (TraceT m)
     (Either
        QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TraceT
   m
   (Either
      QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp))
 -&gt; ActionCtxT
      ()
      (TraceT m)
      (Either
         QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)))
-&gt; TraceT
     m
     (Either
        QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp))
-&gt; ActionCtxT
     ()
     (TraceT m)
     (Either
        QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
-&gt; ReaderT
     HandlerCtx
     (MetadataStorageT (TraceT m))
     ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
-&gt; TraceT
     m
     (Either
        QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp))
forall (m :: * -&gt; *) a.
MonadBaseControl IO m =&gt;
HandlerCtx
-&gt; ReaderT HandlerCtx (MetadataStorageT m) a -&gt; m (Either QErr a)
</span><a href="#local-6989586621689329403"><span class="hs-identifier hs-var">runHandler</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329375"><span class="hs-identifier hs-var">handlerState</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT
  HandlerCtx
  (MetadataStorageT (TraceT m))
  ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
</span><a href="#local-6989586621689329378"><span class="hs-identifier hs-var">handler</span></a></span><span>
</span><span id="line-324"></span><span>        </span><span class="annot"><span class="annottext">(Either
   QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp),
 UserInfo, [Header], Bool, Maybe Value)
-&gt; ActionCtxT
     ()
     (TraceT m)
     (Either
        QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp),
      UserInfo, [Header], Bool, Maybe Value)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either
  QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
</span><a href="#local-6989586621689329373"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329377"><span class="hs-identifier hs-var">userInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329376"><span class="hs-identifier hs-var">authHeaders</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329374"><span class="hs-identifier hs-var">includeInternal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>      </span><span class="annot"><a href="Hasura.Server.App.html#AHPost"><span class="hs-identifier hs-type">AHPost</span></a></span><span> </span><span id="local-6989586621689329372"><span class="annot"><span class="annottext">a -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
</span><a href="#local-6989586621689329372"><span class="hs-identifier hs-var">handler</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-326"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621689329371"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329371"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329370"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329370"><span class="hs-identifier hs-var">authHeaders</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329369"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329369"><span class="hs-identifier hs-var">handlerState</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329368"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329368"><span class="hs-identifier hs-var">includeInternal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ReqsText
-&gt; ActionCtxT () (TraceT m) (UserInfo, [Header], HandlerCtx, Bool)
</span><a href="#local-6989586621689329396"><span class="hs-identifier hs-var">getInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ReqsText
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-327"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621689329367"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689329367"><span class="hs-identifier hs-var">queryJSON</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329366"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689329366"><span class="hs-identifier hs-var">parsedReq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-328"></span><span>          </span><span class="annot"><span class="annottext">Except QErr (Value, a) -&gt; Either QErr (Value, a)
forall e a. Except e a -&gt; Either e a
</span><span class="hs-identifier hs-var">runExcept</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Except QErr (Value, a)
forall a (m :: * -&gt; *).
(FromJSON a, MonadError QErr m) =&gt;
ByteString -&gt; m (Value, a)
</span><a href="Hasura.Server.App.html#parseBody"><span class="hs-identifier hs-var">parseBody</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329419"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either QErr (Value, a)
-&gt; (QErr -&gt; ActionCtxT () (TraceT m) (Value, a))
-&gt; ActionCtxT () (TraceT m) (Value, a)
forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="Hasura.Prelude.html#onLeft"><span class="hs-operator hs-var">`onLeft`</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689329364"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689329364"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-329"></span><span>            </span><span class="annot"><span class="annottext">Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; Bool
-&gt; [Header]
-&gt; QErr
-&gt; ActionCtxT () (TraceT m) (Value, a)
forall (m :: * -&gt; *) ctx a.
(MonadIO m, HttpLog m) =&gt;
Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; Bool
-&gt; [Header]
-&gt; QErr
-&gt; ActionCtxT ctx m a
</span><a href="#local-6989586621689329390"><span class="hs-identifier hs-var">logErrorAndResp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserInfo -&gt; Maybe UserInfo
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329371"><span class="hs-identifier hs-var">userInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689329415"><span class="hs-identifier hs-var">requestId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689329428"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329419"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329368"><span class="hs-identifier hs-var">includeInternal</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329426"><span class="hs-identifier hs-var">origHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">(QErr -&gt; ActionCtxT () (TraceT m) (Value, a))
-&gt; QErr -&gt; ActionCtxT () (TraceT m) (Value, a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
</span><a href="#local-6989586621689329430"><span class="hs-identifier hs-var">qErrModifier</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689329364"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-330"></span><span>        </span><span id="local-6989586621689329363"><span class="annot"><span class="annottext">Either
  QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
</span><a href="#local-6989586621689329363"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TraceT
  m
  (Either
     QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp))
-&gt; ActionCtxT
     ()
     (TraceT m)
     (Either
        QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TraceT
   m
   (Either
      QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp))
 -&gt; ActionCtxT
      ()
      (TraceT m)
      (Either
         QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)))
-&gt; TraceT
     m
     (Either
        QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp))
-&gt; ActionCtxT
     ()
     (TraceT m)
     (Either
        QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
-&gt; ReaderT
     HandlerCtx
     (MetadataStorageT (TraceT m))
     ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
-&gt; TraceT
     m
     (Either
        QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp))
forall (m :: * -&gt; *) a.
MonadBaseControl IO m =&gt;
HandlerCtx
-&gt; ReaderT HandlerCtx (MetadataStorageT m) a -&gt; m (Either QErr a)
</span><a href="#local-6989586621689329403"><span class="hs-identifier hs-var">runHandler</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329369"><span class="hs-identifier hs-var">handlerState</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT
   HandlerCtx
   (MetadataStorageT (TraceT m))
   ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
 -&gt; TraceT
      m
      (Either
         QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)))
-&gt; ReaderT
     HandlerCtx
     (MetadataStorageT (TraceT m))
     ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
-&gt; TraceT
     m
     (Either
        QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
</span><a href="#local-6989586621689329372"><span class="hs-identifier hs-var">handler</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689329366"><span class="hs-identifier hs-var">parsedReq</span></a></span><span>
</span><span id="line-331"></span><span>        </span><span class="annot"><span class="annottext">(Either
   QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp),
 UserInfo, [Header], Bool, Maybe Value)
-&gt; ActionCtxT
     ()
     (TraceT m)
     (Either
        QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp),
      UserInfo, [Header], Bool, Maybe Value)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either
  QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
</span><a href="#local-6989586621689329363"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329371"><span class="hs-identifier hs-var">userInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329370"><span class="hs-identifier hs-var">authHeaders</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329368"><span class="hs-identifier hs-var">includeInternal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Maybe Value
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689329367"><span class="hs-identifier hs-var">queryJSON</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>      </span><span class="hs-comment">-- in this case we parse the request _first_ and then send the request to the webhook for auth</span><span>
</span><span id="line-333"></span><span>      </span><span class="annot"><a href="Hasura.Server.App.html#AHGraphQLRequest"><span class="hs-identifier hs-type">AHGraphQLRequest</span></a></span><span> </span><span id="local-6989586621689329362"><span class="annot"><span class="annottext">ReqsText
-&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
</span><a href="#local-6989586621689329362"><span class="hs-identifier hs-var">handler</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-334"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621689329361"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689329361"><span class="hs-identifier hs-var">queryJSON</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329360"><span class="annot"><span class="annottext">ReqsText
</span><a href="#local-6989586621689329360"><span class="hs-identifier hs-var">parsedReq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-335"></span><span>          </span><span class="annot"><span class="annottext">Except QErr (Value, ReqsText) -&gt; Either QErr (Value, ReqsText)
forall e a. Except e a -&gt; Either e a
</span><span class="hs-identifier hs-var">runExcept</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Except QErr (Value, ReqsText)
forall a (m :: * -&gt; *).
(FromJSON a, MonadError QErr m) =&gt;
ByteString -&gt; m (Value, a)
</span><a href="Hasura.Server.App.html#parseBody"><span class="hs-identifier hs-var">parseBody</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329419"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either QErr (Value, ReqsText)
-&gt; (QErr -&gt; ActionCtxT () (TraceT m) (Value, ReqsText))
-&gt; ActionCtxT () (TraceT m) (Value, ReqsText)
forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="Hasura.Prelude.html#onLeft"><span class="hs-operator hs-var">`onLeft`</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689329359"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689329359"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-336"></span><span>            </span><span class="hs-comment">-- if the request fails to parse, call the webhook without a request body</span><span>
</span><span id="line-337"></span><span>            </span><span class="hs-comment">-- TODO should we signal this to the webhook somehow?</span><span>
</span><span id="line-338"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621689329358"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329358"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Header]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ReqsText
-&gt; ActionCtxT () (TraceT m) (UserInfo, [Header], HandlerCtx, Bool)
</span><a href="#local-6989586621689329396"><span class="hs-identifier hs-var">getInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ReqsText
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-339"></span><span>            </span><span class="annot"><span class="annottext">Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; Bool
-&gt; [Header]
-&gt; QErr
-&gt; ActionCtxT () (TraceT m) (Value, ReqsText)
forall (m :: * -&gt; *) ctx a.
(MonadIO m, HttpLog m) =&gt;
Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; Bool
-&gt; [Header]
-&gt; QErr
-&gt; ActionCtxT ctx m a
</span><a href="#local-6989586621689329390"><span class="hs-identifier hs-var">logErrorAndResp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserInfo -&gt; Maybe UserInfo
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329358"><span class="hs-identifier hs-var">userInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689329415"><span class="hs-identifier hs-var">requestId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689329428"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329419"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329426"><span class="hs-identifier hs-var">origHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">(QErr -&gt; ActionCtxT () (TraceT m) (Value, ReqsText))
-&gt; QErr -&gt; ActionCtxT () (TraceT m) (Value, ReqsText)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
</span><a href="#local-6989586621689329430"><span class="hs-identifier hs-var">qErrModifier</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689329359"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-340"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621689329357"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329357"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329356"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329356"><span class="hs-identifier hs-var">authHeaders</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329355"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329355"><span class="hs-identifier hs-var">handlerState</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329354"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329354"><span class="hs-identifier hs-var">includeInternal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ReqsText
-&gt; ActionCtxT () (TraceT m) (UserInfo, [Header], HandlerCtx, Bool)
</span><a href="#local-6989586621689329396"><span class="hs-identifier hs-var">getInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReqsText -&gt; Maybe ReqsText
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ReqsText
</span><a href="#local-6989586621689329360"><span class="hs-identifier hs-var">parsedReq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span>        </span><span id="local-6989586621689329353"><span class="annot"><span class="annottext">Either
  QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
</span><a href="#local-6989586621689329353"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TraceT
  m
  (Either
     QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp))
-&gt; ActionCtxT
     ()
     (TraceT m)
     (Either
        QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TraceT
   m
   (Either
      QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp))
 -&gt; ActionCtxT
      ()
      (TraceT m)
      (Either
         QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)))
-&gt; TraceT
     m
     (Either
        QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp))
-&gt; ActionCtxT
     ()
     (TraceT m)
     (Either
        QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
-&gt; ReaderT
     HandlerCtx
     (MetadataStorageT (TraceT m))
     ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
-&gt; TraceT
     m
     (Either
        QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp))
forall (m :: * -&gt; *) a.
MonadBaseControl IO m =&gt;
HandlerCtx
-&gt; ReaderT HandlerCtx (MetadataStorageT m) a -&gt; m (Either QErr a)
</span><a href="#local-6989586621689329403"><span class="hs-identifier hs-var">runHandler</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621689329355"><span class="hs-identifier hs-var">handlerState</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT
   HandlerCtx
   (MetadataStorageT (TraceT m))
   ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
 -&gt; TraceT
      m
      (Either
         QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)))
-&gt; ReaderT
     HandlerCtx
     (MetadataStorageT (TraceT m))
     ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
-&gt; TraceT
     m
     (Either
        QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ReqsText
-&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
</span><a href="#local-6989586621689329362"><span class="hs-identifier hs-var">handler</span></a></span><span> </span><span class="annot"><span class="annottext">ReqsText
</span><a href="#local-6989586621689329360"><span class="hs-identifier hs-var">parsedReq</span></a></span><span>
</span><span id="line-343"></span><span>        </span><span class="annot"><span class="annottext">(Either
   QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp),
 UserInfo, [Header], Bool, Maybe Value)
-&gt; ActionCtxT
     ()
     (TraceT m)
     (Either
        QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp),
      UserInfo, [Header], Bool, Maybe Value)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either
  QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
</span><a href="#local-6989586621689329353"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329357"><span class="hs-identifier hs-var">userInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329356"><span class="hs-identifier hs-var">authHeaders</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329354"><span class="hs-identifier hs-var">includeInternal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Maybe Value
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689329361"><span class="hs-identifier hs-var">queryJSON</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-comment">-- apply the error modifier</span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689329352"><span class="annot"><span class="annottext">modResult :: Either
  QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
</span><a href="#local-6989586621689329352"><span class="hs-identifier hs-var hs-var">modResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(QErr -&gt; QErr)
-&gt; Either
     QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
-&gt; Either
     QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
forall a a' b. (a -&gt; a') -&gt; Either a b -&gt; Either a' b
</span><a href="Hasura.Server.Utils.html#fmapL"><span class="hs-identifier hs-var">fmapL</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
</span><a href="#local-6989586621689329430"><span class="hs-identifier hs-var">qErrModifier</span></a></span><span> </span><span class="annot"><span class="annottext">Either
  QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
</span><a href="#local-6989586621689329383"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-comment">-- log and return result</span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either
  QErr ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
</span><a href="#local-6989586621689329352"><span class="hs-identifier hs-var">modResult</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-350"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621689329350"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689329350"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-351"></span><span>        </span><span class="annot"><span class="annottext">Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; Bool
-&gt; [Header]
-&gt; QErr
-&gt; ActionT (TraceT m) ()
forall (m :: * -&gt; *) ctx a.
(MonadIO m, HttpLog m) =&gt;
Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; Bool
-&gt; [Header]
-&gt; QErr
-&gt; ActionCtxT ctx m a
</span><a href="#local-6989586621689329390"><span class="hs-identifier hs-var">logErrorAndResp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserInfo -&gt; Maybe UserInfo
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329382"><span class="hs-identifier hs-var">userInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689329415"><span class="hs-identifier hs-var">requestId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689329428"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329419"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
</span><a href="#local-6989586621689329379"><span class="hs-identifier hs-var">queryJSON</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329380"><span class="hs-identifier hs-var">includeInternal</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329414"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689329350"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-352"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621689329349"><span class="annot"><span class="annottext">(CommonHttpLogMetadata, ExtraHttpLogMetadata m)
</span><a href="#local-6989586621689329349"><span class="hs-identifier hs-var">httpLoggingMetadata</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329348"><span class="annot"><span class="annottext">APIResp
</span><a href="#local-6989586621689329348"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-353"></span><span>        </span><span class="annot"><span class="annottext">Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; APIResp
-&gt; Maybe (DiffTime, DiffTime)
-&gt; [Header]
-&gt; [Header]
-&gt; (CommonHttpLogMetadata, ExtraHttpLogMetadata m)
-&gt; ActionT (TraceT m) ()
</span><a href="#local-6989586621689329347"><span class="hs-identifier hs-var">logSuccessAndResp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserInfo -&gt; Maybe UserInfo
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329382"><span class="hs-identifier hs-var">userInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689329415"><span class="hs-identifier hs-var">requestId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689329428"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329419"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
</span><a href="#local-6989586621689329379"><span class="hs-identifier hs-var">queryJSON</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">APIResp
</span><a href="#local-6989586621689329348"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DiffTime, DiffTime) -&gt; Maybe (DiffTime, DiffTime)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621689329420"><span class="hs-identifier hs-var">ioWaitTime</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621689329384"><span class="hs-identifier hs-var">serviceTime</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329426"><span class="hs-identifier hs-var">origHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329381"><span class="hs-identifier hs-var">authHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">(CommonHttpLogMetadata, ExtraHttpLogMetadata m)
</span><a href="#local-6989586621689329349"><span class="hs-identifier hs-var">httpLoggingMetadata</span></a></span><span>
</span><span id="line-354"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-355"></span><span>    </span><span id="local-6989586621689329905"><span id="local-6989586621689329906"><span id="local-6989586621689329908"><span class="annot"><a href="#local-6989586621689329390"><span class="hs-identifier hs-type">logErrorAndResp</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-356"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329908"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329908"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-357"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.Session.html#UserInfo"><span class="hs-identifier hs-type">UserInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-358"></span><span>      </span><span class="annot"><a href="Hasura.Server.Types.html#RequestId"><span class="hs-identifier hs-type">RequestId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-359"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Wai.Request</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-360"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-361"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-362"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HTTP.Header</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-363"></span><span>      </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-364"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Spock.ActionCtxT</span></span><span> </span><span class="annot"><a href="#local-6989586621689329906"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329908"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329905"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-365"></span><span>    </span><span id="local-6989586621689329390"><span class="annot"><span class="annottext">logErrorAndResp :: Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; Bool
-&gt; [Header]
-&gt; QErr
-&gt; ActionCtxT ctx m a
</span><a href="#local-6989586621689329390"><span class="hs-identifier hs-var hs-var">logErrorAndResp</span></a></span></span><span> </span><span id="local-6989586621689329346"><span class="annot"><span class="annottext">Maybe UserInfo
</span><a href="#local-6989586621689329346"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span> </span><span id="local-6989586621689329345"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689329345"><span class="hs-identifier hs-var">reqId</span></a></span></span><span> </span><span id="local-6989586621689329344"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689329344"><span class="hs-identifier hs-var">waiReq</span></a></span></span><span> </span><span id="local-6989586621689329343"><span class="annot"><span class="annottext">(ByteString, Maybe Value)
</span><a href="#local-6989586621689329343"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span id="local-6989586621689329342"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329342"><span class="hs-identifier hs-var">includeInternal</span></a></span></span><span> </span><span id="local-6989586621689329341"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329341"><span class="hs-identifier hs-var">headers</span></a></span></span><span> </span><span id="local-6989586621689329340"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689329340"><span class="hs-identifier hs-var">qErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-366"></span><span>      </span><span class="annot"><span class="annottext">m () -&gt; ActionCtxT ctx m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ActionCtxT ctx m ()) -&gt; m () -&gt; ActionCtxT ctx m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; QErr
-&gt; [Header]
-&gt; m ()
forall (m :: * -&gt; *).
HttpLog m =&gt;
Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; QErr
-&gt; [Header]
-&gt; m ()
</span><a href="Hasura.Server.Logging.html#logHttpError"><span class="hs-identifier hs-var">logHttpError</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329451"><span class="hs-identifier hs-var">scLogger</span></a></span><span> </span><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621689329435"><span class="hs-identifier hs-var">scLoggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UserInfo
</span><a href="#local-6989586621689329346"><span class="hs-identifier hs-var">userInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689329345"><span class="hs-identifier hs-var">reqId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689329344"><span class="hs-identifier hs-var">waiReq</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString, Maybe Value)
</span><a href="#local-6989586621689329343"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689329340"><span class="hs-identifier hs-var">qErr</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329341"><span class="hs-identifier hs-var">headers</span></a></span><span>
</span><span id="line-367"></span><span>      </span><span class="annot"><span class="annottext">Status -&gt; ActionCtxT ctx m ()
forall (m :: * -&gt; *) ctx.
MonadIO m =&gt;
Status -&gt; ActionCtxT ctx m ()
</span><span class="hs-identifier hs-var">Spock.setStatus</span></span><span> </span><span class="annot"><span class="annottext">(Status -&gt; ActionCtxT ctx m ()) -&gt; Status -&gt; ActionCtxT ctx m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; Status
</span><a href="Hasura.Base.Error.html#qeStatus"><span class="hs-identifier hs-var hs-var">qeStatus</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689329340"><span class="hs-identifier hs-var">qErr</span></a></span><span>
</span><span id="line-368"></span><span>      </span><span class="annot"><span class="annottext">Value -&gt; ActionCtxT ctx m a
forall a (m :: * -&gt; *) ctx b.
(ToJSON a, MonadIO m) =&gt;
a -&gt; ActionCtxT ctx m b
</span><span class="hs-identifier hs-var">Spock.json</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; ActionCtxT ctx m a) -&gt; Value -&gt; ActionCtxT ctx m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Value
</span><a href="#local-6989586621689329431"><span class="hs-identifier hs-var">qErrEncoder</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329342"><span class="hs-identifier hs-var">includeInternal</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689329340"><span class="hs-identifier hs-var">qErr</span></a></span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span>    </span><span id="local-6989586621689329347"><span class="annot"><span class="annottext">logSuccessAndResp :: Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; APIResp
-&gt; Maybe (DiffTime, DiffTime)
-&gt; [Header]
-&gt; [Header]
-&gt; (CommonHttpLogMetadata, ExtraHttpLogMetadata m)
-&gt; ActionT (TraceT m) ()
</span><a href="#local-6989586621689329347"><span class="hs-identifier hs-var hs-var">logSuccessAndResp</span></a></span></span><span> </span><span id="local-6989586621689329335"><span class="annot"><span class="annottext">Maybe UserInfo
</span><a href="#local-6989586621689329335"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span> </span><span id="local-6989586621689329334"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689329334"><span class="hs-identifier hs-var">reqId</span></a></span></span><span> </span><span id="local-6989586621689329333"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689329333"><span class="hs-identifier hs-var">waiReq</span></a></span></span><span> </span><span id="local-6989586621689329332"><span class="annot"><span class="annottext">(ByteString, Maybe Value)
</span><a href="#local-6989586621689329332"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span id="local-6989586621689329331"><span class="annot"><span class="annottext">APIResp
</span><a href="#local-6989586621689329331"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span id="local-6989586621689329330"><span class="annot"><span class="annottext">Maybe (DiffTime, DiffTime)
</span><a href="#local-6989586621689329330"><span class="hs-identifier hs-var">qTime</span></a></span></span><span> </span><span id="local-6989586621689329329"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329329"><span class="hs-identifier hs-var">reqHeaders</span></a></span></span><span> </span><span id="local-6989586621689329328"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329328"><span class="hs-identifier hs-var">authHdrs</span></a></span></span><span> </span><span id="local-6989586621689329327"><span class="annot"><span class="annottext">(CommonHttpLogMetadata, ExtraHttpLogMetadata m)
</span><a href="#local-6989586621689329327"><span class="hs-identifier hs-var">httpLoggingMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-371"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689329326"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329326"><span class="hs-identifier hs-var">respBytes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329325"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329325"><span class="hs-identifier hs-var">respHeaders</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">APIResp
</span><a href="#local-6989586621689329331"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-372"></span><span>            </span><span class="annot"><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-type">JSONResp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span id="local-6989586621689329323"><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621689329323"><span class="hs-identifier hs-var">encJson</span></a></span></span><span> </span><span id="local-6989586621689329322"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329322"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EncJSON -&gt; ByteString
</span><a href="Hasura.EncJSON.html#encJToLBS"><span class="hs-identifier hs-var">encJToLBS</span></a></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621689329323"><span class="hs-identifier hs-var">encJson</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Header -&gt; [Header]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Header
</span><a href="Hasura.Server.Utils.html#jsonHeader"><span class="hs-identifier hs-var">jsonHeader</span></a></span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; [Header] -&gt; [Header]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329322"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>            </span><span class="annot"><a href="Hasura.Server.App.html#RawResp"><span class="hs-identifier hs-type">RawResp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span id="local-6989586621689329319"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329319"><span class="hs-identifier hs-var">rawBytes</span></a></span></span><span> </span><span id="local-6989586621689329318"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329318"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329319"><span class="hs-identifier hs-var">rawBytes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329318"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621689329317"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329317"><span class="hs-identifier hs-var">compressedResp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329316"><span class="annot"><span class="annottext">Maybe Header
</span><a href="#local-6989586621689329316"><span class="hs-identifier hs-var">mEncodingHeader</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329315"><span class="annot"><span class="annottext">Maybe CompressionType
</span><a href="#local-6989586621689329315"><span class="hs-identifier hs-var">mCompressionType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Header]
-&gt; ByteString -&gt; (ByteString, Maybe Header, Maybe CompressionType)
</span><a href="Hasura.Server.Compression.html#compressResponse"><span class="hs-identifier hs-var">compressResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; [Header]
</span><span class="hs-identifier hs-var hs-var">Wai.requestHeaders</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689329333"><span class="hs-identifier hs-var">waiReq</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329326"><span class="hs-identifier hs-var">respBytes</span></a></span><span>
</span><span id="line-375"></span><span>          </span><span id="local-6989586621689329313"><span class="annot"><span class="annottext">encodingHeader :: [Header]
</span><a href="#local-6989586621689329313"><span class="hs-identifier hs-var hs-var">encodingHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Header -&gt; [Header] -&gt; [Header]
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="Hasura.Prelude.html#onNothing"><span class="hs-identifier hs-var">onNothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Header
</span><a href="#local-6989586621689329316"><span class="hs-identifier hs-var">mEncodingHeader</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-376"></span><span>          </span><span id="local-6989586621689329311"><span class="annot"><span class="annottext">reqIdHeader :: Header
</span><a href="#local-6989586621689329311"><span class="hs-identifier hs-var hs-var">reqIdHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
forall a. IsString a =&gt; a
</span><a href="Hasura.Server.Utils.html#requestIdHeader"><span class="hs-identifier hs-var">requestIdHeader</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="Hasura.Prelude.html#txtToBs"><span class="hs-identifier hs-var">txtToBs</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ByteString) -&gt; Text -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RequestId -&gt; Text
</span><a href="Hasura.Server.Types.html#unRequestId"><span class="hs-identifier hs-var hs-var">unRequestId</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689329334"><span class="hs-identifier hs-var">reqId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>          </span><span id="local-6989586621689329308"><span class="annot"><span class="annottext">allRespHeaders :: [Header]
</span><a href="#local-6989586621689329308"><span class="hs-identifier hs-var hs-var">allRespHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Header -&gt; [Header]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Header
</span><a href="#local-6989586621689329311"><span class="hs-identifier hs-var">reqIdHeader</span></a></span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; [Header] -&gt; [Header]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329313"><span class="hs-identifier hs-var">encodingHeader</span></a></span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; [Header] -&gt; [Header]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329325"><span class="hs-identifier hs-var">respHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; [Header] -&gt; [Header]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329328"><span class="hs-identifier hs-var">authHdrs</span></a></span><span>
</span><span id="line-378"></span><span>      </span><span class="annot"><span class="annottext">TraceT m () -&gt; ActionT (TraceT m) ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TraceT m () -&gt; ActionT (TraceT m) ())
-&gt; TraceT m () -&gt; ActionT (TraceT m) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; ByteString
-&gt; ByteString
-&gt; Maybe (DiffTime, DiffTime)
-&gt; Maybe CompressionType
-&gt; [Header]
-&gt; HttpLogMetadata (TraceT m)
-&gt; TraceT m ()
forall (m :: * -&gt; *).
HttpLog m =&gt;
Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; ByteString
-&gt; ByteString
-&gt; Maybe (DiffTime, DiffTime)
-&gt; Maybe CompressionType
-&gt; [Header]
-&gt; HttpLogMetadata m
-&gt; m ()
</span><a href="Hasura.Server.Logging.html#logHttpSuccess"><span class="hs-identifier hs-var">logHttpSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329451"><span class="hs-identifier hs-var">scLogger</span></a></span><span> </span><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621689329435"><span class="hs-identifier hs-var">scLoggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UserInfo
</span><a href="#local-6989586621689329335"><span class="hs-identifier hs-var">userInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689329334"><span class="hs-identifier hs-var">reqId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689329333"><span class="hs-identifier hs-var">waiReq</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString, Maybe Value)
</span><a href="#local-6989586621689329332"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329326"><span class="hs-identifier hs-var">respBytes</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329317"><span class="hs-identifier hs-var">compressedResp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (DiffTime, DiffTime)
</span><a href="#local-6989586621689329330"><span class="hs-identifier hs-var">qTime</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CompressionType
</span><a href="#local-6989586621689329315"><span class="hs-identifier hs-var">mCompressionType</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329329"><span class="hs-identifier hs-var">reqHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">(CommonHttpLogMetadata, ExtraHttpLogMetadata m)
HttpLogMetadata (TraceT m)
</span><a href="#local-6989586621689329327"><span class="hs-identifier hs-var">httpLoggingMetadata</span></a></span><span>
</span><span id="line-379"></span><span>      </span><span class="annot"><span class="annottext">(Header -&gt; ActionT (TraceT m) ())
-&gt; [Header] -&gt; ActionT (TraceT m) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Header -&gt; ActionT (TraceT m) ()
forall (m :: * -&gt; *). MonadIO m =&gt; Header -&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#setHeader"><span class="hs-identifier hs-var">setHeader</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329308"><span class="hs-identifier hs-var">allRespHeaders</span></a></span><span>
</span><span id="line-380"></span><span>      </span><span class="annot"><span class="annottext">ByteString -&gt; ActionT (TraceT m) ()
forall (m :: * -&gt; *) ctx a.
MonadIO m =&gt;
ByteString -&gt; ActionCtxT ctx m a
</span><span class="hs-identifier hs-var">Spock.lazyBytes</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329317"><span class="hs-identifier hs-var">compressedResp</span></a></span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span id="local-6989586621689329647"><span class="annot"><a href="Hasura.Server.App.html#v1QueryHandler"><span class="hs-identifier hs-type">v1QueryHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329647"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-384"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329647"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-385"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329647"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-386"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.html#MonadTrace"><span class="hs-identifier hs-type">Tracing.MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329647"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-387"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329647"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-388"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329647"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-389"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329647"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-390"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Backend.html#MonadQueryTags"><span class="hs-identifier hs-type">EB.MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329647"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-391"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-392"></span><span>  </span><span class="annot"><a href="Hasura.Server.API.Query.html#RQLQuery"><span class="hs-identifier hs-type">RQLQuery</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-393"></span><span>  </span><span class="annot"><a href="#local-6989586621689329647"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-394"></span><span id="v1QueryHandler"><span class="annot"><span class="annottext">v1QueryHandler :: RQLQuery -&gt; m (HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1QueryHandler"><span class="hs-identifier hs-var hs-var">v1QueryHandler</span></a></span></span><span> </span><span id="local-6989586621689329303"><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621689329303"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="Hasura.Prelude.html#liftEitherM"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; m ())
-&gt; (HandlerCtx -&gt; m (Either QErr ())) -&gt; HandlerCtx -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1QueryApi"><span class="hs-identifier hs-var">authorizeV1QueryApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621689329303"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; m ()) -&gt; m HandlerCtx -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">m HandlerCtx
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-396"></span><span>  </span><span id="local-6989586621689329300"><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329300"><span class="hs-identifier hs-var">scRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; SchemaCacheRef) -&gt; m SchemaCacheRef
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; SchemaCacheRef
</span><a href="Hasura.Server.App.html#scCacheRef"><span class="hs-identifier hs-var hs-var">scCacheRef</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; SchemaCacheRef)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; SchemaCacheRef
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>  </span><span id="local-6989586621689329299"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329299"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; Logger Hasura) -&gt; m (Logger Hasura)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; Logger Hasura
</span><a href="Hasura.Server.App.html#scLogger"><span class="hs-identifier hs-var hs-var">scLogger</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; Logger Hasura)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; Logger Hasura
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>  </span><span id="local-6989586621689329298"><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621689329298"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m EncJSON -&gt; m EncJSON -&gt; Bool -&gt; m EncJSON
forall a. a -&gt; a -&gt; Bool -&gt; a
</span><span class="hs-identifier hs-var">bool</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EncJSON, RebuildableSchemaCache) -&gt; EncJSON
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((EncJSON, RebuildableSchemaCache) -&gt; EncJSON)
-&gt; m (EncJSON, RebuildableSchemaCache) -&gt; m EncJSON
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger Hasura -&gt; m (EncJSON, RebuildableSchemaCache)
</span><a href="#local-6989586621689329297"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329299"><span class="hs-identifier hs-var">logger</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaCacheRef
-&gt; Logger Hasura
-&gt; Maybe (TVar Bool)
-&gt; m (EncJSON, RebuildableSchemaCache)
-&gt; m EncJSON
forall (m :: * -&gt; *) a.
(MonadIO m, MonadBaseControl IO m) =&gt;
SchemaCacheRef
-&gt; Logger Hasura
-&gt; Maybe (TVar Bool)
-&gt; m (a, RebuildableSchemaCache)
-&gt; m a
</span><a href="Hasura.Server.SchemaCacheRef.html#withSchemaCacheUpdate"><span class="hs-identifier hs-var">withSchemaCacheUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329300"><span class="hs-identifier hs-var">scRef</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329299"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TVar Bool)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger Hasura -&gt; m (EncJSON, RebuildableSchemaCache)
</span><a href="#local-6989586621689329297"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329299"><span class="hs-identifier hs-var">logger</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; m EncJSON) -&gt; Bool -&gt; m EncJSON
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; Bool
</span><a href="Hasura.Server.API.Query.html#queryModifiesSchemaCache"><span class="hs-identifier hs-var">queryModifiesSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621689329303"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-399"></span><span>  </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; m (HttpResponse EncJSON)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; m (HttpResponse EncJSON))
-&gt; HttpResponse EncJSON -&gt; m (HttpResponse EncJSON)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621689329298"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-400"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-401"></span><span>    </span><span id="local-6989586621689329297"><span class="annot"><span class="annottext">action :: Logger Hasura -&gt; m (EncJSON, RebuildableSchemaCache)
</span><a href="#local-6989586621689329297"><span class="hs-identifier hs-var hs-var">action</span></a></span></span><span> </span><span id="local-6989586621689329295"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329295"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-402"></span><span>      </span><span id="local-6989586621689329294"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329294"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; UserInfo) -&gt; m UserInfo
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; UserInfo
</span><a href="Hasura.Server.App.html#hcUser"><span class="hs-identifier hs-var hs-var">hcUser</span></a></span><span>
</span><span id="line-403"></span><span>      </span><span id="local-6989586621689329293"><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329293"><span class="hs-identifier hs-var">scRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; SchemaCacheRef) -&gt; m SchemaCacheRef
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; SchemaCacheRef
</span><a href="Hasura.Server.App.html#scCacheRef"><span class="hs-identifier hs-var hs-var">scCacheRef</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; SchemaCacheRef)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; SchemaCacheRef
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>      </span><span id="local-6989586621689329292"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621689329292"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO RebuildableSchemaCache -&gt; m RebuildableSchemaCache
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO RebuildableSchemaCache -&gt; m RebuildableSchemaCache)
-&gt; IO RebuildableSchemaCache -&gt; m RebuildableSchemaCache
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(RebuildableSchemaCache, SchemaCacheVer) -&gt; RebuildableSchemaCache
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((RebuildableSchemaCache, SchemaCacheVer)
 -&gt; RebuildableSchemaCache)
-&gt; IO (RebuildableSchemaCache, SchemaCacheVer)
-&gt; IO RebuildableSchemaCache
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef -&gt; IO (RebuildableSchemaCache, SchemaCacheVer)
</span><a href="Hasura.Server.SchemaCacheRef.html#readSchemaCacheRef"><span class="hs-identifier hs-var">readSchemaCacheRef</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329293"><span class="hs-identifier hs-var">scRef</span></a></span><span>
</span><span id="line-405"></span><span>      </span><span id="local-6989586621689329291"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621689329291"><span class="hs-identifier hs-var">httpMgr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; Manager) -&gt; m Manager
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; Manager
</span><a href="Hasura.Server.App.html#scManager"><span class="hs-identifier hs-var hs-var">scManager</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; Manager)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; Manager
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>      </span><span id="local-6989586621689329290"><span class="annot"><span class="annottext">SQLGenCtx
</span><a href="#local-6989586621689329290"><span class="hs-identifier hs-var">sqlGenCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; SQLGenCtx) -&gt; m SQLGenCtx
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; SQLGenCtx
</span><a href="Hasura.Server.App.html#scSQLGenCtx"><span class="hs-identifier hs-var hs-var">scSQLGenCtx</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; SQLGenCtx)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; SQLGenCtx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>      </span><span id="local-6989586621689329289"><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621689329289"><span class="hs-identifier hs-var">instanceId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; InstanceId) -&gt; m InstanceId
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; InstanceId
</span><a href="Hasura.Server.App.html#scInstanceId"><span class="hs-identifier hs-var hs-var">scInstanceId</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; InstanceId)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; InstanceId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>      </span><span id="local-6989586621689329288"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621689329288"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; Environment) -&gt; m Environment
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; Environment
</span><a href="Hasura.Server.App.html#scEnvironment"><span class="hs-identifier hs-var hs-var">scEnvironment</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; Environment)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; Environment
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>      </span><span id="local-6989586621689329287"><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621689329287"><span class="hs-identifier hs-var">remoteSchemaPermsCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; RemoteSchemaPermissions)
-&gt; m RemoteSchemaPermissions
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; RemoteSchemaPermissions
</span><a href="Hasura.Server.App.html#scRemoteSchemaPermsCtx"><span class="hs-identifier hs-var hs-var">scRemoteSchemaPermsCtx</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; RemoteSchemaPermissions)
-&gt; (HandlerCtx -&gt; ServerCtx)
-&gt; HandlerCtx
-&gt; RemoteSchemaPermissions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>      </span><span id="local-6989586621689329286"><span class="annot"><span class="annottext">InferFunctionPermissions
</span><a href="#local-6989586621689329286"><span class="hs-identifier hs-var">functionPermsCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; InferFunctionPermissions)
-&gt; m InferFunctionPermissions
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; InferFunctionPermissions
</span><a href="Hasura.Server.App.html#scFunctionPermsCtx"><span class="hs-identifier hs-var hs-var">scFunctionPermsCtx</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; InferFunctionPermissions)
-&gt; (HandlerCtx -&gt; ServerCtx)
-&gt; HandlerCtx
-&gt; InferFunctionPermissions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span>      </span><span id="local-6989586621689329285"><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621689329285"><span class="hs-identifier hs-var">maintenanceMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; MaintenanceMode ()) -&gt; m (MaintenanceMode ())
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; MaintenanceMode ()
</span><a href="Hasura.Server.App.html#scEnableMaintenanceMode"><span class="hs-identifier hs-var hs-var">scEnableMaintenanceMode</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; MaintenanceMode ())
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; MaintenanceMode ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span>      </span><span id="local-6989586621689329284"><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621689329284"><span class="hs-identifier hs-var">experimentalFeatures</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; HashSet ExperimentalFeature)
-&gt; m (HashSet ExperimentalFeature)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; HashSet ExperimentalFeature
</span><a href="Hasura.Server.App.html#scExperimentalFeatures"><span class="hs-identifier hs-var hs-var">scExperimentalFeatures</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; HashSet ExperimentalFeature)
-&gt; (HandlerCtx -&gt; ServerCtx)
-&gt; HandlerCtx
-&gt; HashSet ExperimentalFeature
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-413"></span><span>      </span><span id="local-6989586621689329283"><span class="annot"><span class="annottext">EventingMode
</span><a href="#local-6989586621689329283"><span class="hs-identifier hs-var">eventingMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; EventingMode) -&gt; m EventingMode
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; EventingMode
</span><a href="Hasura.Server.App.html#scEventingMode"><span class="hs-identifier hs-var hs-var">scEventingMode</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; EventingMode)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; EventingMode
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>      </span><span id="local-6989586621689329282"><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="#local-6989586621689329282"><span class="hs-identifier hs-var">readOnlyMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; ReadOnlyMode) -&gt; m ReadOnlyMode
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; ReadOnlyMode
</span><a href="Hasura.Server.App.html#scEnableReadOnlyMode"><span class="hs-identifier hs-var hs-var">scEnableReadOnlyMode</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; ReadOnlyMode)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; ReadOnlyMode
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span>      </span><span id="local-6989586621689329281"><span class="annot"><span class="annottext">Maybe NamingCase
</span><a href="#local-6989586621689329281"><span class="hs-identifier hs-var">defaultNamingCase</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; Maybe NamingCase) -&gt; m (Maybe NamingCase)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; Maybe NamingCase
</span><a href="Hasura.Server.App.html#scDefaultNamingConvention"><span class="hs-identifier hs-var hs-var">scDefaultNamingConvention</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; Maybe NamingCase)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; Maybe NamingCase
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689329280"><span class="annot"><span class="annottext">serverConfigCtx :: ServerConfigCtx
</span><a href="#local-6989586621689329280"><span class="hs-identifier hs-var hs-var">serverConfigCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-417"></span><span>            </span><span class="annot"><span class="annottext">InferFunctionPermissions
-&gt; RemoteSchemaPermissions
-&gt; SQLGenCtx
-&gt; MaintenanceMode ()
-&gt; HashSet ExperimentalFeature
-&gt; EventingMode
-&gt; ReadOnlyMode
-&gt; Maybe NamingCase
-&gt; ServerConfigCtx
</span><a href="Hasura.Server.Types.html#ServerConfigCtx"><span class="hs-identifier hs-var">ServerConfigCtx</span></a></span><span>
</span><span id="line-418"></span><span>              </span><span class="annot"><span class="annottext">InferFunctionPermissions
</span><a href="#local-6989586621689329286"><span class="hs-identifier hs-var">functionPermsCtx</span></a></span><span>
</span><span id="line-419"></span><span>              </span><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621689329287"><span class="hs-identifier hs-var">remoteSchemaPermsCtx</span></a></span><span>
</span><span id="line-420"></span><span>              </span><span class="annot"><span class="annottext">SQLGenCtx
</span><a href="#local-6989586621689329290"><span class="hs-identifier hs-var">sqlGenCtx</span></a></span><span>
</span><span id="line-421"></span><span>              </span><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621689329285"><span class="hs-identifier hs-var">maintenanceMode</span></a></span><span>
</span><span id="line-422"></span><span>              </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621689329284"><span class="hs-identifier hs-var">experimentalFeatures</span></a></span><span>
</span><span id="line-423"></span><span>              </span><span class="annot"><span class="annottext">EventingMode
</span><a href="#local-6989586621689329283"><span class="hs-identifier hs-var">eventingMode</span></a></span><span>
</span><span id="line-424"></span><span>              </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="#local-6989586621689329282"><span class="hs-identifier hs-var">readOnlyMode</span></a></span><span>
</span><span id="line-425"></span><span>              </span><span class="annot"><span class="annottext">Maybe NamingCase
</span><a href="#local-6989586621689329281"><span class="hs-identifier hs-var">defaultNamingCase</span></a></span><span>
</span><span id="line-426"></span><span>      </span><span class="annot"><span class="annottext">Environment
-&gt; Logger Hasura
-&gt; InstanceId
-&gt; UserInfo
-&gt; RebuildableSchemaCache
-&gt; Manager
-&gt; ServerConfigCtx
-&gt; RQLQuery
-&gt; m (EncJSON, RebuildableSchemaCache)
forall (m :: * -&gt; *).
(MonadIO m, MonadTrace m, MonadBaseControl IO m,
 MonadMetadataStorage m, MonadResolveSource m, MonadQueryTags m) =&gt;
Environment
-&gt; Logger Hasura
-&gt; InstanceId
-&gt; UserInfo
-&gt; RebuildableSchemaCache
-&gt; Manager
-&gt; ServerConfigCtx
-&gt; RQLQuery
-&gt; m (EncJSON, RebuildableSchemaCache)
</span><a href="Hasura.Server.API.Query.html#runQuery"><span class="hs-identifier hs-var">runQuery</span></a></span><span>
</span><span id="line-427"></span><span>        </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621689329288"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-428"></span><span>        </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329295"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-429"></span><span>        </span><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621689329289"><span class="hs-identifier hs-var">instanceId</span></a></span><span>
</span><span id="line-430"></span><span>        </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329294"><span class="hs-identifier hs-var">userInfo</span></a></span><span>
</span><span id="line-431"></span><span>        </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621689329292"><span class="hs-identifier hs-var">schemaCache</span></a></span><span>
</span><span id="line-432"></span><span>        </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621689329291"><span class="hs-identifier hs-var">httpMgr</span></a></span><span>
</span><span id="line-433"></span><span>        </span><span class="annot"><span class="annottext">ServerConfigCtx
</span><a href="#local-6989586621689329280"><span class="hs-identifier hs-var">serverConfigCtx</span></a></span><span>
</span><span id="line-434"></span><span>        </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621689329303"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span id="local-6989586621689329646"><span class="annot"><a href="Hasura.Server.App.html#v1MetadataHandler"><span class="hs-identifier hs-type">v1MetadataHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329646"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-438"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329646"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-439"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329646"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-440"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.html#MonadTrace"><span class="hs-identifier hs-type">Tracing.MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329646"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-441"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329646"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-442"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329646"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-443"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329646"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-444"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-445"></span><span>  </span><span class="annot"><a href="Hasura.Server.API.Metadata.html#RQLMetadata"><span class="hs-identifier hs-type">RQLMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-446"></span><span>  </span><span class="annot"><a href="#local-6989586621689329646"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-447"></span><span id="v1MetadataHandler"><span class="annot"><span class="annottext">v1MetadataHandler :: RQLMetadata -&gt; m (HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1MetadataHandler"><span class="hs-identifier hs-var hs-var">v1MetadataHandler</span></a></span></span><span> </span><span id="local-6989586621689329276"><span class="annot"><span class="annottext">RQLMetadata
</span><a href="#local-6989586621689329276"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-448"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="Hasura.Prelude.html#liftEitherM"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; m ())
-&gt; (HandlerCtx -&gt; m (Either QErr ())) -&gt; HandlerCtx -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RQLMetadata -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLMetadata -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1MetadataApi"><span class="hs-identifier hs-var">authorizeV1MetadataApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLMetadata
</span><a href="#local-6989586621689329276"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; m ()) -&gt; m HandlerCtx -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">m HandlerCtx
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-449"></span><span>  </span><span id="local-6989586621689329275"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329275"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; UserInfo) -&gt; m UserInfo
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; UserInfo
</span><a href="Hasura.Server.App.html#hcUser"><span class="hs-identifier hs-var hs-var">hcUser</span></a></span><span>
</span><span id="line-450"></span><span>  </span><span id="local-6989586621689329274"><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329274"><span class="hs-identifier hs-var">scRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; SchemaCacheRef) -&gt; m SchemaCacheRef
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; SchemaCacheRef
</span><a href="Hasura.Server.App.html#scCacheRef"><span class="hs-identifier hs-var hs-var">scCacheRef</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; SchemaCacheRef)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; SchemaCacheRef
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>  </span><span id="local-6989586621689329273"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621689329273"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO RebuildableSchemaCache -&gt; m RebuildableSchemaCache
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO RebuildableSchemaCache -&gt; m RebuildableSchemaCache)
-&gt; IO RebuildableSchemaCache -&gt; m RebuildableSchemaCache
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(RebuildableSchemaCache, SchemaCacheVer) -&gt; RebuildableSchemaCache
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((RebuildableSchemaCache, SchemaCacheVer)
 -&gt; RebuildableSchemaCache)
-&gt; IO (RebuildableSchemaCache, SchemaCacheVer)
-&gt; IO RebuildableSchemaCache
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef -&gt; IO (RebuildableSchemaCache, SchemaCacheVer)
</span><a href="Hasura.Server.SchemaCacheRef.html#readSchemaCacheRef"><span class="hs-identifier hs-var">readSchemaCacheRef</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329274"><span class="hs-identifier hs-var">scRef</span></a></span><span>
</span><span id="line-452"></span><span>  </span><span id="local-6989586621689329272"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621689329272"><span class="hs-identifier hs-var">httpMgr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; Manager) -&gt; m Manager
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; Manager
</span><a href="Hasura.Server.App.html#scManager"><span class="hs-identifier hs-var hs-var">scManager</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; Manager)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; Manager
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>  </span><span id="local-6989586621689329271"><span class="annot"><span class="annottext">SQLGenCtx
</span><a href="#local-6989586621689329271"><span class="hs-identifier hs-var">_sccSQLGenCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; SQLGenCtx) -&gt; m SQLGenCtx
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; SQLGenCtx
</span><a href="Hasura.Server.App.html#scSQLGenCtx"><span class="hs-identifier hs-var hs-var">scSQLGenCtx</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; SQLGenCtx)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; SQLGenCtx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>  </span><span id="local-6989586621689329270"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621689329270"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; Environment) -&gt; m Environment
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; Environment
</span><a href="Hasura.Server.App.html#scEnvironment"><span class="hs-identifier hs-var hs-var">scEnvironment</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; Environment)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; Environment
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>  </span><span id="local-6989586621689329269"><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621689329269"><span class="hs-identifier hs-var">instanceId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; InstanceId) -&gt; m InstanceId
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; InstanceId
</span><a href="Hasura.Server.App.html#scInstanceId"><span class="hs-identifier hs-var hs-var">scInstanceId</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; InstanceId)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; InstanceId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>  </span><span id="local-6989586621689329268"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329268"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; Logger Hasura) -&gt; m (Logger Hasura)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; Logger Hasura
</span><a href="Hasura.Server.App.html#scLogger"><span class="hs-identifier hs-var hs-var">scLogger</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; Logger Hasura)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; Logger Hasura
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-457"></span><span>  </span><span id="local-6989586621689329267"><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621689329267"><span class="hs-identifier hs-var">_sccRemoteSchemaPermsCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; RemoteSchemaPermissions)
-&gt; m RemoteSchemaPermissions
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; RemoteSchemaPermissions
</span><a href="Hasura.Server.App.html#scRemoteSchemaPermsCtx"><span class="hs-identifier hs-var hs-var">scRemoteSchemaPermsCtx</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; RemoteSchemaPermissions)
-&gt; (HandlerCtx -&gt; ServerCtx)
-&gt; HandlerCtx
-&gt; RemoteSchemaPermissions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-458"></span><span>  </span><span id="local-6989586621689329266"><span class="annot"><span class="annottext">InferFunctionPermissions
</span><a href="#local-6989586621689329266"><span class="hs-identifier hs-var">_sccFunctionPermsCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; InferFunctionPermissions)
-&gt; m InferFunctionPermissions
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; InferFunctionPermissions
</span><a href="Hasura.Server.App.html#scFunctionPermsCtx"><span class="hs-identifier hs-var hs-var">scFunctionPermsCtx</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; InferFunctionPermissions)
-&gt; (HandlerCtx -&gt; ServerCtx)
-&gt; HandlerCtx
-&gt; InferFunctionPermissions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>  </span><span id="local-6989586621689329265"><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621689329265"><span class="hs-identifier hs-var">_sccExperimentalFeatures</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; HashSet ExperimentalFeature)
-&gt; m (HashSet ExperimentalFeature)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; HashSet ExperimentalFeature
</span><a href="Hasura.Server.App.html#scExperimentalFeatures"><span class="hs-identifier hs-var hs-var">scExperimentalFeatures</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; HashSet ExperimentalFeature)
-&gt; (HandlerCtx -&gt; ServerCtx)
-&gt; HandlerCtx
-&gt; HashSet ExperimentalFeature
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>  </span><span id="local-6989586621689329264"><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621689329264"><span class="hs-identifier hs-var">_sccMaintenanceMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; MaintenanceMode ()) -&gt; m (MaintenanceMode ())
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; MaintenanceMode ()
</span><a href="Hasura.Server.App.html#scEnableMaintenanceMode"><span class="hs-identifier hs-var hs-var">scEnableMaintenanceMode</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; MaintenanceMode ())
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; MaintenanceMode ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span>  </span><span id="local-6989586621689329263"><span class="annot"><span class="annottext">EventingMode
</span><a href="#local-6989586621689329263"><span class="hs-identifier hs-var">_sccEventingMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; EventingMode) -&gt; m EventingMode
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; EventingMode
</span><a href="Hasura.Server.App.html#scEventingMode"><span class="hs-identifier hs-var hs-var">scEventingMode</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; EventingMode)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; EventingMode
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>  </span><span id="local-6989586621689329262"><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="#local-6989586621689329262"><span class="hs-identifier hs-var">_sccReadOnlyMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; ReadOnlyMode) -&gt; m ReadOnlyMode
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; ReadOnlyMode
</span><a href="Hasura.Server.App.html#scEnableReadOnlyMode"><span class="hs-identifier hs-var hs-var">scEnableReadOnlyMode</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; ReadOnlyMode)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; ReadOnlyMode
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>  </span><span id="local-6989586621689329261"><span class="annot"><span class="annottext">Maybe NamingCase
</span><a href="#local-6989586621689329261"><span class="hs-identifier hs-var">_sccDefaultNamingConvention</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; Maybe NamingCase) -&gt; m (Maybe NamingCase)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; Maybe NamingCase
</span><a href="Hasura.Server.App.html#scDefaultNamingConvention"><span class="hs-identifier hs-var hs-var">scDefaultNamingConvention</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; Maybe NamingCase)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; Maybe NamingCase
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689329260"><span class="annot"><span class="annottext">serverConfigCtx :: ServerConfigCtx
</span><a href="#local-6989586621689329260"><span class="hs-identifier hs-var hs-var">serverConfigCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerConfigCtx :: InferFunctionPermissions
-&gt; RemoteSchemaPermissions
-&gt; SQLGenCtx
-&gt; MaintenanceMode ()
-&gt; HashSet ExperimentalFeature
-&gt; EventingMode
-&gt; ReadOnlyMode
-&gt; Maybe NamingCase
-&gt; ServerConfigCtx
</span><a href="Hasura.Server.Types.html#ServerConfigCtx"><span class="hs-identifier hs-type">ServerConfigCtx</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Maybe NamingCase
HashSet ExperimentalFeature
RemoteSchemaPermissions
InferFunctionPermissions
SQLGenCtx
EventingMode
ReadOnlyMode
MaintenanceMode ()
_sccDefaultNamingConvention :: Maybe NamingCase
_sccReadOnlyMode :: ReadOnlyMode
_sccEventingMode :: EventingMode
_sccExperimentalFeatures :: HashSet ExperimentalFeature
_sccMaintenanceMode :: MaintenanceMode ()
_sccSQLGenCtx :: SQLGenCtx
_sccRemoteSchemaPermsCtx :: RemoteSchemaPermissions
_sccFunctionPermsCtx :: InferFunctionPermissions
_sccDefaultNamingConvention :: Maybe NamingCase
_sccReadOnlyMode :: ReadOnlyMode
_sccEventingMode :: EventingMode
_sccMaintenanceMode :: MaintenanceMode ()
_sccExperimentalFeatures :: HashSet ExperimentalFeature
_sccFunctionPermsCtx :: InferFunctionPermissions
_sccRemoteSchemaPermsCtx :: RemoteSchemaPermissions
_sccSQLGenCtx :: SQLGenCtx
</span><a href="#local-6989586621689329252"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-465"></span><span>  </span><span id="local-6989586621689329251"><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621689329251"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-466"></span><span>    </span><span class="annot"><span class="annottext">SchemaCacheRef
-&gt; Logger Hasura
-&gt; Maybe (TVar Bool)
-&gt; m (EncJSON, RebuildableSchemaCache)
-&gt; m EncJSON
forall (m :: * -&gt; *) a.
(MonadIO m, MonadBaseControl IO m) =&gt;
SchemaCacheRef
-&gt; Logger Hasura
-&gt; Maybe (TVar Bool)
-&gt; m (a, RebuildableSchemaCache)
-&gt; m a
</span><a href="Hasura.Server.SchemaCacheRef.html#withSchemaCacheUpdate"><span class="hs-identifier hs-var">withSchemaCacheUpdate</span></a></span><span>
</span><span id="line-467"></span><span>      </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329274"><span class="hs-identifier hs-var">scRef</span></a></span><span>
</span><span id="line-468"></span><span>      </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329268"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-469"></span><span>      </span><span class="annot"><span class="annottext">Maybe (TVar Bool)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-470"></span><span>      </span><span class="annot"><span class="annottext">(m (EncJSON, RebuildableSchemaCache) -&gt; m EncJSON)
-&gt; m (EncJSON, RebuildableSchemaCache) -&gt; m EncJSON
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Environment
-&gt; Logger Hasura
-&gt; InstanceId
-&gt; UserInfo
-&gt; Manager
-&gt; ServerConfigCtx
-&gt; RebuildableSchemaCache
-&gt; RQLMetadata
-&gt; m (EncJSON, RebuildableSchemaCache)
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadTrace m,
 MonadMetadataStorage m, MonadResolveSource m) =&gt;
Environment
-&gt; Logger Hasura
-&gt; InstanceId
-&gt; UserInfo
-&gt; Manager
-&gt; ServerConfigCtx
-&gt; RebuildableSchemaCache
-&gt; RQLMetadata
-&gt; m (EncJSON, RebuildableSchemaCache)
</span><a href="Hasura.Server.API.Metadata.html#runMetadataQuery"><span class="hs-identifier hs-var">runMetadataQuery</span></a></span><span>
</span><span id="line-471"></span><span>        </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621689329270"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-472"></span><span>        </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329268"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-473"></span><span>        </span><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621689329269"><span class="hs-identifier hs-var">instanceId</span></a></span><span>
</span><span id="line-474"></span><span>        </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329275"><span class="hs-identifier hs-var">userInfo</span></a></span><span>
</span><span id="line-475"></span><span>        </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621689329272"><span class="hs-identifier hs-var">httpMgr</span></a></span><span>
</span><span id="line-476"></span><span>        </span><span class="annot"><span class="annottext">ServerConfigCtx
</span><a href="#local-6989586621689329260"><span class="hs-identifier hs-var">serverConfigCtx</span></a></span><span>
</span><span id="line-477"></span><span>        </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621689329273"><span class="hs-identifier hs-var">schemaCache</span></a></span><span>
</span><span id="line-478"></span><span>        </span><span class="annot"><span class="annottext">RQLMetadata
</span><a href="#local-6989586621689329276"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-479"></span><span>  </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; m (HttpResponse EncJSON)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; m (HttpResponse EncJSON))
-&gt; HttpResponse EncJSON -&gt; m (HttpResponse EncJSON)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621689329251"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span id="local-6989586621689329645"><span class="annot"><a href="Hasura.Server.App.html#v2QueryHandler"><span class="hs-identifier hs-type">v2QueryHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-482"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329645"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-483"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329645"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-484"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329645"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-485"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.html#MonadTrace"><span class="hs-identifier hs-type">Tracing.MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329645"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-486"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329645"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-487"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329645"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-488"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329645"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-489"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Backend.html#MonadQueryTags"><span class="hs-identifier hs-type">EB.MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329645"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-490"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-491"></span><span>  </span><span class="annot"><a href="Hasura.Server.API.V2Query.html#RQLQuery"><span class="hs-identifier hs-type">V2Q.RQLQuery</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-492"></span><span>  </span><span class="annot"><a href="#local-6989586621689329645"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-493"></span><span id="v2QueryHandler"><span class="annot"><span class="annottext">v2QueryHandler :: RQLQuery -&gt; m (HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v2QueryHandler"><span class="hs-identifier hs-var hs-var">v2QueryHandler</span></a></span></span><span> </span><span id="local-6989586621689329248"><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621689329248"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-494"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="Hasura.Prelude.html#liftEitherM"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; m ())
-&gt; (HandlerCtx -&gt; m (Either QErr ())) -&gt; HandlerCtx -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV2QueryApi"><span class="hs-identifier hs-var">authorizeV2QueryApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621689329248"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; m ()) -&gt; m HandlerCtx -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">m HandlerCtx
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-495"></span><span>  </span><span id="local-6989586621689329247"><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329247"><span class="hs-identifier hs-var">scRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; SchemaCacheRef) -&gt; m SchemaCacheRef
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; SchemaCacheRef
</span><a href="Hasura.Server.App.html#scCacheRef"><span class="hs-identifier hs-var hs-var">scCacheRef</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; SchemaCacheRef)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; SchemaCacheRef
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-496"></span><span>  </span><span id="local-6989586621689329246"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329246"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; Logger Hasura) -&gt; m (Logger Hasura)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; Logger Hasura
</span><a href="Hasura.Server.App.html#scLogger"><span class="hs-identifier hs-var hs-var">scLogger</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; Logger Hasura)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; Logger Hasura
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>  </span><span id="local-6989586621689329245"><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621689329245"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-498"></span><span>    </span><span class="annot"><span class="annottext">m EncJSON -&gt; m EncJSON -&gt; Bool -&gt; m EncJSON
forall a. a -&gt; a -&gt; Bool -&gt; a
</span><span class="hs-identifier hs-var">bool</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EncJSON, RebuildableSchemaCache) -&gt; EncJSON
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((EncJSON, RebuildableSchemaCache) -&gt; EncJSON)
-&gt; m (EncJSON, RebuildableSchemaCache) -&gt; m EncJSON
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m (EncJSON, RebuildableSchemaCache)
</span><a href="#local-6989586621689329244"><span class="hs-identifier hs-var">dbAction</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaCacheRef
-&gt; Logger Hasura
-&gt; Maybe (TVar Bool)
-&gt; m (EncJSON, RebuildableSchemaCache)
-&gt; m EncJSON
forall (m :: * -&gt; *) a.
(MonadIO m, MonadBaseControl IO m) =&gt;
SchemaCacheRef
-&gt; Logger Hasura
-&gt; Maybe (TVar Bool)
-&gt; m (a, RebuildableSchemaCache)
-&gt; m a
</span><a href="Hasura.Server.SchemaCacheRef.html#withSchemaCacheUpdate"><span class="hs-identifier hs-var">withSchemaCacheUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329247"><span class="hs-identifier hs-var">scRef</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329246"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TVar Bool)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">m (EncJSON, RebuildableSchemaCache)
</span><a href="#local-6989586621689329244"><span class="hs-identifier hs-var">dbAction</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; m EncJSON) -&gt; Bool -&gt; m EncJSON
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-499"></span><span>      </span><span class="annot"><span class="annottext">RQLQuery -&gt; Bool
</span><a href="Hasura.Server.API.V2Query.html#queryModifiesSchema"><span class="hs-identifier hs-var">V2Q.queryModifiesSchema</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621689329248"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-500"></span><span>  </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; m (HttpResponse EncJSON)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; m (HttpResponse EncJSON))
-&gt; HttpResponse EncJSON -&gt; m (HttpResponse EncJSON)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621689329245"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-501"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-502"></span><span>    </span><span class="hs-comment">-- Hit postgres</span><span>
</span><span id="line-503"></span><span>    </span><span id="local-6989586621689329244"><span class="annot"><span class="annottext">dbAction :: m (EncJSON, RebuildableSchemaCache)
</span><a href="#local-6989586621689329244"><span class="hs-identifier hs-var hs-var">dbAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-504"></span><span>      </span><span id="local-6989586621689329242"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329242"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; UserInfo) -&gt; m UserInfo
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; UserInfo
</span><a href="Hasura.Server.App.html#hcUser"><span class="hs-identifier hs-var hs-var">hcUser</span></a></span><span>
</span><span id="line-505"></span><span>      </span><span id="local-6989586621689329241"><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329241"><span class="hs-identifier hs-var">scRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; SchemaCacheRef) -&gt; m SchemaCacheRef
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; SchemaCacheRef
</span><a href="Hasura.Server.App.html#scCacheRef"><span class="hs-identifier hs-var hs-var">scCacheRef</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; SchemaCacheRef)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; SchemaCacheRef
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-506"></span><span>      </span><span id="local-6989586621689329240"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621689329240"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO RebuildableSchemaCache -&gt; m RebuildableSchemaCache
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO RebuildableSchemaCache -&gt; m RebuildableSchemaCache)
-&gt; IO RebuildableSchemaCache -&gt; m RebuildableSchemaCache
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(RebuildableSchemaCache, SchemaCacheVer) -&gt; RebuildableSchemaCache
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((RebuildableSchemaCache, SchemaCacheVer)
 -&gt; RebuildableSchemaCache)
-&gt; IO (RebuildableSchemaCache, SchemaCacheVer)
-&gt; IO RebuildableSchemaCache
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef -&gt; IO (RebuildableSchemaCache, SchemaCacheVer)
</span><a href="Hasura.Server.SchemaCacheRef.html#readSchemaCacheRef"><span class="hs-identifier hs-var">readSchemaCacheRef</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329241"><span class="hs-identifier hs-var">scRef</span></a></span><span>
</span><span id="line-507"></span><span>      </span><span id="local-6989586621689329239"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621689329239"><span class="hs-identifier hs-var">httpMgr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; Manager) -&gt; m Manager
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; Manager
</span><a href="Hasura.Server.App.html#scManager"><span class="hs-identifier hs-var hs-var">scManager</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; Manager)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; Manager
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span>      </span><span id="local-6989586621689329238"><span class="annot"><span class="annottext">SQLGenCtx
</span><a href="#local-6989586621689329238"><span class="hs-identifier hs-var">sqlGenCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; SQLGenCtx) -&gt; m SQLGenCtx
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; SQLGenCtx
</span><a href="Hasura.Server.App.html#scSQLGenCtx"><span class="hs-identifier hs-var hs-var">scSQLGenCtx</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; SQLGenCtx)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; SQLGenCtx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>      </span><span id="local-6989586621689329237"><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621689329237"><span class="hs-identifier hs-var">instanceId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; InstanceId) -&gt; m InstanceId
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; InstanceId
</span><a href="Hasura.Server.App.html#scInstanceId"><span class="hs-identifier hs-var hs-var">scInstanceId</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; InstanceId)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; InstanceId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>      </span><span id="local-6989586621689329236"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621689329236"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; Environment) -&gt; m Environment
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; Environment
</span><a href="Hasura.Server.App.html#scEnvironment"><span class="hs-identifier hs-var hs-var">scEnvironment</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; Environment)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; Environment
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>      </span><span id="local-6989586621689329235"><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621689329235"><span class="hs-identifier hs-var">remoteSchemaPermsCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; RemoteSchemaPermissions)
-&gt; m RemoteSchemaPermissions
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; RemoteSchemaPermissions
</span><a href="Hasura.Server.App.html#scRemoteSchemaPermsCtx"><span class="hs-identifier hs-var hs-var">scRemoteSchemaPermsCtx</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; RemoteSchemaPermissions)
-&gt; (HandlerCtx -&gt; ServerCtx)
-&gt; HandlerCtx
-&gt; RemoteSchemaPermissions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-512"></span><span>      </span><span id="local-6989586621689329234"><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621689329234"><span class="hs-identifier hs-var">experimentalFeatures</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; HashSet ExperimentalFeature)
-&gt; m (HashSet ExperimentalFeature)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; HashSet ExperimentalFeature
</span><a href="Hasura.Server.App.html#scExperimentalFeatures"><span class="hs-identifier hs-var hs-var">scExperimentalFeatures</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; HashSet ExperimentalFeature)
-&gt; (HandlerCtx -&gt; ServerCtx)
-&gt; HandlerCtx
-&gt; HashSet ExperimentalFeature
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span>      </span><span id="local-6989586621689329233"><span class="annot"><span class="annottext">InferFunctionPermissions
</span><a href="#local-6989586621689329233"><span class="hs-identifier hs-var">functionPermsCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; InferFunctionPermissions)
-&gt; m InferFunctionPermissions
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; InferFunctionPermissions
</span><a href="Hasura.Server.App.html#scFunctionPermsCtx"><span class="hs-identifier hs-var hs-var">scFunctionPermsCtx</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; InferFunctionPermissions)
-&gt; (HandlerCtx -&gt; ServerCtx)
-&gt; HandlerCtx
-&gt; InferFunctionPermissions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span>      </span><span id="local-6989586621689329232"><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621689329232"><span class="hs-identifier hs-var">maintenanceMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; MaintenanceMode ()) -&gt; m (MaintenanceMode ())
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; MaintenanceMode ()
</span><a href="Hasura.Server.App.html#scEnableMaintenanceMode"><span class="hs-identifier hs-var hs-var">scEnableMaintenanceMode</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; MaintenanceMode ())
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; MaintenanceMode ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>      </span><span id="local-6989586621689329231"><span class="annot"><span class="annottext">EventingMode
</span><a href="#local-6989586621689329231"><span class="hs-identifier hs-var">eventingMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; EventingMode) -&gt; m EventingMode
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; EventingMode
</span><a href="Hasura.Server.App.html#scEventingMode"><span class="hs-identifier hs-var hs-var">scEventingMode</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; EventingMode)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; EventingMode
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span>      </span><span id="local-6989586621689329230"><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="#local-6989586621689329230"><span class="hs-identifier hs-var">readOnlyMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; ReadOnlyMode) -&gt; m ReadOnlyMode
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; ReadOnlyMode
</span><a href="Hasura.Server.App.html#scEnableReadOnlyMode"><span class="hs-identifier hs-var hs-var">scEnableReadOnlyMode</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; ReadOnlyMode)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; ReadOnlyMode
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span>      </span><span id="local-6989586621689329229"><span class="annot"><span class="annottext">Maybe NamingCase
</span><a href="#local-6989586621689329229"><span class="hs-identifier hs-var">defaultNamingCase</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; Maybe NamingCase) -&gt; m (Maybe NamingCase)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; Maybe NamingCase
</span><a href="Hasura.Server.App.html#scDefaultNamingConvention"><span class="hs-identifier hs-var hs-var">scDefaultNamingConvention</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; Maybe NamingCase)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; Maybe NamingCase
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689329228"><span class="annot"><span class="annottext">serverConfigCtx :: ServerConfigCtx
</span><a href="#local-6989586621689329228"><span class="hs-identifier hs-var hs-var">serverConfigCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-519"></span><span>            </span><span class="annot"><span class="annottext">InferFunctionPermissions
-&gt; RemoteSchemaPermissions
-&gt; SQLGenCtx
-&gt; MaintenanceMode ()
-&gt; HashSet ExperimentalFeature
-&gt; EventingMode
-&gt; ReadOnlyMode
-&gt; Maybe NamingCase
-&gt; ServerConfigCtx
</span><a href="Hasura.Server.Types.html#ServerConfigCtx"><span class="hs-identifier hs-var">ServerConfigCtx</span></a></span><span>
</span><span id="line-520"></span><span>              </span><span class="annot"><span class="annottext">InferFunctionPermissions
</span><a href="#local-6989586621689329233"><span class="hs-identifier hs-var">functionPermsCtx</span></a></span><span>
</span><span id="line-521"></span><span>              </span><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621689329235"><span class="hs-identifier hs-var">remoteSchemaPermsCtx</span></a></span><span>
</span><span id="line-522"></span><span>              </span><span class="annot"><span class="annottext">SQLGenCtx
</span><a href="#local-6989586621689329238"><span class="hs-identifier hs-var">sqlGenCtx</span></a></span><span>
</span><span id="line-523"></span><span>              </span><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621689329232"><span class="hs-identifier hs-var">maintenanceMode</span></a></span><span>
</span><span id="line-524"></span><span>              </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621689329234"><span class="hs-identifier hs-var">experimentalFeatures</span></a></span><span>
</span><span id="line-525"></span><span>              </span><span class="annot"><span class="annottext">EventingMode
</span><a href="#local-6989586621689329231"><span class="hs-identifier hs-var">eventingMode</span></a></span><span>
</span><span id="line-526"></span><span>              </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="#local-6989586621689329230"><span class="hs-identifier hs-var">readOnlyMode</span></a></span><span>
</span><span id="line-527"></span><span>              </span><span class="annot"><span class="annottext">Maybe NamingCase
</span><a href="#local-6989586621689329229"><span class="hs-identifier hs-var">defaultNamingCase</span></a></span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span>      </span><span class="annot"><span class="annottext">Environment
-&gt; InstanceId
-&gt; UserInfo
-&gt; RebuildableSchemaCache
-&gt; Manager
-&gt; ServerConfigCtx
-&gt; RQLQuery
-&gt; m (EncJSON, RebuildableSchemaCache)
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadTrace m,
 MonadMetadataStorage m, MonadResolveSource m, MonadQueryTags m) =&gt;
Environment
-&gt; InstanceId
-&gt; UserInfo
-&gt; RebuildableSchemaCache
-&gt; Manager
-&gt; ServerConfigCtx
-&gt; RQLQuery
-&gt; m (EncJSON, RebuildableSchemaCache)
</span><a href="Hasura.Server.API.V2Query.html#runQuery"><span class="hs-identifier hs-var">V2Q.runQuery</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621689329236"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621689329237"><span class="hs-identifier hs-var">instanceId</span></a></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329242"><span class="hs-identifier hs-var">userInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621689329240"><span class="hs-identifier hs-var">schemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621689329239"><span class="hs-identifier hs-var">httpMgr</span></a></span><span> </span><span class="annot"><span class="annottext">ServerConfigCtx
</span><a href="#local-6989586621689329228"><span class="hs-identifier hs-var">serverConfigCtx</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621689329248"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-530"></span><span>
</span><span id="line-531"></span><span id="local-6989586621689329822"><span class="annot"><a href="Hasura.Server.App.html#v1Alpha1GQHandler"><span class="hs-identifier hs-type">v1Alpha1GQHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-532"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329822"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-533"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329822"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-534"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier hs-type">E.MonadGQLExecutionCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329822"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-535"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.html#MonadQueryLog"><span class="hs-identifier hs-type">MonadQueryLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329822"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-536"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.html#MonadTrace"><span class="hs-identifier hs-type">Tracing.MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329822"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-537"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier hs-type">GH.MonadExecuteQuery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329822"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-538"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329822"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-539"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329822"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-540"></span><span>    </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329822"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-541"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MetadataStorageT"><span class="hs-identifier hs-type">MetadataStorageT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329822"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-542"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Backend.html#MonadQueryTags"><span class="hs-identifier hs-type">EB.MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329822"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-543"></span><span>    </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329822"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-544"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-545"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Execute.Types.html#GraphQLQueryType"><span class="hs-identifier hs-type">E.GraphQLQueryType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-546"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLBatchedReqs"><span class="hs-identifier hs-type">GH.GQLBatchedReqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLReq"><span class="hs-identifier hs-type">GH.GQLReq</span></a></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLQueryText"><span class="hs-identifier hs-type">GH.GQLQueryText</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-547"></span><span>  </span><span class="annot"><a href="#local-6989586621689329822"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLogMetadata"><span class="hs-identifier hs-type">HttpLogMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329822"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-548"></span><span id="v1Alpha1GQHandler"><span class="annot"><span class="annottext">v1Alpha1GQHandler :: GraphQLQueryType
-&gt; ReqsText -&gt; m (HttpLogMetadata m, HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1Alpha1GQHandler"><span class="hs-identifier hs-var hs-var">v1Alpha1GQHandler</span></a></span></span><span> </span><span id="local-6989586621689329222"><span class="annot"><span class="annottext">GraphQLQueryType
</span><a href="#local-6989586621689329222"><span class="hs-identifier hs-var">queryType</span></a></span></span><span> </span><span id="local-6989586621689329221"><span class="annot"><span class="annottext">ReqsText
</span><a href="#local-6989586621689329221"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-549"></span><span>  </span><span id="local-6989586621689329220"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329220"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; UserInfo) -&gt; m UserInfo
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; UserInfo
</span><a href="Hasura.Server.App.html#hcUser"><span class="hs-identifier hs-var hs-var">hcUser</span></a></span><span>
</span><span id="line-550"></span><span>  </span><span id="local-6989586621689329219"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329219"><span class="hs-identifier hs-var">reqHeaders</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; [Header]) -&gt; m [Header]
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; [Header]
</span><a href="Hasura.Server.App.html#hcReqHeaders"><span class="hs-identifier hs-var hs-var">hcReqHeaders</span></a></span><span>
</span><span id="line-551"></span><span>  </span><span id="local-6989586621689329218"><span class="annot"><span class="annottext">IpAddress
</span><a href="#local-6989586621689329218"><span class="hs-identifier hs-var">ipAddress</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; IpAddress) -&gt; m IpAddress
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; IpAddress
</span><a href="Hasura.Server.App.html#hcSourceIpAddress"><span class="hs-identifier hs-var hs-var">hcSourceIpAddress</span></a></span><span>
</span><span id="line-552"></span><span>  </span><span id="local-6989586621689329217"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689329217"><span class="hs-identifier hs-var">requestId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; RequestId) -&gt; m RequestId
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; RequestId
</span><a href="Hasura.Server.App.html#hcRequestId"><span class="hs-identifier hs-var hs-var">hcRequestId</span></a></span><span>
</span><span id="line-553"></span><span>  </span><span id="local-6989586621689329216"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329216"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; Logger Hasura) -&gt; m (Logger Hasura)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; Logger Hasura
</span><a href="Hasura.Server.App.html#scLogger"><span class="hs-identifier hs-var hs-var">scLogger</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; Logger Hasura)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; Logger Hasura
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>  </span><span id="local-6989586621689329215"><span class="annot"><span class="annottext">ResponseInternalErrorsConfig
</span><a href="#local-6989586621689329215"><span class="hs-identifier hs-var">responseErrorsConfig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; ResponseInternalErrorsConfig)
-&gt; m ResponseInternalErrorsConfig
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; ResponseInternalErrorsConfig
</span><a href="Hasura.Server.App.html#scResponseInternalErrorsConfig"><span class="hs-identifier hs-var hs-var">scResponseInternalErrorsConfig</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; ResponseInternalErrorsConfig)
-&gt; (HandlerCtx -&gt; ServerCtx)
-&gt; HandlerCtx
-&gt; ResponseInternalErrorsConfig
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>  </span><span id="local-6989586621689329214"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621689329214"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; Environment) -&gt; m Environment
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; Environment
</span><a href="Hasura.Server.App.html#scEnvironment"><span class="hs-identifier hs-var hs-var">scEnvironment</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; Environment)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; Environment
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span>  </span><span id="local-6989586621689329213"><span class="annot"><span class="annottext">ExecutionCtx
</span><a href="#local-6989586621689329213"><span class="hs-identifier hs-var">execCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m ExecutionCtx
forall (m :: * -&gt; *).
(MonadIO m, MonadReader HandlerCtx m) =&gt;
m ExecutionCtx
</span><a href="Hasura.Server.App.html#mkExecutionContext"><span class="hs-identifier hs-var">mkExecutionContext</span></a></span><span>
</span><span id="line-558"></span><span>
</span><span id="line-559"></span><span>  </span><span class="annot"><span class="annottext">(ReaderT ExecutionCtx m (HttpLogMetadata m, HttpResponse EncJSON)
 -&gt; ExecutionCtx -&gt; m (HttpLogMetadata m, HttpResponse EncJSON))
-&gt; ExecutionCtx
-&gt; ReaderT ExecutionCtx m (HttpLogMetadata m, HttpResponse EncJSON)
-&gt; m (HttpLogMetadata m, HttpResponse EncJSON)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ReaderT ExecutionCtx m (HttpLogMetadata m, HttpResponse EncJSON)
-&gt; ExecutionCtx -&gt; m (HttpLogMetadata m, HttpResponse EncJSON)
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">ExecutionCtx
</span><a href="#local-6989586621689329213"><span class="hs-identifier hs-var">execCtx</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT ExecutionCtx m (HttpLogMetadata m, HttpResponse EncJSON)
 -&gt; m (HttpLogMetadata m, HttpResponse EncJSON))
-&gt; ReaderT ExecutionCtx m (HttpLogMetadata m, HttpResponse EncJSON)
-&gt; m (HttpLogMetadata m, HttpResponse EncJSON)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-560"></span><span>    </span><span class="annot"><span class="annottext">Environment
-&gt; Logger Hasura
-&gt; RequestId
-&gt; ResponseInternalErrorsConfig
-&gt; UserInfo
-&gt; IpAddress
-&gt; [Header]
-&gt; GraphQLQueryType
-&gt; ReqsText
-&gt; ReaderT
     ExecutionCtx
     m
     (HttpLogMetadata (ReaderT ExecutionCtx m), HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadError QErr m,
 MonadReader ExecutionCtx m, MonadGQLExecutionCheck m,
 MonadQueryLog m, MonadTrace m, MonadExecuteQuery m, HttpLog m,
 MonadMetadataStorage (MetadataStorageT m), MonadQueryTags m,
 HasResourceLimits m) =&gt;
Environment
-&gt; Logger Hasura
-&gt; RequestId
-&gt; ResponseInternalErrorsConfig
-&gt; UserInfo
-&gt; IpAddress
-&gt; [Header]
-&gt; GraphQLQueryType
-&gt; ReqsText
-&gt; m (HttpLogMetadata m, HttpResponse EncJSON)
</span><a href="Hasura.GraphQL.Transport.HTTP.html#runGQBatched"><span class="hs-identifier hs-var">GH.runGQBatched</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621689329214"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329216"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689329217"><span class="hs-identifier hs-var">requestId</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseInternalErrorsConfig
</span><a href="#local-6989586621689329215"><span class="hs-identifier hs-var">responseErrorsConfig</span></a></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689329220"><span class="hs-identifier hs-var">userInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IpAddress
</span><a href="#local-6989586621689329218"><span class="hs-identifier hs-var">ipAddress</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329219"><span class="hs-identifier hs-var">reqHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">GraphQLQueryType
</span><a href="#local-6989586621689329222"><span class="hs-identifier hs-var">queryType</span></a></span><span> </span><span class="annot"><span class="annottext">ReqsText
</span><a href="#local-6989586621689329221"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span id="local-6989586621689329830"><span class="annot"><a href="Hasura.Server.App.html#mkExecutionContext"><span class="hs-identifier hs-type">mkExecutionContext</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-563"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329830"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-564"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329830"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-565"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-566"></span><span>  </span><span class="annot"><a href="#local-6989586621689329830"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.html#ExecutionCtx"><span class="hs-identifier hs-type">E.ExecutionCtx</span></a></span></span><span>
</span><span id="line-567"></span><span id="mkExecutionContext"><span class="annot"><span class="annottext">mkExecutionContext :: m ExecutionCtx
</span><a href="Hasura.Server.App.html#mkExecutionContext"><span class="hs-identifier hs-var hs-var">mkExecutionContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-568"></span><span>  </span><span id="local-6989586621689329210"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621689329210"><span class="hs-identifier hs-var">manager</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; Manager) -&gt; m Manager
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; Manager
</span><a href="Hasura.Server.App.html#scManager"><span class="hs-identifier hs-var hs-var">scManager</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; Manager)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; Manager
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span>  </span><span id="local-6989586621689329209"><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329209"><span class="hs-identifier hs-var">scRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; SchemaCacheRef) -&gt; m SchemaCacheRef
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; SchemaCacheRef
</span><a href="Hasura.Server.App.html#scCacheRef"><span class="hs-identifier hs-var hs-var">scCacheRef</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; SchemaCacheRef)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; SchemaCacheRef
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621689329208"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621689329208"><span class="hs-identifier hs-var">sc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329207"><span class="annot"><span class="annottext">SchemaCacheVer
</span><a href="#local-6989586621689329207"><span class="hs-identifier hs-var">scVer</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (RebuildableSchemaCache, SchemaCacheVer)
-&gt; m (RebuildableSchemaCache, SchemaCacheVer)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (RebuildableSchemaCache, SchemaCacheVer)
 -&gt; m (RebuildableSchemaCache, SchemaCacheVer))
-&gt; IO (RebuildableSchemaCache, SchemaCacheVer)
-&gt; m (RebuildableSchemaCache, SchemaCacheVer)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef -&gt; IO (RebuildableSchemaCache, SchemaCacheVer)
</span><a href="Hasura.Server.SchemaCacheRef.html#readSchemaCacheRef"><span class="hs-identifier hs-var">readSchemaCacheRef</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329209"><span class="hs-identifier hs-var">scRef</span></a></span><span>
</span><span id="line-571"></span><span>  </span><span id="local-6989586621689329206"><span class="annot"><span class="annottext">SQLGenCtx
</span><a href="#local-6989586621689329206"><span class="hs-identifier hs-var">sqlGenCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; SQLGenCtx) -&gt; m SQLGenCtx
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; SQLGenCtx
</span><a href="Hasura.Server.App.html#scSQLGenCtx"><span class="hs-identifier hs-var hs-var">scSQLGenCtx</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; SQLGenCtx)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; SQLGenCtx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span>  </span><span id="local-6989586621689329205"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329205"><span class="hs-identifier hs-var">enableAL</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; Bool) -&gt; m Bool
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; Bool
</span><a href="Hasura.Server.App.html#scEnableAllowlist"><span class="hs-identifier hs-var hs-var">scEnableAllowlist</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; Bool)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-573"></span><span>  </span><span id="local-6989586621689329204"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329204"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; Logger Hasura) -&gt; m (Logger Hasura)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; Logger Hasura
</span><a href="Hasura.Server.App.html#scLogger"><span class="hs-identifier hs-var hs-var">scLogger</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; Logger Hasura)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; Logger Hasura
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span>  </span><span id="local-6989586621689329203"><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="#local-6989586621689329203"><span class="hs-identifier hs-var">readOnlyMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; ReadOnlyMode) -&gt; m ReadOnlyMode
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; ReadOnlyMode
</span><a href="Hasura.Server.App.html#scEnableReadOnlyMode"><span class="hs-identifier hs-var hs-var">scEnableReadOnlyMode</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; ReadOnlyMode)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; ReadOnlyMode
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>  </span><span class="annot"><span class="annottext">ExecutionCtx -&gt; m ExecutionCtx
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ExecutionCtx -&gt; m ExecutionCtx) -&gt; ExecutionCtx -&gt; m ExecutionCtx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; SQLGenCtx
-&gt; SchemaCache
-&gt; SchemaCacheVer
-&gt; Manager
-&gt; Bool
-&gt; ReadOnlyMode
-&gt; ExecutionCtx
</span><a href="Hasura.GraphQL.Execute.html#ExecutionCtx"><span class="hs-identifier hs-var">E.ExecutionCtx</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329204"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">SQLGenCtx
</span><a href="#local-6989586621689329206"><span class="hs-identifier hs-var">sqlGenCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RebuildableSchemaCache -&gt; SchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#lastBuiltSchemaCache"><span class="hs-identifier hs-var hs-var">lastBuiltSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621689329208"><span class="hs-identifier hs-var">sc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SchemaCacheVer
</span><a href="#local-6989586621689329207"><span class="hs-identifier hs-var">scVer</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621689329210"><span class="hs-identifier hs-var">manager</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329205"><span class="hs-identifier hs-var">enableAL</span></a></span><span> </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="#local-6989586621689329203"><span class="hs-identifier hs-var">readOnlyMode</span></a></span><span>
</span><span id="line-576"></span><span>
</span><span id="line-577"></span><span id="local-6989586621689329639"><span class="annot"><a href="Hasura.Server.App.html#v1GQHandler"><span class="hs-identifier hs-type">v1GQHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-578"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329639"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-579"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329639"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-580"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier hs-type">E.MonadGQLExecutionCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329639"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-581"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.html#MonadQueryLog"><span class="hs-identifier hs-type">MonadQueryLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329639"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-582"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.html#MonadTrace"><span class="hs-identifier hs-type">Tracing.MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329639"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-583"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier hs-type">GH.MonadExecuteQuery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329639"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-584"></span><span>    </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329639"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-585"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329639"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-586"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329639"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-587"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MetadataStorageT"><span class="hs-identifier hs-type">MetadataStorageT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329639"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-588"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Backend.html#MonadQueryTags"><span class="hs-identifier hs-type">EB.MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329639"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-589"></span><span>    </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329639"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-590"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-591"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLBatchedReqs"><span class="hs-identifier hs-type">GH.GQLBatchedReqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLReq"><span class="hs-identifier hs-type">GH.GQLReq</span></a></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLQueryText"><span class="hs-identifier hs-type">GH.GQLQueryText</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-592"></span><span>  </span><span class="annot"><a href="#local-6989586621689329639"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLogMetadata"><span class="hs-identifier hs-type">HttpLogMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329639"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-593"></span><span id="v1GQHandler"><span class="annot"><span class="annottext">v1GQHandler :: ReqsText -&gt; m (HttpLogMetadata m, HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1GQHandler"><span class="hs-identifier hs-var hs-var">v1GQHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GraphQLQueryType
-&gt; ReqsText -&gt; m (HttpLogMetadata m, HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadGQLExecutionCheck m,
 MonadQueryLog m, MonadTrace m, MonadExecuteQuery m,
 MonadError QErr m, MonadReader HandlerCtx m, HttpLog m,
 MonadMetadataStorage (MetadataStorageT m), MonadQueryTags m,
 HasResourceLimits m) =&gt;
GraphQLQueryType
-&gt; ReqsText -&gt; m (HttpLogMetadata m, HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1Alpha1GQHandler"><span class="hs-identifier hs-var">v1Alpha1GQHandler</span></a></span><span> </span><span class="annot"><span class="annottext">GraphQLQueryType
</span><a href="Hasura.GraphQL.Execute.Types.html#QueryHasura"><span class="hs-identifier hs-var">E.QueryHasura</span></a></span><span>
</span><span id="line-594"></span><span>
</span><span id="line-595"></span><span id="local-6989586621689329638"><span class="annot"><a href="Hasura.Server.App.html#v1GQRelayHandler"><span class="hs-identifier hs-type">v1GQRelayHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-596"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329638"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-597"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329638"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-598"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier hs-type">E.MonadGQLExecutionCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329638"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-599"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.html#MonadQueryLog"><span class="hs-identifier hs-type">MonadQueryLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329638"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-600"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.html#MonadTrace"><span class="hs-identifier hs-type">Tracing.MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329638"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-601"></span><span>    </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329638"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-602"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier hs-type">GH.MonadExecuteQuery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329638"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-603"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329638"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-604"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329638"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-605"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MetadataStorageT"><span class="hs-identifier hs-type">MetadataStorageT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329638"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-606"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Backend.html#MonadQueryTags"><span class="hs-identifier hs-type">EB.MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329638"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-607"></span><span>    </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329638"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-608"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-609"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLBatchedReqs"><span class="hs-identifier hs-type">GH.GQLBatchedReqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLReq"><span class="hs-identifier hs-type">GH.GQLReq</span></a></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLQueryText"><span class="hs-identifier hs-type">GH.GQLQueryText</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-610"></span><span>  </span><span class="annot"><a href="#local-6989586621689329638"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLogMetadata"><span class="hs-identifier hs-type">HttpLogMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329638"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-611"></span><span id="v1GQRelayHandler"><span class="annot"><span class="annottext">v1GQRelayHandler :: ReqsText -&gt; m (HttpLogMetadata m, HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1GQRelayHandler"><span class="hs-identifier hs-var hs-var">v1GQRelayHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GraphQLQueryType
-&gt; ReqsText -&gt; m (HttpLogMetadata m, HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadGQLExecutionCheck m,
 MonadQueryLog m, MonadTrace m, MonadExecuteQuery m,
 MonadError QErr m, MonadReader HandlerCtx m, HttpLog m,
 MonadMetadataStorage (MetadataStorageT m), MonadQueryTags m,
 HasResourceLimits m) =&gt;
GraphQLQueryType
-&gt; ReqsText -&gt; m (HttpLogMetadata m, HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1Alpha1GQHandler"><span class="hs-identifier hs-var">v1Alpha1GQHandler</span></a></span><span> </span><span class="annot"><span class="annottext">GraphQLQueryType
</span><a href="Hasura.GraphQL.Execute.Types.html#QueryRelay"><span class="hs-identifier hs-var">E.QueryRelay</span></a></span><span>
</span><span id="line-612"></span><span>
</span><span id="line-613"></span><span class="annot"><a href="Hasura.Server.App.html#gqlExplainHandler"><span class="hs-identifier hs-type">gqlExplainHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-614"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689329622"><span class="annot"><a href="#local-6989586621689329622"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-615"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329622"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-616"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329622"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-617"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329622"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-618"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329622"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-619"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MetadataStorageT"><span class="hs-identifier hs-type">MetadataStorageT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329622"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-620"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Backend.html#MonadQueryTags"><span class="hs-identifier hs-type">EB.MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329622"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-621"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-622"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Explain.html#GQLExplain"><span class="hs-identifier hs-type">GE.GQLExplain</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-623"></span><span>  </span><span class="annot"><a href="#local-6989586621689329622"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-624"></span><span id="gqlExplainHandler"><span class="annot"><span class="annottext">gqlExplainHandler :: GQLExplain -&gt; m (HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#gqlExplainHandler"><span class="hs-identifier hs-var hs-var">gqlExplainHandler</span></a></span></span><span> </span><span id="local-6989586621689329195"><span class="annot"><span class="annottext">GQLExplain
</span><a href="#local-6989586621689329195"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-625"></span><span>  </span><span class="annot"><span class="annottext">m ()
forall (m :: * -&gt; *).
(MonadError QErr m, MonadReader HandlerCtx m) =&gt;
m ()
</span><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-var">onlyAdmin</span></a></span><span>
</span><span id="line-626"></span><span>  </span><span id="local-6989586621689329194"><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329194"><span class="hs-identifier hs-var">scRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; SchemaCacheRef) -&gt; m SchemaCacheRef
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; SchemaCacheRef
</span><a href="Hasura.Server.App.html#scCacheRef"><span class="hs-identifier hs-var hs-var">scCacheRef</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; SchemaCacheRef)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; SchemaCacheRef
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>  </span><span id="local-6989586621689329193"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621689329193"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SchemaCache -&gt; m SchemaCache
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO SchemaCache -&gt; m SchemaCache)
-&gt; IO SchemaCache -&gt; m SchemaCache
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef -&gt; IO SchemaCache
</span><a href="Hasura.Server.SchemaCacheRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329194"><span class="hs-identifier hs-var">scRef</span></a></span><span>
</span><span id="line-628"></span><span>  </span><span id="local-6989586621689329192"><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621689329192"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; GQLExplain -&gt; m EncJSON
forall (m :: * -&gt; *).
(MonadError QErr m, MonadIO m, MonadBaseControl IO m,
 MonadMetadataStorage (MetadataStorageT m), MonadQueryTags m) =&gt;
SchemaCache -&gt; GQLExplain -&gt; m EncJSON
</span><a href="Hasura.GraphQL.Explain.html#explainGQLQuery"><span class="hs-identifier hs-var">GE.explainGQLQuery</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621689329193"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">GQLExplain
</span><a href="#local-6989586621689329195"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-629"></span><span>  </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; m (HttpResponse EncJSON)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; m (HttpResponse EncJSON))
-&gt; HttpResponse EncJSON -&gt; m (HttpResponse EncJSON)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621689329192"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-630"></span><span>
</span><span id="line-631"></span><span id="local-6989586621689329644"><span class="annot"><a href="Hasura.Server.App.html#v1Alpha1PGDumpHandler"><span class="hs-identifier hs-type">v1Alpha1PGDumpHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329644"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329644"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329644"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.API.PGDump.html#PGDumpReqBody"><span class="hs-identifier hs-type">PGD.PGDumpReqBody</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689329644"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-type">APIResp</span></a></span></span><span>
</span><span id="line-632"></span><span id="v1Alpha1PGDumpHandler"><span class="annot"><span class="annottext">v1Alpha1PGDumpHandler :: PGDumpReqBody -&gt; m APIResp
</span><a href="Hasura.Server.App.html#v1Alpha1PGDumpHandler"><span class="hs-identifier hs-var hs-var">v1Alpha1PGDumpHandler</span></a></span></span><span> </span><span id="local-6989586621689329189"><span class="annot"><span class="annottext">PGDumpReqBody
</span><a href="#local-6989586621689329189"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-633"></span><span>  </span><span class="annot"><span class="annottext">m ()
forall (m :: * -&gt; *).
(MonadError QErr m, MonadReader HandlerCtx m) =&gt;
m ()
</span><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-var">onlyAdmin</span></a></span><span>
</span><span id="line-634"></span><span>  </span><span id="local-6989586621689329188"><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329188"><span class="hs-identifier hs-var">scRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; SchemaCacheRef) -&gt; m SchemaCacheRef
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; SchemaCacheRef
</span><a href="Hasura.Server.App.html#scCacheRef"><span class="hs-identifier hs-var hs-var">scCacheRef</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; SchemaCacheRef)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; SchemaCacheRef
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-635"></span><span>  </span><span id="local-6989586621689329187"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621689329187"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SchemaCache -&gt; m SchemaCache
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO SchemaCache -&gt; m SchemaCache)
-&gt; IO SchemaCache -&gt; m SchemaCache
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef -&gt; IO SchemaCache
</span><a href="Hasura.Server.SchemaCacheRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329188"><span class="hs-identifier hs-var">scRef</span></a></span><span>
</span><span id="line-636"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689329186"><span class="annot"><span class="annottext">sources :: SourceCache
</span><a href="#local-6989586621689329186"><span class="hs-identifier hs-var hs-var">sources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; SourceCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#scSources"><span class="hs-identifier hs-var hs-var">scSources</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621689329187"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-637"></span><span>      </span><span id="local-6989586621689329184"><span class="annot"><span class="annottext">sourceName :: SourceName
</span><a href="#local-6989586621689329184"><span class="hs-identifier hs-var hs-var">sourceName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PGDumpReqBody -&gt; SourceName
</span><a href="Hasura.Server.API.PGDump.html#prbSource"><span class="hs-identifier hs-var hs-var">PGD.prbSource</span></a></span><span> </span><span class="annot"><span class="annottext">PGDumpReqBody
</span><a href="#local-6989586621689329189"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-638"></span><span>      </span><span id="local-6989586621689329182"><span class="annot"><span class="annottext">sourceConfig :: Maybe PGSourceConfig
</span><a href="#local-6989586621689329182"><span class="hs-identifier hs-var hs-var">sourceConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasTag ('Postgres 'Vanilla) =&gt;
BackendSourceInfo -&gt; Maybe (SourceConfig ('Postgres 'Vanilla))
forall (b :: BackendType).
HasTag b =&gt;
BackendSourceInfo -&gt; Maybe (SourceConfig b)
</span><a href="Hasura.RQL.Types.Source.html#unsafeSourceConfiguration"><span class="hs-identifier hs-var">unsafeSourceConfiguration</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Vanilla"><span class="hs-identifier hs-type">Vanilla</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BackendSourceInfo -&gt; Maybe PGSourceConfig)
-&gt; Maybe BackendSourceInfo -&gt; Maybe PGSourceConfig
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; SourceCache -&gt; Maybe BackendSourceInfo
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689329184"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceCache
</span><a href="#local-6989586621689329186"><span class="hs-identifier hs-var">sources</span></a></span><span>
</span><span id="line-639"></span><span>  </span><span id="local-6989586621689329179"><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621689329179"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-640"></span><span>    </span><span class="annot"><span class="annottext">(PGSourceConfig -&gt; ConnInfo)
-&gt; Maybe PGSourceConfig -&gt; Maybe ConnInfo
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">PGSourceConfig -&gt; ConnInfo
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#_pscConnInfo"><span class="hs-identifier hs-var hs-var">_pscConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PGSourceConfig
</span><a href="#local-6989586621689329182"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span>
</span><span id="line-641"></span><span>      </span><span class="annot"><span class="annottext">Maybe ConnInfo -&gt; m ConnInfo -&gt; m ConnInfo
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="Hasura.Prelude.html#onNothing"><span class="hs-operator hs-var">`onNothing`</span></a></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m ConnInfo
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#NotFound"><span class="hs-identifier hs-var">NotFound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;source &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621689329184"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; not found&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-642"></span><span>  </span><span id="local-6989586621689329175"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329175"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PGDumpReqBody -&gt; ConnInfo -&gt; m ByteString
forall (m :: * -&gt; *).
(MonadError QErr m, MonadIO m) =&gt;
PGDumpReqBody -&gt; ConnInfo -&gt; m ByteString
</span><a href="Hasura.Server.API.PGDump.html#execPGDump"><span class="hs-identifier hs-var">PGD.execPGDump</span></a></span><span> </span><span class="annot"><span class="annottext">PGDumpReqBody
</span><a href="#local-6989586621689329189"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621689329179"><span class="hs-identifier hs-var">ci</span></a></span><span>
</span><span id="line-643"></span><span>  </span><span class="annot"><span class="annottext">APIResp -&gt; m APIResp
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(APIResp -&gt; m APIResp) -&gt; APIResp -&gt; m APIResp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HttpResponse ByteString -&gt; APIResp
</span><a href="Hasura.Server.App.html#RawResp"><span class="hs-identifier hs-var">RawResp</span></a></span><span> </span><span class="annot"><span class="annottext">(HttpResponse ByteString -&gt; APIResp)
-&gt; HttpResponse ByteString -&gt; APIResp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [Header] -&gt; HttpResponse ByteString
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329175"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Header
</span><a href="Hasura.Server.Utils.html#sqlHeader"><span class="hs-identifier hs-var">sqlHeader</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-644"></span><span>
</span><span id="line-645"></span><span id="local-6989586621689329619"><span class="annot"><a href="Hasura.Server.App.html#consoleAssetsHandler"><span class="hs-identifier hs-type">consoleAssetsHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-646"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329619"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329619"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-647"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">L.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">L.Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-648"></span><span>  </span><span class="annot"><a href="Hasura.Server.Logging.html#LoggingSettings"><span class="hs-identifier hs-type">LoggingSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-649"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-650"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-651"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Spock.ActionT</span></span><span> </span><span class="annot"><a href="#local-6989586621689329619"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-652"></span><span id="consoleAssetsHandler"><span class="annot"><span class="annottext">consoleAssetsHandler :: Logger Hasura -&gt; LoggingSettings -&gt; Text -&gt; String -&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#consoleAssetsHandler"><span class="hs-identifier hs-var hs-var">consoleAssetsHandler</span></a></span></span><span> </span><span id="local-6989586621689329170"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329170"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621689329169"><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621689329169"><span class="hs-identifier hs-var">loggingSettings</span></a></span></span><span> </span><span id="local-6989586621689329168"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689329168"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span id="local-6989586621689329167"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621689329167"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-653"></span><span>  </span><span id="local-6989586621689329166"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689329166"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m Request
forall (m :: * -&gt; *) ctx. MonadIO m =&gt; ActionCtxT ctx m Request
</span><span class="hs-identifier hs-var">Spock.request</span></span><span>
</span><span id="line-654"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689329165"><span class="annot"><span class="annottext">reqHeaders :: [Header]
</span><a href="#local-6989586621689329165"><span class="hs-identifier hs-var hs-var">reqHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request -&gt; [Header]
</span><span class="hs-identifier hs-var hs-var">Wai.requestHeaders</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689329166"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-655"></span><span>  </span><span class="hs-comment">-- '..' in paths need not be handed as it is resolved in the url by</span><span>
</span><span id="line-656"></span><span>  </span><span class="hs-comment">-- spock's routing. we get the expanded path.</span><span>
</span><span id="line-657"></span><span>  </span><span id="local-6989586621689329164"><span class="annot"><span class="annottext">Either IOException ByteString
</span><a href="#local-6989586621689329164"><span class="hs-identifier hs-var">eFileContents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-658"></span><span>    </span><span class="annot"><span class="annottext">IO (Either IOException ByteString)
-&gt; ActionCtxT () m (Either IOException ByteString)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either IOException ByteString)
 -&gt; ActionCtxT () m (Either IOException ByteString))
-&gt; IO (Either IOException ByteString)
-&gt; ActionCtxT () m (Either IOException ByteString)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-659"></span><span>      </span><span class="annot"><span class="annottext">IO ByteString -&gt; IO (Either IOException ByteString)
forall e a. Exception e =&gt; IO a -&gt; IO (Either e a)
</span><span class="hs-identifier hs-var">try</span></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; IO (Either IOException ByteString))
-&gt; IO ByteString -&gt; IO (Either IOException ByteString)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-660"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO ByteString
</span><span class="hs-identifier hs-var">BL.readFile</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ByteString) -&gt; String -&gt; IO ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-661"></span><span>          </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">joinPath</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689329168"><span class="hs-identifier hs-var">dir</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621689329167"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-662"></span><span>  </span><span class="annot"><span class="annottext">(IOException -&gt; ActionT m ())
-&gt; (ByteString -&gt; ActionT m ())
-&gt; Either IOException ByteString
-&gt; ActionT m ()
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Header] -&gt; IOException -&gt; ActionT m ()
forall (m :: * -&gt; *).
(MonadIO m, HttpLog m) =&gt;
[Header] -&gt; IOException -&gt; ActionT m ()
</span><a href="#local-6989586621689329160"><span class="hs-identifier hs-var">onError</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329165"><span class="hs-identifier hs-var">reqHeaders</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ActionT m ()
</span><a href="#local-6989586621689329159"><span class="hs-identifier hs-var">onSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">Either IOException ByteString
</span><a href="#local-6989586621689329164"><span class="hs-identifier hs-var">eFileContents</span></a></span><span>
</span><span id="line-663"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-664"></span><span>    </span><span id="local-6989586621689329159"><span class="annot"><span class="annottext">onSuccess :: ByteString -&gt; ActionT m ()
</span><a href="#local-6989586621689329159"><span class="hs-identifier hs-var hs-var">onSuccess</span></a></span></span><span> </span><span id="local-6989586621689329158"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329158"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-665"></span><span>      </span><span class="annot"><span class="annottext">(Header -&gt; ActionT m ()) -&gt; [Header] -&gt; ActionT m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Header -&gt; ActionT m ()
forall (m :: * -&gt; *). MonadIO m =&gt; Header -&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#setHeader"><span class="hs-identifier hs-var">setHeader</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329157"><span class="hs-identifier hs-var">headers</span></a></span><span>
</span><span id="line-666"></span><span>      </span><span class="annot"><span class="annottext">ByteString -&gt; ActionT m ()
forall (m :: * -&gt; *) ctx a.
MonadIO m =&gt;
ByteString -&gt; ActionCtxT ctx m a
</span><span class="hs-identifier hs-var">Spock.lazyBytes</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329158"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-667"></span><span>    </span><span id="local-6989586621689329789"><span class="annot"><a href="#local-6989586621689329160"><span class="hs-identifier hs-type">onError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329789"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329789"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HTTP.Header</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IOException</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spock.ActionT</span></span><span> </span><span class="annot"><a href="#local-6989586621689329789"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-668"></span><span>    </span><span id="local-6989586621689329160"><span class="annot"><span class="annottext">onError :: [Header] -&gt; IOException -&gt; ActionT m ()
</span><a href="#local-6989586621689329160"><span class="hs-identifier hs-var hs-var">onError</span></a></span></span><span> </span><span id="local-6989586621689329156"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329156"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; LoggingSettings -&gt; [Header] -&gt; QErr -&gt; ActionT m ()
forall (m :: * -&gt; *).
(MonadIO m, HttpLog m) =&gt;
Logger Hasura
-&gt; LoggingSettings -&gt; [Header] -&gt; QErr -&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#raiseGenericApiError"><span class="hs-identifier hs-var">raiseGenericApiError</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329170"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621689329169"><span class="hs-identifier hs-var">loggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329156"><span class="hs-identifier hs-var">hdrs</span></a></span><span> </span><span class="annot"><span class="annottext">(QErr -&gt; ActionT m ())
-&gt; (IOException -&gt; QErr) -&gt; IOException -&gt; ActionT m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; QErr
</span><a href="Hasura.Base.Error.html#err404"><span class="hs-identifier hs-var">err404</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#NotFound"><span class="hs-identifier hs-var">NotFound</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; QErr) -&gt; (IOException -&gt; Text) -&gt; IOException -&gt; QErr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IOException -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><a href="Hasura.Prelude.html#tshow"><span class="hs-identifier hs-var">tshow</span></a></span><span>
</span><span id="line-669"></span><span>    </span><span id="local-6989586621689329152"><span class="annot"><span class="annottext">fn :: Text
</span><a href="#local-6989586621689329152"><span class="hs-identifier hs-var hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; String -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><span class="hs-identifier hs-var">takeFileName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621689329167"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-670"></span><span>    </span><span class="hs-comment">-- set gzip header if the filename ends with .gz</span><span>
</span><span id="line-671"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621689329151"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689329151"><span class="hs-identifier hs-var">fileName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329150"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329150"><span class="hs-identifier hs-var">encHeader</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Maybe Text
</span><span class="hs-identifier hs-var">T.stripSuffix</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.gz&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689329152"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-672"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621689329148"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689329148"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689329148"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Header
</span><a href="Hasura.Server.Utils.html#gzipHeader"><span class="hs-identifier hs-var">gzipHeader</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-673"></span><span>      </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689329152"><span class="hs-identifier hs-var">fn</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>    </span><span id="local-6989586621689329146"><span class="annot"><span class="annottext">mimeType :: ByteString
</span><a href="#local-6989586621689329146"><span class="hs-identifier hs-var hs-var">mimeType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><span class="hs-identifier hs-var">defaultMimeLookup</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689329151"><span class="hs-identifier hs-var">fileName</span></a></span><span>
</span><span id="line-675"></span><span>    </span><span id="local-6989586621689329157"><span class="annot"><span class="annottext">headers :: [Header]
</span><a href="#local-6989586621689329157"><span class="hs-identifier hs-var hs-var">headers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Content-Type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689329146"><span class="hs-identifier hs-var">mimeType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Header -&gt; [Header] -&gt; [Header]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689329150"><span class="hs-identifier hs-var">encHeader</span></a></span><span>
</span><span id="line-676"></span><span>
</span><span id="line-677"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621689329783"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="ConsoleRenderer"><span class="annot"><a href="Hasura.Server.App.html#ConsoleRenderer"><span class="hs-identifier hs-var">ConsoleRenderer</span></a></span></span><span> </span><span id="local-6989586621689329783"><span class="annot"><a href="#local-6989586621689329783"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-678"></span><span>  </span><span id="renderConsole"><span class="annot"><a href="Hasura.Server.App.html#renderConsole"><span class="hs-identifier hs-type">renderConsole</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Auth.html#AuthMode"><span class="hs-identifier hs-type">AuthMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689329783"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span id="local-6989586621689329144"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleRenderer"><span class="hs-identifier hs-type">ConsoleRenderer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329144"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleRenderer"><span class="hs-identifier hs-type">ConsoleRenderer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.html#TraceT"><span class="hs-identifier hs-type">Tracing.TraceT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329144"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-681"></span><span>  </span><span id="local-6989586621689329140"><span class="annot"><span class="annottext">renderConsole :: Text
-&gt; AuthMode -&gt; Bool -&gt; Maybe Text -&gt; TraceT m (Either String Text)
</span><a href="#local-6989586621689329140"><span class="hs-identifier hs-var hs-var hs-var hs-var">renderConsole</span></a></span></span><span> </span><span id="local-6989586621689329139"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689329139"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621689329138"><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621689329138"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621689329137"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329137"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621689329136"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689329136"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either String Text) -&gt; TraceT m (Either String Text)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either String Text) -&gt; TraceT m (Either String Text))
-&gt; m (Either String Text) -&gt; TraceT m (Either String Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; AuthMode -&gt; Bool -&gt; Maybe Text -&gt; m (Either String Text)
forall (m :: * -&gt; *).
ConsoleRenderer m =&gt;
Text -&gt; AuthMode -&gt; Bool -&gt; Maybe Text -&gt; m (Either String Text)
</span><a href="Hasura.Server.App.html#renderConsole"><span class="hs-identifier hs-var">renderConsole</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689329139"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621689329138"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329137"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689329136"><span class="hs-identifier hs-var">d</span></a></span></span><span>
</span><span id="line-682"></span><span>
</span><span id="line-683"></span><span class="annot"><a href="Hasura.Server.App.html#renderHtmlTemplate"><span class="hs-identifier hs-type">renderHtmlTemplate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Template</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-684"></span><span id="renderHtmlTemplate"><span class="annot"><span class="annottext">renderHtmlTemplate :: Template -&gt; Value -&gt; Either String Text
</span><a href="Hasura.Server.App.html#renderHtmlTemplate"><span class="hs-identifier hs-var hs-var">renderHtmlTemplate</span></a></span></span><span> </span><span id="local-6989586621689329135"><span class="annot"><span class="annottext">Template
</span><a href="#local-6989586621689329135"><span class="hs-identifier hs-var">template</span></a></span></span><span> </span><span id="local-6989586621689329134"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689329134"><span class="hs-identifier hs-var">jVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-685"></span><span>  </span><span class="annot"><span class="annottext">Either String Text
-&gt; Either String Text -&gt; Bool -&gt; Either String Text
forall a. a -&gt; a -&gt; Bool -&gt; a
</span><span class="hs-identifier hs-var">bool</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Either String Text
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621689329133"><span class="hs-identifier hs-var">errMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Either String Text
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689329132"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Either String Text) -&gt; Bool -&gt; Either String Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SubstitutionError] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[SubstitutionError]
</span><a href="#local-6989586621689329130"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-686"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-687"></span><span>    </span><span id="local-6989586621689329133"><span class="annot"><span class="annottext">errMsg :: String
</span><a href="#local-6989586621689329133"><span class="hs-identifier hs-var hs-var">errMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;template rendering failed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[SubstitutionError] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[SubstitutionError]
</span><a href="#local-6989586621689329130"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-688"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621689329130"><span class="annot"><span class="annottext">[SubstitutionError]
</span><a href="#local-6989586621689329130"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689329132"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689329132"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Template -&gt; Value -&gt; ([SubstitutionError], Text)
forall k.
ToMustache k =&gt;
Template -&gt; k -&gt; ([SubstitutionError], Text)
</span><span class="hs-identifier hs-var">M.checkedSubstitute</span></span><span> </span><span class="annot"><span class="annottext">Template
</span><a href="#local-6989586621689329135"><span class="hs-identifier hs-var">template</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689329134"><span class="hs-identifier hs-var">jVal</span></a></span><span>
</span><span id="line-689"></span><span>
</span><span id="line-690"></span><span class="hs-comment">-- | Default implementation of the 'MonadConfigApiHandler'</span><span>
</span><span id="line-691"></span><span class="annot"><a href="Hasura.Server.App.html#configApiGetHandler"><span class="hs-identifier hs-type">configApiGetHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-692"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689329127"><span class="annot"><a href="#local-6989586621689329127"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-693"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Auth.html#UserAuthentication"><span class="hs-identifier hs-type">UserAuthentication</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.html#TraceT"><span class="hs-identifier hs-type">Tracing.TraceT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Tracing.html#HasReporter"><span class="hs-identifier hs-type">Tracing.HasReporter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-694"></span><span>  </span><span class="annot"><a href="Hasura.Server.App.html#ServerCtx"><span class="hs-identifier hs-type">ServerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-695"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-696"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Spock.SpockCtxT</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689329127"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-697"></span><span id="configApiGetHandler"><span class="annot"><span class="annottext">configApiGetHandler :: ServerCtx -&gt; Maybe Text -&gt; SpockCtxT () m ()
</span><a href="Hasura.Server.App.html#configApiGetHandler"><span class="hs-identifier hs-var hs-var">configApiGetHandler</span></a></span></span><span> </span><span id="local-6989586621689329126"><span class="annot"><span class="annottext">serverCtx :: ServerCtx
</span><a href="#local-6989586621689329126"><span class="hs-identifier hs-var">serverCtx</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.Server.App.html#ServerCtx"><span class="hs-identifier hs-type">ServerCtx</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621689329106"><span id="local-6989586621689329107"><span id="local-6989586621689329108"><span id="local-6989586621689329109"><span id="local-6989586621689329110"><span id="local-6989586621689329111"><span id="local-6989586621689329112"><span id="local-6989586621689329113"><span id="local-6989586621689329114"><span id="local-6989586621689329115"><span id="local-6989586621689329116"><span id="local-6989586621689329117"><span id="local-6989586621689329118"><span id="local-6989586621689329119"><span id="local-6989586621689329120"><span id="local-6989586621689329121"><span id="local-6989586621689329122"><span id="local-6989586621689329123"><span id="local-6989586621689329124"><span id="local-6989586621689329125"><span class="annot"><span class="annottext">Bool
Maybe NamingCase
HashSet ExperimentalFeature
HashSet API
Logger Hasura
RemoteSchemaPermissions
InferFunctionPermissions
Environment
Store EmptyMetrics
Manager
SQLGenCtx
EventingMode
ReadOnlyMode
MaintenanceMode ()
InstanceId
LoggingSettings
SchemaCacheRef
AuthMode
ResponseInternalErrorsConfig
SubscriptionsState
scDefaultNamingConvention :: Maybe NamingCase
scEnableReadOnlyMode :: ReadOnlyMode
scEventingMode :: EventingMode
scLoggingSettings :: LoggingSettings
scExperimentalFeatures :: HashSet ExperimentalFeature
scEnableMaintenanceMode :: MaintenanceMode ()
scFunctionPermsCtx :: InferFunctionPermissions
scRemoteSchemaPermsCtx :: RemoteSchemaPermissions
scEnvironment :: Environment
scResponseInternalErrorsConfig :: ResponseInternalErrorsConfig
scEkgStore :: Store EmptyMetrics
scEnableAllowlist :: Bool
scSubscriptionState :: SubscriptionsState
scInstanceId :: InstanceId
scEnabledAPIs :: HashSet API
scSQLGenCtx :: SQLGenCtx
scManager :: Manager
scAuthMode :: AuthMode
scCacheRef :: SchemaCacheRef
scLogger :: Logger Hasura
scDefaultNamingConvention :: ServerCtx -&gt; Maybe NamingCase
scEnableReadOnlyMode :: ServerCtx -&gt; ReadOnlyMode
scEventingMode :: ServerCtx -&gt; EventingMode
scExperimentalFeatures :: ServerCtx -&gt; HashSet ExperimentalFeature
scEnableMaintenanceMode :: ServerCtx -&gt; MaintenanceMode ()
scFunctionPermsCtx :: ServerCtx -&gt; InferFunctionPermissions
scRemoteSchemaPermsCtx :: ServerCtx -&gt; RemoteSchemaPermissions
scEnvironment :: ServerCtx -&gt; Environment
scResponseInternalErrorsConfig :: ServerCtx -&gt; ResponseInternalErrorsConfig
scEkgStore :: ServerCtx -&gt; Store EmptyMetrics
scEnableAllowlist :: ServerCtx -&gt; Bool
scSubscriptionState :: ServerCtx -&gt; SubscriptionsState
scInstanceId :: ServerCtx -&gt; InstanceId
scEnabledAPIs :: ServerCtx -&gt; HashSet API
scSQLGenCtx :: ServerCtx -&gt; SQLGenCtx
scAuthMode :: ServerCtx -&gt; AuthMode
scCacheRef :: ServerCtx -&gt; SchemaCacheRef
scLogger :: ServerCtx -&gt; Logger Hasura
scLoggingSettings :: ServerCtx -&gt; LoggingSettings
scManager :: ServerCtx -&gt; Manager
</span><a href="#local-6989586621689329106"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621689329105"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689329105"><span class="hs-identifier hs-var">consoleAssetsDir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-698"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockCtxT () m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.get</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v1alpha1/config&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockCtxT () m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-699"></span><span>    </span><span class="annot"><span class="annottext">ServerCtx
-&gt; (Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr)
-&gt; APIHandler (TraceT m) ()
-&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) a.
(MonadIO m, MonadBaseControl IO m, FromJSON a,
 UserAuthentication (TraceT m), HttpLog m, HasReporter m,
 HasResourceLimits m) =&gt;
ServerCtx
-&gt; (Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr)
-&gt; APIHandler (TraceT m) a
-&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#mkSpockAction"><span class="hs-identifier hs-var">mkSpockAction</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329126"><span class="hs-identifier hs-var">serverCtx</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Value
</span><a href="Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(APIHandler (TraceT m) () -&gt; ActionCtxT () m ())
-&gt; APIHandler (TraceT m) () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-700"></span><span>      </span><span class="annot"><span class="annottext">Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
-&gt; APIHandler (TraceT m) ()
forall (m :: * -&gt; *).
Handler m (HttpLogMetadata m, APIResp) -&gt; APIHandler m ()
</span><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier hs-var">mkGetHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
 -&gt; APIHandler (TraceT m) ())
-&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
-&gt; APIHandler (TraceT m) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-701"></span><span>        </span><span class="annot"><span class="annottext">ReaderT HandlerCtx (MetadataStorageT (TraceT m)) ()
forall (m :: * -&gt; *).
(MonadError QErr m, MonadReader HandlerCtx m) =&gt;
m ()
</span><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-var">onlyAdmin</span></a></span><span>
</span><span id="line-702"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689329101"><span class="annot"><span class="annottext">res :: ServerConfig
</span><a href="#local-6989586621689329101"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-703"></span><span>              </span><span class="annot"><span class="annottext">InferFunctionPermissions
-&gt; RemoteSchemaPermissions
-&gt; AuthMode
-&gt; Bool
-&gt; LiveQueriesOptions
-&gt; LiveQueriesOptions
-&gt; Maybe Text
-&gt; HashSet ExperimentalFeature
-&gt; ServerConfig
</span><a href="Hasura.Server.API.Config.html#runGetConfig"><span class="hs-identifier hs-var">runGetConfig</span></a></span><span>
</span><span id="line-704"></span><span>                </span><span class="annot"><span class="annottext">InferFunctionPermissions
</span><a href="#local-6989586621689329112"><span class="hs-identifier hs-var">scFunctionPermsCtx</span></a></span><span>
</span><span id="line-705"></span><span>                </span><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621689329113"><span class="hs-identifier hs-var">scRemoteSchemaPermsCtx</span></a></span><span>
</span><span id="line-706"></span><span>                </span><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621689329123"><span class="hs-identifier hs-var">scAuthMode</span></a></span><span>
</span><span id="line-707"></span><span>                </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329117"><span class="hs-identifier hs-var">scEnableAllowlist</span></a></span><span>
</span><span id="line-708"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubscriptionsState -&gt; LiveQueriesOptions
</span><a href="Hasura.GraphQL.Execute.Subscription.State.html#_ssLiveQueryOptions"><span class="hs-identifier hs-var hs-var">ES._ssLiveQueryOptions</span></a></span><span> </span><span class="annot"><span class="annottext">(SubscriptionsState -&gt; LiveQueriesOptions)
-&gt; SubscriptionsState -&gt; LiveQueriesOptions
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SubscriptionsState
</span><a href="#local-6989586621689329118"><span class="hs-identifier hs-var">scSubscriptionState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-709"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubscriptionsState -&gt; LiveQueriesOptions
</span><a href="Hasura.GraphQL.Execute.Subscription.State.html#_ssStreamQueryOptions"><span class="hs-identifier hs-var hs-var">ES._ssStreamQueryOptions</span></a></span><span> </span><span class="annot"><span class="annottext">(SubscriptionsState -&gt; LiveQueriesOptions)
-&gt; SubscriptionsState -&gt; LiveQueriesOptions
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SubscriptionsState
</span><a href="#local-6989586621689329118"><span class="hs-identifier hs-var">scSubscriptionState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span>                </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689329105"><span class="hs-identifier hs-var">consoleAssetsDir</span></a></span><span>
</span><span id="line-711"></span><span>                </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621689329110"><span class="hs-identifier hs-var">scExperimentalFeatures</span></a></span><span>
</span><span id="line-712"></span><span>        </span><span class="annot"><span class="annottext">((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
-&gt; ReaderT
     HandlerCtx
     (MetadataStorageT (TraceT m))
     ((CommonHttpLogMetadata, ExtraHttpLogMetadata m), APIResp)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLog m =&gt; (CommonHttpLogMetadata, ExtraHttpLogMetadata m)
forall (m :: * -&gt; *). HttpLog m =&gt; HttpLogMetadata m
</span><a href="Hasura.Server.Logging.html#emptyHttpLogMetadata"><span class="hs-identifier hs-var">emptyHttpLogMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689329127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; APIResp
</span><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; APIResp)
-&gt; HttpResponse EncJSON -&gt; APIResp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerConfig -&gt; EncJSON
forall a. ToJSON a =&gt; a -&gt; EncJSON
</span><a href="Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-var">encJFromJValue</span></a></span><span> </span><span class="annot"><span class="annottext">ServerConfig
</span><a href="#local-6989586621689329101"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-713"></span><span>
</span><span id="line-714"></span><span class="hs-keyword">data</span><span> </span><span id="HasuraApp"><span class="annot"><a href="Hasura.Server.App.html#HasuraApp"><span class="hs-identifier hs-var">HasuraApp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HasuraApp"><span class="annot"><a href="Hasura.Server.App.html#HasuraApp"><span class="hs-identifier hs-var">HasuraApp</span></a></span></span><span>
</span><span id="line-715"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_hapApplication"><span class="annot"><span class="annottext">HasuraApp -&gt; Application
</span><a href="Hasura.Server.App.html#_hapApplication"><span class="hs-identifier hs-var hs-var">_hapApplication</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Wai.Application</span></span><span class="hs-special">,</span><span>
</span><span id="line-716"></span><span>    </span><span id="_hapSchemaRef"><span class="annot"><span class="annottext">HasuraApp -&gt; SchemaCacheRef
</span><a href="Hasura.Server.App.html#_hapSchemaRef"><span class="hs-identifier hs-var hs-var">_hapSchemaRef</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.Server.SchemaCacheRef.html#SchemaCacheRef"><span class="hs-identifier hs-type">SchemaCacheRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-717"></span><span>    </span><span id="_hapAsyncActionSubscriptionState"><span class="annot"><span class="annottext">HasuraApp -&gt; AsyncActionSubscriptionState
</span><a href="Hasura.Server.App.html#_hapAsyncActionSubscriptionState"><span class="hs-identifier hs-var hs-var">_hapAsyncActionSubscriptionState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.State.html#AsyncActionSubscriptionState"><span class="hs-identifier hs-type">ES.AsyncActionSubscriptionState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-718"></span><span>    </span><span id="_hapShutdownWsServer"><span class="annot"><span class="annottext">HasuraApp -&gt; IO ()
</span><a href="Hasura.Server.App.html#_hapShutdownWsServer"><span class="hs-identifier hs-var hs-var">_hapShutdownWsServer</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-719"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-720"></span><span>
</span><span id="line-721"></span><span class="hs-comment">-- TODO: Put Env into ServerCtx?</span><span>
</span><span id="line-722"></span><span>
</span><span id="line-723"></span><span class="annot"><a href="Hasura.Server.App.html#mkWaiApp"><span class="hs-identifier hs-type">mkWaiApp</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-724"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689329092"><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-725"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-726"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadFix</span></span><span> </span><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-727"></span><span>    </span><span class="annot"><a href="Control.Monad.Stateless.html#MonadStateless"><span class="hs-identifier hs-type">MonadStateless</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-728"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">LA.Forall</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LA.Pure</span></span><span> </span><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-729"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleRenderer"><span class="hs-identifier hs-type">ConsoleRenderer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-730"></span><span>    </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-731"></span><span>    </span><span class="annot"><a href="Hasura.Server.Auth.html#UserAuthentication"><span class="hs-identifier hs-type">UserAuthentication</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.html#TraceT"><span class="hs-identifier hs-type">Tracing.TraceT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-732"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-733"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier hs-type">E.MonadGQLExecutionCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-734"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadConfigApiHandler"><span class="hs-identifier hs-type">MonadConfigApiHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-735"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.html#MonadQueryLog"><span class="hs-identifier hs-type">MonadQueryLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-736"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#MonadWSLog"><span class="hs-identifier hs-type">WS.MonadWSLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-737"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.html#HasReporter"><span class="hs-identifier hs-type">Tracing.HasReporter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-738"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier hs-type">GH.MonadExecuteQuery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-739"></span><span>    </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-740"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MetadataStorageT"><span class="hs-identifier hs-type">MetadataStorageT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-741"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-742"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Backend.html#MonadQueryTags"><span class="hs-identifier hs-type">EB.MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-743"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-744"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.App.html#ServerCtx"><span class="hs-identifier hs-type">ServerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spock.SpockT</span></span><span> </span><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-745"></span><span>  </span><span class="hs-comment">-- | Set of environment variables for reference in UIs</span><span>
</span><span id="line-746"></span><span>  </span><span class="annot"><a href="Data.Environment.html#Environment"><span class="hs-identifier hs-type">Env.Environment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-747"></span><span>  </span><span class="hs-comment">-- | a 'L.Hasura' specific logger</span><span>
</span><span id="line-748"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">L.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">L.Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-749"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SQLGenCtx"><span class="hs-identifier hs-type">SQLGenCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-750"></span><span>  </span><span class="hs-comment">-- | is AllowList enabled - TODO: change this boolean to sumtype</span><span>
</span><span id="line-751"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-752"></span><span>  </span><span class="hs-comment">-- | HTTP manager so that we can re-use sessions</span><span>
</span><span id="line-753"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HTTP.Manager</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-754"></span><span>  </span><span class="hs-comment">-- | 'AuthMode' in which the application should operate in</span><span>
</span><span id="line-755"></span><span>  </span><span class="annot"><a href="Hasura.Server.Auth.html#AuthMode"><span class="hs-identifier hs-type">AuthMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-756"></span><span>  </span><span class="annot"><a href="Hasura.Server.Cors.html#CorsConfig"><span class="hs-identifier hs-type">CorsConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-757"></span><span>  </span><span class="hs-comment">-- | is console enabled - TODO: better type</span><span>
</span><span id="line-758"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-759"></span><span>  </span><span class="hs-comment">-- | filepath to the console static assets directory - TODO: better type</span><span>
</span><span id="line-760"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-761"></span><span>  </span><span class="hs-comment">-- | is telemetry enabled</span><span>
</span><span id="line-762"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-763"></span><span>  </span><span class="hs-comment">-- | each application, when run, gets an 'InstanceId'. this is used at various places including</span><span>
</span><span id="line-764"></span><span>  </span><span class="hs-comment">-- schema syncing and telemetry</span><span>
</span><span id="line-765"></span><span>  </span><span class="annot"><a href="Hasura.Server.Types.html#InstanceId"><span class="hs-identifier hs-type">InstanceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-766"></span><span>  </span><span class="hs-comment">-- | set of the enabled 'API's</span><span>
</span><span id="line-767"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">S.HashSet</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#API"><span class="hs-identifier hs-type">API</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-768"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.Options.html#LiveQueriesOptions"><span class="hs-identifier hs-type">ES.LiveQueriesOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-769"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.Options.html#StreamQueriesOptions"><span class="hs-identifier hs-type">ES.StreamQueriesOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-770"></span><span>  </span><span class="annot"><a href="Hasura.Server.Init.Config.html#ResponseInternalErrorsConfig"><span class="hs-identifier hs-type">ResponseInternalErrorsConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-771"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.Poll.Common.html#SubscriptionPostPollHook"><span class="hs-identifier hs-type">ES.SubscriptionPostPollHook</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-772"></span><span>  </span><span class="annot"><a href="Hasura.Server.SchemaCacheRef.html#SchemaCacheRef"><span class="hs-identifier hs-type">SchemaCacheRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-773"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">EKG.Store</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EKG.EmptyMetrics</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-774"></span><span>  </span><span class="annot"><a href="Hasura.Server.Metrics.html#ServerMetrics"><span class="hs-identifier hs-type">ServerMetrics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-775"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Schema.Options.html#RemoteSchemaPermissions"><span class="hs-identifier hs-type">Options.RemoteSchemaPermissions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-776"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Schema.Options.html#InferFunctionPermissions"><span class="hs-identifier hs-type">Options.InferFunctionPermissions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-777"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">WS.ConnectionOptions</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-778"></span><span>  </span><span class="annot"><a href="Hasura.Server.Init.Config.html#KeepAliveDelay"><span class="hs-identifier hs-type">KeepAliveDelay</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-779"></span><span>  </span><span class="annot"><a href="Hasura.Server.Types.html#MaintenanceMode"><span class="hs-identifier hs-type">MaintenanceMode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-780"></span><span>  </span><span class="annot"><a href="Hasura.Server.Types.html#EventingMode"><span class="hs-identifier hs-type">EventingMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-781"></span><span>  </span><span class="annot"><a href="Hasura.Server.Types.html#ReadOnlyMode"><span class="hs-identifier hs-type">ReadOnlyMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-782"></span><span>  </span><span class="hs-comment">-- | Set of the enabled experimental features</span><span>
</span><span id="line-783"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">S.HashSet</span></span><span> </span><span class="annot"><a href="Hasura.Server.Types.html#ExperimentalFeature"><span class="hs-identifier hs-type">ExperimentalFeature</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-784"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">S.HashSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#EngineLogType"><span class="hs-identifier hs-type">L.EngineLogType</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">L.Hasura</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-785"></span><span>  </span><span class="annot"><a href="Hasura.Server.Init.Config.html#WSConnectionInitTimeout"><span class="hs-identifier hs-type">WSConnectionInitTimeout</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-786"></span><span>  </span><span class="hs-comment">-- | is metadata query logging in http-log enabled</span><span>
</span><span id="line-787"></span><span>  </span><span class="annot"><a href="Hasura.Server.Logging.html#MetadataQueryLoggingMode"><span class="hs-identifier hs-type">MetadataQueryLoggingMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-788"></span><span>  </span><span class="hs-comment">-- | default naming convention</span><span>
</span><span id="line-789"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.NamingCase.html#NamingCase"><span class="hs-identifier hs-type">NamingCase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-790"></span><span>  </span><span class="annot"><a href="#local-6989586621689329092"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HasuraApp"><span class="hs-identifier hs-type">HasuraApp</span></a></span><span>
</span><span id="line-791"></span><span id="mkWaiApp"><span class="annot"><span class="annottext">mkWaiApp :: (ServerCtx -&gt; SpockT m ())
-&gt; Environment
-&gt; Logger Hasura
-&gt; SQLGenCtx
-&gt; Bool
-&gt; Manager
-&gt; AuthMode
-&gt; CorsConfig
-&gt; Bool
-&gt; Maybe Text
-&gt; Bool
-&gt; InstanceId
-&gt; HashSet API
-&gt; LiveQueriesOptions
-&gt; LiveQueriesOptions
-&gt; ResponseInternalErrorsConfig
-&gt; Maybe SubscriptionPostPollHook
-&gt; SchemaCacheRef
-&gt; Store EmptyMetrics
-&gt; ServerMetrics
-&gt; RemoteSchemaPermissions
-&gt; InferFunctionPermissions
-&gt; ConnectionOptions
-&gt; KeepAliveDelay
-&gt; MaintenanceMode ()
-&gt; EventingMode
-&gt; ReadOnlyMode
-&gt; HashSet ExperimentalFeature
-&gt; HashSet (EngineLogType Hasura)
-&gt; WSConnectionInitTimeout
-&gt; MetadataQueryLoggingMode
-&gt; Maybe NamingCase
-&gt; m HasuraApp
</span><a href="Hasura.Server.App.html#mkWaiApp"><span class="hs-identifier hs-var hs-var">mkWaiApp</span></a></span></span><span>
</span><span id="line-792"></span><span>  </span><span id="local-6989586621689329090"><span class="annot"><span class="annottext">ServerCtx -&gt; SpockT m ()
</span><a href="#local-6989586621689329090"><span class="hs-identifier hs-var">setupHook</span></a></span></span><span>
</span><span id="line-793"></span><span>  </span><span id="local-6989586621689329089"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621689329089"><span class="hs-identifier hs-var">env</span></a></span></span><span>
</span><span id="line-794"></span><span>  </span><span id="local-6989586621689329088"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329088"><span class="hs-identifier hs-var">logger</span></a></span></span><span>
</span><span id="line-795"></span><span>  </span><span id="local-6989586621689329087"><span class="annot"><span class="annottext">SQLGenCtx
</span><a href="#local-6989586621689329087"><span class="hs-identifier hs-var">sqlGenCtx</span></a></span></span><span>
</span><span id="line-796"></span><span>  </span><span id="local-6989586621689329086"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329086"><span class="hs-identifier hs-var">enableAL</span></a></span></span><span>
</span><span id="line-797"></span><span>  </span><span id="local-6989586621689329085"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621689329085"><span class="hs-identifier hs-var">httpManager</span></a></span></span><span>
</span><span id="line-798"></span><span>  </span><span id="local-6989586621689329084"><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621689329084"><span class="hs-identifier hs-var">mode</span></a></span></span><span>
</span><span id="line-799"></span><span>  </span><span id="local-6989586621689329083"><span class="annot"><span class="annottext">CorsConfig
</span><a href="#local-6989586621689329083"><span class="hs-identifier hs-var">corsCfg</span></a></span></span><span>
</span><span id="line-800"></span><span>  </span><span id="local-6989586621689329082"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329082"><span class="hs-identifier hs-var">enableConsole</span></a></span></span><span>
</span><span id="line-801"></span><span>  </span><span id="local-6989586621689329081"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689329081"><span class="hs-identifier hs-var">consoleAssetsDir</span></a></span></span><span>
</span><span id="line-802"></span><span>  </span><span id="local-6989586621689329080"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329080"><span class="hs-identifier hs-var">enableTelemetry</span></a></span></span><span>
</span><span id="line-803"></span><span>  </span><span id="local-6989586621689329079"><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621689329079"><span class="hs-identifier hs-var">instanceId</span></a></span></span><span>
</span><span id="line-804"></span><span>  </span><span id="local-6989586621689329078"><span class="annot"><span class="annottext">HashSet API
</span><a href="#local-6989586621689329078"><span class="hs-identifier hs-var">apis</span></a></span></span><span>
</span><span id="line-805"></span><span>  </span><span id="local-6989586621689329077"><span class="annot"><span class="annottext">LiveQueriesOptions
</span><a href="#local-6989586621689329077"><span class="hs-identifier hs-var">lqOpts</span></a></span></span><span>
</span><span id="line-806"></span><span>  </span><span id="local-6989586621689329076"><span class="annot"><span class="annottext">LiveQueriesOptions
</span><a href="#local-6989586621689329076"><span class="hs-identifier hs-var">streamQOpts</span></a></span></span><span>
</span><span id="line-807"></span><span>  </span><span id="local-6989586621689329075"><span class="annot"><span class="annottext">ResponseInternalErrorsConfig
</span><a href="#local-6989586621689329075"><span class="hs-identifier hs-var">responseErrorsConfig</span></a></span></span><span>
</span><span id="line-808"></span><span>  </span><span id="local-6989586621689329074"><span class="annot"><span class="annottext">Maybe SubscriptionPostPollHook
</span><a href="#local-6989586621689329074"><span class="hs-identifier hs-var">liveQueryHook</span></a></span></span><span>
</span><span id="line-809"></span><span>  </span><span id="local-6989586621689329073"><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329073"><span class="hs-identifier hs-var">schemaCacheRef</span></a></span></span><span>
</span><span id="line-810"></span><span>  </span><span id="local-6989586621689329072"><span class="annot"><span class="annottext">Store EmptyMetrics
</span><a href="#local-6989586621689329072"><span class="hs-identifier hs-var">ekgStore</span></a></span></span><span>
</span><span id="line-811"></span><span>  </span><span id="local-6989586621689329071"><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621689329071"><span class="hs-identifier hs-var">serverMetrics</span></a></span></span><span>
</span><span id="line-812"></span><span>  </span><span id="local-6989586621689329070"><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621689329070"><span class="hs-identifier hs-var">enableRSPermsCtx</span></a></span></span><span>
</span><span id="line-813"></span><span>  </span><span id="local-6989586621689329069"><span class="annot"><span class="annottext">InferFunctionPermissions
</span><a href="#local-6989586621689329069"><span class="hs-identifier hs-var">functionPermsCtx</span></a></span></span><span>
</span><span id="line-814"></span><span>  </span><span id="local-6989586621689329068"><span class="annot"><span class="annottext">ConnectionOptions
</span><a href="#local-6989586621689329068"><span class="hs-identifier hs-var">connectionOptions</span></a></span></span><span>
</span><span id="line-815"></span><span>  </span><span id="local-6989586621689329067"><span class="annot"><span class="annottext">KeepAliveDelay
</span><a href="#local-6989586621689329067"><span class="hs-identifier hs-var">keepAliveDelay</span></a></span></span><span>
</span><span id="line-816"></span><span>  </span><span id="local-6989586621689329066"><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621689329066"><span class="hs-identifier hs-var">maintenanceMode</span></a></span></span><span>
</span><span id="line-817"></span><span>  </span><span id="local-6989586621689329065"><span class="annot"><span class="annottext">EventingMode
</span><a href="#local-6989586621689329065"><span class="hs-identifier hs-var">eventingMode</span></a></span></span><span>
</span><span id="line-818"></span><span>  </span><span id="local-6989586621689329064"><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="#local-6989586621689329064"><span class="hs-identifier hs-var">readOnlyMode</span></a></span></span><span>
</span><span id="line-819"></span><span>  </span><span id="local-6989586621689329063"><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621689329063"><span class="hs-identifier hs-var">experimentalFeatures</span></a></span></span><span>
</span><span id="line-820"></span><span>  </span><span id="local-6989586621689329062"><span class="annot"><span class="annottext">HashSet (EngineLogType Hasura)
</span><a href="#local-6989586621689329062"><span class="hs-identifier hs-var">enabledLogTypes</span></a></span></span><span>
</span><span id="line-821"></span><span>  </span><span id="local-6989586621689329061"><span class="annot"><span class="annottext">WSConnectionInitTimeout
</span><a href="#local-6989586621689329061"><span class="hs-identifier hs-var">wsConnInitTimeout</span></a></span></span><span>
</span><span id="line-822"></span><span>  </span><span id="local-6989586621689329060"><span class="annot"><span class="annottext">MetadataQueryLoggingMode
</span><a href="#local-6989586621689329060"><span class="hs-identifier hs-var">enableMetadataQueryLogging</span></a></span></span><span>
</span><span id="line-823"></span><span>  </span><span id="local-6989586621689329059"><span class="annot"><span class="annottext">Maybe NamingCase
</span><a href="#local-6989586621689329059"><span class="hs-identifier hs-var">defaultNC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-824"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689329058"><span class="annot"><span class="annottext">getSchemaCache' :: IO (SchemaCache, SchemaCacheVer)
</span><a href="#local-6989586621689329058"><span class="hs-identifier hs-var hs-var">getSchemaCache'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RebuildableSchemaCache -&gt; SchemaCache)
-&gt; (RebuildableSchemaCache, SchemaCacheVer)
-&gt; (SchemaCache, SchemaCacheVer)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache -&gt; SchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#lastBuiltSchemaCache"><span class="hs-identifier hs-var hs-var">lastBuiltSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">((RebuildableSchemaCache, SchemaCacheVer)
 -&gt; (SchemaCache, SchemaCacheVer))
-&gt; IO (RebuildableSchemaCache, SchemaCacheVer)
-&gt; IO (SchemaCache, SchemaCacheVer)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef -&gt; IO (RebuildableSchemaCache, SchemaCacheVer)
</span><a href="Hasura.Server.SchemaCacheRef.html#readSchemaCacheRef"><span class="hs-identifier hs-var">readSchemaCacheRef</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329073"><span class="hs-identifier hs-var">schemaCacheRef</span></a></span><span>
</span><span id="line-825"></span><span>
</span><span id="line-826"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689329057"><span class="annot"><span class="annottext">corsPolicy :: CorsPolicy
</span><a href="#local-6989586621689329057"><span class="hs-identifier hs-var hs-var">corsPolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CorsConfig -&gt; CorsPolicy
</span><a href="Hasura.Server.Cors.html#mkDefaultCorsPolicy"><span class="hs-identifier hs-var">mkDefaultCorsPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">CorsConfig
</span><a href="#local-6989586621689329083"><span class="hs-identifier hs-var">corsCfg</span></a></span><span>
</span><span id="line-827"></span><span>        </span><span id="local-6989586621689329055"><span class="annot"><span class="annottext">postPollHook :: SubscriptionPostPollHook
</span><a href="#local-6989586621689329055"><span class="hs-identifier hs-var hs-var">postPollHook</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubscriptionPostPollHook
-&gt; Maybe SubscriptionPostPollHook -&gt; SubscriptionPostPollHook
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger Hasura -&gt; SubscriptionPostPollHook
</span><a href="Hasura.GraphQL.Execute.Subscription.Poll.Common.html#defaultSubscriptionPostPollHook"><span class="hs-identifier hs-var">ES.defaultSubscriptionPostPollHook</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329088"><span class="hs-identifier hs-var">logger</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe SubscriptionPostPollHook
</span><a href="#local-6989586621689329074"><span class="hs-identifier hs-var">liveQueryHook</span></a></span><span>
</span><span id="line-828"></span><span>
</span><span id="line-829"></span><span>    </span><span id="local-6989586621689329052"><span class="annot"><span class="annottext">SubscriptionsState
</span><a href="#local-6989586621689329052"><span class="hs-identifier hs-var">subscriptionsState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SubscriptionsState -&gt; m SubscriptionsState
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO SubscriptionsState -&gt; m SubscriptionsState)
-&gt; IO SubscriptionsState -&gt; m SubscriptionsState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LiveQueriesOptions
-&gt; LiveQueriesOptions
-&gt; SubscriptionPostPollHook
-&gt; IO SubscriptionsState
</span><a href="Hasura.GraphQL.Execute.Subscription.State.html#initSubscriptionsState"><span class="hs-identifier hs-var">ES.initSubscriptionsState</span></a></span><span> </span><span class="annot"><span class="annottext">LiveQueriesOptions
</span><a href="#local-6989586621689329077"><span class="hs-identifier hs-var">lqOpts</span></a></span><span> </span><span class="annot"><span class="annottext">LiveQueriesOptions
</span><a href="#local-6989586621689329076"><span class="hs-identifier hs-var">streamQOpts</span></a></span><span> </span><span class="annot"><span class="annottext">SubscriptionPostPollHook
</span><a href="#local-6989586621689329055"><span class="hs-identifier hs-var">postPollHook</span></a></span><span>
</span><span id="line-830"></span><span>
</span><span id="line-831"></span><span>    </span><span id="local-6989586621689329050"><span class="annot"><span class="annottext">WSServerEnv
</span><a href="#local-6989586621689329050"><span class="hs-identifier hs-var">wsServerEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-832"></span><span>      </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; SubscriptionsState
-&gt; IO (SchemaCache, SchemaCacheVer)
-&gt; Manager
-&gt; CorsPolicy
-&gt; SQLGenCtx
-&gt; ReadOnlyMode
-&gt; Bool
-&gt; KeepAliveDelay
-&gt; ServerMetrics
-&gt; m WSServerEnv
forall (m :: * -&gt; *).
MonadIO m =&gt;
Logger Hasura
-&gt; SubscriptionsState
-&gt; IO (SchemaCache, SchemaCacheVer)
-&gt; Manager
-&gt; CorsPolicy
-&gt; SQLGenCtx
-&gt; ReadOnlyMode
-&gt; Bool
-&gt; KeepAliveDelay
-&gt; ServerMetrics
-&gt; m WSServerEnv
</span><a href="Hasura.GraphQL.Transport.WSServerApp.html#createWSServerEnv"><span class="hs-identifier hs-var">WS.createWSServerEnv</span></a></span><span>
</span><span id="line-833"></span><span>        </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329088"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-834"></span><span>        </span><span class="annot"><span class="annottext">SubscriptionsState
</span><a href="#local-6989586621689329052"><span class="hs-identifier hs-var">subscriptionsState</span></a></span><span>
</span><span id="line-835"></span><span>        </span><span class="annot"><span class="annottext">IO (SchemaCache, SchemaCacheVer)
</span><a href="#local-6989586621689329058"><span class="hs-identifier hs-var">getSchemaCache'</span></a></span><span>
</span><span id="line-836"></span><span>        </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621689329085"><span class="hs-identifier hs-var">httpManager</span></a></span><span>
</span><span id="line-837"></span><span>        </span><span class="annot"><span class="annottext">CorsPolicy
</span><a href="#local-6989586621689329057"><span class="hs-identifier hs-var">corsPolicy</span></a></span><span>
</span><span id="line-838"></span><span>        </span><span class="annot"><span class="annottext">SQLGenCtx
</span><a href="#local-6989586621689329087"><span class="hs-identifier hs-var">sqlGenCtx</span></a></span><span>
</span><span id="line-839"></span><span>        </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="#local-6989586621689329064"><span class="hs-identifier hs-var">readOnlyMode</span></a></span><span>
</span><span id="line-840"></span><span>        </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329086"><span class="hs-identifier hs-var">enableAL</span></a></span><span>
</span><span id="line-841"></span><span>        </span><span class="annot"><span class="annottext">KeepAliveDelay
</span><a href="#local-6989586621689329067"><span class="hs-identifier hs-var">keepAliveDelay</span></a></span><span>
</span><span id="line-842"></span><span>        </span><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621689329071"><span class="hs-identifier hs-var">serverMetrics</span></a></span><span>
</span><span id="line-843"></span><span>
</span><span id="line-844"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689329048"><span class="annot"><span class="annottext">serverCtx :: ServerCtx
</span><a href="#local-6989586621689329048"><span class="hs-identifier hs-var hs-var">serverCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-845"></span><span>          </span><span class="annot"><span class="annottext">ServerCtx :: Logger Hasura
-&gt; SchemaCacheRef
-&gt; AuthMode
-&gt; Manager
-&gt; SQLGenCtx
-&gt; HashSet API
-&gt; InstanceId
-&gt; SubscriptionsState
-&gt; Bool
-&gt; Store EmptyMetrics
-&gt; ResponseInternalErrorsConfig
-&gt; Environment
-&gt; RemoteSchemaPermissions
-&gt; InferFunctionPermissions
-&gt; MaintenanceMode ()
-&gt; HashSet ExperimentalFeature
-&gt; LoggingSettings
-&gt; EventingMode
-&gt; ReadOnlyMode
-&gt; Maybe NamingCase
-&gt; ServerCtx
</span><a href="Hasura.Server.App.html#ServerCtx"><span class="hs-identifier hs-type">ServerCtx</span></a></span><span>
</span><span id="line-846"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scLogger :: Logger Hasura
</span><a href="Hasura.Server.App.html#scLogger"><span class="hs-identifier hs-var">scLogger</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689329088"><span class="hs-identifier hs-var">logger</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-847"></span><span>              </span><span class="annot"><span class="annottext">scCacheRef :: SchemaCacheRef
</span><a href="Hasura.Server.App.html#scCacheRef"><span class="hs-identifier hs-var">scCacheRef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329073"><span class="hs-identifier hs-var">schemaCacheRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-848"></span><span>              </span><span class="annot"><span class="annottext">scAuthMode :: AuthMode
</span><a href="Hasura.Server.App.html#scAuthMode"><span class="hs-identifier hs-var">scAuthMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621689329084"><span class="hs-identifier hs-var">mode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-849"></span><span>              </span><span class="annot"><span class="annottext">scManager :: Manager
</span><a href="Hasura.Server.App.html#scManager"><span class="hs-identifier hs-var">scManager</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621689329085"><span class="hs-identifier hs-var">httpManager</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-850"></span><span>              </span><span class="annot"><span class="annottext">scSQLGenCtx :: SQLGenCtx
</span><a href="Hasura.Server.App.html#scSQLGenCtx"><span class="hs-identifier hs-var">scSQLGenCtx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SQLGenCtx
</span><a href="#local-6989586621689329087"><span class="hs-identifier hs-var">sqlGenCtx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-851"></span><span>              </span><span class="annot"><span class="annottext">scEnabledAPIs :: HashSet API
</span><a href="Hasura.Server.App.html#scEnabledAPIs"><span class="hs-identifier hs-var">scEnabledAPIs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet API
</span><a href="#local-6989586621689329078"><span class="hs-identifier hs-var">apis</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-852"></span><span>              </span><span class="annot"><span class="annottext">scInstanceId :: InstanceId
</span><a href="Hasura.Server.App.html#scInstanceId"><span class="hs-identifier hs-var">scInstanceId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621689329079"><span class="hs-identifier hs-var">instanceId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-853"></span><span>              </span><span class="annot"><span class="annottext">scSubscriptionState :: SubscriptionsState
</span><a href="Hasura.Server.App.html#scSubscriptionState"><span class="hs-identifier hs-var">scSubscriptionState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubscriptionsState
</span><a href="#local-6989586621689329052"><span class="hs-identifier hs-var">subscriptionsState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-854"></span><span>              </span><span class="annot"><span class="annottext">scEnableAllowlist :: Bool
</span><a href="Hasura.Server.App.html#scEnableAllowlist"><span class="hs-identifier hs-var">scEnableAllowlist</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329086"><span class="hs-identifier hs-var">enableAL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-855"></span><span>              </span><span class="annot"><span class="annottext">scEkgStore :: Store EmptyMetrics
</span><a href="Hasura.Server.App.html#scEkgStore"><span class="hs-identifier hs-var">scEkgStore</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Store EmptyMetrics
</span><a href="#local-6989586621689329072"><span class="hs-identifier hs-var">ekgStore</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-856"></span><span>              </span><span class="annot"><span class="annottext">scEnvironment :: Environment
</span><a href="Hasura.Server.App.html#scEnvironment"><span class="hs-identifier hs-var">scEnvironment</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621689329089"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-857"></span><span>              </span><span class="annot"><span class="annottext">scResponseInternalErrorsConfig :: ResponseInternalErrorsConfig
</span><a href="Hasura.Server.App.html#scResponseInternalErrorsConfig"><span class="hs-identifier hs-var">scResponseInternalErrorsConfig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResponseInternalErrorsConfig
</span><a href="#local-6989586621689329075"><span class="hs-identifier hs-var">responseErrorsConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-858"></span><span>              </span><span class="annot"><span class="annottext">scRemoteSchemaPermsCtx :: RemoteSchemaPermissions
</span><a href="Hasura.Server.App.html#scRemoteSchemaPermsCtx"><span class="hs-identifier hs-var">scRemoteSchemaPermsCtx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621689329070"><span class="hs-identifier hs-var">enableRSPermsCtx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-859"></span><span>              </span><span class="annot"><span class="annottext">scFunctionPermsCtx :: InferFunctionPermissions
</span><a href="Hasura.Server.App.html#scFunctionPermsCtx"><span class="hs-identifier hs-var">scFunctionPermsCtx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InferFunctionPermissions
</span><a href="#local-6989586621689329069"><span class="hs-identifier hs-var">functionPermsCtx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-860"></span><span>              </span><span class="annot"><span class="annottext">scEnableMaintenanceMode :: MaintenanceMode ()
</span><a href="Hasura.Server.App.html#scEnableMaintenanceMode"><span class="hs-identifier hs-var">scEnableMaintenanceMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621689329066"><span class="hs-identifier hs-var">maintenanceMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-861"></span><span>              </span><span class="annot"><span class="annottext">scExperimentalFeatures :: HashSet ExperimentalFeature
</span><a href="Hasura.Server.App.html#scExperimentalFeatures"><span class="hs-identifier hs-var">scExperimentalFeatures</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621689329063"><span class="hs-identifier hs-var">experimentalFeatures</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-862"></span><span>              </span><span class="annot"><span class="annottext">scLoggingSettings :: LoggingSettings
</span><a href="Hasura.Server.App.html#scLoggingSettings"><span class="hs-identifier hs-var">scLoggingSettings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet (EngineLogType Hasura)
-&gt; MetadataQueryLoggingMode -&gt; LoggingSettings
</span><a href="Hasura.Server.Logging.html#LoggingSettings"><span class="hs-identifier hs-var">LoggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet (EngineLogType Hasura)
</span><a href="#local-6989586621689329062"><span class="hs-identifier hs-var">enabledLogTypes</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataQueryLoggingMode
</span><a href="#local-6989586621689329060"><span class="hs-identifier hs-var">enableMetadataQueryLogging</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-863"></span><span>              </span><span class="annot"><span class="annottext">scEventingMode :: EventingMode
</span><a href="Hasura.Server.App.html#scEventingMode"><span class="hs-identifier hs-var">scEventingMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EventingMode
</span><a href="#local-6989586621689329065"><span class="hs-identifier hs-var">eventingMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-864"></span><span>              </span><span class="annot"><span class="annottext">scEnableReadOnlyMode :: ReadOnlyMode
</span><a href="Hasura.Server.App.html#scEnableReadOnlyMode"><span class="hs-identifier hs-var">scEnableReadOnlyMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="#local-6989586621689329064"><span class="hs-identifier hs-var">readOnlyMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-865"></span><span>              </span><span class="annot"><span class="annottext">scDefaultNamingConvention :: Maybe NamingCase
</span><a href="Hasura.Server.App.html#scDefaultNamingConvention"><span class="hs-identifier hs-var">scDefaultNamingConvention</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe NamingCase
</span><a href="#local-6989586621689329059"><span class="hs-identifier hs-var">defaultNC</span></a></span><span>
</span><span id="line-866"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-867"></span><span>
</span><span id="line-868"></span><span>    </span><span id="local-6989586621689329046"><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621689329046"><span class="hs-identifier hs-var">spockApp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((forall a. m a -&gt; IO a) -&gt; IO Application) -&gt; m Application
forall (b :: * -&gt; *) (m :: * -&gt; *) c.
MonadStateless b m =&gt;
((forall a. m a -&gt; b a) -&gt; b c) -&gt; m c
</span><a href="Control.Monad.Stateless.html#liftWithStateless"><span class="hs-identifier hs-var">liftWithStateless</span></a></span><span> </span><span class="annot"><span class="annottext">(((forall a. m a -&gt; IO a) -&gt; IO Application) -&gt; m Application)
-&gt; ((forall a. m a -&gt; IO a) -&gt; IO Application) -&gt; m Application
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689329044"><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621689329044"><span class="hs-identifier hs-var">lowerIO</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-869"></span><span>      </span><span class="annot"><span class="annottext">IO Middleware -&gt; IO Application
</span><span class="hs-identifier hs-var">Spock.spockAsApp</span></span><span> </span><span class="annot"><span class="annottext">(IO Middleware -&gt; IO Application)
-&gt; IO Middleware -&gt; IO Application
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-870"></span><span>        </span><span class="annot"><span class="annottext">(forall a. m a -&gt; IO a) -&gt; SpockT m () -&gt; IO Middleware
forall (m :: * -&gt; *).
MonadIO m =&gt;
(forall a. m a -&gt; IO a) -&gt; SpockT m () -&gt; IO Middleware
</span><span class="hs-identifier hs-var">Spock.spockT</span></span><span> </span><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621689329044"><span class="hs-identifier hs-var">lowerIO</span></a></span><span> </span><span class="annot"><span class="annottext">(SpockT m () -&gt; IO Middleware) -&gt; SpockT m () -&gt; IO Middleware
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-871"></span><span>          </span><span class="annot"><span class="annottext">(ServerCtx -&gt; SpockT m ())
-&gt; CorsConfig
-&gt; ServerCtx
-&gt; Bool
-&gt; Maybe Text
-&gt; Bool
-&gt; SpockT m ()
forall (m :: * -&gt; *).
(MonadIO m, MonadFix m, MonadBaseControl IO m, ConsoleRenderer m,
 HttpLog m, UserAuthentication (TraceT m),
 MonadMetadataApiAuthorization m, MonadGQLExecutionCheck m,
 MonadConfigApiHandler m, MonadQueryLog m, HasReporter m,
 MonadExecuteQuery m, MonadMetadataStorage (MetadataStorageT m),
 HasResourceLimits m, MonadResolveSource m, MonadQueryTags m) =&gt;
(ServerCtx -&gt; SpockT m ())
-&gt; CorsConfig
-&gt; ServerCtx
-&gt; Bool
-&gt; Maybe Text
-&gt; Bool
-&gt; SpockT m ()
</span><a href="Hasura.Server.App.html#httpApp"><span class="hs-identifier hs-var">httpApp</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx -&gt; SpockT m ()
</span><a href="#local-6989586621689329090"><span class="hs-identifier hs-var">setupHook</span></a></span><span> </span><span class="annot"><span class="annottext">CorsConfig
</span><a href="#local-6989586621689329083"><span class="hs-identifier hs-var">corsCfg</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329048"><span class="hs-identifier hs-var">serverCtx</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329082"><span class="hs-identifier hs-var">enableConsole</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689329081"><span class="hs-identifier hs-var">consoleAssetsDir</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329080"><span class="hs-identifier hs-var">enableTelemetry</span></a></span><span>
</span><span id="line-872"></span><span>
</span><span id="line-873"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689329040"><span class="annot"><span class="annottext">wsServerApp :: HasuraServerApp m
</span><a href="#local-6989586621689329040"><span class="hs-identifier hs-var hs-var">wsServerApp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Environment
-&gt; HashSet (EngineLogType Hasura)
-&gt; AuthMode
-&gt; WSServerEnv
-&gt; WSConnectionInitTimeout
-&gt; HasuraServerApp m
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, Forall (Pure m),
 UserAuthentication (TraceT m), MonadGQLExecutionCheck m,
 MonadWSLog m, MonadQueryLog m, HasReporter m, MonadExecuteQuery m,
 MonadMetadataStorage (MetadataStorageT m), MonadQueryTags m,
 HasResourceLimits m) =&gt;
Environment
-&gt; HashSet (EngineLogType Hasura)
-&gt; AuthMode
-&gt; WSServerEnv
-&gt; WSConnectionInitTimeout
-&gt; HasuraServerApp m
</span><a href="Hasura.GraphQL.Transport.WSServerApp.html#createWSServerApp"><span class="hs-identifier hs-var">WS.createWSServerApp</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621689329089"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet (EngineLogType Hasura)
</span><a href="#local-6989586621689329062"><span class="hs-identifier hs-var">enabledLogTypes</span></a></span><span> </span><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621689329084"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">WSServerEnv
</span><a href="#local-6989586621689329050"><span class="hs-identifier hs-var">wsServerEnv</span></a></span><span> </span><span class="annot"><span class="annottext">WSConnectionInitTimeout
</span><a href="#local-6989586621689329061"><span class="hs-identifier hs-var">wsConnInitTimeout</span></a></span><span> </span><span class="hs-comment">-- TODO: Lyndon: Can we pass environment through wsServerEnv?</span><span>
</span><span id="line-874"></span><span>        </span><span id="local-6989586621689329038"><span class="annot"><span class="annottext">stopWSServer :: IO ()
</span><a href="#local-6989586621689329038"><span class="hs-identifier hs-var hs-var">stopWSServer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WSServerEnv -&gt; IO ()
</span><a href="Hasura.GraphQL.Transport.WSServerApp.html#stopWSServerApp"><span class="hs-identifier hs-var">WS.stopWSServerApp</span></a></span><span> </span><span class="annot"><span class="annottext">WSServerEnv
</span><a href="#local-6989586621689329050"><span class="hs-identifier hs-var">wsServerEnv</span></a></span><span>
</span><span id="line-875"></span><span>
</span><span id="line-876"></span><span>    </span><span id="local-6989586621689329036"><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621689329036"><span class="hs-identifier hs-var">waiApp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((forall a. m a -&gt; IO a) -&gt; IO Application) -&gt; m Application
forall (b :: * -&gt; *) (m :: * -&gt; *) c.
MonadStateless b m =&gt;
((forall a. m a -&gt; b a) -&gt; b c) -&gt; m c
</span><a href="Control.Monad.Stateless.html#liftWithStateless"><span class="hs-identifier hs-var">liftWithStateless</span></a></span><span> </span><span class="annot"><span class="annottext">(((forall a. m a -&gt; IO a) -&gt; IO Application) -&gt; m Application)
-&gt; ((forall a. m a -&gt; IO a) -&gt; IO Application) -&gt; m Application
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689329035"><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621689329035"><span class="hs-identifier hs-var">lowerIO</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-877"></span><span>      </span><span class="annot"><span class="annottext">Application -&gt; IO Application
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Application -&gt; IO Application) -&gt; Application -&gt; IO Application
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConnectionOptions
-&gt; (IpAddress -&gt; PendingConnection -&gt; IO ()) -&gt; Middleware
</span><a href="Network.Wai.Handler.WebSockets.Custom.html#websocketsOr"><span class="hs-identifier hs-var">WSC.websocketsOr</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionOptions
</span><a href="#local-6989586621689329068"><span class="hs-identifier hs-var">connectionOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621689329033"><span class="annot"><span class="annottext">IpAddress
</span><a href="#local-6989586621689329033"><span class="hs-identifier hs-var">ip</span></a></span></span><span> </span><span id="local-6989586621689329032"><span class="annot"><span class="annottext">PendingConnection
</span><a href="#local-6989586621689329032"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m () -&gt; IO ()
forall a. m a -&gt; IO a
</span><a href="#local-6989586621689329035"><span class="hs-identifier hs-var">lowerIO</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; IO ()) -&gt; m () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasuraServerApp m
</span><a href="#local-6989586621689329040"><span class="hs-identifier hs-var">wsServerApp</span></a></span><span> </span><span class="annot"><span class="annottext">IpAddress
</span><a href="#local-6989586621689329033"><span class="hs-identifier hs-var">ip</span></a></span><span> </span><span class="annot"><span class="annottext">PendingConnection
</span><a href="#local-6989586621689329032"><span class="hs-identifier hs-var">conn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621689329046"><span class="hs-identifier hs-var">spockApp</span></a></span><span>
</span><span id="line-878"></span><span>
</span><span id="line-879"></span><span>    </span><span class="annot"><span class="annottext">HasuraApp -&gt; m HasuraApp
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(HasuraApp -&gt; m HasuraApp) -&gt; HasuraApp -&gt; m HasuraApp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Application
-&gt; SchemaCacheRef
-&gt; AsyncActionSubscriptionState
-&gt; IO ()
-&gt; HasuraApp
</span><a href="Hasura.Server.App.html#HasuraApp"><span class="hs-identifier hs-var">HasuraApp</span></a></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621689329036"><span class="hs-identifier hs-var">waiApp</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689329073"><span class="hs-identifier hs-var">schemaCacheRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubscriptionsState -&gt; AsyncActionSubscriptionState
</span><a href="Hasura.GraphQL.Execute.Subscription.State.html#_ssAsyncActions"><span class="hs-identifier hs-var hs-var">ES._ssAsyncActions</span></a></span><span> </span><span class="annot"><span class="annottext">SubscriptionsState
</span><a href="#local-6989586621689329052"><span class="hs-identifier hs-var">subscriptionsState</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621689329038"><span class="hs-identifier hs-var">stopWSServer</span></a></span><span>
</span><span id="line-880"></span><span>
</span><span id="line-881"></span><span class="annot"><a href="Hasura.Server.App.html#httpApp"><span class="hs-identifier hs-type">httpApp</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-882"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689329721"><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-883"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-884"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadFix</span></span><span> </span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-885"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-886"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleRenderer"><span class="hs-identifier hs-type">ConsoleRenderer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-887"></span><span>    </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-888"></span><span>    </span><span class="annot"><a href="Hasura.Server.Auth.html#UserAuthentication"><span class="hs-identifier hs-type">UserAuthentication</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.html#TraceT"><span class="hs-identifier hs-type">Tracing.TraceT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-889"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-890"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier hs-type">E.MonadGQLExecutionCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-891"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadConfigApiHandler"><span class="hs-identifier hs-type">MonadConfigApiHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-892"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.html#MonadQueryLog"><span class="hs-identifier hs-type">MonadQueryLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-893"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.html#HasReporter"><span class="hs-identifier hs-type">Tracing.HasReporter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-894"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier hs-type">GH.MonadExecuteQuery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-895"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MetadataStorageT"><span class="hs-identifier hs-type">MetadataStorageT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-896"></span><span>    </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-897"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-898"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Backend.html#MonadQueryTags"><span class="hs-identifier hs-type">EB.MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-899"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-900"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.App.html#ServerCtx"><span class="hs-identifier hs-type">ServerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spock.SpockT</span></span><span> </span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-901"></span><span>  </span><span class="annot"><a href="Hasura.Server.Cors.html#CorsConfig"><span class="hs-identifier hs-type">CorsConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-902"></span><span>  </span><span class="annot"><a href="Hasura.Server.App.html#ServerCtx"><span class="hs-identifier hs-type">ServerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-903"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-904"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-905"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-906"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Spock.SpockT</span></span><span> </span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-907"></span><span id="httpApp"><span class="annot"><span class="annottext">httpApp :: (ServerCtx -&gt; SpockT m ())
-&gt; CorsConfig
-&gt; ServerCtx
-&gt; Bool
-&gt; Maybe Text
-&gt; Bool
-&gt; SpockT m ()
</span><a href="Hasura.Server.App.html#httpApp"><span class="hs-identifier hs-var hs-var">httpApp</span></a></span></span><span> </span><span id="local-6989586621689329030"><span class="annot"><span class="annottext">ServerCtx -&gt; SpockT m ()
</span><a href="#local-6989586621689329030"><span class="hs-identifier hs-var">setupHook</span></a></span></span><span> </span><span id="local-6989586621689329029"><span class="annot"><span class="annottext">CorsConfig
</span><a href="#local-6989586621689329029"><span class="hs-identifier hs-var">corsCfg</span></a></span></span><span> </span><span id="local-6989586621689329028"><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span></span><span> </span><span id="local-6989586621689329027"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329027"><span class="hs-identifier hs-var">enableConsole</span></a></span></span><span> </span><span id="local-6989586621689329026"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689329026"><span class="hs-identifier hs-var">consoleAssetsDir</span></a></span></span><span> </span><span id="local-6989586621689329025"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329025"><span class="hs-identifier hs-var">enableTelemetry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-908"></span><span>  </span><span class="hs-comment">-- Additional spock action to run</span><span>
</span><span id="line-909"></span><span>  </span><span class="annot"><span class="annottext">ServerCtx -&gt; SpockT m ()
</span><a href="#local-6989586621689329030"><span class="hs-identifier hs-var">setupHook</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span><span>
</span><span id="line-910"></span><span>
</span><span id="line-911"></span><span>  </span><span class="hs-comment">-- cors middleware</span><span>
</span><span id="line-912"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; SpockT m () -&gt; SpockT m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CorsConfig -&gt; Bool
</span><a href="Hasura.Server.Cors.html#isCorsDisabled"><span class="hs-identifier hs-var">isCorsDisabled</span></a></span><span> </span><span class="annot"><span class="annottext">CorsConfig
</span><a href="#local-6989586621689329029"><span class="hs-identifier hs-var">corsCfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SpockT m () -&gt; SpockT m ()) -&gt; SpockT m () -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-913"></span><span>    </span><span class="annot"><span class="annottext">Middleware -&gt; SpockT m ()
forall (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) ctx.
(RouteM t, Monad m) =&gt;
Middleware -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.middleware</span></span><span> </span><span class="annot"><span class="annottext">(Middleware -&gt; SpockT m ()) -&gt; Middleware -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CorsPolicy -&gt; Middleware
</span><a href="Hasura.Server.Middleware.html#corsMiddleware"><span class="hs-identifier hs-var">corsMiddleware</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CorsConfig -&gt; CorsPolicy
</span><a href="Hasura.Server.Cors.html#mkDefaultCorsPolicy"><span class="hs-identifier hs-var">mkDefaultCorsPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">CorsConfig
</span><a href="#local-6989586621689329029"><span class="hs-identifier hs-var">corsCfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-914"></span><span>
</span><span id="line-915"></span><span>  </span><span class="hs-comment">-- API Console and Root Dir</span><span>
</span><span id="line-916"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; SpockT m () -&gt; SpockT m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329027"><span class="hs-identifier hs-var">enableConsole</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329020"><span class="hs-identifier hs-var">enableMetadata</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SpockT m ()
</span><a href="#local-6989586621689329019"><span class="hs-identifier hs-var">serveApiConsole</span></a></span><span>
</span><span id="line-917"></span><span>
</span><span id="line-918"></span><span>  </span><span class="hs-comment">-- Health check endpoint with logs</span><span>
</span><span id="line-919"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689329018"><span class="annot"><span class="annottext">healthzAction :: ActionCtxT () m ()
</span><a href="#local-6989586621689329018"><span class="hs-identifier hs-var hs-var">healthzAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-920"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689329017"><span class="annot"><span class="annottext">errorMsg :: Text
</span><a href="#local-6989586621689329017"><span class="hs-identifier hs-var hs-var">errorMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ERROR&quot;</span></span><span>
</span><span id="line-921"></span><span>        </span><span class="annot"><span class="annottext">MetadataStorageT (ActionCtxT () m) ()
-&gt; ActionCtxT () m (Either QErr ())
forall (m :: * -&gt; *) a. MetadataStorageT m a -&gt; m (Either QErr a)
</span><a href="Hasura.Metadata.Class.html#runMetadataStorageT"><span class="hs-identifier hs-var">runMetadataStorageT</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataStorageT (ActionCtxT () m) ()
forall (m :: * -&gt; *). MonadMetadataStorage m =&gt; m ()
</span><a href="Hasura.Metadata.Class.html#checkMetadataStorageHealth"><span class="hs-identifier hs-var">checkMetadataStorageHealth</span></a></span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m (Either QErr ())
-&gt; (Either QErr () -&gt; ActionCtxT () m ()) -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-922"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621689329015"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689329015"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-923"></span><span>            </span><span class="hs-comment">-- error running the health check</span><span>
</span><span id="line-924"></span><span>            </span><span class="annot"><span class="annottext">QErr -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621689329014"><span class="hs-identifier hs-var">logError</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689329015"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-925"></span><span>            </span><span class="annot"><span class="annottext">Status -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) ctx.
MonadIO m =&gt;
Status -&gt; ActionCtxT ctx m ()
</span><span class="hs-identifier hs-var">Spock.setStatus</span></span><span> </span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier hs-var">HTTP.status500</span></span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m () -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) ctx a. MonadIO m =&gt; Text -&gt; ActionCtxT ctx m a
</span><span class="hs-identifier hs-var">Spock.text</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689329017"><span class="hs-identifier hs-var">errorMsg</span></a></span><span>
</span><span id="line-926"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-927"></span><span>            </span><span class="hs-comment">-- healthy</span><span>
</span><span id="line-928"></span><span>            </span><span id="local-6989586621689329011"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621689329011"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SchemaCache -&gt; ActionCtxT () m SchemaCache
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO SchemaCache -&gt; ActionCtxT () m SchemaCache)
-&gt; IO SchemaCache -&gt; ActionCtxT () m SchemaCache
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef -&gt; IO SchemaCache
</span><a href="Hasura.Server.SchemaCacheRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">(SchemaCacheRef -&gt; IO SchemaCache)
-&gt; SchemaCacheRef -&gt; IO SchemaCache
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerCtx -&gt; SchemaCacheRef
</span><a href="Hasura.Server.App.html#scCacheRef"><span class="hs-identifier hs-var hs-var">scCacheRef</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span><span>
</span><span id="line-929"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689329010"><span class="annot"><span class="annottext">responseText :: Text
</span><a href="#local-6989586621689329010"><span class="hs-identifier hs-var hs-var">responseText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-930"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaCache -&gt; [InconsistentMetadata]
</span><a href="Hasura.RQL.Types.SchemaCache.html#scInconsistentObjs"><span class="hs-identifier hs-var hs-var">scInconsistentObjs</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621689329011"><span class="hs-identifier hs-var">sc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-931"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;OK&quot;</span></span><span>
</span><span id="line-932"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;WARN: inconsistent objects in schema&quot;</span></span><span>
</span><span id="line-933"></span><span>            </span><span class="annot"><span class="annottext">Text -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621689329008"><span class="hs-identifier hs-var">logSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689329010"><span class="hs-identifier hs-var">responseText</span></a></span><span>
</span><span id="line-934"></span><span>            </span><span class="annot"><span class="annottext">Status -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) ctx.
MonadIO m =&gt;
Status -&gt; ActionCtxT ctx m ()
</span><span class="hs-identifier hs-var">Spock.setStatus</span></span><span> </span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier hs-var">HTTP.status200</span></span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m () -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) ctx a. MonadIO m =&gt; Text -&gt; ActionCtxT ctx m a
</span><span class="hs-identifier hs-var">Spock.text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">LT.toStrict</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689329010"><span class="hs-identifier hs-var">responseText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-935"></span><span>
</span><span id="line-936"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.get</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;healthz&quot;</span></span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m ()
HVectElim '[] (ActionCtxT () m ())
</span><a href="#local-6989586621689329018"><span class="hs-identifier hs-var">healthzAction</span></a></span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span>  </span><span class="hs-comment">-- This is an alternative to `healthz` (See issue #6958)</span><span>
</span><span id="line-939"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.get</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;hasura/healthz&quot;</span></span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m ()
HVectElim '[] (ActionCtxT () m ())
</span><a href="#local-6989586621689329018"><span class="hs-identifier hs-var">healthzAction</span></a></span><span>
</span><span id="line-940"></span><span>
</span><span id="line-941"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.get</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v1/version&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-942"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621689329008"><span class="hs-identifier hs-var">logSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ActionCtxT () m ()) -&gt; Text -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;version: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Text
forall a b. (ToText a, FromText b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">convertText</span></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="Hasura.Server.Version.html#currentVersion"><span class="hs-identifier hs-var">currentVersion</span></a></span><span>
</span><span id="line-943"></span><span>    </span><span class="annot"><span class="annottext">Header -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *). MonadIO m =&gt; Header -&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#setHeader"><span class="hs-identifier hs-var">setHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Header
</span><a href="Hasura.Server.Utils.html#jsonHeader"><span class="hs-identifier hs-var">jsonHeader</span></a></span><span>
</span><span id="line-944"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) ctx a.
MonadIO m =&gt;
ByteString -&gt; ActionCtxT ctx m a
</span><span class="hs-identifier hs-var">Spock.lazyBytes</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ActionCtxT () m ())
-&gt; ByteString -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">encode</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; ByteString) -&gt; Value -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">object</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;version&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Version -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="Hasura.Server.Version.html#currentVersion"><span class="hs-identifier hs-var">currentVersion</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-945"></span><span>
</span><span id="line-946"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621689329001"><span class="hs-identifier hs-type">customEndpointHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-947"></span><span>        </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689329651"><span class="annot"><a href="#local-6989586621689329651"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-948"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329651"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-949"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329651"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-950"></span><span>          </span><span class="annot"><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier hs-type">E.MonadGQLExecutionCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329651"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-951"></span><span>          </span><span class="annot"><a href="Hasura.GraphQL.Logging.html#MonadQueryLog"><span class="hs-identifier hs-type">MonadQueryLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329651"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-952"></span><span>          </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier hs-type">GH.MonadExecuteQuery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329651"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-953"></span><span>          </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MetadataStorageT"><span class="hs-identifier hs-type">MetadataStorageT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329651"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-954"></span><span>          </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329651"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-955"></span><span>          </span><span class="annot"><a href="Hasura.GraphQL.Execute.Backend.html#MonadQueryTags"><span class="hs-identifier hs-type">EB.MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329651"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-956"></span><span>          </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329651"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-957"></span><span>        </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-958"></span><span>        </span><span class="annot"><a href="Hasura.Server.Rest.html#RestRequest"><span class="hs-identifier hs-type">RestRequest</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spock.SpockMethod</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-959"></span><span>        </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.html#TraceT"><span class="hs-identifier hs-type">Tracing.TraceT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329651"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLogMetadata"><span class="hs-identifier hs-type">HttpLogMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329651"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-type">APIResp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-960"></span><span>      </span><span id="local-6989586621689329001"><span class="annot"><span class="annottext">customEndpointHandler :: RestRequest SpockMethod
-&gt; Handler (TraceT n) (HttpLogMetadata n, APIResp)
</span><a href="#local-6989586621689329001"><span class="hs-identifier hs-var hs-var">customEndpointHandler</span></a></span></span><span> </span><span id="local-6989586621689329000"><span class="annot"><span class="annottext">RestRequest SpockMethod
</span><a href="#local-6989586621689329000"><span class="hs-identifier hs-var">restReq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-961"></span><span>        </span><span id="local-6989586621689328999"><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689328999"><span class="hs-identifier hs-var">scRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; SchemaCacheRef)
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT n)) SchemaCacheRef
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; SchemaCacheRef
</span><a href="Hasura.Server.App.html#scCacheRef"><span class="hs-identifier hs-var hs-var">scCacheRef</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; SchemaCacheRef)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; SchemaCacheRef
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-962"></span><span>        </span><span id="local-6989586621689328998"><span class="annot"><span class="annottext">EndpointTrie GQLQueryWithText
</span><a href="#local-6989586621689328998"><span class="hs-identifier hs-var">endpoints</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (EndpointTrie GQLQueryWithText)
-&gt; ReaderT
     HandlerCtx
     (MetadataStorageT (TraceT n))
     (EndpointTrie GQLQueryWithText)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (EndpointTrie GQLQueryWithText)
 -&gt; ReaderT
      HandlerCtx
      (MetadataStorageT (TraceT n))
      (EndpointTrie GQLQueryWithText))
-&gt; IO (EndpointTrie GQLQueryWithText)
-&gt; ReaderT
     HandlerCtx
     (MetadataStorageT (TraceT n))
     (EndpointTrie GQLQueryWithText)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; EndpointTrie GQLQueryWithText
</span><a href="Hasura.RQL.Types.SchemaCache.html#scEndpoints"><span class="hs-identifier hs-var hs-var">scEndpoints</span></a></span><span> </span><span class="annot"><span class="annottext">(SchemaCache -&gt; EndpointTrie GQLQueryWithText)
-&gt; IO SchemaCache -&gt; IO (EndpointTrie GQLQueryWithText)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef -&gt; IO SchemaCache
</span><a href="Hasura.Server.SchemaCacheRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621689328999"><span class="hs-identifier hs-var">scRef</span></a></span><span>
</span><span id="line-963"></span><span>        </span><span id="local-6989586621689328996"><span class="annot"><span class="annottext">ExecutionCtx
</span><a href="#local-6989586621689328996"><span class="hs-identifier hs-var">execCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT HandlerCtx (MetadataStorageT (TraceT n)) ExecutionCtx
forall (m :: * -&gt; *).
(MonadIO m, MonadReader HandlerCtx m) =&gt;
m ExecutionCtx
</span><a href="Hasura.Server.App.html#mkExecutionContext"><span class="hs-identifier hs-var">mkExecutionContext</span></a></span><span>
</span><span id="line-964"></span><span>        </span><span id="local-6989586621689328995"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621689328995"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; Environment)
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT n)) Environment
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; Environment
</span><a href="Hasura.Server.App.html#scEnvironment"><span class="hs-identifier hs-var hs-var">scEnvironment</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerCtx -&gt; Environment)
-&gt; (HandlerCtx -&gt; ServerCtx) -&gt; HandlerCtx -&gt; Environment
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; ServerCtx
</span><a href="Hasura.Server.App.html#hcServerCtx"><span class="hs-identifier hs-var hs-var">hcServerCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-965"></span><span>        </span><span id="local-6989586621689328994"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689328994"><span class="hs-identifier hs-var">requestId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; RequestId)
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT n)) RequestId
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; RequestId
</span><a href="Hasura.Server.App.html#hcRequestId"><span class="hs-identifier hs-var hs-var">hcRequestId</span></a></span><span>
</span><span id="line-966"></span><span>        </span><span id="local-6989586621689328993"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689328993"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; UserInfo)
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT n)) UserInfo
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; UserInfo
</span><a href="Hasura.Server.App.html#hcUser"><span class="hs-identifier hs-var hs-var">hcUser</span></a></span><span>
</span><span id="line-967"></span><span>        </span><span id="local-6989586621689328992"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689328992"><span class="hs-identifier hs-var">reqHeaders</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; [Header])
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT n)) [Header]
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; [Header]
</span><a href="Hasura.Server.App.html#hcReqHeaders"><span class="hs-identifier hs-var hs-var">hcReqHeaders</span></a></span><span>
</span><span id="line-968"></span><span>        </span><span id="local-6989586621689328991"><span class="annot"><span class="annottext">IpAddress
</span><a href="#local-6989586621689328991"><span class="hs-identifier hs-var">ipAddress</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; IpAddress)
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT n)) IpAddress
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; IpAddress
</span><a href="Hasura.Server.App.html#hcSourceIpAddress"><span class="hs-identifier hs-var hs-var">hcSourceIpAddress</span></a></span><span>
</span><span id="line-969"></span><span>
</span><span id="line-970"></span><span>        </span><span id="local-6989586621689328990"><span class="annot"><span class="annottext">RestRequest EndpointMethod
</span><a href="#local-6989586621689328990"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-971"></span><span>          </span><span class="annot"><span class="annottext">RestRequest SpockMethod
</span><a href="#local-6989586621689329000"><span class="hs-identifier hs-var">restReq</span></a></span><span> </span><span class="annot"><span class="annottext">RestRequest SpockMethod
-&gt; (RestRequest SpockMethod
    -&gt; ReaderT
         HandlerCtx
         (MetadataStorageT (TraceT n))
         (RestRequest EndpointMethod))
-&gt; ReaderT
     HandlerCtx
     (MetadataStorageT (TraceT n))
     (RestRequest EndpointMethod)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(SpockMethod
 -&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT n)) EndpointMethod)
-&gt; RestRequest SpockMethod
-&gt; ReaderT
     HandlerCtx
     (MetadataStorageT (TraceT n))
     (RestRequest EndpointMethod)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-972"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Spock.MethodStandard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Spock.HttpMethod</span></span><span> </span><span id="local-6989586621689328985"><span class="annot"><span class="annottext">StdMethod
</span><a href="#local-6989586621689328985"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StdMethod
</span><a href="#local-6989586621689328985"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-973"></span><span>              </span><span class="annot"><span class="annottext">StdMethod
</span><span class="hs-identifier hs-var">Spock.GET</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EndpointMethod
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT n)) EndpointMethod
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">EndpointMethod
</span><a href="Hasura.RQL.Types.Endpoint.html#GET"><span class="hs-identifier hs-var">EP.GET</span></a></span><span>
</span><span id="line-974"></span><span>              </span><span class="annot"><span class="annottext">StdMethod
</span><span class="hs-identifier hs-var">Spock.POST</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EndpointMethod
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT n)) EndpointMethod
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">EndpointMethod
</span><a href="Hasura.RQL.Types.Endpoint.html#POST"><span class="hs-identifier hs-var">EP.POST</span></a></span><span>
</span><span id="line-975"></span><span>              </span><span class="annot"><span class="annottext">StdMethod
</span><span class="hs-identifier hs-var">Spock.PUT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EndpointMethod
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT n)) EndpointMethod
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">EndpointMethod
</span><a href="Hasura.RQL.Types.Endpoint.html#PUT"><span class="hs-identifier hs-var">EP.PUT</span></a></span><span>
</span><span id="line-976"></span><span>              </span><span class="annot"><span class="annottext">StdMethod
</span><span class="hs-identifier hs-var">Spock.DELETE</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EndpointMethod
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT n)) EndpointMethod
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">EndpointMethod
</span><a href="Hasura.RQL.Types.Endpoint.html#DELETE"><span class="hs-identifier hs-var">EP.DELETE</span></a></span><span>
</span><span id="line-977"></span><span>              </span><span class="annot"><span class="annottext">StdMethod
</span><span class="hs-identifier hs-var">Spock.PATCH</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EndpointMethod
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT n)) EndpointMethod
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">EndpointMethod
</span><a href="Hasura.RQL.Types.Endpoint.html#PATCH"><span class="hs-identifier hs-var">EP.PATCH</span></a></span><span>
</span><span id="line-978"></span><span>              </span><span id="local-6989586621689328974"><span class="annot"><span class="annottext">StdMethod
</span><a href="#local-6989586621689328974"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Code
-&gt; Text
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT n)) EndpointMethod
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#BadRequest"><span class="hs-identifier hs-var">BadRequest</span></a></span><span> </span><span class="annot"><span class="annottext">(Text
 -&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT n)) EndpointMethod)
-&gt; Text
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT n)) EndpointMethod
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Method &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StdMethod -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><a href="Hasura.Prelude.html#tshow"><span class="hs-identifier hs-var">tshow</span></a></span><span> </span><span class="annot"><span class="annottext">StdMethod
</span><a href="#local-6989586621689328974"><span class="hs-identifier hs-var">other</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; not supported.&quot;</span></span><span>
</span><span id="line-979"></span><span>            </span><span class="annot"><span class="annottext">SpockMethod
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Code
-&gt; Text
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT n)) EndpointMethod
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#BadRequest"><span class="hs-identifier hs-var">BadRequest</span></a></span><span> </span><span class="annot"><span class="annottext">(Text
 -&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT n)) EndpointMethod)
-&gt; Text
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT n)) EndpointMethod
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Nonstandard method not allowed for REST endpoints&quot;</span></span><span>
</span><span id="line-980"></span><span>        </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; APIResp)
-&gt; (HttpLogMetadata n, HttpResponse EncJSON)
-&gt; (HttpLogMetadata n, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; APIResp
</span><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span><span> </span><span class="annot"><span class="annottext">((HttpLogMetadata n, HttpResponse EncJSON)
 -&gt; (HttpLogMetadata n, APIResp))
-&gt; ReaderT
     HandlerCtx
     (MetadataStorageT (TraceT n))
     (HttpLogMetadata n, HttpResponse EncJSON)
-&gt; Handler (TraceT n) (HttpLogMetadata n, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Environment
-&gt; ExecutionCtx
-&gt; RequestId
-&gt; UserInfo
-&gt; [Header]
-&gt; IpAddress
-&gt; RestRequest EndpointMethod
-&gt; EndpointTrie GQLQueryWithText
-&gt; ReaderT
     HandlerCtx
     (MetadataStorageT (TraceT n))
     (HttpLogMetadata
        (ReaderT HandlerCtx (MetadataStorageT (TraceT n))),
      HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadError QErr m, MonadTrace m, MonadBaseControl IO m,
 MonadGQLExecutionCheck m, MonadQueryLog m, MonadExecuteQuery m,
 MonadMetadataStorage (MetadataStorageT m), HttpLog m,
 MonadQueryTags m, HasResourceLimits m) =&gt;
Environment
-&gt; ExecutionCtx
-&gt; RequestId
-&gt; UserInfo
-&gt; [Header]
-&gt; IpAddress
-&gt; RestRequest EndpointMethod
-&gt; EndpointTrie GQLQueryWithText
-&gt; m (HttpLogMetadata m, HttpResponse EncJSON)
</span><a href="Hasura.Server.Rest.html#runCustomEndpoint"><span class="hs-identifier hs-var">runCustomEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621689328995"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">ExecutionCtx
</span><a href="#local-6989586621689328996"><span class="hs-identifier hs-var">execCtx</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689328994"><span class="hs-identifier hs-var">requestId</span></a></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689328993"><span class="hs-identifier hs-var">userInfo</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689328992"><span class="hs-identifier hs-var">reqHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">IpAddress
</span><a href="#local-6989586621689328991"><span class="hs-identifier hs-var">ipAddress</span></a></span><span> </span><span class="annot"><span class="annottext">RestRequest EndpointMethod
</span><a href="#local-6989586621689328990"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointTrie GQLQueryWithText
</span><a href="#local-6989586621689328998"><span class="hs-identifier hs-var">endpoints</span></a></span><span>
</span><span id="line-981"></span><span>
</span><span id="line-982"></span><span>  </span><span class="hs-comment">-- See Issue #291 for discussion around restified feature</span><span>
</span><span id="line-983"></span><span>  </span><span class="annot"><span class="annottext">Path '[Text] 'Closed
-&gt; HVectElim '[Text] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.hookRouteAll</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;api&quot;</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; Path '[] 'Open -&gt; Path (Append '[] '[]) 'Open
forall (as :: [*]) (bs :: [*]) (ps :: PathState).
Path as 'Open -&gt; Path bs ps -&gt; Path (Append as bs) ps
</span><span class="hs-operator hs-var">&lt;//&gt;</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;rest&quot;</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
-&gt; Path '[Text] 'Closed -&gt; Path (Append '[] '[Text]) 'Closed
forall (as :: [*]) (bs :: [*]) (ps :: PathState).
Path as 'Open -&gt; Path bs ps -&gt; Path (Append as bs) ps
</span><span class="hs-operator hs-var">&lt;//&gt;</span></span><span> </span><span class="annot"><span class="annottext">Path '[Text] 'Closed
</span><span class="hs-identifier hs-var">Spock.wildcard</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HVectElim '[Text] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[Text] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689328969"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689328969"><span class="hs-identifier hs-var">wildcard</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-984"></span><span>    </span><span id="local-6989586621689328968"><span class="annot"><span class="annottext">TracingMetadata
</span><a href="#local-6989586621689328968"><span class="hs-identifier hs-var">queryParams</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m TracingMetadata
forall (m :: * -&gt; *) ctx.
MonadIO m =&gt;
ActionCtxT ctx m TracingMetadata
</span><span class="hs-identifier hs-var">Spock.params</span></span><span>
</span><span id="line-985"></span><span>    </span><span id="local-6989586621689328966"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689328966"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m ByteString
forall (m :: * -&gt; *) ctx. MonadIO m =&gt; ActionCtxT ctx m ByteString
</span><span class="hs-identifier hs-var">Spock.body</span></span><span>
</span><span id="line-986"></span><span>    </span><span id="local-6989586621689328964"><span class="annot"><span class="annottext">SpockMethod
</span><a href="#local-6989586621689328964"><span class="hs-identifier hs-var">method</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m SpockMethod
forall (m :: * -&gt; *) ctx. MonadIO m =&gt; ActionCtxT ctx m SpockMethod
</span><span class="hs-identifier hs-var">Spock.reqMethod</span></span><span>
</span><span id="line-987"></span><span>
</span><span id="line-988"></span><span>    </span><span class="hs-comment">-- This is where we decode the json encoded body args. They</span><span>
</span><span id="line-989"></span><span>    </span><span class="hs-comment">-- are treated as if they came from query arguments, but allow</span><span>
</span><span id="line-990"></span><span>    </span><span class="hs-comment">-- us to pass non-scalar values.</span><span>
</span><span id="line-991"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689328962"><span class="annot"><span class="annottext">bodyParams :: [(Text, Value)]
</span><a href="#local-6989586621689328962"><span class="hs-identifier hs-var hs-var">bodyParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe Value
forall a. FromJSON a =&gt; ByteString -&gt; Maybe a
</span><span class="hs-identifier hs-var">J.decodeStrict</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689328966"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-992"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">J.Object</span></span><span> </span><span id="local-6989586621689328959"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621689328959"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Pair -&gt; (Text, Value)) -&gt; [Pair] -&gt; [(Text, Value)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Key -&gt; Text) -&gt; Pair -&gt; (Text, Value)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text
</span><span class="hs-identifier hs-var">K.toText</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Pair] -&gt; [(Text, Value)]) -&gt; [Pair] -&gt; [(Text, Value)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Object -&gt; [Pair]
forall v. KeyMap v -&gt; [(Key, v)]
</span><span class="hs-identifier hs-var">KM.toList</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621689328959"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-993"></span><span>          </span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-994"></span><span>        </span><span id="local-6989586621689328956"><span class="annot"><span class="annottext">allParams :: [(Text, Either Text Value)]
</span><a href="#local-6989586621689328956"><span class="hs-identifier hs-var hs-var">allParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Either Text Value)
-&gt; (Text, Text) -&gt; (Text, Either Text Value)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either Text Value
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">((Text, Text) -&gt; (Text, Either Text Value))
-&gt; TracingMetadata -&gt; [(Text, Either Text Value)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TracingMetadata
</span><a href="#local-6989586621689328968"><span class="hs-identifier hs-var">queryParams</span></a></span><span> </span><span class="annot"><span class="annottext">[(Text, Either Text Value)]
-&gt; [(Text, Either Text Value)] -&gt; [(Text, Either Text Value)]
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Either Text Value)
-&gt; (Text, Value) -&gt; (Text, Either Text Value)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Either Text Value
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">((Text, Value) -&gt; (Text, Either Text Value))
-&gt; [(Text, Value)] -&gt; [(Text, Either Text Value)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Text, Value)]
</span><a href="#local-6989586621689328962"><span class="hs-identifier hs-var">bodyParams</span></a></span><span>
</span><span id="line-995"></span><span>
</span><span id="line-996"></span><span>    </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT m) () -&gt; ActionCtxT () m ()
forall a (n :: * -&gt; *).
(FromJSON a, MonadIO n, MonadBaseControl IO n,
 UserAuthentication (TraceT n), HttpLog n, HasReporter n,
 HasResourceLimits n) =&gt;
(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT n) a -&gt; ActionT n ()
</span><a href="#local-6989586621689328954"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Value
</span><a href="Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(APIHandler (TraceT m) () -&gt; ActionCtxT () m ())
-&gt; APIHandler (TraceT m) () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-997"></span><span>      </span><span class="hs-comment">-- TODO: Are we actually able to use mkGetHandler in this situation? POST handler seems to do some work that we might want to avoid.</span><span>
</span><span id="line-998"></span><span>      </span><span class="annot"><span class="annottext">Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
-&gt; APIHandler (TraceT m) ()
forall (m :: * -&gt; *).
Handler m (HttpLogMetadata m, APIResp) -&gt; APIHandler m ()
</span><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier hs-var">mkGetHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
 -&gt; APIHandler (TraceT m) ())
-&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
-&gt; APIHandler (TraceT m) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RestRequest SpockMethod
-&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall (n :: * -&gt; *).
(MonadIO n, MonadBaseControl IO n, MonadGQLExecutionCheck n,
 MonadQueryLog n, MonadExecuteQuery n,
 MonadMetadataStorage (MetadataStorageT n), HttpLog n,
 MonadQueryTags n, HasResourceLimits n) =&gt;
RestRequest SpockMethod
-&gt; Handler (TraceT n) (HttpLogMetadata n, APIResp)
</span><a href="#local-6989586621689329001"><span class="hs-identifier hs-var">customEndpointHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
-&gt; SpockMethod
-&gt; [(Text, Either Text Value)]
-&gt; RestRequest SpockMethod
forall method.
Text -&gt; method -&gt; [(Text, Either Text Value)] -&gt; RestRequest method
</span><a href="Hasura.Server.Rest.html#RestRequest"><span class="hs-identifier hs-var">RestRequest</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689328969"><span class="hs-identifier hs-var">wildcard</span></a></span><span> </span><span class="annot"><span class="annottext">SpockMethod
</span><a href="#local-6989586621689328964"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">[(Text, Either Text Value)]
</span><a href="#local-6989586621689328956"><span class="hs-identifier hs-var">allParams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-999"></span><span>
</span><span id="line-1000"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; SpockT m () -&gt; SpockT m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329020"><span class="hs-identifier hs-var">enableMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">(SpockT m () -&gt; SpockT m ()) -&gt; SpockT m () -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1001"></span><span>    </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.post</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v1/graphql/explain&quot;</span></span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m ()
HVectElim '[] (ActionCtxT () m ())
</span><a href="#local-6989586621689328951"><span class="hs-identifier hs-var">gqlExplainAction</span></a></span><span>
</span><span id="line-1002"></span><span>
</span><span id="line-1003"></span><span>    </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.post</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v1alpha1/graphql/explain&quot;</span></span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m ()
HVectElim '[] (ActionCtxT () m ())
</span><a href="#local-6989586621689328951"><span class="hs-identifier hs-var">gqlExplainAction</span></a></span><span>
</span><span id="line-1004"></span><span>
</span><span id="line-1005"></span><span>    </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.post</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v1/query&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1006"></span><span>      </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr)
-&gt; APIHandler (TraceT m) RQLQuery
-&gt; ActionCtxT () m ()
forall a (n :: * -&gt; *).
(FromJSON a, MonadIO n, MonadBaseControl IO n,
 UserAuthentication (TraceT n), HttpLog n, HasReporter n,
 HasResourceLimits n) =&gt;
(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT n) a -&gt; ActionT n ()
</span><a href="#local-6989586621689328954"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Value
</span><a href="Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(APIHandler (TraceT m) RQLQuery -&gt; ActionCtxT () m ())
-&gt; APIHandler (TraceT m) RQLQuery -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1007"></span><span>        </span><span class="annot"><span class="annottext">(RQLQuery
 -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
-&gt; APIHandler (TraceT m) RQLQuery
forall a (m :: * -&gt; *).
(a -&gt; Handler m (HttpLogMetadata m, APIResp)) -&gt; APIHandler m a
</span><a href="Hasura.Server.App.html#mkPostHandler"><span class="hs-identifier hs-var">mkPostHandler</span></a></span><span> </span><span class="annot"><span class="annottext">((RQLQuery
  -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
 -&gt; APIHandler (TraceT m) RQLQuery)
-&gt; (RQLQuery
    -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
-&gt; APIHandler (TraceT m) RQLQuery
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(APIResp -&gt; (HttpLogMetadata m, APIResp))
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) APIResp
-&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLog m =&gt; HttpLogMetadata m
forall (m :: * -&gt; *). HttpLog m =&gt; HttpLogMetadata m
</span><a href="Hasura.Server.Logging.html#emptyHttpLogMetadata"><span class="hs-identifier hs-var">emptyHttpLogMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ReaderT HandlerCtx (MetadataStorageT (TraceT m)) APIResp
 -&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp))
-&gt; (RQLQuery
    -&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) APIResp)
-&gt; RQLQuery
-&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(RQLQuery -&gt; Handler (TraceT m) (HttpResponse EncJSON))
-&gt; RQLQuery
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) APIResp
forall (m :: * -&gt; *) a.
Functor m =&gt;
(a -&gt; Handler m (HttpResponse EncJSON)) -&gt; a -&gt; Handler m APIResp
</span><a href="Hasura.Server.App.html#mkAPIRespHandler"><span class="hs-identifier hs-var">mkAPIRespHandler</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; Handler (TraceT m) (HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadMetadataApiAuthorization m,
 MonadTrace m, MonadReader HandlerCtx m, MonadMetadataStorage m,
 MonadResolveSource m, MonadQueryTags m) =&gt;
RQLQuery -&gt; m (HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1QueryHandler"><span class="hs-identifier hs-var">v1QueryHandler</span></a></span><span>
</span><span id="line-1008"></span><span>
</span><span id="line-1009"></span><span>    </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.post</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v1/metadata&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1010"></span><span>      </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr)
-&gt; APIHandler (TraceT m) RQLMetadata
-&gt; ActionCtxT () m ()
forall a (n :: * -&gt; *).
(FromJSON a, MonadIO n, MonadBaseControl IO n,
 UserAuthentication (TraceT n), HttpLog n, HasReporter n,
 HasResourceLimits n) =&gt;
(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT n) a -&gt; ActionT n ()
</span><a href="#local-6989586621689328954"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Value
</span><a href="Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(APIHandler (TraceT m) RQLMetadata -&gt; ActionCtxT () m ())
-&gt; APIHandler (TraceT m) RQLMetadata -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1011"></span><span>        </span><span class="annot"><span class="annottext">(RQLMetadata
 -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
-&gt; APIHandler (TraceT m) RQLMetadata
forall a (m :: * -&gt; *).
(a -&gt; Handler m (HttpLogMetadata m, APIResp)) -&gt; APIHandler m a
</span><a href="Hasura.Server.App.html#mkPostHandler"><span class="hs-identifier hs-var">mkPostHandler</span></a></span><span> </span><span class="annot"><span class="annottext">((RQLMetadata
  -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
 -&gt; APIHandler (TraceT m) RQLMetadata)
-&gt; (RQLMetadata
    -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
-&gt; APIHandler (TraceT m) RQLMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(APIResp -&gt; (HttpLogMetadata m, APIResp))
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) APIResp
-&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLog m =&gt; HttpLogMetadata m
forall (m :: * -&gt; *). HttpLog m =&gt; HttpLogMetadata m
</span><a href="Hasura.Server.Logging.html#emptyHttpLogMetadata"><span class="hs-identifier hs-var">emptyHttpLogMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ReaderT HandlerCtx (MetadataStorageT (TraceT m)) APIResp
 -&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp))
-&gt; (RQLMetadata
    -&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) APIResp)
-&gt; RQLMetadata
-&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(RQLMetadata -&gt; Handler (TraceT m) (HttpResponse EncJSON))
-&gt; RQLMetadata
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) APIResp
forall (m :: * -&gt; *) a.
Functor m =&gt;
(a -&gt; Handler m (HttpResponse EncJSON)) -&gt; a -&gt; Handler m APIResp
</span><a href="Hasura.Server.App.html#mkAPIRespHandler"><span class="hs-identifier hs-var">mkAPIRespHandler</span></a></span><span> </span><span class="annot"><span class="annottext">RQLMetadata -&gt; Handler (TraceT m) (HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadReader HandlerCtx m,
 MonadTrace m, MonadMetadataStorage m, MonadResolveSource m,
 MonadMetadataApiAuthorization m) =&gt;
RQLMetadata -&gt; m (HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1MetadataHandler"><span class="hs-identifier hs-var">v1MetadataHandler</span></a></span><span>
</span><span id="line-1012"></span><span>
</span><span id="line-1013"></span><span>    </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.post</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v2/query&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1014"></span><span>      </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr)
-&gt; APIHandler (TraceT m) RQLQuery
-&gt; ActionCtxT () m ()
forall a (n :: * -&gt; *).
(FromJSON a, MonadIO n, MonadBaseControl IO n,
 UserAuthentication (TraceT n), HttpLog n, HasReporter n,
 HasResourceLimits n) =&gt;
(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT n) a -&gt; ActionT n ()
</span><a href="#local-6989586621689328954"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Value
</span><a href="Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(APIHandler (TraceT m) RQLQuery -&gt; ActionCtxT () m ())
-&gt; APIHandler (TraceT m) RQLQuery -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1015"></span><span>        </span><span class="annot"><span class="annottext">(RQLQuery
 -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
-&gt; APIHandler (TraceT m) RQLQuery
forall a (m :: * -&gt; *).
(a -&gt; Handler m (HttpLogMetadata m, APIResp)) -&gt; APIHandler m a
</span><a href="Hasura.Server.App.html#mkPostHandler"><span class="hs-identifier hs-var">mkPostHandler</span></a></span><span> </span><span class="annot"><span class="annottext">((RQLQuery
  -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
 -&gt; APIHandler (TraceT m) RQLQuery)
-&gt; (RQLQuery
    -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
-&gt; APIHandler (TraceT m) RQLQuery
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(APIResp -&gt; (HttpLogMetadata m, APIResp))
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) APIResp
-&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLog m =&gt; HttpLogMetadata m
forall (m :: * -&gt; *). HttpLog m =&gt; HttpLogMetadata m
</span><a href="Hasura.Server.Logging.html#emptyHttpLogMetadata"><span class="hs-identifier hs-var">emptyHttpLogMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ReaderT HandlerCtx (MetadataStorageT (TraceT m)) APIResp
 -&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp))
-&gt; (RQLQuery
    -&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) APIResp)
-&gt; RQLQuery
-&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(RQLQuery -&gt; Handler (TraceT m) (HttpResponse EncJSON))
-&gt; RQLQuery
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) APIResp
forall (m :: * -&gt; *) a.
Functor m =&gt;
(a -&gt; Handler m (HttpResponse EncJSON)) -&gt; a -&gt; Handler m APIResp
</span><a href="Hasura.Server.App.html#mkAPIRespHandler"><span class="hs-identifier hs-var">mkAPIRespHandler</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; Handler (TraceT m) (HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadMetadataApiAuthorization m,
 MonadTrace m, MonadReader HandlerCtx m, MonadMetadataStorage m,
 MonadResolveSource m, MonadQueryTags m) =&gt;
RQLQuery -&gt; m (HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v2QueryHandler"><span class="hs-identifier hs-var">v2QueryHandler</span></a></span><span>
</span><span id="line-1016"></span><span>
</span><span id="line-1017"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; SpockT m () -&gt; SpockT m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689328950"><span class="hs-identifier hs-var">enablePGDump</span></a></span><span> </span><span class="annot"><span class="annottext">(SpockT m () -&gt; SpockT m ()) -&gt; SpockT m () -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1018"></span><span>    </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.post</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v1alpha1/pg_dump&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1019"></span><span>      </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr)
-&gt; APIHandler (TraceT m) PGDumpReqBody
-&gt; ActionCtxT () m ()
forall a (n :: * -&gt; *).
(FromJSON a, MonadIO n, MonadBaseControl IO n,
 UserAuthentication (TraceT n), HttpLog n, HasReporter n,
 HasResourceLimits n) =&gt;
(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT n) a -&gt; ActionT n ()
</span><a href="#local-6989586621689328954"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Value
</span><a href="Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(APIHandler (TraceT m) PGDumpReqBody -&gt; ActionCtxT () m ())
-&gt; APIHandler (TraceT m) PGDumpReqBody -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1020"></span><span>        </span><span class="annot"><span class="annottext">(PGDumpReqBody
 -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
-&gt; APIHandler (TraceT m) PGDumpReqBody
forall a (m :: * -&gt; *).
(a -&gt; Handler m (HttpLogMetadata m, APIResp)) -&gt; APIHandler m a
</span><a href="Hasura.Server.App.html#mkPostHandler"><span class="hs-identifier hs-var">mkPostHandler</span></a></span><span> </span><span class="annot"><span class="annottext">((PGDumpReqBody
  -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
 -&gt; APIHandler (TraceT m) PGDumpReqBody)
-&gt; (PGDumpReqBody
    -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
-&gt; APIHandler (TraceT m) PGDumpReqBody
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(APIResp -&gt; (HttpLogMetadata m, APIResp))
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) APIResp
-&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLog m =&gt; HttpLogMetadata m
forall (m :: * -&gt; *). HttpLog m =&gt; HttpLogMetadata m
</span><a href="Hasura.Server.Logging.html#emptyHttpLogMetadata"><span class="hs-identifier hs-var">emptyHttpLogMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ReaderT HandlerCtx (MetadataStorageT (TraceT m)) APIResp
 -&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp))
-&gt; (PGDumpReqBody
    -&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) APIResp)
-&gt; PGDumpReqBody
-&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PGDumpReqBody
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) APIResp
forall (m :: * -&gt; *).
(MonadIO m, MonadError QErr m, MonadReader HandlerCtx m) =&gt;
PGDumpReqBody -&gt; m APIResp
</span><a href="Hasura.Server.App.html#v1Alpha1PGDumpHandler"><span class="hs-identifier hs-var">v1Alpha1PGDumpHandler</span></a></span><span>
</span><span id="line-1021"></span><span>
</span><span id="line-1022"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; SpockT m () -&gt; SpockT m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689328949"><span class="hs-identifier hs-var">enableConfig</span></a></span><span> </span><span class="annot"><span class="annottext">(SpockT m () -&gt; SpockT m ()) -&gt; SpockT m () -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerCtx -&gt; Maybe Text -&gt; SpockT m ()
forall (m :: * -&gt; *).
MonadConfigApiHandler m =&gt;
ServerCtx -&gt; Maybe Text -&gt; SpockCtxT () m ()
</span><a href="Hasura.Server.App.html#runConfigApiHandler"><span class="hs-identifier hs-var">runConfigApiHandler</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689329026"><span class="hs-identifier hs-var">consoleAssetsDir</span></a></span><span>
</span><span id="line-1023"></span><span>
</span><span id="line-1024"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; SpockT m () -&gt; SpockT m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689328948"><span class="hs-identifier hs-var">enableGraphQL</span></a></span><span> </span><span class="annot"><span class="annottext">(SpockT m () -&gt; SpockT m ()) -&gt; SpockT m () -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1025"></span><span>    </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.post</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v1alpha1/graphql&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1026"></span><span>      </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr)
-&gt; APIHandler (TraceT m) ReqsText
-&gt; ActionCtxT () m ()
forall a (n :: * -&gt; *).
(FromJSON a, MonadIO n, MonadBaseControl IO n,
 UserAuthentication (TraceT n), HttpLog n, HasReporter n,
 HasResourceLimits n) =&gt;
(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT n) a -&gt; ActionT n ()
</span><a href="#local-6989586621689328954"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Value
</span><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#encodeGQErr"><span class="hs-identifier hs-var">GH.encodeGQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(APIHandler (TraceT m) ReqsText -&gt; ActionCtxT () m ())
-&gt; APIHandler (TraceT m) ReqsText -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1027"></span><span>        </span><span class="annot"><span class="annottext">(ReqsText
 -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
-&gt; APIHandler (TraceT m) ReqsText
forall (m :: * -&gt; *).
(ReqsText -&gt; Handler m (HttpLogMetadata m, APIResp))
-&gt; APIHandler m ReqsText
</span><a href="Hasura.Server.App.html#mkGQLRequestHandler"><span class="hs-identifier hs-var">mkGQLRequestHandler</span></a></span><span> </span><span class="annot"><span class="annottext">((ReqsText
  -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
 -&gt; APIHandler (TraceT m) ReqsText)
-&gt; (ReqsText
    -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
-&gt; APIHandler (TraceT m) ReqsText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ReqsText
 -&gt; Handler (TraceT m) (HttpLogMetadata m, HttpResponse EncJSON))
-&gt; ReqsText -&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; Handler m (b, HttpResponse EncJSON))
-&gt; a -&gt; Handler m (b, APIResp)
</span><a href="Hasura.Server.App.html#mkGQLAPIRespHandler"><span class="hs-identifier hs-var">mkGQLAPIRespHandler</span></a></span><span> </span><span class="annot"><span class="annottext">((ReqsText
  -&gt; Handler (TraceT m) (HttpLogMetadata m, HttpResponse EncJSON))
 -&gt; ReqsText -&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp))
-&gt; (ReqsText
    -&gt; Handler (TraceT m) (HttpLogMetadata m, HttpResponse EncJSON))
-&gt; ReqsText
-&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GraphQLQueryType
-&gt; ReqsText
-&gt; ReaderT
     HandlerCtx
     (MetadataStorageT (TraceT m))
     (HttpLogMetadata
        (ReaderT HandlerCtx (MetadataStorageT (TraceT m))),
      HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadGQLExecutionCheck m,
 MonadQueryLog m, MonadTrace m, MonadExecuteQuery m,
 MonadError QErr m, MonadReader HandlerCtx m, HttpLog m,
 MonadMetadataStorage (MetadataStorageT m), MonadQueryTags m,
 HasResourceLimits m) =&gt;
GraphQLQueryType
-&gt; ReqsText -&gt; m (HttpLogMetadata m, HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1Alpha1GQHandler"><span class="hs-identifier hs-var">v1Alpha1GQHandler</span></a></span><span> </span><span class="annot"><span class="annottext">GraphQLQueryType
</span><a href="Hasura.GraphQL.Execute.Types.html#QueryHasura"><span class="hs-identifier hs-var">E.QueryHasura</span></a></span><span>
</span><span id="line-1028"></span><span>
</span><span id="line-1029"></span><span>    </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.post</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v1/graphql&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1030"></span><span>      </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr)
-&gt; APIHandler (TraceT m) ReqsText
-&gt; ActionCtxT () m ()
forall a (n :: * -&gt; *).
(FromJSON a, MonadIO n, MonadBaseControl IO n,
 UserAuthentication (TraceT n), HttpLog n, HasReporter n,
 HasResourceLimits n) =&gt;
(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT n) a -&gt; ActionT n ()
</span><a href="#local-6989586621689328954"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Value
</span><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#encodeGQErr"><span class="hs-identifier hs-var">GH.encodeGQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
</span><a href="#local-6989586621689328946"><span class="hs-identifier hs-var">allMod200</span></a></span><span> </span><span class="annot"><span class="annottext">(APIHandler (TraceT m) ReqsText -&gt; ActionCtxT () m ())
-&gt; APIHandler (TraceT m) ReqsText -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1031"></span><span>        </span><span class="annot"><span class="annottext">(ReqsText
 -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
-&gt; APIHandler (TraceT m) ReqsText
forall (m :: * -&gt; *).
(ReqsText -&gt; Handler m (HttpLogMetadata m, APIResp))
-&gt; APIHandler m ReqsText
</span><a href="Hasura.Server.App.html#mkGQLRequestHandler"><span class="hs-identifier hs-var">mkGQLRequestHandler</span></a></span><span> </span><span class="annot"><span class="annottext">((ReqsText
  -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
 -&gt; APIHandler (TraceT m) ReqsText)
-&gt; (ReqsText
    -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
-&gt; APIHandler (TraceT m) ReqsText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ReqsText
 -&gt; Handler (TraceT m) (HttpLogMetadata m, HttpResponse EncJSON))
-&gt; ReqsText -&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; Handler m (b, HttpResponse EncJSON))
-&gt; a -&gt; Handler m (b, APIResp)
</span><a href="Hasura.Server.App.html#mkGQLAPIRespHandler"><span class="hs-identifier hs-var">mkGQLAPIRespHandler</span></a></span><span> </span><span class="annot"><span class="annottext">ReqsText
-&gt; Handler (TraceT m) (HttpLogMetadata m, HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadGQLExecutionCheck m,
 MonadQueryLog m, MonadTrace m, MonadExecuteQuery m, HttpLog m,
 MonadError QErr m, MonadReader HandlerCtx m,
 MonadMetadataStorage (MetadataStorageT m), MonadQueryTags m,
 HasResourceLimits m) =&gt;
ReqsText -&gt; m (HttpLogMetadata m, HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1GQHandler"><span class="hs-identifier hs-var">v1GQHandler</span></a></span><span>
</span><span id="line-1032"></span><span>
</span><span id="line-1033"></span><span>    </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.post</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v1beta1/relay&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1034"></span><span>      </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr)
-&gt; APIHandler (TraceT m) ReqsText
-&gt; ActionCtxT () m ()
forall a (n :: * -&gt; *).
(FromJSON a, MonadIO n, MonadBaseControl IO n,
 UserAuthentication (TraceT n), HttpLog n, HasReporter n,
 HasResourceLimits n) =&gt;
(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT n) a -&gt; ActionT n ()
</span><a href="#local-6989586621689328954"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Value
</span><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#encodeGQErr"><span class="hs-identifier hs-var">GH.encodeGQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
</span><a href="#local-6989586621689328946"><span class="hs-identifier hs-var">allMod200</span></a></span><span> </span><span class="annot"><span class="annottext">(APIHandler (TraceT m) ReqsText -&gt; ActionCtxT () m ())
-&gt; APIHandler (TraceT m) ReqsText -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1035"></span><span>        </span><span class="annot"><span class="annottext">(ReqsText
 -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
-&gt; APIHandler (TraceT m) ReqsText
forall (m :: * -&gt; *).
(ReqsText -&gt; Handler m (HttpLogMetadata m, APIResp))
-&gt; APIHandler m ReqsText
</span><a href="Hasura.Server.App.html#mkGQLRequestHandler"><span class="hs-identifier hs-var">mkGQLRequestHandler</span></a></span><span> </span><span class="annot"><span class="annottext">((ReqsText
  -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
 -&gt; APIHandler (TraceT m) ReqsText)
-&gt; (ReqsText
    -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
-&gt; APIHandler (TraceT m) ReqsText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ReqsText
 -&gt; Handler (TraceT m) (HttpLogMetadata m, HttpResponse EncJSON))
-&gt; ReqsText -&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; Handler m (b, HttpResponse EncJSON))
-&gt; a -&gt; Handler m (b, APIResp)
</span><a href="Hasura.Server.App.html#mkGQLAPIRespHandler"><span class="hs-identifier hs-var">mkGQLAPIRespHandler</span></a></span><span> </span><span class="annot"><span class="annottext">((ReqsText
  -&gt; Handler (TraceT m) (HttpLogMetadata m, HttpResponse EncJSON))
 -&gt; ReqsText -&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp))
-&gt; (ReqsText
    -&gt; Handler (TraceT m) (HttpLogMetadata m, HttpResponse EncJSON))
-&gt; ReqsText
-&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ReqsText
-&gt; Handler (TraceT m) (HttpLogMetadata m, HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadGQLExecutionCheck m,
 MonadQueryLog m, MonadTrace m, HttpLog m, MonadExecuteQuery m,
 MonadError QErr m, MonadReader HandlerCtx m,
 MonadMetadataStorage (MetadataStorageT m), MonadQueryTags m,
 HasResourceLimits m) =&gt;
ReqsText -&gt; m (HttpLogMetadata m, HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1GQRelayHandler"><span class="hs-identifier hs-var">v1GQRelayHandler</span></a></span><span>
</span><span id="line-1036"></span><span>
</span><span id="line-1037"></span><span>  </span><span class="hs-comment">-- This exposes some simple RTS stats when we run with `+RTS -T`. We want</span><span>
</span><span id="line-1038"></span><span>  </span><span class="hs-comment">-- this to be available even when developer APIs are not compiled in, to</span><span>
</span><span id="line-1039"></span><span>  </span><span class="hs-comment">-- support benchmarking.</span><span>
</span><span id="line-1040"></span><span>  </span><span class="hs-comment">-- See: https://hackage.haskell.org/package/base/docs/GHC-Stats.html</span><span>
</span><span id="line-1041"></span><span>  </span><span id="local-6989586621689328945"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689328945"><span class="hs-identifier hs-var">exposeRtsStats</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; SpockCtxT () m Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO Bool
</span><span class="hs-identifier hs-var">RTS.getRTSStatsEnabled</span></span><span>
</span><span id="line-1042"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; SpockT m () -&gt; SpockT m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689328945"><span class="hs-identifier hs-var">exposeRtsStats</span></a></span><span> </span><span class="annot"><span class="annottext">(SpockT m () -&gt; SpockT m ()) -&gt; SpockT m () -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1043"></span><span>    </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.get</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;dev/rts_stats&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1044"></span><span>      </span><span class="hs-comment">-- This ensures the live_bytes and other counters from GCDetails are fresh:</span><span>
</span><span id="line-1045"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><span class="hs-identifier hs-var">performMajorGC</span></span><span>
</span><span id="line-1046"></span><span>      </span><span id="local-6989586621689328943"><span class="annot"><span class="annottext">RTSStats
</span><a href="#local-6989586621689328943"><span class="hs-identifier hs-var">stats</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO RTSStats -&gt; ActionCtxT () m RTSStats
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO RTSStats
</span><span class="hs-identifier hs-var">RTS.getRTSStats</span></span><span>
</span><span id="line-1047"></span><span>      </span><span class="annot"><span class="annottext">RTSStats -&gt; ActionCtxT () m ()
forall a (m :: * -&gt; *) ctx b.
(ToJSON a, MonadIO m) =&gt;
a -&gt; ActionCtxT ctx m b
</span><span class="hs-identifier hs-var">Spock.json</span></span><span> </span><span class="annot"><span class="annottext">RTSStats
</span><a href="#local-6989586621689328943"><span class="hs-identifier hs-var">stats</span></a></span><span>
</span><span id="line-1048"></span><span>
</span><span id="line-1049"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; SpockT m () -&gt; SpockT m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; Bool
</span><a href="Hasura.Server.App.html#isDeveloperAPIEnabled"><span class="hs-identifier hs-var">isDeveloperAPIEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SpockT m () -&gt; SpockT m ()) -&gt; SpockT m () -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1050"></span><span>    </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.get</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;dev/ekg&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1051"></span><span>      </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT m) () -&gt; ActionCtxT () m ()
forall a (n :: * -&gt; *).
(FromJSON a, MonadIO n, MonadBaseControl IO n,
 UserAuthentication (TraceT n), HttpLog n, HasReporter n,
 HasResourceLimits n) =&gt;
(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT n) a -&gt; ActionT n ()
</span><a href="#local-6989586621689328954"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Value
</span><a href="Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(APIHandler (TraceT m) () -&gt; ActionCtxT () m ())
-&gt; APIHandler (TraceT m) () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1052"></span><span>        </span><span class="annot"><span class="annottext">Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
-&gt; APIHandler (TraceT m) ()
forall (m :: * -&gt; *).
Handler m (HttpLogMetadata m, APIResp) -&gt; APIHandler m ()
</span><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier hs-var">mkGetHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
 -&gt; APIHandler (TraceT m) ())
-&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
-&gt; APIHandler (TraceT m) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1053"></span><span>          </span><span class="annot"><span class="annottext">ReaderT HandlerCtx (MetadataStorageT (TraceT m)) ()
forall (m :: * -&gt; *).
(MonadError QErr m, MonadReader HandlerCtx m) =&gt;
m ()
</span><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-var">onlyAdmin</span></a></span><span>
</span><span id="line-1054"></span><span>          </span><span id="local-6989586621689328941"><span class="annot"><span class="annottext">Sample
</span><a href="#local-6989586621689328941"><span class="hs-identifier hs-var">respJ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Sample
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) Sample
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Sample
 -&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) Sample)
-&gt; IO Sample
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) Sample
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Store EmptyMetrics -&gt; IO Sample
forall (metrics :: Symbol -&gt; MetricType -&gt; * -&gt; *).
Store metrics -&gt; IO Sample
</span><span class="hs-identifier hs-var">EKG.sampleAll</span></span><span> </span><span class="annot"><span class="annottext">(Store EmptyMetrics -&gt; IO Sample)
-&gt; Store EmptyMetrics -&gt; IO Sample
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerCtx -&gt; Store EmptyMetrics
</span><a href="Hasura.Server.App.html#scEkgStore"><span class="hs-identifier hs-var hs-var">scEkgStore</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span><span>
</span><span id="line-1055"></span><span>          </span><span class="annot"><span class="annottext">(HttpLogMetadata m, APIResp)
-&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLog m =&gt; HttpLogMetadata m
forall (m :: * -&gt; *). HttpLog m =&gt; HttpLogMetadata m
</span><a href="Hasura.Server.Logging.html#emptyHttpLogMetadata"><span class="hs-identifier hs-var">emptyHttpLogMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; APIResp
</span><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; APIResp)
-&gt; HttpResponse EncJSON -&gt; APIResp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; EncJSON
forall a. ToJSON a =&gt; a -&gt; EncJSON
</span><a href="Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-var">encJFromJValue</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; EncJSON) -&gt; Value -&gt; EncJSON
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Sample -&gt; Value
</span><span class="hs-identifier hs-var">EKG.sampleToJson</span></span><span> </span><span class="annot"><span class="annottext">Sample
</span><a href="#local-6989586621689328941"><span class="hs-identifier hs-var">respJ</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1056"></span><span>    </span><span class="hs-comment">-- This deprecated endpoint used to show the query plan cache pre-PDV.</span><span>
</span><span id="line-1057"></span><span>    </span><span class="hs-comment">-- Eventually this endpoint can be removed.</span><span>
</span><span id="line-1058"></span><span>    </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.get</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;dev/plan_cache&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1059"></span><span>      </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT m) () -&gt; ActionCtxT () m ()
forall a (n :: * -&gt; *).
(FromJSON a, MonadIO n, MonadBaseControl IO n,
 UserAuthentication (TraceT n), HttpLog n, HasReporter n,
 HasResourceLimits n) =&gt;
(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT n) a -&gt; ActionT n ()
</span><a href="#local-6989586621689328954"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Value
</span><a href="Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(APIHandler (TraceT m) () -&gt; ActionCtxT () m ())
-&gt; APIHandler (TraceT m) () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1060"></span><span>        </span><span class="annot"><span class="annottext">Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
-&gt; APIHandler (TraceT m) ()
forall (m :: * -&gt; *).
Handler m (HttpLogMetadata m, APIResp) -&gt; APIHandler m ()
</span><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier hs-var">mkGetHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
 -&gt; APIHandler (TraceT m) ())
-&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
-&gt; APIHandler (TraceT m) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1061"></span><span>          </span><span class="annot"><span class="annottext">ReaderT HandlerCtx (MetadataStorageT (TraceT m)) ()
forall (m :: * -&gt; *).
(MonadError QErr m, MonadReader HandlerCtx m) =&gt;
m ()
</span><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-var">onlyAdmin</span></a></span><span>
</span><span id="line-1062"></span><span>          </span><span class="annot"><span class="annottext">(HttpLogMetadata m, APIResp)
-&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLog m =&gt; HttpLogMetadata m
forall (m :: * -&gt; *). HttpLog m =&gt; HttpLogMetadata m
</span><a href="Hasura.Server.Logging.html#emptyHttpLogMetadata"><span class="hs-identifier hs-var">emptyHttpLogMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; APIResp
</span><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; APIResp)
-&gt; HttpResponse EncJSON -&gt; APIResp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; EncJSON
forall a. ToJSON a =&gt; a -&gt; EncJSON
</span><a href="Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-var">encJFromJValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier hs-var">J.Null</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1063"></span><span>    </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.get</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;dev/subscriptions&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1064"></span><span>      </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT m) () -&gt; ActionCtxT () m ()
forall a (n :: * -&gt; *).
(FromJSON a, MonadIO n, MonadBaseControl IO n,
 UserAuthentication (TraceT n), HttpLog n, HasReporter n,
 HasResourceLimits n) =&gt;
(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT n) a -&gt; ActionT n ()
</span><a href="#local-6989586621689328954"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Value
</span><a href="Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(APIHandler (TraceT m) () -&gt; ActionCtxT () m ())
-&gt; APIHandler (TraceT m) () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1065"></span><span>        </span><span class="annot"><span class="annottext">Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
-&gt; APIHandler (TraceT m) ()
forall (m :: * -&gt; *).
Handler m (HttpLogMetadata m, APIResp) -&gt; APIHandler m ()
</span><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier hs-var">mkGetHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
 -&gt; APIHandler (TraceT m) ())
-&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
-&gt; APIHandler (TraceT m) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1066"></span><span>          </span><span class="annot"><span class="annottext">ReaderT HandlerCtx (MetadataStorageT (TraceT m)) ()
forall (m :: * -&gt; *).
(MonadError QErr m, MonadReader HandlerCtx m) =&gt;
m ()
</span><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-var">onlyAdmin</span></a></span><span>
</span><span id="line-1067"></span><span>          </span><span id="local-6989586621689328937"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689328937"><span class="hs-identifier hs-var">respJ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Value -&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) Value
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Value
 -&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) Value)
-&gt; IO Value
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SubscriptionsState -&gt; IO Value
</span><a href="Hasura.GraphQL.Execute.Subscription.State.html#dumpSubscriptionsState"><span class="hs-identifier hs-var">ES.dumpSubscriptionsState</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(SubscriptionsState -&gt; IO Value) -&gt; SubscriptionsState -&gt; IO Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerCtx -&gt; SubscriptionsState
</span><a href="Hasura.Server.App.html#scSubscriptionState"><span class="hs-identifier hs-var hs-var">scSubscriptionState</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span><span>
</span><span id="line-1068"></span><span>          </span><span class="annot"><span class="annottext">(HttpLogMetadata m, APIResp)
-&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLog m =&gt; HttpLogMetadata m
forall (m :: * -&gt; *). HttpLog m =&gt; HttpLogMetadata m
</span><a href="Hasura.Server.Logging.html#emptyHttpLogMetadata"><span class="hs-identifier hs-var">emptyHttpLogMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; APIResp
</span><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; APIResp)
-&gt; HttpResponse EncJSON -&gt; APIResp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; EncJSON
forall a. ToJSON a =&gt; a -&gt; EncJSON
</span><a href="Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-var">encJFromJValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689328937"><span class="hs-identifier hs-var">respJ</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1069"></span><span>    </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.get</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;dev/subscriptions/extended&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1070"></span><span>      </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT m) () -&gt; ActionCtxT () m ()
forall a (n :: * -&gt; *).
(FromJSON a, MonadIO n, MonadBaseControl IO n,
 UserAuthentication (TraceT n), HttpLog n, HasReporter n,
 HasResourceLimits n) =&gt;
(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT n) a -&gt; ActionT n ()
</span><a href="#local-6989586621689328954"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Value
</span><a href="Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(APIHandler (TraceT m) () -&gt; ActionCtxT () m ())
-&gt; APIHandler (TraceT m) () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1071"></span><span>        </span><span class="annot"><span class="annottext">Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
-&gt; APIHandler (TraceT m) ()
forall (m :: * -&gt; *).
Handler m (HttpLogMetadata m, APIResp) -&gt; APIHandler m ()
</span><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier hs-var">mkGetHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
 -&gt; APIHandler (TraceT m) ())
-&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
-&gt; APIHandler (TraceT m) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1072"></span><span>          </span><span class="annot"><span class="annottext">ReaderT HandlerCtx (MetadataStorageT (TraceT m)) ()
forall (m :: * -&gt; *).
(MonadError QErr m, MonadReader HandlerCtx m) =&gt;
m ()
</span><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-var">onlyAdmin</span></a></span><span>
</span><span id="line-1073"></span><span>          </span><span id="local-6989586621689328935"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689328935"><span class="hs-identifier hs-var">respJ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Value -&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) Value
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Value
 -&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) Value)
-&gt; IO Value
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SubscriptionsState -&gt; IO Value
</span><a href="Hasura.GraphQL.Execute.Subscription.State.html#dumpSubscriptionsState"><span class="hs-identifier hs-var">ES.dumpSubscriptionsState</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">(SubscriptionsState -&gt; IO Value) -&gt; SubscriptionsState -&gt; IO Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerCtx -&gt; SubscriptionsState
</span><a href="Hasura.Server.App.html#scSubscriptionState"><span class="hs-identifier hs-var hs-var">scSubscriptionState</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span><span>
</span><span id="line-1074"></span><span>          </span><span class="annot"><span class="annottext">(HttpLogMetadata m, APIResp)
-&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLog m =&gt; HttpLogMetadata m
forall (m :: * -&gt; *). HttpLog m =&gt; HttpLogMetadata m
</span><a href="Hasura.Server.Logging.html#emptyHttpLogMetadata"><span class="hs-identifier hs-var">emptyHttpLogMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; APIResp
</span><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; APIResp)
-&gt; HttpResponse EncJSON -&gt; APIResp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; EncJSON
forall a. ToJSON a =&gt; a -&gt; EncJSON
</span><a href="Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-var">encJFromJValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689328935"><span class="hs-identifier hs-var">respJ</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1075"></span><span>    </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.get</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;dev/dataconnector/schema&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1076"></span><span>      </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT m) () -&gt; ActionCtxT () m ()
forall a (n :: * -&gt; *).
(FromJSON a, MonadIO n, MonadBaseControl IO n,
 UserAuthentication (TraceT n), HttpLog n, HasReporter n,
 HasResourceLimits n) =&gt;
(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT n) a -&gt; ActionT n ()
</span><a href="#local-6989586621689328954"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Value
</span><a href="Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(APIHandler (TraceT m) () -&gt; ActionCtxT () m ())
-&gt; APIHandler (TraceT m) () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1077"></span><span>        </span><span class="annot"><span class="annottext">Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
-&gt; APIHandler (TraceT m) ()
forall (m :: * -&gt; *).
Handler m (HttpLogMetadata m, APIResp) -&gt; APIHandler m ()
</span><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier hs-var">mkGetHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
 -&gt; APIHandler (TraceT m) ())
-&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
-&gt; APIHandler (TraceT m) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1078"></span><span>          </span><span class="annot"><span class="annottext">ReaderT HandlerCtx (MetadataStorageT (TraceT m)) ()
forall (m :: * -&gt; *).
(MonadError QErr m, MonadReader HandlerCtx m) =&gt;
m ()
</span><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-var">onlyAdmin</span></a></span><span>
</span><span id="line-1079"></span><span>          </span><span class="annot"><span class="annottext">(HttpLogMetadata m, APIResp)
-&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLog m =&gt; HttpLogMetadata m
forall (m :: * -&gt; *). HttpLog m =&gt; HttpLogMetadata m
</span><a href="Hasura.Server.Logging.html#emptyHttpLogMetadata"><span class="hs-identifier hs-var">emptyHttpLogMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; APIResp
</span><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; APIResp)
-&gt; HttpResponse EncJSON -&gt; APIResp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OpenApi -&gt; EncJSON
forall a. ToJSON a =&gt; a -&gt; EncJSON
</span><a href="Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-var">encJFromJValue</span></a></span><span> </span><span class="annot"><span class="annottext">OpenApi
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/graphql-engine-1.0.0/l/dc-api/opt/doc/html/graphql-engine/src"><span class="hs-identifier hs-var">openApiSchema</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1080"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.get</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;api/swagger/json&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1081"></span><span>    </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT m) () -&gt; ActionCtxT () m ()
forall a (n :: * -&gt; *).
(FromJSON a, MonadIO n, MonadBaseControl IO n,
 UserAuthentication (TraceT n), HttpLog n, HasReporter n,
 HasResourceLimits n) =&gt;
(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT n) a -&gt; ActionT n ()
</span><a href="#local-6989586621689328954"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Value
</span><a href="Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(APIHandler (TraceT m) () -&gt; ActionCtxT () m ())
-&gt; APIHandler (TraceT m) () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1082"></span><span>      </span><span class="annot"><span class="annottext">Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
-&gt; APIHandler (TraceT m) ()
forall (m :: * -&gt; *).
Handler m (HttpLogMetadata m, APIResp) -&gt; APIHandler m ()
</span><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier hs-var">mkGetHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
 -&gt; APIHandler (TraceT m) ())
-&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp)
-&gt; APIHandler (TraceT m) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1083"></span><span>        </span><span class="annot"><span class="annottext">ReaderT HandlerCtx (MetadataStorageT (TraceT m)) ()
forall (m :: * -&gt; *).
(MonadError QErr m, MonadReader HandlerCtx m) =&gt;
m ()
</span><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-var">onlyAdmin</span></a></span><span>
</span><span id="line-1084"></span><span>        </span><span id="local-6989586621689328934"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621689328934"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SchemaCache
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) SchemaCache
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO SchemaCache
 -&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) SchemaCache)
-&gt; IO SchemaCache
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) SchemaCache
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef -&gt; IO SchemaCache
</span><a href="Hasura.Server.SchemaCacheRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">(SchemaCacheRef -&gt; IO SchemaCache)
-&gt; SchemaCacheRef -&gt; IO SchemaCache
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerCtx -&gt; SchemaCacheRef
</span><a href="Hasura.Server.App.html#scCacheRef"><span class="hs-identifier hs-var hs-var">scCacheRef</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span><span>
</span><span id="line-1085"></span><span>        </span><span id="local-6989586621689328933"><span class="annot"><span class="annottext">OpenApi
</span><a href="#local-6989586621689328933"><span class="hs-identifier hs-var">json</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SchemaCache
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) OpenApi
forall (m :: * -&gt; *).
(MonadError QErr m, MonadFix m) =&gt;
SchemaCache -&gt; m OpenApi
</span><a href="Hasura.Server.OpenAPI.html#buildOpenAPI"><span class="hs-identifier hs-var">buildOpenAPI</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621689328934"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-1086"></span><span>        </span><span class="annot"><span class="annottext">(HttpLogMetadata m, APIResp)
-&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLog m =&gt; HttpLogMetadata m
forall (m :: * -&gt; *). HttpLog m =&gt; HttpLogMetadata m
</span><a href="Hasura.Server.Logging.html#emptyHttpLogMetadata"><span class="hs-identifier hs-var">emptyHttpLogMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; APIResp
</span><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; APIResp)
-&gt; HttpResponse EncJSON -&gt; APIResp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OpenApi -&gt; EncJSON
forall a. ToJSON a =&gt; a -&gt; EncJSON
</span><a href="Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-var">encJFromJValue</span></a></span><span> </span><span class="annot"><span class="annottext">OpenApi
</span><a href="#local-6989586621689328933"><span class="hs-identifier hs-var">json</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1087"></span><span>
</span><span id="line-1088"></span><span>  </span><span class="annot"><span class="annottext">[StdMethod] -&gt; (StdMethod -&gt; SpockT m ()) -&gt; SpockT m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">StdMethod
</span><span class="hs-identifier hs-var">Spock.GET</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StdMethod
</span><span class="hs-identifier hs-var">Spock.POST</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">((StdMethod -&gt; SpockT m ()) -&gt; SpockT m ())
-&gt; (StdMethod -&gt; SpockT m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689328931"><span class="annot"><span class="annottext">StdMethod
</span><a href="#local-6989586621689328931"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StdMethod -&gt; ([Text] -&gt; ActionCtxT () m ()) -&gt; SpockT m ()
forall (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) ctx.
(RouteM t, Monad m) =&gt;
StdMethod -&gt; ([Text] -&gt; ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.hookAny</span></span><span> </span><span class="annot"><span class="annottext">StdMethod
</span><a href="#local-6989586621689328931"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(([Text] -&gt; ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; ([Text] -&gt; ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">[Text]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1089"></span><span>    </span><span id="local-6989586621689328929"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689328929"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m Request
forall (m :: * -&gt; *) ctx. MonadIO m =&gt; ActionCtxT ctx m Request
</span><span class="hs-identifier hs-var">Spock.request</span></span><span>
</span><span id="line-1090"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689328928"><span class="annot"><span class="annottext">headers :: [Header]
</span><a href="#local-6989586621689328928"><span class="hs-identifier hs-var hs-var">headers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request -&gt; [Header]
</span><span class="hs-identifier hs-var hs-var">Wai.requestHeaders</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689328929"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-1091"></span><span>        </span><span id="local-6989586621689328927"><span class="annot"><span class="annottext">qErr :: QErr
</span><a href="#local-6989586621689328927"><span class="hs-identifier hs-var hs-var">qErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; QErr
</span><a href="Hasura.Base.Error.html#err404"><span class="hs-identifier hs-var">err404</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#NotFound"><span class="hs-identifier hs-var">NotFound</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;resource does not exist&quot;</span></span><span>
</span><span id="line-1092"></span><span>    </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; LoggingSettings -&gt; [Header] -&gt; QErr -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *).
(MonadIO m, HttpLog m) =&gt;
Logger Hasura
-&gt; LoggingSettings -&gt; [Header] -&gt; QErr -&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#raiseGenericApiError"><span class="hs-identifier hs-var">raiseGenericApiError</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689328926"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; LoggingSettings
</span><a href="Hasura.Server.App.html#scLoggingSettings"><span class="hs-identifier hs-var hs-var">scLoggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689328928"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689328927"><span class="hs-identifier hs-var">qErr</span></a></span><span>
</span><span id="line-1093"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1094"></span><span>    </span><span id="local-6989586621689328926"><span class="annot"><span class="annottext">logger :: Logger Hasura
</span><a href="#local-6989586621689328926"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerCtx -&gt; Logger Hasura
</span><a href="Hasura.Server.App.html#scLogger"><span class="hs-identifier hs-var hs-var">scLogger</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span><span>
</span><span id="line-1095"></span><span>
</span><span id="line-1096"></span><span>    </span><span id="local-6989586621689329008"><span class="annot"><span class="annottext">logSuccess :: Text -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621689329008"><span class="hs-identifier hs-var hs-var">logSuccess</span></a></span></span><span> </span><span id="local-6989586621689328925"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689328925"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1097"></span><span>      </span><span id="local-6989586621689328924"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689328924"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m Request
forall (m :: * -&gt; *) ctx. MonadIO m =&gt; ActionCtxT ctx m Request
</span><span class="hs-identifier hs-var">Spock.request</span></span><span>
</span><span id="line-1098"></span><span>      </span><span id="local-6989586621689328923"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689328923"><span class="hs-identifier hs-var">reqBody</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ByteString -&gt; ActionCtxT () m ByteString
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; ActionCtxT () m ByteString)
-&gt; IO ByteString -&gt; ActionCtxT () m ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; IO ByteString
</span><span class="hs-identifier hs-var">Wai.strictRequestBody</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689328924"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-1099"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689328922"><span class="annot"><span class="annottext">headers :: [Header]
</span><a href="#local-6989586621689328922"><span class="hs-identifier hs-var hs-var">headers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request -&gt; [Header]
</span><span class="hs-identifier hs-var hs-var">Wai.requestHeaders</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689328924"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-1100"></span><span>          </span><span id="local-6989586621689328921"><span class="annot"><span class="annottext">blMsg :: ByteString
</span><a href="#local-6989586621689328921"><span class="hs-identifier hs-var hs-var">blMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><span class="hs-identifier hs-var">TL.encodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689328925"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1101"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621689328919"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689328919"><span class="hs-identifier hs-var">reqId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689328918"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689328918"><span class="hs-identifier hs-var">_newHeaders</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; ActionCtxT () m (RequestId, [Header])
forall (m :: * -&gt; *).
MonadIO m =&gt;
[Header] -&gt; m (RequestId, [Header])
</span><a href="Hasura.Server.Types.html#getRequestId"><span class="hs-identifier hs-var">getRequestId</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689328922"><span class="hs-identifier hs-var">headers</span></a></span><span>
</span><span id="line-1102"></span><span>      </span><span class="annot"><span class="annottext">m () -&gt; ActionCtxT () m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ActionCtxT () m ()) -&gt; m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1103"></span><span>        </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; ByteString
-&gt; ByteString
-&gt; Maybe (DiffTime, DiffTime)
-&gt; Maybe CompressionType
-&gt; [Header]
-&gt; HttpLogMetadata m
-&gt; m ()
forall (m :: * -&gt; *).
HttpLog m =&gt;
Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; ByteString
-&gt; ByteString
-&gt; Maybe (DiffTime, DiffTime)
-&gt; Maybe CompressionType
-&gt; [Header]
-&gt; HttpLogMetadata m
-&gt; m ()
</span><a href="Hasura.Server.Logging.html#logHttpSuccess"><span class="hs-identifier hs-var">logHttpSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689328926"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; LoggingSettings
</span><a href="Hasura.Server.App.html#scLoggingSettings"><span class="hs-identifier hs-var hs-var">scLoggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe UserInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689328919"><span class="hs-identifier hs-var">reqId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689328924"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689328923"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689328921"><span class="hs-identifier hs-var">blMsg</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689328921"><span class="hs-identifier hs-var">blMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (DiffTime, DiffTime)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe CompressionType
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689328922"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLog m =&gt; HttpLogMetadata m
forall (m :: * -&gt; *). HttpLog m =&gt; HttpLogMetadata m
</span><a href="Hasura.Server.Logging.html#emptyHttpLogMetadata"><span class="hs-identifier hs-var">emptyHttpLogMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1104"></span><span>
</span><span id="line-1105"></span><span>    </span><span id="local-6989586621689329014"><span class="annot"><span class="annottext">logError :: QErr -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621689329014"><span class="hs-identifier hs-var hs-var">logError</span></a></span></span><span> </span><span id="local-6989586621689328917"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689328917"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1106"></span><span>      </span><span id="local-6989586621689328916"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689328916"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m Request
forall (m :: * -&gt; *) ctx. MonadIO m =&gt; ActionCtxT ctx m Request
</span><span class="hs-identifier hs-var">Spock.request</span></span><span>
</span><span id="line-1107"></span><span>      </span><span id="local-6989586621689328915"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689328915"><span class="hs-identifier hs-var">reqBody</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ByteString -&gt; ActionCtxT () m ByteString
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; ActionCtxT () m ByteString)
-&gt; IO ByteString -&gt; ActionCtxT () m ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; IO ByteString
</span><span class="hs-identifier hs-var">Wai.strictRequestBody</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689328916"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-1108"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689328914"><span class="annot"><span class="annottext">headers :: [Header]
</span><a href="#local-6989586621689328914"><span class="hs-identifier hs-var hs-var">headers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request -&gt; [Header]
</span><span class="hs-identifier hs-var hs-var">Wai.requestHeaders</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689328916"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-1109"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621689328913"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689328913"><span class="hs-identifier hs-var">reqId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689328912"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689328912"><span class="hs-identifier hs-var">_newHeaders</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; ActionCtxT () m (RequestId, [Header])
forall (m :: * -&gt; *).
MonadIO m =&gt;
[Header] -&gt; m (RequestId, [Header])
</span><a href="Hasura.Server.Types.html#getRequestId"><span class="hs-identifier hs-var">getRequestId</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689328914"><span class="hs-identifier hs-var">headers</span></a></span><span>
</span><span id="line-1110"></span><span>      </span><span class="annot"><span class="annottext">m () -&gt; ActionCtxT () m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ActionCtxT () m ()) -&gt; m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1111"></span><span>        </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; QErr
-&gt; [Header]
-&gt; m ()
forall (m :: * -&gt; *).
HttpLog m =&gt;
Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; QErr
-&gt; [Header]
-&gt; m ()
</span><a href="Hasura.Server.Logging.html#logHttpError"><span class="hs-identifier hs-var">logHttpError</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689328926"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; LoggingSettings
</span><a href="Hasura.Server.App.html#scLoggingSettings"><span class="hs-identifier hs-var hs-var">scLoggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe UserInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689328913"><span class="hs-identifier hs-var">reqId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689328916"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689328915"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689328917"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689328914"><span class="hs-identifier hs-var">headers</span></a></span><span>
</span><span id="line-1112"></span><span>
</span><span id="line-1113"></span><span>    </span><span class="annot"><a href="#local-6989586621689328954"><span class="hs-identifier hs-type">spockAction</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1114"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689329653"><span class="annot"><a href="#local-6989586621689329653"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621689329652"><span class="annot"><a href="#local-6989586621689329652"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1115"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621689329653"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329652"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329652"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Auth.html#UserAuthentication"><span class="hs-identifier hs-type">UserAuthentication</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.html#TraceT"><span class="hs-identifier hs-type">Tracing.TraceT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329652"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329652"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Tracing.html#HasReporter"><span class="hs-identifier hs-type">Tracing.HasReporter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329652"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329652"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1116"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1117"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1118"></span><span>      </span><span class="annot"><a href="Hasura.Server.App.html#APIHandler"><span class="hs-identifier hs-type">APIHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.html#TraceT"><span class="hs-identifier hs-type">Tracing.TraceT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329652"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689329653"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1119"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Spock.ActionT</span></span><span> </span><span class="annot"><a href="#local-6989586621689329652"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1120"></span><span>    </span><span id="local-6989586621689328954"><span class="annot"><span class="annottext">spockAction :: (Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT n) a -&gt; ActionT n ()
</span><a href="#local-6989586621689328954"><span class="hs-identifier hs-var hs-var">spockAction</span></a></span></span><span> </span><span id="local-6989586621689328911"><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Value
</span><a href="#local-6989586621689328911"><span class="hs-identifier hs-var">qErrEncoder</span></a></span></span><span> </span><span id="local-6989586621689328910"><span class="annot"><span class="annottext">QErr -&gt; QErr
</span><a href="#local-6989586621689328910"><span class="hs-identifier hs-var">qErrModifier</span></a></span></span><span> </span><span id="local-6989586621689328909"><span class="annot"><span class="annottext">APIHandler (TraceT n) a
</span><a href="#local-6989586621689328909"><span class="hs-identifier hs-var">apiHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerCtx
-&gt; (Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr)
-&gt; APIHandler (TraceT n) a
-&gt; ActionT n ()
forall (m :: * -&gt; *) a.
(MonadIO m, MonadBaseControl IO m, FromJSON a,
 UserAuthentication (TraceT m), HttpLog m, HasReporter m,
 HasResourceLimits m) =&gt;
ServerCtx
-&gt; (Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr)
-&gt; APIHandler (TraceT m) a
-&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#mkSpockAction"><span class="hs-identifier hs-var">mkSpockAction</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Value
</span><a href="#local-6989586621689328911"><span class="hs-identifier hs-var">qErrEncoder</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
</span><a href="#local-6989586621689328910"><span class="hs-identifier hs-var">qErrModifier</span></a></span><span> </span><span class="annot"><span class="annottext">APIHandler (TraceT n) a
</span><a href="#local-6989586621689328909"><span class="hs-identifier hs-var">apiHandler</span></a></span><span>
</span><span id="line-1121"></span><span>
</span><span id="line-1122"></span><span>    </span><span class="hs-comment">-- all graphql errors should be of type 200</span><span>
</span><span id="line-1123"></span><span>    </span><span id="local-6989586621689328946"><span class="annot"><span class="annottext">allMod200 :: QErr -&gt; QErr
</span><a href="#local-6989586621689328946"><span class="hs-identifier hs-var hs-var">allMod200</span></a></span></span><span> </span><span id="local-6989586621689328908"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689328908"><span class="hs-identifier hs-var">qe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689328908"><span class="hs-identifier hs-var">qe</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">qeStatus :: Status
</span><a href="Hasura.Base.Error.html#qeStatus"><span class="hs-identifier hs-var">qeStatus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier hs-var">HTTP.status200</span></span><span class="hs-special">}</span><span>
</span><span id="line-1124"></span><span>    </span><span id="local-6989586621689328951"><span class="annot"><span class="annottext">gqlExplainAction :: ActionCtxT () m ()
</span><a href="#local-6989586621689328951"><span class="hs-identifier hs-var hs-var">gqlExplainAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1125"></span><span>      </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr)
-&gt; APIHandler (TraceT m) GQLExplain
-&gt; ActionCtxT () m ()
forall a (n :: * -&gt; *).
(FromJSON a, MonadIO n, MonadBaseControl IO n,
 UserAuthentication (TraceT n), HttpLog n, HasReporter n,
 HasResourceLimits n) =&gt;
(Bool -&gt; QErr -&gt; Value)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler (TraceT n) a -&gt; ActionT n ()
</span><a href="#local-6989586621689328954"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Value
</span><a href="Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(APIHandler (TraceT m) GQLExplain -&gt; ActionCtxT () m ())
-&gt; APIHandler (TraceT m) GQLExplain -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1126"></span><span>        </span><span class="annot"><span class="annottext">(GQLExplain
 -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
-&gt; APIHandler (TraceT m) GQLExplain
forall a (m :: * -&gt; *).
(a -&gt; Handler m (HttpLogMetadata m, APIResp)) -&gt; APIHandler m a
</span><a href="Hasura.Server.App.html#mkPostHandler"><span class="hs-identifier hs-var">mkPostHandler</span></a></span><span> </span><span class="annot"><span class="annottext">((GQLExplain
  -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
 -&gt; APIHandler (TraceT m) GQLExplain)
-&gt; (GQLExplain
    -&gt; Handler (TraceT m) (HttpLogMetadata (TraceT m), APIResp))
-&gt; APIHandler (TraceT m) GQLExplain
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1127"></span><span>          </span><span class="annot"><span class="annottext">(APIResp -&gt; (HttpLogMetadata m, APIResp))
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) APIResp
-&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLog m =&gt; HttpLogMetadata m
forall (m :: * -&gt; *). HttpLog m =&gt; HttpLogMetadata m
</span><a href="Hasura.Server.Logging.html#emptyHttpLogMetadata"><span class="hs-identifier hs-var">emptyHttpLogMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621689329721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ReaderT HandlerCtx (MetadataStorageT (TraceT m)) APIResp
 -&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp))
-&gt; (GQLExplain
    -&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) APIResp)
-&gt; GQLExplain
-&gt; Handler (TraceT m) (HttpLogMetadata m, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(GQLExplain -&gt; Handler (TraceT m) (HttpResponse EncJSON))
-&gt; GQLExplain
-&gt; ReaderT HandlerCtx (MetadataStorageT (TraceT m)) APIResp
forall (m :: * -&gt; *) a.
Functor m =&gt;
(a -&gt; Handler m (HttpResponse EncJSON)) -&gt; a -&gt; Handler m APIResp
</span><a href="Hasura.Server.App.html#mkAPIRespHandler"><span class="hs-identifier hs-var">mkAPIRespHandler</span></a></span><span> </span><span class="annot"><span class="annottext">GQLExplain -&gt; Handler (TraceT m) (HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadError QErr m,
 MonadReader HandlerCtx m,
 MonadMetadataStorage (MetadataStorageT m), MonadQueryTags m) =&gt;
GQLExplain -&gt; m (HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#gqlExplainHandler"><span class="hs-identifier hs-var">gqlExplainHandler</span></a></span><span>
</span><span id="line-1128"></span><span>    </span><span id="local-6989586621689328948"><span class="annot"><span class="annottext">enableGraphQL :: Bool
</span><a href="#local-6989586621689328948"><span class="hs-identifier hs-var hs-var">enableGraphQL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerCtx -&gt; Bool
</span><a href="Hasura.Server.App.html#isGraphQLEnabled"><span class="hs-identifier hs-var">isGraphQLEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span><span>
</span><span id="line-1129"></span><span>    </span><span id="local-6989586621689329020"><span class="annot"><span class="annottext">enableMetadata :: Bool
</span><a href="#local-6989586621689329020"><span class="hs-identifier hs-var hs-var">enableMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerCtx -&gt; Bool
</span><a href="Hasura.Server.App.html#isMetadataEnabled"><span class="hs-identifier hs-var">isMetadataEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span><span>
</span><span id="line-1130"></span><span>    </span><span id="local-6989586621689328950"><span class="annot"><span class="annottext">enablePGDump :: Bool
</span><a href="#local-6989586621689328950"><span class="hs-identifier hs-var hs-var">enablePGDump</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerCtx -&gt; Bool
</span><a href="Hasura.Server.App.html#isPGDumpEnabled"><span class="hs-identifier hs-var">isPGDumpEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span><span>
</span><span id="line-1131"></span><span>    </span><span id="local-6989586621689328949"><span class="annot"><span class="annottext">enableConfig :: Bool
</span><a href="#local-6989586621689328949"><span class="hs-identifier hs-var hs-var">enableConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerCtx -&gt; Bool
</span><a href="Hasura.Server.App.html#isConfigEnabled"><span class="hs-identifier hs-var">isConfigEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span><span>
</span><span id="line-1132"></span><span>
</span><span id="line-1133"></span><span>    </span><span id="local-6989586621689329019"><span class="annot"><span class="annottext">serveApiConsole :: SpockT m ()
</span><a href="#local-6989586621689329019"><span class="hs-identifier hs-var hs-var">serveApiConsole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1134"></span><span>      </span><span class="hs-comment">-- redirect / to /console</span><span>
</span><span id="line-1135"></span><span>      </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.get</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-identifier hs-var">Spock.root</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) ctx a. MonadIO m =&gt; Text -&gt; ActionCtxT ctx m a
</span><span class="hs-identifier hs-var">Spock.redirect</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;console&quot;</span></span><span>
</span><span id="line-1136"></span><span>
</span><span id="line-1137"></span><span>      </span><span class="hs-comment">-- serve static files if consoleAssetsDir is set</span><span>
</span><span id="line-1138"></span><span>      </span><span class="annot"><span class="annottext">Maybe Text -&gt; (Text -&gt; SpockT m ()) -&gt; SpockT m ()
forall (m :: * -&gt; *) a.
Applicative m =&gt;
Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Hasura.Prelude.html#onJust"><span class="hs-identifier hs-var">onJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689329026"><span class="hs-identifier hs-var">consoleAssetsDir</span></a></span><span> </span><span class="annot"><span class="annottext">((Text -&gt; SpockT m ()) -&gt; SpockT m ())
-&gt; (Text -&gt; SpockT m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689328904"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689328904"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1139"></span><span>        </span><span class="annot"><span class="annottext">Path '[Text] 'Closed
-&gt; HVectElim '[Text] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.get</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;console/assets&quot;</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
-&gt; Path '[Text] 'Closed -&gt; Path (Append '[] '[Text]) 'Closed
forall (as :: [*]) (bs :: [*]) (ps :: PathState).
Path as 'Open -&gt; Path bs ps -&gt; Path (Append as bs) ps
</span><span class="hs-operator hs-var">&lt;//&gt;</span></span><span> </span><span class="annot"><span class="annottext">Path '[Text] 'Closed
</span><span class="hs-identifier hs-var">Spock.wildcard</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HVectElim '[Text] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[Text] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689328903"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689328903"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1140"></span><span>          </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; LoggingSettings -&gt; Text -&gt; String -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *).
(MonadIO m, HttpLog m) =&gt;
Logger Hasura -&gt; LoggingSettings -&gt; Text -&gt; String -&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#consoleAssetsHandler"><span class="hs-identifier hs-var">consoleAssetsHandler</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689328926"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; LoggingSettings
</span><a href="Hasura.Server.App.html#scLoggingSettings"><span class="hs-identifier hs-var hs-var">scLoggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689328904"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689328903"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1141"></span><span>
</span><span id="line-1142"></span><span>      </span><span class="hs-comment">-- serve console html</span><span>
</span><span id="line-1143"></span><span>      </span><span class="annot"><span class="annottext">Path '[Text] 'Closed
-&gt; HVectElim '[Text] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><span class="hs-identifier hs-var">Spock.get</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;console&quot;</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
-&gt; Path '[Text] 'Closed -&gt; Path (Append '[] '[Text]) 'Closed
forall (as :: [*]) (bs :: [*]) (ps :: PathState).
Path as 'Open -&gt; Path bs ps -&gt; Path (Append as bs) ps
</span><span class="hs-operator hs-var">&lt;//&gt;</span></span><span> </span><span class="annot"><span class="annottext">Path '[Text] 'Closed
</span><span class="hs-identifier hs-var">Spock.wildcard</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HVectElim '[Text] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[Text] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689328902"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689328902"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1144"></span><span>        </span><span id="local-6989586621689328901"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689328901"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m Request
forall (m :: * -&gt; *) ctx. MonadIO m =&gt; ActionCtxT ctx m Request
</span><span class="hs-identifier hs-var">Spock.request</span></span><span>
</span><span id="line-1145"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689328900"><span class="annot"><span class="annottext">headers :: [Header]
</span><a href="#local-6989586621689328900"><span class="hs-identifier hs-var hs-var">headers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request -&gt; [Header]
</span><span class="hs-identifier hs-var hs-var">Wai.requestHeaders</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689328901"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-1146"></span><span>            </span><span id="local-6989586621689328899"><span class="annot"><span class="annottext">authMode :: AuthMode
</span><a href="#local-6989586621689328899"><span class="hs-identifier hs-var hs-var">authMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerCtx -&gt; AuthMode
</span><a href="Hasura.Server.App.html#scAuthMode"><span class="hs-identifier hs-var hs-var">scAuthMode</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span><span>
</span><span id="line-1147"></span><span>        </span><span id="local-6989586621689328898"><span class="annot"><span class="annottext">Either String Text
</span><a href="#local-6989586621689328898"><span class="hs-identifier hs-var">consoleHtml</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Either String Text) -&gt; ActionCtxT () m (Either String Text)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either String Text) -&gt; ActionCtxT () m (Either String Text))
-&gt; m (Either String Text) -&gt; ActionCtxT () m (Either String Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; AuthMode -&gt; Bool -&gt; Maybe Text -&gt; m (Either String Text)
forall (m :: * -&gt; *).
ConsoleRenderer m =&gt;
Text -&gt; AuthMode -&gt; Bool -&gt; Maybe Text -&gt; m (Either String Text)
</span><a href="Hasura.Server.App.html#renderConsole"><span class="hs-identifier hs-var">renderConsole</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689328902"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621689328899"><span class="hs-identifier hs-var">authMode</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689329025"><span class="hs-identifier hs-var">enableTelemetry</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689329026"><span class="hs-identifier hs-var">consoleAssetsDir</span></a></span><span>
</span><span id="line-1148"></span><span>        </span><span class="annot"><span class="annottext">(String -&gt; ActionCtxT () m ())
-&gt; (Text -&gt; ActionCtxT () m ())
-&gt; Either String Text
-&gt; ActionCtxT () m ()
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger Hasura
-&gt; LoggingSettings -&gt; [Header] -&gt; QErr -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *).
(MonadIO m, HttpLog m) =&gt;
Logger Hasura
-&gt; LoggingSettings -&gt; [Header] -&gt; QErr -&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#raiseGenericApiError"><span class="hs-identifier hs-var">raiseGenericApiError</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689328926"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerCtx -&gt; LoggingSettings
</span><a href="Hasura.Server.App.html#scLoggingSettings"><span class="hs-identifier hs-var hs-var">scLoggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx
</span><a href="#local-6989586621689329028"><span class="hs-identifier hs-var">serverCtx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689328900"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">(QErr -&gt; ActionCtxT () m ())
-&gt; (String -&gt; QErr) -&gt; String -&gt; ActionCtxT () m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; QErr
</span><a href="Hasura.Base.Error.html#internalError"><span class="hs-identifier hs-var">internalError</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; QErr) -&gt; (String -&gt; Text) -&gt; String -&gt; QErr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) ctx a. MonadIO m =&gt; Text -&gt; ActionCtxT ctx m a
</span><span class="hs-identifier hs-var">Spock.html</span></span><span> </span><span class="annot"><span class="annottext">Either String Text
</span><a href="#local-6989586621689328898"><span class="hs-identifier hs-var">consoleHtml</span></a></span><span>
</span><span id="line-1149"></span><span>
</span><span id="line-1150"></span><span id="local-6989586621689329787"><span class="annot"><a href="Hasura.Server.App.html#raiseGenericApiError"><span class="hs-identifier hs-type">raiseGenericApiError</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1151"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621689329787"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689329787"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1152"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">L.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">L.Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1153"></span><span>  </span><span class="annot"><a href="Hasura.Server.Logging.html#LoggingSettings"><span class="hs-identifier hs-type">LoggingSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1154"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HTTP.Header</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1155"></span><span>  </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1156"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Spock.ActionT</span></span><span> </span><span class="annot"><a href="#local-6989586621689329787"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1157"></span><span id="raiseGenericApiError"><span class="annot"><span class="annottext">raiseGenericApiError :: Logger Hasura
-&gt; LoggingSettings -&gt; [Header] -&gt; QErr -&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#raiseGenericApiError"><span class="hs-identifier hs-var hs-var">raiseGenericApiError</span></a></span></span><span> </span><span id="local-6989586621689328895"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689328895"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621689328894"><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621689328894"><span class="hs-identifier hs-var">loggingSetting</span></a></span></span><span> </span><span id="local-6989586621689328893"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689328893"><span class="hs-identifier hs-var">headers</span></a></span></span><span> </span><span id="local-6989586621689328892"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689328892"><span class="hs-identifier hs-var">qErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1158"></span><span>  </span><span id="local-6989586621689328891"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689328891"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m Request
forall (m :: * -&gt; *) ctx. MonadIO m =&gt; ActionCtxT ctx m Request
</span><span class="hs-identifier hs-var">Spock.request</span></span><span>
</span><span id="line-1159"></span><span>  </span><span id="local-6989586621689328890"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689328890"><span class="hs-identifier hs-var">reqBody</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ByteString -&gt; ActionCtxT () m ByteString
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; ActionCtxT () m ByteString)
-&gt; IO ByteString -&gt; ActionCtxT () m ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; IO ByteString
</span><span class="hs-identifier hs-var">Wai.strictRequestBody</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689328891"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-1160"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621689328889"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689328889"><span class="hs-identifier hs-var">reqId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689328888"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689328888"><span class="hs-identifier hs-var">_newHeaders</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; ActionCtxT () m (RequestId, [Header])
forall (m :: * -&gt; *).
MonadIO m =&gt;
[Header] -&gt; m (RequestId, [Header])
</span><a href="Hasura.Server.Types.html#getRequestId"><span class="hs-identifier hs-var">getRequestId</span></a></span><span> </span><span class="annot"><span class="annottext">([Header] -&gt; ActionCtxT () m (RequestId, [Header]))
-&gt; [Header] -&gt; ActionCtxT () m (RequestId, [Header])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; [Header]
</span><span class="hs-identifier hs-var hs-var">Wai.requestHeaders</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689328891"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-1161"></span><span>  </span><span class="annot"><span class="annottext">m () -&gt; ActionT m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ActionT m ()) -&gt; m () -&gt; ActionT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; QErr
-&gt; [Header]
-&gt; m ()
forall (m :: * -&gt; *).
HttpLog m =&gt;
Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; QErr
-&gt; [Header]
-&gt; m ()
</span><a href="Hasura.Server.Logging.html#logHttpError"><span class="hs-identifier hs-var">logHttpError</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621689328895"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621689328894"><span class="hs-identifier hs-var">loggingSetting</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UserInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621689328889"><span class="hs-identifier hs-var">reqId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621689328891"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689328890"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689328892"><span class="hs-identifier hs-var">qErr</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621689328893"><span class="hs-identifier hs-var">headers</span></a></span><span>
</span><span id="line-1162"></span><span>  </span><span class="annot"><span class="annottext">Header -&gt; ActionT m ()
forall (m :: * -&gt; *). MonadIO m =&gt; Header -&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#setHeader"><span class="hs-identifier hs-var">setHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Header
</span><a href="Hasura.Server.Utils.html#jsonHeader"><span class="hs-identifier hs-var">jsonHeader</span></a></span><span>
</span><span id="line-1163"></span><span>  </span><span class="annot"><span class="annottext">Status -&gt; ActionT m ()
forall (m :: * -&gt; *) ctx.
MonadIO m =&gt;
Status -&gt; ActionCtxT ctx m ()
</span><span class="hs-identifier hs-var">Spock.setStatus</span></span><span> </span><span class="annot"><span class="annottext">(Status -&gt; ActionT m ()) -&gt; Status -&gt; ActionT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; Status
</span><a href="Hasura.Base.Error.html#qeStatus"><span class="hs-identifier hs-var hs-var">qeStatus</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689328892"><span class="hs-identifier hs-var">qErr</span></a></span><span>
</span><span id="line-1164"></span><span>  </span><span class="annot"><span class="annottext">ByteString -&gt; ActionT m ()
forall (m :: * -&gt; *) ctx a.
MonadIO m =&gt;
ByteString -&gt; ActionCtxT ctx m a
</span><span class="hs-identifier hs-var">Spock.lazyBytes</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ActionT m ()) -&gt; ByteString -&gt; ActionT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">encode</span></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621689328892"><span class="hs-identifier hs-var">qErr</span></a></span><span>
</span><span id="line-1165"></span></pre></body></html>