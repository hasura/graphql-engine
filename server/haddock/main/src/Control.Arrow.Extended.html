<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE Arrows #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- see Note [Arrow rewrite rules]</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-inline-rule-shadowing -Wno-orphans #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">-- | The missing standard library for arrows. Some of the functionality in this module is similar to</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Paterson&#8217;s original @arrows@ library, but it has been modernized to work with recent versions of</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- GHC.</span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Control.Arrow.Extended</span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="annot"><span class="hs-identifier">Control.Arrow</span></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Control.Arrow.Trans.html"><span class="hs-identifier">Control.Arrow.Trans</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Control.Arrow.Extended.html#%3E-%3E"><span class="hs-operator">(&gt;-&gt;)</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Control.Arrow.Extended.html#%3C-%3C"><span class="hs-operator">(&lt;-&lt;)</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Control.Arrow.Extended.html#dup"><span class="hs-identifier">dup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Control.Arrow.Extended.html#bothA"><span class="hs-identifier">bothA</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Control.Arrow.Extended.html#orA"><span class="hs-identifier">orA</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Control.Arrow.Extended.html#foldlA%27"><span class="hs-identifier">foldlA'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Control.Arrow.Extended.html#traverseA_"><span class="hs-identifier">traverseA_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Control.Arrow.Extended.html#traverseA"><span class="hs-identifier">traverseA</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Control.Arrow.Extended.html#onNothingA"><span class="hs-identifier">onNothingA</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Control.Arrow.Extended.html#ArrowKleisli"><span class="hs-identifier">ArrowKleisli</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Control.Arrow.Extended.html#bindA"><span class="hs-identifier">bindA</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">where</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Arrow</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.Arrow.Trans.html"><span class="hs-identifier">Control.Arrow.Trans</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Category</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">id</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.)</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">1</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#%3E-%3E"><span class="hs-operator hs-type">&gt;-&gt;</span></a></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">1</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#%3C-%3C"><span class="hs-operator hs-type">&lt;-&lt;</span></a></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-comment">-- | The analog to '&gt;&gt;=' for arrow commands. In @proc@ notation, '&gt;-&gt;' can be used to chain the</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- output of one command into the input of another.</span><span>
</span><span id="line-40"></span><span class="hs-comment">--</span><span>
</span><span id="line-41"></span><span class="hs-comment">-- See also Note [Weird control operator types].</span><span>
</span><span id="line-42"></span><span id="local-6989586621689088653"><span id="local-6989586621689088654"><span id="local-6989586621689088655"><span id="local-6989586621689088656"><span id="local-6989586621689088658"><span class="annot"><a href="Control.Arrow.Extended.html#%3E-%3E"><span class="hs-operator hs-type">(&gt;-&gt;)</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Arrow</span></span><span> </span><span class="annot"><a href="#local-6989586621689088658"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088658"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088656"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689088655"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689088654"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088658"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088656"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088654"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689088655"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689088653"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088658"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088656"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689088655"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689088653"><span class="hs-identifier hs-type">b</span></a></span></span></span></span></span></span><span>
</span><span id="line-43"></span><span id="local-6989586621689088468"><span class="annot"><span class="annottext">arr (e, s) a
</span><a href="#local-6989586621689088468"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="%3E-%3E"><span class="annot"><span class="annottext">&gt;-&gt; :: arr (e, s) a -&gt; arr (e, (a, s)) b -&gt; arr (e, s) b
</span><a href="Control.Arrow.Extended.html#%3E-%3E"><span class="hs-operator hs-var hs-var">&gt;-&gt;</span></a></span></span><span> </span><span id="local-6989586621689088467"><span class="annot"><span class="annottext">arr (e, (a, s)) b
</span><a href="#local-6989586621689088467"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689088466"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621689088466"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689088465"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621689088465"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-44"></span><span>  </span><span id="local-6989586621689088464"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088464"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr (e, s) a
</span><a href="#local-6989586621689088468"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621689088466"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621689088465"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><span class="annottext">arr (e, (a, s)) b
</span><a href="#local-6989586621689088467"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621689088466"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088464"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621689088465"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">&gt;-&gt;</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span id="local-6989586621689088459"><span id="local-6989586621689088460"><span id="local-6989586621689088461"><span id="local-6989586621689088462"><span id="local-6989586621689088463"><span class="annot"><a href="Control.Arrow.Extended.html#%3C-%3C"><span class="hs-operator hs-type">(&lt;-&lt;)</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Arrow</span></span><span> </span><span class="annot"><a href="#local-6989586621689088463"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088463"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088462"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088461"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689088460"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689088459"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088463"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088462"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689088460"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689088461"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088463"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088462"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689088460"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689088459"><span class="hs-identifier hs-type">b</span></a></span></span></span></span></span></span><span>
</span><span id="line-49"></span><span id="%3C-%3C"><span class="annot"><span class="annottext">&lt;-&lt; :: arr (e, (a, s)) b -&gt; arr (e, s) a -&gt; arr (e, s) b
</span><a href="Control.Arrow.Extended.html#%3C-%3C"><span class="hs-operator hs-var hs-var">(&lt;-&lt;)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(arr (e, s) a -&gt; arr (e, (a, s)) b -&gt; arr (e, s) b)
-&gt; arr (e, (a, s)) b -&gt; arr (e, s) a -&gt; arr (e, s) b
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">arr (e, s) a -&gt; arr (e, (a, s)) b -&gt; arr (e, s) b
forall (arr :: * -&gt; * -&gt; *) e s a b.
Arrow arr =&gt;
arr (e, s) a -&gt; arr (e, (a, s)) b -&gt; arr (e, s) b
</span><a href="Control.Arrow.Extended.html#%3E-%3E"><span class="hs-operator hs-var">(&gt;-&gt;)</span></a></span><span>
</span><span id="line-50"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">&lt;-&lt;</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span id="local-6989586621689088456"><span id="local-6989586621689088457"><span class="annot"><a href="Control.Arrow.Extended.html#dup"><span class="hs-identifier hs-type">dup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Arrow</span></span><span> </span><span class="annot"><a href="#local-6989586621689088457"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088457"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088456"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088456"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689088456"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-53"></span><span id="dup"><span class="annot"><span class="annottext">dup :: arr a (a, a)
</span><a href="Control.Arrow.Extended.html#dup"><span class="hs-identifier hs-var hs-var">dup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; (a, a)) -&gt; arr a (a, a)
forall (a :: * -&gt; * -&gt; *) b c. Arrow a =&gt; (b -&gt; c) -&gt; a b c
</span><span class="hs-identifier hs-var">arr</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689088455"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088455"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088455"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088455"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#dup"><span class="hs-pragma hs-type">dup</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span id="local-6989586621689088452"><span id="local-6989586621689088453"><span id="local-6989586621689088454"><span class="annot"><a href="Control.Arrow.Extended.html#bothA"><span class="hs-identifier hs-type">bothA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Arrow</span></span><span> </span><span class="annot"><a href="#local-6989586621689088454"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088454"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088453"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088452"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088454"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088453"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689088453"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088452"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689088452"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-57"></span><span id="bothA"><span class="annot"><span class="annottext">bothA :: arr a b -&gt; arr (a, a) (b, b)
</span><a href="Control.Arrow.Extended.html#bothA"><span class="hs-identifier hs-var hs-var">bothA</span></a></span></span><span> </span><span id="local-6989586621689088451"><span class="annot"><span class="annottext">arr a b
</span><a href="#local-6989586621689088451"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">arr a b
</span><a href="#local-6989586621689088451"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">arr a b -&gt; arr a b -&gt; arr (a, a) (b, b)
forall (a :: * -&gt; * -&gt; *) b c b' c'.
Arrow a =&gt;
a b c -&gt; a b' c' -&gt; a (b, b') (c, c')
</span><span class="hs-operator hs-var">***</span></span><span> </span><span class="annot"><span class="annottext">arr a b
</span><a href="#local-6989586621689088451"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-58"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#bothA"><span class="hs-pragma hs-type">bothA</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span id="local-6989586621689088447"><span id="local-6989586621689088448"><span id="local-6989586621689088449"><span class="annot"><a href="Control.Arrow.Extended.html#orA"><span class="hs-identifier hs-type">orA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ArrowChoice</span></span><span> </span><span class="annot"><a href="#local-6989586621689088449"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088449"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088448"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088449"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088447"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088449"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088448"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689088447"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span></span><span>
</span><span id="line-61"></span><span id="orA"><span class="annot"><span class="annottext">orA :: arr a Bool -&gt; arr b Bool -&gt; arr (a, b) Bool
</span><a href="Control.Arrow.Extended.html#orA"><span class="hs-identifier hs-var hs-var">orA</span></a></span></span><span> </span><span id="local-6989586621689088446"><span class="annot"><span class="annottext">arr a Bool
</span><a href="#local-6989586621689088446"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689088445"><span class="annot"><span class="annottext">arr b Bool
</span><a href="#local-6989586621689088445"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689088444"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088444"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689088443"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689088443"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-62"></span><span>  </span><span id="local-6989586621689088442"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689088442"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr a Bool
</span><a href="#local-6989586621689088446"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088444"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689088442"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">arr Bool Bool
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">arr b Bool
</span><a href="#local-6989586621689088445"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689088443"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-64"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#orA"><span class="hs-pragma hs-type">orA</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-pragma">{-# RULES</span><span> </span><span class="annot"><span class="hs-pragma">&quot;orA/arr&quot;</span></span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088440"><span class="annot"><a href="#local-6989586621689088440"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689088439"><span class="annot"><a href="#local-6989586621689088439"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span> </span><span class="annot"><a href="#local-6989586621689088440"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">orA</span><span class="hs-pragma">`</span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span> </span><span class="annot"><a href="#local-6989586621689088439"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689088440"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">`</span><span class="hs-pragma">orA</span><span class="hs-pragma">`</span><span> </span><span class="annot"><a href="#local-6989586621689088439"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-comment">-- | 'foldl'' lifted to arrows. See also Note [Weird control operator types].</span><span>
</span><span id="line-69"></span><span id="local-6989586621689088592"><span id="local-6989586621689088593"><span id="local-6989586621689088594"><span id="local-6989586621689088595"><span id="local-6989586621689088596"><span id="local-6989586621689088597"><span class="annot"><a href="Control.Arrow.Extended.html#foldlA%27"><span class="hs-identifier hs-type">foldlA'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ArrowChoice</span></span><span> </span><span class="annot"><a href="#local-6989586621689088597"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621689088596"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088597"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088595"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088594"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088593"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689088592"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689088594"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088597"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088595"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088594"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088596"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088593"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689088592"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689088594"><span class="hs-identifier hs-type">b</span></a></span></span></span></span></span></span></span><span>
</span><span id="line-70"></span><span id="foldlA%27"><span class="annot"><span class="annottext">foldlA' :: arr (e, (b, (a, s))) b -&gt; arr (e, (b, (t a, s))) b
</span><a href="Control.Arrow.Extended.html#foldlA%27"><span class="hs-identifier hs-var hs-var">foldlA'</span></a></span></span><span> </span><span id="local-6989586621689088438"><span class="annot"><span class="annottext">arr (e, (b, (a, s))) b
</span><a href="#local-6989586621689088438"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((e, (b, (t a, s))) -&gt; (e, (b, ([a], s))))
-&gt; arr (e, (b, (t a, s))) (e, (b, ([a], s)))
forall (a :: * -&gt; * -&gt; *) b c. Arrow a =&gt; (b -&gt; c) -&gt; a b c
</span><span class="hs-identifier hs-var">arr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621689088437"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621689088437"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689088436"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689088436"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689088435"><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621689088435"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689088434"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621689088434"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621689088437"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689088436"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621689088435"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621689088434"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">arr (e, (b, (t a, s))) (e, (b, ([a], s)))
-&gt; arr (e, (b, ([a], s))) b -&gt; arr (e, (b, (t a, s))) b
forall k (cat :: k -&gt; k -&gt; *) (a :: k) (b :: k) (c :: k).
Category cat =&gt;
cat a b -&gt; cat b c -&gt; cat a c
</span><span class="hs-operator hs-var">&gt;&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">arr (e, (b, ([a], s))) b
</span><a href="#local-6989586621689088431"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-72"></span><span>    </span><span id="local-6989586621689088431"><span class="annot"><span class="annottext">go :: arr (e, (b, ([a], s))) b
</span><a href="#local-6989586621689088431"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">arr (e, (b, ([a], s))) (Either b ((e, (b, (a, s))), (e, ([a], s))))
forall a a a b.
arr (a, (a, ([a], b))) (Either a ((a, (a, (a, b))), (a, ([a], b))))
</span><a href="#local-6989586621689088430"><span class="hs-identifier hs-var">uncons</span></a></span><span> </span><span class="annot"><span class="annottext">arr (e, (b, ([a], s))) (Either b ((e, (b, (a, s))), (e, ([a], s))))
-&gt; arr (Either b ((e, (b, (a, s))), (e, ([a], s)))) b
-&gt; arr (e, (b, ([a], s))) b
forall k (cat :: k -&gt; k -&gt; *) (a :: k) (b :: k) (c :: k).
Category cat =&gt;
cat a b -&gt; cat b c -&gt; cat a c
</span><span class="hs-operator hs-var">&gt;&gt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">arr b b
forall k (cat :: k -&gt; k -&gt; *) (a :: k). Category cat =&gt; cat a a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">arr b b
-&gt; arr ((e, (b, (a, s))), (e, ([a], s))) b
-&gt; arr (Either b ((e, (b, (a, s))), (e, ([a], s)))) b
forall (a :: * -&gt; * -&gt; *) b d c.
ArrowChoice a =&gt;
a b d -&gt; a c d -&gt; a (Either b c) d
</span><span class="hs-operator hs-var">|||</span></span><span> </span><span class="annot"><span class="annottext">arr ((e, (b, (a, s))), (e, ([a], s))) b
</span><a href="#local-6989586621689088428"><span class="hs-identifier hs-var">step</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>    </span><span id="local-6989586621689088430"><span class="annot"><span class="annottext">uncons :: arr (a, (a, ([a], b))) (Either a ((a, (a, (a, b))), (a, ([a], b))))
</span><a href="#local-6989586621689088430"><span class="hs-identifier hs-var hs-var">uncons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, (a, ([a], b))) -&gt; Either a ((a, (a, (a, b))), (a, ([a], b))))
-&gt; arr
     (a, (a, ([a], b))) (Either a ((a, (a, (a, b))), (a, ([a], b))))
forall (a :: * -&gt; * -&gt; *) b c. Arrow a =&gt; (b -&gt; c) -&gt; a b c
</span><span class="hs-identifier hs-var">arr</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621689088427"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088427"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689088426"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088426"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689088425"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621689088425"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689088424"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689088424"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621689088425"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-74"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Either a ((a, (a, (a, b))), (a, ([a], b)))
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088426"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-75"></span><span>      </span><span id="local-6989586621689088423"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088423"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621689088422"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621689088422"><span class="hs-identifier hs-var">xs'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((a, (a, (a, b))), (a, ([a], b)))
-&gt; Either a ((a, (a, (a, b))), (a, ([a], b)))
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088427"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088426"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088423"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689088424"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088427"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621689088422"><span class="hs-identifier hs-var">xs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689088424"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>    </span><span id="local-6989586621689088428"><span class="annot"><span class="annottext">step :: arr ((e, (b, (a, s))), (e, ([a], s))) b
</span><a href="#local-6989586621689088428"><span class="hs-identifier hs-var hs-var">step</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">arr (e, (b, (a, s))) b
-&gt; arr ((e, (b, (a, s))), (e, ([a], s))) (b, (e, ([a], s)))
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">arr (e, (b, (a, s))) b
</span><a href="#local-6989586621689088438"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">arr ((e, (b, (a, s))), (e, ([a], s))) (b, (e, ([a], s)))
-&gt; arr (b, (e, ([a], s))) b
-&gt; arr ((e, (b, (a, s))), (e, ([a], s))) b
forall k (cat :: k -&gt; k -&gt; *) (a :: k) (b :: k) (c :: k).
Category cat =&gt;
cat a b -&gt; cat b c -&gt; cat a c
</span><span class="hs-operator hs-var">&gt;&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">((b, (e, ([a], s))) -&gt; (e, (b, ([a], s))))
-&gt; arr (b, (e, ([a], s))) (e, (b, ([a], s)))
forall (a :: * -&gt; * -&gt; *) b c. Arrow a =&gt; (b -&gt; c) -&gt; a b c
</span><span class="hs-identifier hs-var">arr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621689088421"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689088421"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689088420"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621689088420"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689088419"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621689088419"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689088418"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621689088418"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621689088420"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689088421"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621689088419"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621689088418"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">arr (b, (e, ([a], s))) (e, (b, ([a], s)))
-&gt; arr (e, (b, ([a], s))) b -&gt; arr (b, (e, ([a], s))) b
forall k (cat :: k -&gt; k -&gt; *) (a :: k) (b :: k) (c :: k).
Category cat =&gt;
cat a b -&gt; cat b c -&gt; cat a c
</span><span class="hs-operator hs-var">&gt;&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">arr (e, (b, ([a], s))) b
</span><a href="#local-6989586621689088431"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-77"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#foldlA%27"><span class="hs-pragma hs-type">foldlA'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span id="local-6989586621689088412"><span id="local-6989586621689088413"><span id="local-6989586621689088414"><span id="local-6989586621689088415"><span id="local-6989586621689088416"><span id="local-6989586621689088417"><span class="annot"><a href="Control.Arrow.Extended.html#traverseA_"><span class="hs-identifier hs-type">traverseA_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ArrowChoice</span></span><span> </span><span class="annot"><a href="#local-6989586621689088417"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621689088416"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088417"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088415"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088414"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689088413"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689088412"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088417"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088415"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088416"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088414"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689088413"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-80"></span><span id="traverseA_"><span class="annot"><span class="annottext">traverseA_ :: arr (e, (a, s)) b -&gt; arr (e, (t a, s)) ()
</span><a href="Control.Arrow.Extended.html#traverseA_"><span class="hs-identifier hs-var hs-var">traverseA_</span></a></span></span><span> </span><span id="local-6989586621689088411"><span class="annot"><span class="annottext">arr (e, (a, s)) b
</span><a href="#local-6989586621689088411"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689088410"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621689088410"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689088409"><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621689088409"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689088408"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621689088408"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-glyph">(|</span><span> </span><span class="annot"><span class="annottext">forall a. arr (a, ((), (a, ()))) () -&gt; arr (a, ((), (t a, ()))) ()
forall (arr :: * -&gt; * -&gt; *) (t :: * -&gt; *) e b a s.
(ArrowChoice arr, Foldable t) =&gt;
arr (e, (b, (a, s))) b -&gt; arr (e, (b, (t a, s))) b
</span><a href="Control.Arrow.Extended.html#foldlA%27"><span class="hs-identifier hs-var">foldlA'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span id="local-6989586621689088407"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088407"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621689088410"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088407"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621689088408"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&gt;-</span><span> </span><span class="annot"><span class="annottext">arr (e, (a, s)) b
</span><a href="#local-6989586621689088411"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&gt;-</span><span> </span><span class="annot"><span class="annottext">arr () ()
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621689088409"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-82"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#traverseA_"><span class="hs-pragma hs-type">traverseA_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-comment">-- | An indexed version of Twan van Laarhoven&#8217;s @FunList@ type (see</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- &lt;https://twanvl.nl/blog/haskell/non-regular1&gt;). A value of type @'Traversal' a b (t b)@ is a</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- concrete representation of a traversal applied to a data structure of type @t a@ and producing a</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- value of type @t b@. This explicit representation is used to implement 'traverseA' using only</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- 'ArrowChoice'.</span><span>
</span><span id="line-89"></span><span class="hs-keyword">data</span><span> </span><span id="Traversal"><span class="annot"><a href="Control.Arrow.Extended.html#Traversal"><span class="hs-identifier hs-var">Traversal</span></a></span></span><span> </span><span id="local-6989586621689088578"><span class="annot"><a href="#local-6989586621689088578"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621689088577"><span class="annot"><a href="#local-6989586621689088577"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621689088579"><span class="annot"><a href="#local-6989586621689088579"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Done"><span class="annot"><a href="Control.Arrow.Extended.html#Done"><span class="hs-identifier hs-var">Done</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621689088579"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Yield"><span class="annot"><a href="Control.Arrow.Extended.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621689088578"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088577"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#Traversal"><span class="hs-identifier hs-type">Traversal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088578"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088577"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088579"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span id="local-6989586621689088403"><span id="local-6989586621689088404"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621689088400"><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Arrow.Extended.html#Traversal"><span class="hs-identifier hs-type">Traversal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088404"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088403"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-94"></span><span>  </span><span id="local-6989586621689088398"><span class="annot"><span class="annottext">fmap :: (a -&gt; b) -&gt; Traversal a r a -&gt; Traversal a r b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">fmap</span></span></span><span> </span><span id="local-6989586621689088397"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621689088397"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><a href="Control.Arrow.Extended.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span id="local-6989586621689088396"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088396"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; Traversal a r b
forall a r b. b -&gt; Traversal a r b
</span><a href="Control.Arrow.Extended.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621689088397"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088396"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>    </span><span class="annot"><a href="Control.Arrow.Extended.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621689088395"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088395"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621689088394"><span class="annot"><span class="annottext">r -&gt; Traversal a r a
</span><a href="#local-6989586621689088394"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; (r -&gt; Traversal a r b) -&gt; Traversal a r b
forall a r b. a -&gt; (r -&gt; Traversal a r b) -&gt; Traversal a r b
</span><a href="Control.Arrow.Extended.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088395"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; Traversal a r a -&gt; Traversal a r b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621689088397"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(Traversal a r a -&gt; Traversal a r b)
-&gt; (r -&gt; Traversal a r a) -&gt; r -&gt; Traversal a r b
forall k (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">r -&gt; Traversal a r a
</span><a href="#local-6989586621689088394"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span id="local-6989586621689088391"><span id="local-6989586621689088392"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621689088382"><span id="local-6989586621689088384"><span id="local-6989586621689088386"><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Arrow.Extended.html#Traversal"><span class="hs-identifier hs-type">Traversal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088392"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088391"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-99"></span><span>  </span><span id="local-6989586621689088380"><span class="annot"><span class="annottext">pure :: a -&gt; Traversal a r a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">pure</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Traversal a r a
forall a r b. b -&gt; Traversal a r b
</span><a href="Control.Arrow.Extended.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span id="local-6989586621689088379"><span class="annot"><span class="annottext">Traversal a r (a -&gt; b)
</span><a href="#local-6989586621689088379"><span class="hs-identifier hs-var">tf</span></a></span></span><span> </span><span id="local-6989586621689088378"><span class="annot"><span class="annottext">&lt;*&gt; :: Traversal a r (a -&gt; b) -&gt; Traversal a r a -&gt; Traversal a r b
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;*&gt;</span></span></span><span> </span><span id="local-6989586621689088377"><span class="annot"><span class="annottext">Traversal a r a
</span><a href="#local-6989586621689088377"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Traversal a r (a -&gt; b)
</span><a href="#local-6989586621689088379"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-101"></span><span>    </span><span class="annot"><a href="Control.Arrow.Extended.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span id="local-6989586621689088376"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621689088376"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; Traversal a r a -&gt; Traversal a r b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621689088376"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Traversal a r a
</span><a href="#local-6989586621689088377"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><a href="Control.Arrow.Extended.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621689088375"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088375"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621689088374"><span class="annot"><span class="annottext">r -&gt; Traversal a r (a -&gt; b)
</span><a href="#local-6989586621689088374"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; (r -&gt; Traversal a r b) -&gt; Traversal a r b
forall a r b. a -&gt; (r -&gt; Traversal a r b) -&gt; Traversal a r b
</span><a href="Control.Arrow.Extended.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088375"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Traversal a r (a -&gt; b) -&gt; Traversal a r a -&gt; Traversal a r b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Traversal a r a
</span><a href="#local-6989586621689088377"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Traversal a r (a -&gt; b) -&gt; Traversal a r b)
-&gt; (r -&gt; Traversal a r (a -&gt; b)) -&gt; r -&gt; Traversal a r b
forall k (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">r -&gt; Traversal a r (a -&gt; b)
</span><a href="#local-6989586621689088374"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span id="local-6989586621689088529"><span id="local-6989586621689088530"><span id="local-6989586621689088531"><span class="annot"><a href="Control.Arrow.Extended.html#traversal"><span class="hs-identifier hs-type">traversal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Traversable</span></span><span> </span><span class="annot"><a href="#local-6989586621689088531"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088531"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088530"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#Traversal"><span class="hs-identifier hs-type">Traversal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088530"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088529"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088531"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088529"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-105"></span><span id="traversal"><span class="annot"><span class="annottext">traversal :: t a -&gt; Traversal a b (t b)
</span><a href="Control.Arrow.Extended.html#traversal"><span class="hs-identifier hs-var hs-var">traversal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Traversal a b b) -&gt; t a -&gt; Traversal a b (t b)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; (b -&gt; Traversal a b b) -&gt; Traversal a b b
forall a r b. a -&gt; (r -&gt; Traversal a r b) -&gt; Traversal a r b
</span><a href="Control.Arrow.Extended.html#Yield"><span class="hs-operator hs-var">`Yield`</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; Traversal a b b
forall a r b. b -&gt; Traversal a r b
</span><a href="Control.Arrow.Extended.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-comment">-- | 'traverse' lifted to arrows. See also Note [Weird control operator types].</span><span>
</span><span id="line-108"></span><span id="local-6989586621689088366"><span id="local-6989586621689088367"><span id="local-6989586621689088368"><span id="local-6989586621689088369"><span id="local-6989586621689088370"><span id="local-6989586621689088371"><span class="annot"><a href="Control.Arrow.Extended.html#traverseA"><span class="hs-identifier hs-type">traverseA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ArrowChoice</span></span><span> </span><span class="annot"><a href="#local-6989586621689088371"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Traversable</span></span><span> </span><span class="annot"><a href="#local-6989586621689088370"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088371"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088369"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088368"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689088367"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689088366"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088371"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088369"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088370"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088368"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689088367"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088370"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088366"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-109"></span><span id="traverseA"><span class="annot"><span class="annottext">traverseA :: arr (e, (a, s)) b -&gt; arr (e, (t a, s)) (t b)
</span><a href="Control.Arrow.Extended.html#traverseA"><span class="hs-identifier hs-var hs-var">traverseA</span></a></span></span><span> </span><span id="local-6989586621689088365"><span class="annot"><span class="annottext">arr (e, (a, s)) b
</span><a href="#local-6989586621689088365"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">arr (t a, s) (Traversal a b (t b), s)
-&gt; arr (e, (t a, s)) (e, (Traversal a b (t b), s))
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">arr (t a) (Traversal a b (t b))
-&gt; arr (t a, s) (Traversal a b (t b), s)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">(arr (t a) (Traversal a b (t b))
 -&gt; arr (t a, s) (Traversal a b (t b), s))
-&gt; arr (t a) (Traversal a b (t b))
-&gt; arr (t a, s) (Traversal a b (t b), s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(t a -&gt; Traversal a b (t b)) -&gt; arr (t a) (Traversal a b (t b))
forall (a :: * -&gt; * -&gt; *) b c. Arrow a =&gt; (b -&gt; c) -&gt; a b c
</span><span class="hs-identifier hs-var">arr</span></span><span> </span><span class="annot"><span class="annottext">t a -&gt; Traversal a b (t b)
forall (t :: * -&gt; *) a b.
Traversable t =&gt;
t a -&gt; Traversal a b (t b)
</span><a href="Control.Arrow.Extended.html#traversal"><span class="hs-identifier hs-var">traversal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">arr (e, (t a, s)) (e, (Traversal a b (t b), s))
-&gt; arr (e, (Traversal a b (t b), s)) (t b)
-&gt; arr (e, (t a, s)) (t b)
forall k (cat :: k -&gt; k -&gt; *) (a :: k) (b :: k) (c :: k).
Category cat =&gt;
cat a b -&gt; cat b c -&gt; cat a c
</span><span class="hs-operator hs-var">&gt;&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">arr (e, (Traversal a b (t b), s)) (t b)
</span><a href="#local-6989586621689088363"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-111"></span><span>    </span><span id="local-6989586621689088363"><span class="annot"><span class="annottext">go :: arr (e, (Traversal a b (t b), s)) (t b)
</span><a href="#local-6989586621689088363"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689088362"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621689088362"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689088361"><span class="annot"><span class="annottext">Traversal a b (t b)
</span><a href="#local-6989586621689088361"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689088360"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621689088360"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Traversal a b (t b)
</span><a href="#local-6989586621689088361"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-112"></span><span>      </span><span class="annot"><a href="Control.Arrow.Extended.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span id="local-6989586621689088359"><span class="annot"><span class="annottext">t b
</span><a href="#local-6989586621689088359"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">arr (t b) (t b)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">t b
</span><a href="#local-6989586621689088359"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><a href="Control.Arrow.Extended.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621689088358"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088358"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621689088357"><span class="annot"><span class="annottext">b -&gt; Traversal a b (t b)
</span><a href="#local-6989586621689088357"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-114"></span><span>        </span><span id="local-6989586621689088356"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689088356"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">arr (e, (a, s)) b
</span><a href="#local-6989586621689088365"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621689088362"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088358"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621689088360"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>        </span><span class="annot"><span class="annottext">arr (e, (Traversal a b (t b), s)) (t b)
</span><a href="#local-6989586621689088363"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621689088362"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; Traversal a b (t b)
</span><a href="#local-6989586621689088357"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621689088356"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621689088360"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#traverseA"><span class="hs-pragma hs-type">traverseA</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">-- In the common case of using traverseA on Maybe, the general traverseA generates needlessly</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- complex code due to the combination of recursion and indirection through Traversal. Since Maybe</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- is finite, we can do much better by avoiding the recursion completely.</span><span>
</span><span id="line-121"></span><span id="local-6989586621689088351"><span id="local-6989586621689088352"><span id="local-6989586621689088353"><span id="local-6989586621689088354"><span id="local-6989586621689088355"><span class="annot"><a href="Control.Arrow.Extended.html#traverseA_Maybe"><span class="hs-identifier hs-type">traverseA_Maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ArrowChoice</span></span><span> </span><span class="annot"><a href="#local-6989586621689088355"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088355"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088354"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088353"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689088352"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689088351"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088355"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088354"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621689088353"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689088352"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621689088351"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-122"></span><span id="traverseA_Maybe"><span class="annot"><span class="annottext">traverseA_Maybe :: arr (e, (a, s)) b -&gt; arr (e, (Maybe a, s)) (Maybe b)
</span><a href="Control.Arrow.Extended.html#traverseA_Maybe"><span class="hs-identifier hs-var hs-var">traverseA_Maybe</span></a></span></span><span> </span><span id="local-6989586621689088349"><span class="annot"><span class="annottext">arr (e, (a, s)) b
</span><a href="#local-6989586621689088349"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689088348"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621689088348"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689088347"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621689088347"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689088346"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621689088346"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621689088347"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-123"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621689088345"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088345"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(b -&gt; Maybe b) -&gt; arr b (Maybe b)
forall (a :: * -&gt; * -&gt; *) b c. Arrow a =&gt; (b -&gt; c) -&gt; a b c
</span><span class="hs-identifier hs-var">arr</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; Maybe b
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">arr b (Maybe b) -&gt; arr (e, (a, s)) b -&gt; arr (e, (a, s)) (Maybe b)
forall k (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">arr (e, (a, s)) b
</span><a href="#local-6989586621689088349"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621689088348"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088345"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621689088346"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>  </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">arr (Maybe b) (Maybe b)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Maybe b
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-125"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#traverseA_Maybe"><span class="hs-pragma hs-type">traverseA_Maybe</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-pragma">{-# RULES</span><span> </span><span class="annot"><span class="hs-pragma">&quot;traverseA @Maybe&quot;</span></span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#traverseA"><span class="hs-pragma hs-type">traverseA</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#traverseA_Maybe"><span class="hs-pragma hs-type">traverseA_Maybe</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span id="local-6989586621689088341"><span id="local-6989586621689088342"><span id="local-6989586621689088343"><span id="local-6989586621689088344"><span class="annot"><a href="Control.Arrow.Extended.html#onNothingA"><span class="hs-identifier hs-type">onNothingA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ArrowChoice</span></span><span> </span><span class="annot"><a href="#local-6989586621689088344"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088344"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088343"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689088342"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689088341"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088344"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088343"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621689088341"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621689088342"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689088341"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-130"></span><span id="onNothingA"><span class="annot"><span class="annottext">onNothingA :: arr (e, s) a -&gt; arr (e, (Maybe a, s)) a
</span><a href="Control.Arrow.Extended.html#onNothingA"><span class="hs-identifier hs-var hs-var">onNothingA</span></a></span></span><span> </span><span id="local-6989586621689088340"><span class="annot"><span class="annottext">arr (e, s) a
</span><a href="#local-6989586621689088340"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689088339"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621689088339"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621689088338"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621689088338"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689088337"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621689088337"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621689088338"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621689088336"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088336"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">arr a a
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621689088336"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">arr (e, s) a
</span><a href="#local-6989586621689088340"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621689088339"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621689088337"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#onNothingA"><span class="hs-pragma hs-type">onNothingA</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-comment">-- These rules are missing from Control.Arrow; see Note [Arrow rewrite rules]</span><span class="hs-cpp">
#ifndef __HLINT__
</span><span class="hs-pragma">{-# RULES</span><span>
</span><span id="line-138"></span><span class="annot"><span class="hs-pragma">&quot;arr/arr/R&quot;</span></span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088335"><span class="annot"><a href="#local-6989586621689088335"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689088334"><span class="annot"><a href="#local-6989586621689088334"><span class="hs-pragma hs-var">g</span></a></span></span><span> </span><span id="local-6989586621689088333"><span class="annot"><a href="#local-6989586621689088333"><span class="hs-pragma hs-var">h</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span> </span><span class="annot"><a href="#local-6989586621689088335"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span> </span><span class="annot"><a href="#local-6989586621689088334"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="#local-6989586621689088333"><span class="hs-pragma hs-type">h</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689088335"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="#local-6989586621689088334"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="#local-6989586621689088333"><span class="hs-pragma hs-type">h</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="annot"><span class="hs-pragma">&quot;&amp;&amp;&amp;/id&quot;</span></span><span>    </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088332"><span class="annot"><a href="#local-6989586621689088332"><span class="hs-pragma hs-var">f</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="#local-6989586621689088332"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">&amp;&amp;&amp;</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">id</span></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><span class="hs-pragma hs-type">first</span></span><span>  </span><span class="annot"><a href="#local-6989586621689088332"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#dup"><span class="hs-pragma hs-type">dup</span></a></span><span>
</span><span id="line-141"></span><span class="annot"><span class="hs-pragma">&quot;id/&amp;&amp;&amp;&quot;</span></span><span>    </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088330"><span class="annot"><a href="#local-6989586621689088330"><span class="hs-pragma hs-var">f</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><span class="hs-pragma hs-type">id</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">&amp;&amp;&amp;</span></span><span> </span><span class="annot"><a href="#local-6989586621689088330"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><span class="hs-pragma hs-type">second</span></span><span> </span><span class="annot"><a href="#local-6989586621689088330"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#dup"><span class="hs-pragma hs-type">dup</span></a></span><span>
</span><span id="line-142"></span><span class="annot"><span class="hs-pragma">&quot;&amp;&amp;&amp;/arr&quot;</span></span><span>   </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088329"><span class="annot"><a href="#local-6989586621689088329"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689088328"><span class="annot"><a href="#local-6989586621689088328"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="#local-6989586621689088329"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">&amp;&amp;&amp;</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span> </span><span class="annot"><a href="#local-6989586621689088328"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><span class="hs-pragma hs-type">first</span></span><span>  </span><span class="annot"><a href="#local-6989586621689088329"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">id</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">&amp;&amp;&amp;</span></span><span> </span><span class="annot"><a href="#local-6989586621689088328"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-143"></span><span class="annot"><span class="hs-pragma">&quot;arr/&amp;&amp;&amp;&quot;</span></span><span>   </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088327"><span class="annot"><a href="#local-6989586621689088327"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689088326"><span class="annot"><a href="#local-6989586621689088326"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span> </span><span class="annot"><a href="#local-6989586621689088327"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">&amp;&amp;&amp;</span></span><span> </span><span class="annot"><a href="#local-6989586621689088326"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><span class="hs-pragma hs-type">second</span></span><span> </span><span class="annot"><a href="#local-6989586621689088326"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689088327"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">&amp;&amp;&amp;</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">id</span></span><span class="hs-pragma">)</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="annot"><span class="hs-pragma">&quot;|||/id&quot;</span></span><span>    </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088325"><span class="annot"><a href="#local-6989586621689088325"><span class="hs-pragma hs-var">f</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="#local-6989586621689088325"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">|||</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">id</span></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">id</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">|||</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">id</span></span><span class="hs-pragma">)</span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">left</span></span><span> </span><span class="annot"><a href="#local-6989586621689088325"><span class="hs-pragma hs-type">f</span></a></span><span>
</span><span id="line-146"></span><span class="annot"><span class="hs-pragma">&quot;id/|||&quot;</span></span><span>    </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088323"><span class="annot"><a href="#local-6989586621689088323"><span class="hs-pragma hs-var">f</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><span class="hs-pragma hs-type">id</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">|||</span></span><span> </span><span class="annot"><a href="#local-6989586621689088323"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">id</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">|||</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">id</span></span><span class="hs-pragma">)</span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">right</span></span><span> </span><span class="annot"><a href="#local-6989586621689088323"><span class="hs-pragma hs-type">f</span></a></span><span>
</span><span id="line-147"></span><span class="annot"><span class="hs-pragma">&quot;|||/arr&quot;</span></span><span>   </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088321"><span class="annot"><a href="#local-6989586621689088321"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689088320"><span class="annot"><a href="#local-6989586621689088320"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="#local-6989586621689088321"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">|||</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span> </span><span class="annot"><a href="#local-6989586621689088320"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">id</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">|||</span></span><span> </span><span class="annot"><a href="#local-6989586621689088320"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">left</span></span><span> </span><span class="annot"><a href="#local-6989586621689088321"><span class="hs-pragma hs-type">f</span></a></span><span>
</span><span id="line-148"></span><span class="annot"><span class="hs-pragma">&quot;arr/|||&quot;</span></span><span>   </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088319"><span class="annot"><a href="#local-6989586621689088319"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689088318"><span class="annot"><a href="#local-6989586621689088318"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span> </span><span class="annot"><a href="#local-6989586621689088319"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">|||</span></span><span> </span><span class="annot"><a href="#local-6989586621689088318"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689088319"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">|||</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">id</span></span><span class="hs-pragma">)</span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">right</span></span><span> </span><span class="annot"><a href="#local-6989586621689088318"><span class="hs-pragma hs-type">g</span></a></span><span>
</span><span id="line-149"></span><span class="hs-pragma">#-}</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-comment">-- | The class of /Kleisli arrows/, arrows made from monadic functions. Instances should satisfy</span><span>
</span><span id="line-152"></span><span class="hs-comment">-- the following laws:</span><span>
</span><span id="line-153"></span><span class="hs-comment">--</span><span>
</span><span id="line-154"></span><span class="hs-comment">--   * @'arrM' ('pure' '.' /f/)@ &#8801; @'arr' /f/@</span><span>
</span><span id="line-155"></span><span class="hs-comment">--   * @('arrM' /f/ '&gt;&gt;&gt;' 'arrM' /g/)@ &#8801; @'arrM' (/f/ '&gt;=&gt;' /g/)@.</span><span>
</span><span id="line-156"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621689088515"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Arrow</span></span><span> </span><span class="annot"><a href="#local-6989586621689088514"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="ArrowKleisli"><span class="annot"><a href="Control.Arrow.Extended.html#ArrowKleisli"><span class="hs-identifier hs-var">ArrowKleisli</span></a></span></span><span> </span><span id="local-6989586621689088515"><span class="annot"><a href="#local-6989586621689088515"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621689088514"><span class="annot"><a href="#local-6989586621689088514"><span class="hs-identifier hs-type">arr</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621689088514"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088515"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-157"></span><span>  </span><span id="local-6989586621689088511"><span id="local-6989586621689088512"><span id="arrM"><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-identifier hs-type">arrM</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088512"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088515"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088511"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088514"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088512"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088511"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-pragma">{-# RULES</span><span> </span><span class="hs-pragma">-- see Note [Arrow rewrite rules]</span><span>
</span><span id="line-160"></span><span class="annot"><span class="hs-pragma">&quot;arrM/pure&quot;</span></span><span>             </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">pure</span></span><span>       </span><span class="hs-pragma">=</span><span> </span><span class="annot"><span class="hs-pragma hs-type">id</span></span><span>
</span><span id="line-161"></span><span class="annot"><span class="hs-pragma">&quot;arrM/pure/f&quot;</span></span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088316"><span class="annot"><a href="#local-6989586621689088316"><span class="hs-pragma hs-var">f</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="#local-6989586621689088316"><span class="hs-pragma hs-type">f</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span> </span><span class="annot"><a href="#local-6989586621689088316"><span class="hs-pragma hs-type">f</span></a></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="annot"><span class="hs-pragma">&quot;arr/arrM&quot;</span></span><span>    </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088315"><span class="annot"><a href="#local-6989586621689088315"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689088314"><span class="annot"><a href="#local-6989586621689088314"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span>  </span><span class="annot"><a href="#local-6989586621689088315"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088314"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">fmap</span></span><span> </span><span class="annot"><a href="#local-6989586621689088315"><span class="hs-pragma hs-type">f</span></a></span><span>  </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span>  </span><span class="annot"><a href="#local-6989586621689088314"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-164"></span><span class="annot"><span class="hs-pragma">&quot;arrM/arr&quot;</span></span><span>    </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088313"><span class="annot"><a href="#local-6989586621689088313"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689088312"><span class="annot"><a href="#local-6989586621689088312"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088313"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span>  </span><span class="annot"><a href="#local-6989586621689088312"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span>      </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689088313"><span class="hs-pragma hs-type">f</span></a></span><span>  </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span>  </span><span class="annot"><a href="#local-6989586621689088312"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-165"></span><span class="annot"><span class="hs-pragma">&quot;arrM/arrM&quot;</span></span><span>   </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088311"><span class="annot"><a href="#local-6989586621689088311"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689088310"><span class="annot"><a href="#local-6989586621689088310"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088311"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088310"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span>      </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689088311"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">&lt;=&lt;</span></span><span> </span><span class="annot"><a href="#local-6989586621689088310"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="annot"><span class="hs-pragma">&quot;arr/arrM/R&quot;</span></span><span>  </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088308"><span class="annot"><a href="#local-6989586621689088308"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689088307"><span class="annot"><a href="#local-6989586621689088307"><span class="hs-pragma hs-var">g</span></a></span></span><span> </span><span id="local-6989586621689088306"><span class="annot"><a href="#local-6989586621689088306"><span class="hs-pragma hs-var">h</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span>  </span><span class="annot"><a href="#local-6989586621689088308"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088307"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="#local-6989586621689088306"><span class="hs-pragma hs-type">h</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">fmap</span></span><span> </span><span class="annot"><a href="#local-6989586621689088308"><span class="hs-pragma hs-type">f</span></a></span><span>  </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span>  </span><span class="annot"><a href="#local-6989586621689088307"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="#local-6989586621689088306"><span class="hs-pragma hs-type">h</span></a></span><span>
</span><span id="line-168"></span><span class="annot"><span class="hs-pragma">&quot;arrM/arr/R&quot;</span></span><span>  </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088305"><span class="annot"><a href="#local-6989586621689088305"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689088304"><span class="annot"><a href="#local-6989586621689088304"><span class="hs-pragma hs-var">g</span></a></span></span><span> </span><span id="local-6989586621689088303"><span class="annot"><a href="#local-6989586621689088303"><span class="hs-pragma hs-var">h</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088305"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span>  </span><span class="annot"><a href="#local-6989586621689088304"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="#local-6989586621689088303"><span class="hs-pragma hs-type">h</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span>      </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689088305"><span class="hs-pragma hs-type">f</span></a></span><span>  </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span>  </span><span class="annot"><a href="#local-6989586621689088304"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="#local-6989586621689088303"><span class="hs-pragma hs-type">h</span></a></span><span>
</span><span id="line-169"></span><span class="annot"><span class="hs-pragma">&quot;arrM/arrM/R&quot;</span></span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088302"><span class="annot"><a href="#local-6989586621689088302"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689088301"><span class="annot"><a href="#local-6989586621689088301"><span class="hs-pragma hs-var">g</span></a></span></span><span> </span><span id="local-6989586621689088300"><span class="annot"><a href="#local-6989586621689088300"><span class="hs-pragma hs-var">h</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088302"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088301"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="#local-6989586621689088300"><span class="hs-pragma hs-type">h</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span>      </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621689088302"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">&lt;=&lt;</span></span><span> </span><span class="annot"><a href="#local-6989586621689088301"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span> </span><span class="annot"><span class="hs-pragma hs-type">.</span></span><span> </span><span class="annot"><a href="#local-6989586621689088300"><span class="hs-pragma hs-type">h</span></a></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="annot"><span class="hs-pragma">&quot;first/arrM&quot;</span></span><span>  </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088299"><span class="annot"><a href="#local-6989586621689088299"><span class="hs-pragma hs-var">f</span></a></span></span><span class="hs-pragma">.</span><span>  </span><span class="annot"><span class="hs-pragma hs-type">first</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088299"><span class="hs-pragma hs-type">f</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-var">runKleisli</span></span><span>  </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">first</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Kleisli</span></span><span> </span><span class="annot"><a href="#local-6989586621689088299"><span class="hs-pragma hs-type">f</span></a></span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span>
</span><span id="line-172"></span><span class="annot"><span class="hs-pragma">&quot;second/arrM&quot;</span></span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088296"><span class="annot"><a href="#local-6989586621689088296"><span class="hs-pragma hs-var">f</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><span class="hs-pragma hs-type">second</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088296"><span class="hs-pragma hs-type">f</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-var">runKleisli</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">second</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Kleisli</span></span><span> </span><span class="annot"><a href="#local-6989586621689088296"><span class="hs-pragma hs-type">f</span></a></span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span>
</span><span id="line-173"></span><span class="annot"><span class="hs-pragma">&quot;left/arrM&quot;</span></span><span>   </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088295"><span class="annot"><a href="#local-6989586621689088295"><span class="hs-pragma hs-var">f</span></a></span></span><span class="hs-pragma">.</span><span>   </span><span class="annot"><span class="hs-pragma hs-type">left</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088295"><span class="hs-pragma hs-type">f</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-var">runKleisli</span></span><span>   </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">left</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Kleisli</span></span><span> </span><span class="annot"><a href="#local-6989586621689088295"><span class="hs-pragma hs-type">f</span></a></span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span>
</span><span id="line-174"></span><span class="annot"><span class="hs-pragma">&quot;right/arrM&quot;</span></span><span>  </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088294"><span class="annot"><a href="#local-6989586621689088294"><span class="hs-pragma hs-var">f</span></a></span></span><span class="hs-pragma">.</span><span>  </span><span class="annot"><span class="hs-pragma hs-type">right</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088294"><span class="hs-pragma hs-type">f</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-var">runKleisli</span></span><span>  </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">right</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Kleisli</span></span><span> </span><span class="annot"><a href="#local-6989586621689088294"><span class="hs-pragma hs-type">f</span></a></span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="annot"><span class="hs-pragma">&quot;***/arrM&quot;</span></span><span>    </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088293"><span class="annot"><a href="#local-6989586621689088293"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689088292"><span class="annot"><a href="#local-6989586621689088292"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088293"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">***</span></span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088292"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-var">runKleisli</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Kleisli</span></span><span> </span><span class="annot"><a href="#local-6989586621689088293"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">***</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Kleisli</span></span><span> </span><span class="annot"><a href="#local-6989586621689088292"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span>
</span><span id="line-177"></span><span class="annot"><span class="hs-pragma">&quot;&amp;&amp;&amp;/arrM&quot;</span></span><span>    </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088291"><span class="annot"><a href="#local-6989586621689088291"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689088290"><span class="annot"><a href="#local-6989586621689088290"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088291"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">&amp;&amp;&amp;</span></span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088290"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-var">runKleisli</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Kleisli</span></span><span> </span><span class="annot"><a href="#local-6989586621689088291"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">&amp;&amp;&amp;</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Kleisli</span></span><span> </span><span class="annot"><a href="#local-6989586621689088290"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span>
</span><span id="line-178"></span><span class="annot"><span class="hs-pragma">&quot;+++/arrM&quot;</span></span><span>    </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088289"><span class="annot"><a href="#local-6989586621689088289"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689088288"><span class="annot"><a href="#local-6989586621689088288"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088289"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">+++</span></span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088288"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-var">runKleisli</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Kleisli</span></span><span> </span><span class="annot"><a href="#local-6989586621689088289"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">+++</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Kleisli</span></span><span> </span><span class="annot"><a href="#local-6989586621689088288"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span>
</span><span id="line-179"></span><span class="annot"><span class="hs-pragma">&quot;|||/arrM&quot;</span></span><span>    </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621689088286"><span class="annot"><a href="#local-6989586621689088286"><span class="hs-pragma hs-var">f</span></a></span></span><span> </span><span id="local-6989586621689088285"><span class="annot"><a href="#local-6989586621689088285"><span class="hs-pragma hs-var">g</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088286"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">|||</span></span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088285"><span class="hs-pragma hs-type">g</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-var">runKleisli</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Kleisli</span></span><span> </span><span class="annot"><a href="#local-6989586621689088286"><span class="hs-pragma hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">|||</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Kleisli</span></span><span> </span><span class="annot"><a href="#local-6989586621689088285"><span class="hs-pragma hs-type">g</span></a></span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span>
</span><span id="line-180"></span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- | A combinator that serves a similar role to 'returnA' in arrow notation, except that the</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- argument is a monadic action instead of a pure value. Just as 'returnA' is actually just</span><span>
</span><span id="line-185"></span><span class="hs-comment">-- @'arr' 'id'@, 'bindA' is just @'arrM' 'id'@, but it is provided as a separate function for</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- clarity.</span><span>
</span><span id="line-187"></span><span class="hs-comment">--</span><span>
</span><span id="line-188"></span><span class="hs-comment">-- 'bindA' is useful primarily because it allows executing a monadic action using arrow inputs</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- currently in scope. For example:</span><span>
</span><span id="line-190"></span><span class="hs-comment">--</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- proc (a, b) -&gt; do</span><span>
</span><span id="line-193"></span><span class="hs-comment">--   x &lt;- foo -&lt; a</span><span>
</span><span id="line-194"></span><span class="hs-comment">--   y &lt;- bar -&lt; b</span><span>
</span><span id="line-195"></span><span class="hs-comment">--   'bindA' -&lt; f x y</span><span>
</span><span id="line-196"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-197"></span><span class="hs-comment">--</span><span>
</span><span id="line-198"></span><span class="hs-comment">-- The last statement is equivalent to @'arrM' ('uncurry' f) -&lt; (x, y)@, but the use of 'bindA'</span><span>
</span><span id="line-199"></span><span class="hs-comment">-- allows it to be expressed more directly.</span><span>
</span><span id="line-200"></span><span id="local-6989586621689088282"><span id="local-6989586621689088283"><span id="local-6989586621689088284"><span class="annot"><a href="Control.Arrow.Extended.html#bindA"><span class="hs-identifier hs-type">bindA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Arrow.Extended.html#ArrowKleisli"><span class="hs-identifier hs-type">ArrowKleisli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088284"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088283"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689088283"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621689088284"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088282"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621689088282"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-201"></span><span id="bindA"><span class="annot"><span class="annottext">bindA :: arr (m a) a
</span><a href="Control.Arrow.Extended.html#bindA"><span class="hs-identifier hs-var hs-var">bindA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(m a -&gt; m a) -&gt; arr (m a) a
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a b.
ArrowKleisli m arr =&gt;
(a -&gt; m b) -&gt; arr a b
</span><a href="Control.Arrow.Extended.html#arrM"><span class="hs-identifier hs-var">arrM</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; m a
forall k (cat :: k -&gt; k -&gt; *) (a :: k). Category cat =&gt; cat a a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-202"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#bindA"><span class="hs-pragma hs-type">bindA</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span id="local-6989586621689088281"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621689088281"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#ArrowKleisli"><span class="hs-identifier hs-type">ArrowKleisli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088281"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Kleisli</span></span><span> </span><span class="annot"><a href="#local-6989586621689088281"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-205"></span><span>  </span><span id="local-6989586621689088276"><span class="annot"><span class="annottext">arrM :: (a -&gt; m b) -&gt; Kleisli m a b
</span><a href="#local-6989586621689088276"><span class="hs-identifier hs-var hs-var hs-var hs-var">arrM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; m b) -&gt; Kleisli m a b
forall (m :: * -&gt; *) a b. (a -&gt; m b) -&gt; Kleisli m a b
</span><span class="hs-identifier hs-var">Kleisli</span></span></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span id="local-6989586621689088273"><span id="local-6989586621689088274"><span id="local-6989586621689088275"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Arrow.Extended.html#ArrowKleisli"><span class="hs-identifier hs-type">ArrowKleisli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088275"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088274"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ArrowChoice</span></span><span> </span><span class="annot"><a href="#local-6989586621689088274"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#ArrowKleisli"><span class="hs-identifier hs-type">ArrowKleisli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088275"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Arrow.Trans.html#ErrorA"><span class="hs-identifier hs-type">ErrorA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088273"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088274"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-208"></span><span>  </span><span id="local-6989586621689088269"><span class="annot"><span class="annottext">arrM :: (a -&gt; m b) -&gt; ErrorA e arr a b
</span><a href="#local-6989586621689088269"><span class="hs-identifier hs-var hs-var hs-var hs-var">arrM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">arr a b -&gt; ErrorA e arr a b
forall (t :: (* -&gt; * -&gt; *) -&gt; * -&gt; * -&gt; *) (arr :: * -&gt; * -&gt; *) a
       b.
ArrowTrans t arr =&gt;
arr a b -&gt; t arr a b
</span><a href="Control.Arrow.Trans.html#liftA"><span class="hs-identifier hs-var">liftA</span></a></span><span> </span><span class="annot"><span class="annottext">(arr a b -&gt; ErrorA e arr a b)
-&gt; ((a -&gt; m b) -&gt; arr a b) -&gt; (a -&gt; m b) -&gt; ErrorA e arr a b
forall k (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; m b) -&gt; arr a b
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a b.
ArrowKleisli m arr =&gt;
(a -&gt; m b) -&gt; arr a b
</span><a href="Control.Arrow.Extended.html#arrM"><span class="hs-identifier hs-var">arrM</span></a></span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span id="local-6989586621689088265"><span id="local-6989586621689088266"><span id="local-6989586621689088267"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Arrow.Extended.html#ArrowKleisli"><span class="hs-identifier hs-type">ArrowKleisli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088267"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088266"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#ArrowKleisli"><span class="hs-identifier hs-type">ArrowKleisli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088267"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Arrow.Trans.html#ReaderA"><span class="hs-identifier hs-type">ReaderA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088265"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088266"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-212"></span><span>  </span><span id="local-6989586621689088261"><span class="annot"><span class="annottext">arrM :: (a -&gt; m b) -&gt; ReaderA r arr a b
</span><a href="#local-6989586621689088261"><span class="hs-identifier hs-var hs-var hs-var hs-var">arrM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">arr a b -&gt; ReaderA r arr a b
forall (t :: (* -&gt; * -&gt; *) -&gt; * -&gt; * -&gt; *) (arr :: * -&gt; * -&gt; *) a
       b.
ArrowTrans t arr =&gt;
arr a b -&gt; t arr a b
</span><a href="Control.Arrow.Trans.html#liftA"><span class="hs-identifier hs-var">liftA</span></a></span><span> </span><span class="annot"><span class="annottext">(arr a b -&gt; ReaderA r arr a b)
-&gt; ((a -&gt; m b) -&gt; arr a b) -&gt; (a -&gt; m b) -&gt; ReaderA r arr a b
forall k (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; m b) -&gt; arr a b
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a b.
ArrowKleisli m arr =&gt;
(a -&gt; m b) -&gt; arr a b
</span><a href="Control.Arrow.Extended.html#arrM"><span class="hs-identifier hs-var">arrM</span></a></span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span id="local-6989586621689088258"><span id="local-6989586621689088259"><span id="local-6989586621689088260"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Arrow.Extended.html#ArrowKleisli"><span class="hs-identifier hs-type">ArrowKleisli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088260"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088259"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#ArrowKleisli"><span class="hs-identifier hs-type">ArrowKleisli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088260"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Arrow.Trans.html#WriterA"><span class="hs-identifier hs-type">WriterA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088258"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689088259"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-216"></span><span>  </span><span id="local-6989586621689088254"><span class="annot"><span class="annottext">arrM :: (a -&gt; m b) -&gt; WriterA w arr a b
</span><a href="#local-6989586621689088254"><span class="hs-identifier hs-var hs-var hs-var hs-var">arrM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">arr a b -&gt; WriterA w arr a b
forall (t :: (* -&gt; * -&gt; *) -&gt; * -&gt; * -&gt; *) (arr :: * -&gt; * -&gt; *) a
       b.
ArrowTrans t arr =&gt;
arr a b -&gt; t arr a b
</span><a href="Control.Arrow.Trans.html#liftA"><span class="hs-identifier hs-var">liftA</span></a></span><span> </span><span class="annot"><span class="annottext">(arr a b -&gt; WriterA w arr a b)
-&gt; ((a -&gt; m b) -&gt; arr a b) -&gt; (a -&gt; m b) -&gt; WriterA w arr a b
forall k (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; m b) -&gt; arr a b
forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a b.
ArrowKleisli m arr =&gt;
(a -&gt; m b) -&gt; arr a b
</span><a href="Control.Arrow.Extended.html#arrM"><span class="hs-identifier hs-var">arrM</span></a></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Control.Arrow.Extended.html#arrM"><span class="hs-pragma hs-type">arrM</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-comment">{- Note [Weird control operator types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Arrow notation (i.e. `proc`) has support for so-called &#8220;custom control operators,&#8221; which allow
things like

    proc (x, y) -&gt; do
      z &lt;- foo -&lt; x
      (f -&lt; z) `catchA` \e -&gt; g -&lt; (y, e)

to magically work. What&#8217;s so magical about that? Well, note that `catchA` is an ordinary function,
but it&#8217;s being given /commands/ as arguments, not expressions. Also note that the arguments to
`catchA` reference the variables `y` and `z`, which are bound earlier in the `proc` expression as
arrow-local variables.

To make this work, GHC has to thread `y` and `z` through `catchA` in the generated code, which will
end up being something like this:

        arr (\(x, y) -&gt; (x, (x, y)))
    &gt;&gt;&gt; first foo
    &gt;&gt;&gt; arr (\(z, (x, y)) -&gt; (z, y))
    &gt;&gt;&gt; catchA (first f)
               (arr (\((_, y), e) -&gt; (y, e)) &gt;&gt;&gt; g)

Quite complicated, which is why we&#8217;re glad we don&#8217;t have to write it all out ourselves!
Unfortunately, since GHC 7.8, GHC has required some pretty stupid-looking types for control
operators to allow them to be used in `proc` notation. The natural type for `catchA` is

    catchA :: arr a b -&gt; arr (a, e) b -&gt; arr a b

but GHC requires the far uglier

    catchA :: arr (a, s) b -&gt; arr (a, (e, s)) b -&gt; arr (a, s) b

in order to make the type inference work out. I (Alexis) have submitted a GHC proposal to fix this
&lt;https://github.com/ghc-proposals/ghc-proposals/pull/303&gt;, so hopefully we&#8217;ll be able to use the
nicer type in the future (GHC 8.12 at the earliest). For now, though, we&#8217;ll have to use the ugly
version.

As of GHC 8.10, the way to read arrow control operator types is to look for arguments with a shape
like this:

    arr (e, (a1, (a2, ... (an, s)))) b

The &#8220;actual&#8221; arguments to the arrow are the `a1` through `an` types, and the `e` and `s` types are
sort of &#8220;bookends.&#8221; So if you see a type like

    arr (e, (Integer, (Char, (Bool, s)))) String

then you should read it as an arrow that takes three &#8220;arguments&#8221; of type `Integer`, `Char`, and
`Bool` and returns a `String`.

Stopping there is basically good enough, but if you want to know what&#8217;s really going on, the idea is
that each command in a `proc` block has an &#8220;environment&#8221; and an &#8220;argument stack,&#8221; represented by the
types `e` and `s`, respectively. The environment is used to thread arrow-local variables that are
currently in scope, and the argument stack (as the name implies) is used to pass the command
arguments. Control operators can push and pop things from this argument stack, and in the base case,
the empty argument stack is represented by `()`. For a full explanation, see the section of the GHC
User&#8217;s Guide on arrow notation:

    https://downloads.haskell.org/ghc/8.8.1/docs/html/users_guide/glasgow_exts.html#arrow-notation

Yes, this all kind of sucks. Sorry.

Note [Arrow rewrite rules]
~~~~~~~~~~~~~~~~~~~~~~~~~~
GHC&#8217;s desugaring of `proc` notation is not very clever, so it can generate some pretty inefficient
code. Almost everything is translated into uses of `arr`, `first`, and `(|||)`, and arrows end up
threading around massive tuples that constantly need to be packed and unpacked. To get good
performance, GHC relies on rewrite rules that expose optimizations to the simplifier, allowing the
packing and unpacking to be significantly reduced.

The most crucial rewrite rules are the ones for &#8220;`arr` fusion&#8221;, which rewrite expressions like
`arr f . arr g` into `arr (f . g)`. It might not be obvious at first why this is so important, but
remember that the arguments to `arr` are plain functions, not arrows. These functions might be
something like:

    f (a, (b, c)) = ((a, b), c)
    g ((a, _), c) = (a, c)

The composition of these functions `f . g` can be optimized to

    f . g = \(a, (_, c)) -&gt; (a, c)

skipping the intermediate tuple completely, but GHC can only do that if the two functions are
composed directly. If GHC only sees `arr f . arr g`, then it can&#8217;t assume anything about `arr`
(which might be overloaded), so it gets stuck.

The rewrite rules defined in Control.Category, Control.Arrow, and this module take advantage of
certain typeclass laws to enable many more optimizations to fire. However, there is a caveat to all
this: when GHC knows the concrete type of a particular arrow, it aggressively specializes uses of
`arr` and other operations to the concrete type. This process bypasses the rewrite rules completely.

GHC tries to warn us about this with the `-Winline-rule-shadowing` warning, but in this case, we
want the rules anyway, since they might fire on polymorphic code. However, the takeaway is that the
generic rules are not sufficient to get fast code: it&#8217;s important to /also/ define type-specific
rules in the event that GHC specializes concrete code. The good news is that those type-specific
rules can take advantage of type-specific optimizations, getting even better performance than would
be possible using the generic rules. The bad news is it&#8217;s a bit more work. -}</span><span>
</span><span id="line-317"></span></pre></body></html>