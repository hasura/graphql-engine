<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-5"></span><span class="hs-comment">--  Send anonymized metrics to the telemetry server regarding usage of various</span><span>
</span><span id="line-6"></span><span class="hs-comment">--  features of Hasura.</span><span>
</span><span id="line-7"></span><span class="hs-comment">--</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- The general workflow for telemetry is as follows:</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- 1. We generate metrics for each backend in the graphql-engine code and send it to 'telemetryUrl'.</span><span>
</span><span id="line-11"></span><span class="hs-comment">--    The relevant types can be found in &quot;Hasura.Server.Telemetry.Types&quot;.</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- 2. The 'telemetryUrl' endpoint is handled by code in:</span><span>
</span><span id="line-13"></span><span class="hs-comment">--    &lt;https://github.com/hasura/hasura-analytics/tree/hge-upgrade&gt;, specifically</span><span>
</span><span id="line-14"></span><span class="hs-comment">--    &lt;manager/main.go&gt; and &lt;manager/analytics.go&gt;.</span><span>
</span><span id="line-15"></span><span class="hs-comment">--    This server endpoint receives the telemetry payload and sends it to another graphql-engine</span><span>
</span><span id="line-16"></span><span class="hs-comment">--    which runs locally and is backed by a postgres database.</span><span>
</span><span id="line-17"></span><span class="hs-comment">--    The database schema for the telemetry endpoint can also be found in the same repo under &lt;hge/migrations/&gt;.</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- 3. The information from the postgres db can be viewed in Metabase:</span><span>
</span><span id="line-19"></span><span class="hs-comment">--    &lt;https://metabase.telemetry.hasura.io/browse/2/schema/public&gt;.</span><span>
</span><span id="line-20"></span><span class="hs-comment">--</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- For more information about telemetry in general, visit the user-facing docs on the topic:</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- &lt;https://hasura.io/docs/latest/graphql/core/guides/telemetry&gt;.</span><span>
</span><span id="line-23"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.Server.Telemetry</span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Server.Telemetry.html#runTelemetry"><span class="hs-identifier">runTelemetry</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Hasura.Server.Telemetry.html#mkTelemetryLog"><span class="hs-identifier">mkTelemetryLog</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">where</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/ci-info-0.1.0.0/opt/doc/html/ci-info/src/CI.html"><span class="hs-identifier">CI</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.Concurrent.Extended.html"><span class="hs-identifier">Control.Concurrent.Extended</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">try</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-70a68698e02c1d9dc133c543e6497a7241e5514570afd4815da4baf2a001e00e/share/doc/html/src/Control.Lens.html"><span class="hs-identifier">Control.Lens</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.html"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">J</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.TH.html"><span class="hs-identifier">Data.Aeson.TH</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Aeson</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Strict.html"><span class="hs-identifier">Data.HashMap.Strict</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HashMap</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Int</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Int64</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.List.Extended.html"><span class="hs-identifier">Data.List.Extended</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-27d8e86ddce8dd754c06549efa10988301d41e208fc11cac9fe9ed6d99d6eb35/share/doc/html/src/Data.Text.html"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-conversions-0.3.1.1-696654449e6c6888ab72572432b4bf44e8616f90e71e42c32a7c65cdeede5929/share/doc/html/src/Data.Text.Conversions.html"><span class="hs-identifier">Data.Text.Conversions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-conversions-0.3.1.1-696654449e6c6888ab72572432b4bf44e8616f90e71e42c32a7c65cdeede5929/share/doc/html/src/Data.Text.Conversions.html#UTF8"><span class="hs-identifier">UTF8</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-conversions-0.3.1.1-696654449e6c6888ab72572432b4bf44e8616f90e71e42c32a7c65cdeede5929/share/doc/html/src/Data.Text.Conversions.html#decodeText"><span class="hs-identifier">decodeText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html"><span class="hs-identifier">Data.Text.Extended</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#toTxt"><span class="hs-identifier">toTxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.App.State.html"><span class="hs-identifier">Hasura.App.State</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">State</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.HTTP.html"><span class="hs-identifier">Hasura.HTTP</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Logging.html"><span class="hs-identifier">Hasura.Logging</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.LogicalModel.Cache.html"><span class="hs-identifier">Hasura.LogicalModel.Cache</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.LogicalModel.Cache.html#LogicalModelInfo"><span class="hs-identifier">LogicalModelInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.NativeQuery.Cache.html"><span class="hs-identifier">Hasura.NativeQuery.Cache</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.NativeQuery.Cache.html#NativeQueryInfo"><span class="hs-identifier">NativeQueryInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.NativeQuery.Cache.html#_nqiArguments"><span class="hs-identifier">_nqiArguments</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html"><span class="hs-identifier">Hasura.Prelude</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Action.html"><span class="hs-identifier">Hasura.RQL.Types.Action</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.BackendTag.html"><span class="hs-identifier">Hasura.RQL.Types.BackendTag</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html"><span class="hs-identifier">Hasura.RQL.Types.BackendType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#BackendType"><span class="hs-identifier">BackendType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#backendTypeFromBackendSourceKind"><span class="hs-identifier">backendTypeFromBackendSourceKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html"><span class="hs-identifier">Hasura.RQL.Types.Common</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.CustomTypes.html"><span class="hs-identifier">Hasura.RQL.Types.CustomTypes</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Instances.html"><span class="hs-identifier">Hasura.RQL.Types.Metadata.Instances</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Relationships.Local.html"><span class="hs-identifier">Hasura.RQL.Types.Relationships.Local</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Roles.html"><span class="hs-identifier">Hasura.RQL.Types.Roles</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Roles.html#RoleName"><span class="hs-identifier">RoleName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCache</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html"><span class="hs-identifier">Hasura.RQL.Types.Source</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.AnyBackend.html"><span class="hs-identifier">Hasura.SQL.AnyBackend</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Any</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.AppStateRef.html"><span class="hs-identifier">Hasura.Server.AppStateRef</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HGE</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html"><span class="hs-identifier">Hasura.Server.Init.Config</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.ResourceChecker.html"><span class="hs-identifier">Hasura.Server.ResourceChecker</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Telemetry.Counters.html"><span class="hs-identifier">Hasura.Server.Telemetry.Counters</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Telemetry.Counters.html#dumpServiceTimingMetrics"><span class="hs-identifier">dumpServiceTimingMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Telemetry.Types.html"><span class="hs-identifier">Hasura.Server.Telemetry.Types</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html"><span class="hs-identifier">Hasura.Server.Types</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Version.html"><span class="hs-identifier">Hasura.Server.Version</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.StoredProcedure.Cache.html"><span class="hs-identifier">Hasura.StoredProcedure.Cache</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.StoredProcedure.Cache.html#StoredProcedureInfo"><span class="hs-identifier">StoredProcedureInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.StoredProcedure.Cache.html#_spiArguments"><span class="hs-identifier">_spiArguments</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Table.Cache.html"><span class="hs-identifier">Hasura.Table.Cache</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-client-0.7.13.1-502ddd03dcb0699ad73741428897b95bce942b287e00ead925349aad45d2ca18/share/doc/html/src/Network.HTTP.Client.html"><span class="hs-identifier">Network.HTTP.Client</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HTTP</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-e90deb8507289c0bf4cfca5d91ad626efd0368a9e1f2eb92a4ff6bd79f5e0680/share/doc/html/src/Network.HTTP.Types.html"><span class="hs-identifier">Network.HTTP.Types</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HTTP</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wreq-0.5.3.3-d14fa4a0620a067aadcdad470cadd78ff72cc921d33f57afec0e938d78d757d5/share/doc/html/src/Network.Wreq.html"><span class="hs-identifier">Network.Wreq</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Wreq</span></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="annot"><span class="hs-comment">-- * Logging and error handling</span></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="annot"><span class="hs-comment">-- | Logging related</span></span><span>
</span><span id="line-76"></span><span class="hs-keyword">data</span><span> </span><span id="TelemetryLog"><span class="annot"><a href="Hasura.Server.Telemetry.html#TelemetryLog"><span class="hs-identifier hs-var">TelemetryLog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TelemetryLog"><span class="annot"><a href="Hasura.Server.Telemetry.html#TelemetryLog"><span class="hs-identifier hs-var">TelemetryLog</span></a></span></span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_tlLogLevel"><span class="annot"><span class="annottext">TelemetryLog -&gt; LogLevel
</span><a href="Hasura.Server.Telemetry.html#_tlLogLevel"><span class="hs-identifier hs-var hs-var">_tlLogLevel</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.Logging.html#LogLevel"><span class="hs-identifier hs-type">LogLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>    </span><span id="_tlType"><span class="annot"><span class="annottext">TelemetryLog -&gt; Text
</span><a href="Hasura.Server.Telemetry.html#_tlType"><span class="hs-identifier hs-var hs-var">_tlType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-27d8e86ddce8dd754c06549efa10988301d41e208fc11cac9fe9ed6d99d6eb35/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>    </span><span id="_tlMessage"><span class="annot"><span class="annottext">TelemetryLog -&gt; Text
</span><a href="Hasura.Server.Telemetry.html#_tlMessage"><span class="hs-identifier hs-var hs-var">_tlMessage</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-27d8e86ddce8dd754c06549efa10988301d41e208fc11cac9fe9ed6d99d6eb35/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>    </span><span id="_tlHttpError"><span class="annot"><span class="annottext">TelemetryLog -&gt; Maybe TelemetryHttpError
</span><a href="Hasura.Server.Telemetry.html#_tlHttpError"><span class="hs-identifier hs-var hs-var">_tlHttpError</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.Server.Telemetry.html#TelemetryHttpError"><span class="hs-identifier hs-type">TelemetryHttpError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687299571"><span id="local-6989586621687299583"><span id="local-6989586621687299587"><span class="annot"><span class="annottext">Int -&gt; TelemetryLog -&gt; ShowS
[TelemetryLog] -&gt; ShowS
TelemetryLog -&gt; String
(Int -&gt; TelemetryLog -&gt; ShowS)
-&gt; (TelemetryLog -&gt; String)
-&gt; ([TelemetryLog] -&gt; ShowS)
-&gt; Show TelemetryLog
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; TelemetryLog -&gt; ShowS
showsPrec :: Int -&gt; TelemetryLog -&gt; ShowS
$cshow :: TelemetryLog -&gt; String
show :: TelemetryLog -&gt; String
$cshowList :: [TelemetryLog] -&gt; ShowS
showList :: [TelemetryLog] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-keyword">data</span><span> </span><span id="TelemetryHttpError"><span class="annot"><a href="Hasura.Server.Telemetry.html#TelemetryHttpError"><span class="hs-identifier hs-var">TelemetryHttpError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TelemetryHttpError"><span class="annot"><a href="Hasura.Server.Telemetry.html#TelemetryHttpError"><span class="hs-identifier hs-var">TelemetryHttpError</span></a></span></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="tlheStatus"><span class="annot"><span class="annottext">TelemetryHttpError -&gt; Maybe Status
</span><a href="Hasura.Server.Telemetry.html#tlheStatus"><span class="hs-identifier hs-var hs-var">tlheStatus</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-e90deb8507289c0bf4cfca5d91ad626efd0368a9e1f2eb92a4ff6bd79f5e0680/share/doc/html/src/Network.HTTP.Types.Status.html#Status"><span class="hs-identifier hs-type">HTTP.Status</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>    </span><span id="tlheUrl"><span class="annot"><span class="annottext">TelemetryHttpError -&gt; Text
</span><a href="Hasura.Server.Telemetry.html#tlheUrl"><span class="hs-identifier hs-var hs-var">tlheUrl</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-27d8e86ddce8dd754c06549efa10988301d41e208fc11cac9fe9ed6d99d6eb35/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>    </span><span id="tlheHttpException"><span class="annot"><span class="annottext">TelemetryHttpError -&gt; Maybe HttpException
</span><a href="Hasura.Server.Telemetry.html#tlheHttpException"><span class="hs-identifier hs-var hs-var">tlheHttpException</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.HTTP.html#HttpException"><span class="hs-identifier hs-type">HttpException</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>    </span><span id="tlheResponse"><span class="annot"><span class="annottext">TelemetryHttpError -&gt; Maybe Text
</span><a href="Hasura.Server.Telemetry.html#tlheResponse"><span class="hs-identifier hs-var hs-var">tlheResponse</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-27d8e86ddce8dd754c06549efa10988301d41e208fc11cac9fe9ed6d99d6eb35/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687299597"><span id="local-6989586621687299606"><span id="local-6989586621687299609"><span class="annot"><span class="annottext">Int -&gt; TelemetryHttpError -&gt; ShowS
[TelemetryHttpError] -&gt; ShowS
TelemetryHttpError -&gt; String
(Int -&gt; TelemetryHttpError -&gt; ShowS)
-&gt; (TelemetryHttpError -&gt; String)
-&gt; ([TelemetryHttpError] -&gt; ShowS)
-&gt; Show TelemetryHttpError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; TelemetryHttpError -&gt; ShowS
showsPrec :: Int -&gt; TelemetryHttpError -&gt; ShowS
$cshow :: TelemetryHttpError -&gt; String
show :: TelemetryHttpError -&gt; String
$cshowList :: [TelemetryHttpError] -&gt; ShowS
showList :: [TelemetryHttpError] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687299615"><span id="local-6989586621687299619"><span id="local-6989586621687299622"><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#ToJSON"><span class="hs-identifier hs-type">J.ToJSON</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Telemetry.html#TelemetryLog"><span class="hs-identifier hs-type">TelemetryLog</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-93"></span><span>  </span><span id="local-6989586621687299646"><span class="annot"><span class="annottext">toJSON :: TelemetryLog -&gt; Value
</span><a href="#local-6989586621687299646"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span id="local-6989586621687299648"><span class="annot"><span class="annottext">TelemetryLog
</span><a href="#local-6989586621687299648"><span class="hs-identifier hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.Internal.html#object"><span class="hs-identifier hs-var">J.object</span></a></span><span>
</span><span id="line-95"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;type&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">J..=</span></a></span><span> </span><span class="annot"><span class="annottext">TelemetryLog -&gt; Text
</span><a href="Hasura.Server.Telemetry.html#_tlType"><span class="hs-identifier hs-var">_tlType</span></a></span><span> </span><span class="annot"><span class="annottext">TelemetryLog
</span><a href="#local-6989586621687299648"><span class="hs-identifier hs-var">tl</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;message&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">J..=</span></a></span><span> </span><span class="annot"><span class="annottext">TelemetryLog -&gt; Text
</span><a href="Hasura.Server.Telemetry.html#_tlMessage"><span class="hs-identifier hs-var">_tlMessage</span></a></span><span> </span><span class="annot"><span class="annottext">TelemetryLog
</span><a href="#local-6989586621687299648"><span class="hs-identifier hs-var">tl</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;http_error&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Maybe Value -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">J..=</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TelemetryHttpError -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">J.toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(TelemetryHttpError -&gt; Value)
-&gt; Maybe TelemetryHttpError -&gt; Maybe Value
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TelemetryLog -&gt; Maybe TelemetryHttpError
</span><a href="Hasura.Server.Telemetry.html#_tlHttpError"><span class="hs-identifier hs-var">_tlHttpError</span></a></span><span> </span><span class="annot"><span class="annottext">TelemetryLog
</span><a href="#local-6989586621687299648"><span class="hs-identifier hs-var">tl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687299654"><span id="local-6989586621687299657"><span id="local-6989586621687299660"><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#ToJSON"><span class="hs-identifier hs-type">J.ToJSON</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Telemetry.html#TelemetryHttpError"><span class="hs-identifier hs-type">TelemetryHttpError</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-101"></span><span>  </span><span id="local-6989586621687299683"><span class="annot"><span class="annottext">toJSON :: TelemetryHttpError -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span id="local-6989586621687299684"><span class="annot"><span class="annottext">TelemetryHttpError
</span><a href="#local-6989586621687299684"><span class="hs-identifier hs-var">tlhe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.Internal.html#object"><span class="hs-identifier hs-var">J.object</span></a></span><span>
</span><span id="line-103"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;status_code&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Maybe Int -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">J..=</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status -&gt; Int
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-e90deb8507289c0bf4cfca5d91ad626efd0368a9e1f2eb92a4ff6bd79f5e0680/share/doc/html/src/Network.HTTP.Types.Status.html#statusCode"><span class="hs-identifier hs-var">HTTP.statusCode</span></a></span><span> </span><span class="annot"><span class="annottext">(Status -&gt; Int) -&gt; Maybe Status -&gt; Maybe Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TelemetryHttpError -&gt; Maybe Status
</span><a href="Hasura.Server.Telemetry.html#tlheStatus"><span class="hs-identifier hs-var">tlheStatus</span></a></span><span> </span><span class="annot"><span class="annottext">TelemetryHttpError
</span><a href="#local-6989586621687299684"><span class="hs-identifier hs-var">tlhe</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-104"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;url&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">J..=</span></a></span><span> </span><span class="annot"><span class="annottext">TelemetryHttpError -&gt; Text
</span><a href="Hasura.Server.Telemetry.html#tlheUrl"><span class="hs-identifier hs-var">tlheUrl</span></a></span><span> </span><span class="annot"><span class="annottext">TelemetryHttpError
</span><a href="#local-6989586621687299684"><span class="hs-identifier hs-var">tlhe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;response&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Maybe Text -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">J..=</span></a></span><span> </span><span class="annot"><span class="annottext">TelemetryHttpError -&gt; Maybe Text
</span><a href="Hasura.Server.Telemetry.html#tlheResponse"><span class="hs-identifier hs-var">tlheResponse</span></a></span><span> </span><span class="annot"><span class="annottext">TelemetryHttpError
</span><a href="#local-6989586621687299684"><span class="hs-identifier hs-var">tlhe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;http_exception&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Maybe Value -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">J..=</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpException -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">J.toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(HttpException -&gt; Value) -&gt; Maybe HttpException -&gt; Maybe Value
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TelemetryHttpError -&gt; Maybe HttpException
</span><a href="Hasura.Server.Telemetry.html#tlheHttpException"><span class="hs-identifier hs-var">tlheHttpException</span></a></span><span> </span><span class="annot"><span class="annottext">TelemetryHttpError
</span><a href="#local-6989586621687299684"><span class="hs-identifier hs-var">tlhe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Logging.html#ToEngineLog"><span class="hs-identifier hs-type">ToEngineLog</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Telemetry.html#TelemetryLog"><span class="hs-identifier hs-type">TelemetryLog</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-110"></span><span>  </span><span id="local-6989586621687299693"><span class="annot"><span class="annottext">toEngineLog :: TelemetryLog -&gt; (LogLevel, EngineLogType Hasura, Value)
</span><a href="#local-6989586621687299693"><span class="hs-identifier hs-var hs-var hs-var hs-var">toEngineLog</span></a></span></span><span> </span><span id="local-6989586621687299695"><span class="annot"><span class="annottext">TelemetryLog
</span><a href="#local-6989586621687299695"><span class="hs-identifier hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TelemetryLog -&gt; LogLevel
</span><a href="Hasura.Server.Telemetry.html#_tlLogLevel"><span class="hs-identifier hs-var">_tlLogLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TelemetryLog
</span><a href="#local-6989586621687299695"><span class="hs-identifier hs-var">tl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InternalLogTypes -&gt; EngineLogType Hasura
</span><a href="Hasura.Logging.html#ELTInternal"><span class="hs-identifier hs-var">ELTInternal</span></a></span><span> </span><span class="annot"><span class="annottext">InternalLogTypes
</span><a href="Hasura.Logging.html#ILTTelemetry"><span class="hs-identifier hs-var">ILTTelemetry</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TelemetryLog -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">J.toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">TelemetryLog
</span><a href="#local-6989586621687299695"><span class="hs-identifier hs-var">tl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-keyword">newtype</span><span> </span><span id="ServerTelemetryRow"><span class="annot"><a href="Hasura.Server.Telemetry.html#ServerTelemetryRow"><span class="hs-identifier hs-var">ServerTelemetryRow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ServerTelemetryRow"><span class="annot"><a href="Hasura.Server.Telemetry.html#ServerTelemetryRow"><span class="hs-identifier hs-var">ServerTelemetryRow</span></a></span></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_strServerMetrics"><span class="annot"><span class="annottext">ServerTelemetryRow -&gt; ServerTelemetry
</span><a href="Hasura.Server.Telemetry.html#_strServerMetrics"><span class="hs-identifier hs-var hs-var">_strServerMetrics</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Server.Telemetry.html#ServerTelemetry"><span class="hs-identifier hs-type">ServerTelemetry</span></a></span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-keyword">data</span><span> </span><span id="ServerTelemetry"><span class="annot"><a href="Hasura.Server.Telemetry.html#ServerTelemetry"><span class="hs-identifier hs-var">ServerTelemetry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ServerTelemetry"><span class="annot"><a href="Hasura.Server.Telemetry.html#ServerTelemetry"><span class="hs-identifier hs-var">ServerTelemetry</span></a></span></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_stResourceCpu"><span class="annot"><span class="annottext">ServerTelemetry -&gt; Maybe Int
</span><a href="Hasura.Server.Telemetry.html#_stResourceCpu"><span class="hs-identifier hs-var hs-var">_stResourceCpu</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-118"></span><span>    </span><span id="_stResourceMemory"><span class="annot"><span class="annottext">ServerTelemetry -&gt; Maybe Int64
</span><a href="Hasura.Server.Telemetry.html#_stResourceMemory"><span class="hs-identifier hs-var hs-var">_stResourceMemory</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span class="hs-special">,</span><span>
</span><span id="line-119"></span><span>    </span><span id="_stResourceCheckerErrorCode"><span class="annot"><span class="annottext">ServerTelemetry -&gt; Maybe ResourceCheckerError
</span><a href="Hasura.Server.Telemetry.html#_stResourceCheckerErrorCode"><span class="hs-identifier hs-var hs-var">_stResourceCheckerErrorCode</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.Server.ResourceChecker.html#ResourceCheckerError"><span class="hs-identifier hs-type">ResourceCheckerError</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-special">$</span><span id="local-6989586621687299705"><span id="local-6989586621687299723"><span id="local-6989586621687299737"><span id="local-6989586621687299741"><span class="hs-special">(</span><span class="hs-identifier">Aeson.deriveToJSON</span><span> </span><span class="hs-identifier">hasuraJSON</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">ServerTelemetry</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-123"></span><span class="hs-special">$</span><span id="local-6989586621687299763"><span id="local-6989586621687299769"><span id="local-6989586621687299774"><span id="local-6989586621687299778"><span class="hs-special">(</span><span class="hs-identifier">Aeson.deriveToJSON</span><span> </span><span class="hs-identifier">hasuraJSON</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">ServerTelemetryRow</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="annot"><a href="Hasura.Server.Telemetry.html#mkHttpError"><span class="hs-identifier hs-type">mkHttpError</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-27d8e86ddce8dd754c06549efa10988301d41e208fc11cac9fe9ed6d99d6eb35/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-client-0.7.13.1-502ddd03dcb0699ad73741428897b95bce942b287e00ead925349aad45d2ca18/share/doc/html/src/Network.HTTP.Client.Types.html#Response"><span class="hs-identifier hs-type">Wreq.Response</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.HTTP.html#HttpException"><span class="hs-identifier hs-type">HttpException</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-129"></span><span>  </span><span class="annot"><a href="Hasura.Server.Telemetry.html#TelemetryHttpError"><span class="hs-identifier hs-type">TelemetryHttpError</span></a></span><span>
</span><span id="line-130"></span><span id="mkHttpError"><span class="annot"><span class="annottext">mkHttpError :: Text
-&gt; Maybe (Response ByteString)
-&gt; Maybe HttpException
-&gt; TelemetryHttpError
</span><a href="Hasura.Server.Telemetry.html#mkHttpError"><span class="hs-identifier hs-var hs-var">mkHttpError</span></a></span></span><span> </span><span id="local-6989586621687299786"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687299786"><span class="hs-identifier hs-var">url</span></a></span></span><span> </span><span id="local-6989586621687299787"><span class="annot"><span class="annottext">Maybe (Response ByteString)
</span><a href="#local-6989586621687299787"><span class="hs-identifier hs-var">mResp</span></a></span></span><span> </span><span id="local-6989586621687299788"><span class="annot"><span class="annottext">Maybe HttpException
</span><a href="#local-6989586621687299788"><span class="hs-identifier hs-var">httpEx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Response ByteString)
</span><a href="#local-6989586621687299787"><span class="hs-identifier hs-var">mResp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Response ByteString)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Status
-&gt; Text -&gt; Maybe HttpException -&gt; Maybe Text -&gt; TelemetryHttpError
</span><a href="Hasura.Server.Telemetry.html#TelemetryHttpError"><span class="hs-identifier hs-var">TelemetryHttpError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Status
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687299786"><span class="hs-identifier hs-var">url</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HttpException
</span><a href="#local-6989586621687299788"><span class="hs-identifier hs-var">httpEx</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621687299789"><span class="annot"><span class="annottext">Response ByteString
</span><a href="#local-6989586621687299789"><span class="hs-identifier hs-var">resp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-134"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687299790"><span class="annot"><span class="annottext">status :: Status
</span><a href="#local-6989586621687299790"><span class="hs-identifier hs-var hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Response ByteString
</span><a href="#local-6989586621687299789"><span class="hs-identifier hs-var">resp</span></a></span><span> </span><span class="annot"><span class="annottext">Response ByteString
-&gt; Getting Status (Response ByteString) Status -&gt; Status
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-70a68698e02c1d9dc133c543e6497a7241e5514570afd4815da4baf2a001e00e/share/doc/html/src/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Status (Response ByteString) Status
forall body (f :: * -&gt; *).
Functor f =&gt;
(Status -&gt; f Status) -&gt; Response body -&gt; f (Response body)
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wreq-0.5.3.3-d14fa4a0620a067aadcdad470cadd78ff72cc921d33f57afec0e938d78d757d5/share/doc/html/src/Network.Wreq.Lens.html#responseStatus"><span class="hs-identifier hs-var">Wreq.responseStatus</span></a></span><span>
</span><span id="line-135"></span><span>          </span><span id="local-6989586621687299793"><span class="annot"><span class="annottext">body :: Maybe Text
</span><a href="#local-6989586621687299793"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTF8 ByteString -&gt; Maybe Text
forall (f :: * -&gt; *) a. DecodeText f a =&gt; a -&gt; f Text
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-conversions-0.3.1.1-696654449e6c6888ab72572432b4bf44e8616f90e71e42c32a7c65cdeede5929/share/doc/html/src/Data.Text.Conversions.html#decodeText"><span class="hs-identifier hs-var">decodeText</span></a></span><span> </span><span class="annot"><span class="annottext">(UTF8 ByteString -&gt; Maybe Text) -&gt; UTF8 ByteString -&gt; Maybe Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; UTF8 ByteString
forall a. a -&gt; UTF8 a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-conversions-0.3.1.1-696654449e6c6888ab72572432b4bf44e8616f90e71e42c32a7c65cdeede5929/share/doc/html/src/Data.Text.Conversions.html#UTF8"><span class="hs-identifier hs-var">UTF8</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Response ByteString
</span><a href="#local-6989586621687299789"><span class="hs-identifier hs-var">resp</span></a></span><span> </span><span class="annot"><span class="annottext">Response ByteString
-&gt; Getting ByteString (Response ByteString) ByteString
-&gt; ByteString
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-70a68698e02c1d9dc133c543e6497a7241e5514570afd4815da4baf2a001e00e/share/doc/html/src/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting ByteString (Response ByteString) ByteString
forall body0 body1 (f :: * -&gt; *).
Functor f =&gt;
(body0 -&gt; f body1) -&gt; Response body0 -&gt; f (Response body1)
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wreq-0.5.3.3-d14fa4a0620a067aadcdad470cadd78ff72cc921d33f57afec0e938d78d757d5/share/doc/html/src/Network.Wreq.Lens.html#responseBody"><span class="hs-identifier hs-var">Wreq.responseBody</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Maybe Status
-&gt; Text -&gt; Maybe HttpException -&gt; Maybe Text -&gt; TelemetryHttpError
</span><a href="Hasura.Server.Telemetry.html#TelemetryHttpError"><span class="hs-identifier hs-var">TelemetryHttpError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status -&gt; Maybe Status
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621687299790"><span class="hs-identifier hs-var">status</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687299786"><span class="hs-identifier hs-var">url</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HttpException
</span><a href="#local-6989586621687299788"><span class="hs-identifier hs-var">httpEx</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687299793"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="annot"><a href="Hasura.Server.Telemetry.html#mkTelemetryLog"><span class="hs-identifier hs-type">mkTelemetryLog</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-27d8e86ddce8dd754c06549efa10988301d41e208fc11cac9fe9ed6d99d6eb35/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-27d8e86ddce8dd754c06549efa10988301d41e208fc11cac9fe9ed6d99d6eb35/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.Server.Telemetry.html#TelemetryHttpError"><span class="hs-identifier hs-type">TelemetryHttpError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Telemetry.html#TelemetryLog"><span class="hs-identifier hs-type">TelemetryLog</span></a></span><span>
</span><span id="line-139"></span><span id="mkTelemetryLog"><span class="annot"><span class="annottext">mkTelemetryLog :: Text -&gt; Text -&gt; Maybe TelemetryHttpError -&gt; TelemetryLog
</span><a href="Hasura.Server.Telemetry.html#mkTelemetryLog"><span class="hs-identifier hs-var hs-var">mkTelemetryLog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogLevel
-&gt; Text -&gt; Text -&gt; Maybe TelemetryHttpError -&gt; TelemetryLog
</span><a href="Hasura.Server.Telemetry.html#TelemetryLog"><span class="hs-identifier hs-var">TelemetryLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="annot"><span class="hs-comment">-- * Endpoint</span></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="annot"><a href="Hasura.Server.Telemetry.html#telemetryUrl"><span class="hs-identifier hs-type">telemetryUrl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-27d8e86ddce8dd754c06549efa10988301d41e208fc11cac9fe9ed6d99d6eb35/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-144"></span><span id="telemetryUrl"><span class="annot"><span class="annottext">telemetryUrl :: Text
</span><a href="Hasura.Server.Telemetry.html#telemetryUrl"><span class="hs-identifier hs-var hs-var">telemetryUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;https://telemetry.hasura.io/v1/http&quot;</span></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="annot"><span class="hs-comment">-- * Execution</span></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-comment">-- | An infinite loop that sends updated telemetry data ('Metrics') every 24</span><span>
</span><span id="line-149"></span><span class="hs-comment">-- hours. The send time depends on when the server was started and will</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- naturally drift.</span><span>
</span><span id="line-151"></span><span class="annot"><a href="Hasura.Server.Telemetry.html#runTelemetry"><span class="hs-identifier hs-type">runTelemetry</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687299261"><span class="annot"><a href="#local-6989586621687299261"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621687299265"><span class="annot"><a href="#local-6989586621687299265"><span class="hs-identifier hs-type">impl</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687299261"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-154"></span><span>    </span><span class="annot"><a href="Hasura.App.State.html#HasAppEnv"><span class="hs-identifier hs-type">State.HasAppEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687299261"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-156"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><span class="hs-comment">-- | an action that always returns the latest schema cache ref</span></span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><a href="Hasura.Server.AppStateRef.html#AppStateRef"><span class="hs-identifier hs-type">HGE.AppStateRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687299265"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-159"></span><span>  </span><span class="annot"><a href="Hasura.Server.Types.html#MetadataDbId"><span class="hs-identifier hs-type">MetadataDbId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-160"></span><span>  </span><span class="annot"><a href="Hasura.Server.Types.html#PGVersion"><span class="hs-identifier hs-type">PGVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-161"></span><span>  </span><span class="annot"><a href="Hasura.Server.ResourceChecker.html#ComputeResourcesResponse"><span class="hs-identifier hs-type">ComputeResourcesResponse</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-162"></span><span>  </span><span class="annot"><a href="#local-6989586621687299261"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span>
</span><span id="line-163"></span><span id="runTelemetry"><span class="annot"><span class="annottext">runTelemetry :: forall (m :: * -&gt; *) impl.
(MonadIO m, HasAppEnv m) =&gt;
Logger Hasura
-&gt; AppStateRef impl
-&gt; MetadataDbId
-&gt; PGVersion
-&gt; ComputeResourcesResponse
-&gt; m Void
</span><a href="Hasura.Server.Telemetry.html#runTelemetry"><span class="hs-identifier hs-var hs-var">runTelemetry</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span id="local-6989586621687299879"><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621687299879"><span class="hs-identifier hs-var">logger</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621687299880"><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687299880"><span class="hs-identifier hs-var">appStateRef</span></a></span></span><span> </span><span id="local-6989586621687299881"><span class="annot"><span class="annottext">MetadataDbId
</span><a href="#local-6989586621687299881"><span class="hs-identifier hs-var">metadataDbUid</span></a></span></span><span> </span><span id="local-6989586621687299882"><span class="annot"><span class="annottext">PGVersion
</span><a href="#local-6989586621687299882"><span class="hs-identifier hs-var">pgVersion</span></a></span></span><span> </span><span id="local-6989586621687299883"><span class="annot"><span class="annottext">ComputeResourcesResponse
</span><a href="#local-6989586621687299883"><span class="hs-identifier hs-var">computeResources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">State.AppEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687299885"><span id="local-6989586621687299886"><span id="local-6989586621687299887"><span id="local-6989586621687299888"><span id="local-6989586621687299889"><span id="local-6989586621687299890"><span id="local-6989586621687299891"><span id="local-6989586621687299892"><span id="local-6989586621687299893"><span id="local-6989586621687299894"><span id="local-6989586621687299895"><span id="local-6989586621687299896"><span id="local-6989586621687299897"><span id="local-6989586621687299898"><span id="local-6989586621687299899"><span id="local-6989586621687299900"><span id="local-6989586621687299901"><span id="local-6989586621687299902"><span id="local-6989586621687299903"><span id="local-6989586621687299904"><span id="local-6989586621687299905"><span id="local-6989586621687299906"><span id="local-6989586621687299907"><span id="local-6989586621687299908"><span id="local-6989586621687299909"><span id="local-6989586621687299910"><span id="local-6989586621687299911"><span id="local-6989586621687299912"><span id="local-6989586621687299913"><span id="local-6989586621687299914"><span id="local-6989586621687299915"><span class="annot"><span class="annottext">Int
Maybe Text
Maybe PGPool
Maybe (CredentialCache AgentLicenseKey)
SamplingPolicy
HostPreference
Manager
TxIsolation
ConnParams
PGPool
Refined NonNegative Seconds
TMVar MetadataResourceVersion
ConnectionOptions
CheckFeatureFlag
ServerMetrics
EventingMode
ReadOnlyMode
MaintenanceMode ()
InstanceId
PrometheusMetrics
ShutdownLatch
LoggingSettings
LockedEventsCtx
WSConnectionInitTimeout
KeepAliveDelay
OptionalInterval
Port
SubscriptionsState
Loggers
appEnvPort :: Port
appEnvHost :: HostPreference
appEnvMetadataDbPool :: PGPool
appEnvIntrospectionDbPool :: Maybe PGPool
appEnvManager :: Manager
appEnvLoggers :: Loggers
appEnvMetadataVersionRef :: TMVar MetadataResourceVersion
appEnvInstanceId :: InstanceId
appEnvEnableMaintenanceMode :: MaintenanceMode ()
appEnvLoggingSettings :: LoggingSettings
appEnvEventingMode :: EventingMode
appEnvEnableReadOnlyMode :: ReadOnlyMode
appEnvServerMetrics :: ServerMetrics
appEnvShutdownLatch :: ShutdownLatch
appEnvMetaVersionRef :: TMVar MetadataResourceVersion
appEnvPrometheusMetrics :: PrometheusMetrics
appEnvTraceSamplingPolicy :: SamplingPolicy
appEnvSubscriptionState :: SubscriptionsState
appEnvLockedEventsCtx :: LockedEventsCtx
appEnvConnParams :: ConnParams
appEnvTxIso :: TxIsolation
appEnvConsoleAssetsDir :: Maybe Text
appEnvConsoleSentryDsn :: Maybe Text
appEnvConnectionOptions :: ConnectionOptions
appEnvWebSocketKeepAlive :: KeepAliveDelay
appEnvWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
appEnvGracefulShutdownTimeout :: Refined NonNegative Seconds
appEnvSchemaPollInterval :: OptionalInterval
appEnvCheckFeatureFlag :: CheckFeatureFlag
appEnvLicenseKeyCache :: Maybe (CredentialCache AgentLicenseKey)
appEnvMaxTotalHeaderLength :: Int
appEnvPort :: AppEnv -&gt; Port
appEnvHost :: AppEnv -&gt; HostPreference
appEnvMetadataDbPool :: AppEnv -&gt; PGPool
appEnvIntrospectionDbPool :: AppEnv -&gt; Maybe PGPool
appEnvManager :: AppEnv -&gt; Manager
appEnvLoggers :: AppEnv -&gt; Loggers
appEnvMetadataVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvInstanceId :: AppEnv -&gt; InstanceId
appEnvEnableMaintenanceMode :: AppEnv -&gt; MaintenanceMode ()
appEnvLoggingSettings :: AppEnv -&gt; LoggingSettings
appEnvEventingMode :: AppEnv -&gt; EventingMode
appEnvEnableReadOnlyMode :: AppEnv -&gt; ReadOnlyMode
appEnvServerMetrics :: AppEnv -&gt; ServerMetrics
appEnvShutdownLatch :: AppEnv -&gt; ShutdownLatch
appEnvMetaVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvPrometheusMetrics :: AppEnv -&gt; PrometheusMetrics
appEnvTraceSamplingPolicy :: AppEnv -&gt; SamplingPolicy
appEnvSubscriptionState :: AppEnv -&gt; SubscriptionsState
appEnvLockedEventsCtx :: AppEnv -&gt; LockedEventsCtx
appEnvConnParams :: AppEnv -&gt; ConnParams
appEnvTxIso :: AppEnv -&gt; TxIsolation
appEnvConsoleAssetsDir :: AppEnv -&gt; Maybe Text
appEnvConsoleSentryDsn :: AppEnv -&gt; Maybe Text
appEnvConnectionOptions :: AppEnv -&gt; ConnectionOptions
appEnvWebSocketKeepAlive :: AppEnv -&gt; KeepAliveDelay
appEnvWebSocketConnectionInitTimeout :: AppEnv -&gt; WSConnectionInitTimeout
appEnvGracefulShutdownTimeout :: AppEnv -&gt; Refined NonNegative Seconds
appEnvSchemaPollInterval :: AppEnv -&gt; OptionalInterval
appEnvCheckFeatureFlag :: AppEnv -&gt; CheckFeatureFlag
appEnvLicenseKeyCache :: AppEnv -&gt; Maybe (CredentialCache AgentLicenseKey)
appEnvMaxTotalHeaderLength :: AppEnv -&gt; Int
</span><a href="#local-6989586621687299885"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m AppEnv
forall (m :: * -&gt; *). HasAppEnv m =&gt; m AppEnv
</span><a href="Hasura.App.State.html#askAppEnv"><span class="hs-identifier hs-var">State.askAppEnv</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687299948"><span class="annot"><span class="annottext">options :: Options
</span><a href="#local-6989586621687299948"><span class="hs-identifier hs-var hs-var">options</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Manager -&gt; [Header] -&gt; Options
</span><a href="Hasura.HTTP.html#wreqOptions"><span class="hs-identifier hs-var">wreqOptions</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621687299889"><span class="hs-identifier hs-var">appEnvManager</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-166"></span><span>  </span><span class="annot"><span class="annottext">m () -&gt; m Void
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">forever</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m Void) -&gt; m () -&gt; m Void
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621687299952"><span class="annot"><span class="annottext">TelemetryStatus
</span><a href="#local-6989586621687299952"><span class="hs-identifier hs-var">telemetryStatus</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; TelemetryStatus
</span><a href="Hasura.App.State.html#acEnableTelemetry"><span class="hs-identifier hs-var">State.acEnableTelemetry</span></a></span><span> </span><span class="annot"><span class="annottext">(AppContext -&gt; TelemetryStatus)
-&gt; IO AppContext -&gt; IO TelemetryStatus
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO AppContext
forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">HGE.getAppContext</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687299880"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TelemetryStatus
</span><a href="#local-6989586621687299952"><span class="hs-identifier hs-var">telemetryStatus</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-169"></span><span>      </span><span class="annot"><span class="annottext">TelemetryStatus
</span><a href="Hasura.Server.Init.Config.html#TelemetryEnabled"><span class="hs-identifier hs-var">TelemetryEnabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-170"></span><span>        </span><span id="local-6989586621687299956"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687299956"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO SchemaCache
forall impl. AppStateRef impl -&gt; IO SchemaCache
</span><a href="Hasura.Server.AppStateRef.html#getSchemaCache"><span class="hs-identifier hs-var">HGE.getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687299880"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-171"></span><span>        </span><span id="local-6989586621687299958"><span class="annot"><span class="annottext">ServiceTimingMetrics
</span><a href="#local-6989586621687299958"><span class="hs-identifier hs-var">serviceTimings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ServiceTimingMetrics
forall (m :: * -&gt; *). MonadIO m =&gt; m ServiceTimingMetrics
</span><a href="Hasura.Server.Telemetry.Counters.html#dumpServiceTimingMetrics"><span class="hs-identifier hs-var">dumpServiceTimingMetrics</span></a></span><span>
</span><span id="line-172"></span><span>        </span><span id="local-6989586621687299959"><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621687299959"><span class="hs-identifier hs-var">experimentalFeatures</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; HashSet ExperimentalFeature
</span><a href="Hasura.App.State.html#acExperimentalFeatures"><span class="hs-identifier hs-var">State.acExperimentalFeatures</span></a></span><span> </span><span class="annot"><span class="annottext">(AppContext -&gt; HashSet ExperimentalFeature)
-&gt; IO AppContext -&gt; IO (HashSet ExperimentalFeature)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO AppContext
forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">HGE.getAppContext</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687299880"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-173"></span><span>        </span><span id="local-6989586621687299961"><span class="annot"><span class="annottext">Maybe CI
</span><a href="#local-6989586621687299961"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe CI)
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/ci-info-0.1.0.0/opt/doc/html/ci-info/src/CI.html#getCI"><span class="hs-identifier hs-var">CI.getCI</span></a></span><span>
</span><span id="line-174"></span><span>        </span><span class="hs-comment">-- Creates a telemetry payload for a specific backend.</span><span>
</span><span id="line-175"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621687299963"><span class="hs-identifier hs-type">telemetryForSource</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687299339"><span class="annot"><a href="#local-6989586621687299339"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#BackendType"><span class="hs-identifier hs-type">BackendType</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceInfo"><span class="hs-identifier hs-type">SourceInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687299339"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Telemetry.Types.html#TelemetryPayload"><span class="hs-identifier hs-type">TelemetryPayload</span></a></span><span>
</span><span id="line-176"></span><span>            </span><span id="local-6989586621687299963"><span class="annot"><span class="annottext">telemetryForSource :: forall (b :: BackendType). SourceInfo b -&gt; TelemetryPayload
</span><a href="#local-6989586621687299963"><span class="hs-identifier hs-var hs-var">telemetryForSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-177"></span><span>              </span><span class="annot"><span class="annottext">MetadataDbId
-&gt; InstanceId
-&gt; Version
-&gt; PGVersion
-&gt; Maybe CI
-&gt; ServiceTimingMetrics
-&gt; RemoteSchemaMap
-&gt; ActionCache
-&gt; HashSet ExperimentalFeature
-&gt; SourceInfo b
-&gt; TelemetryPayload
forall (b :: BackendType).
MetadataDbId
-&gt; InstanceId
-&gt; Version
-&gt; PGVersion
-&gt; Maybe CI
-&gt; ServiceTimingMetrics
-&gt; RemoteSchemaMap
-&gt; ActionCache
-&gt; HashSet ExperimentalFeature
-&gt; SourceInfo b
-&gt; TelemetryPayload
</span><a href="Hasura.Server.Telemetry.html#mkTelemetryPayload"><span class="hs-identifier hs-var">mkTelemetryPayload</span></a></span><span>
</span><span id="line-178"></span><span>                </span><span class="annot"><span class="annottext">MetadataDbId
</span><a href="#local-6989586621687299881"><span class="hs-identifier hs-var">metadataDbUid</span></a></span><span>
</span><span id="line-179"></span><span>                </span><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621687299892"><span class="hs-identifier hs-var">appEnvInstanceId</span></a></span><span>
</span><span id="line-180"></span><span>                </span><span class="annot"><span class="annottext">Version
</span><a href="Hasura.Server.Version.html#currentVersion"><span class="hs-identifier hs-var">currentVersion</span></a></span><span>
</span><span id="line-181"></span><span>                </span><span class="annot"><span class="annottext">PGVersion
</span><a href="#local-6989586621687299882"><span class="hs-identifier hs-var">pgVersion</span></a></span><span>
</span><span id="line-182"></span><span>                </span><span class="annot"><span class="annottext">Maybe CI
</span><a href="#local-6989586621687299961"><span class="hs-identifier hs-var">ci</span></a></span><span>
</span><span id="line-183"></span><span>                </span><span class="annot"><span class="annottext">ServiceTimingMetrics
</span><a href="#local-6989586621687299958"><span class="hs-identifier hs-var">serviceTimings</span></a></span><span>
</span><span id="line-184"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaCache -&gt; RemoteSchemaMap
</span><a href="Hasura.RQL.Types.SchemaCache.html#scRemoteSchemas"><span class="hs-identifier hs-var">scRemoteSchemas</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687299956"><span class="hs-identifier hs-var">schemaCache</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaCache -&gt; ActionCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#scActions"><span class="hs-identifier hs-var">scActions</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687299956"><span class="hs-identifier hs-var">schemaCache</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>                </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621687299959"><span class="hs-identifier hs-var">experimentalFeatures</span></a></span><span>
</span><span id="line-187"></span><span>            </span><span id="local-6989586621687299968"><span class="annot"><span class="annottext">telemetries :: [TelemetryPayload]
</span><a href="#local-6989586621687299968"><span class="hs-identifier hs-var hs-var">telemetries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-188"></span><span>              </span><span class="annot"><span class="annottext">(AnyBackend SourceInfo -&gt; TelemetryPayload)
-&gt; [AnyBackend SourceInfo] -&gt; [TelemetryPayload]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span>
</span><span id="line-189"></span><span>                </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621687299969"><span class="annot"><span class="annottext">AnyBackend SourceInfo
</span><a href="#local-6989586621687299969"><span class="hs-identifier hs-var">sourceinfo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (c :: BackendType -&gt; Constraint) (i :: BackendType -&gt; *) r.
AllBackendsSatisfy c =&gt;
AnyBackend i -&gt; (forall (b :: BackendType). c b =&gt; i b -&gt; r) -&gt; r
</span><a href="Hasura.SQL.AnyBackend.html#dispatchAnyBackend"><span class="hs-identifier hs-var">Any.dispatchAnyBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.BackendTag.html#HasTag"><span class="hs-identifier hs-type">HasTag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AnyBackend SourceInfo
</span><a href="#local-6989586621687299969"><span class="hs-identifier hs-var">sourceinfo</span></a></span><span> </span><span class="annot"><span class="annottext">SourceInfo b -&gt; TelemetryPayload
forall (b :: BackendType).
HasTag b =&gt;
SourceInfo b -&gt; TelemetryPayload
forall (b :: BackendType). SourceInfo b -&gt; TelemetryPayload
</span><a href="#local-6989586621687299963"><span class="hs-identifier hs-var">telemetryForSource</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend SourceInfo)
-&gt; [AnyBackend SourceInfo]
forall k v. HashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#elems"><span class="hs-identifier hs-var">HashMap.elems</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaCache -&gt; HashMap SourceName (AnyBackend SourceInfo)
</span><a href="Hasura.RQL.Types.SchemaCache.html#scSources"><span class="hs-identifier hs-var">scSources</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687299956"><span class="hs-identifier hs-var">schemaCache</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>            </span><span id="local-6989586621687299974"><span class="annot"><span class="annottext">payloads :: [ByteString]
</span><a href="#local-6989586621687299974"><span class="hs-identifier hs-var hs-var">payloads</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TelemetryPayload -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.html#encode"><span class="hs-identifier hs-var">J.encode</span></a></span><span> </span><span class="annot"><span class="annottext">(TelemetryPayload -&gt; ByteString)
-&gt; [TelemetryPayload] -&gt; [ByteString]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[TelemetryPayload]
</span><a href="#local-6989586621687299968"><span class="hs-identifier hs-var">telemetries</span></a></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>            </span><span id="local-6989586621687299976"><span class="annot"><span class="annottext">serverTelemetry :: ByteString
</span><a href="#local-6989586621687299976"><span class="hs-identifier hs-var hs-var">serverTelemetry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-194"></span><span>              </span><span class="annot"><span class="annottext">ServerTelemetryRow -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-78f82c0a41c76fc62260cf94c4b206816c9efb8c3788f4fbd6184398938cf6fb/share/doc/html/src/Data.Aeson.html#encode"><span class="hs-identifier hs-var">J.encode</span></a></span><span>
</span><span id="line-195"></span><span>                </span><span class="annot"><span class="annottext">(ServerTelemetryRow -&gt; ByteString)
-&gt; ServerTelemetryRow -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerTelemetry -&gt; ServerTelemetryRow
</span><a href="Hasura.Server.Telemetry.html#ServerTelemetryRow"><span class="hs-identifier hs-var">ServerTelemetryRow</span></a></span><span>
</span><span id="line-196"></span><span>                </span><span class="annot"><span class="annottext">(ServerTelemetry -&gt; ServerTelemetryRow)
-&gt; ServerTelemetry -&gt; ServerTelemetryRow
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int
-&gt; Maybe Int64 -&gt; Maybe ResourceCheckerError -&gt; ServerTelemetry
</span><a href="Hasura.Server.Telemetry.html#ServerTelemetry"><span class="hs-identifier hs-var">ServerTelemetry</span></a></span><span>
</span><span id="line-197"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ComputeResourcesResponse -&gt; Maybe Int
</span><a href="Hasura.Server.ResourceChecker.html#_rcrCpu"><span class="hs-identifier hs-var">_rcrCpu</span></a></span><span> </span><span class="annot"><span class="annottext">ComputeResourcesResponse
</span><a href="#local-6989586621687299883"><span class="hs-identifier hs-var">computeResources</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ComputeResourcesResponse -&gt; Maybe Int64
</span><a href="Hasura.Server.ResourceChecker.html#_rcrMemory"><span class="hs-identifier hs-var">_rcrMemory</span></a></span><span> </span><span class="annot"><span class="annottext">ComputeResourcesResponse
</span><a href="#local-6989586621687299883"><span class="hs-identifier hs-var">computeResources</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ComputeResourcesResponse -&gt; Maybe ResourceCheckerError
</span><a href="Hasura.Server.ResourceChecker.html#_rcrErrorCode"><span class="hs-identifier hs-var">_rcrErrorCode</span></a></span><span> </span><span class="annot"><span class="annottext">ComputeResourcesResponse
</span><a href="#local-6989586621687299883"><span class="hs-identifier hs-var">computeResources</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>        </span><span class="annot"><span class="annottext">[ByteString] -&gt; (ByteString -&gt; IO ()) -&gt; IO ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687299976"><span class="hs-identifier hs-var">serverTelemetry</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621687299974"><span class="hs-identifier hs-var">payloads</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ByteString -&gt; IO ()) -&gt; IO ()) -&gt; (ByteString -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687299981"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687299981"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-202"></span><span>          </span><span class="annot"><span class="annottext">UnstructuredLog -&gt; IO ()
forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621687299879"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(UnstructuredLog -&gt; IO ()) -&gt; UnstructuredLog -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; UnstructuredLog
</span><a href="Hasura.Logging.html#debugLBS"><span class="hs-identifier hs-var">debugLBS</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; UnstructuredLog) -&gt; ByteString -&gt; UnstructuredLog
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;metrics_info: &quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687299981"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-203"></span><span>          </span><span id="local-6989586621687299983"><span class="annot"><span class="annottext">Either HttpException (Response ByteString)
</span><a href="#local-6989586621687299983"><span class="hs-identifier hs-var">resp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Response ByteString)
-&gt; IO (Either HttpException (Response ByteString))
forall e a. Exception e =&gt; IO a -&gt; IO (Either e a)
</span><span class="hs-identifier hs-var">try</span></span><span> </span><span class="annot"><span class="annottext">(IO (Response ByteString)
 -&gt; IO (Either HttpException (Response ByteString)))
-&gt; IO (Response ByteString)
-&gt; IO (Either HttpException (Response ByteString))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Options -&gt; String -&gt; ByteString -&gt; IO (Response ByteString)
forall a.
Postable a =&gt;
Options -&gt; String -&gt; a -&gt; IO (Response ByteString)
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wreq-0.5.3.3-d14fa4a0620a067aadcdad470cadd78ff72cc921d33f57afec0e938d78d757d5/share/doc/html/src/Network.Wreq.html#postWith"><span class="hs-identifier hs-var">Wreq.postWith</span></a></span><span> </span><span class="annot"><span class="annottext">Options
</span><a href="#local-6989586621687299948"><span class="hs-identifier hs-var">options</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-27d8e86ddce8dd754c06549efa10988301d41e208fc11cac9fe9ed6d99d6eb35/share/doc/html/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Hasura.Server.Telemetry.html#telemetryUrl"><span class="hs-identifier hs-var">telemetryUrl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687299981"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-204"></span><span>          </span><span class="annot"><span class="annottext">(HttpException -&gt; IO ())
-&gt; (Response ByteString -&gt; IO ())
-&gt; Either HttpException (Response ByteString)
-&gt; IO ()
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">HttpException -&gt; IO ()
</span><a href="#local-6989586621687299987"><span class="hs-identifier hs-var">logHttpEx</span></a></span><span> </span><span class="annot"><span class="annottext">Response ByteString -&gt; IO ()
</span><a href="#local-6989586621687299988"><span class="hs-identifier hs-var">handleHttpResp</span></a></span><span> </span><span class="annot"><span class="annottext">Either HttpException (Response ByteString)
</span><a href="#local-6989586621687299983"><span class="hs-identifier hs-var">resp</span></a></span><span>
</span><span id="line-205"></span><span>        </span><span class="annot"><span class="annottext">DiffTime -&gt; IO ()
</span><a href="Control.Concurrent.Extended.html#sleep"><span class="hs-identifier hs-var">C.sleep</span></a></span><span> </span><span class="annot"><span class="annottext">(DiffTime -&gt; IO ()) -&gt; DiffTime -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Days -&gt; DiffTime
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Data.Time.Clock.Units.html#days"><span class="hs-identifier hs-var">days</span></a></span><span> </span><span class="annot"><span class="annottext">Days
</span><span class="hs-number">1</span></span><span>
</span><span id="line-206"></span><span>      </span><span class="annot"><span class="annottext">TelemetryStatus
</span><a href="Hasura.Server.Init.Config.html#TelemetryDisabled"><span class="hs-identifier hs-var">TelemetryDisabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; IO ()
</span><a href="Control.Concurrent.Extended.html#sleep"><span class="hs-identifier hs-var">C.sleep</span></a></span><span> </span><span class="annot"><span class="annottext">(DiffTime -&gt; IO ()) -&gt; DiffTime -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Seconds -&gt; DiffTime
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Data.Time.Clock.Units.html#seconds"><span class="hs-identifier hs-var">seconds</span></a></span><span> </span><span class="annot"><span class="annottext">Seconds
</span><span class="hs-number">1</span></span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><a href="#local-6989586621687299987"><span class="hs-identifier hs-type">logHttpEx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-client-0.7.13.1-502ddd03dcb0699ad73741428897b95bce942b287e00ead925349aad45d2ca18/share/doc/html/src/Network.HTTP.Client.Types.html#HttpException"><span class="hs-identifier hs-type">HTTP.HttpException</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>    </span><span id="local-6989586621687299987"><span class="annot"><span class="annottext">logHttpEx :: HttpException -&gt; IO ()
</span><a href="#local-6989586621687299987"><span class="hs-identifier hs-var hs-var">logHttpEx</span></a></span></span><span> </span><span id="local-6989586621687299993"><span class="annot"><span class="annottext">HttpException
</span><a href="#local-6989586621687299993"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-210"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687299994"><span class="annot"><span class="annottext">httpErr :: Maybe TelemetryHttpError
</span><a href="#local-6989586621687299994"><span class="hs-identifier hs-var hs-var">httpErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TelemetryHttpError -&gt; Maybe TelemetryHttpError
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(TelemetryHttpError -&gt; Maybe TelemetryHttpError)
-&gt; TelemetryHttpError -&gt; Maybe TelemetryHttpError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Maybe (Response ByteString)
-&gt; Maybe HttpException
-&gt; TelemetryHttpError
</span><a href="Hasura.Server.Telemetry.html#mkHttpError"><span class="hs-identifier hs-var">mkHttpError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Hasura.Server.Telemetry.html#telemetryUrl"><span class="hs-identifier hs-var">telemetryUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Response ByteString)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpException -&gt; Maybe HttpException
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(HttpException -&gt; Maybe HttpException)
-&gt; HttpException -&gt; Maybe HttpException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HttpException -&gt; HttpException
</span><a href="Hasura.HTTP.html#HttpException"><span class="hs-identifier hs-var">HttpException</span></a></span><span> </span><span class="annot"><span class="annottext">HttpException
</span><a href="#local-6989586621687299993"><span class="hs-identifier hs-var">ex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>      </span><span class="annot"><span class="annottext">TelemetryLog -&gt; IO ()
forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621687299879"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(TelemetryLog -&gt; IO ()) -&gt; TelemetryLog -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Maybe TelemetryHttpError -&gt; TelemetryLog
</span><a href="Hasura.Server.Telemetry.html#mkTelemetryLog"><span class="hs-identifier hs-var">mkTelemetryLog</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;http_exception&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;http exception occurred&quot;</span></span><span> </span><span class="annot"><span class="annottext">Maybe TelemetryHttpError
</span><a href="#local-6989586621687299994"><span class="hs-identifier hs-var">httpErr</span></a></span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621687299988"><span class="annot"><span class="annottext">handleHttpResp :: Response ByteString -&gt; IO ()
</span><a href="#local-6989586621687299988"><span class="hs-identifier hs-var hs-var">handleHttpResp</span></a></span></span><span> </span><span id="local-6989586621687299996"><span class="annot"><span class="annottext">Response ByteString
</span><a href="#local-6989586621687299996"><span class="hs-identifier hs-var">resp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-214"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687299997"><span class="annot"><span class="annottext">statusCode :: Int
</span><a href="#local-6989586621687299997"><span class="hs-identifier hs-var hs-var">statusCode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Response ByteString
</span><a href="#local-6989586621687299996"><span class="hs-identifier hs-var">resp</span></a></span><span> </span><span class="annot"><span class="annottext">Response ByteString -&gt; Getting Int (Response ByteString) Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-70a68698e02c1d9dc133c543e6497a7241e5514570afd4815da4baf2a001e00e/share/doc/html/src/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Status -&gt; Const Int Status)
-&gt; Response ByteString -&gt; Const Int (Response ByteString)
forall body (f :: * -&gt; *).
Functor f =&gt;
(Status -&gt; f Status) -&gt; Response body -&gt; f (Response body)
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wreq-0.5.3.3-d14fa4a0620a067aadcdad470cadd78ff72cc921d33f57afec0e938d78d757d5/share/doc/html/src/Network.Wreq.Lens.html#responseStatus"><span class="hs-identifier hs-var">Wreq.responseStatus</span></a></span><span> </span><span class="annot"><span class="annottext">((Status -&gt; Const Int Status)
 -&gt; Response ByteString -&gt; Const Int (Response ByteString))
-&gt; ((Int -&gt; Const Int Int) -&gt; Status -&gt; Const Int Status)
-&gt; Getting Int (Response ByteString) Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Const Int Int) -&gt; Status -&gt; Const Int Status
Lens' Status Int
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wreq-0.5.3.3-d14fa4a0620a067aadcdad470cadd78ff72cc921d33f57afec0e938d78d757d5/share/doc/html/src/Network.Wreq.Lens.html#statusCode"><span class="hs-identifier hs-var">Wreq.statusCode</span></a></span><span>
</span><span id="line-215"></span><span>      </span><span class="annot"><span class="annottext">UnstructuredLog -&gt; IO ()
forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621687299879"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(UnstructuredLog -&gt; IO ()) -&gt; UnstructuredLog -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; UnstructuredLog
</span><a href="Hasura.Logging.html#debugLBS"><span class="hs-identifier hs-var">debugLBS</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; UnstructuredLog) -&gt; ByteString -&gt; UnstructuredLog
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;http_success: &quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Response ByteString
</span><a href="#local-6989586621687299996"><span class="hs-identifier hs-var">resp</span></a></span><span> </span><span class="annot"><span class="annottext">Response ByteString
-&gt; Getting ByteString (Response ByteString) ByteString
-&gt; ByteString
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-70a68698e02c1d9dc133c543e6497a7241e5514570afd4815da4baf2a001e00e/share/doc/html/src/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting ByteString (Response ByteString) ByteString
forall body0 body1 (f :: * -&gt; *).
Functor f =&gt;
(body0 -&gt; f body1) -&gt; Response body0 -&gt; f (Response body1)
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wreq-0.5.3.3-d14fa4a0620a067aadcdad470cadd78ff72cc921d33f57afec0e938d78d757d5/share/doc/html/src/Network.Wreq.Lens.html#responseBody"><span class="hs-identifier hs-var">Wreq.responseBody</span></a></span><span>
</span><span id="line-216"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687299997"><span class="hs-identifier hs-var">statusCode</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">200</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687300002"><span class="annot"><span class="annottext">httpErr :: Maybe TelemetryHttpError
</span><a href="#local-6989586621687300002"><span class="hs-identifier hs-var hs-var">httpErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TelemetryHttpError -&gt; Maybe TelemetryHttpError
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(TelemetryHttpError -&gt; Maybe TelemetryHttpError)
-&gt; TelemetryHttpError -&gt; Maybe TelemetryHttpError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Maybe (Response ByteString)
-&gt; Maybe HttpException
-&gt; TelemetryHttpError
</span><a href="Hasura.Server.Telemetry.html#mkHttpError"><span class="hs-identifier hs-var">mkHttpError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Hasura.Server.Telemetry.html#telemetryUrl"><span class="hs-identifier hs-var">telemetryUrl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Response ByteString -&gt; Maybe (Response ByteString)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Response ByteString
</span><a href="#local-6989586621687299996"><span class="hs-identifier hs-var">resp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe HttpException
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-218"></span><span>        </span><span class="annot"><span class="annottext">TelemetryLog -&gt; IO ()
forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621687299879"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(TelemetryLog -&gt; IO ()) -&gt; TelemetryLog -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Maybe TelemetryHttpError -&gt; TelemetryLog
</span><a href="Hasura.Server.Telemetry.html#mkTelemetryLog"><span class="hs-identifier hs-var">mkTelemetryLog</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;http_error&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;failed to post telemetry&quot;</span></span><span> </span><span class="annot"><span class="annottext">Maybe TelemetryHttpError
</span><a href="#local-6989586621687300002"><span class="hs-identifier hs-var">httpErr</span></a></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="annot"><span class="hs-comment">-- * Generate metrics</span></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span class="hs-comment">-- | Generate a telemetry payload for a specific source by computing their</span><span>
</span><span id="line-223"></span><span class="hs-comment">--   relevant metrics.</span><span>
</span><span id="line-224"></span><span class="hs-comment">--   Additional information that may not be relevant to a particular source</span><span>
</span><span id="line-225"></span><span class="hs-comment">--   such as service timing, remote schemas and actions, will be reported</span><span>
</span><span id="line-226"></span><span class="hs-comment">--   only with the default source.</span><span>
</span><span id="line-227"></span><span class="annot"><a href="Hasura.Server.Telemetry.html#mkTelemetryPayload"><span class="hs-identifier hs-type">mkTelemetryPayload</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687299345"><span class="annot"><a href="#local-6989586621687299345"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#BackendType"><span class="hs-identifier hs-type">BackendType</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-229"></span><span>  </span><span class="annot"><a href="Hasura.Server.Types.html#MetadataDbId"><span class="hs-identifier hs-type">MetadataDbId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-230"></span><span>  </span><span class="annot"><a href="Hasura.Server.Types.html#InstanceId"><span class="hs-identifier hs-type">InstanceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-231"></span><span>  </span><span class="annot"><a href="Hasura.Server.Version.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-232"></span><span>  </span><span class="annot"><a href="Hasura.Server.Types.html#PGVersion"><span class="hs-identifier hs-type">PGVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-233"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/ci-info-0.1.0.0/opt/doc/html/ci-info/src/CI.Types.html#CI"><span class="hs-identifier hs-type">CI.CI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-234"></span><span>  </span><span class="annot"><a href="Hasura.Server.Telemetry.Counters.html#ServiceTimingMetrics"><span class="hs-identifier hs-type">ServiceTimingMetrics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-235"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#RemoteSchemaMap"><span class="hs-identifier hs-type">RemoteSchemaMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-236"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#ActionCache"><span class="hs-identifier hs-type">ActionCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-237"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashSet.Internal.html#HashSet"><span class="hs-identifier hs-type">HashSet</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Types.html#ExperimentalFeature"><span class="hs-identifier hs-type">ExperimentalFeature</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceInfo"><span class="hs-identifier hs-type">SourceInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687299345"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-239"></span><span>  </span><span class="annot"><a href="Hasura.Server.Telemetry.Types.html#TelemetryPayload"><span class="hs-identifier hs-type">TelemetryPayload</span></a></span><span>
</span><span id="line-240"></span><span id="mkTelemetryPayload"><span class="annot"><span class="annottext">mkTelemetryPayload :: forall (b :: BackendType).
MetadataDbId
-&gt; InstanceId
-&gt; Version
-&gt; PGVersion
-&gt; Maybe CI
-&gt; ServiceTimingMetrics
-&gt; RemoteSchemaMap
-&gt; ActionCache
-&gt; HashSet ExperimentalFeature
-&gt; SourceInfo b
-&gt; TelemetryPayload
</span><a href="Hasura.Server.Telemetry.html#mkTelemetryPayload"><span class="hs-identifier hs-var hs-var">mkTelemetryPayload</span></a></span></span><span> </span><span id="local-6989586621687300005"><span class="annot"><span class="annottext">MetadataDbId
</span><a href="#local-6989586621687300005"><span class="hs-identifier hs-var">metadataDbId</span></a></span></span><span> </span><span id="local-6989586621687300006"><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621687300006"><span class="hs-identifier hs-var">instanceId</span></a></span></span><span> </span><span id="local-6989586621687300007"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621687300007"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621687300008"><span class="annot"><span class="annottext">PGVersion
</span><a href="#local-6989586621687300008"><span class="hs-identifier hs-var">pgVersion</span></a></span></span><span> </span><span id="local-6989586621687300009"><span class="annot"><span class="annottext">Maybe CI
</span><a href="#local-6989586621687300009"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span id="local-6989586621687300010"><span class="annot"><span class="annottext">ServiceTimingMetrics
</span><a href="#local-6989586621687300010"><span class="hs-identifier hs-var">serviceTimings</span></a></span></span><span> </span><span id="local-6989586621687300011"><span class="annot"><span class="annottext">RemoteSchemaMap
</span><a href="#local-6989586621687300011"><span class="hs-identifier hs-var">remoteSchemaMap</span></a></span></span><span> </span><span id="local-6989586621687300012"><span class="annot"><span class="annottext">ActionCache
</span><a href="#local-6989586621687300012"><span class="hs-identifier hs-var">actionCache</span></a></span></span><span> </span><span id="local-6989586621687300013"><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621687300013"><span class="hs-identifier hs-var">experimentalFeatures</span></a></span></span><span> </span><span id="local-6989586621687300014"><span class="annot"><span class="annottext">SourceInfo b
</span><a href="#local-6989586621687300014"><span class="hs-identifier hs-var">sourceInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687300015"><span class="annot"><span class="annottext">topic :: Topic
</span><a href="#local-6989586621687300015"><span class="hs-identifier hs-var hs-var">topic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Version -&gt; Topic
</span><a href="Hasura.Server.Telemetry.html#versionToTopic"><span class="hs-identifier hs-var">versionToTopic</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621687300007"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-242"></span><span>      </span><span id="local-6989586621687300017"><span class="annot"><span class="annottext">sourceMetadata :: SourceMetadata
</span><a href="#local-6989586621687300017"><span class="hs-identifier hs-var hs-var">sourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-243"></span><span>        </span><span class="annot"><a href="Hasura.Server.Telemetry.Types.html#SourceMetadata"><span class="hs-identifier hs-type">SourceMetadata</span></a></span><span>
</span><span id="line-244"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_smDbUid :: Maybe DbUid
</span><a href="Hasura.Server.Telemetry.Types.html#_smDbUid"><span class="hs-identifier hs-var">_smDbUid</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DbUid -&gt; Maybe DbUid
forall a. a -&gt; Maybe a
</span><a href="#local-6989586621687300020"><span class="hs-identifier hs-var">forDefaultSource</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetadataDbId -&gt; DbUid
</span><a href="Hasura.Server.Types.html#mdDbIdToDbUid"><span class="hs-identifier hs-var">mdDbIdToDbUid</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataDbId
</span><a href="#local-6989586621687300005"><span class="hs-identifier hs-var">metadataDbId</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-245"></span><span>            </span><span class="annot"><span class="annottext">_smBackendType :: BackendType
</span><a href="Hasura.Server.Telemetry.Types.html#_smBackendType"><span class="hs-identifier hs-var">_smBackendType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BackendSourceKind b -&gt; BackendType
forall (b :: BackendType). BackendSourceKind b -&gt; BackendType
</span><a href="Hasura.RQL.Types.BackendType.html#backendTypeFromBackendSourceKind"><span class="hs-identifier hs-var">backendTypeFromBackendSourceKind</span></a></span><span> </span><span class="annot"><span class="annottext">(BackendSourceKind b -&gt; BackendType)
-&gt; BackendSourceKind b -&gt; BackendType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceInfo b -&gt; BackendSourceKind b
forall (b :: BackendType). SourceInfo b -&gt; BackendSourceKind b
</span><a href="Hasura.RQL.Types.Source.html#_siSourceKind"><span class="hs-identifier hs-var">_siSourceKind</span></a></span><span> </span><span class="annot"><span class="annottext">SourceInfo b
</span><a href="#local-6989586621687300014"><span class="hs-identifier hs-var">sourceInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-246"></span><span>            </span><span class="annot"><span class="annottext">_smDbKind :: Text
</span><a href="Hasura.Server.Telemetry.Types.html#_smDbKind"><span class="hs-identifier hs-var">_smDbKind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BackendSourceKind b -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceInfo b -&gt; BackendSourceKind b
forall (b :: BackendType). SourceInfo b -&gt; BackendSourceKind b
</span><a href="Hasura.RQL.Types.Source.html#_siSourceKind"><span class="hs-identifier hs-var">_siSourceKind</span></a></span><span> </span><span class="annot"><span class="annottext">SourceInfo b
</span><a href="#local-6989586621687300014"><span class="hs-identifier hs-var">sourceInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-247"></span><span>            </span><span class="annot"><span class="annottext">_smDbVersion :: Maybe DbVersion
</span><a href="Hasura.Server.Telemetry.Types.html#_smDbVersion"><span class="hs-identifier hs-var">_smDbVersion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DbVersion -&gt; Maybe DbVersion
forall a. a -&gt; Maybe a
</span><a href="#local-6989586621687300020"><span class="hs-identifier hs-var">forDefaultSource</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PGVersion -&gt; DbVersion
</span><a href="Hasura.Server.Types.html#pgToDbVersion"><span class="hs-identifier hs-var">pgToDbVersion</span></a></span><span> </span><span class="annot"><span class="annottext">PGVersion
</span><a href="#local-6989586621687300008"><span class="hs-identifier hs-var">pgVersion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-249"></span><span>      </span><span class="hs-comment">-- We use this function to attach additional information that is not associated</span><span>
</span><span id="line-250"></span><span>      </span><span class="hs-comment">-- with a particular source, such as service timing, remote schemas and actions.</span><span>
</span><span id="line-251"></span><span>      </span><span class="hs-comment">-- These will be reported only with the default source.</span><span>
</span><span id="line-252"></span><span>      </span><span class="annot"><a href="#local-6989586621687300020"><span class="hs-identifier hs-type">forDefaultSource</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687300027"><span class="annot"><a href="#local-6989586621687300027"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621687300027"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621687300027"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-253"></span><span>      </span><span id="local-6989586621687300020"><span class="annot"><span class="annottext">forDefaultSource :: forall a. a -&gt; Maybe a
</span><a href="#local-6989586621687300020"><span class="hs-identifier hs-var hs-var">forDefaultSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-254"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">SourceInfo b -&gt; SourceName
forall (b :: BackendType). SourceInfo b -&gt; SourceName
</span><a href="Hasura.RQL.Types.Source.html#_siName"><span class="hs-identifier hs-var">_siName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceInfo b
</span><a href="#local-6989586621687300014"><span class="hs-identifier hs-var">sourceInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; SourceName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="Hasura.RQL.Types.Common.html#SNDefault"><span class="hs-identifier hs-var">SNDefault</span></a></span><span>
</span><span id="line-255"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-256"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; a -&gt; Maybe a
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-257"></span><span>      </span><span id="local-6989586621687300033"><span class="annot"><span class="annottext">metrics :: Metrics
</span><a href="#local-6989586621687300033"><span class="hs-identifier hs-var hs-var">metrics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-258"></span><span>        </span><span class="annot"><span class="annottext">SourceInfo b
-&gt; Maybe ServiceTimingMetrics
-&gt; Maybe RemoteSchemaMap
-&gt; Maybe ActionCache
-&gt; Metrics
forall (b :: BackendType).
SourceInfo b
-&gt; Maybe ServiceTimingMetrics
-&gt; Maybe RemoteSchemaMap
-&gt; Maybe ActionCache
-&gt; Metrics
</span><a href="Hasura.Server.Telemetry.html#computeMetrics"><span class="hs-identifier hs-var">computeMetrics</span></a></span><span>
</span><span id="line-259"></span><span>          </span><span class="annot"><span class="annottext">SourceInfo b
</span><a href="#local-6989586621687300014"><span class="hs-identifier hs-var">sourceInfo</span></a></span><span>
</span><span id="line-260"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServiceTimingMetrics -&gt; Maybe ServiceTimingMetrics
forall a. a -&gt; Maybe a
</span><a href="#local-6989586621687300020"><span class="hs-identifier hs-var">forDefaultSource</span></a></span><span> </span><span class="annot"><span class="annottext">ServiceTimingMetrics
</span><a href="#local-6989586621687300010"><span class="hs-identifier hs-var">serviceTimings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteSchemaMap -&gt; Maybe RemoteSchemaMap
forall a. a -&gt; Maybe a
</span><a href="#local-6989586621687300020"><span class="hs-identifier hs-var">forDefaultSource</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaMap
</span><a href="#local-6989586621687300011"><span class="hs-identifier hs-var">remoteSchemaMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActionCache -&gt; Maybe ActionCache
forall a. a -&gt; Maybe a
</span><a href="#local-6989586621687300020"><span class="hs-identifier hs-var">forDefaultSource</span></a></span><span> </span><span class="annot"><span class="annottext">ActionCache
</span><a href="#local-6989586621687300012"><span class="hs-identifier hs-var">actionCache</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>      </span><span id="local-6989586621687300035"><span class="annot"><span class="annottext">telemetry :: HasuraTelemetry
</span><a href="#local-6989586621687300035"><span class="hs-identifier hs-var hs-var">telemetry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-264"></span><span>        </span><span class="annot"><span class="annottext">MetadataDbId
-&gt; InstanceId
-&gt; Version
-&gt; Maybe CI
-&gt; SourceMetadata
-&gt; Metrics
-&gt; HashSet ExperimentalFeature
-&gt; HasuraTelemetry
</span><a href="Hasura.Server.Telemetry.Types.html#HasuraTelemetry"><span class="hs-identifier hs-var">HasuraTelemetry</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataDbId
</span><a href="#local-6989586621687300005"><span class="hs-identifier hs-var">metadataDbId</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621687300006"><span class="hs-identifier hs-var">instanceId</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621687300007"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CI
</span><a href="#local-6989586621687300009"><span class="hs-identifier hs-var">ci</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata
</span><a href="#local-6989586621687300017"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">Metrics
</span><a href="#local-6989586621687300033"><span class="hs-identifier hs-var">metrics</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621687300013"><span class="hs-identifier hs-var">experimentalFeatures</span></a></span><span>
</span><span id="line-265"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Topic -&gt; HasuraTelemetry -&gt; TelemetryPayload
</span><a href="Hasura.Server.Telemetry.Types.html#TelemetryPayload"><span class="hs-identifier hs-var">TelemetryPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Topic
</span><a href="#local-6989586621687300015"><span class="hs-identifier hs-var">topic</span></a></span><span> </span><span class="annot"><span class="annottext">HasuraTelemetry
</span><a href="#local-6989586621687300035"><span class="hs-identifier hs-var">telemetry</span></a></span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="annot"><span class="hs-comment">-- | Compute the relevant metrics for a specific source.</span></span><span>
</span><span id="line-268"></span><span class="annot"><a href="Hasura.Server.Telemetry.html#computeMetrics"><span class="hs-identifier hs-type">computeMetrics</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-269"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687299393"><span class="annot"><a href="#local-6989586621687299393"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#BackendType"><span class="hs-identifier hs-type">BackendType</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-270"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceInfo"><span class="hs-identifier hs-type">SourceInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687299393"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-271"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.Server.Telemetry.Counters.html#ServiceTimingMetrics"><span class="hs-identifier hs-type">ServiceTimingMetrics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-272"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#RemoteSchemaMap"><span class="hs-identifier hs-type">RemoteSchemaMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-273"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#ActionCache"><span class="hs-identifier hs-type">ActionCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><a href="Hasura.Server.Telemetry.Types.html#Metrics"><span class="hs-identifier hs-type">Metrics</span></a></span><span>
</span><span id="line-275"></span><span id="computeMetrics"><span class="annot"><span class="annottext">computeMetrics :: forall (b :: BackendType).
SourceInfo b
-&gt; Maybe ServiceTimingMetrics
-&gt; Maybe RemoteSchemaMap
-&gt; Maybe ActionCache
-&gt; Metrics
</span><a href="Hasura.Server.Telemetry.html#computeMetrics"><span class="hs-identifier hs-var hs-var">computeMetrics</span></a></span></span><span> </span><span id="local-6989586621687300068"><span class="annot"><span class="annottext">SourceInfo b
</span><a href="#local-6989586621687300068"><span class="hs-identifier hs-var">sourceInfo</span></a></span></span><span> </span><span id="local-6989586621687300069"><span class="annot"><span class="annottext">Maybe ServiceTimingMetrics
</span><a href="#local-6989586621687300069"><span class="hs-identifier hs-var">_mtServiceTimings</span></a></span></span><span> </span><span id="local-6989586621687300070"><span class="annot"><span class="annottext">Maybe RemoteSchemaMap
</span><a href="#local-6989586621687300070"><span class="hs-identifier hs-var">remoteSchemaMap</span></a></span></span><span> </span><span id="local-6989586621687300071"><span class="annot"><span class="annottext">Maybe ActionCache
</span><a href="#local-6989586621687300071"><span class="hs-identifier hs-var">actionCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687300072"><span class="annot"><span class="annottext">_mtTables :: Int
</span><a href="#local-6989586621687300072"><span class="hs-identifier hs-var hs-var">_mtTables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TableInfo b -&gt; Bool) -&gt; Int
</span><a href="#local-6989586621687300073"><span class="hs-identifier hs-var">countSourceTables</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ViewInfo -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ViewInfo -&gt; Bool)
-&gt; (TableInfo b -&gt; Maybe ViewInfo) -&gt; TableInfo b -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (FieldInfo b) (ColumnInfo b) -&gt; Maybe ViewInfo
forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn -&gt; Maybe ViewInfo
</span><a href="Hasura.Table.Cache.html#_tciViewInfo"><span class="hs-identifier hs-var">_tciViewInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(TableCoreInfoG b (FieldInfo b) (ColumnInfo b) -&gt; Maybe ViewInfo)
-&gt; (TableInfo b -&gt; TableCoreInfoG b (FieldInfo b) (ColumnInfo b))
-&gt; TableInfo b
-&gt; Maybe ViewInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TableInfo b -&gt; TableCoreInfoG b (FieldInfo b) (ColumnInfo b)
forall (b :: BackendType). TableInfo b -&gt; TableCoreInfo b
</span><a href="Hasura.Table.Cache.html#_tiCoreInfo"><span class="hs-identifier hs-var">_tiCoreInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>      </span><span id="local-6989586621687300077"><span class="annot"><span class="annottext">_mtViews :: Int
</span><a href="#local-6989586621687300077"><span class="hs-identifier hs-var hs-var">_mtViews</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TableInfo b -&gt; Bool) -&gt; Int
</span><a href="#local-6989586621687300073"><span class="hs-identifier hs-var">countSourceTables</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ViewInfo -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ViewInfo -&gt; Bool)
-&gt; (TableInfo b -&gt; Maybe ViewInfo) -&gt; TableInfo b -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (FieldInfo b) (ColumnInfo b) -&gt; Maybe ViewInfo
forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn -&gt; Maybe ViewInfo
</span><a href="Hasura.Table.Cache.html#_tciViewInfo"><span class="hs-identifier hs-var">_tciViewInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(TableCoreInfoG b (FieldInfo b) (ColumnInfo b) -&gt; Maybe ViewInfo)
-&gt; (TableInfo b -&gt; TableCoreInfoG b (FieldInfo b) (ColumnInfo b))
-&gt; TableInfo b
-&gt; Maybe ViewInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TableInfo b -&gt; TableCoreInfoG b (FieldInfo b) (ColumnInfo b)
forall (b :: BackendType). TableInfo b -&gt; TableCoreInfo b
</span><a href="Hasura.Table.Cache.html#_tiCoreInfo"><span class="hs-identifier hs-var">_tiCoreInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>      </span><span id="local-6989586621687300079"><span class="annot"><span class="annottext">_mtEnumTables :: Int
</span><a href="#local-6989586621687300079"><span class="hs-identifier hs-var hs-var">_mtEnumTables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TableInfo b -&gt; Bool) -&gt; Int
</span><a href="#local-6989586621687300073"><span class="hs-identifier hs-var">countSourceTables</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe EnumValues -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe EnumValues -&gt; Bool)
-&gt; (TableInfo b -&gt; Maybe EnumValues) -&gt; TableInfo b -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (FieldInfo b) (ColumnInfo b) -&gt; Maybe EnumValues
forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn -&gt; Maybe EnumValues
</span><a href="Hasura.Table.Cache.html#_tciEnumValues"><span class="hs-identifier hs-var">_tciEnumValues</span></a></span><span> </span><span class="annot"><span class="annottext">(TableCoreInfoG b (FieldInfo b) (ColumnInfo b) -&gt; Maybe EnumValues)
-&gt; (TableInfo b -&gt; TableCoreInfoG b (FieldInfo b) (ColumnInfo b))
-&gt; TableInfo b
-&gt; Maybe EnumValues
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TableInfo b -&gt; TableCoreInfoG b (FieldInfo b) (ColumnInfo b)
forall (b :: BackendType). TableInfo b -&gt; TableCoreInfo b
</span><a href="Hasura.Table.Cache.html#_tiCoreInfo"><span class="hs-identifier hs-var">_tiCoreInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>      </span><span id="local-6989586621687300081"><span class="annot"><span class="annottext">allRels :: [RelInfo b]
</span><a href="#local-6989586621687300081"><span class="hs-identifier hs-var hs-var">allRels</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[RelInfo b]] -&gt; [RelInfo b]
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">([[RelInfo b]] -&gt; [RelInfo b]) -&gt; [[RelInfo b]] -&gt; [RelInfo b]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap (TableName b) [RelInfo b] -&gt; [[RelInfo b]]
forall k v. HashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#elems"><span class="hs-identifier hs-var">HashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap (TableName b) [RelInfo b] -&gt; [[RelInfo b]])
-&gt; HashMap (TableName b) [RelInfo b] -&gt; [[RelInfo b]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TableInfo b -&gt; [RelInfo b])
-&gt; HashMap (TableName b) (TableInfo b)
-&gt; HashMap (TableName b) [RelInfo b]
forall v1 v2 k. (v1 -&gt; v2) -&gt; HashMap k v1 -&gt; HashMap k v2
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.Strict.html#map"><span class="hs-identifier hs-var">HashMap.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b) -&gt; [RelInfo b]
forall (backend :: BackendType).
FieldInfoMap (FieldInfo backend) -&gt; [RelInfo backend]
</span><a href="Hasura.Table.Cache.html#getRels"><span class="hs-identifier hs-var">getRels</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldInfoMap (FieldInfo b) -&gt; [RelInfo b])
-&gt; (TableInfo b -&gt; FieldInfoMap (FieldInfo b))
-&gt; TableInfo b
-&gt; [RelInfo b]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (FieldInfo b) (ColumnInfo b)
-&gt; FieldInfoMap (FieldInfo b)
forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn -&gt; FieldInfoMap field
</span><a href="Hasura.Table.Cache.html#_tciFieldInfoMap"><span class="hs-identifier hs-var">_tciFieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">(TableCoreInfoG b (FieldInfo b) (ColumnInfo b)
 -&gt; FieldInfoMap (FieldInfo b))
-&gt; (TableInfo b -&gt; TableCoreInfoG b (FieldInfo b) (ColumnInfo b))
-&gt; TableInfo b
-&gt; FieldInfoMap (FieldInfo b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TableInfo b -&gt; TableCoreInfoG b (FieldInfo b) (ColumnInfo b)
forall (b :: BackendType). TableInfo b -&gt; TableCoreInfo b
</span><a href="Hasura.Table.Cache.html#_tiCoreInfo"><span class="hs-identifier hs-var">_tiCoreInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap (TableName b) (TableInfo b)
</span><a href="#local-6989586621687300085"><span class="hs-identifier hs-var">sourceTableCache</span></a></span><span>
</span><span id="line-280"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621687300086"><span class="annot"><span class="annottext">[RelInfo b]
</span><a href="#local-6989586621687300086"><span class="hs-identifier hs-var">manualRels</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687300087"><span class="annot"><span class="annottext">[RelInfo b]
</span><a href="#local-6989586621687300087"><span class="hs-identifier hs-var">autoRels</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RelInfo b -&gt; Bool) -&gt; [RelInfo b] -&gt; ([RelInfo b], [RelInfo b])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">L.partition</span></span><span> </span><span class="annot"><span class="annottext">RelInfo b -&gt; Bool
forall (b :: BackendType). RelInfo b -&gt; Bool
</span><a href="Hasura.RQL.Types.Relationships.Local.html#riIsManual"><span class="hs-identifier hs-var">riIsManual</span></a></span><span> </span><span class="annot"><span class="annottext">[RelInfo b]
</span><a href="#local-6989586621687300081"><span class="hs-identifier hs-var">allRels</span></a></span><span>
</span><span id="line-281"></span><span>      </span><span id="local-6989586621687300090"><span class="annot"><span class="annottext">_mtRelationships :: RelationshipMetric
</span><a href="#local-6989586621687300090"><span class="hs-identifier hs-var hs-var">_mtRelationships</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; RelationshipMetric
</span><a href="Hasura.Server.Telemetry.Types.html#RelationshipMetric"><span class="hs-identifier hs-var">RelationshipMetric</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[RelInfo b] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[RelInfo b]
</span><a href="#local-6989586621687300086"><span class="hs-identifier hs-var">manualRels</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[RelInfo b] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[RelInfo b]
</span><a href="#local-6989586621687300087"><span class="hs-identifier hs-var">autoRels</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>      </span><span id="local-6989586621687300093"><span class="annot"><span class="annottext">rolePerms :: [(RoleName, RolePermInfo b)]
</span><a href="#local-6989586621687300093"><span class="hs-identifier hs-var hs-var">rolePerms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(RoleName, RolePermInfo b)]] -&gt; [(RoleName, RolePermInfo b)]
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">([[(RoleName, RolePermInfo b)]] -&gt; [(RoleName, RolePermInfo b)])
-&gt; [[(RoleName, RolePermInfo b)]] -&gt; [(RoleName, RolePermInfo b)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap (TableName b) [(RoleName, RolePermInfo b)]
-&gt; [[(RoleName, RolePermInfo b)]]
forall k v. HashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#elems"><span class="hs-identifier hs-var">HashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap (TableName b) [(RoleName, RolePermInfo b)]
 -&gt; [[(RoleName, RolePermInfo b)]])
-&gt; HashMap (TableName b) [(RoleName, RolePermInfo b)]
-&gt; [[(RoleName, RolePermInfo b)]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TableInfo b -&gt; [(RoleName, RolePermInfo b)])
-&gt; HashMap (TableName b) (TableInfo b)
-&gt; HashMap (TableName b) [(RoleName, RolePermInfo b)]
forall v1 v2 k. (v1 -&gt; v2) -&gt; HashMap k v1 -&gt; HashMap k v2
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.Strict.html#map"><span class="hs-identifier hs-var">HashMap.map</span></a></span><span> </span><span class="annot"><span class="annottext">TableInfo b -&gt; [(RoleName, RolePermInfo b)]
</span><a href="#local-6989586621687300094"><span class="hs-identifier hs-var">permsOfTbl</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (TableName b) (TableInfo b)
</span><a href="#local-6989586621687300085"><span class="hs-identifier hs-var">sourceTableCache</span></a></span><span>
</span><span id="line-283"></span><span>      </span><span id="local-6989586621687300095"><span class="annot"><span class="annottext">_pmRoles :: Int
</span><a href="#local-6989586621687300095"><span class="hs-identifier hs-var hs-var">_pmRoles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[RoleName] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([RoleName] -&gt; Int) -&gt; [RoleName] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[RoleName] -&gt; [RoleName]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.List.Extended.html#uniques"><span class="hs-identifier hs-var">L.uniques</span></a></span><span> </span><span class="annot"><span class="annottext">([RoleName] -&gt; [RoleName]) -&gt; [RoleName] -&gt; [RoleName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(RoleName, RolePermInfo b) -&gt; RoleName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((RoleName, RolePermInfo b) -&gt; RoleName)
-&gt; [(RoleName, RolePermInfo b)] -&gt; [RoleName]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(RoleName, RolePermInfo b)]
</span><a href="#local-6989586621687300093"><span class="hs-identifier hs-var">rolePerms</span></a></span><span>
</span><span id="line-284"></span><span>      </span><span id="local-6989586621687300098"><span class="annot"><span class="annottext">allPerms :: [RolePermInfo b]
</span><a href="#local-6989586621687300098"><span class="hs-identifier hs-var hs-var">allPerms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RoleName, RolePermInfo b) -&gt; RolePermInfo b
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((RoleName, RolePermInfo b) -&gt; RolePermInfo b)
-&gt; [(RoleName, RolePermInfo b)] -&gt; [RolePermInfo b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(RoleName, RolePermInfo b)]
</span><a href="#local-6989586621687300093"><span class="hs-identifier hs-var">rolePerms</span></a></span><span>
</span><span id="line-285"></span><span>      </span><span id="local-6989586621687300100"><span class="annot"><span class="annottext">_pmInsert :: Int
</span><a href="#local-6989586621687300100"><span class="hs-identifier hs-var hs-var">_pmInsert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RolePermInfo b -&gt; Maybe (InsPermInfo b))
-&gt; [RolePermInfo b] -&gt; Int
forall a. (RolePermInfo b -&gt; Maybe a) -&gt; [RolePermInfo b] -&gt; Int
</span><a href="#local-6989586621687300101"><span class="hs-identifier hs-var">calcPerms</span></a></span><span> </span><span class="annot"><span class="annottext">RolePermInfo b -&gt; Maybe (InsPermInfo b)
forall (b :: BackendType). RolePermInfo b -&gt; Maybe (InsPermInfo b)
</span><a href="Hasura.Table.Cache.html#_permIns"><span class="hs-identifier hs-var">_permIns</span></a></span><span> </span><span class="annot"><span class="annottext">[RolePermInfo b]
</span><a href="#local-6989586621687300098"><span class="hs-identifier hs-var">allPerms</span></a></span><span>
</span><span id="line-286"></span><span>      </span><span id="local-6989586621687300103"><span class="annot"><span class="annottext">_pmSelect :: Int
</span><a href="#local-6989586621687300103"><span class="hs-identifier hs-var hs-var">_pmSelect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RolePermInfo b -&gt; Maybe (SelPermInfo b))
-&gt; [RolePermInfo b] -&gt; Int
forall a. (RolePermInfo b -&gt; Maybe a) -&gt; [RolePermInfo b] -&gt; Int
</span><a href="#local-6989586621687300101"><span class="hs-identifier hs-var">calcPerms</span></a></span><span> </span><span class="annot"><span class="annottext">RolePermInfo b -&gt; Maybe (SelPermInfo b)
forall (b :: BackendType). RolePermInfo b -&gt; Maybe (SelPermInfo b)
</span><a href="Hasura.Table.Cache.html#_permSel"><span class="hs-identifier hs-var">_permSel</span></a></span><span> </span><span class="annot"><span class="annottext">[RolePermInfo b]
</span><a href="#local-6989586621687300098"><span class="hs-identifier hs-var">allPerms</span></a></span><span>
</span><span id="line-287"></span><span>      </span><span id="local-6989586621687300105"><span class="annot"><span class="annottext">_pmUpdate :: Int
</span><a href="#local-6989586621687300105"><span class="hs-identifier hs-var hs-var">_pmUpdate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RolePermInfo b -&gt; Maybe (UpdPermInfo b))
-&gt; [RolePermInfo b] -&gt; Int
forall a. (RolePermInfo b -&gt; Maybe a) -&gt; [RolePermInfo b] -&gt; Int
</span><a href="#local-6989586621687300101"><span class="hs-identifier hs-var">calcPerms</span></a></span><span> </span><span class="annot"><span class="annottext">RolePermInfo b -&gt; Maybe (UpdPermInfo b)
forall (b :: BackendType). RolePermInfo b -&gt; Maybe (UpdPermInfo b)
</span><a href="Hasura.Table.Cache.html#_permUpd"><span class="hs-identifier hs-var">_permUpd</span></a></span><span> </span><span class="annot"><span class="annottext">[RolePermInfo b]
</span><a href="#local-6989586621687300098"><span class="hs-identifier hs-var">allPerms</span></a></span><span>
</span><span id="line-288"></span><span>      </span><span id="local-6989586621687300107"><span class="annot"><span class="annottext">_pmDelete :: Int
</span><a href="#local-6989586621687300107"><span class="hs-identifier hs-var hs-var">_pmDelete</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RolePermInfo b -&gt; Maybe (DelPermInfo b))
-&gt; [RolePermInfo b] -&gt; Int
forall a. (RolePermInfo b -&gt; Maybe a) -&gt; [RolePermInfo b] -&gt; Int
</span><a href="#local-6989586621687300101"><span class="hs-identifier hs-var">calcPerms</span></a></span><span> </span><span class="annot"><span class="annottext">RolePermInfo b -&gt; Maybe (DelPermInfo b)
forall (b :: BackendType). RolePermInfo b -&gt; Maybe (DelPermInfo b)
</span><a href="Hasura.Table.Cache.html#_permDel"><span class="hs-identifier hs-var">_permDel</span></a></span><span> </span><span class="annot"><span class="annottext">[RolePermInfo b]
</span><a href="#local-6989586621687300098"><span class="hs-identifier hs-var">allPerms</span></a></span><span>
</span><span id="line-289"></span><span>      </span><span id="local-6989586621687300109"><span class="annot"><span class="annottext">_mtPermissions :: PermissionMetric
</span><a href="#local-6989586621687300109"><span class="hs-identifier hs-var hs-var">_mtPermissions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-290"></span><span>        </span><span class="annot"><a href="Hasura.Server.Telemetry.Types.html#PermissionMetric"><span class="hs-identifier hs-type">PermissionMetric</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Int
_pmRoles :: Int
_pmInsert :: Int
_pmSelect :: Int
_pmUpdate :: Int
_pmDelete :: Int
_pmSelect :: Int
_pmInsert :: Int
_pmUpdate :: Int
_pmDelete :: Int
_pmRoles :: Int
</span><a href="#local-6989586621687300095"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-291"></span><span>      </span><span id="local-6989586621687300116"><span class="annot"><span class="annottext">_mtEventTriggers :: Int
</span><a href="#local-6989586621687300116"><span class="hs-identifier hs-var hs-var">_mtEventTriggers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-292"></span><span>        </span><span class="annot"><span class="annottext">HashMap (TableName b) (HashMap TriggerName (EventTriggerInfo b))
-&gt; Int
forall k v. HashMap k v -&gt; Int
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#size"><span class="hs-identifier hs-var">HashMap.size</span></a></span><span>
</span><span id="line-293"></span><span>          </span><span class="annot"><span class="annottext">(HashMap (TableName b) (HashMap TriggerName (EventTriggerInfo b))
 -&gt; Int)
-&gt; HashMap (TableName b) (HashMap TriggerName (EventTriggerInfo b))
-&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(HashMap TriggerName (EventTriggerInfo b) -&gt; Bool)
-&gt; HashMap (TableName b) (HashMap TriggerName (EventTriggerInfo b))
-&gt; HashMap (TableName b) (HashMap TriggerName (EventTriggerInfo b))
forall v k. (v -&gt; Bool) -&gt; HashMap k v -&gt; HashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#filter"><span class="hs-identifier hs-var">HashMap.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (HashMap TriggerName (EventTriggerInfo b) -&gt; Bool)
-&gt; HashMap TriggerName (EventTriggerInfo b)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HashMap TriggerName (EventTriggerInfo b) -&gt; Bool
forall k v. HashMap k v -&gt; Bool
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#null"><span class="hs-identifier hs-var">HashMap.null</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>          </span><span class="annot"><span class="annottext">(HashMap (TableName b) (HashMap TriggerName (EventTriggerInfo b))
 -&gt; HashMap
      (TableName b) (HashMap TriggerName (EventTriggerInfo b)))
-&gt; HashMap (TableName b) (HashMap TriggerName (EventTriggerInfo b))
-&gt; HashMap (TableName b) (HashMap TriggerName (EventTriggerInfo b))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TableInfo b -&gt; HashMap TriggerName (EventTriggerInfo b))
-&gt; HashMap (TableName b) (TableInfo b)
-&gt; HashMap (TableName b) (HashMap TriggerName (EventTriggerInfo b))
forall v1 v2 k. (v1 -&gt; v2) -&gt; HashMap k v1 -&gt; HashMap k v2
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.Strict.html#map"><span class="hs-identifier hs-var">HashMap.map</span></a></span><span> </span><span class="annot"><span class="annottext">TableInfo b -&gt; HashMap TriggerName (EventTriggerInfo b)
forall (b :: BackendType). TableInfo b -&gt; EventTriggerInfoMap b
</span><a href="Hasura.Table.Cache.html#_tiEventTriggerInfoMap"><span class="hs-identifier hs-var">_tiEventTriggerInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (TableName b) (TableInfo b)
</span><a href="#local-6989586621687300085"><span class="hs-identifier hs-var">sourceTableCache</span></a></span><span>
</span><span id="line-295"></span><span>      </span><span id="local-6989586621687300122"><span class="annot"><span class="annottext">_mtRemoteSchemas :: Maybe Int
</span><a href="#local-6989586621687300122"><span class="hs-identifier hs-var hs-var">_mtRemoteSchemas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RemoteSchemaMap -&gt; Int
forall k v. HashMap k v -&gt; Int
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#size"><span class="hs-identifier hs-var">HashMap.size</span></a></span><span> </span><span class="annot"><span class="annottext">(RemoteSchemaMap -&gt; Int) -&gt; Maybe RemoteSchemaMap -&gt; Maybe Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe RemoteSchemaMap
</span><a href="#local-6989586621687300070"><span class="hs-identifier hs-var">remoteSchemaMap</span></a></span><span>
</span><span id="line-296"></span><span>      </span><span id="local-6989586621687300123"><span class="annot"><span class="annottext">_mtFunctions :: Int
</span><a href="#local-6989586621687300123"><span class="hs-identifier hs-var hs-var">_mtFunctions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap (FunctionName b) (FunctionInfo b) -&gt; Int
forall k v. HashMap k v -&gt; Int
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#size"><span class="hs-identifier hs-var">HashMap.size</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap (FunctionName b) (FunctionInfo b) -&gt; Int)
-&gt; HashMap (FunctionName b) (FunctionInfo b) -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(FunctionInfo b -&gt; Bool)
-&gt; HashMap (FunctionName b) (FunctionInfo b)
-&gt; HashMap (FunctionName b) (FunctionInfo b)
forall v k. (v -&gt; Bool) -&gt; HashMap k v -&gt; HashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#filter"><span class="hs-identifier hs-var">HashMap.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (FunctionInfo b -&gt; Bool) -&gt; FunctionInfo b -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SystemDefined -&gt; Bool
</span><a href="Hasura.RQL.Types.Common.html#isSystemDefined"><span class="hs-identifier hs-var">isSystemDefined</span></a></span><span> </span><span class="annot"><span class="annottext">(SystemDefined -&gt; Bool)
-&gt; (FunctionInfo b -&gt; SystemDefined) -&gt; FunctionInfo b -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FunctionInfo b -&gt; SystemDefined
forall (b :: BackendType). FunctionInfo b -&gt; SystemDefined
</span><a href="Hasura.Function.Cache.html#_fiSystemDefined"><span class="hs-identifier hs-var">_fiSystemDefined</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap (FunctionName b) (FunctionInfo b)
</span><a href="#local-6989586621687300126"><span class="hs-identifier hs-var">sourceFunctionCache</span></a></span><span>
</span><span id="line-297"></span><span>      </span><span id="local-6989586621687300127"><span class="annot"><span class="annottext">_mtActions :: Maybe ActionMetric
</span><a href="#local-6989586621687300127"><span class="hs-identifier hs-var hs-var">_mtActions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ActionCache -&gt; ActionMetric
</span><a href="Hasura.Server.Telemetry.html#computeActionsMetrics"><span class="hs-identifier hs-var">computeActionsMetrics</span></a></span><span> </span><span class="annot"><span class="annottext">(ActionCache -&gt; ActionMetric)
-&gt; Maybe ActionCache -&gt; Maybe ActionMetric
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ActionCache
</span><a href="#local-6989586621687300071"><span class="hs-identifier hs-var">actionCache</span></a></span><span>
</span><span id="line-298"></span><span>      </span><span id="local-6989586621687300129"><span class="annot"><span class="annottext">_mtNativeQueries :: NativeQueriesMetrics
</span><a href="#local-6989586621687300129"><span class="hs-identifier hs-var hs-var">_mtNativeQueries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NativeQueryInfo b] -&gt; NativeQueriesMetrics
</span><a href="#local-6989586621687300130"><span class="hs-identifier hs-var">countNativeQueries</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap NativeQueryName (NativeQueryInfo b) -&gt; [NativeQueryInfo b]
forall k v. HashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#elems"><span class="hs-identifier hs-var">HashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap NativeQueryName (NativeQueryInfo b)
 -&gt; [NativeQueryInfo b])
-&gt; HashMap NativeQueryName (NativeQueryInfo b)
-&gt; [NativeQueryInfo b]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceInfo b -&gt; HashMap NativeQueryName (NativeQueryInfo b)
forall (b :: BackendType). SourceInfo b -&gt; NativeQueryCache b
</span><a href="Hasura.RQL.Types.Source.html#_siNativeQueries"><span class="hs-identifier hs-var">_siNativeQueries</span></a></span><span> </span><span class="annot"><span class="annottext">SourceInfo b
</span><a href="#local-6989586621687300068"><span class="hs-identifier hs-var">sourceInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>      </span><span id="local-6989586621687300132"><span class="annot"><span class="annottext">_mtStoredProcedures :: StoredProceduresMetrics
</span><a href="#local-6989586621687300132"><span class="hs-identifier hs-var hs-var">_mtStoredProcedures</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[StoredProcedureInfo b] -&gt; StoredProceduresMetrics
</span><a href="#local-6989586621687300133"><span class="hs-identifier hs-var">countStoredProcedures</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap (FunctionName b) (StoredProcedureInfo b)
-&gt; [StoredProcedureInfo b]
forall k v. HashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#elems"><span class="hs-identifier hs-var">HashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap (FunctionName b) (StoredProcedureInfo b)
 -&gt; [StoredProcedureInfo b])
-&gt; HashMap (FunctionName b) (StoredProcedureInfo b)
-&gt; [StoredProcedureInfo b]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceInfo b -&gt; HashMap (FunctionName b) (StoredProcedureInfo b)
forall (b :: BackendType). SourceInfo b -&gt; StoredProcedureCache b
</span><a href="Hasura.RQL.Types.Source.html#_siStoredProcedures"><span class="hs-identifier hs-var">_siStoredProcedures</span></a></span><span> </span><span class="annot"><span class="annottext">SourceInfo b
</span><a href="#local-6989586621687300068"><span class="hs-identifier hs-var">sourceInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>      </span><span id="local-6989586621687300135"><span class="annot"><span class="annottext">_mtLogicalModels :: LogicalModelsMetrics
</span><a href="#local-6989586621687300135"><span class="hs-identifier hs-var hs-var">_mtLogicalModels</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LogicalModelInfo b] -&gt; LogicalModelsMetrics
</span><a href="#local-6989586621687300136"><span class="hs-identifier hs-var">countLogicalModels</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap LogicalModelName (LogicalModelInfo b)
-&gt; [LogicalModelInfo b]
forall k v. HashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#elems"><span class="hs-identifier hs-var">HashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap LogicalModelName (LogicalModelInfo b)
 -&gt; [LogicalModelInfo b])
-&gt; HashMap LogicalModelName (LogicalModelInfo b)
-&gt; [LogicalModelInfo b]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceInfo b -&gt; HashMap LogicalModelName (LogicalModelInfo b)
forall (b :: BackendType). SourceInfo b -&gt; LogicalModelCache b
</span><a href="Hasura.RQL.Types.Source.html#_siLogicalModels"><span class="hs-identifier hs-var">_siLogicalModels</span></a></span><span> </span><span class="annot"><span class="annottext">SourceInfo b
</span><a href="#local-6989586621687300068"><span class="hs-identifier hs-var">sourceInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><a href="Hasura.Server.Telemetry.Types.html#Metrics"><span class="hs-identifier hs-type">Metrics</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Int
Maybe Int
Maybe ServiceTimingMetrics
Maybe ActionMetric
RelationshipMetric
PermissionMetric
NativeQueriesMetrics
StoredProceduresMetrics
LogicalModelsMetrics
_mtServiceTimings :: Maybe ServiceTimingMetrics
_mtTables :: Int
_mtViews :: Int
_mtEnumTables :: Int
_mtRelationships :: RelationshipMetric
_mtPermissions :: PermissionMetric
_mtEventTriggers :: Int
_mtRemoteSchemas :: Maybe Int
_mtFunctions :: Int
_mtActions :: Maybe ActionMetric
_mtNativeQueries :: NativeQueriesMetrics
_mtStoredProcedures :: StoredProceduresMetrics
_mtLogicalModels :: LogicalModelsMetrics
_mtTables :: Int
_mtViews :: Int
_mtEnumTables :: Int
_mtRelationships :: RelationshipMetric
_mtPermissions :: PermissionMetric
_mtEventTriggers :: Int
_mtFunctions :: Int
_mtRemoteSchemas :: Maybe Int
_mtServiceTimings :: Maybe ServiceTimingMetrics
_mtActions :: Maybe ActionMetric
_mtNativeQueries :: NativeQueriesMetrics
_mtStoredProcedures :: StoredProceduresMetrics
_mtLogicalModels :: LogicalModelsMetrics
</span><a href="#local-6989586621687300069"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-302"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-303"></span><span>    </span><span id="local-6989586621687300085"><span class="annot"><span class="annottext">sourceTableCache :: HashMap (TableName b) (TableInfo b)
</span><a href="#local-6989586621687300085"><span class="hs-identifier hs-var hs-var">sourceTableCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceInfo b -&gt; HashMap (TableName b) (TableInfo b)
forall (b :: BackendType). SourceInfo b -&gt; TableCache b
</span><a href="Hasura.RQL.Types.Source.html#_siTables"><span class="hs-identifier hs-var">_siTables</span></a></span><span> </span><span class="annot"><span class="annottext">SourceInfo b
</span><a href="#local-6989586621687300068"><span class="hs-identifier hs-var">sourceInfo</span></a></span><span>
</span><span id="line-304"></span><span>    </span><span id="local-6989586621687300126"><span class="annot"><span class="annottext">sourceFunctionCache :: HashMap (FunctionName b) (FunctionInfo b)
</span><a href="#local-6989586621687300126"><span class="hs-identifier hs-var hs-var">sourceFunctionCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceInfo b -&gt; HashMap (FunctionName b) (FunctionInfo b)
forall (b :: BackendType). SourceInfo b -&gt; FunctionCache b
</span><a href="Hasura.RQL.Types.Source.html#_siFunctions"><span class="hs-identifier hs-var">_siFunctions</span></a></span><span> </span><span class="annot"><span class="annottext">SourceInfo b
</span><a href="#local-6989586621687300068"><span class="hs-identifier hs-var">sourceInfo</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span id="local-6989586621687300073"><span class="annot"><span class="annottext">countSourceTables :: (TableInfo b -&gt; Bool) -&gt; Int
</span><a href="#local-6989586621687300073"><span class="hs-identifier hs-var hs-var">countSourceTables</span></a></span></span><span> </span><span id="local-6989586621687300153"><span class="annot"><span class="annottext">TableInfo b -&gt; Bool
</span><a href="#local-6989586621687300153"><span class="hs-identifier hs-var">predicate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TableInfo b] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([TableInfo b] -&gt; Int)
-&gt; ([TableInfo b] -&gt; [TableInfo b]) -&gt; [TableInfo b] -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TableInfo b -&gt; Bool) -&gt; [TableInfo b] -&gt; [TableInfo b]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">TableInfo b -&gt; Bool
</span><a href="#local-6989586621687300153"><span class="hs-identifier hs-var">predicate</span></a></span><span> </span><span class="annot"><span class="annottext">([TableInfo b] -&gt; Int) -&gt; [TableInfo b] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap (TableName b) (TableInfo b) -&gt; [TableInfo b]
forall k v. HashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#elems"><span class="hs-identifier hs-var">HashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (TableName b) (TableInfo b)
</span><a href="#local-6989586621687300085"><span class="hs-identifier hs-var">sourceTableCache</span></a></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span>    </span><span id="local-6989586621687299443"><span class="annot"><a href="#local-6989586621687300101"><span class="hs-identifier hs-type">calcPerms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Table.Cache.html#RolePermInfo"><span class="hs-identifier hs-type">RolePermInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687299393"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621687299443"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.Table.Cache.html#RolePermInfo"><span class="hs-identifier hs-type">RolePermInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687299393"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-308"></span><span>    </span><span id="local-6989586621687300101"><span class="annot"><span class="annottext">calcPerms :: forall a. (RolePermInfo b -&gt; Maybe a) -&gt; [RolePermInfo b] -&gt; Int
</span><a href="#local-6989586621687300101"><span class="hs-identifier hs-var hs-var">calcPerms</span></a></span></span><span> </span><span id="local-6989586621687300157"><span class="annot"><span class="annottext">RolePermInfo b -&gt; Maybe a
</span><a href="#local-6989586621687300157"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621687300158"><span class="annot"><span class="annottext">[RolePermInfo b]
</span><a href="#local-6989586621687300158"><span class="hs-identifier hs-var">perms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([a] -&gt; Int) -&gt; [a] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(RolePermInfo b -&gt; Maybe a) -&gt; [RolePermInfo b] -&gt; [a]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b.
Filterable f =&gt;
(a -&gt; Maybe b) -&gt; f a -&gt; f b
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/witherable-0.4.2-a40f3f0a2ed7f25145b5b00589bf4ea2486662b1e96b7d29d5e6041625ee4a09/share/doc/html/src/Witherable.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">RolePermInfo b -&gt; Maybe a
</span><a href="#local-6989586621687300157"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">[RolePermInfo b]
</span><a href="#local-6989586621687300158"><span class="hs-identifier hs-var">perms</span></a></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>    </span><span class="annot"><a href="#local-6989586621687300094"><span class="hs-identifier hs-type">permsOfTbl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Table.Cache.html#TableInfo"><span class="hs-identifier hs-type">TableInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687299393"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Roles.html#RoleName"><span class="hs-identifier hs-type">RoleName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Table.Cache.html#RolePermInfo"><span class="hs-identifier hs-type">RolePermInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687299393"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-311"></span><span>    </span><span id="local-6989586621687300094"><span class="annot"><span class="annottext">permsOfTbl :: TableInfo b -&gt; [(RoleName, RolePermInfo b)]
</span><a href="#local-6989586621687300094"><span class="hs-identifier hs-var hs-var">permsOfTbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap RoleName (RolePermInfo b) -&gt; [(RoleName, RolePermInfo b)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#toList"><span class="hs-identifier hs-var">HashMap.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap RoleName (RolePermInfo b) -&gt; [(RoleName, RolePermInfo b)])
-&gt; (TableInfo b -&gt; HashMap RoleName (RolePermInfo b))
-&gt; TableInfo b
-&gt; [(RoleName, RolePermInfo b)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TableInfo b -&gt; HashMap RoleName (RolePermInfo b)
forall (b :: BackendType). TableInfo b -&gt; RolePermInfoMap b
</span><a href="Hasura.Table.Cache.html#_tiRolePermInfoMap"><span class="hs-identifier hs-var">_tiRolePermInfoMap</span></a></span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span>    </span><span class="annot"><a href="#local-6989586621687300136"><span class="hs-identifier hs-type">countLogicalModels</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.LogicalModel.Cache.html#LogicalModelInfo"><span class="hs-identifier hs-type">LogicalModelInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687299393"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Telemetry.Types.html#LogicalModelsMetrics"><span class="hs-identifier hs-type">LogicalModelsMetrics</span></a></span><span>
</span><span id="line-314"></span><span>    </span><span id="local-6989586621687300136"><span class="annot"><span class="annottext">countLogicalModels :: [LogicalModelInfo b] -&gt; LogicalModelsMetrics
</span><a href="#local-6989586621687300136"><span class="hs-identifier hs-var hs-var">countLogicalModels</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-315"></span><span>      </span><span class="annot"><span class="annottext">(LogicalModelInfo b -&gt; LogicalModelsMetrics)
-&gt; [LogicalModelInfo b] -&gt; LogicalModelsMetrics
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span>
</span><span id="line-316"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">LogicalModelInfo b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LogicalModelsMetrics
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">_lmmCount :: Int
</span><a href="Hasura.Server.Telemetry.Types.html#_lmmCount"><span class="hs-identifier hs-var">_lmmCount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span>    </span><span class="annot"><a href="#local-6989586621687300130"><span class="hs-identifier hs-type">countNativeQueries</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.NativeQuery.Cache.html#NativeQueryInfo"><span class="hs-identifier hs-type">NativeQueryInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687299393"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Telemetry.Types.html#NativeQueriesMetrics"><span class="hs-identifier hs-type">NativeQueriesMetrics</span></a></span><span>
</span><span id="line-319"></span><span>    </span><span id="local-6989586621687300130"><span class="annot"><span class="annottext">countNativeQueries :: [NativeQueryInfo b] -&gt; NativeQueriesMetrics
</span><a href="#local-6989586621687300130"><span class="hs-identifier hs-var hs-var">countNativeQueries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-320"></span><span>      </span><span class="annot"><span class="annottext">(NativeQueryInfo b -&gt; NativeQueriesMetrics)
-&gt; [NativeQueryInfo b] -&gt; NativeQueriesMetrics
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span>
</span><span id="line-321"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687300164"><span class="annot"><span class="annottext">NativeQueryInfo b
</span><a href="#local-6989586621687300164"><span class="hs-identifier hs-var">nativeQuery</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-322"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HashMap ArgumentName (NullableScalarType b) -&gt; Bool
forall a. HashMap ArgumentName a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NativeQueryInfo b -&gt; HashMap ArgumentName (NullableScalarType b)
forall (b :: BackendType).
NativeQueryInfo b -&gt; HashMap ArgumentName (NullableScalarType b)
</span><a href="Hasura.NativeQuery.Cache.html#_nqiArguments"><span class="hs-identifier hs-var">_nqiArguments</span></a></span><span> </span><span class="annot"><span class="annottext">NativeQueryInfo b
</span><a href="#local-6989586621687300164"><span class="hs-identifier hs-var">nativeQuery</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">NativeQueriesMetrics
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">_nqmWithoutParameters :: Int
</span><a href="Hasura.Server.Telemetry.Types.html#_nqmWithoutParameters"><span class="hs-identifier hs-var">_nqmWithoutParameters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">}</span><span>
</span><span id="line-324"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">NativeQueriesMetrics
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">_nqmWithParameters :: Int
</span><a href="Hasura.Server.Telemetry.Types.html#_nqmWithParameters"><span class="hs-identifier hs-var">_nqmWithParameters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">}</span><span>
</span><span id="line-325"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span>    </span><span class="annot"><a href="#local-6989586621687300133"><span class="hs-identifier hs-type">countStoredProcedures</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.StoredProcedure.Cache.html#StoredProcedureInfo"><span class="hs-identifier hs-type">StoredProcedureInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687299393"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Telemetry.Types.html#StoredProceduresMetrics"><span class="hs-identifier hs-type">StoredProceduresMetrics</span></a></span><span>
</span><span id="line-328"></span><span>    </span><span id="local-6989586621687300133"><span class="annot"><span class="annottext">countStoredProcedures :: [StoredProcedureInfo b] -&gt; StoredProceduresMetrics
</span><a href="#local-6989586621687300133"><span class="hs-identifier hs-var hs-var">countStoredProcedures</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-329"></span><span>      </span><span class="annot"><span class="annottext">(StoredProcedureInfo b -&gt; StoredProceduresMetrics)
-&gt; [StoredProcedureInfo b] -&gt; StoredProceduresMetrics
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span>
</span><span id="line-330"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687300168"><span class="annot"><span class="annottext">StoredProcedureInfo b
</span><a href="#local-6989586621687300168"><span class="hs-identifier hs-var">storedProcedure</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-331"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HashMap ArgumentName (NullableScalarType b) -&gt; Bool
forall a. HashMap ArgumentName a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StoredProcedureInfo b
-&gt; HashMap ArgumentName (NullableScalarType b)
forall (b :: BackendType).
StoredProcedureInfo b
-&gt; HashMap ArgumentName (NullableScalarType b)
</span><a href="Hasura.StoredProcedure.Cache.html#_spiArguments"><span class="hs-identifier hs-var">_spiArguments</span></a></span><span> </span><span class="annot"><span class="annottext">StoredProcedureInfo b
</span><a href="#local-6989586621687300168"><span class="hs-identifier hs-var">storedProcedure</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">StoredProceduresMetrics
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">_spmWithoutParameters :: Int
</span><a href="Hasura.Server.Telemetry.Types.html#_spmWithoutParameters"><span class="hs-identifier hs-var">_spmWithoutParameters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">}</span><span>
</span><span id="line-333"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">StoredProceduresMetrics
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">_spmWithParameters :: Int
</span><a href="Hasura.Server.Telemetry.Types.html#_spmWithParameters"><span class="hs-identifier hs-var">_spmWithParameters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">}</span><span>
</span><span id="line-334"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span class="annot"><span class="hs-comment">-- | Compute the relevant metrics for actions from the action cache.</span></span><span>
</span><span id="line-337"></span><span class="annot"><a href="Hasura.Server.Telemetry.html#computeActionsMetrics"><span class="hs-identifier hs-type">computeActionsMetrics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#ActionCache"><span class="hs-identifier hs-type">ActionCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Telemetry.Types.html#ActionMetric"><span class="hs-identifier hs-type">ActionMetric</span></a></span><span>
</span><span id="line-338"></span><span id="computeActionsMetrics"><span class="annot"><span class="annottext">computeActionsMetrics :: ActionCache -&gt; ActionMetric
</span><a href="Hasura.Server.Telemetry.html#computeActionsMetrics"><span class="hs-identifier hs-var hs-var">computeActionsMetrics</span></a></span></span><span> </span><span id="local-6989586621687300171"><span class="annot"><span class="annottext">ActionCache
</span><a href="#local-6989586621687300171"><span class="hs-identifier hs-var">actionCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-339"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; ActionMetric
</span><a href="Hasura.Server.Telemetry.Types.html#ActionMetric"><span class="hs-identifier hs-var">ActionMetric</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687300173"><span class="hs-identifier hs-var">syncActionsLen</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687300174"><span class="hs-identifier hs-var">asyncActionsLen</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687300175"><span class="hs-identifier hs-var">queryActionsLen</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687300176"><span class="hs-identifier hs-var">typeRelationships</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687300177"><span class="hs-identifier hs-var">customTypesLen</span></a></span><span>
</span><span id="line-340"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-341"></span><span>    </span><span id="local-6989586621687300178"><span class="annot"><span class="annottext">actions :: [ActionInfo]
</span><a href="#local-6989586621687300178"><span class="hs-identifier hs-var hs-var">actions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ActionCache -&gt; [ActionInfo]
forall k v. HashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-a5b4fa803c841f948b5080a5c7a22f4e3b108a71ab10582fd155001f6f7ca093/share/doc/html/src/Data.HashMap.Internal.html#elems"><span class="hs-identifier hs-var">HashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">ActionCache
</span><a href="#local-6989586621687300171"><span class="hs-identifier hs-var">actionCache</span></a></span><span>
</span><span id="line-342"></span><span>    </span><span id="local-6989586621687300173"><span class="annot"><span class="annottext">syncActionsLen :: Int
</span><a href="#local-6989586621687300173"><span class="hs-identifier hs-var hs-var">syncActionsLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ActionInfo] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([ActionInfo] -&gt; Int)
-&gt; ([ActionInfo] -&gt; [ActionInfo]) -&gt; [ActionInfo] -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ActionInfo -&gt; Bool) -&gt; [ActionInfo] -&gt; [ActionInfo]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActionType -&gt; ActionType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ActionMutationKind -&gt; ActionType
</span><a href="Hasura.RQL.Types.Action.html#ActionMutation"><span class="hs-identifier hs-var">ActionMutation</span></a></span><span> </span><span class="annot"><span class="annottext">ActionMutationKind
</span><a href="Hasura.RQL.Types.Action.html#ActionSynchronous"><span class="hs-identifier hs-var">ActionSynchronous</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ActionType -&gt; Bool)
-&gt; (ActionInfo -&gt; ActionType) -&gt; ActionInfo -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ActionDefinition
  (GType, AnnotatedInputType) (EnvRecord ResolvedWebhook)
-&gt; ActionType
forall arg webhook. ActionDefinition arg webhook -&gt; ActionType
</span><a href="Hasura.RQL.Types.Action.html#_adType"><span class="hs-identifier hs-var">_adType</span></a></span><span> </span><span class="annot"><span class="annottext">(ActionDefinition
   (GType, AnnotatedInputType) (EnvRecord ResolvedWebhook)
 -&gt; ActionType)
-&gt; (ActionInfo
    -&gt; ActionDefinition
         (GType, AnnotatedInputType) (EnvRecord ResolvedWebhook))
-&gt; ActionInfo
-&gt; ActionType
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ActionInfo
-&gt; ActionDefinition
     (GType, AnnotatedInputType) (EnvRecord ResolvedWebhook)
</span><a href="Hasura.RQL.Types.Action.html#_aiDefinition"><span class="hs-identifier hs-var">_aiDefinition</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ActionInfo] -&gt; Int) -&gt; [ActionInfo] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ActionInfo]
</span><a href="#local-6989586621687300178"><span class="hs-identifier hs-var">actions</span></a></span><span>
</span><span id="line-343"></span><span>    </span><span id="local-6989586621687300174"><span class="annot"><span class="annottext">asyncActionsLen :: Int
</span><a href="#local-6989586621687300174"><span class="hs-identifier hs-var hs-var">asyncActionsLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ActionInfo] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([ActionInfo] -&gt; Int)
-&gt; ([ActionInfo] -&gt; [ActionInfo]) -&gt; [ActionInfo] -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ActionInfo -&gt; Bool) -&gt; [ActionInfo] -&gt; [ActionInfo]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActionType -&gt; ActionType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ActionMutationKind -&gt; ActionType
</span><a href="Hasura.RQL.Types.Action.html#ActionMutation"><span class="hs-identifier hs-var">ActionMutation</span></a></span><span> </span><span class="annot"><span class="annottext">ActionMutationKind
</span><a href="Hasura.RQL.Types.Action.html#ActionAsynchronous"><span class="hs-identifier hs-var">ActionAsynchronous</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ActionType -&gt; Bool)
-&gt; (ActionInfo -&gt; ActionType) -&gt; ActionInfo -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ActionDefinition
  (GType, AnnotatedInputType) (EnvRecord ResolvedWebhook)
-&gt; ActionType
forall arg webhook. ActionDefinition arg webhook -&gt; ActionType
</span><a href="Hasura.RQL.Types.Action.html#_adType"><span class="hs-identifier hs-var">_adType</span></a></span><span> </span><span class="annot"><span class="annottext">(ActionDefinition
   (GType, AnnotatedInputType) (EnvRecord ResolvedWebhook)
 -&gt; ActionType)
-&gt; (ActionInfo
    -&gt; ActionDefinition
         (GType, AnnotatedInputType) (EnvRecord ResolvedWebhook))
-&gt; ActionInfo
-&gt; ActionType
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ActionInfo
-&gt; ActionDefinition
     (GType, AnnotatedInputType) (EnvRecord ResolvedWebhook)
</span><a href="Hasura.RQL.Types.Action.html#_aiDefinition"><span class="hs-identifier hs-var">_aiDefinition</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ActionInfo] -&gt; Int) -&gt; [ActionInfo] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ActionInfo]
</span><a href="#local-6989586621687300178"><span class="hs-identifier hs-var">actions</span></a></span><span>
</span><span id="line-344"></span><span>    </span><span id="local-6989586621687300175"><span class="annot"><span class="annottext">queryActionsLen :: Int
</span><a href="#local-6989586621687300175"><span class="hs-identifier hs-var hs-var">queryActionsLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ActionInfo] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([ActionInfo] -&gt; Int)
-&gt; ([ActionInfo] -&gt; [ActionInfo]) -&gt; [ActionInfo] -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ActionInfo -&gt; Bool) -&gt; [ActionInfo] -&gt; [ActionInfo]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActionType -&gt; ActionType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ActionType
</span><a href="Hasura.RQL.Types.Action.html#ActionQuery"><span class="hs-identifier hs-var">ActionQuery</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ActionType -&gt; Bool)
-&gt; (ActionInfo -&gt; ActionType) -&gt; ActionInfo -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ActionDefinition
  (GType, AnnotatedInputType) (EnvRecord ResolvedWebhook)
-&gt; ActionType
forall arg webhook. ActionDefinition arg webhook -&gt; ActionType
</span><a href="Hasura.RQL.Types.Action.html#_adType"><span class="hs-identifier hs-var">_adType</span></a></span><span> </span><span class="annot"><span class="annottext">(ActionDefinition
   (GType, AnnotatedInputType) (EnvRecord ResolvedWebhook)
 -&gt; ActionType)
-&gt; (ActionInfo
    -&gt; ActionDefinition
         (GType, AnnotatedInputType) (EnvRecord ResolvedWebhook))
-&gt; ActionInfo
-&gt; ActionType
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ActionInfo
-&gt; ActionDefinition
     (GType, AnnotatedInputType) (EnvRecord ResolvedWebhook)
</span><a href="Hasura.RQL.Types.Action.html#_aiDefinition"><span class="hs-identifier hs-var">_aiDefinition</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ActionInfo] -&gt; Int) -&gt; [ActionInfo] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ActionInfo]
</span><a href="#local-6989586621687300178"><span class="hs-identifier hs-var">actions</span></a></span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span>    </span><span id="local-6989586621687300185"><span class="annot"><span class="annottext">outputTypesLen :: Int
</span><a href="#local-6989586621687300185"><span class="hs-identifier hs-var hs-var">outputTypesLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GraphQLType] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([GraphQLType] -&gt; Int)
-&gt; ([ActionInfo] -&gt; [GraphQLType]) -&gt; [ActionInfo] -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[GraphQLType] -&gt; [GraphQLType]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.nub</span></span><span> </span><span class="annot"><span class="annottext">([GraphQLType] -&gt; [GraphQLType])
-&gt; ([ActionInfo] -&gt; [GraphQLType]) -&gt; [ActionInfo] -&gt; [GraphQLType]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ActionInfo -&gt; GraphQLType) -&gt; [ActionInfo] -&gt; [GraphQLType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActionDefinition
  (GType, AnnotatedInputType) (EnvRecord ResolvedWebhook)
-&gt; GraphQLType
forall arg webhook. ActionDefinition arg webhook -&gt; GraphQLType
</span><a href="Hasura.RQL.Types.Action.html#_adOutputType"><span class="hs-identifier hs-var">_adOutputType</span></a></span><span> </span><span class="annot"><span class="annottext">(ActionDefinition
   (GType, AnnotatedInputType) (EnvRecord ResolvedWebhook)
 -&gt; GraphQLType)
-&gt; (ActionInfo
    -&gt; ActionDefinition
         (GType, AnnotatedInputType) (EnvRecord ResolvedWebhook))
-&gt; ActionInfo
-&gt; GraphQLType
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ActionInfo
-&gt; ActionDefinition
     (GType, AnnotatedInputType) (EnvRecord ResolvedWebhook)
</span><a href="Hasura.RQL.Types.Action.html#_aiDefinition"><span class="hs-identifier hs-var">_aiDefinition</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ActionInfo] -&gt; Int) -&gt; [ActionInfo] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ActionInfo]
</span><a href="#local-6989586621687300178"><span class="hs-identifier hs-var">actions</span></a></span><span>
</span><span id="line-347"></span><span>    </span><span id="local-6989586621687300188"><span class="annot"><span class="annottext">inputTypesLen :: Int
</span><a href="#local-6989586621687300188"><span class="hs-identifier hs-var hs-var">inputTypesLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(GType, AnnotatedInputType)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([(GType, AnnotatedInputType)] -&gt; Int)
-&gt; ([ActionInfo] -&gt; [(GType, AnnotatedInputType)])
-&gt; [ActionInfo]
-&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(GType, AnnotatedInputType)] -&gt; [(GType, AnnotatedInputType)]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.nub</span></span><span> </span><span class="annot"><span class="annottext">([(GType, AnnotatedInputType)] -&gt; [(GType, AnnotatedInputType)])
-&gt; ([ActionInfo] -&gt; [(GType, AnnotatedInputType)])
-&gt; [ActionInfo]
-&gt; [(GType, AnnotatedInputType)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ActionInfo -&gt; [(GType, AnnotatedInputType)])
-&gt; [ActionInfo] -&gt; [(GType, AnnotatedInputType)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ArgumentDefinition (GType, AnnotatedInputType)
 -&gt; (GType, AnnotatedInputType))
-&gt; [ArgumentDefinition (GType, AnnotatedInputType)]
-&gt; [(GType, AnnotatedInputType)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ArgumentDefinition (GType, AnnotatedInputType)
-&gt; (GType, AnnotatedInputType)
forall a. ArgumentDefinition a -&gt; a
</span><a href="Hasura.RQL.Types.Action.html#_argType"><span class="hs-identifier hs-var">_argType</span></a></span><span> </span><span class="annot"><span class="annottext">([ArgumentDefinition (GType, AnnotatedInputType)]
 -&gt; [(GType, AnnotatedInputType)])
-&gt; (ActionInfo -&gt; [ArgumentDefinition (GType, AnnotatedInputType)])
-&gt; ActionInfo
-&gt; [(GType, AnnotatedInputType)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ActionDefinition
  (GType, AnnotatedInputType) (EnvRecord ResolvedWebhook)
-&gt; [ArgumentDefinition (GType, AnnotatedInputType)]
forall arg webhook.
ActionDefinition arg webhook -&gt; [ArgumentDefinition arg]
</span><a href="Hasura.RQL.Types.Action.html#_adArguments"><span class="hs-identifier hs-var">_adArguments</span></a></span><span> </span><span class="annot"><span class="annottext">(ActionDefinition
   (GType, AnnotatedInputType) (EnvRecord ResolvedWebhook)
 -&gt; [ArgumentDefinition (GType, AnnotatedInputType)])
-&gt; (ActionInfo
    -&gt; ActionDefinition
         (GType, AnnotatedInputType) (EnvRecord ResolvedWebhook))
-&gt; ActionInfo
-&gt; [ArgumentDefinition (GType, AnnotatedInputType)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ActionInfo
-&gt; ActionDefinition
     (GType, AnnotatedInputType) (EnvRecord ResolvedWebhook)
</span><a href="Hasura.RQL.Types.Action.html#_aiDefinition"><span class="hs-identifier hs-var">_aiDefinition</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ActionInfo] -&gt; Int) -&gt; [ActionInfo] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ActionInfo]
</span><a href="#local-6989586621687300178"><span class="hs-identifier hs-var">actions</span></a></span><span>
</span><span id="line-348"></span><span>    </span><span id="local-6989586621687300177"><span class="annot"><span class="annottext">customTypesLen :: Int
</span><a href="#local-6989586621687300177"><span class="hs-identifier hs-var hs-var">customTypesLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687300188"><span class="hs-identifier hs-var">inputTypesLen</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687300185"><span class="hs-identifier hs-var">outputTypesLen</span></a></span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span>    </span><span id="local-6989586621687300176"><span class="annot"><span class="annottext">typeRelationships :: Int
</span><a href="#local-6989586621687300176"><span class="hs-identifier hs-var hs-var">typeRelationships</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-351"></span><span>      </span><span class="annot"><span class="annottext">[RelationshipName] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span>
</span><span id="line-352"></span><span>        </span><span class="annot"><span class="annottext">([RelationshipName] -&gt; Int)
-&gt; ([ActionInfo] -&gt; [RelationshipName]) -&gt; [ActionInfo] -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[RelationshipName] -&gt; [RelationshipName]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.nub</span></span><span>
</span><span id="line-353"></span><span>        </span><span class="annot"><span class="annottext">([RelationshipName] -&gt; [RelationshipName])
-&gt; ([ActionInfo] -&gt; [RelationshipName])
-&gt; [ActionInfo]
-&gt; [RelationshipName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ActionInfo -&gt; [RelationshipName])
-&gt; [ActionInfo] -&gt; [RelationshipName]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span>
</span><span id="line-354"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687300193"><span class="annot"><span class="annottext">ActionInfo
</span><a href="#local-6989586621687300193"><span class="hs-identifier hs-var">aInfo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GType, AnnotatedOutputType) -&gt; AnnotatedOutputType
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((GType, AnnotatedOutputType) -&gt; AnnotatedOutputType)
-&gt; (ActionInfo -&gt; (GType, AnnotatedOutputType))
-&gt; ActionInfo
-&gt; AnnotatedOutputType
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ActionInfo -&gt; (GType, AnnotatedOutputType)
</span><a href="Hasura.RQL.Types.Action.html#_aiOutputType"><span class="hs-identifier hs-var">_aiOutputType</span></a></span><span> </span><span class="annot"><span class="annottext">(ActionInfo -&gt; AnnotatedOutputType)
-&gt; ActionInfo -&gt; AnnotatedOutputType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ActionInfo
</span><a href="#local-6989586621687300193"><span class="hs-identifier hs-var">aInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-355"></span><span>              </span><span class="annot"><a href="Hasura.RQL.Types.CustomTypes.html#AOTObject"><span class="hs-identifier hs-type">AOTObject</span></a></span><span> </span><span id="local-6989586621687300196"><span class="annot"><span class="annottext">AnnotatedObjectType
</span><a href="#local-6989586621687300196"><span class="hs-identifier hs-var">aot</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(AnnotatedTypeRelationship -&gt; RelationshipName)
-&gt; [AnnotatedTypeRelationship] -&gt; [RelationshipName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">AnnotatedTypeRelationship -&gt; RelationshipName
</span><a href="Hasura.RQL.Types.CustomTypes.html#_atrName"><span class="hs-identifier hs-var">_atrName</span></a></span><span> </span><span class="annot"><span class="annottext">([AnnotatedTypeRelationship] -&gt; [RelationshipName])
-&gt; [AnnotatedTypeRelationship] -&gt; [RelationshipName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AnnotatedObjectType -&gt; [AnnotatedTypeRelationship]
</span><a href="Hasura.RQL.Types.CustomTypes.html#_aotRelationships"><span class="hs-identifier hs-var">_aotRelationships</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedObjectType
</span><a href="#local-6989586621687300196"><span class="hs-identifier hs-var">aot</span></a></span><span>
</span><span id="line-356"></span><span>              </span><span class="annot"><a href="Hasura.RQL.Types.CustomTypes.html#AOTScalar"><span class="hs-identifier hs-type">AOTScalar</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedScalarType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-357"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>        </span><span class="annot"><span class="annottext">([ActionInfo] -&gt; Int) -&gt; [ActionInfo] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ActionInfo]
</span><a href="#local-6989586621687300178"><span class="hs-identifier hs-var">actions</span></a></span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span class="annot"><span class="hs-comment">-- | Decide which topic (telemetry table) we should use based on the version.</span></span><span>
</span><span id="line-361"></span><span class="annot"><a href="Hasura.Server.Telemetry.html#versionToTopic"><span class="hs-identifier hs-type">versionToTopic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Server.Version.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Telemetry.Types.html#Topic"><span class="hs-identifier hs-type">Topic</span></a></span><span>
</span><span id="line-362"></span><span id="versionToTopic"><span class="annot"><span class="annottext">versionToTopic :: Version -&gt; Topic
</span><a href="Hasura.Server.Telemetry.html#versionToTopic"><span class="hs-identifier hs-var hs-var">versionToTopic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-363"></span><span>  </span><span class="annot"><a href="Hasura.Server.Version.html#VersionDev"><span class="hs-identifier hs-type">VersionDev</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Topic
</span><a href="Hasura.Server.Telemetry.Types.html#Topic"><span class="hs-identifier hs-var">Topic</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;server_metrics_v2_test&quot;</span></span><span>
</span><span id="line-364"></span><span>  </span><span class="annot"><a href="Hasura.Server.Version.html#VersionRelease"><span class="hs-identifier hs-type">VersionRelease</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Topic
</span><a href="Hasura.Server.Telemetry.Types.html#Topic"><span class="hs-identifier hs-var">Topic</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;server_metrics_v2&quot;</span></span><span>
</span><span id="line-365"></span><span>  </span><span class="annot"><a href="Hasura.Server.Version.html#VersionCE"><span class="hs-identifier hs-type">VersionCE</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Topic
</span><a href="Hasura.Server.Telemetry.Types.html#Topic"><span class="hs-identifier hs-var">Topic</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;server_metrics_v2&quot;</span></span><span>
</span><span id="line-366"></span></pre></body></html>